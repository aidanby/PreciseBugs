{"buggy_code": ["html {\n  height: 100%;\n}\n\nbody {\n  position: absolute;\n  width: 100%;\n  min-height: calc(100% - 26px);\n  color: #333;\n}\n\n.left {\n  float: left;\n}\n\n.clear {\n  clear: both;\n}\n\n::-ms-reveal,\n::-ms-clear {\n  display: none;\n}\n\nhr {\n  border-top: 0;\n  padding-bottom: 1px;\n}\n\n.breakWords {\n  word-wrap: break-word;\n}\n\n.noPadding {\n  padding: 0;\n}\n\n.width100 {\n  width: 100%;\n}\n\n@media (min-width: 768px) {\n  .col-sm-auto {\n    width: auto;\n  }\n}\n\n@media (min-width: 992px) {\n  .col-md-auto {\n    width: auto;\n  }\n}\n\n@media (min-width: 1200px) {\n  .col-lg-auto {\n    width: auto;\n  }\n}\n\n.ui-resizable-se {\n  right: 0;\n  bottom: 0;\n}\n\n.navbar-static-bottom {\n@extend . navbar-fixed-bottom;\n  position: absolute;\n  border-width: 1px 0 0;\n  border-radius: 0;\n  min-height: 25px;\n  height: 25px;\n  line-height: 25px;\n  font-size: 11px;\n  margin-bottom: 0;\n  bottom: -25px;\n  left: 0;\n  background-color: #F8F8F8;\n  border-color: #E7E7E7;\n}\n\noptgroup,\nselect,\ntextarea,\ninput[type=\"text\"],\ninput[type=\"password\"],\ninput[type=\"datetime\"],\ninput[type=\"datetime-local\"],\ninput[type=\"date\"],\ninput[type=\"month\"],\ninput[type=\"time\"],\ninput[type=\"week\"],\ninput[type=\"number\"],\ninput[type=\"email\"],\ninput[type=\"url\"],\ninput[type=\"search\"],\ninput[type=\"tel\"],\ninput[type=\"color\"],\n.uneditable-input {\n  display: block;\n  margin: 0 0 5px 0;\n  width: 100%;\n  height: 34px;\n  padding: 6px 12px;\n  font-size: 14px;\n  line-height: 1.42857143;\n}\n\nselect {\n  border: 1px solid #ccc;\n  border-top-left-radius: 4px;\n  border-bottom-left-radius: 4px;\n}\n\nselect.form-control,\ntextarea.form-control {\n  height: 100%;\n  margin: 5px 0 5px 0;\n  padding: 6px 12px;\n  resize: none;\n}\n\n.btn-group .btn + .btn,\n.btn-group .btn + .btn-group,\n.btn-group .btn-group + .btn,\n.btn-group .btn-group + .btn-group {\n  margin-left: 0;\n}\n\n.nav > li.selected > a,\n.nav > li.selected > a:focus {\n  background-color: #E0E0E0;\n  color: #333;\n}\n.nav > li.selected > a:hover {\n  color: #333;\n}\n\n.nav-tabs > li.active > a,\n.nav-tabs > li.active > a:focus,\n.nav-tabs > li.active > a:hover {\n  color: #337AB7;\n  background-color: #E0E0E0;\n}\n\n.btn-group {\n  border-top: 1px solid transparent !important;\n}\n\n.navbar {\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  user-select: none;\n}\n\n.modal-body,\n.modal-header {\n  overflow: auto;\n}\n\n.modal-footer {\n  padding: 6px 12px;\n  border-top: none;\n}\n\n.btn-light {\n  color: #333;\n  background-color: #F0F0F0;\n  border-color: #ccc;\n}\n\n.btn-light:hover,\n.btn-light:focus,\n.btn-light.focus,\n.btn-light:active,\n.btn-light.active,\n.open > .dropdown-toggle.btn-light {\n  color: #333;\n  background-color: #F5F5F5;\n  border-color: #ADADAD;\n}\n\n.btn-light:active,\n.btn-light.active,\n.open > .dropdown-toggle.btn-light {\n  background-image: none;\n}\n\n.btn-light.disabled,\n.btn-light[disabled],\nfieldset[disabled] .btn-light,\n.btn-light.disabled:hover,\n.btn-light[disabled]:hover,\nfieldset[disabled] .btn-light:hover,\n.btn-light.disabled:focus,\n.btn-light[disabled]:focus,\nfieldset[disabled] .btn-light:focus,\n.btn-light.disabled.focus,\n.btn-light[disabled].focus,\nfieldset[disabled] .btn-light.focus,\n.btn-light.disabled:active,\n.btn-light[disabled]:active,\nfieldset[disabled] .btn-light:active,\n.btn-light.disabled.active,\n.btn-light[disabled].active,\nfieldset[disabled] .btn-light.active {\n  background-color: #fff;\n  border-color: #ccc;\n}\n\n.btn-light .badge {\n  color: #fff;\n  background-color: #333;\n}\n\n.btn-form {\n  padding: 4px 12px;\n  margin: 5px 0 5px 0;\n  font-size: 14px;\n  font-weight: normal;\n  height: 32px;\n  line-height: 1.42857143;\n  text-align: center;\n  white-space: nowrap;\n  vertical-align: middle;\n  -ms-touch-action: manipulation;\n  touch-action: manipulation;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-image: none;\n  background-color: #F5F5F5;\n  color: #777;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  outline: none;\n  -webkit-appearance: none;\n}\n\n.btn-form:focus,\n.btn-form:hover {\n  color: #333;\n  background-color: #E0E0E0;\n}\n\n.input-group-btn > .btn-form {\n  margin: 0;\n  height: 34px;\n  background-color: #F5F5F5;\n}\n\n.input-group-btn > .btn-form:focus,\n.input-group-btn > .btn-form:hover {\n  color: #333;\n  background-color: #E0E0E0;\n}\n\n.text-ellipsis {\n  width: 100%;\n  display: inline-block;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.noselect {\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  user-select: none;\n}\n\n.btn.disabled,\n.btn[disabled],\nfieldset[disabled] .btn {\n  pointer-events: auto;\n}\n\n.navbar-nav .divider-vertical {\n  min-height: 32px;\n  margin: 6px 3px 0 3px;\n  border-left: 1px solid #CACACA;\n}\n\n.modal-dialog {\n    margin-top: 10px;\n}\n\n.modal-dialog {\n    margin-top: 10px;\n}\n", "{% autoescape true %}\n\nfunction PackageUI (type){\n    var packages = [];\n    var thisObject;\n    this.initialize = function(type) {\n        this.type = type;\n        thisObject = this;\n\n        $(\"#del_finished\").click(this.deleteFinished);\n        $(\"#restart_failed\").click(this.restartFailed);\n        this.parsePackages();\n\n    };\n\n    this.parsePackages = function () {\n       var $packageList = $(\"#package-list\");\n       $packageList.children(\"li\").each(function(ele) {\n            var id = this.id.match(/[0-9]+/);\n            packages.push(new Package(thisObject, id, this));\n        });\n        $packageList.sortable({\n            handle: \".progress\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(event, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                let newIndex = ui.item.index();\n                let oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.package_order')}}\",\n                    data: {pid: ui.item.data('pid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.deleteFinished = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_finished')}}\", function(data) {\n            if (data.length > 0) {\n                window.location.reload();\n            } else {\n                $.each(packages, function (pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.restartFailed = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_failed')}}\", function(data) {\n            if (data.length > 0) {\n                $.each(packages,function(pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.initialize(type);\n}\n\nfunction Package (ui, id, ele){\n    // private variables\n    var linksLoaded = false;\n    var thisObject;\n    var buttons;\n    var name;\n    var password;\n    var folder;\n\n    this.initialize = function () {\n        thisObject = this;\n        if (!ele) {\n            this.createElement();\n        } else {\n            jQuery.data(ele,\"pid\", id);\n            this.parseElement();\n        }\n\n        var pname = $(ele).find('.packagename');\n\n        buttons = $(ele).find('.buttons');\n        buttons.css(\"opacity\", 0);\n\n        $(pname).mouseenter(function(e) {\n            $(this).find('.buttons').fadeTo('fast', 1)\n        });\n\n        $(pname).mouseleave( function(e) {\n            $(this).find('.buttons').fadeTo('fast', 0)\n        });\n    };\n\n    this.createElement = function () {\n        alert(\"create\");\n    };\n\n    this.parseElement = function () {\n        var imgs = $(ele).find('span');\n\n        name = $(ele).find('.name');\n        folder =  $(ele).find('.folder');\n        password = $(ele).find('.password');\n\n        $(imgs[3]).click(this.deletePackage);\n        $(imgs[4]).click(this.restartPackage);\n        $(imgs[5]).click(this.editPackage);\n        $(imgs[6]).click(this.movePackage);\n        $(imgs[7]).click(this.editOrder);\n\n        $(ele).find('.packagename').click(this.toggle);\n    };\n\n    this.loadLinks = function () {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            data: {id: id},\n            traditional: true,\n            success: thisObject.createLinks\n        }).fail(function () {\n            indicateFail();\n            return false;\n        }).done(function() {\n            return true;\n        });\n    };\n\n    this.createLinks = function(data) {\n        var ul = $(\"#sort_children_\" + id[0]);\n        ul.html(\"\");\n        $.each(data.links, function(key, link) {      // data.links.each(\n            link.id = link.fid;\n            var li = document.createElement(\"li\");\n            $(li).css(\"margin-left\",0);\n\n            if (link.status === 0)\n                link.icon = 'glyphicon glyphicon-ok';\n            else if (link.status === 2 || link.status === 3)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status ===  9 || link.status === 1)\n                link.icon = 'glyphicon glyphicon-ban-circle';\n            else if (link.status === 5)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status === 8)\n                link.icon = 'glyphicon glyphicon-exclamation-sign';\n            else if (link.status === 4)\n                link.icon = 'glyphicon glyphicon-arrow-right';\n            else if (link.status ===  11 || link.status === 13)\n                link.icon = 'glyphicon glyphicon-cog';\n            else\n                link.icon = 'glyphicon glyphicon-cloud-download';\n\n            var html = \"<span class='child_status'><span style='margin-right: 2px;color: #337ab7;' class='\" + link.icon + \"'></span></span>\\n\" +\n                       \"<span style='font-size: 16px; font-weight: bold;'><a href='\" + link.url + \"'>\" + link.name + \"</a></span><br/>\" +\n                       \"<div class='child_secrow' style='margin-left: 21px; margin-bottom: 7px; border-radius: 4px;'>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555; padding-left: 5px;'>\" + link.statusmsg + \"</span>&nbsp;\" + link.error + \"&nbsp;\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555;'>\" + link.format_size + \"</span>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555;'> \" + link.plugin + \"</span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-trash' title='{{_('Delete Link')}}' style='cursor: pointer;  font-size: 12px; color:#333;' ></span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-repeat' title='{{_('Restart Link')}}' style='cursor: pointer; font-size: 12px; color:#333;' ></span></div>\";\n\n            var div = document.createElement(\"div\");\n            $(div).attr(\"id\", \"file_\" + link.id);\n            $(div).css(\"padding-left\", \"30px\");\n            $(div).css(\"cursor\", \"grab\");\n            $(div).addClass(\"child\");\n            $(div).html(html);\n\n            jQuery.data(li,\"lid\", link.id);\n\n            li.appendChild(div);\n            $(ul)[0].appendChild(li);\n        });\n\n        thisObject.registerLinkEvents();\n        linksLoaded = true;\n        indicateFinish();\n        thisObject.toggle();\n    };\n\n    this.registerLinkEvents = function () {\n        $(ele).find('.children').children('ul').children(\"li\").each(function(child) {\n            var lid = $(this).find('.child').attr('id').match(/[0-9]+/);\n            var imgs = $(this).find('.child_secrow span');\n            $(imgs[3]).bind('click',{ lid: lid}, function(e) {\n                $.get(\"{{url_for('api.rpc', func='delete_files')}}/[\" + lid + \"]\", function () {\n                    $('#file_' + lid).remove()\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n\n            $(imgs[4]).bind('click',{ lid: lid},function(e) {\n                $.get(\"{{url_for('api.rpc', func='restart_file')}}/\" + lid, function () {\n                    var ele1 = $('#file_' + lid);\n                    var imgs1 = $(ele1).find(\".glyphicon\");\n                    $(imgs1[0]).attr( \"class\", \"glyphicon glyphicon-time text-info\");\n                    var spans = $(ele1).find(\".child_status\");\n                    $(spans[1]).html(\"{{_('queued')}}\");\n                    indicateSuccess();\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n        });\n\n\n        $(ele).find('.children').children('ul').sortable({\n            handle: \".child\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(e, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                var newIndex = ui.item.index();\n                var oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.link_order')}}\",\n                    data: {fid: ui.item.data('lid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n            }\n        });\n    };\n\n    this.toggle = function () {\n        var icon = $(ele).find('.packageicon');\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        } else {\n            if (!linksLoaded) {\n                if (!thisObject.loadLinks()) {\n                    return;\n                }\n            } else {\n                $(child).fadeIn();\n            }\n            icon.removeClass('glyphicon-folder-close');\n            icon.addClass('glyphicon-folder-open');\n        }\n    };\n\n    this.deletePackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_packages')}}/[\" + id + \"]\", function () {\n            $(ele).remove();\n            indicateFinish();\n        }).fail(function () {\n            indicateFail();\n        });\n\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.restartPackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_package')}}/\" + id, function () {\n            thisObject.close();\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.close = function () {\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            var icon = $(ele).find('.packageicon');\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        }\n        var ul = $(\"#sort_children_\" + id);\n        $(ul).html(\"\");\n        linksLoaded = false;\n    };\n\n    this.movePackage = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.move_package')}}\",\n            data: {id: id, dest: ((ui.type + 1) % 2)},\n            traditional: true,\n            success: function () {\n                $(ele).remove();\n                indicateFinish();\n            }\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.editOrder = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            success: function(data){\n                length = data.links.length;\n                for (i = 1; i <= length/2; i++){\n                    $.get({\n                        url: \"{{url_for('json.link_order')}}\",\n                        data: {fid: data.links[length-i].fid, pos: i-1},\n                        traditional: true,\n                    }).fail(function () {\n                        indicateFail();\n                    });\n                }\n            }\n        });\n        indicateFinish();\n        thisObject.close();\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n\n    this.editPackage = function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(\"#pack_form\").off(\"submit\").submit(thisObject.savePackage);\n\n        $(\"#pack_id\").val(id[0]);\n        $(\"#pack_name\").val(name.text());\n        $(\"#pack_folder\").val(folder.text());\n        $(\"#pack_pws\").val(password.text());\n        $('#pack_box').modal('show');\n    };\n\n    this.savePackage = function(event) {\n        $.ajax({\n            url: \"{{url_for('json.edit_package')}}\",\n            type: 'post',\n            dataType: 'json',\n            data: $('#pack_form').serialize()\n        });\n        event.preventDefault();\n        name.text( $(\"#pack_name\").val());\n        folder.text( $(\"#pack_folder\").val());\n        password.text($(\"#pack_pws\").val());\n        $('#pack_box').modal('hide');\n    };\n\n    this.initialize();\n}\n\n{% endautoescape %}\n", "{% autoescape true %}\n\nfunction PackageUI (type){\n    var packages = [];\n    var thisObject;\n    this.initialize = function(type) {\n        this.type = type;\n        thisObject = this;\n\n        $(\"#del_finished\").click(this.deleteFinished);\n        $(\"#restart_failed\").click(this.restartFailed);\n        this.parsePackages();\n\n    };\n\n    this.parsePackages = function () {\n       var $packageList = $(\"#package-list\");\n       $packageList.children(\"li\").each(function(ele) {\n            var id = this.id.match(/[0-9]+/);\n            packages.push(new Package(thisObject, id, this));\n        });\n        $packageList.sortable({\n            handle: \".progress\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(event, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                let newIndex = ui.item.index();\n                let oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.package_order')}}\",\n                    data: {pid: ui.item.data('pid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.deleteFinished = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_finished')}}\", function(data) {\n            if (data.length > 0) {\n                window.location.reload();\n            } else {\n                $.each(packages, function (pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.restartFailed = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_failed')}}\", function(data) {\n            if (data.length > 0) {\n                $.each(packages,function(pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.initialize(type);\n}\n\nfunction Package (ui, id, ele){\n    // private variables\n    var linksLoaded = false;\n    var thisObject;\n    var buttons;\n    var name;\n    var password;\n    var folder;\n\n    this.initialize = function () {\n        thisObject = this;\n        if (!ele) {\n            this.createElement();\n        } else {\n            jQuery.data(ele,\"pid\", id);\n            this.parseElement();\n        }\n\n        var pname = $(ele).find('.packagename');\n\n        buttons = $(ele).find('.buttons');\n        buttons.css(\"opacity\", 0);\n\n        $(pname).mouseenter(function(e) {\n            $(this).find('.buttons').fadeTo('fast', 1)\n        });\n\n        $(pname).mouseleave( function(e) {\n            $(this).find('.buttons').fadeTo('fast', 0)\n        });\n    };\n\n    this.createElement = function () {\n        alert(\"create\");\n    };\n\n    this.parseElement = function () {\n        var imgs = $(ele).find('span');\n\n        name = $(ele).find('.name');\n        folder =  $(ele).find('.folder');\n        password = $(ele).find('.password');\n\n        $(imgs[3]).click(this.deletePackage);\n        $(imgs[4]).click(this.restartPackage);\n        $(imgs[5]).click(this.editPackage);\n        $(imgs[6]).click(this.movePackage);\n        $(imgs[7]).click(this.editOrder);\n\n        $(ele).find('.packagename').click(this.toggle);\n    };\n\n    this.loadLinks = function () {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            data: {id: id},\n            traditional: true,\n            success: thisObject.createLinks\n        }).fail(function () {\n            indicateFail();\n            return false;\n        }).done(function() {\n            return true;\n        });\n    };\n\n    this.createLinks = function(data) {\n        var ul = $(\"#sort_children_\" + id[0]);\n        ul.html(\"\");\n        $.each(data.links, function(key, link) {      // data.links.each(\n            link.id = link.fid;\n            var li = document.createElement(\"li\");\n            $(li).css(\"margin-left\",0);\n\n            if (link.status === 0)\n                link.icon = 'glyphicon glyphicon-ok';\n            else if (link.status === 2 || link.status === 3)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status ===  9 || link.status === 1)\n                link.icon = 'glyphicon glyphicon-ban-circle';\n            else if (link.status === 5)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status === 8)\n                link.icon = 'glyphicon glyphicon-exclamation-sign';\n            else if (link.status === 4)\n                link.icon = 'glyphicon glyphicon-arrow-right';\n            else if (link.status ===  11 || link.status === 13)\n                link.icon = 'glyphicon glyphicon-cog';\n            else\n                link.icon = 'glyphicon glyphicon-cloud-download';\n\n            var html = \"<span class='child_status'><span style='margin-right: 2px;color: #f9be03;' class='\" + link.icon + \"'></span></span>\\n\" +\n                       \"<span style='font-size: 16px; font-weight: bold;'><a href='\" + link.url + \"'>\" + link.name + \"</a></span><br/>\" +\n                       \"<div class='child_secrow' style='margin-left: 21px; margin-bottom: 7px; border-radius: 4px;'>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee; padding-left: 5px;'>\" + link.statusmsg + \"</span>&nbsp;\" + link.error + \"&nbsp;\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee;'>\" + link.format_size + \"</span>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee;'> \" + link.plugin + \"</span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-trash' title='{{_('Delete Link')}}' style='cursor: pointer;  font-size: 12px; color:#eee;' ></span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-repeat' title='{{_('Restart Link')}}' style='cursor: pointer; font-size: 12px; color:#eee;' ></span></div>\";\n\n            var div = document.createElement(\"div\");\n            $(div).attr(\"id\", \"file_\" + link.id);\n            $(div).css(\"padding-left\", \"30px\");\n            $(div).css(\"cursor\", \"grab\");\n            $(div).addClass(\"child\");\n            $(div).html(html);\n\n            jQuery.data(li,\"lid\", link.id);\n\n            li.appendChild(div);\n            $(ul)[0].appendChild(li);\n        });\n\n        thisObject.registerLinkEvents();\n        linksLoaded = true;\n        indicateFinish();\n        thisObject.toggle();\n    };\n\n    this.registerLinkEvents = function () {\n        $(ele).find('.children').children('ul').children(\"li\").each(function(child) {\n            var lid = $(this).find('.child').attr('id').match(/[0-9]+/);\n            var imgs = $(this).find('.child_secrow span');\n            $(imgs[3]).bind('click',{ lid: lid}, function(e) {\n                $.get(\"{{url_for('api.rpc', func='delete_files')}}/[\" + lid + \"]\", function () {\n                    $('#file_' + lid).remove()\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n\n            $(imgs[4]).bind('click',{ lid: lid},function(e) {\n                $.get(\"{{url_for('api.rpc', func='restart_file')}}/\" + lid, function () {\n                    var ele1 = $('#file_' + lid);\n                    var imgs1 = $(ele1).find(\".glyphicon\");\n                    $(imgs1[0]).attr( \"class\", \"glyphicon glyphicon-time text-info\");\n                    var spans = $(ele1).find(\".child_status\");\n                    $(spans[1]).html(\"{{_('queued')}}\");\n                    indicateSuccess();\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n        });\n\n\n        $(ele).find('.children').children('ul').sortable({\n            handle: \".child\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(e, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                var newIndex = ui.item.index();\n                var oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.link_order')}}\",\n                    data: {fid: ui.item.data('lid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.toggle = function () {\n        var icon = $(ele).find('.packageicon');\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        } else {\n            if (!linksLoaded) {\n                if (!thisObject.loadLinks()) {\n                    return;\n                }\n            } else {\n                $(child).fadeIn();\n            }\n            icon.removeClass('glyphicon-folder-close');\n            icon.addClass('glyphicon-folder-open');\n        }\n    };\n\n    this.deletePackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_packages')}}/[\" + id + \"]\", function () {\n            $(ele).remove();\n            indicateFinish();\n        }).fail(function () {\n            indicateFail();\n        });\n\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.restartPackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_package')}}/\" + id, function () {\n            thisObject.close();\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.close = function () {\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            var icon = $(ele).find('.packageicon');\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        }\n        var ul = $(\"#sort_children_\" + id);\n        $(ul).html(\"\");\n        linksLoaded = false;\n    };\n\n    this.movePackage = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.move_package')}}\",\n            data: {id: id, dest: ((ui.type + 1) % 2)},\n            traditional: true,\n            success: function () {\n                $(ele).remove();\n                indicateFinish();\n            }\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.editOrder = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            success: function(data){\n                length = data.links.length;\n                for (i = 1; i <= length/2; i++){\n                    $.get({\n                        url: \"{{url_for('json.link_order')}}\",\n                        data: {fid: data.links[length-i].fid, pos: i-1},\n                        traditional: true,\n                    }).fail(function () {\n                        indicateFail();\n                    });\n                }\n            }\n        });\n        indicateFinish();\n        thisObject.close();\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n\n    this.editPackage = function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(\"#pack_form\").off(\"submit\").submit(thisObject.savePackage);\n\n        $(\"#pack_id\").val(id[0]);\n        $(\"#pack_name\").val(name.text());\n        $(\"#pack_folder\").val(folder.text());\n        $(\"#pack_pws\").val(password.text());\n        $('#pack_box').modal('show');\n    };\n\n    this.savePackage = function(event) {\n        $.ajax({\n            url: \"{{url_for('json.edit_package')}}\",\n            type: 'post',\n            dataType: 'json',\n            data: $('#pack_form').serialize()\n        });\n        event.preventDefault();\n        name.text( $(\"#pack_name\").val());\n        folder.text( $(\"#pack_folder\").val());\n        password.text($(\"#pack_pws\").val());\n        $('#pack_box').modal('hide');\n    };\n\n    this.initialize();\n}\n\n{% endautoescape %}\n"], "fixing_code": ["html {\n  height: 100%;\n}\n\nbody {\n  position: absolute;\n  width: 100%;\n  min-height: calc(100% - 26px);\n  color: #333;\n}\n\n.left {\n  float: left;\n}\n\n.clear {\n  clear: both;\n}\n\n::-ms-reveal,\n::-ms-clear {\n  display: none;\n}\n\nhr {\n  border-top: 0;\n  padding-bottom: 1px;\n}\n\n.breakWords {\n  word-wrap: break-word;\n}\n\n.noPadding {\n  padding: 0;\n}\n\n.width100 {\n  width: 100%;\n}\n\n@media (min-width: 768px) {\n  .col-sm-auto {\n    width: auto;\n  }\n}\n\n@media (min-width: 992px) {\n  .col-md-auto {\n    width: auto;\n  }\n}\n\n@media (min-width: 1200px) {\n  .col-lg-auto {\n    width: auto;\n  }\n}\n\n.ui-resizable-se {\n  right: 0;\n  bottom: 0;\n}\n\n.navbar-static-bottom {\n@extend . navbar-fixed-bottom;\n  position: absolute;\n  border-width: 1px 0 0;\n  border-radius: 0;\n  min-height: 25px;\n  height: 25px;\n  line-height: 25px;\n  font-size: 11px;\n  margin-bottom: 0;\n  bottom: -25px;\n  left: 0;\n  background-color: #F8F8F8;\n  border-color: #E7E7E7;\n}\n\noptgroup,\nselect,\ntextarea,\ninput[type=\"text\"],\ninput[type=\"password\"],\ninput[type=\"datetime\"],\ninput[type=\"datetime-local\"],\ninput[type=\"date\"],\ninput[type=\"month\"],\ninput[type=\"time\"],\ninput[type=\"week\"],\ninput[type=\"number\"],\ninput[type=\"email\"],\ninput[type=\"url\"],\ninput[type=\"search\"],\ninput[type=\"tel\"],\ninput[type=\"color\"],\n.uneditable-input {\n  display: block;\n  margin: 0 0 5px 0;\n  width: 100%;\n  height: 34px;\n  padding: 6px 12px;\n  font-size: 14px;\n  line-height: 1.42857143;\n}\n\nselect {\n  border: 1px solid #ccc;\n  border-top-left-radius: 4px;\n  border-bottom-left-radius: 4px;\n}\n\nselect.form-control,\ntextarea.form-control {\n  height: 100%;\n  margin: 5px 0 5px 0;\n  padding: 6px 12px;\n  resize: none;\n}\n\n.btn-group .btn + .btn,\n.btn-group .btn + .btn-group,\n.btn-group .btn-group + .btn,\n.btn-group .btn-group + .btn-group {\n  margin-left: 0;\n}\n\n.nav > li.selected > a,\n.nav > li.selected > a:focus {\n  background-color: #E0E0E0;\n  color: #333;\n}\n.nav > li.selected > a:hover {\n  color: #333;\n}\n\n.nav-tabs > li.active > a,\n.nav-tabs > li.active > a:focus,\n.nav-tabs > li.active > a:hover {\n  color: #337AB7;\n  background-color: #E0E0E0;\n}\n\n.btn-group {\n  border-top: 1px solid transparent !important;\n}\n\n.navbar {\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  user-select: none;\n}\n\n.modal-body,\n.modal-header {\n  overflow: auto;\n}\n\n.modal-footer {\n  padding: 6px 12px;\n  border-top: none;\n}\n\n.btn-light {\n  color: #333;\n  background-color: #F0F0F0;\n  border-color: #ccc;\n}\n\n.btn-light:hover,\n.btn-light:focus,\n.btn-light.focus,\n.btn-light:active,\n.btn-light.active,\n.open > .dropdown-toggle.btn-light {\n  color: #333;\n  background-color: #F5F5F5;\n  border-color: #ADADAD;\n}\n\n.btn-light:active,\n.btn-light.active,\n.open > .dropdown-toggle.btn-light {\n  background-image: none;\n}\n\n.btn-light.disabled,\n.btn-light[disabled],\nfieldset[disabled] .btn-light,\n.btn-light.disabled:hover,\n.btn-light[disabled]:hover,\nfieldset[disabled] .btn-light:hover,\n.btn-light.disabled:focus,\n.btn-light[disabled]:focus,\nfieldset[disabled] .btn-light:focus,\n.btn-light.disabled.focus,\n.btn-light[disabled].focus,\nfieldset[disabled] .btn-light.focus,\n.btn-light.disabled:active,\n.btn-light[disabled]:active,\nfieldset[disabled] .btn-light:active,\n.btn-light.disabled.active,\n.btn-light[disabled].active,\nfieldset[disabled] .btn-light.active {\n  background-color: #fff;\n  border-color: #ccc;\n}\n\n.btn-light .badge {\n  color: #fff;\n  background-color: #333;\n}\n\n.btn-form {\n  padding: 4px 12px;\n  margin: 5px 0 5px 0;\n  font-size: 14px;\n  font-weight: normal;\n  height: 32px;\n  line-height: 1.42857143;\n  text-align: center;\n  white-space: nowrap;\n  vertical-align: middle;\n  -ms-touch-action: manipulation;\n  touch-action: manipulation;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-image: none;\n  background-color: #F5F5F5;\n  color: #777;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  outline: none;\n  -webkit-appearance: none;\n}\n\n.btn-form:focus,\n.btn-form:hover {\n  color: #333;\n  background-color: #E0E0E0;\n}\n\n.input-group-btn > .btn-form {\n  margin: 0;\n  height: 34px;\n  background-color: #F5F5F5;\n}\n\n.input-group-btn > .btn-form:focus,\n.input-group-btn > .btn-form:hover {\n  color: #333;\n  background-color: #E0E0E0;\n}\n\n.text-ellipsis {\n  width: 100%;\n  display: inline-block;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.noselect {\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  user-select: none;\n}\n\n.btn.disabled,\n.btn[disabled],\nfieldset[disabled] .btn {\n  pointer-events: auto;\n}\n\n.navbar-nav .divider-vertical {\n  min-height: 32px;\n  margin: 6px 3px 0 3px;\n  border-left: 1px solid #CACACA;\n}\n\n.modal-dialog {\n    margin-top: 10px;\n}\n", "{% autoescape true %}\n\nfunction PackageUI (type){\n    var packages = [];\n    var thisObject;\n    this.initialize = function(type) {\n        this.type = type;\n        thisObject = this;\n\n        $(\"#del_finished\").click(this.deleteFinished);\n        $(\"#restart_failed\").click(this.restartFailed);\n        this.parsePackages();\n\n    };\n\n    this.parsePackages = function () {\n       var $packageList = $(\"#package-list\");\n       $packageList.children(\"li\").each(function(ele) {\n            var id = this.id.match(/[0-9]+/);\n            packages.push(new Package(thisObject, id, this));\n        });\n        $packageList.sortable({\n            handle: \".progress\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(event, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                let newIndex = ui.item.index();\n                let oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.package_order')}}\",\n                    data: {pid: ui.item.data('pid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.deleteFinished = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_finished')}}\", function(data) {\n            if (data.length > 0) {\n                window.location.reload();\n            } else {\n                $.each(packages, function (pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.restartFailed = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_failed')}}\", function(data) {\n            if (data.length > 0) {\n                $.each(packages,function(pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.initialize(type);\n}\n\nfunction Package (ui, id, ele){\n    // private variables\n    var linksLoaded = false;\n    var thisObject;\n    var buttons;\n    var name;\n    var password;\n    var folder;\n\n    this.initialize = function () {\n        thisObject = this;\n        if (!ele) {\n            this.createElement();\n        } else {\n            jQuery.data(ele,\"pid\", id);\n            this.parseElement();\n        }\n\n        var pname = $(ele).find('.packagename');\n\n        buttons = $(ele).find('.buttons');\n        buttons.css(\"opacity\", 0);\n\n        $(pname).mouseenter(function(e) {\n            $(this).find('.buttons').fadeTo('fast', 1)\n        });\n\n        $(pname).mouseleave( function(e) {\n            $(this).find('.buttons').fadeTo('fast', 0)\n        });\n    };\n\n    this.createElement = function () {\n        alert(\"create\");\n    };\n\n    this.parseElement = function () {\n        var imgs = $(ele).find('span');\n\n        name = $(ele).find('.name');\n        folder =  $(ele).find('.folder');\n        password = $(ele).find('.password');\n\n        $(imgs[3]).click(this.deletePackage);\n        $(imgs[4]).click(this.restartPackage);\n        $(imgs[5]).click(this.editPackage);\n        $(imgs[6]).click(this.movePackage);\n        $(imgs[7]).click(this.editOrder);\n\n        $(ele).find('.packagename').click(this.toggle);\n    };\n\n    this.loadLinks = function () {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            data: {id: id},\n            traditional: true,\n            success: thisObject.createLinks\n        }).fail(function () {\n            indicateFail();\n            return false;\n        }).done(function() {\n            return true;\n        });\n    };\n\n    this.createLinks = function(data) {\n        var ul = $(\"#sort_children_\" + id[0]);\n        ul.html(\"\");\n        $.each(data.links, function(key, link) {      // data.links.each(\n            link.id = link.fid;\n            var li = document.createElement(\"li\");\n            $(li).css(\"margin-left\",0);\n\n            if (link.status === 0)\n                link.icon = 'glyphicon glyphicon-ok';\n            else if (link.status === 2 || link.status === 3)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status ===  9 || link.status === 1)\n                link.icon = 'glyphicon glyphicon-ban-circle';\n            else if (link.status === 5)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status === 8)\n                link.icon = 'glyphicon glyphicon-exclamation-sign';\n            else if (link.status === 4)\n                link.icon = 'glyphicon glyphicon-arrow-right';\n            else if (link.status ===  11 || link.status === 13)\n                link.icon = 'glyphicon glyphicon-cog';\n            else\n                link.icon = 'glyphicon glyphicon-cloud-download';\n\n            var html = \"<span class='child_status'><span style='margin-right: 2px;color: #337ab7;' class='\" + link.icon + \"'></span></span>\\n\" +\n                       \"<span style='font-size: 16px; font-weight: bold;'><a onclick='return false' href='\" + link.url + \"'>\" + link.name + \"</a></span><br/>\" +\n                       \"<div class='child_secrow' style='margin-left: 21px; margin-bottom: 7px; border-radius: 4px;'>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555; padding-left: 5px;'>\" + link.statusmsg + \"</span>&nbsp;\" + link.error + \"&nbsp;\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555;'>\" + link.format_size + \"</span>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#555;'> \" + link.plugin + \"</span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-trash' title='{{_('Delete Link')}}' style='cursor: pointer;  font-size: 12px; color:#333;' ></span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-repeat' title='{{_('Restart Link')}}' style='cursor: pointer; font-size: 12px; color:#333;' ></span></div>\";\n\n            var div = document.createElement(\"div\");\n            $(div).attr(\"id\", \"file_\" + link.id);\n            $(div).css(\"padding-left\", \"30px\");\n            $(div).css(\"cursor\", \"grab\");\n            $(div).addClass(\"child\");\n            $(div).html(html);\n\n            jQuery.data(li,\"lid\", link.id);\n\n            li.appendChild(div);\n            $(ul)[0].appendChild(li);\n        });\n\n        thisObject.registerLinkEvents();\n        linksLoaded = true;\n        indicateFinish();\n        thisObject.toggle();\n    };\n\n    this.registerLinkEvents = function () {\n        $(ele).find('.children').children('ul').children(\"li\").each(function(child) {\n            var lid = $(this).find('.child').attr('id').match(/[0-9]+/);\n            var imgs = $(this).find('.child_secrow span');\n            $(imgs[3]).bind('click',{ lid: lid}, function(e) {\n                $.get(\"{{url_for('api.rpc', func='delete_files')}}/[\" + lid + \"]\", function () {\n                    $('#file_' + lid).remove()\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n\n            $(imgs[4]).bind('click',{ lid: lid},function(e) {\n                $.get(\"{{url_for('api.rpc', func='restart_file')}}/\" + lid, function () {\n                    var ele1 = $('#file_' + lid);\n                    var imgs1 = $(ele1).find(\".glyphicon\");\n                    $(imgs1[0]).attr( \"class\", \"glyphicon glyphicon-time text-info\");\n                    var spans = $(ele1).find(\".child_status\");\n                    $(spans[1]).html(\"{{_('queued')}}\");\n                    indicateSuccess();\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n        });\n\n\n        $(ele).find('.children').children('ul').sortable({\n            handle: \".child\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(e, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                var newIndex = ui.item.index();\n                var oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.link_order')}}\",\n                    data: {fid: ui.item.data('lid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n            }\n        });\n    };\n\n    this.toggle = function () {\n        var icon = $(ele).find('.packageicon');\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        } else {\n            if (!linksLoaded) {\n                if (!thisObject.loadLinks()) {\n                    return;\n                }\n            } else {\n                $(child).fadeIn();\n            }\n            icon.removeClass('glyphicon-folder-close');\n            icon.addClass('glyphicon-folder-open');\n        }\n    };\n\n    this.deletePackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_packages')}}/[\" + id + \"]\", function () {\n            $(ele).remove();\n            indicateFinish();\n        }).fail(function () {\n            indicateFail();\n        });\n\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.restartPackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_package')}}/\" + id, function () {\n            thisObject.close();\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.close = function () {\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            var icon = $(ele).find('.packageicon');\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        }\n        var ul = $(\"#sort_children_\" + id);\n        $(ul).html(\"\");\n        linksLoaded = false;\n    };\n\n    this.movePackage = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.move_package')}}\",\n            data: {id: id, dest: ((ui.type + 1) % 2)},\n            traditional: true,\n            success: function () {\n                $(ele).remove();\n                indicateFinish();\n            }\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.editOrder = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            success: function(data){\n                length = data.links.length;\n                for (i = 1; i <= length/2; i++){\n                    $.get({\n                        url: \"{{url_for('json.link_order')}}\",\n                        data: {fid: data.links[length-i].fid, pos: i-1},\n                        traditional: true,\n                    }).fail(function () {\n                        indicateFail();\n                    });\n                }\n            }\n        });\n        indicateFinish();\n        thisObject.close();\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n\n    this.editPackage = function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(\"#pack_form\").off(\"submit\").submit(thisObject.savePackage);\n\n        $(\"#pack_id\").val(id[0]);\n        $(\"#pack_name\").val(name.text());\n        $(\"#pack_folder\").val(folder.text());\n        $(\"#pack_pws\").val(password.text());\n        $('#pack_box').modal('show');\n    };\n\n    this.savePackage = function(event) {\n        $.ajax({\n            url: \"{{url_for('json.edit_package')}}\",\n            type: 'post',\n            dataType: 'json',\n            data: $('#pack_form').serialize()\n        });\n        event.preventDefault();\n        name.text( $(\"#pack_name\").val());\n        folder.text( $(\"#pack_folder\").val());\n        password.text($(\"#pack_pws\").val());\n        $('#pack_box').modal('hide');\n    };\n\n    this.initialize();\n}\n\n{% endautoescape %}\n", "{% autoescape true %}\n\nfunction PackageUI (type){\n    var packages = [];\n    var thisObject;\n    this.initialize = function(type) {\n        this.type = type;\n        thisObject = this;\n\n        $(\"#del_finished\").click(this.deleteFinished);\n        $(\"#restart_failed\").click(this.restartFailed);\n        this.parsePackages();\n\n    };\n\n    this.parsePackages = function () {\n       var $packageList = $(\"#package-list\");\n       $packageList.children(\"li\").each(function(ele) {\n            var id = this.id.match(/[0-9]+/);\n            packages.push(new Package(thisObject, id, this));\n        });\n        $packageList.sortable({\n            handle: \".progress\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(event, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                let newIndex = ui.item.index();\n                let oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.package_order')}}\",\n                    data: {pid: ui.item.data('pid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.deleteFinished = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_finished')}}\", function(data) {\n            if (data.length > 0) {\n                window.location.reload();\n            } else {\n                $.each(packages, function (pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.restartFailed = function () {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_failed')}}\", function(data) {\n            if (data.length > 0) {\n                $.each(packages,function(pack) {\n                    this.close();\n                });\n            }\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n    };\n\n    this.initialize(type);\n}\n\nfunction Package (ui, id, ele){\n    // private variables\n    var linksLoaded = false;\n    var thisObject;\n    var buttons;\n    var name;\n    var password;\n    var folder;\n\n    this.initialize = function () {\n        thisObject = this;\n        if (!ele) {\n            this.createElement();\n        } else {\n            jQuery.data(ele,\"pid\", id);\n            this.parseElement();\n        }\n\n        var pname = $(ele).find('.packagename');\n\n        buttons = $(ele).find('.buttons');\n        buttons.css(\"opacity\", 0);\n\n        $(pname).mouseenter(function(e) {\n            $(this).find('.buttons').fadeTo('fast', 1)\n        });\n\n        $(pname).mouseleave( function(e) {\n            $(this).find('.buttons').fadeTo('fast', 0)\n        });\n    };\n\n    this.createElement = function () {\n        alert(\"create\");\n    };\n\n    this.parseElement = function () {\n        var imgs = $(ele).find('span');\n\n        name = $(ele).find('.name');\n        folder =  $(ele).find('.folder');\n        password = $(ele).find('.password');\n\n        $(imgs[3]).click(this.deletePackage);\n        $(imgs[4]).click(this.restartPackage);\n        $(imgs[5]).click(this.editPackage);\n        $(imgs[6]).click(this.movePackage);\n        $(imgs[7]).click(this.editOrder);\n\n        $(ele).find('.packagename').click(this.toggle);\n    };\n\n    this.loadLinks = function () {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            data: {id: id},\n            traditional: true,\n            success: thisObject.createLinks\n        }).fail(function () {\n            indicateFail();\n            return false;\n        }).done(function() {\n            return true;\n        });\n    };\n\n    this.createLinks = function(data) {\n        var ul = $(\"#sort_children_\" + id[0]);\n        ul.html(\"\");\n        $.each(data.links, function(key, link) {      // data.links.each(\n            link.id = link.fid;\n            var li = document.createElement(\"li\");\n            $(li).css(\"margin-left\",0);\n\n            if (link.status === 0)\n                link.icon = 'glyphicon glyphicon-ok';\n            else if (link.status === 2 || link.status === 3)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status ===  9 || link.status === 1)\n                link.icon = 'glyphicon glyphicon-ban-circle';\n            else if (link.status === 5)\n                link.icon = 'glyphicon glyphicon-time';\n            else if (link.status === 8)\n                link.icon = 'glyphicon glyphicon-exclamation-sign';\n            else if (link.status === 4)\n                link.icon = 'glyphicon glyphicon-arrow-right';\n            else if (link.status ===  11 || link.status === 13)\n                link.icon = 'glyphicon glyphicon-cog';\n            else\n                link.icon = 'glyphicon glyphicon-cloud-download';\n\n            var html = \"<span class='child_status'><span style='margin-right: 2px;color: #f9be03;' class='\" + link.icon + \"'></span></span>\\n\" +\n                       \"<span style='font-size: 16px; font-weight: bold;'><a onclick='return false' href='\" + link.url + \"'>\" + link.name + \"</a></span><br/>\" +\n                       \"<div class='child_secrow' style='margin-left: 21px; margin-bottom: 7px; border-radius: 4px;'>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee; padding-left: 5px;'>\" + link.statusmsg + \"</span>&nbsp;\" + link.error + \"&nbsp;\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee;'>\" + link.format_size + \"</span>\" +\n                       \"<span class='child_status' style='font-size: 12px; color:#eee;'> \" + link.plugin + \"</span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-trash' title='{{_('Delete Link')}}' style='cursor: pointer;  font-size: 12px; color:#eee;' ></span>&nbsp;&nbsp;\" +\n                       \"<span class='glyphicon glyphicon-repeat' title='{{_('Restart Link')}}' style='cursor: pointer; font-size: 12px; color:#eee;' ></span></div>\";\n\n            var div = document.createElement(\"div\");\n            $(div).attr(\"id\", \"file_\" + link.id);\n            $(div).css(\"padding-left\", \"30px\");\n            $(div).css(\"cursor\", \"grab\");\n            $(div).addClass(\"child\");\n            $(div).html(html);\n\n            jQuery.data(li,\"lid\", link.id);\n\n            li.appendChild(div);\n            $(ul)[0].appendChild(li);\n        });\n\n        thisObject.registerLinkEvents();\n        linksLoaded = true;\n        indicateFinish();\n        thisObject.toggle();\n    };\n\n    this.registerLinkEvents = function () {\n        $(ele).find('.children').children('ul').children(\"li\").each(function(child) {\n            var lid = $(this).find('.child').attr('id').match(/[0-9]+/);\n            var imgs = $(this).find('.child_secrow span');\n            $(imgs[3]).bind('click',{ lid: lid}, function(e) {\n                $.get(\"{{url_for('api.rpc', func='delete_files')}}/[\" + lid + \"]\", function () {\n                    $('#file_' + lid).remove()\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n\n            $(imgs[4]).bind('click',{ lid: lid},function(e) {\n                $.get(\"{{url_for('api.rpc', func='restart_file')}}/\" + lid, function () {\n                    var ele1 = $('#file_' + lid);\n                    var imgs1 = $(ele1).find(\".glyphicon\");\n                    $(imgs1[0]).attr( \"class\", \"glyphicon glyphicon-time text-info\");\n                    var spans = $(ele1).find(\".child_status\");\n                    $(spans[1]).html(\"{{_('queued')}}\");\n                    indicateSuccess();\n                }).fail(function () {\n                    indicateFail();\n                });\n            });\n        });\n\n\n        $(ele).find('.children').children('ul').sortable({\n            handle: \".child\",\n            axis: \"y\",\n            cursor: \"grabbing\",\n            start: function(e, ui) {\n                $(this).attr('data-previndex', ui.item.index());\n            },\n            stop: function(event, ui) {\n                var newIndex = ui.item.index();\n                var oldIndex = $(this).attr('data-previndex');\n                $(this).removeAttr('data-previndex');\n                if (newIndex === oldIndex) {\n                    return false;\n                }\n                indicateLoad();\n                $.get({\n                    url: \"{{url_for('json.link_order')}}\",\n                    data: {fid: ui.item.data('lid'), pos: newIndex},\n                    traditional: true,\n                    success: function () {\n                        indicateFinish();\n                        return true;\n                    }\n                }).fail(function () {\n                    indicateFail();\n                    return false;\n                });\n          }\n        });\n    };\n\n    this.toggle = function () {\n        var icon = $(ele).find('.packageicon');\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        } else {\n            if (!linksLoaded) {\n                if (!thisObject.loadLinks()) {\n                    return;\n                }\n            } else {\n                $(child).fadeIn();\n            }\n            icon.removeClass('glyphicon-folder-close');\n            icon.addClass('glyphicon-folder-open');\n        }\n    };\n\n    this.deletePackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='delete_packages')}}/[\" + id + \"]\", function () {\n            $(ele).remove();\n            indicateFinish();\n        }).fail(function () {\n            indicateFail();\n        });\n\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.restartPackage = function(event) {\n        indicateLoad();\n        $.get(\"{{url_for('api.rpc', func='restart_package')}}/\" + id, function () {\n            thisObject.close();\n            indicateSuccess();\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.close = function () {\n        var child = $(ele).find('.children');\n        if (child.css('display') === \"block\") {\n            $(child).fadeOut();\n            var icon = $(ele).find('.packageicon');\n            icon.removeClass('glyphicon-folder-open');\n            icon.addClass('glyphicon-folder-close');\n        }\n        var ul = $(\"#sort_children_\" + id);\n        $(ul).html(\"\");\n        linksLoaded = false;\n    };\n\n    this.movePackage = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.move_package')}}\",\n            data: {id: id, dest: ((ui.type + 1) % 2)},\n            traditional: true,\n            success: function () {\n                $(ele).remove();\n                indicateFinish();\n            }\n        }).fail(function () {\n            indicateFail();\n        });\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    this.editOrder = function(event) {\n        indicateLoad();\n        $.get({\n            url: \"{{url_for('json.package')}}\",\n            success: function(data){\n                length = data.links.length;\n                for (i = 1; i <= length/2; i++){\n                    $.get({\n                        url: \"{{url_for('json.link_order')}}\",\n                        data: {fid: data.links[length-i].fid, pos: i-1},\n                        traditional: true,\n                    }).fail(function () {\n                        indicateFail();\n                    });\n                }\n            }\n        });\n        indicateFinish();\n        thisObject.close();\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n\n    this.editPackage = function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(\"#pack_form\").off(\"submit\").submit(thisObject.savePackage);\n\n        $(\"#pack_id\").val(id[0]);\n        $(\"#pack_name\").val(name.text());\n        $(\"#pack_folder\").val(folder.text());\n        $(\"#pack_pws\").val(password.text());\n        $('#pack_box').modal('show');\n    };\n\n    this.savePackage = function(event) {\n        $.ajax({\n            url: \"{{url_for('json.edit_package')}}\",\n            type: 'post',\n            dataType: 'json',\n            data: $('#pack_form').serialize()\n        });\n        event.preventDefault();\n        name.text( $(\"#pack_name\").val());\n        folder.text( $(\"#pack_folder\").val());\n        password.text($(\"#pack_pws\").val());\n        $('#pack_box').modal('hide');\n    };\n\n    this.initialize();\n}\n\n{% endautoescape %}\n"], "filenames": ["src/pyload/webui/app/themes/modern/static/css/base.css", "src/pyload/webui/app/themes/modern/templates/js/packages.js", "src/pyload/webui/app/themes/pyplex/templates/js/packages.js"], "buggy_code_start_loc": [292, 179, 179], "buggy_code_end_loc": [296, 180, 180], "fixing_code_start_loc": [291, 179, 179], "fixing_code_end_loc": [291, 180, 180], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository pyload/pyload prior to 0.5.0b3.dev42.", "other": {"cve": {"id": "CVE-2023-0488", "sourceIdentifier": "security@huntr.dev", "published": "2023-01-26T22:15:26.727", "lastModified": "2023-02-07T17:18:57.647", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository pyload/pyload prior to 0.5.0b3.dev42."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pyload:pyload:*:*:*:*:*:*:*:*", "versionEndExcluding": "2023-01-24", "matchCriteriaId": "C26DFAFC-CA1D-43C9-9A95-AFD844125513"}, {"vulnerable": true, "criteria": "cpe:2.3:a:pyload-ng_project:pyload-ng:*:*:*:*:*:python:*:*", "versionEndExcluding": "0.5.0b3.dev42", "matchCriteriaId": "B3F0A14B-745C-440A-AC98-6DE3C517006F"}]}]}], "references": [{"url": "https://github.com/pyload/pyload/commit/46d75a3087f3237d06530d55998938e2e2bda6bd", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/4311d8d7-682c-4f2a-b92c-3f9f1a36255a", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pyload/pyload/commit/46d75a3087f3237d06530d55998938e2e2bda6bd"}}