{"buggy_code": ["<?php include '../../../wp-load.php'; ?>\n<!DOCTYPE html>\n<!--\n\n    DIASPORA* Advanced Sharer\n       by Bartimeo | bartimeo@joindiaspora.com\n       based on Diaspora* Sharing Service by Jason Robinson | jaywink@iliketoast.net\n       \n       This code is completely free. Don't hesitate to copy, modify or distribute it.\n\n-->\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<title><?php _e( 'Share on Diaspora', 'share-on-diaspora' ); ?></title>\n<style>\nbody{font-family:Helvetica, Helvetica, Arial, sans-serif;font-size:15px;max-height:100%;margin:0;padding:0 0 2em; background: #1b4053; color: #fff}\na{color:#88FFFF;text-decoration:none;-webkit-transition:opacity .1s ease;-moz-transition:opacity .1s ease;-o-transition:opacity .1s ease;transition:opacity .1s ease;cursor:pointer}\na:hover{opacity:.85;text-decoration:underline}\nspan.clear{clear:both;display:block}\nheader{background-color:#222;-webkit-box-shadow:0 0 2px #777;-moz-box-shadow:0 0 2px #777;box-shadow:0 0 2px #777;filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=rgb(35,30,30),endColorstr=#231e1e);-ms-filter:\"progid:DXImageTransform.Microsoft.gradient (GradientType=0, startColorstr=rgba(35, 30, 30, 0.95), endColorstr=#231e1e)\";background-image:0 0 100%;color:#dadada;padding:8px 10px}\nheader h2{float:left;font-size:inherit;font-weight:inherit;border-right:1px solid #aaa;margin:0;padding:.6em 20px .6em 10px}\nheader #sharedet{text-align:center;width:auto;margin:0}\nheader #sharedet div{display:block;height:1.2em;max-height:1.2em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;color:#fafafa;padding:0 10px 0 20px}\nheader #sharedet #sharetitle{font-weight:700}\nsection{width:auto;float:left;margin:10px 0 0;padding:0 20px}\nsection h3{font-size:inherit;font-weight:inherit;color:#88FFFF}\nsection#podlist{border-right:1px solid #ccc;min-width:200px}\nsection#podlist a{display:block;border:1px solid #eee;text-decoration:none;color:#444;-webkit-transition:border .2s ease, color .2s ease;-moz-transition:border .2s ease, color .2s ease;-o-transition:border .2s ease, color .2s ease;transition:border .2s ease, color .2s ease;margin:0 0 6px;padding:3px 6px}\nsection#podlist a.lastpod{color:#fff;border-color:#bbcad0}\nsection#podlist a:hover{border:1px solid #888;color:#000}\n#podurl{width:200px;font-size:15px;border:1px solid silver;-webkit-transition:.1s border-color ease;-moz-transition:1s border-color ease;-o-transition:.1s border-color ease;transition:1s border-color ease;margin:0;padding:3px 6px;background: #82A6B6;color:white;} \n#podurlsm{margin:6px 0 0;padding:4px 10px}\n#sharetitle{display:block;width:100%;height:1.2em;text-align:center;border:1px solid silver;-webkit-transition:.1s border-color ease;-moz-transition:1s border-color ease;-o-transition:.1s border-color ease;transition:1s border-color ease;background: #82A6B6;color:white;resize: none;}\n#sharepodlist{background:#82A6B6;width:268px;padding:5px;font-size:16px;line-height:1;border:0;border-radius:0;height:34px;transition:1s border-color ease;color:#fff}\n#podurl:focus, #sharetitle:focus, #sharepodlist:focus{border:1px solid #ff0000}\n:focus{outline:none}\ninput.error,input#podurl.error{border:1px solid #a00}\nspan.check{display:inline-block;background:#f5f5f5;margin:10px 6px 3px;border:1px solid #eee;padding-left:3px}\nspan.check label{display:inline-block;font-size:14px;-webkit-transition:color .2s ease;-moz-transition:color .2s ease;-o-transition:color .2s ease;transition:color .2s ease;padding:5px 6px 4px 0}\ndiv.bot_opt{position:fixed;bottom:0;height:1.6em;border-top:1px solid #eee;left:0;right:0;width:auto;background:#82A6B6}div.bot_opt label{display:inline-block;width:auto;left:0;right:0;position:absolute;padding-left:1.6em;top:0;bottom:0;height:auto;-webkit-transition:color .2s ease;-moz-transition:color .2s ease;-o-transition:color .2s ease;transition:color .2s ease;margin:0}.advanced{padding:10px 0 0 20px}#contopt{apadding-top:6px;line-height:1.2em}#contopt input[type=checkbox]{margin-left:0}a.openao,.opttit{font-size:13px}section#podlist a.hidepod,.hideopt{display:none}span.check input:checked + label,div.bot_opt :checked + label{color:#060}\n</style>\n\n<script type=\"text/javascript\">\nfunction extras(a) {\n    var b = document.getElementById(\"remember\").checked;\n    var c = document.getElementById(\"markdown\").checked;\n    var d = document.getElementById(\"shorten\").checked;\n    var e = document.getElementById(\"norem\").checked;\n    if (b) {\n        localStorage[\"remember\"] = \"true\";\n        if (e) {\n            localStorage[\"lastPod\"] = a\n        }\n    } else {\n        localStorage[\"remember\"] = \"false\"\n    }\n    if (d) {\n        var f = new XMLHttpRequest;\n        f.open(\"GET\", \"http://api.bitly.com/v3/shorten?login=bartimeo&apiKey=R_5fe8386a052e3f3d6ece604eab0c59db&format=txt&domain=j.mp&longUrl=\" + url);\n        f.onreadystatechange = function() {\n            if (f.readyState == 4) {\n                if (f.status == 200) {\n                    console.log(f.responseText);\n                    url = f.responseText\n                } else {\n                    console.log(\"Problem?\", f)\n                }\n            }\n        };\n        f.send()\n    }\n    if (!e) {\n        recuerda(a)\n    } else {\n        localStorage[\"forget\"] = \"true\"\n    }\n    return true\n}\n\nfunction forget(a) {\n    localStorage.removeItem(\"lastPod\");\n    localStorage.removeItem(\"lastPod2\");\n    localStorage.removeItem(\"lastPod3\");\n    var b = document.getElementsByClassName(\"hidepod\");\n    for (i = 0; i < b.length; i++) {\n        b[i].className = \"dpod\"\n    }\n    var c = document.getElementsByClassName(\"lastpod\");\n    for (j = 0; j < c.length; j++) {\n        c[j].parentNode.removeChild(c[j])\n    }\n    if ((document.getElementsByClassName(\"hidepod\") || document.getElementsByClassName(\"lastpod\")) && !a) {\n        forget(\"again\")\n    }\n}\n\nfunction share(a) {\n    title = document.getElementById(\"sharetitle\").value;\n    if (a !== \"\") {\n        extras(a);\n        var b = \"http://\" + a + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n        if (notes !== \"\") {\n            b += \"&notes=\" + encodeURIComponent(notes)\n        }\n        b += \"&jump=doclose\";\n        location.href = b\n    } else {\n        document.getElementById(\"podurl\").className = \"error\"\n    }\n}\n\nfunction recuerda(a) {\n    if (localStorage[\"lastPod\"] && localStorage[\"lastPod\"] !== a) {\n        if (localStorage[\"lastPod2\"] && localStorage[\"lastPod2\"] !== a) {\n            localStorage[\"lastPod3\"] = localStorage[\"lastPod2\"]\n        }\n        localStorage[\"lastPod2\"] = localStorage[\"lastPod\"]\n    }\n    localStorage[\"lastPod\"] = a;\n    return true\n}\n\nfunction updlinks() {\n    var a = document.getElementsByClassName(\"dpod\");\n    for (i = 0; i < a.length; i++) {\n        var b = \"http://\" + a[i].title + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n        if (notes !== \"\") {\n            b += \"&notes=\" + encodeURIComponent(notes)\n        }\n        b += \"&jump=doclose\";\n        a[i].href = b;\n        a[i].onclick = function() {\n            extras(this.title)\n        }\n    }\n}\n\nfunction crealinks() {\n    var a = document.getElementsByClassName(\"dpod\");\n    if (localStorage[\"forget\"] === \"true\") {\n        document.getElementById(\"norem\").checked = \"checked\"\n    } else {\n        if (localStorage[\"lastPod\"]) {\n            var b = localStorage[\"lastPod\"];\n            var c = document.createElement(\"a\");\n            c.className = \"dpod lastpod\";\n            c.title = b;\n            if (document.getElementsByTagName(\"body\")[0].innerText) {\n                c.innerText = b\n            } else {\n                c.textContent = b\n            }\n            for (i = 0; i < a.length; i++) {\n                if (a[i].title === b) {\n                    a[i].className = \"dpod hidepod\"\n                }\n            }\n            document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"));\n            if (localStorage[\"lastPod2\"]) {\n                var b = localStorage[\"lastPod2\"];\n                var c = document.createElement(\"a\");\n                c.className = \"dpod lastpod\";\n                c.title = b;\n                if (document.getElementsByTagName(\"body\")[0].innerText) {\n                    c.innerText = b\n                } else {\n                    c.textContent = b\n                }\n                for (i = 0; i < a.length; i++) {\n                    if (a[i].title === b) {\n                        a[i].className = \"dpod hidepod\"\n                    }\n                }\n                document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"));\n                if (localStorage[\"lastPod3\"]) {\n                    var b = localStorage[\"lastPod3\"];\n                    var c = document.createElement(\"a\");\n                    c.className = \"dpod lastpod\";\n                    c.title = b;\n                    if (document.getElementsByTagName(\"body\")[0].innerText) {\n                        c.innerText = b\n                    } else {\n                        c.textContent = b\n                    }\n                    for (i = 0; i < a.length; i++) {\n                        if (a[i].title === b) {\n                            a[i].className = \"dpod hidepod\"\n                        }\n                    }\n                    document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"))\n                }\n            }\n        }\n    }\n    updlinks();\n    document.getElementById(\"openao\").onclick = function() {\n        document.getElementById(\"contopt\").className = \"showopt\";\n        document.getElementById(\"openao\").style.display = \"none\"\n    };\n    document.getElementById(\"delete\").onclick = function() {\n        forget()\n    };\n    document.getElementById(\"markdown\").onchange = function() {\n        if (document.getElementById(\"markdown\").checked) {\n            title = \"[\" + title + \"](\" + url + \")\";\n            url = \" \"\n        } else {\n            title = oldtit;\n            url = oldurl\n        }\n        updlinks()\n    };\n    document.getElementById(\"shorten\").onchange = function() {\n        if (document.getElementById(\"shorten\").checked) {\n            var a = new XMLHttpRequest;\n            a.open(\"GET\", \"http://api.bitly.com/v3/shorten?login=bartimeo&apiKey=R_5fe8386a052e3f3d6ece604eab0c59db&format=txt&domain=j.mp&longUrl=\" + url);\n            a.onreadystatechange = function() {\n                if (a.readyState == 4) {\n                    if (a.status == 200) {\n                        console.log(a.responseText);\n                        shurl = decodeURIComponent(encodeURIComponent(a.responseText).replace(\"%0A\", \"\"));\n                        if (document.getElementById(\"markdown\").checked) {\n                            title = \"[\" + oldtitle + \"](\" + shurl + \")\";\n                            url = \" \"\n                        } else {\n                            url = shurl\n                        }\n                        updlinks()\n                    } else {\n                        console.log(\"Problem?\", a)\n                    }\n                }\n            };\n            a.send()\n        } else {\n            if (document.getElementById(\"markdown\").checked) {\n                title = \"[\" + oldtitle + \"](\" + oldurl + \")\";\n                url = \" \"\n            } else {\n                title = oldtit;\n                url = oldurl\n            }\n            updlinks()\n        }\n    }\n}\n\nfunction redirect() {\n    if (title === \"\" && url === \"\") {\n        document.getElementsByTagName(\"body\")[0].innerHTML = \"\";\n        location.href = \"about\"\n    } else {\n        if (localStorage[\"remember\"] && localStorage[\"remember\"] === \"true\" && localStorage[\"lastPod\"] && redir !== \"false\") {\n            document.getElementsByTagName('body')[0].innerHTML = \"Sharing <b>\" + title + \"</b> (\" + url + \") to \" + localStorage[\"lastPod\"];\n            var a = \"http://\" + localStorage[\"lastPod\"] + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n            if (notes !== \"\") {\n                a += \"&notes=\" + encodeURIComponent(notes)\n            }\n            a += \"&jump=doclose\";\n            location.href = a;\n            return true\n        } else {\n            document.getElementById(\"sharetitle\").value = title;\n            document.getElementById(\"shareurl\").innerHTML = url;\n            crealinks();\n            return false\n        }\n    }\n}\n\nfunction par(a) {\n    var b = \"[\\\\?&]\" + a + \"=([^&]*)\";\n    var c = new RegExp(b);\n    var d = window.location.href;\n    var e = c.exec(d);\n    if (e == null) return \"\";\n    else return e[1]\n}\nvar title = decodeURIComponent(par(\"title\"));\nvar url = decodeURIComponent(par(\"url\"));\nvar notes = decodeURIComponent(par(\"notes\"));\nvar redir = decodeURIComponent(par(\"redirect\"));\nvar oldtit = title;\nvar oldurl = url;\nvar oldnot = notes;\nwindow.onload = function() {\n    redirect()\n}\n</script>\n</head>\n<body>\n<header>\n<h2><?php _e( 'Sharing', 'share-on-diaspora' ); ?></h2>\n<div id=sharedet>\n    <div><textarea id=sharetitle></textarea></div>\n    <div id=shareurl></div>\n</div>\n</header>\n<section id=podlist><h3><?php _e( 'Choose your Diaspora* pod', 'share-on-diaspora' ); ?></h3>\n<select id=sharepodlist onchange=\"share(this.options[this.selectedIndex].value)\">\n<option>- <?php _e( 'Select from the list', 'share-on-diaspora' ); ?> -</option>\n<?php\n$options_array = get_option( 'share-on-diaspora-settings' );\n$podlist = array_keys( $options_array['podlist'] );\n$podlist_all_array = get_option( 'dpu-podlist' );\nif ( $podlist_all_array && ! empty( $podlist_all_array ) ) {\n\t//DPU plugin active, podlist not empty\n\t$podlist_all = $podlist_all_array;\n}\nelseif ( ! empty( $options_array['podlist-all'] ) ) {\n\t//DPU not active, but we can use $options_array['podlist-all']\n\t$podlist_all = $options_array['podlist-all'];\n}\nelse {\n\t$podlist_all = array('example.com');\n}\n$podlist_all_keys = array_keys( $podlist_all );\nforeach ( $podlist as &$i ) {\n\tprint '<option  value=\"' . $i .'\" class=dpod title=\"'.$i.'\">'.$i.'</option>';\n}\n?>\n</select>\n<h3><?php _e( 'or choose from history', 'share-on-diaspora' ); ?></h3>\n</section>\n<section id=podinput><h3><?php _e( 'or introduce your pod URL', 'share-on-diaspora' ); ?></h3><form onsubmit=\"var url = document.getElementById('podurl').value; url = url.replace(/.*?:\\/\\//g, ''); share(url); return false\"><input id=podurl placeholder=\"<?php echo(sprintf( __( 'Example: %s', 'share-on-diaspora' ), $podlist_all[array_rand( $podlist_all_keys )] )); ?>\" type=\"text\" list=\"datalist1\" autocomplete=\"on\"/>\n<datalist id=\"datalist1\">\n<?php\nforeach ( $podlist_all as $value ) {\n\tprint '<option>' . $value . '</option>';\n}\n?>\n</datalist><br><input type=submit id=podurlsm value=\"<?php _e( 'Share', 'share-on-diaspora' ); ?>\"></form><hr>\n<small>by <a href=\"http://wordpress.org/plugins/share-on-diaspora/\">Share on Diaspora</a> plugin for <a href=\"http://wordpress.org/\">WordPress</a>.</small></section><span class=clear></span><div class=bot_opt><input type=checkbox id=remember><label for=remember><?php _e( \"Remember my choice, don't ask again\", 'share-on-diaspora' ); ?></label></div><div class=advanced><a class=openao id=openao><?php _e( 'Advanced options', 'share-on-diaspora' ); ?></a><div class=hideopt id=contopt><span class=opttit><?php _e( 'Advanced options', 'share-on-diaspora' ); ?></span><br><input type=checkbox id=markdown><label for=markdown><?php _e( 'Use Markdown syntax for link', 'share-on-diaspora' ); ?></label><br><input type=checkbox id=shorten><label for=shorten><?php _e( 'Shorten URL (j.mp)', 'share-on-diaspora' ); ?></label><br><input type=checkbox id=norem><label for=norem><?php _e( 'Never remember my last 3 pods', 'share-on-diaspora' ); ?></label><br><a class=delete id=delete><?php _e( 'Forget my last 3 pods', 'share-on-diaspora' ); ?></a></div></div>\n</body>\n</html>\n"], "fixing_code": ["<?php include '../../../wp-load.php'; ?>\n<!DOCTYPE html>\n<!--\n\n    DIASPORA* Advanced Sharer\n       by Bartimeo | bartimeo@joindiaspora.com\n       based on Diaspora* Sharing Service by Jason Robinson | jaywink@iliketoast.net\n       \n       This code is completely free. Don't hesitate to copy, modify or distribute it.\n\n-->\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<title><?php _e( 'Share on Diaspora', 'share-on-diaspora' ); ?></title>\n<style>\nbody{font-family:Helvetica, Helvetica, Arial, sans-serif;font-size:15px;max-height:100%;margin:0;padding:0 0 2em; background: #1b4053; color: #fff}\na{color:#88FFFF;text-decoration:none;-webkit-transition:opacity .1s ease;-moz-transition:opacity .1s ease;-o-transition:opacity .1s ease;transition:opacity .1s ease;cursor:pointer}\na:hover{opacity:.85;text-decoration:underline}\nspan.clear{clear:both;display:block}\nheader{background-color:#222;-webkit-box-shadow:0 0 2px #777;-moz-box-shadow:0 0 2px #777;box-shadow:0 0 2px #777;filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=rgb(35,30,30),endColorstr=#231e1e);-ms-filter:\"progid:DXImageTransform.Microsoft.gradient (GradientType=0, startColorstr=rgba(35, 30, 30, 0.95), endColorstr=#231e1e)\";background-image:0 0 100%;color:#dadada;padding:8px 10px}\nheader h2{float:left;font-size:inherit;font-weight:inherit;border-right:1px solid #aaa;margin:0;padding:.6em 20px .6em 10px}\nheader #sharedet{text-align:center;width:auto;margin:0}\nheader #sharedet div{display:block;height:1.2em;max-height:1.2em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;color:#fafafa;padding:0 10px 0 20px}\nheader #sharedet #sharetitle{font-weight:700}\nsection{width:auto;float:left;margin:10px 0 0;padding:0 20px}\nsection h3{font-size:inherit;font-weight:inherit;color:#88FFFF}\nsection#podlist{border-right:1px solid #ccc;min-width:200px}\nsection#podlist a{display:block;border:1px solid #eee;text-decoration:none;color:#444;-webkit-transition:border .2s ease, color .2s ease;-moz-transition:border .2s ease, color .2s ease;-o-transition:border .2s ease, color .2s ease;transition:border .2s ease, color .2s ease;margin:0 0 6px;padding:3px 6px}\nsection#podlist a.lastpod{color:#fff;border-color:#bbcad0}\nsection#podlist a:hover{border:1px solid #888;color:#000}\n#podurl{width:200px;font-size:15px;border:1px solid silver;-webkit-transition:.1s border-color ease;-moz-transition:1s border-color ease;-o-transition:.1s border-color ease;transition:1s border-color ease;margin:0;padding:3px 6px;background: #82A6B6;color:white;} \n#podurlsm{margin:6px 0 0;padding:4px 10px}\n#sharetitle{display:block;width:100%;height:1.2em;text-align:center;border:1px solid silver;-webkit-transition:.1s border-color ease;-moz-transition:1s border-color ease;-o-transition:.1s border-color ease;transition:1s border-color ease;background: #82A6B6;color:white;resize: none;}\n#sharepodlist{background:#82A6B6;width:268px;padding:5px;font-size:16px;line-height:1;border:0;border-radius:0;height:34px;transition:1s border-color ease;color:#fff}\n#podurl:focus, #sharetitle:focus, #sharepodlist:focus{border:1px solid #ff0000}\n:focus{outline:none}\ninput.error,input#podurl.error{border:1px solid #a00}\nspan.check{display:inline-block;background:#f5f5f5;margin:10px 6px 3px;border:1px solid #eee;padding-left:3px}\nspan.check label{display:inline-block;font-size:14px;-webkit-transition:color .2s ease;-moz-transition:color .2s ease;-o-transition:color .2s ease;transition:color .2s ease;padding:5px 6px 4px 0}\ndiv.bot_opt{position:fixed;bottom:0;height:1.6em;border-top:1px solid #eee;left:0;right:0;width:auto;background:#82A6B6}div.bot_opt label{display:inline-block;width:auto;left:0;right:0;position:absolute;padding-left:1.6em;top:0;bottom:0;height:auto;-webkit-transition:color .2s ease;-moz-transition:color .2s ease;-o-transition:color .2s ease;transition:color .2s ease;margin:0}.advanced{padding:10px 0 0 20px}#contopt{apadding-top:6px;line-height:1.2em}#contopt input[type=checkbox]{margin-left:0}a.openao,.opttit{font-size:13px}section#podlist a.hidepod,.hideopt{display:none}span.check input:checked + label,div.bot_opt :checked + label{color:#060}\n</style>\n\n<script type=\"text/javascript\">\n// Use to prevent XSS\n// Code from http://shebang.brandonmintern.com/foolproof-html-escaping-in-javascript/\n// Use the browser's built-in functionality to quickly and safely escape\n// the string\nfunction escapeHtml(str) {\n    var div = document.createElement('div');\n    div.appendChild(document.createTextNode(str));\n    return div.innerHTML;\n}\n\nfunction extras(a) {\n    var b = document.getElementById(\"remember\").checked;\n    var c = document.getElementById(\"markdown\").checked;\n    var d = document.getElementById(\"shorten\").checked;\n    var e = document.getElementById(\"norem\").checked;\n    if (b) {\n        localStorage[\"remember\"] = \"true\";\n        if (e) {\n            localStorage[\"lastPod\"] = a\n        }\n    } else {\n        localStorage[\"remember\"] = \"false\"\n    }\n    if (d) {\n        var f = new XMLHttpRequest;\n        f.open(\"GET\", \"http://api.bitly.com/v3/shorten?login=bartimeo&apiKey=R_5fe8386a052e3f3d6ece604eab0c59db&format=txt&domain=j.mp&longUrl=\" + url);\n        f.onreadystatechange = function() {\n            if (f.readyState == 4) {\n                if (f.status == 200) {\n                    console.log(f.responseText);\n                    url = f.responseText\n                } else {\n                    console.log(\"Problem?\", f)\n                }\n            }\n        };\n        f.send()\n    }\n    if (!e) {\n        recuerda(a)\n    } else {\n        localStorage[\"forget\"] = \"true\"\n    }\n    return true\n}\n\nfunction forget(a) {\n    localStorage.removeItem(\"lastPod\");\n    localStorage.removeItem(\"lastPod2\");\n    localStorage.removeItem(\"lastPod3\");\n    var b = document.getElementsByClassName(\"hidepod\");\n    for (i = 0; i < b.length; i++) {\n        b[i].className = \"dpod\"\n    }\n    var c = document.getElementsByClassName(\"lastpod\");\n    for (j = 0; j < c.length; j++) {\n        c[j].parentNode.removeChild(c[j])\n    }\n    if ((document.getElementsByClassName(\"hidepod\") || document.getElementsByClassName(\"lastpod\")) && !a) {\n        forget(\"again\")\n    }\n}\n\nfunction share(a) {\n    title = document.getElementById(\"sharetitle\").value;\n    if (a !== \"\") {\n        extras(a);\n        var b = \"http://\" + a + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n        if (notes !== \"\") {\n            b += \"&notes=\" + encodeURIComponent(notes)\n        }\n        b += \"&jump=doclose\";\n        location.href = b\n    } else {\n        document.getElementById(\"podurl\").className = \"error\"\n    }\n}\n\nfunction recuerda(a) {\n    if (localStorage[\"lastPod\"] && localStorage[\"lastPod\"] !== a) {\n        if (localStorage[\"lastPod2\"] && localStorage[\"lastPod2\"] !== a) {\n            localStorage[\"lastPod3\"] = localStorage[\"lastPod2\"]\n        }\n        localStorage[\"lastPod2\"] = localStorage[\"lastPod\"]\n    }\n    localStorage[\"lastPod\"] = a;\n    return true\n}\n\nfunction updlinks() {\n    var a = document.getElementsByClassName(\"dpod\");\n    for (i = 0; i < a.length; i++) {\n        var b = \"http://\" + a[i].title + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n        if (notes !== \"\") {\n            b += \"&notes=\" + encodeURIComponent(notes)\n        }\n        b += \"&jump=doclose\";\n        a[i].href = b;\n        a[i].onclick = function() {\n            extras(this.title)\n        }\n    }\n}\n\nfunction crealinks() {\n    var a = document.getElementsByClassName(\"dpod\");\n    if (localStorage[\"forget\"] === \"true\") {\n        document.getElementById(\"norem\").checked = \"checked\"\n    } else {\n        if (localStorage[\"lastPod\"]) {\n            var b = localStorage[\"lastPod\"];\n            var c = document.createElement(\"a\");\n            c.className = \"dpod lastpod\";\n            c.title = b;\n            if (document.getElementsByTagName(\"body\")[0].innerText) {\n                c.innerText = b\n            } else {\n                c.textContent = b\n            }\n            for (i = 0; i < a.length; i++) {\n                if (a[i].title === b) {\n                    a[i].className = \"dpod hidepod\"\n                }\n            }\n            document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"));\n            if (localStorage[\"lastPod2\"]) {\n                var b = localStorage[\"lastPod2\"];\n                var c = document.createElement(\"a\");\n                c.className = \"dpod lastpod\";\n                c.title = b;\n                if (document.getElementsByTagName(\"body\")[0].innerText) {\n                    c.innerText = b\n                } else {\n                    c.textContent = b\n                }\n                for (i = 0; i < a.length; i++) {\n                    if (a[i].title === b) {\n                        a[i].className = \"dpod hidepod\"\n                    }\n                }\n                document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"));\n                if (localStorage[\"lastPod3\"]) {\n                    var b = localStorage[\"lastPod3\"];\n                    var c = document.createElement(\"a\");\n                    c.className = \"dpod lastpod\";\n                    c.title = b;\n                    if (document.getElementsByTagName(\"body\")[0].innerText) {\n                        c.innerText = b\n                    } else {\n                        c.textContent = b\n                    }\n                    for (i = 0; i < a.length; i++) {\n                        if (a[i].title === b) {\n                            a[i].className = \"dpod hidepod\"\n                        }\n                    }\n                    document.getElementById(\"podlist\").insertBefore(c, document.getElementById(\"first\"))\n                }\n            }\n        }\n    }\n    updlinks();\n    document.getElementById(\"openao\").onclick = function() {\n        document.getElementById(\"contopt\").className = \"showopt\";\n        document.getElementById(\"openao\").style.display = \"none\"\n    };\n    document.getElementById(\"delete\").onclick = function() {\n        forget()\n    };\n    document.getElementById(\"markdown\").onchange = function() {\n        if (document.getElementById(\"markdown\").checked) {\n            title = \"[\" + title + \"](\" + url + \")\";\n            url = \" \"\n        } else {\n            title = oldtit;\n            url = oldurl\n        }\n        updlinks()\n    };\n    document.getElementById(\"shorten\").onchange = function() {\n        if (document.getElementById(\"shorten\").checked) {\n            var a = new XMLHttpRequest;\n            a.open(\"GET\", \"http://api.bitly.com/v3/shorten?login=bartimeo&apiKey=R_5fe8386a052e3f3d6ece604eab0c59db&format=txt&domain=j.mp&longUrl=\" + url);\n            a.onreadystatechange = function() {\n                if (a.readyState == 4) {\n                    if (a.status == 200) {\n                        console.log(a.responseText);\n                        shurl = decodeURIComponent(encodeURIComponent(a.responseText).replace(\"%0A\", \"\"));\n                        if (document.getElementById(\"markdown\").checked) {\n                            title = \"[\" + oldtitle + \"](\" + shurl + \")\";\n                            url = \" \"\n                        } else {\n                            url = shurl\n                        }\n                        updlinks()\n                    } else {\n                        console.log(\"Problem?\", a)\n                    }\n                }\n            };\n            a.send()\n        } else {\n            if (document.getElementById(\"markdown\").checked) {\n                title = \"[\" + oldtitle + \"](\" + oldurl + \")\";\n                url = \" \"\n            } else {\n                title = oldtit;\n                url = oldurl\n            }\n            updlinks()\n        }\n    }\n}\n\nfunction redirect() {\n    if (title === \"\" && url === \"\") {\n        document.getElementsByTagName(\"body\")[0].innerHTML = \"\";\n        location.href = \"about\"\n    } else {\n        if (localStorage[\"remember\"] && localStorage[\"remember\"] === \"true\" && localStorage[\"lastPod\"] && redir !== \"false\") {\n            document.getElementsByTagName('body')[0].innerHTML = \"Sharing <b>\" + escapeHtml(title) + \"</b> (\" + escapeHtml(url) + \") to \" + escapeHtml(localStorage[\"lastPod\"]);\n            var a = \"http://\" + localStorage[\"lastPod\"] + \"/bookmarklet?url=\" + encodeURIComponent(url) + \"&title=\" + encodeURIComponent(title);\n            if (notes !== \"\") {\n                a += \"&notes=\" + encodeURIComponent(notes)\n            }\n            a += \"&jump=doclose\";\n            location.href = a;\n            return true\n        } else {\n            document.getElementById(\"sharetitle\").value = title;\n            document.getElementById(\"shareurl\").innerHTML = escapeHtml(url);\n            crealinks();\n            return false\n        }\n    }\n}\n\nfunction par(a) {\n    var b = \"[\\\\?&]\" + a + \"=([^&]*)\";\n    var c = new RegExp(b);\n    var d = window.location.href;\n    var e = c.exec(d);\n    if (e == null) return \"\";\n    else return e[1]\n}\nvar title = decodeURIComponent(par(\"title\"));\nvar url = decodeURIComponent(par(\"url\"));\nvar notes = decodeURIComponent(par(\"notes\"));\nvar redir = decodeURIComponent(par(\"redirect\"));\nvar oldtit = title;\nvar oldurl = url;\nvar oldnot = notes;\nwindow.onload = function() {\n    redirect()\n}\n</script>\n</head>\n<body>\n<header>\n<h2><?php _e( 'Sharing', 'share-on-diaspora' ); ?></h2>\n<div id=sharedet>\n    <div><textarea id=sharetitle></textarea></div>\n    <div id=shareurl></div>\n</div>\n</header>\n<section id=podlist><h3><?php _e( 'Choose your Diaspora* pod', 'share-on-diaspora' ); ?></h3>\n<select id=sharepodlist onchange=\"share(this.options[this.selectedIndex].value)\">\n<option>- <?php _e( 'Select from the list', 'share-on-diaspora' ); ?> -</option>\n<?php\n$options_array = get_option( 'share-on-diaspora-settings' );\n$podlist = array_keys( $options_array['podlist'] );\n$podlist_all_array = get_option( 'dpu-podlist' );\nif ( $podlist_all_array && ! empty( $podlist_all_array ) ) {\n\t//DPU plugin active, podlist not empty\n\t$podlist_all = $podlist_all_array;\n}\nelseif ( ! empty( $options_array['podlist-all'] ) ) {\n\t//DPU not active, but we can use $options_array['podlist-all']\n\t$podlist_all = $options_array['podlist-all'];\n}\nelse {\n\t$podlist_all = array('example.com');\n}\n$podlist_all_keys = array_keys( $podlist_all );\nforeach ( $podlist as &$i ) {\n\tprint '<option  value=\"' . $i .'\" class=dpod title=\"'.$i.'\">'.$i.'</option>';\n}\n?>\n</select>\n<h3><?php _e( 'or choose from history', 'share-on-diaspora' ); ?></h3>\n</section>\n<section id=podinput><h3><?php _e( 'or introduce your pod URL', 'share-on-diaspora' ); ?></h3><form onsubmit=\"var url = document.getElementById('podurl').value; url = url.replace(/.*?:\\/\\//g, ''); share(url); return false\"><input id=podurl placeholder=\"<?php echo(sprintf( __( 'Example: %s', 'share-on-diaspora' ), $podlist_all[array_rand( $podlist_all_keys )] )); ?>\" type=\"text\" list=\"datalist1\" autocomplete=\"on\"/>\n<datalist id=\"datalist1\">\n<?php\nforeach ( $podlist_all as $value ) {\n\tprint '<option>' . $value . '</option>';\n}\n?>\n</datalist><br><input type=submit id=podurlsm value=\"<?php _e( 'Share', 'share-on-diaspora' ); ?>\"></form><hr>\n<small>by <a href=\"http://wordpress.org/plugins/share-on-diaspora/\">Share on Diaspora</a> plugin for <a href=\"http://wordpress.org/\">WordPress</a>.</small></section><span class=clear></span><div class=bot_opt><input type=checkbox id=remember><label for=remember><?php _e( \"Remember my choice, don't ask again\", 'share-on-diaspora' ); ?></label></div><div class=advanced><a class=openao id=openao><?php _e( 'Advanced options', 'share-on-diaspora' ); ?></a><div class=hideopt id=contopt><span class=opttit><?php _e( 'Advanced options', 'share-on-diaspora' ); ?></span><br><input type=checkbox id=markdown><label for=markdown><?php _e( 'Use Markdown syntax for link', 'share-on-diaspora' ); ?></label><br><input type=checkbox id=shorten><label for=shorten><?php _e( 'Shorten URL (j.mp)', 'share-on-diaspora' ); ?></label><br><input type=checkbox id=norem><label for=norem><?php _e( 'Never remember my last 3 pods', 'share-on-diaspora' ); ?></label><br><a class=delete id=delete><?php _e( 'Forget my last 3 pods', 'share-on-diaspora' ); ?></a></div></div>\n</body>\n</html>\n"], "filenames": ["trunk/new_window.php"], "buggy_code_start_loc": [44], "buggy_code_end_loc": [266], "fixing_code_start_loc": [45], "fixing_code_end_loc": [276], "type": "CWE-79", "message": "A vulnerability classified as problematic was found in ciubotaru share-on-diaspora 0.7.9. This vulnerability affects unknown code of the file new_window.php. The manipulation of the argument title/url leads to cross site scripting. The attack can be initiated remotely. The name of the patch is fb6fae2f8a9b146471450b5b0281046a17d1ac8d. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-220204.", "other": {"cve": {"id": "CVE-2017-20176", "sourceIdentifier": "cna@vuldb.com", "published": "2023-02-06T04:15:08.043", "lastModified": "2023-02-12T04:54:40.900", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic was found in ciubotaru share-on-diaspora 0.7.9. This vulnerability affects unknown code of the file new_window.php. The manipulation of the argument title/url leads to cross site scripting. The attack can be initiated remotely. The name of the patch is fb6fae2f8a9b146471450b5b0281046a17d1ac8d. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-220204."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:share_on_diaspora_project:share_on_diaspora:0.7.9:*:*:*:*:wordpress:*:*", "matchCriteriaId": "481E13E0-A1E7-4E08-933F-E91DCFCDC7D8"}]}]}], "references": [{"url": "https://github.com/ciubotaru/share-on-diaspora/commit/fb6fae2f8a9b146471450b5b0281046a17d1ac8d", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.220204", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.220204", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ciubotaru/share-on-diaspora/commit/fb6fae2f8a9b146471450b5b0281046a17d1ac8d"}}