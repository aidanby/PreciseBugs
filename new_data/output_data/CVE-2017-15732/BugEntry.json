{"buggy_code": ["<?php\n/**\n * The main administration file for the news.\n *\n * PHP Version 5.5\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @category  phpMyFAQ\n *\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>\n * @copyright 2003-2017 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n *\n * @link      http://www.phpmyfaq.de\n * @since     2003-02-23\n */\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    $protocol = 'http';\n    if (isset($_SERVER['HTTPS']) && strtoupper($_SERVER['HTTPS']) === 'ON') {\n        $protocol = 'https';\n    }\n    header('Location: '.$protocol.'://'.$_SERVER['HTTP_HOST'].dirname($_SERVER['SCRIPT_NAME']));\n    exit();\n}\n\n$news = new PMF_News($faqConfig);\n\nif ('addnews' == $action && $user->perm->checkRight($user->getUserId(), 'addnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_add'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <form class=\"form-horizontal\" id=\"faqEditor\" name=\"faqEditor\" action=\"?action=savenews\" method=\"post\" accept-charset=\"utf-8\">\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"newsheader\">\n                            <?php echo $PMF_LANG['ad_news_header'];\n    ?>\n                        </label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"text\" name=\"newsheader\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"news\"><?php echo $PMF_LANG['ad_news_text'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea name=\"news\" rows=\"5\" class=\"form-control\"></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorName\"><?php echo $PMF_LANG['ad_news_author_name'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"text\" name=\"authorName\" id=\"authorName\"\n                                   value=\"<?php echo $user->getUserData('display_name');\n    ?>\"/>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorEmail\"><?php echo $PMF_LANG['ad_news_author_email'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"email\" name=\"authorEmail\" id=\"authorEmail\"\n                                   value=\"<?php echo $user->getUserData('email');\n    ?>\"/>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"active\">\n                            <?php echo $PMF_LANG['ad_news_set_active'];\n    ?>:\n                        </label>\n                        <div class=\"col-lg-4 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\">\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"comment\"><?php echo $PMF_LANG['ad_news_allowComments'];\n    ?></label>\n                        <div class=\"col-lg-4 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\">\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"link\"><?php echo $PMF_LANG['ad_news_link_url'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"url\" name=\"link\" id=\"link\" placeholder=\"http://www.example.com/\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"linkTitle\"><?php echo $PMF_LANG['ad_news_link_title'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"linkTitle\" id=\"linkTitle\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" ><?php echo $PMF_LANG['ad_news_link_target'];\n    ?></label>\n                        <div class=\"col-lg-4 radio\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\">\n                                <?php echo $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\">\n                                <?php echo $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\">\n                                <?php echo $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"langTo\"><?php echo $PMF_LANG['ad_entry_locale'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <?php echo PMF_Language::selectLanguages($LANGCODE, false, [], 'langTo');\n    ?>\n                        </div>\n                    </div>\n\n                    <legend><?php echo $PMF_LANG['ad_news_expiration_window'];\n    ?></legend>\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateStart\"><?php echo $PMF_LANG['ad_news_from'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control date-pick\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateEnd\"><?php echo $PMF_LANG['ad_news_to'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input type=\"date\" name=\"dateEnd\" id=\"dateEnd\" class=\"form-control date-pick\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <div class=\"col-lg-offset-2 col-lg-4\">\n                            <button class=\"btn btn-primary\" type=\"submit\">\n                                <?php echo $PMF_LANG['ad_news_add'];\n    ?>\n                            </button>\n                            <a class=\"btn btn-info\" href=\"?action=news\">\n                                <?php echo $PMF_LANG['ad_entry_back'];\n    ?>\n                            </a>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n<?php\n\n} elseif ('news' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\">\n                    <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['msgNews'] ?>\n                    <div class=\"pull-right\">\n                        <a class=\"btn btn-success\" href=\"?action=addnews\">\n                            <i aria-hidden=\"true\" class=\"fa fa-plus fa fa-white\"></i> <?php echo $PMF_LANG['ad_menu_news_add'] ?>\n                        </a>\n                    </div>\n                </h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th><?php echo $PMF_LANG['ad_news_headline'];\n    ?></th>\n                        <th colspan=\"2\"><?php echo $PMF_LANG['ad_news_date'];\n    ?></th>\n                    </tr>\n                </thead>\n                <tbody>\n<?php\n        $newsHeader = $news->getNewsHeader();\n    $date = new PMF_Date($faqConfig);\n    if (count($newsHeader)) {\n        foreach ($newsHeader as $newsItem) {\n            ?>\n                    <tr>\n                        <td><?php echo $newsItem['header'];\n            ?></td>\n                        <td><?php echo $date->format($newsItem['date']);\n            ?></td>\n                        <td>\n                            <a class=\"btn btn-primary\" href=\"?action=editnews&amp;id=<?php echo $newsItem['id'];\n            ?>\">\n                                <span title=\"<?php echo $PMF_LANG['ad_news_update'];\n            ?>\" class=\"fa fa-edit\"></span>\n                            </a>\n                            &nbsp;&nbsp;\n                            <a class=\"btn btn-danger\" href=\"?action=deletenews&amp;id=<?php echo $newsItem['id'];\n            ?>\">\n                                <span title=\"<?php echo $PMF_LANG['ad_news_delete'];\n            ?>\" class=\"fa fa-trash-o\"></span>\n                            </a>\n                        </td>\n                    </tr>\n<?php\n\n        }\n    } else {\n        printf(\n                '<tr><td colspan=\"3\">%s</td></tr>',\n                $PMF_LANG['ad_news_nodata']\n            );\n    }\n    ?>\n                </tbody>\n                </table>\n            </div>\n        </div>\n<?php\n\n} elseif ('editnews' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    $id = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $newsData = $news->getNewsEntry($id, true);\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_edit'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <form class=\"form-horizontal\" action=\"?action=updatenews\" method=\"post\" accept-charset=\"utf-8\">\n                    <input type=\"hidden\" name=\"id\" value=\"<?php echo $newsData['id'];\n    ?>\">\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"newsheader\"><?php echo $PMF_LANG['ad_news_header'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"newsheader\" id=\"newsheader\" class=\"form-control\"\n                                   value=\"<?php if (isset($newsData['header'])) {\n    echo $newsData['header'];\n}\n    ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"news\"><?php echo $PMF_LANG['ad_news_text'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea id=\"news\" name=\"news\" class=\"form-control\" rows=\"5\"><?php\n                                if (isset($newsData['content'])) {\n                                    echo htmlspecialchars($newsData['content'], ENT_QUOTES);\n                                }\n    ?></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorName\"><?php echo $PMF_LANG['ad_news_author_name'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"authorName\" value=\"<?php echo $newsData['authorName'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorEmail\"><?php echo $PMF_LANG['ad_news_author_email'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"email\" name=\"authorEmail\" value=\"<?php echo $newsData['authorEmail'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"active\">\n                            <?php echo $PMF_LANG['ad_news_set_active'];\n    ?>:\n                        </label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\"\n                                    <?php if (isset($newsData['active']) && $newsData['active']) {\n    echo ' checked';\n}\n    ?>\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"comment\"><?php echo $PMF_LANG['ad_news_allowComments'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\"<?php if (isset($newsData['allowComments']) && $newsData['allowComments']) {\n    echo ' checked';\n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"link\"><?php echo $PMF_LANG['ad_news_link_url'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"url\" name=\"link\" value=\"<?php echo $newsData['link'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"linkTitle\"><?php echo $PMF_LANG['ad_news_link_title'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"linkTitle\" value=\"<?php echo $newsData['linkTitle'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"target\"><?php echo $PMF_LANG['ad_news_link_target'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\" <?php if ('blank' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_window'] ?>\n                            </label>\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"self\" <?php if ('self' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_faq'] ?>\n                            </label>\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"parent\" <?php if ('parent' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"langTo\"><?php echo $PMF_LANG['ad_entry_locale'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                        <?php echo PMF_Language::selectLanguages($newsData['lang'], false, [], 'langTo');\n    ?>\n                    </div>\n<?php\n    $dateStart = ($newsData['dateStart'] != '00000000000000' ? PMF_Date::createIsoDate($newsData['dateStart'], 'Y-m-d') : '');\n    $dateEnd = ($newsData['dateEnd'] != '99991231235959' ? PMF_Date::createIsoDate($newsData['dateEnd'], 'Y-m-d') : '');\n    ?>\n\n                    <legend><?php echo $PMF_LANG['ad_news_expiration_window'];\n    ?></legend>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateStart\"><?php echo $PMF_LANG['ad_news_from'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input name=\"dateStart\" id=\"dateStart\" class=\"form-control date-pick\" value=\"<?php echo $dateStart;\n    ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateEnd\"><?php echo $PMF_LANG['ad_news_to'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input name=\"dateEnd\" id=\"dateEnd\" class=\"form-control date-pick\" value=\"<?php echo $dateEnd;\n    ?>\">\n                        </div>\n                    </div>\n\n                <div class=\"form-group\">\n                    <div class=\"col-lg-offset-2 col-lg-4\">\n                        <button class=\"btn btn-primary\" type=\"submit\">\n                            <?php echo $PMF_LANG['ad_news_edit'];\n    ?>\n                        </button>\n                        <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?php echo $PMF_LANG['ad_entry_back'];\n    ?>\n                        </a>\n                    </div>\n                </div>\n                </form>\n<?php\n    $newsId = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $oComment = new PMF_Comment($faqConfig);\n    $comments = $oComment->getCommentsData($newsId, PMF_Comment::COMMENT_TYPE_NEWS);\n    if (count($comments) > 0) {\n        ?>\n                <div class=\"form-group\"><strong><?php echo $PMF_LANG['ad_entry_comment'] ?></strong></div>\n<?php\n\n    }\n    foreach ($comments as $item) {\n        ?>\n                <div class=\"form-group\">\n                    <?php echo $PMF_LANG['ad_entry_commentby'] ?>\n                    <a href=\"mailto:<?php print($item['email']);\n        ?>\">\n                        <?php print($item['user']);\n        ?>\n                    </a>:<br>\n                    <?php print($item['content']);\n        ?><br>\n                    <?php print($PMF_LANG['newsCommentDate'].PMF_Date::createIsoDate($item['date'], 'Y-m-d H:i', false));\n        ?>\n                    <a href=\"?action=delcomment&amp;artid=<?php print($newsId);\n        ?>&amp;cmtid=<?php print($item['id']);\n        ?>&amp;type=<?php print(PMF_Comment::COMMENT_TYPE_NEWS);\n        ?>\">\n                        <i aria-hidden=\"true\" class=\"fa fa-trash-o\"></i>\n                    </a>\n                </div>\n            </div>\n        </div>\n<?php\n\n    }\n} elseif ('savenews' == $action && $user->perm->checkRight($user->getUserId(), 'addnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $dateStart = PMF_Filter::filterInput(INPUT_POST, 'dateStart', FILTER_SANITIZE_STRING);\n    $dateEnd = PMF_Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_SANITIZE_STRING);\n    $header = PMF_Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_STRIPPED);\n    $content = PMF_Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = PMF_Filter::filterInput(INPUT_POST, 'authorName', FILTER_SANITIZE_STRIPPED);\n    $email = PMF_Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = PMF_Filter::filterInput(INPUT_POST, 'active', FILTER_SANITIZE_STRING);\n    $comment = PMF_Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n    $link = PMF_Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linktitle = PMF_Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_STRIPPED);\n    $newslang = PMF_Filter::filterInput(INPUT_POST, 'langTo', FILTER_SANITIZE_STRING);\n    $target = PMF_Filter::filterInput(INPUT_POST, 'target', FILTER_SANITIZE_STRIPPED);\n\n    $newsData = array(\n        'lang' => $newslang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart).'000000',\n        'dateEnd' => (empty($dateEnd))  ? '99991231235959' : str_replace('-', '', $dateEnd).'235959',\n        'link' => $link,\n        'linkTitle' => $linktitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    if ($news->addNewsEntry($newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_insertfail']);\n    }\n    printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n<?php\n\n} elseif ('updatenews' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $dateStart = PMF_Filter::filterInput(INPUT_POST, 'dateStart', FILTER_SANITIZE_STRING);\n    $dateEnd = PMF_Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_SANITIZE_STRING);\n    $header = PMF_Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_STRIPPED);\n    $content = PMF_Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = PMF_Filter::filterInput(INPUT_POST, 'authorName', FILTER_SANITIZE_STRIPPED);\n    $email = PMF_Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = PMF_Filter::filterInput(INPUT_POST, 'active', FILTER_SANITIZE_STRING);\n    $comment = PMF_Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n    $link = PMF_Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linktitle = PMF_Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_STRIPPED);\n    $newslang = PMF_Filter::filterInput(INPUT_POST, 'langTo', FILTER_SANITIZE_STRING);\n    $target = PMF_Filter::filterInput(INPUT_POST, 'target', FILTER_SANITIZE_STRIPPED);\n\n    $newsData = array(\n        'lang' => $newslang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart).'000000',\n        'dateEnd' => (empty($dateEnd))   ? '99991231235959' : str_replace('-', '', $dateEnd).'235959',\n        'link' => $link,\n        'linkTitle' => $linktitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    $newsId = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n    if ($news->updateNewsEntry($newsId, $newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_updatefail']);\n    }\n    printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n<?php\n\n} elseif ('deletenews' == $action && $user->perm->checkRight($user->getUserId(), 'delnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $precheck = PMF_Filter::filterInput(INPUT_POST, 'really', FILTER_SANITIZE_STRING, 'no');\n    $delete_id = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n\n    if ('no' == $precheck) {\n        ?>\n    <div class=\"form-group\"><?php echo $PMF_LANG['ad_news_del'];\n        ?></div>\n    <div class=\"text-center\">\n    <form action=\"?action=deletenews\" method=\"post\" accept-charset=\"utf-8\">\n    <input type=\"hidden\" name=\"id\" value=\"<?php echo $delete_id;\n        ?>\">\n    <input type=\"hidden\" name=\"really\" value=\"yes\">\n        <button class=\"btn btn-warning\" type=\"submit\" name=\"submit\">\n            <?php echo $PMF_LANG['ad_news_yesdelete'];\n        ?>\n        </button>\n        <a class=\"btn btn-inverse\" onclick=\"javascript:history.back();\">\n            <?php echo $PMF_LANG['ad_news_nodelete'];\n        ?>\n        </a>\n    </form>\n    </div>\n    \n    <script type=\"text/javascript\">\n    if (!Modernizr.inputtypes.date) {\n        $(function() {\n            $('.date-pick').datePicker();\n        });\n    }\n    </script>\n<?php\n\n    } else {\n        $delete_id = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n        $news->deleteNews($delete_id);\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_delsuc']);\n        printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    }\n} else {\n    echo $PMF_LANG['err_NotAuth'];\n}\n"], "fixing_code": ["<?php\n/**\n * The main administration file for the news.\n *\n * PHP Version 5.5\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @category  phpMyFAQ\n *\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>\n * @copyright 2003-2017 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n *\n * @link      http://www.phpmyfaq.de\n * @since     2003-02-23\n */\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    $protocol = 'http';\n    if (isset($_SERVER['HTTPS']) && strtoupper($_SERVER['HTTPS']) === 'ON') {\n        $protocol = 'https';\n    }\n    header('Location: '.$protocol.'://'.$_SERVER['HTTP_HOST'].dirname($_SERVER['SCRIPT_NAME']));\n    exit();\n}\n\n$news = new PMF_News($faqConfig);\n\n$csrfToken = PMF_Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_STRING);\nif (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n    $csrfCheck = false;\n} else {\n    $csrfCheck = true;\n}\n\nif ('addnews' == $action && $user->perm->checkRight($user->getUserId(), 'addnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_add'] ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <form class=\"form-horizontal\" id=\"faqEditor\" name=\"faqEditor\" action=\"?action=savenews\" method=\"post\" accept-charset=\"utf-8\">\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"newsheader\">\n                            <?php echo $PMF_LANG['ad_news_header'] ?>\n                        </label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"text\" name=\"newsheader\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"news\"><?php echo $PMF_LANG['ad_news_text'] ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea name=\"news\" rows=\"5\" class=\"form-control\"></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorName\"><?php echo $PMF_LANG['ad_news_author_name'] ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"text\" name=\"authorName\" id=\"authorName\"\n                                   value=\"<?php echo $user->getUserData('display_name') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorEmail\"><?php echo $PMF_LANG['ad_news_author_email'] ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"email\" name=\"authorEmail\" id=\"authorEmail\"\n                                   value=\"<?php echo $user->getUserData('email') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"active\">\n                            <?php echo $PMF_LANG['ad_news_set_active'] ?>:\n                        </label>\n                        <div class=\"col-lg-4 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\">\n                                <?php echo $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"comment\"><?php echo $PMF_LANG['ad_news_allowComments'] ?></label>\n                        <div class=\"col-lg-4 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\">\n                                <?php echo $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"link\"><?php echo $PMF_LANG['ad_news_link_url'] ?></label>\n                        <div class=\"col-lg-4\">\n                            <input class=\"form-control\" type=\"url\" name=\"link\" id=\"link\" placeholder=\"http://www.example.com/\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"linkTitle\"><?php echo $PMF_LANG['ad_news_link_title'] ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"linkTitle\" id=\"linkTitle\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" ><?php echo $PMF_LANG['ad_news_link_target'] ?></label>\n                        <div class=\"col-lg-4 radio\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\">\n                                <?php echo $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\">\n                                <?php echo $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\">\n                                <?php echo $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"langTo\"><?php echo $PMF_LANG['ad_entry_locale'] ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <?php echo PMF_Language::selectLanguages($LANGCODE, false, [], 'langTo') ?>\n                        </div>\n                    </div>\n\n                    <legend><?php echo $PMF_LANG['ad_news_expiration_window'] ?></legend>\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateStart\"><?php echo $PMF_LANG['ad_news_from'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control date-pick\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateEnd\"><?php echo $PMF_LANG['ad_news_to'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input type=\"date\" name=\"dateEnd\" id=\"dateEnd\" class=\"form-control date-pick\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <div class=\"col-lg-offset-2 col-lg-4\">\n                            <button class=\"btn btn-primary\" type=\"submit\">\n                                <?php echo $PMF_LANG['ad_news_add'];\n    ?>\n                            </button>\n                            <a class=\"btn btn-info\" href=\"?action=news\">\n                                <?php echo $PMF_LANG['ad_entry_back'];\n    ?>\n                            </a>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n<?php\n\n} elseif ('news' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\">\n                    <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['msgNews'] ?>\n                    <div class=\"pull-right\">\n                        <a class=\"btn btn-success\" href=\"?action=addnews\">\n                            <i aria-hidden=\"true\" class=\"fa fa-plus fa fa-white\"></i> <?php echo $PMF_LANG['ad_menu_news_add'] ?>\n                        </a>\n                    </div>\n                </h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <table class=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th><?php echo $PMF_LANG['ad_news_headline'];\n    ?></th>\n                        <th colspan=\"2\"><?php echo $PMF_LANG['ad_news_date'];\n    ?></th>\n                    </tr>\n                </thead>\n                <tbody>\n<?php\n        $newsHeader = $news->getNewsHeader();\n    $date = new PMF_Date($faqConfig);\n    if (count($newsHeader)) {\n        foreach ($newsHeader as $newsItem) {\n            ?>\n                    <tr>\n                        <td><?php echo $newsItem['header'];\n            ?></td>\n                        <td><?php echo $date->format($newsItem['date']);\n            ?></td>\n                        <td>\n                            <a class=\"btn btn-primary\" href=\"?action=editnews&amp;id=<?php echo $newsItem['id'];\n            ?>\">\n                                <span title=\"<?php echo $PMF_LANG['ad_news_update'];\n            ?>\" class=\"fa fa-edit\"></span>\n                            </a>\n                            &nbsp;&nbsp;\n                            <a class=\"btn btn-danger\" href=\"?action=deletenews&amp;id=<?php echo $newsItem['id'];\n            ?>\">\n                                <span title=\"<?php echo $PMF_LANG['ad_news_delete'];\n            ?>\" class=\"fa fa-trash-o\"></span>\n                            </a>\n                        </td>\n                    </tr>\n<?php\n\n        }\n    } else {\n        printf(\n                '<tr><td colspan=\"3\">%s</td></tr>',\n                $PMF_LANG['ad_news_nodata']\n            );\n    }\n    ?>\n                </tbody>\n                </table>\n            </div>\n        </div>\n<?php\n\n} elseif ('editnews' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    $id = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $newsData = $news->getNewsEntry($id, true);\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_edit'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n                <form class=\"form-horizontal\" action=\"?action=updatenews\" method=\"post\" accept-charset=\"utf-8\">\n                    <input type=\"hidden\" name=\"id\" value=\"<?php echo $newsData['id'];\n    ?>\">\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"newsheader\"><?php echo $PMF_LANG['ad_news_header'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"newsheader\" id=\"newsheader\" class=\"form-control\"\n                                   value=\"<?php if (isset($newsData['header'])) {\n    echo $newsData['header'];\n}\n    ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"news\"><?php echo $PMF_LANG['ad_news_text'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea id=\"news\" name=\"news\" class=\"form-control\" rows=\"5\"><?php\n                                if (isset($newsData['content'])) {\n                                    echo htmlspecialchars($newsData['content'], ENT_QUOTES);\n                                }\n    ?></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorName\"><?php echo $PMF_LANG['ad_news_author_name'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"authorName\" value=\"<?php echo $newsData['authorName'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"authorEmail\"><?php echo $PMF_LANG['ad_news_author_email'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"email\" name=\"authorEmail\" value=\"<?php echo $newsData['authorEmail'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"active\">\n                            <?php echo $PMF_LANG['ad_news_set_active'];\n    ?>:\n                        </label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\"\n                                    <?php if (isset($newsData['active']) && $newsData['active']) {\n    echo ' checked';\n}\n    ?>\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"comment\"><?php echo $PMF_LANG['ad_news_allowComments'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\"<?php if (isset($newsData['allowComments']) && $newsData['allowComments']) {\n    echo ' checked';\n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_gen_yes'];\n    ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"link\"><?php echo $PMF_LANG['ad_news_link_url'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"url\" name=\"link\" value=\"<?php echo $newsData['link'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"linkTitle\"><?php echo $PMF_LANG['ad_news_link_title'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <input type=\"text\" name=\"linkTitle\" value=\"<?php echo $newsData['linkTitle'];\n    ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"target\"><?php echo $PMF_LANG['ad_news_link_target'];\n    ?></label>\n                        <div class=\"col-lg-4\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\" <?php if ('blank' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_window'] ?>\n                            </label>\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"self\" <?php if ('self' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_faq'] ?>\n                            </label>\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"parent\" <?php if ('parent' == $newsData['target']) {\n    ?>\n                                   checked=\"checked\"<?php \n}\n    ?>>\n                                <?php echo $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"langTo\"><?php echo $PMF_LANG['ad_entry_locale'];\n    ?>:</label>\n                        <div class=\"col-lg-4\">\n                        <?php echo PMF_Language::selectLanguages($newsData['lang'], false, [], 'langTo');\n    ?>\n                    </div>\n<?php\n    $dateStart = ($newsData['dateStart'] != '00000000000000' ? PMF_Date::createIsoDate($newsData['dateStart'], 'Y-m-d') : '');\n    $dateEnd = ($newsData['dateEnd'] != '99991231235959' ? PMF_Date::createIsoDate($newsData['dateEnd'], 'Y-m-d') : '');\n    ?>\n\n                    <legend><?php echo $PMF_LANG['ad_news_expiration_window'];\n    ?></legend>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateStart\"><?php echo $PMF_LANG['ad_news_from'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input name=\"dateStart\" id=\"dateStart\" class=\"form-control date-pick\" value=\"<?php echo $dateStart;\n    ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label class=\"col-lg-2 control-label\" for=\"dateEnd\"><?php echo $PMF_LANG['ad_news_to'];\n    ?></label>\n                        <div class=\"col-lg-2\">\n                            <input name=\"dateEnd\" id=\"dateEnd\" class=\"form-control date-pick\" value=\"<?php echo $dateEnd;\n    ?>\">\n                        </div>\n                    </div>\n\n                <div class=\"form-group\">\n                    <div class=\"col-lg-offset-2 col-lg-4\">\n                        <button class=\"btn btn-primary\" type=\"submit\">\n                            <?php echo $PMF_LANG['ad_news_edit'];\n    ?>\n                        </button>\n                        <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?php echo $PMF_LANG['ad_entry_back'];\n    ?>\n                        </a>\n                    </div>\n                </div>\n                </form>\n<?php\n    $newsId = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $oComment = new PMF_Comment($faqConfig);\n    $comments = $oComment->getCommentsData($newsId, PMF_Comment::COMMENT_TYPE_NEWS);\n    if (count($comments) > 0) {\n        ?>\n                <div class=\"form-group\"><strong><?php echo $PMF_LANG['ad_entry_comment'] ?></strong></div>\n<?php\n\n    }\n    foreach ($comments as $item) {\n        ?>\n                <div class=\"form-group\">\n                    <?php echo $PMF_LANG['ad_entry_commentby'] ?>\n                    <a href=\"mailto:<?php print($item['email']);\n        ?>\">\n                        <?php print($item['user']);\n        ?>\n                    </a>:<br>\n                    <?php print($item['content']);\n        ?><br>\n                    <?php print($PMF_LANG['newsCommentDate'].PMF_Date::createIsoDate($item['date'], 'Y-m-d H:i', false));\n        ?>\n                    <a href=\"?action=delcomment&amp;artid=<?php print($newsId);\n        ?>&amp;cmtid=<?php print($item['id']);\n        ?>&amp;type=<?php print(PMF_Comment::COMMENT_TYPE_NEWS);\n        ?>\">\n                        <i aria-hidden=\"true\" class=\"fa fa-trash-o\"></i>\n                    </a>\n                </div>\n            </div>\n        </div>\n<?php\n\n    }\n} elseif ('savenews' == $action && $user->perm->checkRight($user->getUserId(), 'addnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $dateStart = PMF_Filter::filterInput(INPUT_POST, 'dateStart', FILTER_SANITIZE_STRING);\n    $dateEnd = PMF_Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_SANITIZE_STRING);\n    $header = PMF_Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_STRIPPED);\n    $content = PMF_Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = PMF_Filter::filterInput(INPUT_POST, 'authorName', FILTER_SANITIZE_STRIPPED);\n    $email = PMF_Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = PMF_Filter::filterInput(INPUT_POST, 'active', FILTER_SANITIZE_STRING);\n    $comment = PMF_Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n    $link = PMF_Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linktitle = PMF_Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_STRIPPED);\n    $newslang = PMF_Filter::filterInput(INPUT_POST, 'langTo', FILTER_SANITIZE_STRING);\n    $target = PMF_Filter::filterInput(INPUT_POST, 'target', FILTER_SANITIZE_STRIPPED);\n\n    $newsData = array(\n        'lang' => $newslang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart).'000000',\n        'dateEnd' => (empty($dateEnd))  ? '99991231235959' : str_replace('-', '', $dateEnd).'235959',\n        'link' => $link,\n        'linkTitle' => $linktitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    if ($news->addNewsEntry($newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_insertfail']);\n    }\n    printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n<?php\n\n} elseif ('updatenews' == $action && $user->perm->checkRight($user->getUserId(), 'editnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $dateStart = PMF_Filter::filterInput(INPUT_POST, 'dateStart', FILTER_SANITIZE_STRING);\n    $dateEnd = PMF_Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_SANITIZE_STRING);\n    $header = PMF_Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_STRIPPED);\n    $content = PMF_Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = PMF_Filter::filterInput(INPUT_POST, 'authorName', FILTER_SANITIZE_STRIPPED);\n    $email = PMF_Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = PMF_Filter::filterInput(INPUT_POST, 'active', FILTER_SANITIZE_STRING);\n    $comment = PMF_Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n    $link = PMF_Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linktitle = PMF_Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_STRIPPED);\n    $newslang = PMF_Filter::filterInput(INPUT_POST, 'langTo', FILTER_SANITIZE_STRING);\n    $target = PMF_Filter::filterInput(INPUT_POST, 'target', FILTER_SANITIZE_STRIPPED);\n\n    $newsData = array(\n        'lang' => $newslang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart).'000000',\n        'dateEnd' => (empty($dateEnd))   ? '99991231235959' : str_replace('-', '', $dateEnd).'235959',\n        'link' => $link,\n        'linkTitle' => $linktitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    $newsId = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n    if ($news->updateNewsEntry($newsId, $newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_updatefail']);\n    }\n    printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n<?php\n\n} elseif ('deletenews' == $action && $user->perm->checkRight($user->getUserId(), 'delnews')) {\n    ?>\n        <header class=\"row\">\n            <div class=\"col-lg-12\">\n                <h2 class=\"page-header\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i> <?php echo $PMF_LANG['ad_news_data'];\n    ?></h2>\n            </div>\n        </header>\n\n        <div class=\"row\">\n            <div class=\"col-lg-12\">\n<?php\n    $precheck = PMF_Filter::filterInput(INPUT_POST, 'really', FILTER_SANITIZE_STRING, 'no');\n    $deleteId = PMF_Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n\n    if ('no' == $precheck) {\n        ?>\n    <div class=\"form-group\"><?php echo $PMF_LANG['ad_news_del'];\n        ?></div>\n    <div class=\"text-center\">\n    <form action=\"?action=deletenews\" method=\"post\" accept-charset=\"utf-8\">\n    <input type=\"hidden\" name=\"id\" value=\"<?php echo $deleteId ?>\">\n    <input type=\"hidden\" name=\"csrf\" value=\"<?php echo $user->getCsrfTokenFromSession() ?>\">\n    <input type=\"hidden\" name=\"really\" value=\"yes\">\n        <button class=\"btn btn-warning\" type=\"submit\" name=\"submit\">\n            <?php echo $PMF_LANG['ad_news_yesdelete'];\n        ?>\n        </button>\n        <a class=\"btn btn-inverse\" onclick=\"javascript:history.back();\">\n            <?php echo $PMF_LANG['ad_news_nodelete'];\n        ?>\n        </a>\n    </form>\n    </div>\n    \n    <script type=\"text/javascript\">\n    if (!Modernizr.inputtypes.date) {\n        $(function() {\n            $('.date-pick').datePicker();\n        });\n    }\n    </script>\n<?php\n\n    } else {\n        if ($csrfCheck) {\n            $deleteId = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n            $news->deleteNews($deleteId);\n            printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_delsuc']);\n            printf('<div class=\"form-group\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n        }\n    }\n} else {\n    echo $PMF_LANG['err_NotAuth'];\n}\n"], "filenames": ["phpmyfaq/admin/news.php"], "buggy_code_start_loc": [31], "buggy_code_end_loc": [633], "fixing_code_start_loc": [32], "fixing_code_end_loc": [625], "type": "CWE-352", "message": "In phpMyFAQ before 2.9.9, there is Cross-Site Request Forgery (CSRF) in admin/news.php.", "other": {"cve": {"id": "CVE-2017-15732", "sourceIdentifier": "cve@mitre.org", "published": "2017-10-22T18:29:00.497", "lastModified": "2017-10-24T15:09:24.113", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In phpMyFAQ before 2.9.9, there is Cross-Site Request Forgery (CSRF) in admin/news.php."}, {"lang": "es", "value": "En phpMyFAQ en versiones anteriores a la 2.9.9 hay Cross-Site Request Forgery (CSRF) en admin/news.php."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndIncluding": "2.9.8", "matchCriteriaId": "1D0B1C07-83F7-4DB0-976C-51483D7DF516"}]}]}], "references": [{"url": "https://github.com/thorsten/phpMyFAQ/commit/ec8b3cc37d05b6625e24916b8f7253f830015b5f", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpMyFAQ/commit/ec8b3cc37d05b6625e24916b8f7253f830015b5f"}}