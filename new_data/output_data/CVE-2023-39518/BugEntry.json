{"buggy_code": ["\n<?php\nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:adminlogin.html\");\n   exit();\n}\n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n//if empty password or username!\n//alt isempty\nif($uemail==\"\" || $upass==\"\")\n{\n  header(\"location:add.html\");\n  exit();\n}\nrequire(\"../../tasks/condb.php\");\n\n// Create a prepared statement to prevent SQL injection\n$query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n$stmt = mysqli_prepare($dbcon, $query);\nmysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n$result = mysqli_stmt_execute($stmt);\n\nif($result)\n{\n  echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n include(\"add.html\");\n  $dbcon->close();\n  exit();\n}  else {\necho(\"some thing want wrong please try again!\");\n$dbcon->close();\ninclude(\"add.html\");\n}\n\n\n\n?>\n", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n//connect to the database first!!!!\nrequire('../../tasks/condb.php');\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n\n\t// if the form has been submitted!\n\t$echanged=false;\n\t$pchanged=false;\n\t$gotold=false;\n\t$putold=false;\n\n\t//is email changed \n\tif(isset($_POST['email']))\n\t{\n\t$echanged=true;\n\t$newemail=$_POST['email'];\n\t} \n\t//is pass ^^\n\tif(isset($_POST['password']))\n\t{\n\t$pchanged=true;\n\t$newpass=$_POST['password'];\n\t} \n\tif(isset($_POST['oldpass']))\n\t{\n\t\t$putold=true;\n\t\t$oldpass=$_POST['oldpass'];\n\n\t}\n/*************************************************** */\n// SQLi prevention through parameterization\n$id = $_SESSION[\"aid\"];\n$q = \"SELECT * FROM admin WHERE admin_id=?\";\n$stmt = mysqli_prepare($dbcon, $q);\nmysqli_stmt_bind_param($stmt, \"i\", $id);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n$row = $result->fetch_assoc(); \n$rpass = $row[\"password\"];  //real\n\nif ($pchanged && $oldpass == $rpass) {\n    // change the password \n    $q = \"UPDATE admin SET password=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newpass, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the password <br>\";\n}  \n\nif ($echanged && $oldpass == $rpass) {\n    $q = \"UPDATE admin SET email=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newemail, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the email <br>\";\n}\n/***************************************************** */\n}\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,intial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"setting.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"../home.php\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"../mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"add.html\"> add admin </a></li>\n\t\t\t\t<li><a href=\"#\"  style=\"background-color: black;\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n    <div class=\"adminsetting\">\n    <div class=\"adminsetting1\">\n\t\t<form action=\"\" method=\"post\">\n\t\t<label >email</label><br>\n    <input type=\"email\" name=\"email\" required><br>\n\t<label >new password</label><br>\n\t<input type=\"password\" name=\"password\" required><br>\n\t<label >old password</label><br>\n\t<input type=\"password\" name=\"oldpass\" required title=\"old password required to save changes\" ><br>\n\t<input type=\"submit\" id=\"submitb\" value=\"save changes\">\n</form>\n\t</div>\n\t</div>\n    \n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>\n", "<?php\ninclude(\"tasks/condb.php\");\n//handle the form \n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n$ufname=$_POST[\"fname\"];\n$ulname=$_POST[\"lname\"];\n$ugender=$_POST['gender'];\n$ubdate=$_POST['bdate'];\n$uelevel=$_POST['elevel'];\n$ucity=$_POST['city'];\n\n//prevent sql injection here \n$uemail=mysqli_real_escape_string($dbcon,$uemail);\n$upass=mysqli_real_escape_string($dbcon,$upass);\n$ufname=mysqli_real_escape_string($dbcon,$ufname);\n$ulname=mysqli_real_escape_string($dbcon,$ulname);\n$ugender=mysqli_real_escape_string($dbcon,$ugender);\n$ubdate=mysqli_real_escape_string($dbcon,$ubdate);\n$uelevel=mysqli_real_escape_string($dbcon,$uelevel);\n$ucity=mysqli_real_escape_string($dbcon,$ucity);\n\n\n$lseen=date(\"Y/m/d/H/i/s\");\n//using mysql now() 2nd alt \n//before inserting check if the email already exist \n$query=\"select * from users where email='$uemail'\";\n$result=mysqli_query($dbcon,$query);\n//if available \nif($result->num_rows==0)\n{\n//insert to database.\n$query=\"insert into users (email,password,fname,lname,gender,bday,edu,city,last_seen,joined) values('$uemail','$upass','$ufname','$ulname','$ugender','$ubdate','$uelevel','$ucity','$lseen','$lseen')\";\n$result=mysqli_query($dbcon,$query);\n//if successfully inseerted true \nif($result==true)\n{\n    echo(\"you have successfully registered,login now\");\n    require('login.html');\n    exit();\n\n} else {\n    echo mysqli_error($dbcon).\"<br>\";\n    die(\"unknow error occured\");\n}\n}  else {\n    echo(\"<p style='color:red;text-align:center;font-size:20px;'>the email address you inserted is taken </p>\");\n    require('signup.html');\n    exit();\n}\n\n\n\n\n?>\n\n\n"], "fixing_code": ["\n<?php\nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:adminlogin.html\");\n   exit();\n}\n$uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n$upass=htmlspecialchars($_POST[\"password\"], ENT_QUOTES, 'UTF-8');\n//if empty password or username!\n//alt isempty\nif($uemail==\"\" || $upass==\"\")\n{\n  header(\"location:add.html\");\n  exit();\n}\nrequire(\"../../tasks/condb.php\");\n\n// Create a prepared statement to prevent SQL injection\n$query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n$stmt = mysqli_prepare($dbcon, $query);\nmysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n$result = mysqli_stmt_execute($stmt);\n\nif($result)\n{\n  echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n include(\"add.html\");\n  $dbcon->close();\n  exit();\n}  else {\necho(\"some thing want wrong please try again!\");\n$dbcon->close();\ninclude(\"add.html\");\n}\n\n\n\n?>\n", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n//connect to the database first!!!!\nrequire('../../tasks/condb.php');\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n\n\t// if the form has been submitted!\n\t$echanged=false;\n\t$pchanged=false;\n\t$gotold=false;\n\t$putold=false;\n\n\t//is email changed \n\tif(isset($_POST['email']))\n\t{\n\t$echanged=true;\n\t$newemail=htmlspecialchars($_POST['email'], ENT_QUOTES, 'UTF-8');\n\t} \n\t//is pass ^^\n\tif(isset($_POST['password']))\n\t{\n\t$pchanged=true;\n\t$newpass=htmlspecialchars($_POST['password'], ENT_QUOTES, 'UTF-8');\n\t} \n\tif(isset($_POST['oldpass']))\n\t{\n\t\t$putold=true;\n\t\t$oldpass=htmlspecialchars($_POST['oldpass'], ENT_QUOTES, 'UTF-8');\n\n\t}\n/*************************************************** */\n// SQLi prevention through parameterization\n$id = $_SESSION[\"aid\"];\n$q = \"SELECT * FROM admin WHERE admin_id=?\";\n$stmt = mysqli_prepare($dbcon, $q);\nmysqli_stmt_bind_param($stmt, \"i\", $id);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n$row = $result->fetch_assoc(); \n$rpass = $row[\"password\"];  //real\n\nif ($pchanged && $oldpass == $rpass) {\n    // change the password \n    $q = \"UPDATE admin SET password=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newpass, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the password <br>\";\n}  \n\nif ($echanged && $oldpass == $rpass) {\n    $q = \"UPDATE admin SET email=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newemail, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the email <br>\";\n}\n/***************************************************** */\n}\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,intial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"setting.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"../home.php\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"../mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"add.html\"> add admin </a></li>\n\t\t\t\t<li><a href=\"#\"  style=\"background-color: black;\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n    <div class=\"adminsetting\">\n    <div class=\"adminsetting1\">\n\t\t<form action=\"\" method=\"post\">\n\t\t<label >email</label><br>\n    <input type=\"email\" name=\"email\" required><br>\n\t<label >new password</label><br>\n\t<input type=\"password\" name=\"password\" required><br>\n\t<label >old password</label><br>\n\t<input type=\"password\" name=\"oldpass\" required title=\"old password required to save changes\" ><br>\n\t<input type=\"submit\" id=\"submitb\" value=\"save changes\">\n</form>\n\t</div>\n\t</div>\n    \n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>\n", "<?php\ninclude(\"tasks/condb.php\");\n//handle the form \n$uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n$upass=htmlspecialchars($_POST[\"password\"], ENT_QUOTES, 'UTF-8');\n$ufname=htmlspecialchars($_POST[\"fname\"], ENT_QUOTES, 'UTF-8');\n$ulname=htmlspecialchars($_POST[\"lname\"], ENT_QUOTES, 'UTF-8');\n$ugender=htmlspecialchars($_POST['gender'], ENT_QUOTES, 'UTF-8');\n$ubdate=htmlspecialchars($_POST['bdate'], ENT_QUOTES, 'UTF-8');\n$uelevel=htmlspecialchars($_POST['elevel'], ENT_QUOTES, 'UTF-8');\n$ucity=htmlspecialchars($_POST['city'], ENT_QUOTES, 'UTF-8');\n\n//prevent sql injection here \n$uemail=mysqli_real_escape_string($dbcon,$uemail);\n$upass=mysqli_real_escape_string($dbcon,$upass);\n$ufname=mysqli_real_escape_string($dbcon,$ufname);\n$ulname=mysqli_real_escape_string($dbcon,$ulname);\n$ugender=mysqli_real_escape_string($dbcon,$ugender);\n$ubdate=mysqli_real_escape_string($dbcon,$ubdate);\n$uelevel=mysqli_real_escape_string($dbcon,$uelevel);\n$ucity=mysqli_real_escape_string($dbcon,$ucity);\n\n\n$lseen=date(\"Y/m/d/H/i/s\");\n//using mysql now() 2nd alt \n//before inserting check if the email already exist \n$query=\"select * from users where email='$uemail'\";\n$result=mysqli_query($dbcon,$query);\n//if available \nif($result->num_rows==0)\n{\n//insert to database.\n$query=\"insert into users (email,password,fname,lname,gender,bday,edu,city,last_seen,joined) values('$uemail','$upass','$ufname','$ulname','$ugender','$ubdate','$uelevel','$ucity','$lseen','$lseen')\";\n$result=mysqli_query($dbcon,$query);\n//if successfully inseerted true \nif($result==true)\n{\n    echo(\"you have successfully registered,login now\");\n    require('login.html');\n    exit();\n\n} else {\n    echo mysqli_error($dbcon).\"<br>\";\n    die(\"unknow error occured\");\n}\n}  else {\n    echo(\"<p style='color:red;text-align:center;font-size:20px;'>the email address you inserted is taken </p>\");\n    require('signup.html');\n    exit();\n}\n\n\n\n\n?>\n\n\n"], "filenames": ["admin/atask/add.php", "admin/atask/setting.php", "signup.php"], "buggy_code_start_loc": [9, 24, 4], "buggy_code_end_loc": [11, 36, 12], "fixing_code_start_loc": [9, 24, 4], "fixing_code_end_loc": [11, 36, 12], "type": "CWE-79", "message": "social-media-skeleton is an uncompleted social media project implemented using PHP, MySQL, CSS, JavaScript, and HTML. Versions 1.0.0 until 1.0.3 have a stored cross-site scripting vulnerability. The problem is patched in v1.0.3.\n", "other": {"cve": {"id": "CVE-2023-39518", "sourceIdentifier": "security-advisories@github.com", "published": "2023-08-08T19:15:10.533", "lastModified": "2023-08-10T21:10:19.233", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "social-media-skeleton is an uncompleted social media project implemented using PHP, MySQL, CSS, JavaScript, and HTML. Versions 1.0.0 until 1.0.3 have a stored cross-site scripting vulnerability. The problem is patched in v1.0.3.\n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fobybus:social-media-skeleton:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.0.3", "matchCriteriaId": "E47A7BCE-B493-4DB3-9BE2-4E4415436857"}]}]}], "references": [{"url": "https://github.com/fobybus/social-media-skeleton/commit/6765d1109016e1f1d707ef47917927c7704e6428", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/fobybus/social-media-skeleton/pull/4", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/fobybus/social-media-skeleton/security/advisories/GHSA-2jxx-r967-f76p", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/fobybus/social-media-skeleton/commit/6765d1109016e1f1d707ef47917927c7704e6428"}}