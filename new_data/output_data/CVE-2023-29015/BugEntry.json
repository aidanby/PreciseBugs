{"buggy_code": ["<ui:composition xmlns=\"http://www.w3.org/1999/xhtml\"\n\txmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n\txmlns:c=\"http://java.sun.com/jsp/jstl/core\"\n\txmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n\txmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n\txmlns:jsf=\"http://xmlns.jcp.org/jsf\"\n\txmlns:pt=\"http://xmlns.jcp.org/jsf/passthrough\"\n\txmlns:o=\"http://omnifaces.org/ui\"\n\txmlns:viewer=\"http://xmlns.jcp.org/jsf/composite/components/partner\"\n\txmlns:viewerComponent=\"http://xmlns.jcp.org/jsf/composite/components\"\n\txmlns:widgetComponent=\"http://xmlns.jcp.org/jsf/composite/components/widgets\">\n\n\t<!-- USER COMMENTS -->\n\t<ui:fragment\n\t\trendered=\"#{activeDocumentBean.allowUserComments}\">\n\t\t<div id=\"userComments\" class=\"user-comments\">\n\t\t\t<!-- USER NOT LOGGED IN -->\n\t\t\t<ui:fragment rendered=\"#{!userBean.loggedIn}\">\n\t\t\t\t<div class=\"user-comments__message-login\">\n\t\t\t\t\t<h2 >#{msg.commentAdd}</h2>\n\n\t\t\t\t\t<h:outputText value=\"#{msg.commentDescription} \" escape=\"false\" />\n\n\t\t\t\t\t<br />\n\n\t\t\t\t\t<!-- TOGGLE LOGIN -->\n\t\t\t\t\t<button type=\"button\" class=\"btn btn--link\" data-toggle=\"modal\"\n\t\t\t\t\t\tdata-target=\"#userLoginModal\" aria-label=\"#{msg.userNotLoggedIn}\">\n\t\t\t\t\t\t<span>#{msg.login}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</ui:fragment>\n\n\t\t\t<h:form id=\"userCommentsForm\" prependId=\"false\">\n\t\t\t\t<ui:fragment rendered=\"#{userBean.loggedIn}\">\n\t\t\t\t\t<h2 >#{msg.userComments}</h2>\n\t\t\t\t</ui:fragment>\n\n\t\t\t\t<!-- EXISTING COMMENTS -->\n\t\t\t\t<ui:repeat var=\"comment\"  varStatus=\"status\"\n\t\t\t\t\tvalue=\"#{commentBean.commentsForCurrentPage}\">\n\t\t\t\t\t<div class=\"user-comments__comment\">\n\n\t\t\t\t\t<!-- START BLOCK - AUTHOR IMAGE/COMMENT INFO -->\n\t\t\t\t\t<div class=\"user-comments__comment-info\">\n\n\t\t\t\t\t\t<!-- USER IMAGE -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-image\">\n\t\t\t\t\t\t\t<img src=\"#{comment.creator.avatarUrl}\" alt=\"User avatar\" />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- COMMENT METADATA -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-metadata\">\n\t\t\t\t\t\t\t<span class=\"user-comments__comment-metadata-creator\">#{comment.creator.displayNameEscaped}</span>\n\t\t\t\t\t\t\t<span class=\"user-comments__comment-metadata-date\">#{navigationHelper.getLocalDate(comment.dateCreated)}</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- COMMENT CONTENT -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-content\">\n\t\t\t\t\t\t\t<!-- CONTENT LOADER -->\n\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-loader\"></div>\n\n\t\t\t\t\t\t\t<!-- COMMENT OPTIONS -->\n\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\trendered=\"#{userBean.loggedIn or comment.dateModified != null}\">\n\t\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-options\">\n\n\t\t\t\t\t\t\t\t\t<!-- LAST CHANGE -->\n\t\t\t\t\t\t\t\t\t<h:panelGroup rendered=\"#{comment.dateModified != null}\"\n\t\t\t\t\t\t\t\t\t\tstyleClass=\"user-comments__comment-content-options-last-change\">\n                                        #{msg.lastEdited} #{navigationHelper.getLocalDate(comment.dateModified)}\n                                    </h:panelGroup>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ui:fragment>\n\n\t\t\t\t\t\t\t\t<!-- COMMENT TEXT -->\n\t\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-text in\">\n\t\t\t\t\t\t\t\t\t#{comment.displayText}</div>\n\n\t\t\t\t\t\t\t\t\t<!-- EDIT COMMENT -->\n\t\t\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\t\t\trendered=\"#{userBean.user == comment.creator or commentBean.isMayEditCommentsForRecord(activeDocumentBean.viewManager.pi)}\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"user-comments__action-wrapper\">\n\t\t\t\t\t\t\t\t\t\t\t<!-- TRIGGER EDIT COMMENT MODAL -->\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn--clean user-comments__edit-comment-button\" type=\"button\" data-backdrop=\"false\" data-toggle=\"modal\" data-target=\"#modalUserCommentEdit-#{comment.id}-modal\">\n\t\t\t\t\t\t\t\t\t\t\t  #{msg.edit}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t\t<!-- DELETE COMMENT -->\n\t\t\t\t\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\t\t\t\t\trendered=\"#{userBean.user == comment.creator or commentBean.isMayDeleteCommentsForRecord(activeDocumentBean.viewManager.pi)}\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"user-comments__delete-comment-button\" type=\"button\" data-delete=\"comment-#{comment.id}\">\n\t\t\t\t\t\t\t\t\t\t\t\t  #{msg.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</ui:fragment>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</ui:fragment>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id=\"modalUserCommentEdit-#{comment.id}\" modalid=\"modalUserCommentEdit-#{comment.id}-modal\" styleclass=\"user-comments-modal\" title=\"#{msg.userCommentEdit}\">\n\t\t\t\t\t\t<yield to=\"body\">\n\t\t\t\t\t\t<div class=\"row\">\n<!-- \t\t\t\t\t\t\t\t<div class=\"col-12 col-md-3\">#{msg.userCommentText}:</div> -->\n\t\t\t\t\t\t\t\t<div class=\"col-12 user-comments__comment-content-options-text-edit\">\n\t\t\t\t\t\t\t\t\t<textarea id=\"modalUserCommentEdit-#{comment.id}-text\">#{comment.text}</textarea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</yield>\n\t\t\t\t\t\t<yield to=\"footer\">\n\t\t\t\t\t\t\t<button id=\"modalUserCommentEdit-#{comment.id}-cancel\" class=\"btn\" data-dismiss=\"modal\">#{msg.cancel}</button>\n\t\t\t\t\t\t\t<button id=\"modalUserCommentEdit-#{comment.id}-ok\" class=\"btn btn--success accept ml-3\" data-dismiss=\"modal\">#{msg.save}</button>\n\t\t\t\t\t\t</yield>\n\t\t\t\t\t</div>\n\t\t\t\t\t<h:commandScript name=\"editComment\" action=\"#{commentBean.editComment}\" render=\"@form\"\n\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentEditSuccess}&quot;)\"\n\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\t\t\t\t\t<h:commandScript name=\"deleteComment\" action=\"#{commentBean.deleteComment}\" render=\"@form\"\n\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentDeleteSuccess}&quot;)\"\n\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\n\t\t\t\t\t<script>\n\t\t\t\t\t\triot.mount(\"#modalUserCommentEdit-#{comment.id}\", \"modal\", {});\n\t\t\t\t\t\t$(\"#modalUserCommentEdit-#{comment.id}-ok\").on(\"click\", () => {\n\t\t\t\t\t\t    let val = $(\"#modalUserCommentEdit-#{comment.id}-text\").val();\n\t\t\t\t\t\t    editComment({id:\"#{comment.id}\", text:val});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t$('[data-delete=\"comment-#{comment.id}\"]').on('click', function() {\n\t\t\t\t\t\t\tviewerJS.notifications.confirm('', '' ,'', '#{msg.userCommentDeleteText}')\n\t\t\t\t\t\t\t\t.then((result) => deleteComment({id:\"#{comment.id}\"}))\n\t\t\t\t\t\t\t\t.catch(() => {});\n\t\t\t\t\t\t});\n\t\t\t\t\t</script>\n\n\t\t\t\t</ui:repeat>\n\n\t\t\t\t<!-- ADD COMMENT -->\n\t\t\t\t<ui:fragment rendered=\"#{userBean.loggedIn}\">\n\t\t\t\t\t<div class=\"user-comments__add-comment\">\n\t\t\t\t\t\t<label for=\"userCommentAdd\"> <span>#{msg.userCommentAdd}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class=\"user-comments__add-comment-add\">\n\t\t\t\t\t\t\t<h:inputTextarea id=\"userCommentAdd\"\n\t\t\t\t\t\t\t\tvalue=\"#{commentText}\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!-- LICENSE CHECKBOX/PUBLIC COMMENT -->\n\t\t\t\t\t\t<!-- <h:selectBooleanCheckbox id=\"commentLicenseCheckbox\" value=\"#{commentRestricted}\">Restricted</h:selectBooleanCheckbox>-->\n\t\t\t\t\t\t<div class=\"user-comments__add-comment-submit\">\n\t\t\t\t\t\t\t<h:commandButton\n\t\t\t\t\t\t\t\taction=\"#{commentBean.createComment(commentText, commentRestricted)}\"\n\t\t\t\t\t\t\t\tstyleClass=\"btn btn--success\" value=\"#{msg.addNoteText}\">\n\t\t\t\t\t\t\t\t<f:ajax execute=\"userCommentAdd commentLicenseCheckbox\" render=\"@form\"\n\t\t\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentSaveSuccess}&quot;)\"\n\t\t\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\t\t\t\t\t\t\t</h:commandButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</ui:fragment>\n\t\t\t</h:form>\n\t\t</div>\n\n\t\t<script type=\"text/javascript\">\n\n            $( document ).ready( function() {\n                viewerJS.userComments.init();\n\n                jsf.ajax.addOnEvent( function( data ) {\n                    var ajaxstatus = data.status;\n\n                    switch ( ajaxstatus ) {\n                    case \"success\":\n                        viewerJS.userComments.init();\n                        break;\n                    }\n                } );\n            } );\n        </script>\n\t</ui:fragment>\n</ui:composition>\n"], "fixing_code": ["<ui:composition xmlns=\"http://www.w3.org/1999/xhtml\"\n\txmlns:ui=\"http://xmlns.jcp.org/jsf/facelets\"\n\txmlns:c=\"http://java.sun.com/jsp/jstl/core\"\n\txmlns:h=\"http://xmlns.jcp.org/jsf/html\"\n\txmlns:f=\"http://xmlns.jcp.org/jsf/core\"\n\txmlns:jsf=\"http://xmlns.jcp.org/jsf\"\n\txmlns:pt=\"http://xmlns.jcp.org/jsf/passthrough\"\n\txmlns:o=\"http://omnifaces.org/ui\"\n\txmlns:viewer=\"http://xmlns.jcp.org/jsf/composite/components/partner\"\n\txmlns:viewerComponent=\"http://xmlns.jcp.org/jsf/composite/components\"\n\txmlns:widgetComponent=\"http://xmlns.jcp.org/jsf/composite/components/widgets\">\n\n\t<!-- USER COMMENTS -->\n\t<ui:fragment\n\t\trendered=\"#{activeDocumentBean.allowUserComments}\">\n\t\t<div id=\"userComments\" class=\"user-comments\">\n\t\t\t<!-- USER NOT LOGGED IN -->\n\t\t\t<ui:fragment rendered=\"#{!userBean.loggedIn}\">\n\t\t\t\t<div class=\"user-comments__message-login\">\n\t\t\t\t\t<h2 >#{msg.commentAdd}</h2>\n\n\t\t\t\t\t<h:outputText value=\"#{msg.commentDescription} \" escape=\"false\" />\n\n\t\t\t\t\t<br />\n\n\t\t\t\t\t<!-- TOGGLE LOGIN -->\n\t\t\t\t\t<button type=\"button\" class=\"btn btn--link\" data-toggle=\"modal\"\n\t\t\t\t\t\tdata-target=\"#userLoginModal\" aria-label=\"#{msg.userNotLoggedIn}\">\n\t\t\t\t\t\t<span>#{msg.login}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</ui:fragment>\n\n\t\t\t<h:form id=\"userCommentsForm\" prependId=\"false\">\n\t\t\t\t<ui:fragment rendered=\"#{userBean.loggedIn}\">\n\t\t\t\t\t<h2 >#{msg.userComments}</h2>\n\t\t\t\t</ui:fragment>\n\n\t\t\t\t<!-- EXISTING COMMENTS -->\n\t\t\t\t<ui:repeat var=\"comment\"  varStatus=\"status\"\n\t\t\t\t\tvalue=\"#{commentBean.commentsForCurrentPage}\">\n\t\t\t\t\t<div class=\"user-comments__comment\">\n\n\t\t\t\t\t<!-- START BLOCK - AUTHOR IMAGE/COMMENT INFO -->\n\t\t\t\t\t<div class=\"user-comments__comment-info\">\n\n\t\t\t\t\t\t<!-- USER IMAGE -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-image\">\n\t\t\t\t\t\t\t<img src=\"#{comment.creator.avatarUrl}\" alt=\"User avatar\" />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- COMMENT METADATA -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-metadata\">\n\t\t\t\t\t\t\t<span class=\"user-comments__comment-metadata-creator\">\n\t\t\t\t\t\t\t    #{comment.creator.displayNameEscaped}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class=\"user-comments__comment-metadata-date\">#{navigationHelper.getLocalDate(comment.dateCreated)}</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- COMMENT CONTENT -->\n\t\t\t\t\t\t<div class=\"user-comments__comment-content\">\n\t\t\t\t\t\t\t<!-- CONTENT LOADER -->\n\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-loader\"></div>\n\n\t\t\t\t\t\t\t<!-- COMMENT OPTIONS -->\n\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\trendered=\"#{userBean.loggedIn or comment.dateModified != null}\">\n\t\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-options\">\n\n\t\t\t\t\t\t\t\t\t<!-- LAST CHANGE -->\n\t\t\t\t\t\t\t\t\t<h:panelGroup rendered=\"#{comment.dateModified != null}\"\n\t\t\t\t\t\t\t\t\t\tstyleClass=\"user-comments__comment-content-options-last-change\">\n                                        #{msg.lastEdited} #{navigationHelper.getLocalDate(comment.dateModified)}\n                                    </h:panelGroup>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ui:fragment>\n\n\t\t\t\t\t\t\t\t<!-- COMMENT TEXT -->\n\t\t\t\t\t\t\t\t<div class=\"user-comments__comment-content-text in\">\n\t\t\t\t\t\t\t\t\t<h:outputText value=\"#{comment.displayText}\" escape=\"true\" />\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<!-- EDIT COMMENT -->\n\t\t\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\t\t\trendered=\"#{userBean.user == comment.creator or commentBean.isMayEditCommentsForRecord(activeDocumentBean.viewManager.pi)}\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"user-comments__action-wrapper\">\n\t\t\t\t\t\t\t\t\t\t\t<!-- TRIGGER EDIT COMMENT MODAL -->\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn--clean user-comments__edit-comment-button\" type=\"button\" data-backdrop=\"false\" data-toggle=\"modal\" data-target=\"#modalUserCommentEdit-#{comment.id}-modal\">\n\t\t\t\t\t\t\t\t\t\t\t  #{msg.edit}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t\t<!-- DELETE COMMENT -->\n\t\t\t\t\t\t\t\t\t\t\t<ui:fragment\n\t\t\t\t\t\t\t\t\t\t\t\trendered=\"#{userBean.user == comment.creator or commentBean.isMayDeleteCommentsForRecord(activeDocumentBean.viewManager.pi)}\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"user-comments__delete-comment-button\" type=\"button\" data-delete=\"comment-#{comment.id}\">\n\t\t\t\t\t\t\t\t\t\t\t\t  #{msg.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</ui:fragment>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</ui:fragment>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id=\"modalUserCommentEdit-#{comment.id}\" modalid=\"modalUserCommentEdit-#{comment.id}-modal\" styleclass=\"user-comments-modal\" title=\"#{msg.userCommentEdit}\">\n\t\t\t\t\t\t<yield to=\"body\">\n\t\t\t\t\t\t<div class=\"row\">\n<!-- \t\t\t\t\t\t\t\t<div class=\"col-12 col-md-3\">#{msg.userCommentText}:</div> -->\n\t\t\t\t\t\t\t\t<div class=\"col-12 user-comments__comment-content-options-text-edit\">\n\t\t\t\t\t\t\t\t\t<textarea id=\"modalUserCommentEdit-#{comment.id}-text\">#{comment.text}</textarea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</yield>\n\t\t\t\t\t\t<yield to=\"footer\">\n\t\t\t\t\t\t\t<button id=\"modalUserCommentEdit-#{comment.id}-cancel\" class=\"btn\" data-dismiss=\"modal\">#{msg.cancel}</button>\n\t\t\t\t\t\t\t<button id=\"modalUserCommentEdit-#{comment.id}-ok\" class=\"btn btn--success accept ml-3\" data-dismiss=\"modal\">#{msg.save}</button>\n\t\t\t\t\t\t</yield>\n\t\t\t\t\t</div>\n\t\t\t\t\t<h:commandScript name=\"editComment\" action=\"#{commentBean.editComment}\" render=\"@form\"\n\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentEditSuccess}&quot;)\"\n\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\t\t\t\t\t<h:commandScript name=\"deleteComment\" action=\"#{commentBean.deleteComment}\" render=\"@form\"\n\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentDeleteSuccess}&quot;)\"\n\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\n\t\t\t\t\t<script>\n\t\t\t\t\t\triot.mount(\"#modalUserCommentEdit-#{comment.id}\", \"modal\", {});\n\t\t\t\t\t\t$(\"#modalUserCommentEdit-#{comment.id}-ok\").on(\"click\", () => {\n\t\t\t\t\t\t    let val = $(\"#modalUserCommentEdit-#{comment.id}-text\").val();\n\t\t\t\t\t\t    editComment({id:\"#{comment.id}\", text:val});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t$('[data-delete=\"comment-#{comment.id}\"]').on('click', function() {\n\t\t\t\t\t\t\tviewerJS.notifications.confirm('', '' ,'', '#{msg.userCommentDeleteText}')\n\t\t\t\t\t\t\t\t.then((result) => deleteComment({id:\"#{comment.id}\"}))\n\t\t\t\t\t\t\t\t.catch(() => {});\n\t\t\t\t\t\t});\n\t\t\t\t\t</script>\n\n\t\t\t\t</ui:repeat>\n\n\t\t\t\t<!-- ADD COMMENT -->\n\t\t\t\t<ui:fragment rendered=\"#{userBean.loggedIn}\">\n\t\t\t\t\t<div class=\"user-comments__add-comment\">\n\t\t\t\t\t\t<label for=\"userCommentAdd\"> <span>#{msg.userCommentAdd}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class=\"user-comments__add-comment-add\">\n\t\t\t\t\t\t\t<h:inputTextarea id=\"userCommentAdd\"\n\t\t\t\t\t\t\t\tvalue=\"#{commentText}\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!-- LICENSE CHECKBOX/PUBLIC COMMENT -->\n\t\t\t\t\t\t<!-- <h:selectBooleanCheckbox id=\"commentLicenseCheckbox\" value=\"#{commentRestricted}\">Restricted</h:selectBooleanCheckbox>-->\n\t\t\t\t\t\t<div class=\"user-comments__add-comment-submit\">\n\t\t\t\t\t\t\t<h:commandButton\n\t\t\t\t\t\t\t\taction=\"#{commentBean.createComment(commentText, commentRestricted)}\"\n\t\t\t\t\t\t\t\tstyleClass=\"btn btn--success\" value=\"#{msg.addNoteText}\">\n\t\t\t\t\t\t\t\t<f:ajax execute=\"userCommentAdd commentLicenseCheckbox\" render=\"@form\"\n\t\t\t\t\t\t\t\tonevent=\"e => viewerJS.swaltoasts.onSuccess(e).success(&quot;#{msg.commentSaveSuccess}&quot;)\"\n\t\t\t\t\t\t\t\tonerror=\"e => viewerJS.swaltoasts.error(e.responseText)\"/>\n\t\t\t\t\t\t\t</h:commandButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</ui:fragment>\n\t\t\t</h:form>\n\t\t</div>\n\n\t\t<script type=\"text/javascript\">\n\n            $( document ).ready( function() {\n                viewerJS.userComments.init();\n\n                jsf.ajax.addOnEvent( function( data ) {\n                    var ajaxstatus = data.status;\n\n                    switch ( ajaxstatus ) {\n                    case \"success\":\n                        viewerJS.userComments.init();\n                        break;\n                    }\n                } );\n            } );\n        </script>\n\t</ui:fragment>\n</ui:composition>\n"], "filenames": ["goobi-viewer-core/src/main/resources/META-INF/resources/resources/includes/user/userComments.xhtml"], "buggy_code_start_loc": [54], "buggy_code_end_loc": [81], "fixing_code_start_loc": [54], "fixing_code_end_loc": [84], "type": "CWE-79", "message": "The Goobi viewer is a web application that allows digitised material to be displayed in a web browser. A cross-site scripting vulnerability has been identified in the user comment feature of Goobi viewer core prior to version 23.03. An attacker could create a specially crafted comment, resulting in the execution of malicious script code in the user's browser when displaying the comment. The vulnerability has been fixed in version 23.03.", "other": {"cve": {"id": "CVE-2023-29015", "sourceIdentifier": "security-advisories@github.com", "published": "2023-04-06T20:15:08.613", "lastModified": "2023-04-13T13:56:00.513", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The Goobi viewer is a web application that allows digitised material to be displayed in a web browser. A cross-site scripting vulnerability has been identified in the user comment feature of Goobi viewer core prior to version 23.03. An attacker could create a specially crafted comment, resulting in the execution of malicious script code in the user's browser when displaying the comment. The vulnerability has been fixed in version 23.03."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:intranda:goobi_viewer_core:*:*:*:*:*:*:*:*", "versionEndExcluding": "23.03", "matchCriteriaId": "F8174D86-7F9F-4ADD-85CA-16EB572F1F26"}]}]}], "references": [{"url": "https://github.com/intranda/goobi-viewer-core/commit/f0ccde2d469efd9597c3062d00177a63341f2256", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/intranda/goobi-viewer-core/security/advisories/GHSA-622w-995c-3c3h", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/intranda/goobi-viewer-core/commit/f0ccde2d469efd9597c3062d00177a63341f2256"}}