{"buggy_code": ["<h2>{HEADING_RESULT}</h2>\r\n<p>{HOWTO_RESULT}</p>\t\r\n<table width=\"98%\" cellspacing=\"0\" border=\"0\" cellpadding=\"5px\" class=\"row_a\">\r\n\t<tr>\r\n\t\t<td style=\"width: 220px;\"><strong>{SEARCH_DETAIL_RESULT}:</strong></td>\r\n\t\t<td><strong>&nbsp;</td>\r\n\t</tr>\r\n<!-- BEGIN searchterm_block -->\r\n\t<tr>\t\t\t\t\r\n\t\t<td>{SEARCH_ITEM_RESULT}:</td>\r\n\t\t<td>{BEGRIFF}</td>\t\t\r\n\t</tr>\r\n\t<tr>\t\t\t\t\r\n\t\t<td>{SEARCH_FIELD_RESULT}:</td>\r\n\t\t<td>{DISPLAYSEARCHFIELD}</td>\t\t\r\n\t</tr>\r\n<!-- END searchterm_block -->\r\n<!-- BEGIN group_block -->\t\r\n\t<tr>\t\t\t\t\r\n\t\t<td>{GROUP_RESULT}:</td>\r\n\t\t<td>{GROUP_NAME}</td>\t\t\r\n\t</tr>\r\n<!-- END group_block -->\r\n<!-- BEGIN last_login_block -->\t\t \r\n\t<tr>\t\t\t\t\r\n\t\t<td>{LAST_LOGIN}:</td>\r\n\t\t<td>{BEFORE_OR_AFTER} {DATE_RESULT}</td>\t\t\r\n\t</tr>\r\n<!-- END last_login_block -->\t\r\n\t<tr>\r\n\t\t<td colspan=\"2\"><br /><strong>{SHOW_RESULT}:</strong></td>\r\n\t</tr>\r\n\t\r\n<!-- BEGIN no_result_block -->\r\n{NO_RESULT}\t\r\n<!-- END no_result_block -->\r\n<!-- BEGIN result_table_block -->\t\r\n<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"0\" style=\"border-collapse: collapse;\">\r\n\t<tr style=\"background-color: #BDCDD9;\">\r\n\t\t<td align=\"right\" style=\"font-weight:bold; border: 1px solid #ccc;\">ID</td>\r\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{USER_NAME}</td>\r\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{REAL_NAME}</td>\r\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{EMAIL}</td>\r\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{LAST_LOGIN}</td>\r\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{LAST_IP}</td>\r\n\t</tr>\r\n<!-- BEGIN result_list_block -->\t\t\r\n\t<tr style=\"background-color: {RESULT_BGCOL}\">\r\n\t\t<td align=\"center\" style=\"border: 1px solid #ccc;\">\r\n\t\t\t<form name=\"edituser{RESULT_USER_ID}\" method=\"post\" action=\"{ADMIN_URL}/users/users.php\" target=\"_blank\">\t\t\t\t\t\t\t\t\r\n\t\t\t<input type=\"hidden\" name=\"user_id\" value=\"{IDKEY_USER_ID}\" />\r\n\t\t\t<input type=\"hidden\" name=\"modify\" value=\"modify\" />\r\n\t\t\t<input type=\"hidden\" name=\"details\" value=\"{RESULT_USER_ID}\" />\r\n\t\t\t<b>{RESULT_USER_ID}</b>\r\n\t\t\t</form>\r\n\t\t</td>\r\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\r\n\t\t\t<a OnClick=\"javascript:if ({RESULT_USER_ID}!=1) { document.edituser{RESULT_USER_ID}.submit();} else {alert('{RESULT_ADMIN_DISABLED}');}; return false;\" HREF=\"#\" title=\"{RESULT_EDIT_USER}: {RESULT_DISPLAYNAME}\">{RESULT_USERNAME}</a>\r\n\t\t</td>\r\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\r\n\t\t{RESULT_DISPLAYNAME}\r\n\t\t</td>\r\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\r\n\t\t\t<a href=\"mailto:{RESULT_EMAIL}\">{RESULT_EMAIL}</a>\r\n\t\t</td>\r\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\r\n\t\t{RESULT_LASTLOGIN}/({RESULT_DAYS_INACTIVE})\r\n\t\t</td>\r\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\r\n\t\t{RESULT_LAST_IP}\r\n\t\t</td>\t\t\t\t\t\t\t\r\n\t</tr>\r\n<!-- END result_list_block -->\t\r\n\t<tr>\r\n\t\t<td colspan=\"6\" style=\"font-size:smaller;\" align=\"center\">{HINT_EDIT}</td>\r\n\t</tr>\r\n</table>\r\n</td>\r\n</tr>\r\n</table>\r\n<!-- END result_table_block -->\r\n\r\n", "<?php\r\n\r\n// $Id: info.php 591 2009-03-01 19:42:05Z BerndJM $\r\n\r\n/*\r\n\r\n Website Baker Project <http://www.websitebaker.org/>\r\n Copyright (C) 2004-2008, Ryan Djurovich\r\n\r\n Website Baker is free software; you can redistribute it and/or modify\r\n it under the terms of the GNU General Public License as published by\r\n the Free Software Foundation; either version 2 of the License, or\r\n (at your option) any later version.\r\n\r\n Website Baker is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n GNU General Public License for more details.\r\n\r\n You should have received a copy of the GNU General Public License\r\n along with Website Baker; if not, write to the Free Software\r\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\r\n -----------------------------------------------------------------------------------------\r\n  v0.41 (marmot; 25.05.2013)\r\n  ! admin url is now set by config.php\r\n  ! notice regarding mktime\r\n \r\n v0.40 (marmot; 22.12.2012)\r\n \t+ made user edit work with wb283 (might not work with wb < 283 anymore) by changing $_POST and introducing IDKEY\r\n \t+ made jscalendar look better by adding backend backend.css file and using time option\r\n \t+ updated DE language file.\r\n\r\n v0.32b (Quinto; 04.04.2009)\r\n \t+ fixed important bug in group selection now it works in ALL the cases even when with combined groups\r\n \t+ source code refining now it use template files (stored in the htt directory), source code is easier to read now.\r\n \t+ added 'days since last connection' and 'Ip address' in results\r\n \t~ we still need to Update DE and Nl language files.\r\n \r\n v0.31b (Quinto; 07.04.2009)\r\n \t+ cosmetic changes to consistency with the Website Baker Admin UI\r\n \t+ some source code refining and added some little thing to help in the future\r\n \t  for example to allow to store the search.\r\n \t+ added functionality to search users according the last login date\r\n \t+ changed the way to work now you can mix all the search criteria (searchterm, date and group)\r\n \t+ added FR language support (support the new functionalities)\r\n \t+ EN language updated to support new functionalities\r\n \t~ now we need to Update DE and Nl language files.\r\n  \t\r\n v0.30 (BerndJM; 24.03.2009)\r\n \t+ added functionality to search als users that are members of a given group \r\n \r\n v0.21 (BerndJM, Aldus, Bramus; 06.03.2009)\r\n \t+ added NL language support (thanks to Bramus)\r\n \t~ some source code refining (tanks to Aldus)\r\n \t\r\n v0.20  (BerndJM; 02.03.2009)\r\n \t+ added language support (DE and EN only)\r\n   ~ some minor cosmetic changes to provide it as an admin-tool\r\n    \r\n v0.10  (BerndJM; 28.02.2009)\r\n   + initial release of the module (for internal use only)\r\n -----------------------------------------------------------------------------------------\r\n*/\r\n\r\n$module_directory = 'user_search';\r\n$module_name = 'User search';\r\n$module_function = 'tool';\r\n$module_version = '0.41';\r\n$module_platform = '2.8.3';\r\n$module_author = 'Bernd Michna';\r\n$module_license = 'GNU General Public License';\r\n$module_description = 'This module provides a search function for the user management.';\r\n$module_guid = 'EE87F4AD-F675-4E44-81EE-91B8D491977B';", "<?php\n\n// $Id: DE.php 695 2008-02-10 18:45:07Z Ruebenwurzel $\n\n/*\n\n Website Baker Project <http://www.websitebaker.org/>\n Copyright (C) 2004-2008, Ryan Djurovich\n\n Website Baker is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n Website Baker is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with Website Baker; if not, write to the Free Software\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n\n -----------------------------------------------------------------------------------------\n  DEUTSCHE SPRACHDATEI FUER DAS MODUL: USER_SEARCH\n -----------------------------------------------------------------------------------------\n*/\n\n// Deutsche Modulbeschreibung\n$module_description = 'Dieses Modul bietet eine Suchfunktion f&uuml;r die Benutzerverwaltung.';\n\n// Textausgaben\n$MOD_USER_SEARCH['HEADING']\t\t\t\t= 'Benutzer Suche';\n$MOD_USER_SEARCH['HOWTO']\t\t\t\t= 'Hier sind einige zus&auml;tzliche Funktionen f&uuml;r die Suche.<br />Sie k&ouml;nnen verschiedene Kriterien kombinieren um die Suche zu verbessern. Falls sie ein Kriterium nicht ben&ouml;tigen, lassen Sie es einfach frei.';\n$MOD_USER_SEARCH['SUBMIT_ALERT']\t\t= 'Eine Suche ohne Suchbegriff macht keinen Sinn ;-)';\n$MOD_USER_SEARCH['SUBMIT_TERM_ALERT'] \t= 'Wenn Sie einen Suchberiff angeben, m&uuml;ssen Sie mindestens ein Suchfeld ausw&auml;hlen!';\n$MOD_USER_SEARCH['SEARCH_ITEM']\t\t\t= 'Suchbegriff';\n$MOD_USER_SEARCH['USE_WILDCARD']\t\t= 'Verwenden Sie * als Wildcard.';\n$MOD_USER_SEARCH['SEARCH_HELP']\t\t\t= '<i><b>B&uuml;ch*</b></i> findet \"B&uuml;chner\", aber auch \"B&uuml;cher\".<br /><i><b>*ner</b></i> findet \"B&uuml;chner\", aber auch \"Wagner\".<br /><i><b>*&uuml;ch*</b></i> findet \"B&uuml;chner\", aber auch \"B&uuml;cher\" ebenso wie \"n&uuml;chtern\".<hr size=\"1\" style=\"margin: 5px 0;\" />Gro\u00df-/Kleinschreibung wird nicht ber&uuml;cksichtigt.';\n$MOD_USER_SEARCH['SEARCH_IN']\t\t\t= 'Suchen in';\n$MOD_USER_SEARCH['USER_NAME']\t\t\t= 'Benutzer Name';\n$MOD_USER_SEARCH['EDIT_USER']\t\t\t= 'Klicken Sie um den Anwender zu bearbeiten';\n$MOD_USER_SEARCH['REAL_NAME']\t\t\t= 'Angezeigter Name';\n$MOD_USER_SEARCH['EMAIL']\t\t\t\t= 'Email Adresse';\n$MOD_USER_SEARCH['LAST_IP']\t\t\t\t= 'IP Adresse';\n$MOD_USER_SEARCH['REF_DATE']\t\t\t= 'Bezugsdatum';\n$MOD_USER_SEARCH['REF_DATE_LAST_LOGIN'] = 'Wann zuletzt eingeloggt';\n$MOD_USER_SEARCH['USE_CALENDAR']\t\t= 'Nutzen Sie den Kalender um ein Datum einzugeben';\n$MOD_USER_SEARCH['REF_DATE_AFTER']\t\t= 'Nach diesem Datum';\n$MOD_USER_SEARCH['REF_DATE_BEFORE']\t\t= 'Vor diesem Datum';\n$MOD_USER_SEARCH['SEARCH_GROUPS']\t\t= 'Suche alle Benutzer in dieser Gruppe';\n$MOD_USER_SEARCH['IN_ALL_GROUPS']\t\t= 'Alle Gruppen';\n$MOD_USER_SEARCH['BUTTON_SEARCH']\t\t= 'suchen';\n$MOD_USER_SEARCH['HEADING_RESULT']\t\t= 'Ergebnisse der Suche';\n$MOD_USER_SEARCH['HOWTO_RESULT']\t\t= 'Ihre Suche wird hier angezeigt.<br />Sie k&ouml;nnen Anwender dirket von dieser Seite aus kontaktieren oder bearbeiten';\n$MOD_USER_SEARCH['SEARCH_DETAIL_RESULT']= 'Suchkriterien';\n$MOD_USER_SEARCH['DATE_AFTER_RESULT']\t= 'Nach dem';\n$MOD_USER_SEARCH['DATE_BEFORE_RESULT']\t= 'Vor dem';\n$MOD_USER_SEARCH['SEARCH_ITEM_RESULT']\t= 'Suchbegriff(e)';\n$MOD_USER_SEARCH['SEARCH_FIELD_RESULT'] = 'Betrifft die Felder';\n$MOD_USER_SEARCH['GROUP_RESULT']\t\t= 'Alle Benutzer der Gruppe';\n$MOD_USER_SEARCH['NO_RESULT']\t\t\t= 'Die Suchanfrage ergab leider kein Ergebnis.';\n$MOD_USER_SEARCH['HINT_EDIT']\t\t\t= 'Klick auf ID = Bearbeiten | Klick auf Email = Email schicken | (D) = Tage sei dem letzten Login';\n$MOD_USER_SEARCH['LAST_LOGIN']\t\t\t= 'Letztes Login';\n$MOD_USER_SEARCH['LAST_LOGIN_D']\t\t= 'Letztes Login/(D)';\n$MOD_USER_SEARCH['NEW_SEARCH']\t\t\t= 'Neue Suche';\n$MOD_USER_SEARCH['SHOW_RESULT']\t\t\t= 'Anzeige der Ergebnisse';\n$MOD_USER_SEARCH['CALENDAR']\t\t\t= 'Kalender';\n$MOD_USER_SEARCH['ERASE_DATE']\t\t\t= 'Datum l&ouml;schen';\n$MOD_USER_SEARCH['ADMIN_DISABLED']\t\t\t= 'Das Editieren der Administratorkennung ist aus Sicherheitsgr&uuml;nden deaktiviert';\n\n\n\n", "<?php\r\n\r\n// $Id: tool.php 591 2009-03-01 19:42:05Z BerndJM $\r\n\r\n/*\r\n\r\n Website Baker Project <http://www.websitebaker.org/>\r\n Copyright (C) 2004-2008, Ryan Djurovich\r\n\r\n Website Baker is free software; you can redistribute it and/or modify\r\n it under the terms of the GNU General Public License as published by\r\n the Free Software Foundation; either version 2 of the License, or\r\n (at your option) any later version.\r\n\r\n Website Baker is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n GNU General Public License for more details.\r\n\r\n You should have received a copy of the GNU General Public License\r\n along with Website Baker; if not, write to the Free Software\r\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\r\n\r\n*/\r\n\r\n\r\n\r\n// prevent this file from being accessed directly\r\ndefined('WB_PATH') OR die(header('Location: ../../index.php'));\r\n\r\n\r\nrequire_once(WB_PATH . '/framework/module.functions.php');\r\n\r\n\r\n// include jscalendar-setup\r\n$jscal_use_time = true; // whether to use a clock, too\r\nrequire_once(WB_PATH.\"/include/jscalendar/wb-setup.php\");\r\nrequire_once(WB_PATH.\"/include/jscalendar/jscalendar-functions.php\");\r\n\r\n/**\r\n * Include Website Baker template parser and configure it\r\n */\r\n// include template class and initiate object (set template folder: \"./htt\")\r\nrequire_once(WB_PATH . '/include/phplib/template.inc');\r\n$tpl = new Template(dirname(__FILE__) . '/htt');\r\n\r\n// configure handling of unknown {variables} (remove:=default, keep, comment)\r\n$tpl->set_unknowns('remove');\r\n\r\n// configure debug mode (0:= default, 1:=variable assignments, 2:=calls to get variable, 4:=show internals)\r\n$tpl->debug = 0;\r\n\r\nif (!isset($_POST['search'])) { \r\n\t// Show usersearch form\r\n\t\r\n\t// set template file (assign file \"backend_view.htt\" to variable/handle \"page\")\r\n\t$tpl->set_file('page', 'usersearch_form.htt');\r\n\t\r\n\t// set blocks (NOTE: always start with the inner most block first)\r\n\t// parameters: file variable/handle of file containing the block, block name in the file, new variable/handle for the block)\r\n\t$tpl->set_block('page', 'groupsearch_block','groupsearch_block_handle');\t\r\n\r\n\t// System variables \r\n\t// Think to compare WB_URL and ADMIN_URL\t\r\n\t$tpl->set_var('WB_URL', WB_URL);\r\n\t$tpl->set_var('ADMIN_URL', ADMIN_URL);\r\n\t$tpl->set_var('FORM_VALID_URL', $_SERVER['REQUEST_URI']);\r\n\t$tpl->set_var('JSCAL_IFFORMAT', $jscal_ifformat);\r\n\t$tpl->set_var('JSCAL_FIRSTDAY', $jscal_firstday);\r\n\t$tpl->set_var('JSCAL_TODAY', $jscal_today);\t\r\n\t$tpl->set_var('CALENDAR', $MOD_USER_SEARCH['CALENDAR']);\r\n\t$tpl->set_var('ERASE_DATE', $MOD_USER_SEARCH['ERASE_DATE']);\r\n\t\r\n\t// try $_PHP_SELF if REQUEST_URI don't work\r\n\r\n\t$tpl->set_var('SUBMIT_ALERT', $MOD_USER_SEARCH['SUBMIT_ALERT']);\r\n\t$tpl->set_var('SUBMIT_TERM_ALERT', $MOD_USER_SEARCH['SUBMIT_TERM_ALERT']);\r\n\t$tpl->set_var('HEADING', $MOD_USER_SEARCH['HEADING']);\r\n\t$tpl->set_var('HOWTO', $MOD_USER_SEARCH['HOWTO']);\r\n\t$tpl->set_var('SEARCH_ITEM', $MOD_USER_SEARCH['SEARCH_ITEM']);\r\n\t$tpl->set_var('SEARCH_HELP', $MOD_USER_SEARCH['SEARCH_HELP']);\r\n\t$tpl->set_var('USE_WILDCARD', $MOD_USER_SEARCH['USE_WILDCARD']);\t\r\n\t$tpl->set_var('SEARCH_IN', $MOD_USER_SEARCH['SEARCH_IN']);\r\n\t$tpl->set_var('USER_NAME', $MOD_USER_SEARCH['USER_NAME']);\r\n\t$tpl->set_var('REAL_NAME', $MOD_USER_SEARCH['REAL_NAME']);\r\n\t$tpl->set_var('EMAIL', $MOD_USER_SEARCH['EMAIL']);\r\n\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN']);\r\n\t$tpl->set_var('REF_DATE', $MOD_USER_SEARCH['REF_DATE']);\r\n\t$tpl->set_var('USE_CALENDAR', $MOD_USER_SEARCH['USE_CALENDAR']);\r\n\t$tpl->set_var('REF_DATE_LAST_LOGIN', $MOD_USER_SEARCH['REF_DATE_LAST_LOGIN']);\r\n\t$tpl->set_var('REF_DATE_AFTER', $MOD_USER_SEARCH['REF_DATE_AFTER']);\r\n\t$tpl->set_var('REF_DATE_BEFORE', $MOD_USER_SEARCH['REF_DATE_BEFORE']);\r\n\t$tpl->set_var('SEARCH_GROUPS', $MOD_USER_SEARCH['SEARCH_GROUPS']);\r\n\t$tpl->set_var('SEARCH_IN', $MOD_USER_SEARCH['SEARCH_IN']);\r\n\t$tpl->set_var('IN_ALL_GROUPS', $MOD_USER_SEARCH['IN_ALL_GROUPS']);\r\n\t$tpl->set_var('NO_RESULT', $MOD_USER_SEARCH['NO_RESULT']);\r\n\t$tpl->set_var('BUTTON_SEARCH', $MOD_USER_SEARCH['BUTTON_SEARCH']);\r\n\t\r\n\t// Show all groups\r\n\r\n\t// access database and obtain groups\r\n\t$results = $database->query(\"SELECT * FROM `\".TABLE_PREFIX.\"groups`\"); \r\n\tif ($results && $results->numRows() > 0) {\r\n\t\twhile($row = $results->fetchRow()) {\r\n\t\t\t$tpl->set_var(\r\n\t\t\tarray(\t\r\n\t\t\t\t'GROUP_ID'\t\t\t=>$row['group_id'],\r\n\t\t\t\t'GROUP_NAME'\t\t=>$row['name']\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\t// add template values in append mode (add per loop)\r\n\t\t\t$tpl->parse('groupsearch_block_handle', 'groupsearch_block', true);\r\n\t\t}\r\n\t}\r\n} \r\nelse {\t\r\n\t// Show the result form\t\r\n\t//initialising the default values\r\n\t$wheretosearch = 0;\r\n\t$item = \"\";\r\n\t$g_id = \"\";\r\n\t$resultquery = \"\";\r\n\t$displaysearchfield = \"\";\r\n\t\r\n\t//xmlstoresearch will contain the query in xml format (to store and load search)\r\n\t$xmlstoresearch = \"\";\r\n\t\r\n\t// if a search term was entered make the regexp and build the \"LIKE\" query\t\r\n\tif ($_POST['begriff']!=\"\"){\r\n\t\tif (isset($_POST['username']))\t$wheretosearch += 1; \r\n\t\tif (isset($_POST['realname']))  $wheretosearch += 2;\r\n\t\tif (isset($_POST['email']))\t\t$wheretosearch += 4;\r\n\t\t\r\n\t\t//$item = $admin->add_slashes($admin->get_post('begriff'));\r\n\t\t\r\n\t\t$xmlstoresearch .= \"<searchterm>\".$admin->add_slashes($admin->get_post('begriff')).\"</searchterm>\";\r\n\t\t$item = str_replace(\"*\", '%', $admin->add_slashes($admin->get_post('begriff')));\r\n\t\t\r\n\t\r\n\t\tswitch($wheretosearch) {\r\n\t\t\tcase 1:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\t\r\n\t\t\t\t$resultquery = \"(display_name LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<realname>true</realname>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['REAL_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR display_name LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><realname>true</realname>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['REAL_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\t\r\n\t\t\t\t$resultquery = \"(email LIKE '\".$item.\"'\";\r\n\t\t\t\t$xmlstoresearch .= \"<email>true</email>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><email>true</email>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\t\r\n\t\t\t\t$resultquery = \"(display_name LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<realname>true</realname><email>true</email>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['REAL_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR display_name LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><realname>true</realname><email>true</email>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['REAL_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\tdefault: \r\n\t\t\t\t$resultquery = \"\";\r\n\t\t}\t\r\n\t}\r\n\t\r\n\t\r\n\t// if a date was entered modify the sql query\t\r\n\tif (isset($_POST['comp_date'])&&($_POST['comp_date']!=\"\")){\r\n\t\tif ($resultquery!=\"\") $resultquery .= \") AND\";\r\n\t\t$resultquery .= \" (login_when\";\r\n\t\t$xmlstoresearch .= \"<datelastlogin>\";\r\n\t\tif ($_POST['datesearch']==\"after\") {\r\n\t\t\t$resultquery .= \">\";\r\n\t\t\t$xmlstoresearch .= \"<after>true</after>\";\t\t\t\t\r\n\t\t}else{ \r\n\t\t\t$resultquery .= \"<\";\r\n\t\t\t$xmlstoresearch .= \"<before>true</before>\";\r\n\t\t}\r\n\t\t// convert date to timestamp format to compare\r\n\t\t$resultquery .= jscalendar_to_timestamp($_POST['comp_date'],TIMEZONE);\r\n\t\t$xmlstoresearch .= \"<date>\".jscalendar_to_timestamp($_POST['comp_date'],TIMEZONE).\"</date>\";\r\n\t\t$xmlstoresearch .= \"</datelastlogin>\";\r\n\t\t}\r\n\t\r\n\t// if a group was choosen modify the sql query\r\n\tif (isset($_POST['groups'])&&($_POST['groups']!=\"-1\")) {\r\n\t\t$g_id = $_POST['groups'];\r\n\t\tif ($resultquery!=\"\") $resultquery .= \") AND\";\r\n\t\t$g_id = str_replace(\",\", '%', $g_id);\r\n\t\t$resultquery .= \" (groups_id LIKE '%$g_id%'\";\r\n\t\t$xmlstoresearch .= \"<idgroup>\".$g_id.\"</idgroup>\";\r\n\t\t\r\n\t\t// retrieve the group name\r\n\t\t$group_name = mysql_fetch_assoc(mysql_query (\"SELECT name from `\".TABLE_PREFIX.\"groups` WHERE group_id = '$g_id'\"));\r\n\t\t$xmlstoresearch .= \"<groupname>\".$group_name[\"name\"].\"</groupname>\";\r\n\t\t}\r\n\t\t\r\n\t$results = $database->query(\"SELECT * FROM `\".TABLE_PREFIX.\"users` WHERE \".$resultquery.\")\");\r\n\r\n\t// set template file (assign file \"backend_view.htt\" to variable/handle \"page\")\r\n\t$tpl->set_file('page', 'usersearch_result.htt');\r\n\t\r\n\t// set blocks (NOTE: always start with the inner most block first)\r\n\t// parameters: file variable/handle of file containing the block, block name in the file, new variable/handle for the block)\r\n\t$tpl->set_block('page', 'no_result_block','no_result_block_handle');\t\r\n\t$tpl->set_block('page', 'last_login_block','last_login_block_handle');\r\n\t$tpl->set_block('page', 'group_block','group_block_handle');\r\n\t$tpl->set_block('page', 'searchterm_block','searchterm_block_handle');\r\n\r\n\t$tpl->set_block('page', 'result_list_block','result_list_block_handle');\t\r\n\t$tpl->set_block('page', 'result_table_block','result_table_block_handle');\r\n\t\r\n\tif ($database->is_error()) { \r\n\t\t// echo '<p style=\"color: #CC0000;\">'.$database->get_error().'</p>';\r\n\t} \r\n\telse {\t\r\n\t\t$anzahl = $results->numRows();\r\n\t\t\r\n\t$tpl->set_var('HEADING_RESULT', $MOD_USER_SEARCH['HEADING_RESULT']);\r\n\t$tpl->set_var('HOWTO_RESULT', $MOD_USER_SEARCH['HOWTO_RESULT']);\t\t\r\n\t$tpl->set_var('SEARCH_DETAIL_RESULT', $MOD_USER_SEARCH['SEARCH_DETAIL_RESULT']);\r\n\r\n\t\tif ($wheretosearch != 0) {\r\n\t\t\t// display if a search term was entered\r\n\t\t\t$tpl->set_var('SEARCH_ITEM_RESULT', $MOD_USER_SEARCH['SEARCH_ITEM_RESULT']);\r\n\t\t\t$tpl->set_var('BEGRIFF', $admin->add_slashes($admin->get_post('begriff')));\r\n\t\t\t$tpl->set_var('SEARCH_FIELD_RESULT', $MOD_USER_SEARCH['SEARCH_FIELD_RESULT']);\r\n\t\t\t$tpl->set_var('DISPLAYSEARCHFIELD', $displaysearchfield);\r\n\t\t\t$tpl->parse('searchterm_block_handle', 'searchterm_block');\r\n\t\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('searchterm_block_handle', '');\r\n\t\t\t}\t\r\n\t\r\n\t\tif ($g_id != \"\") {\r\n\t\t\t// display if a group was choosen\r\n\t\t\t$tpl->set_var('GROUP_RESULT', $MOD_USER_SEARCH['GROUP_RESULT']);\t\t\t\r\n\t\t\t$tpl->set_var('GROUP_NAME', $group_name[\"name\"]);\r\n\t\t\t$tpl->parse('group_block_handle', 'group_block');\r\n\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('group_block_handle', '');\r\n\t\t\t}\r\n\t\t \r\n\t\tif (isset($_POST['comp_date'])&&($_POST['comp_date']!=\"\")) {\r\n\t\t\t// display if a date of last login was entered\r\n\t\t\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN']);\t\t\t\r\n\t\t\tif ($_POST['datesearch']==\"after\") $tpl->set_var('BEFORE_OR_AFTER', $MOD_USER_SEARCH['DATE_AFTER_RESULT']);\r\n\t\t\telse $tpl->set_var('BEFORE_OR_AFTER', $MOD_USER_SEARCH['DATE_BEFORE_RESULT']);\r\n\t\t\t$tpl->set_var('DATE_RESULT', $_POST['comp_date']);\r\n\t\t\t$tpl->parse('last_login_block_handle', 'last_login_block');\t\t\r\n\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('last_login_block', '');\r\n\t\t\t}\r\n\t\t\t\t\t\r\n\t\t$tpl->set_var('SHOW_RESULT', $MOD_USER_SEARCH['SHOW_RESULT']);\r\n\r\n\t\t\r\n\t\tif ($anzahl == 0) {\r\n\t\t\t// if the search return no values\r\n\t\t\t$tpl->set_var('NO_RESULT', $MOD_USER_SEARCH['NO_RESULT']);\r\n\t\t\t$tpl->parse('no_result_block_handle', 'no_result_block');\t\t\r\n\t\t\t} \r\n\t\telse \r\n\t\t\t{\r\n\t\t\t// clear the block if not required\t\t\t\t\r\n\t\t\t$tpl->set_var('no_result_block_handle', '');\r\n\r\n\t\t\t$tpl->set_var('USER_NAME', $MOD_USER_SEARCH['USER_NAME']);\r\n\t\t\t$tpl->set_var('REAL_NAME', $MOD_USER_SEARCH['REAL_NAME']);\r\n\t\t\t$tpl->set_var('EMAIL', $MOD_USER_SEARCH['EMAIL']);\r\n\t\t\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN_D']);\t\t\t\t\t\t\r\n\t\t\t$tpl->set_var('LAST_IP', $MOD_USER_SEARCH['LAST_IP']);\r\n\t\t\t$rowcnt = 1;\r\n\t\t\t\r\n\t\t\twhile($d = $results->fetchRow()) {\r\n\t\t\t\t\r\n\t\t\t\tif ($d['login_when'] == 0) {\r\n\t\t\t\t\t$lastlogin = '-';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t$lastlogin = gmdate(DATE_FORMAT.\" \".TIME_FORMAT, $d['login_when'] + TIMEZONE);\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$bgcol = ($rowcnt++ % 2 == 0) ? '#EEE' : '#FFF';\r\n\t\t\t\t\r\n\t\t\t\t$tpl->set_var('WB_URL', WB_URL);\r\n\t\t\t\t$tpl->set_var('ADMIN_URL', ADMIN_URL);\r\n\t\t\t\t$tpl->set_var('RESULT_EDIT_USER', $MOD_USER_SEARCH['EDIT_USER']);\r\n\t\t\t\t$tpl->set_var('RESULT_ADMIN_DISABLED', $MOD_USER_SEARCH['ADMIN_DISABLED']);\r\n\t\t\t\t$tpl->set_var('RESULT_BGCOL', $bgcol);\t\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_USER_ID', $d['user_id']);\t\r\n\t\t\t\t$tpl->set_var('IDKEY_USER_ID', $admin->getIDKEY($d['user_id']));\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_USERNAME', $d['username']);\r\n\t\t\t\t$tpl->set_var('RESULT_DISPLAYNAME', $d['display_name']);\t\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_EMAIL', $d['email']);\r\n\t\t\t\t$tpl->set_var('RESULT_LASTLOGIN', $lastlogin);\r\n\t\t\t\t$tpl->set_var('RESULT_DAYS_INACTIVE', ($d['login_when'] == 0) ? '-' : round((time() - (int) $d['login_when']) / (3600 * 24)));\r\n\t\t\t\t$tpl->set_var('RESULT_LAST_IP', $d['login_ip']);\r\n\r\n\r\n\t\t\t\t// add template values in append mode (add per loop)\r\n\t\t\t\t$tpl->parse('result_list_block_handle', 'result_list_block', true);\t\t\t\t\t\r\n\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t$tpl->set_var('HINT_EDIT', $MOD_USER_SEARCH['HINT_EDIT']);\t\t\t\t\t\t\t\t\t\r\n\t\t\t// parse the final template block\r\n\t\t\t$tpl->parse('result_table_block_handle', 'result_table_block');\r\n\r\n\t\t\t}\r\n\t\t\t$tpl->set_var('NEW_SEARCH', $MOD_USER_SEARCH['NEW_SEARCH']);\t\r\n\t\t}\r\n}\r\n// ouput the final template\r\n\r\n$tpl->pparse('output', 'page');\r\n\r\n"], "fixing_code": ["<h2>{HEADING_RESULT}</h2>\n<p>{HOWTO_RESULT}</p>\t\n<table width=\"98%\" cellspacing=\"0\" border=\"0\" cellpadding=\"5px\" class=\"row_a\">\n\t<tr>\n\t\t<td style=\"width: 220px;\"><strong>{SEARCH_DETAIL_RESULT}:</strong></td>\n\t\t\n\t</tr>\n<!-- BEGIN searchterm_block -->\n\t<tr>\t\t\t\t\n\t\t<td>{SEARCH_ITEM_RESULT}:</td>\n\t\t<td>{BEGRIFF}</td>\t\t\n\t</tr>\n\t<tr>\t\t\t\t\n\t\t<td>{SEARCH_FIELD_RESULT}:</td>\n\t\t<td>{DISPLAYSEARCHFIELD}</td>\t\t\n\t</tr>\n<!-- END searchterm_block -->\n<!-- BEGIN group_block -->\t\n\t<tr>\t\t\t\t\n\t\t<td>{GROUP_RESULT}:</td>\n\t\t<td>{GROUP_NAME}</td>\t\t\n\t</tr>\n<!-- END group_block -->\n<!-- BEGIN last_login_block -->\t\t \n\t<tr>\t\t\t\t\n\t\t<td>{LAST_LOGIN}:</td>\n\t\t<td>{BEFORE_OR_AFTER} {DATE_RESULT}</td>\t\t\n\t</tr>\n<!-- END last_login_block -->\t\n\t<tr>\n\t\t<td colspan=\"2\"><br /><strong>{SHOW_RESULT}:</strong></td>\n\t</tr>\n\t\n<!-- BEGIN no_result_block -->\n{NO_RESULT}\t\n<!-- END no_result_block -->\n<!-- BEGIN result_table_block -->\t\n<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"0\" style=\"border-collapse: collapse;\">\n\t<tr style=\"background-color: #BDCDD9;\">\n\t\t<td align=\"right\" style=\"font-weight:bold; border: 1px solid #ccc;\">ID</td>\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{USER_NAME}</td>\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{REAL_NAME}</td>\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{EMAIL}</td>\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{LAST_LOGIN}</td>\n\t\t<td style=\"font-weight:bold; border: 1px solid #ccc;\">{LAST_IP}</td>\n\t</tr>\n<!-- BEGIN result_list_block -->\t\t\n\t<tr style=\"background-color: {RESULT_BGCOL}\">\n\t\t<td align=\"center\" style=\"border: 1px solid #ccc;\">\n\t\t\t<form name=\"edituser{RESULT_USER_ID}\" method=\"post\" action=\"{ADMIN_URL}/users/users.php\" target=\"_blank\">\t\t\t\t\t\t\t\t\n\t\t\t<input type=\"hidden\" name=\"user_id\" value=\"{IDKEY_USER_ID}\" />\n\t\t\t<input type=\"hidden\" name=\"modify\" value=\"modify\" />\n\t\t\t<input type=\"hidden\" name=\"details\" value=\"{RESULT_USER_ID}\" />\n\t\t\t<b>{RESULT_USER_ID}</b>\n\t\t\t</form>\n\t\t</td>\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\n\t\t\t<a OnClick=\"javascript:if ({RESULT_USER_ID}!=1) { document.edituser{RESULT_USER_ID}.submit();} else {alert('{RESULT_ADMIN_DISABLED}');}; return false;\" HREF=\"#\" title=\"{RESULT_EDIT_USER}: {RESULT_DISPLAYNAME}\">{RESULT_USERNAME}</a>\n\t\t</td>\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\n\t\t{RESULT_DISPLAYNAME}\n\t\t</td>\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\n\t\t\t<a href=\"mailto:{RESULT_EMAIL}\">{RESULT_EMAIL}</a>\n\t\t</td>\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\n\t\t{RESULT_LASTLOGIN}/({RESULT_DAYS_INACTIVE})\n\t\t</td>\n\t\t<td align=\"left\" style=\"border: 1px solid #ccc;\">\n\t\t{RESULT_LAST_IP}\n\t\t</td>\t\t\t\t\t\t\t\n\t</tr>\n<!-- END result_list_block -->\t\n\t<tr>\n\t\t<td colspan=\"6\" style=\"font-size:smaller;\" align=\"center\">{HINT_EDIT}</td>\n\t</tr>\n</table>\n</td>\n</tr>\n</table>\n<!-- END result_table_block -->\n\n", "<?php\r\n/*\r\n  *\r\n * WBCE CMS\r\n * Way Better Content Editing.\r\n * Visit http://wbce.org to learn more and to join the community.\r\n *\r\n * @copyright Ryan Djurovich (2004-2009)\r\n * @copyright WebsiteBaker Org. e.V. (2009-2015)\r\n * @copyright WBCE Project (2015-)\r\n * @license GNU GPL2 (or any later version)\r\n \r\n  v0.50 (florian; 08.05.2017)\r\n  !fix XSS vulnerability (reported by strukt93@gmail.com)\r\n \r\n  v0.41 (marmot; 25.05.2013)\r\n  ! admin url is now set by config.php\r\n  ! notice regarding mktime\r\n \r\n v0.40 (marmot; 22.12.2012)\r\n \t+ made user edit work with wb283 (might not work with wb < 283 anymore) by changing $_POST and introducing IDKEY\r\n \t+ made jscalendar look better by adding backend backend.css file and using time option\r\n \t+ updated DE language file.\r\n\r\n v0.32b (Quinto; 04.04.2009)\r\n \t+ fixed important bug in group selection now it works in ALL the cases even when with combined groups\r\n \t+ source code refining now it use template files (stored in the htt directory), source code is easier to read now.\r\n \t+ added 'days since last connection' and 'Ip address' in results\r\n \t~ we still need to Update DE and Nl language files.\r\n \r\n v0.31b (Quinto; 07.04.2009)\r\n \t+ cosmetic changes to consistency with the Website Baker Admin UI\r\n \t+ some source code refining and added some little thing to help in the future\r\n \t  for example to allow to store the search.\r\n \t+ added functionality to search users according the last login date\r\n \t+ changed the way to work now you can mix all the search criteria (searchterm, date and group)\r\n \t+ added FR language support (support the new functionalities)\r\n \t+ EN language updated to support new functionalities\r\n \t~ now we need to Update DE and Nl language files.\r\n  \t\r\n v0.30 (BerndJM; 24.03.2009)\r\n \t+ added functionality to search als users that are members of a given group \r\n \r\n v0.21 (BerndJM, Aldus, Bramus; 06.03.2009)\r\n \t+ added NL language support (thanks to Bramus)\r\n \t~ some source code refining (tanks to Aldus)\r\n \t\r\n v0.20  (BerndJM; 02.03.2009)\r\n \t+ added language support (DE and EN only)\r\n   ~ some minor cosmetic changes to provide it as an admin-tool\r\n    \r\n v0.10  (BerndJM; 28.02.2009)\r\n   + initial release of the module (for internal use only)\r\n -----------------------------------------------------------------------------------------\r\n*/\r\n\r\n$module_directory = 'user_search';\r\n$module_name = 'User search';\r\n$module_function = 'tool';\r\n$module_version = '0.50';\r\n$module_platform = '2.8.3';\r\n$module_author = 'Bernd Michna';\r\n$module_license = 'GNU General Public License';\r\n$module_description = 'This module provides a search function for the user management.';\r\n$module_guid = 'EE87F4AD-F675-4E44-81EE-91B8D491977B';", "<?php\n\n// $Id: DE.php 695 2008-02-10 18:45:07Z Ruebenwurzel $\n\n/*\n\n Website Baker Project <http://www.websitebaker.org/>\n Copyright (C) 2004-2008, Ryan Djurovich\n\n Website Baker is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n Website Baker is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with Website Baker; if not, write to the Free Software\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n\n -----------------------------------------------------------------------------------------\n  DEUTSCHE SPRACHDATEI FUER DAS MODUL: USER_SEARCH\n -----------------------------------------------------------------------------------------\n*/\n\n// Deutsche Modulbeschreibung\n$module_description = 'Dieses Modul bietet eine Suchfunktion f&uuml;r die Benutzerverwaltung.';\n\n// Textausgaben\n$MOD_USER_SEARCH['HEADING']\t\t\t\t= 'Benutzer Suche';\n$MOD_USER_SEARCH['HOWTO']\t\t\t\t= 'Hier sind einige zus&auml;tzliche Funktionen f&uuml;r die Suche. <br />Sie k&ouml;nnen verschiedene Kriterien kombinieren um die Suche zu verbessern. Falls sie ein Kriterium nicht ben&ouml;tigen, lassen Sie es einfach frei.';\n$MOD_USER_SEARCH['SUBMIT_ALERT']\t\t= 'Eine Suche ohne Suchbegriff ergibt keinen Sinn ;-)';\n$MOD_USER_SEARCH['SUBMIT_TERM_ALERT'] \t= 'Wenn Sie einen Suchberiff angeben, m&uuml;ssen Sie mindestens ein Suchfeld ausw&auml;hlen!';\n$MOD_USER_SEARCH['SEARCH_ITEM']\t\t\t= 'Suchbegriff';\n$MOD_USER_SEARCH['USE_WILDCARD']\t\t= 'Verwenden Sie * als Wildcard.';\n$MOD_USER_SEARCH['SEARCH_HELP']\t\t\t= '<i><b>B&uuml;ch*</b></i> findet \"B&uuml;chner\", aber auch \"B&uuml;cher\".<br /><i><b>*ner</b></i> findet \"B&uuml;chner\", aber auch \"Wagner\".<br /><i><b>*&uuml;ch*</b></i> findet \"B&uuml;chner\", aber auch \"B&uuml;cher\" ebenso wie \"n&uuml;chtern\".<hr size=\"1\" style=\"margin: 5px 0;\" />Gro\u00df-/Kleinschreibung wird nicht ber&uuml;cksichtigt.';\n$MOD_USER_SEARCH['SEARCH_IN']\t\t\t= 'Suchen in';\n$MOD_USER_SEARCH['USER_NAME']\t\t\t= 'Benutzer Name';\n$MOD_USER_SEARCH['EDIT_USER']\t\t\t= 'Klicken Sie um den Anwender zu bearbeiten';\n$MOD_USER_SEARCH['REAL_NAME']\t\t\t= 'Angezeigter Name';\n$MOD_USER_SEARCH['EMAIL']\t\t\t\t= 'Email Adresse';\n$MOD_USER_SEARCH['LAST_IP']\t\t\t\t= 'IP Adresse';\n$MOD_USER_SEARCH['REF_DATE']\t\t\t= 'Bezugsdatum';\n$MOD_USER_SEARCH['REF_DATE_LAST_LOGIN'] = 'Wann zuletzt eingeloggt';\n$MOD_USER_SEARCH['USE_CALENDAR']\t\t= 'Nutzen Sie den Kalender um ein Datum einzugeben';\n$MOD_USER_SEARCH['REF_DATE_AFTER']\t\t= 'Nach diesem Datum';\n$MOD_USER_SEARCH['REF_DATE_BEFORE']\t\t= 'Vor diesem Datum';\n$MOD_USER_SEARCH['SEARCH_GROUPS']\t\t= 'Suche alle Benutzer in dieser Gruppe';\n$MOD_USER_SEARCH['IN_ALL_GROUPS']\t\t= 'Alle Gruppen';\n$MOD_USER_SEARCH['BUTTON_SEARCH']\t\t= 'suchen';\n$MOD_USER_SEARCH['HEADING_RESULT']\t\t= 'Ergebnisse der Suche';\n$MOD_USER_SEARCH['HOWTO_RESULT']\t\t= 'Ihre Suche wird hier angezeigt.<br />Sie k&ouml;nnen Anwender dirket von dieser Seite aus kontaktieren oder bearbeiten';\n$MOD_USER_SEARCH['SEARCH_DETAIL_RESULT']= 'Suchkriterien';\n$MOD_USER_SEARCH['DATE_AFTER_RESULT']\t= 'Nach dem';\n$MOD_USER_SEARCH['DATE_BEFORE_RESULT']\t= 'Vor dem';\n$MOD_USER_SEARCH['SEARCH_ITEM_RESULT']\t= 'Suchbegriff(e)';\n$MOD_USER_SEARCH['SEARCH_FIELD_RESULT'] = 'Betrifft die Felder';\n$MOD_USER_SEARCH['GROUP_RESULT']\t\t= 'Alle Benutzer der Gruppe';\n$MOD_USER_SEARCH['NO_RESULT']\t\t\t= 'Die Suchanfrage ergab leider kein Ergebnis.';\n$MOD_USER_SEARCH['HINT_EDIT']\t\t\t= 'Klick auf ID = Bearbeiten | Klick auf Email = Email schicken | (D) = Tage sei dem letzten Login';\n$MOD_USER_SEARCH['LAST_LOGIN']\t\t\t= 'Letztes Login';\n$MOD_USER_SEARCH['LAST_LOGIN_D']\t\t= 'Letztes Login/(D)';\n$MOD_USER_SEARCH['NEW_SEARCH']\t\t\t= 'Neue Suche';\n$MOD_USER_SEARCH['SHOW_RESULT']\t\t\t= 'Anzeige der Ergebnisse';\n$MOD_USER_SEARCH['CALENDAR']\t\t\t= 'Kalender';\n$MOD_USER_SEARCH['ERASE_DATE']\t\t\t= 'Datum l&ouml;schen';\n$MOD_USER_SEARCH['ADMIN_DISABLED']\t\t\t= 'Das Editieren der Administratorkennung ist aus Sicherheitsgr&uuml;nden deaktiviert';\n\n\n\n", "<?php\r\n\r\n// $Id: tool.php 591 2009-03-01 19:42:05Z BerndJM $\r\n\r\n/*\r\n\r\n Website Baker Project <http://www.websitebaker.org/>\r\n Copyright (C) 2004-2008, Ryan Djurovich\r\n\r\n Website Baker is free software; you can redistribute it and/or modify\r\n it under the terms of the GNU General Public License as published by\r\n the Free Software Foundation; either version 2 of the License, or\r\n (at your option) any later version.\r\n\r\n Website Baker is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n GNU General Public License for more details.\r\n\r\n You should have received a copy of the GNU General Public License\r\n along with Website Baker; if not, write to the Free Software\r\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\r\n\r\n*/\r\n\r\n\r\n\r\n// prevent this file from being accessed directly\r\ndefined('WB_PATH') OR die(header('Location: ../../index.php'));\r\n\r\n\r\nrequire_once(WB_PATH . '/framework/module.functions.php');\r\n\r\n\r\n// include jscalendar-setup\r\n$jscal_use_time = true; // whether to use a clock, too\r\nrequire_once(WB_PATH.\"/include/jscalendar/wb-setup.php\");\r\nrequire_once(WB_PATH.\"/include/jscalendar/jscalendar-functions.php\");\r\n\r\n/**\r\n * Include Website Baker template parser and configure it\r\n */\r\n// include template class and initiate object (set template folder: \"./htt\")\r\nrequire_once(WB_PATH . '/include/phplib/template.inc');\r\n$tpl = new Template(dirname(__FILE__) . '/htt');\r\n\r\n// configure handling of unknown {variables} (remove:=default, keep, comment)\r\n$tpl->set_unknowns('remove');\r\n\r\n// configure debug mode (0:= default, 1:=variable assignments, 2:=calls to get variable, 4:=show internals)\r\n$tpl->debug = 0;\r\n\r\nif (!isset($_POST['search'])) { \r\n\t// Show usersearch form\r\n\t\r\n\t// set template file (assign file \"backend_view.htt\" to variable/handle \"page\")\r\n\t$tpl->set_file('page', 'usersearch_form.htt');\r\n\t\r\n\t// set blocks (NOTE: always start with the inner most block first)\r\n\t// parameters: file variable/handle of file containing the block, block name in the file, new variable/handle for the block)\r\n\t$tpl->set_block('page', 'groupsearch_block','groupsearch_block_handle');\t\r\n\r\n\t// System variables \r\n\t// Think to compare WB_URL and ADMIN_URL\t\r\n\t$tpl->set_var('WB_URL', WB_URL);\r\n\t$tpl->set_var('ADMIN_URL', ADMIN_URL);\r\n\t$tpl->set_var('FORM_VALID_URL', $_SERVER['REQUEST_URI']);\r\n\t$tpl->set_var('JSCAL_IFFORMAT', $jscal_ifformat);\r\n\t$tpl->set_var('JSCAL_FIRSTDAY', $jscal_firstday);\r\n\t$tpl->set_var('JSCAL_TODAY', $jscal_today);\t\r\n\t$tpl->set_var('CALENDAR', $MOD_USER_SEARCH['CALENDAR']);\r\n\t$tpl->set_var('ERASE_DATE', $MOD_USER_SEARCH['ERASE_DATE']);\r\n\t\r\n\t// try $_PHP_SELF if REQUEST_URI don't work\r\n\r\n\t$tpl->set_var('SUBMIT_ALERT', $MOD_USER_SEARCH['SUBMIT_ALERT']);\r\n\t$tpl->set_var('SUBMIT_TERM_ALERT', $MOD_USER_SEARCH['SUBMIT_TERM_ALERT']);\r\n\t$tpl->set_var('HEADING', $MOD_USER_SEARCH['HEADING']);\r\n\t$tpl->set_var('HOWTO', $MOD_USER_SEARCH['HOWTO']);\r\n\t$tpl->set_var('SEARCH_ITEM', $MOD_USER_SEARCH['SEARCH_ITEM']);\r\n\t$tpl->set_var('SEARCH_HELP', $MOD_USER_SEARCH['SEARCH_HELP']);\r\n\t$tpl->set_var('USE_WILDCARD', $MOD_USER_SEARCH['USE_WILDCARD']);\t\r\n\t$tpl->set_var('SEARCH_IN', $MOD_USER_SEARCH['SEARCH_IN']);\r\n\t$tpl->set_var('USER_NAME', $MOD_USER_SEARCH['USER_NAME']);\r\n\t$tpl->set_var('REAL_NAME', $MOD_USER_SEARCH['REAL_NAME']);\r\n\t$tpl->set_var('EMAIL', $MOD_USER_SEARCH['EMAIL']);\r\n\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN']);\r\n\t$tpl->set_var('REF_DATE', $MOD_USER_SEARCH['REF_DATE']);\r\n\t$tpl->set_var('USE_CALENDAR', $MOD_USER_SEARCH['USE_CALENDAR']);\r\n\t$tpl->set_var('REF_DATE_LAST_LOGIN', $MOD_USER_SEARCH['REF_DATE_LAST_LOGIN']);\r\n\t$tpl->set_var('REF_DATE_AFTER', $MOD_USER_SEARCH['REF_DATE_AFTER']);\r\n\t$tpl->set_var('REF_DATE_BEFORE', $MOD_USER_SEARCH['REF_DATE_BEFORE']);\r\n\t$tpl->set_var('SEARCH_GROUPS', $MOD_USER_SEARCH['SEARCH_GROUPS']);\r\n\t$tpl->set_var('SEARCH_IN', $MOD_USER_SEARCH['SEARCH_IN']);\r\n\t$tpl->set_var('IN_ALL_GROUPS', $MOD_USER_SEARCH['IN_ALL_GROUPS']);\r\n\t$tpl->set_var('NO_RESULT', $MOD_USER_SEARCH['NO_RESULT']);\r\n\t$tpl->set_var('BUTTON_SEARCH', $MOD_USER_SEARCH['BUTTON_SEARCH']);\r\n\t\r\n\t// Show all groups\r\n\r\n\t// access database and obtain groups\r\n\t$results = $database->query(\"SELECT * FROM `\".TABLE_PREFIX.\"groups`\"); \r\n\tif ($results && $results->numRows() > 0) {\r\n\t\twhile($row = $results->fetchRow()) {\r\n\t\t\t$tpl->set_var(\r\n\t\t\tarray(\t\r\n\t\t\t\t'GROUP_ID'\t\t\t=>$row['group_id'],\r\n\t\t\t\t'GROUP_NAME'\t\t=>$row['name']\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\t// add template values in append mode (add per loop)\r\n\t\t\t$tpl->parse('groupsearch_block_handle', 'groupsearch_block', true);\r\n\t\t}\r\n\t}\r\n} \r\nelse {\t\r\n\t// Show the result form\t\r\n\t//initialising the default values\r\n\t$wheretosearch = 0;\r\n\t$item = \"\";\r\n\t$g_id = \"\";\r\n\t$resultquery = \"\";\r\n\t$displaysearchfield = \"\";\r\n\t\r\n\t//xmlstoresearch will contain the query in xml format (to store and load search)\r\n\t$xmlstoresearch = \"\";\r\n\t\r\n\t// if a search term was entered make the regexp and build the \"LIKE\" query\t\r\n\tif ($_POST['begriff']!=\"\"){\r\n\t\tif (isset($_POST['username']))\t$wheretosearch += 1; \r\n\t\tif (isset($_POST['realname']))  $wheretosearch += 2;\r\n\t\tif (isset($_POST['email']))\t\t$wheretosearch += 4;\r\n\t\t\r\n\t\t$item_raw = $admin->add_slashes($admin->get_post('begriff'));\r\n\t\t$item = $database->escapeString($item_raw);\r\n\t\t\r\n\t\t$xmlstoresearch .= \"<searchterm>\".$item.\"</searchterm>\";\r\n\t\t$item = str_replace(\"*\", '%', $item);\r\n\t\t\r\n\t\r\n\t\tswitch($wheretosearch) {\r\n\t\t\tcase 1:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\t\r\n\t\t\t\t$resultquery = \"(display_name LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<realname>true</realname>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['REAL_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR display_name LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><realname>true</realname>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['REAL_NAME'];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\t\r\n\t\t\t\t$resultquery = \"(email LIKE '\".$item.\"'\";\r\n\t\t\t\t$xmlstoresearch .= \"<email>true</email>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><email>true</email>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\t\r\n\t\t\t\t$resultquery = \"(display_name LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<realname>true</realname><email>true</email>\";\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['REAL_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\t\r\n\t\t\t\t$resultquery = \"(username LIKE '\".$item.\"' OR display_name LIKE '\".$item.\"' OR email LIKE '\".$item.\"'\"; \r\n\t\t\t\t$xmlstoresearch .= \"<username>true</username><realname>true</realname><email>true</email>\";\t\t\t\t\r\n\t\t\t\t$displaysearchfield .= $MOD_USER_SEARCH['USER_NAME'].\", \".$MOD_USER_SEARCH['REAL_NAME'].\", \".$MOD_USER_SEARCH['EMAIL'];\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\tdefault: \r\n\t\t\t\t$resultquery = \"\";\r\n\t\t}\t\r\n\t}\r\n\t\r\n\t\r\n\t// if a date was entered modify the sql query\t\r\n\tif (isset($_POST['comp_date'])&&($_POST['comp_date']!=\"\")){\r\n\t\tif ($resultquery!=\"\") $resultquery .= \") AND\";\r\n\t\t$resultquery .= \" (login_when\";\r\n\t\t$xmlstoresearch .= \"<datelastlogin>\";\r\n\t\tif ($_POST['datesearch']==\"after\") {\r\n\t\t\t$resultquery .= \">\";\r\n\t\t\t$xmlstoresearch .= \"<after>true</after>\";\t\t\t\t\r\n\t\t}else{ \r\n\t\t\t$resultquery .= \"<\";\r\n\t\t\t$xmlstoresearch .= \"<before>true</before>\";\r\n\t\t}\r\n\t\t// convert date to timestamp format to compare\r\n\t\t$resultquery .= $database->escapeString(jscalendar_to_timestamp($_POST['comp_date'],TIMEZONE));\r\n\t\t\r\n\t\t$xmlstoresearch .= \"<date>\".$database->escapeString(jscalendar_to_timestamp($_POST['comp_date'],TIMEZONE)).\"</date>\";\r\n\t\t$xmlstoresearch .= \"</datelastlogin>\";\r\n\t\t}\r\n\t\r\n\t// if a group was choosen modify the sql query\r\n\tif (isset($_POST['groups'])&&($_POST['groups']!=\"-1\")) {\r\n\t\t$g_id = $database->escapeString($_POST['groups']);\r\n\t\tif ($resultquery!=\"\") $resultquery .= \") AND\";\r\n\t\t$g_id = str_replace(\",\", '%', $g_id);\r\n\t\t$resultquery .= \" (groups_id LIKE '%$g_id%'\";\r\n\t\t$xmlstoresearch .= \"<idgroup>\".$g_id.\"</idgroup>\";\r\n\t\t\r\n\t\t// retrieve the group name\r\n\t\t$group_name = mysql_fetch_assoc(mysql_query (\"SELECT name from `\".TABLE_PREFIX.\"groups` WHERE group_id = '$g_id'\"));\r\n\t\t$xmlstoresearch .= \"<groupname>\".$group_name[\"name\"].\"</groupname>\";\r\n\t\t}\r\n\t\t\r\n\t$results = $database->query(\"SELECT * FROM `\".TABLE_PREFIX.\"users` WHERE \".$resultquery.\")\");\r\n\r\n\t// set template file (assign file \"backend_view.htt\" to variable/handle \"page\")\r\n\t$tpl->set_file('page', 'usersearch_result.htt');\r\n\t\r\n\t// set blocks (NOTE: always start with the inner most block first)\r\n\t// parameters: file variable/handle of file containing the block, block name in the file, new variable/handle for the block)\r\n\t$tpl->set_block('page', 'no_result_block','no_result_block_handle');\t\r\n\t$tpl->set_block('page', 'last_login_block','last_login_block_handle');\r\n\t$tpl->set_block('page', 'group_block','group_block_handle');\r\n\t$tpl->set_block('page', 'searchterm_block','searchterm_block_handle');\r\n\r\n\t$tpl->set_block('page', 'result_list_block','result_list_block_handle');\t\r\n\t$tpl->set_block('page', 'result_table_block','result_table_block_handle');\r\n\t\r\n\tif ($database->is_error()) { \r\n\t\t// echo '<p style=\"color: #CC0000;\">'.$database->get_error().'</p>';\r\n\t} \r\n\telse {\t\r\n\t\t$anzahl = $results->numRows();\r\n\t\t\r\n\t$tpl->set_var('HEADING_RESULT', $MOD_USER_SEARCH['HEADING_RESULT']);\r\n\t$tpl->set_var('HOWTO_RESULT', $MOD_USER_SEARCH['HOWTO_RESULT']);\t\t\r\n\t$tpl->set_var('SEARCH_DETAIL_RESULT', $MOD_USER_SEARCH['SEARCH_DETAIL_RESULT']);\r\n\r\n\t\tif ($wheretosearch != 0) {\r\n\t\t\t// display if a search term was entered\r\n\t\t\t$tpl->set_var('SEARCH_ITEM_RESULT', $MOD_USER_SEARCH['SEARCH_ITEM_RESULT']);\r\n\t\t\t$tpl->set_var('BEGRIFF',htmlspecialchars($admin->get_post('begriff'),ENT_QUOTES, \"UTF-8\"));\r\n\t\t\t$tpl->set_var('SEARCH_FIELD_RESULT', $MOD_USER_SEARCH['SEARCH_FIELD_RESULT']);\r\n\t\t\t$tpl->set_var('DISPLAYSEARCHFIELD', $displaysearchfield);\r\n\t\t\t$tpl->parse('searchterm_block_handle', 'searchterm_block');\r\n\t\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('searchterm_block_handle', '');\r\n\t\t\t}\t\r\n\t\r\n\t\tif ($g_id != \"\") {\r\n\t\t\t// display if a group was choosen\r\n\t\t\t$tpl->set_var('GROUP_RESULT', $MOD_USER_SEARCH['GROUP_RESULT']);\t\t\t\r\n\t\t\t$tpl->set_var('GROUP_NAME', $group_name[\"name\"]);\r\n\t\t\t$tpl->parse('group_block_handle', 'group_block');\r\n\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('group_block_handle', '');\r\n\t\t\t}\r\n\t\t \r\n\t\tif (isset($_POST['comp_date'])&&($_POST['comp_date']!=\"\")) {\r\n\t\t\t// display if a date of last login was entered\r\n\t\t\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN']);\t\t\t\r\n\t\t\tif ($_POST['datesearch']==\"after\") $tpl->set_var('BEFORE_OR_AFTER', $MOD_USER_SEARCH['DATE_AFTER_RESULT']);\r\n\t\t\telse $tpl->set_var('BEFORE_OR_AFTER', $MOD_USER_SEARCH['DATE_BEFORE_RESULT']);\r\n\t\t\t$tpl->set_var('DATE_RESULT', $_POST['comp_date']);\r\n\t\t\t$tpl->parse('last_login_block_handle', 'last_login_block');\t\t\r\n\t\t}\r\n\t\telse {\t\r\n\t\t\t// clear the block if not required\r\n\t\t\t$tpl->set_var('last_login_block', '');\r\n\t\t\t}\r\n\t\t\t\t\t\r\n\t\t$tpl->set_var('SHOW_RESULT', $MOD_USER_SEARCH['SHOW_RESULT']);\r\n\r\n\t\t\r\n\t\tif ($anzahl == 0) {\r\n\t\t\t// if the search return no values\r\n\t\t\t$tpl->set_var('NO_RESULT', $MOD_USER_SEARCH['NO_RESULT']);\r\n\t\t\t$tpl->parse('no_result_block_handle', 'no_result_block');\t\t\r\n\t\t\t} \r\n\t\telse \r\n\t\t\t{\r\n\t\t\t// clear the block if not required\t\t\t\t\r\n\t\t\t$tpl->set_var('no_result_block_handle', '');\r\n\r\n\t\t\t$tpl->set_var('USER_NAME', $MOD_USER_SEARCH['USER_NAME']);\r\n\t\t\t$tpl->set_var('REAL_NAME', $MOD_USER_SEARCH['REAL_NAME']);\r\n\t\t\t$tpl->set_var('EMAIL', $MOD_USER_SEARCH['EMAIL']);\r\n\t\t\t$tpl->set_var('LAST_LOGIN', $MOD_USER_SEARCH['LAST_LOGIN_D']);\t\t\t\t\t\t\r\n\t\t\t$tpl->set_var('LAST_IP', $MOD_USER_SEARCH['LAST_IP']);\r\n\t\t\t$rowcnt = 1;\r\n\t\t\t\r\n\t\t\twhile($d = $results->fetchRow()) {\r\n\t\t\t\t\r\n\t\t\t\tif ($d['login_when'] == 0) {\r\n\t\t\t\t\t$lastlogin = '-';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t$lastlogin = gmdate(DATE_FORMAT.\" \".TIME_FORMAT, $d['login_when'] + TIMEZONE);\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$bgcol = ($rowcnt++ % 2 == 0) ? '#EEE' : '#FFF';\r\n\t\t\t\t\r\n\t\t\t\t$tpl->set_var('WB_URL', WB_URL);\r\n\t\t\t\t$tpl->set_var('ADMIN_URL', ADMIN_URL);\r\n\t\t\t\t$tpl->set_var('RESULT_EDIT_USER', $MOD_USER_SEARCH['EDIT_USER']);\r\n\t\t\t\t$tpl->set_var('RESULT_ADMIN_DISABLED', $MOD_USER_SEARCH['ADMIN_DISABLED']);\r\n\t\t\t\t$tpl->set_var('RESULT_BGCOL', $bgcol);\t\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_USER_ID', $d['user_id']);\t\r\n\t\t\t\t$tpl->set_var('IDKEY_USER_ID', $admin->getIDKEY($d['user_id']));\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_USERNAME', $d['username']);\r\n\t\t\t\t$tpl->set_var('RESULT_DISPLAYNAME', $d['display_name']);\t\t\t\t\r\n\t\t\t\t$tpl->set_var('RESULT_EMAIL', $d['email']);\r\n\t\t\t\t$tpl->set_var('RESULT_LASTLOGIN', $lastlogin);\r\n\t\t\t\t$tpl->set_var('RESULT_DAYS_INACTIVE', ($d['login_when'] == 0) ? '-' : round((time() - (int) $d['login_when']) / (3600 * 24)));\r\n\t\t\t\t$tpl->set_var('RESULT_LAST_IP', $d['login_ip']);\r\n\r\n\r\n\t\t\t\t// add template values in append mode (add per loop)\r\n\t\t\t\t$tpl->parse('result_list_block_handle', 'result_list_block', true);\t\t\t\t\t\r\n\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t$tpl->set_var('HINT_EDIT', $MOD_USER_SEARCH['HINT_EDIT']);\t\t\t\t\t\t\t\t\t\r\n\t\t\t// parse the final template block\r\n\t\t\t$tpl->parse('result_table_block_handle', 'result_table_block');\r\n\r\n\t\t\t}\r\n\t\t\t$tpl->set_var('NEW_SEARCH', $MOD_USER_SEARCH['NEW_SEARCH']);\t\r\n\t\t}\r\n}\r\n// ouput the final template\r\n\r\n$tpl->pparse('output', 'page');\r\n\r\n"], "filenames": ["wbce/modules/user_search/htt/usersearch_result.htt", "wbce/modules/user_search/info.php", "wbce/modules/user_search/languages/DE.php", "wbce/modules/user_search/tool.php"], "buggy_code_start_loc": [1, 2, 34, 134], "buggy_code_end_loc": [83, 69, 36, 241], "fixing_code_start_loc": [1, 1, 34, 134], "fixing_code_end_loc": [83, 61, 36, 243], "type": "CWE-79", "message": "WBCE v1.1.11 is vulnerable to reflected XSS via the \"begriff\" POST parameter in /admin/admintools/tool.php?tool=user_search", "other": {"cve": {"id": "CVE-2017-1000213", "sourceIdentifier": "cve@mitre.org", "published": "2017-11-17T01:29:00.480", "lastModified": "2017-11-29T19:38:16.047", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "WBCE v1.1.11 is vulnerable to reflected XSS via the \"begriff\" POST parameter in /admin/admintools/tool.php?tool=user_search"}, {"lang": "es", "value": "WBCE v1.1.11 es vulnerable a Cross-Site Scripting (XSS) reflejado mediante el par\u00e1metro POST \"begriff\" en /admin/admintools/tool.php?tool=user_search."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wbce:wbce_cms:1.1.11:*:*:*:*:*:*:*", "matchCriteriaId": "273EA09D-7128-4021-935D-DB18205C0D2F"}]}]}], "references": [{"url": "https://github.com/WBCE/WBCE_CMS/commit/0da620016aec17ac2d2f3a22c55ab8c2b55e691e#diff-7b380285e285160d0070863099baabe0", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/WBCE/WBCE_CMS/commit/0da620016aec17ac2d2f3a22c55ab8c2b55e691e#diff-7b380285e285160d0070863099baabe0"}}