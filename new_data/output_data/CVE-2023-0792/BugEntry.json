{"buggy_code": ["/**\n * JavaScript functions for all tag administration stuff\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2014-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2014-08-16\n */\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  'use strict';\n\n  $('.btn-edit').on('click', function () {\n    const id = $(this).data('btn-id');\n    const span = $('span[data-tag-id=\"' + id + '\"]');\n\n    if (span.length > 0) {\n      span.replaceWith('<input name=\"tag\" class=\"form-control\" data-tag-id=\"' + id + '\" value=\"' + span.html() + '\">');\n    } else {\n      const input = $('input[data-tag-id=\"' + id + '\"]');\n      input.replaceWith('<span data-tag-id=\"' + id + '\">' + input.val().replace(/\\//g, '&#x2F;') + '</span>');\n    }\n  });\n\n  $('.tag-form').bind('submit', function (event) {\n    event.preventDefault();\n\n    const input = $('input[data-tag-id]:focus');\n    const id = input.data('tag-id');\n    const tag = input.val();\n    const csrf = $('input[name=csrf]').val();\n\n    $.ajax({\n      url: 'index.php?action=ajax&ajax=tags&ajaxaction=update',\n      type: 'POST',\n      data: 'id=' + id + '&tag=' + tag + '&csrf=' + csrf,\n      dataType: 'json',\n      beforeSend: function () {\n        $('#pmf-admin-saving-data-indicator').html(\n          '<i class=\"fa fa-cog fa-spin fa-fw\"></i><span class=\"sr-only\">Saving ...</span>'\n        );\n      },\n      success: function (message) {\n        input.replaceWith('<span data-tag-id=\"' + id + '\">' + input.val().replace(/\\//g, '&#x2F;') + '</span>');\n        $('span[data-tag-id=\"' + id + '\"]');\n        $('#pmf-admin-saving-data-indicator').html(message);\n      },\n    });\n\n    return false;\n  });\n});\n", "<?php\n\n/**\n * Administration frontend for Tags.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2003-02-24\n */\n\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\Tags;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-tags\"></i>\n      <?= $PMF_LANG['ad_entry_tags'] ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n    <form action=\"\" method=\"post\" class=\"tag-form\">\n      <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n        <?php\n        if ($user->perm->hasPermission($user->getUserId(), 'edit_faq')) {\n            $tags = new Tags($faqConfig);\n\n            if ('delete-tag' === $action) {\n                $tagId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n                if ($tags->deleteTag($tagId)) {\n                    echo '<p class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">\u00d7</a>';\n                    echo $PMF_LANG['ad_tag_delete_success'] . '</p>';\n                } else {\n                    echo '<p class=\"alert alert-danger\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">\u00d7</a>';\n                    echo $PMF_LANG['ad_tag_delete_error'];\n                    echo '<br>' . $PMF_LANG['ad_adus_dberr'] . '<br>';\n                    echo $faqConfig->getDb()->error() . '</p>';\n                }\n            }\n\n            $tagData = $tags->getAllTags();\n\n            if (count($tagData)) {\n              printf('<p class=\"alert alert-warning\" role=\"alert\">%s</p>', $PMF_LANG['ad_news_nodata']);\n            }\n\n            echo '<table class=\"table table-hover\">';\n            echo '<tbody>';\n\n            foreach ($tagData as $key => $tag) {\n                echo '<tr>';\n                echo '<td><span data-tag-id=\"' . $key . '\">' . Strings::htmlspecialchars($tag) . '</span></td>';\n                printf(\n                    '<td><a class=\"btn btn-primary btn-edit\" data-btn-id=\"%d\" title=\"%s\">' .\n                    '<i aria-hidden=\"true\" class=\"fa fa-edit\"></i></a></td>',\n                    $key,\n                    $PMF_LANG['ad_user_edit']\n                );\n\n                printf(\n                    '<td><a class=\"btn btn-danger\" onclick=\"return confirm(\\'%s\\');\" href=\"%s%d\">',\n                    $PMF_LANG['ad_user_del_3'],\n                    '?action=delete-tag&amp;id=',\n                    $key\n                );\n                printf(\n                    '<span title=\"%s\"><i aria-hidden=\"true\" class=\"fa fa-trash\"></i></span></a></td>',\n                    $PMF_LANG['ad_entry_delete']\n                );\n\n                echo '<tr>';\n            }\n\n            echo '</tbody>';\n            echo '</table>';\n        } else {\n            echo $PMF_LANG['err_NotAuth'];\n        }\n        ?>\n    </form>\n    <script src=\"assets/js/tags.js\"></script>\n  </div>\n</div>\n"], "fixing_code": ["/**\n * JavaScript functions for all tag administration stuff\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2014-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2014-08-16\n */\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  'use strict';\n\n  $('.btn-edit').on('click', function () {\n    const id = $(this).data('btn-id');\n    const span = $('span[data-tag-id=\"' + id + '\"]');\n\n    if (span.length > 0) {\n      span.replaceWith('<input name=\"tag\" class=\"form-control\" data-tag-id=\"' + id + '\" value=\"' + span.html() + '\">');\n    } else {\n      const input = $('input[data-tag-id=\"' + id + '\"]');\n      input.replaceWith('<span data-tag-id=\"' + id + '\">' + input.val().replace(/\\//g, '&#x2F;') + '</span>');\n    }\n  });\n\n  $('.tag-form').bind('submit', function (event) {\n    event.preventDefault();\n\n    const input = $('input[data-tag-id]:focus');\n    const id = input.data('tag-id');\n    const tag = input.val();\n    const csrf = $('input[name=csrf]').val();\n\n    const escape = (unsafe) => {\n      return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll(\"'\", '&#039;');\n    }\n\n    $.ajax({\n      url: 'index.php?action=ajax&ajax=tags&ajaxaction=update',\n      type: 'POST',\n      data: 'id=' + id + '&tag=' + tag + '&csrf=' + csrf,\n      dataType: 'json',\n      beforeSend: function () {\n        $('#pmf-admin-saving-data-indicator').html(\n          '<i class=\"fa fa-cog fa-spin fa-fw\"></i><span class=\"sr-only\">Saving ...</span>'\n        );\n      },\n      success: function (message) {\n        input.replaceWith('<span data-tag-id=\"' + id + '\">' + escape(input.val().replace(/\\//g, '&#x2F;')) + '</span>');\n        $('span[data-tag-id=\"' + id + '\"]');\n        $('#pmf-admin-saving-data-indicator').html(message);\n      },\n    });\n\n    return false;\n  });\n});\n", "<?php\n\n/**\n * Administration frontend for Tags.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2003-02-24\n */\n\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\Tags;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-tags\"></i>\n      <?= $PMF_LANG['ad_entry_tags'] ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n    <form action=\"\" method=\"post\" class=\"tag-form\">\n      <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n        <?php\n        if ($user->perm->hasPermission($user->getUserId(), 'edit_faq')) {\n            $tags = new Tags($faqConfig);\n\n            if ('delete-tag' === $action) {\n                $tagId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n                if ($tags->deleteTag($tagId)) {\n                    echo '<p class=\"alert alert-success\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">\u00d7</a>';\n                    echo $PMF_LANG['ad_tag_delete_success'] . '</p>';\n                } else {\n                    echo '<p class=\"alert alert-danger\"><a href=\"#\" class=\"close\" data-dismiss=\"alert\">\u00d7</a>';\n                    echo $PMF_LANG['ad_tag_delete_error'];\n                    echo '<br>' . $PMF_LANG['ad_adus_dberr'] . '<br>';\n                    echo $faqConfig->getDb()->error() . '</p>';\n                }\n            }\n\n            $tagData = $tags->getAllTags();\n\n            if (count($tagData) === 0) {\n              printf('<p class=\"alert alert-warning\" role=\"alert\">%s</p>', $PMF_LANG['ad_news_nodata']);\n            }\n\n            echo '<table class=\"table table-hover\">';\n            echo '<tbody>';\n\n            foreach ($tagData as $key => $tag) {\n                echo '<tr>';\n                echo '<td><span data-tag-id=\"' . $key . '\">' . Strings::htmlentities($tag) . '</span></td>';\n                printf(\n                    '<td><a class=\"btn btn-primary btn-edit\" data-btn-id=\"%d\" title=\"%s\">' .\n                    '<i aria-hidden=\"true\" class=\"fa fa-edit\"></i></a></td>',\n                    $key,\n                    $PMF_LANG['ad_user_edit']\n                );\n\n                printf(\n                    '<td><a class=\"btn btn-danger\" onclick=\"return confirm(\\'%s\\');\" href=\"%s%d\">',\n                    $PMF_LANG['ad_user_del_3'],\n                    '?action=delete-tag&amp;id=',\n                    $key\n                );\n                printf(\n                    '<span title=\"%s\"><i aria-hidden=\"true\" class=\"fa fa-trash\"></i></span></a></td>',\n                    $PMF_LANG['ad_entry_delete']\n                );\n\n                echo '<tr>';\n            }\n\n            echo '</tbody>';\n            echo '</table>';\n        } else {\n            echo $PMF_LANG['err_NotAuth'];\n        }\n        ?>\n    </form>\n    <script src=\"assets/js/tags.js\"></script>\n  </div>\n</div>\n"], "filenames": ["phpmyfaq/admin/assets/js/tags.js", "phpmyfaq/admin/tags.php"], "buggy_code_start_loc": [38, 58], "buggy_code_end_loc": [51, 68], "fixing_code_start_loc": [39, 58], "fixing_code_end_loc": [55, 68], "type": "CWE-94", "message": "Code Injection in GitHub repository thorsten/phpmyfaq prior to 3.1.11.", "other": {"cve": {"id": "CVE-2023-0792", "sourceIdentifier": "security@huntr.dev", "published": "2023-02-12T14:15:11.720", "lastModified": "2023-02-24T06:18:57.560", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Code Injection in GitHub repository thorsten/phpmyfaq prior to 3.1.11."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.5}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 2.5}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-94"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.1.11", "matchCriteriaId": "0CADCF40-01A2-41DD-B454-4F5946570CA9"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/d8964568d69488de02f0a0a58acc822eeb5c3cb1", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/9e21156b-ab1d-4c60-88ef-8c9f3e2feb7f", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/d8964568d69488de02f0a0a58acc822eeb5c3cb1"}}