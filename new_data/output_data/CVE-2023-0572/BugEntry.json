{"buggy_code": ["<?php\n\n/**\n * This file is part of the Froxlor project.\n * Copyright (c) 2010 the Froxlor Team (see authors).\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, you can also view it online at\n * https://files.froxlor.org/misc/COPYING.txt\n *\n * @copyright  the authors\n * @author     Froxlor team <team@froxlor.org>\n * @license    https://files.froxlor.org/misc/COPYING.txt GPLv2\n */\n\nif (!defined('AREA')) {\n\theader(\"Location: index.php\");\n\texit();\n}\n\nuse Froxlor\\FileDir;\nuse Froxlor\\Froxlor;\nuse Froxlor\\UI\\Panel\\UI;\nuse Froxlor\\UI\\Request;\nuse Froxlor\\UI\\Response;\n\n// This file is being included in admin_domains and customer_domains\n// and therefore does not need to require lib/init.php\n\n$errid = Request::any('errorid');\n\nif (!empty($errid)) {\n\t// read error file\n\t$err_dir = FileDir::makeCorrectDir(Froxlor::getInstallDir() . \"/logs/\");\n\t$err_file = FileDir::makeCorrectFile($err_dir . \"/\" . $errid . \"_sql-error.log\");\n\n\tif (file_exists($err_file)) {\n\t\t$error_content = file_get_contents($err_file);\n\t\t$error = explode(\"|\", $error_content);\n\n\t\t$_error = [\n\t\t\t'code' => str_replace(\"\\n\", \"\", substr($error[1], 5)),\n\t\t\t'message' => str_replace(\"\\n\", \"\", substr($error[2], 4)),\n\t\t\t'file' => str_replace(\"\\n\", \"\", substr($error[3], 5 + strlen(Froxlor::getInstallDir()))),\n\t\t\t'line' => str_replace(\"\\n\", \"\", substr($error[4], 5)),\n\t\t\t'trace' => str_replace(Froxlor::getInstallDir(), \"\", substr($error[5], 6))\n\t\t];\n\n\t\t// build mail-content\n\t\t$mail_body = \"Dear froxlor-team,\\n\\n\";\n\t\t$mail_body .= \"the following error has been reported by a user:\\n\\n\";\n\t\t$mail_body .= \"-------------------------------------------------------------\\n\";\n\t\t$mail_body .= $_error['code'] . ' ' . $_error['message'] . \"\\n\\n\";\n\t\t$mail_body .= \"File: \" . $_error['file'] . ':' . $_error['line'] . \"\\n\\n\";\n\t\t$mail_body .= \"Trace:\\n\" . trim($_error['trace']) . \"\\n\\n\";\n\t\t$mail_body .= \"-------------------------------------------------------------\\n\\n\";\n\t\t$mail_body .= \"User-Area: \" . AREA . \"\\n\";\n\t\t$mail_body .= \"Froxlor-version: \" . Froxlor::VERSION . \"\\n\";\n\t\t$mail_body .= \"DB-version: \" . Froxlor::DBVERSION . \"\\n\\n\";\n\t\ttry {\n\t\t\t$mail_body .= \"Database: \" . Database::getAttribute(PDO::ATTR_SERVER_VERSION);\n\t\t} catch (\\Exception $e) {\n\t\t\t/* ignore */\n\t\t}\n\t\t$mail_body .= \"End of report\";\n\t\t$mail_html = nl2br($mail_body);\n\n\t\t// send actual report to dev-team\n\t\tif (isset($_POST['send']) && $_POST['send'] == 'send') {\n\t\t\t// send mail and say thanks\n\t\t\t$_mailerror = false;\n\t\t\ttry {\n\t\t\t\t$mail->Subject = '[Froxlor] Error report by user';\n\t\t\t\t$mail->AltBody = $mail_body;\n\t\t\t\t$mail->MsgHTML($mail_html);\n\t\t\t\t$mail->AddAddress('error-reports@froxlor.org', 'Froxlor Developer Team');\n\t\t\t\t$mail->Send();\n\t\t\t} catch (\\PHPMailer\\PHPMailer\\Exception $e) {\n\t\t\t\t$mailerr_msg = $e->errorMessage();\n\t\t\t\t$_mailerror = true;\n\t\t\t} catch (Exception $e) {\n\t\t\t\t$mailerr_msg = $e->getMessage();\n\t\t\t\t$_mailerror = true;\n\t\t\t}\n\n\t\t\tif ($_mailerror) {\n\t\t\t\t// error when reporting an error...LOLFUQ\n\t\t\t\tResponse::standardError('send_report_error', $mailerr_msg);\n\t\t\t}\n\n\t\t\t// finally remove error from fs\n\t\t\t@unlink($err_file);\n\t\t\tResponse::standardSuccess('sent_error_report', '', ['filename' => 'index.php']);\n\t\t}\n\t\t// show a nice summary of the error-report\n\t\t// before actually sending anything\n\t\tUI::view('user/error_report.html.twig', [\n\t\t\t'mail_html' => $mail_body,\n\t\t\t'errorid' => $errid\n\t\t]);\n\t} else {\n\t\tResponse::redirectTo($filename);\n\t}\n} else {\n\tResponse::redirectTo($filename);\n}\n"], "fixing_code": ["<?php\n\n/**\n * This file is part of the Froxlor project.\n * Copyright (c) 2010 the Froxlor Team (see authors).\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, you can also view it online at\n * https://files.froxlor.org/misc/COPYING.txt\n *\n * @copyright  the authors\n * @author     Froxlor team <team@froxlor.org>\n * @license    https://files.froxlor.org/misc/COPYING.txt GPLv2\n */\n\nif (!defined('AREA')) {\n\theader(\"Location: index.php\");\n\texit();\n}\n\nuse Froxlor\\FileDir;\nuse Froxlor\\Froxlor;\nuse Froxlor\\UI\\Panel\\UI;\nuse Froxlor\\UI\\Request;\nuse Froxlor\\UI\\Response;\nuse Froxlor\\Database\\Database;\n\n// This file is being included in admin_domains and customer_domains\n// and therefore does not need to require lib/init.php\n\n$errid = Request::any('errorid');\n\nif (!empty($errid)) {\n\t// read error file\n\t$err_dir = FileDir::makeCorrectDir(Froxlor::getInstallDir() . \"/logs/\");\n\t$err_file = FileDir::makeCorrectFile($err_dir . \"/\" . $errid . \"_sql-error.log\");\n\n\tif (file_exists($err_file)) {\n\t\t$error_content = file_get_contents($err_file);\n\t\t$error = explode(\"|\", $error_content);\n\n\t\t$_error = [\n\t\t\t'code' => str_replace(\"\\n\", \"\", substr($error[1], 5)),\n\t\t\t'message' => str_replace(\"\\n\", \"\", substr($error[2], 4)),\n\t\t\t'file' => str_replace(\"\\n\", \"\", substr($error[3], 5 + strlen(Froxlor::getInstallDir()))),\n\t\t\t'line' => str_replace(\"\\n\", \"\", substr($error[4], 5)),\n\t\t\t'trace' => str_replace(Froxlor::getInstallDir(), \"\", substr($error[5], 6))\n\t\t];\n\n\t\t// build mail-content\n\t\t$mail_body = \"Dear froxlor-team,\\n\\n\";\n\t\t$mail_body .= \"the following error has been reported by a user:\\n\\n\";\n\t\t$mail_body .= \"-------------------------------------------------------------\\n\";\n\t\t$mail_body .= $_error['code'] . ' ' . $_error['message'] . \"\\n\\n\";\n\t\t$mail_body .= \"File: \" . $_error['file'] . ':' . $_error['line'] . \"\\n\\n\";\n\t\t$mail_body .= \"Trace:\\n\" . trim($_error['trace']) . \"\\n\\n\";\n\t\t$mail_body .= \"-------------------------------------------------------------\\n\\n\";\n\t\t$mail_body .= \"User-Area: \" . AREA . \"\\n\";\n\t\t$mail_body .= \"Froxlor-version: \" . Froxlor::VERSION . \"\\n\";\n\t\t$mail_body .= \"DB-version: \" . Froxlor::DBVERSION . \"\\n\\n\";\n\t\ttry {\n\t\t\t$mail_body .= \"Database: \" . Database::getAttribute(PDO::ATTR_SERVER_VERSION);\n\t\t} catch (\\Exception $e) {\n\t\t\t/* ignore */\n\t\t}\n\t\t$mail_body .= \"End of report\";\n\t\t$mail_html = nl2br($mail_body);\n\n\t\t// send actual report to dev-team\n\t\tif (isset($_POST['send']) && $_POST['send'] == 'send') {\n\t\t\t// send mail and say thanks\n\t\t\t$_mailerror = false;\n\t\t\ttry {\n\t\t\t\t$mail->Subject = '[Froxlor] Error report by user';\n\t\t\t\t$mail->AltBody = $mail_body;\n\t\t\t\t$mail->MsgHTML($mail_html);\n\t\t\t\t$mail->AddAddress('error-reports@froxlor.org', 'Froxlor Developer Team');\n\t\t\t\t$mail->Send();\n\t\t\t} catch (\\PHPMailer\\PHPMailer\\Exception $e) {\n\t\t\t\t$mailerr_msg = $e->errorMessage();\n\t\t\t\t$_mailerror = true;\n\t\t\t} catch (Exception $e) {\n\t\t\t\t$mailerr_msg = $e->getMessage();\n\t\t\t\t$_mailerror = true;\n\t\t\t}\n\n\t\t\tif ($_mailerror) {\n\t\t\t\t// error when reporting an error...LOLFUQ\n\t\t\t\tResponse::standardError('send_report_error', $mailerr_msg);\n\t\t\t}\n\n\t\t\t// finally remove error from fs\n\t\t\t@unlink($err_file);\n\t\t\tResponse::standardSuccess('sent_error_report', '', ['filename' => 'index.php']);\n\t\t}\n\t\t// show a nice summary of the error-report\n\t\t// before actually sending anything\n\t\tUI::view('user/error_report.html.twig', [\n\t\t\t'mail_html' => $mail_body,\n\t\t\t'errorid' => $errid\n\t\t]);\n\t} else {\n\t\tResponse::redirectTo($filename);\n\t}\n} else {\n\tResponse::redirectTo($filename);\n}\n"], "filenames": ["error_report.php"], "buggy_code_start_loc": [35], "buggy_code_end_loc": [35], "fixing_code_start_loc": [36], "fixing_code_end_loc": [37], "type": "CWE-754", "message": "Unchecked Error Condition in GitHub repository froxlor/froxlor prior to 2.0.10.", "other": {"cve": {"id": "CVE-2023-0572", "sourceIdentifier": "security@huntr.dev", "published": "2023-01-29T23:15:08.790", "lastModified": "2023-02-07T19:35:10.337", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Unchecked Error Condition in GitHub repository froxlor/froxlor prior to 2.0.10."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 1.4}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-754"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-391"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:froxlor:froxlor:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.0.10", "matchCriteriaId": "AF26BD0E-694F-48CD-96F2-7E9FE8C46966"}]}]}], "references": [{"url": "https://github.com/froxlor/froxlor/commit/7b08a71c59430d06c1efb012a6c6448262aacdb1", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/4ab24ee2-3ff6-4248-9555-0af3e5f754ec", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/froxlor/froxlor/commit/7b08a71c59430d06c1efb012a6c6448262aacdb1"}}