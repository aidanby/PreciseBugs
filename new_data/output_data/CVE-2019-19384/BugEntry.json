{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2018\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('fax_log_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get ids\n\t$fax_log_uuid = $_REQUEST[\"id\"];\n\t$fax_uuid = $_REQUEST[\"fax_uuid\"];\n\n//pre-populate the form\n\tif (is_uuid($fax_log_uuid) && is_uuid($fax_uuid)) {\n\t\t$sql = \"select * from v_fax_logs \";\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$sql .= \"and fax_log_uuid = :fax_log_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t\t$parameters['fax_log_uuid'] = $fax_log_uuid;\n\t\t$database = new database;\n\t\t$row = $database->select($sql, $parameters, 'row');\n\t\tif (is_array($row) && @sizeof($row) != 0) {\n\t\t\t$fax_log_uuid = $row[\"fax_log_uuid\"];\n\t\t\t$fax_success = $row[\"fax_success\"];\n\t\t\t$fax_result_code = $row[\"fax_result_code\"];\n\t\t\t$fax_result_text = $row[\"fax_result_text\"];\n\t\t\t$fax_file = $row[\"fax_file\"];\n\t\t\t$fax_ecm_used = $row[\"fax_ecm_used\"];\n\t\t\t$fax_local_station_id = $row[\"fax_local_station_id\"];\n\t\t\t$fax_document_transferred_pages = $row[\"fax_document_transferred_pages\"];\n\t\t\t$fax_document_total_pages = $row[\"fax_document_total_pages\"];\n\t\t\t$fax_image_resolution = $row[\"fax_image_resolution\"];\n\t\t\t$fax_image_size = $row[\"fax_image_size\"];\n\t\t\t$fax_bad_rows = $row[\"fax_bad_rows\"];\n\t\t\t$fax_transfer_rate = $row[\"fax_transfer_rate\"];\n\t\t\t$fax_retry_attempts = $row[\"fax_retry_attempts\"];\n\t\t\t$fax_retry_limit = $row[\"fax_retry_limit\"];\n\t\t\t$fax_retry_sleep = $row[\"fax_retry_sleep\"];\n\t\t\t$fax_uri = $row[\"fax_uri\"];\n\t\t\t$fax_date = $row[\"fax_date\"];\n\t\t\t$fax_epoch = $row[\"fax_epoch\"];\n\t\t}\n\t\tunset($sql, $parameters, $row);\n\t}\n\n//show the header\n\trequire_once \"resources/header.php\";\n\n//show the content\n\techo \"<table cellpadding='0' cellspacing='0' border='0' align='right'><tr><td><input type='button' class='btn' alt='\".$text['button-back'].\"' onclick=\\\"document.location='fax_logs.php?id=\".$fax_uuid.\"'\\\" value='\".$text['button-back'].\"'></td></tr></table>\";\n\techo \"<b>\".$text['title-fax_log'].\"</b>\\n\";\n\techo \"<br /><br />\\n\";\n\n\techo \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_success'].\"</td>\\n\";\n\techo \"<td width='70%' class='vtable'>\".$fax_success.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_result_code'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_result_code.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_result_text'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_result_text.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_file'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_file.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_ecm_used'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_ecm_used.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_local_station_id'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_local_station_id.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_document_transferred_pages'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_document_transferred_pages.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_document_total_pages'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_document_total_pages.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_image_resolution'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_image_resolution.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_image_size'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_image_size.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_bad_rows'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_bad_rows.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_transfer_rate'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_transfer_rate.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_attempts'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_retry_attempts.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_limit'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_retry_limit.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_sleep'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_retry_sleep.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_uri'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_uri.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_date'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_date.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_epoch'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_epoch.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n\techo \"</form>\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2019\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('fax_log_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//validate the uuids\n\tif (is_uuid($_REQUEST[\"id\"])) {\n\t\t$fax_log_uuid = $_REQUEST[\"id\"];\n\t}\n\tif (is_uuid($_REQUEST[\"fax_uuid\"])) {\n\t\t$fax_uuid = $_REQUEST[\"fax_uuid\"];\n\t}\n\n//pre-populate the form\n\tif (is_uuid($fax_log_uuid) && is_uuid($fax_uuid)) {\n\t\t$sql = \"select * from v_fax_logs \";\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$sql .= \"and fax_log_uuid = :fax_log_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t\t$parameters['fax_log_uuid'] = $fax_log_uuid;\n\t\t$database = new database;\n\t\t$row = $database->select($sql, $parameters, 'row');\n\t\tif (is_array($row) && @sizeof($row) != 0) {\n\t\t\t$fax_log_uuid = $row[\"fax_log_uuid\"];\n\t\t\t$fax_success = $row[\"fax_success\"];\n\t\t\t$fax_result_code = $row[\"fax_result_code\"];\n\t\t\t$fax_result_text = $row[\"fax_result_text\"];\n\t\t\t$fax_file = $row[\"fax_file\"];\n\t\t\t$fax_ecm_used = $row[\"fax_ecm_used\"];\n\t\t\t$fax_local_station_id = $row[\"fax_local_station_id\"];\n\t\t\t$fax_document_transferred_pages = $row[\"fax_document_transferred_pages\"];\n\t\t\t$fax_document_total_pages = $row[\"fax_document_total_pages\"];\n\t\t\t$fax_image_resolution = $row[\"fax_image_resolution\"];\n\t\t\t$fax_image_size = $row[\"fax_image_size\"];\n\t\t\t$fax_bad_rows = $row[\"fax_bad_rows\"];\n\t\t\t$fax_transfer_rate = $row[\"fax_transfer_rate\"];\n\t\t\t$fax_retry_attempts = $row[\"fax_retry_attempts\"];\n\t\t\t$fax_retry_limit = $row[\"fax_retry_limit\"];\n\t\t\t$fax_retry_sleep = $row[\"fax_retry_sleep\"];\n\t\t\t$fax_uri = $row[\"fax_uri\"];\n\t\t\t$fax_date = $row[\"fax_date\"];\n\t\t\t$fax_epoch = $row[\"fax_epoch\"];\n\t\t}\n\t\tunset($sql, $parameters, $row);\n\t}\n\n//show the header\n\trequire_once \"resources/header.php\";\n\n//show the content\n\techo \"<table cellpadding='0' cellspacing='0' border='0' align='right'><tr><td><input type='button' class='btn' alt='\".$text['button-back'].\"' onclick=\\\"document.location='fax_logs.php?id=\".urlencode($fax_uuid).\"'\\\" value='\".$text['button-back'].\"'></td></tr></table>\";\n\techo \"<b>\".$text['title-fax_log'].\"</b>\\n\";\n\techo \"<br /><br />\\n\";\n\n\techo \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_success'].\"</td>\\n\";\n\techo \"<td width='70%' class='vtable'>\".escape($fax_success).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_result_code'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_result_code).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_result_text'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_result_text).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_file'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_file).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_ecm_used'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_ecm_used).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_local_station_id'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_local_station_id).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_document_transferred_pages'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".$fax_document_transferred_pages.\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_document_total_pages'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_document_total_pages).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_image_resolution'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_image_resolution).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_image_size'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_image_size).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_bad_rows'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_bad_rows).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_transfer_rate'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_transfer_rate).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_attempts'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_retry_attempts).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_limit'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_retry_limit).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_retry_sleep'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_retry_sleep).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_uri'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_uri).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_date'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_date).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' nowrap='nowrap'>\".$text['label-fax_epoch'].\"</td>\\n\";\n\techo \"<td class='vtable'>\".escape($fax_epoch).\"</td>\\n\";\n\techo \"</tr>\\n\";\n\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n\techo \"</form>\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/fax/fax_log_view.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [180], "fixing_code_start_loc": [20], "fixing_code_end_loc": [184], "type": "CWE-79", "message": "A cross-site scripting (XSS) vulnerability in app/fax/fax_log_view.php in FusionPBX 4.4.1 allows remote attackers to inject arbitrary web script or HTML via the fax_uuid parameter.", "other": {"cve": {"id": "CVE-2019-19384", "sourceIdentifier": "cve@mitre.org", "published": "2019-11-29T00:15:11.370", "lastModified": "2019-12-02T19:56:59.843", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A cross-site scripting (XSS) vulnerability in app/fax/fax_log_view.php in FusionPBX 4.4.1 allows remote attackers to inject arbitrary web script or HTML via the fax_uuid parameter."}, {"lang": "es", "value": "Una vulnerabilidad de tipo cross-site scripting (XSS) en el archivo app/fax/fax_log_view.php en FusionPBX versi\u00f3n 4.4.1, permite a atacantes remotos inyectar script web o HTML arbitrario por medio del par\u00e1metro fax_uuid."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:4.4.1:*:*:*:*:*:*:*", "matchCriteriaId": "954E2072-AC03-4E55-8A7F-640534279042"}]}]}], "references": [{"url": "https://gist.github.com/xax007/28e7326acfae677be0b351216888e522", "source": "cve@mitre.org", "tags": ["Exploit", "Patch", "Third Party Advisory"]}, {"url": "https://github.com/fusionpbx/fusionpbx/commit/aea1abaeb12f69dc22967395c528fb2434e316c1", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/aea1abaeb12f69dc22967395c528fb2434e316c1"}}