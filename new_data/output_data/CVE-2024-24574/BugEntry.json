{"buggy_code": ["<?php\n\n/**\n * Frontend for handling with attachments.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Anatoliy Belsky <ab@php.net>\n * @copyright 2010-2023 phpMyFAQ Team\n * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2010-12-13\n */\n\nuse phpMyFAQ\\Attachment\\AttachmentCollection;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Pagination;\nuse phpMyFAQ\\Session\\Token;\nuse phpMyFAQ\\Translation;\nuse phpMyFAQ\\Utils;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n$request = Request::createFromGlobals();\n\n$page = Filter::filterVar($request->query->get('page'), FILTER_VALIDATE_INT);\n$page = max(1, $page);\n\n$attachmentCollection = new AttachmentCollection($faqConfig);\n$itemsPerPage = 24;\n$allCrumbs = $attachmentCollection->getBreadcrumbs();\n\n$crumbs = array_slice($allCrumbs, ($page - 1) * $itemsPerPage, $itemsPerPage);\n\n$pagination = new Pagination(\n    [\n        'baseUrl' => $faqConfig->getDefaultUrl() . $request->getRequestUri(),\n        'total' => is_countable($allCrumbs) ? count($allCrumbs) : 0,\n        'perPage' => $itemsPerPage,\n    ]\n);\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-paperclip\"></i>\n      <?= Translation::get('ad_menu_attachment_admin') ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n    <table class=\"table table-striped align-middle\">\n      <thead>\n      <tr>\n        <th>#</th>\n        <th><?= Translation::get('msgAttachmentsFilename') ?></th>\n        <th><?= Translation::get('msgTransToolLanguage') ?></th>\n        <th><?= Translation::get('msgAttachmentsFilesize') ?></th>\n        <th colspan=\"3\"><?= Translation::get('msgAttachmentsMimeType') ?></th>\n      </tr>\n      </thead>\n      <tbody id=\"attachment-table\">\n      <?php foreach ($crumbs as $item) : ?>\n        <tr id=\"attachment_<?= $item->id ?>\" title=\"<?= $item->thema ?>\">\n          <td><?= $item->id ?></td>\n          <td><?= $item->filename ?></td>\n          <td><?= $item->record_lang ?></td>\n          <td><?= Utils::formatBytes($item->filesize) ?></td>\n          <td><?= $item->mime_type ?></td>\n          <td>\n            <button class=\"btn btn-danger btn-delete-attachment\" title=\"<?= Translation::get('ad_gen_delete') ?>\"\n                    data-attachment-id=\"<?= $item->id ?>\"\n                    data-csrf=\"<?= Token::getInstance()->getTokenString('delete-attachment') ?>\">\n              <i aria-hidden=\"true\" class=\"fa fa-trash btn-delete-attachment\" data-attachment-id=\"<?= $item->id ?>\"\n                    data-csrf=\"<?= Token::getInstance()->getTokenString('delete-attachment') ?>\"></i>\n            </button>\n          </td>\n          <td>\n            <a title=\"<?= Translation::get('ad_entry_faq_record') ?>\" class=\"btn btn-info\"\n               href=\"../index.php?action=faq&id=<?= $item->record_id ?>&lang=<?= $item->record_lang ?>\">\n              <i aria-hidden=\"true\" class=\"fa fa-link\"></i>\n            </a>\n          </td>\n        </tr>\n      <?php endforeach; ?>\n      </tbody>\n      <tfoot>\n      <tr>\n        <td colspan=\"5\"><?= $pagination->render(); ?></td>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n</div>\n\n"], "fixing_code": ["<?php\n\n/**\n * Frontend for handling with attachments.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Anatoliy Belsky <ab@php.net>\n * @copyright 2010-2023 phpMyFAQ Team\n * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2010-12-13\n */\n\nuse phpMyFAQ\\Attachment\\AttachmentCollection;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Pagination;\nuse phpMyFAQ\\Session\\Token;\nuse phpMyFAQ\\Translation;\nuse phpMyFAQ\\Utils;\nuse phpMyFAQ\\Strings;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n$request = Request::createFromGlobals();\n\n$page = Filter::filterVar($request->query->get('page'), FILTER_VALIDATE_INT);\n$page = max(1, $page);\n\n$attachmentCollection = new AttachmentCollection($faqConfig);\n$itemsPerPage = 24;\n$allCrumbs = $attachmentCollection->getBreadcrumbs();\n\n$crumbs = array_slice($allCrumbs, ($page - 1) * $itemsPerPage, $itemsPerPage);\n\n$pagination = new Pagination(\n    [\n        'baseUrl' => $faqConfig->getDefaultUrl() . $request->getRequestUri(),\n        'total' => is_countable($allCrumbs) ? count($allCrumbs) : 0,\n        'perPage' => $itemsPerPage,\n    ]\n);\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-paperclip\"></i>\n      <?= Translation::get('ad_menu_attachment_admin') ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n    <table class=\"table table-striped align-middle\">\n      <thead>\n      <tr>\n        <th>#</th>\n        <th><?= Translation::get('msgAttachmentsFilename') ?></th>\n        <th><?= Translation::get('msgTransToolLanguage') ?></th>\n        <th><?= Translation::get('msgAttachmentsFilesize') ?></th>\n        <th colspan=\"3\"><?= Translation::get('msgAttachmentsMimeType') ?></th>\n      </tr>\n      </thead>\n      <tbody id=\"attachment-table\">\n      <?php foreach ($crumbs as $item) : ?>\n        <tr id=\"attachment_<?= $item->id ?>\" title=\"<?= $item->thema ?>\">\n          <td><?= $item->id ?></td>\n          <td><?= Strings::htmlentities($item->filename); ?></td>\n          <td><?= Strings::htmlentities($item->record_lang); ?></td>\n          <td><?= Utils::formatBytes($item->filesize) ?></td>\n          <td><?= Strings::htmlentities($item->mime_type); ?></td>\n          <td>\n            <button class=\"btn btn-danger btn-delete-attachment\" title=\"<?= Translation::get('ad_gen_delete') ?>\"\n                    data-attachment-id=\"<?= $item->id ?>\"\n                    data-csrf=\"<?= Token::getInstance()->getTokenString('delete-attachment') ?>\">\n              <i aria-hidden=\"true\" class=\"fa fa-trash btn-delete-attachment\" data-attachment-id=\"<?= $item->id ?>\"\n                    data-csrf=\"<?= Token::getInstance()->getTokenString('delete-attachment') ?>\"></i>\n            </button>\n          </td>\n          <td>\n            <a title=\"<?= Translation::get('ad_entry_faq_record') ?>\" class=\"btn btn-info\"\n               href=\"../index.php?action=faq&id=<?= $item->record_id ?>&lang=<?= $item->record_lang ?>\">\n              <i aria-hidden=\"true\" class=\"fa fa-link\"></i>\n            </a>\n          </td>\n        </tr>\n      <?php endforeach; ?>\n      </tbody>\n      <tfoot>\n      <tr>\n        <td colspan=\"5\"><?= $pagination->render(); ?></td>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n</div>\n\n"], "filenames": ["phpmyfaq/admin/attachments.php"], "buggy_code_start_loc": [23], "buggy_code_end_loc": [77], "fixing_code_start_loc": [24], "fixing_code_end_loc": [78], "type": "CWE-79", "message": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. Unsafe echo of filename in phpMyFAQ\\phpmyfaq\\admin\\attachments.php leads to allowed execution of JavaScript code in client side (XSS). This vulnerability has been patched in version 3.2.5.", "other": {"cve": {"id": "CVE-2024-24574", "sourceIdentifier": "security-advisories@github.com", "published": "2024-02-05T21:15:12.340", "lastModified": "2024-02-12T21:41:04.237", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. Unsafe echo of filename in phpMyFAQ\\phpmyfaq\\admin\\attachments.php leads to allowed execution of JavaScript code in client side (XSS). This vulnerability has been patched in version 3.2.5."}, {"lang": "es", "value": "phpMyFAQ es una aplicaci\u00f3n web de preguntas frecuentes de c\u00f3digo abierto para PHP 8.1+ y MySQL, PostgreSQL y otras bases de datos. El eco inseguro del nombre de archivo en phpMyFAQ\\phpmyfaq\\admin\\attachments.php conduce a la ejecuci\u00f3n permitida de c\u00f3digo JavaScript en el lado del cliente (XSS). Esta vulnerabilidad ha sido parcheada en la versi\u00f3n 3.2.5."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "LOW", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 2.5}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}, {"lang": "en", "value": "CWE-80"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.2.5", "matchCriteriaId": "0203E85A-673E-4D3F-BAAF-AE6CABA807FD"}]}]}], "references": [{"url": "https://github.com/thorsten/phpMyFAQ/commit/5479b4a4603cce71aa7eb4437f1c201153a1f1f5", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/thorsten/phpMyFAQ/pull/2827", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-7m8g-fprr-47fx", "source": "security-advisories@github.com", "tags": ["Exploit", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpMyFAQ/commit/5479b4a4603cce71aa7eb4437f1c201153a1f1f5"}}