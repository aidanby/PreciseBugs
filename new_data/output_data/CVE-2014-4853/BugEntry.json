{"buggy_code": ["<?php\n/*\ninit.php - bootloader to initialize variables\n * If the config.php file is not found then an error\n * will be displayed asking the visitor to set up the\n * config.php file.\n *\n * Will also search for config.php in the OpenDocMan parent\n * directory to allow the OpendocMan directory to remain\n * untouched.\n\nCopyright (C) 2011 Stephen Lawrence Jr.\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n */\n\n/*\n * Connect to Database\n */\n$GLOBALS['connection'] = mysql_connect(DB_HOST, DB_USER, DB_PASS) or die (\"Unable to connect: \" . mysql_error());\n$db = mysql_select_db(DB_NAME, $GLOBALS['connection']);\n\n$dsn = \"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME . \";charset=utf8\";\ntry {\n    $pdo = new PDO($dsn, DB_USER, DB_PASS);\n} catch (PDOException $e) {\n    print \"Error!: \" . $e->getMessage() . \"<br/>\";\n    die();\n}\n\n$GLOBALS['pdo'] = $pdo;\n\nob_start();\ninclude('includes/FirePHPCore/fb.php');\n\n/*\n/*\n * Load the Settings class\n */\nrequire_once ( 'Settings_class.php');\n$settings = new Settings();\n$settings->load();\n\n/*\n * Common functions\n */\nrequire_once( 'functions.php' );\n\n/*\n * Load the allowed file types list\n */\nrequire_once ( 'FileTypes_class.php' );\n$filetypes = new FileTypes_class();\n$filetypes->load();\n\n// Set the revision directory. (relative to $dataDir)\n$CONFIG['revisionDir'] = $GLOBALS['CONFIG']['dataDir'] . 'revisionDir/';\n\n// Set the revision directory. (relative to $dataDir)\n$CONFIG['archiveDir'] = $GLOBALS['CONFIG']['dataDir'] . 'archiveDir/';\n\n$_GET = sanitizeme($_GET);\n$_REQUEST = sanitizeme($_REQUEST);\n$_POST = sanitizeme($_POST);\n$_SERVER = sanitizeme($_SERVER);\n"], "fixing_code": ["<?php\n/*\ninit.php - bootloader to initialize variables\n * If the config.php file is not found then an error\n * will be displayed asking the visitor to set up the\n * config.php file.\n *\n * Will also search for config.php in the OpenDocMan parent\n * directory to allow the OpendocMan directory to remain\n * untouched.\n\nCopyright (C) 2011 Stephen Lawrence Jr.\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n */\n\n/*\n * Connect to Database\n */\n$GLOBALS['connection'] = mysql_connect(DB_HOST, DB_USER, DB_PASS) or die (\"Unable to connect: \" . mysql_error());\n$db = mysql_select_db(DB_NAME, $GLOBALS['connection']);\n\n$dsn = \"mysql:host=\" . DB_HOST . \";dbname=\" . DB_NAME . \";charset=utf8\";\ntry {\n    $pdo = new PDO($dsn, DB_USER, DB_PASS);\n} catch (PDOException $e) {\n    print \"Error!: \" . $e->getMessage() . \"<br/>\";\n    die();\n}\n\n$GLOBALS['pdo'] = $pdo;\n\nob_start();\ninclude('includes/FirePHPCore/fb.php');\n\n/*\n/*\n * Load the Settings class\n */\nrequire_once ( 'Settings_class.php');\n$settings = new Settings();\n$settings->load();\n\n/*\n * Common functions\n */\nrequire_once( 'functions.php' );\n\n/*\n * Load the allowed file types list\n */\nrequire_once ( 'FileTypes_class.php' );\n$filetypes = new FileTypes_class();\n$filetypes->load();\n\n// Set the revision directory. (relative to $dataDir)\n$CONFIG['revisionDir'] = $GLOBALS['CONFIG']['dataDir'] . 'revisionDir/';\n\n// Set the revision directory. (relative to $dataDir)\n$CONFIG['archiveDir'] = $GLOBALS['CONFIG']['dataDir'] . 'archiveDir/';\n\n$_GET = sanitizeme($_GET);\n$_REQUEST = sanitizeme($_REQUEST);\n$_POST = sanitizeme($_POST);\n$_SERVER = sanitizeme($_SERVER);\n$_FILES = sanitizeme($_FILES);\n"], "filenames": ["odm-init.php"], "buggy_code_start_loc": [77], "buggy_code_end_loc": [77], "fixing_code_start_loc": [78], "fixing_code_end_loc": [79], "type": "CWE-79", "message": "Cross-site scripting (XSS) vulnerability in odm-init.php in OpenDocMan before 1.2.7.3 allows remote authenticated users to inject arbitrary web script or HTML via the file name of an uploaded file.", "other": {"cve": {"id": "CVE-2014-4853", "sourceIdentifier": "cve@mitre.org", "published": "2014-07-10T16:55:06.203", "lastModified": "2014-07-11T00:10:59.870", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site scripting (XSS) vulnerability in odm-init.php in OpenDocMan before 1.2.7.3 allows remote authenticated users to inject arbitrary web script or HTML via the file name of an uploaded file."}, {"lang": "es", "value": "Vulnerabilidad de XSS en odm-init.php en OpenDocMan anterior a 1.2.7.3 permite a usuarios remotos autenticados inyectar secuencias de comandos web o HTML arbitrarios a trav\u00e9s del nombre de fichero de un fichero subido."}], "metrics": {"cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.2.7.2", "matchCriteriaId": "A08B1B90-D9D2-491F-A8B4-F57935E62F87"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.2:-:*:*:*:*:*:*", "matchCriteriaId": "C4D3F02F-3FE2-4D7A-97A5-7CFB53BFEBC1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.2:a:*:*:*:*:*:*", "matchCriteriaId": "EC21AE07-0BE2-470A-9A9D-9B0A0E1BB50F"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.2:b:*:*:*:*:*:*", "matchCriteriaId": "5A4674E7-CDAE-46E0-BB50-89982B13EA3F"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.3:-:*:*:*:*:*:*", "matchCriteriaId": "AEC5FABB-8752-4CFD-BED7-29DD2CE51B80"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.3:a:*:*:*:*:*:*", "matchCriteriaId": "FE2D011C-A93E-46D0-93CE-3670B92C84A6"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.5:*:*:*:*:*:*:*", "matchCriteriaId": "C4EA4AA2-95AD-4BD2-83E5-C4AE32317216"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.6:*:*:*:*:*:*:*", "matchCriteriaId": "F5DAD56F-53B1-4D49-9A58-CC60AE2CF5CB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.7:-:*:*:*:*:*:*", "matchCriteriaId": "E7691977-FF85-4A33-8F38-2F35E975B1AB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.7:beta:*:*:*:*:*:*", "matchCriteriaId": "6356D416-603D-4CC2-B788-F66AA5C183EA"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.6.8:*:*:*:*:*:*:*", "matchCriteriaId": "3E47E7FB-D37A-4194-A57C-C40E2F3B5743"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.7:*:*:*:*:*:*:*", "matchCriteriaId": "FBA22C31-F0BB-47FF-95B5-6C00FCEBF763"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opendocman:opendocman:1.2.7.1:*:*:*:*:*:*:*", "matchCriteriaId": "4E930F06-8FDB-414A-ACAC-0B3273B290A5"}]}]}], "references": [{"url": "http://packetstormsecurity.com/files/127330/OpenDocMan-1.2.7.2-Cross-Site-Scripting.html", "source": "cve@mitre.org"}, {"url": "http://www.opendocman.com/opendocman-v1-2-7-3-release-notes", "source": "cve@mitre.org", "tags": ["Vendor Advisory"]}, {"url": "https://github.com/opendocman/opendocman/commit/d202ef3def8674be61a3e4ccbe28beba4953b7ce", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/opendocman/opendocman/issues/163", "source": "cve@mitre.org"}]}, "github_commit_url": "https://github.com/opendocman/opendocman/commit/d202ef3def8674be61a3e4ccbe28beba4953b7ce"}}