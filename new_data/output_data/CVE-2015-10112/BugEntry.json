{"buggy_code": ["=== WooFramework Branding ===\nContributors: woothemes,mattyza,jeffikus\nDonate link: http://woothemes.com/\nTags: wooframework, branding, settings\nRequires at least: 3.9.1\nTested up to: 3.9.1\nStable tag: 1.0.1\nLicense: GPLv3 or later\nLicense URI: http://www.gnu.org/licenses/gpl-3.0.html\n\nRebrand the WooFramework.\n\n== Description ==\n\nUsing WooFramework Branding, it's possible to rebrand WooFramework version 6 or higher with your own logo, admin menu icon and menu label.\n\nLooking for a helping hand? [View plugin documentation](http://docs.woothemes.com/document/wooframework-branding/).\n\n== Usage ==\n\nOnce activated, a \"Branding\" menu item will display underneath the WooThemes administration menu. If you're not using a WooThemes theme, this menu will display under the \"Appearance\" menu item.\n\nVisiting this screen will display a table of settings for customising the logo, admin menu icon and admin menu label.\n\nOnce done, click the \"Save Changes\" button, to save and apply your settings.\n\n== Installation ==\n\nInstalling \"WooFramework Branding\" can be done either by searching for \"WooFramework Branding\" via the \"Plugins > Add New\" screen in your WordPress dashboard, or by using the following steps:\n\n1. Download the plugin via WordPress.org.\n1. Upload the ZIP file through the \"Plugins > Add New > Upload\" screen in your WordPress dashboard.\n1. Activate the plugin through the 'Plugins' menu in WordPress\n1. Visit the \"WooThemes > Tweaks\" (or \"Appearance > Tweaks\") section and configure the settings, as desired.\n\n== Frequently Asked Questions ==\n\n= How do I contribute? =\n\nWe encourage everyone to contribute their ideas, thoughts and code snippets. This can be done by forking the [repository over at GitHub](http://github.com/woothemes/wooframework-branding/).\n\n== Screenshots ==\n\n1. The settings screen.\n\n\n== Upgrade Notice ==\n\n= 1.0.1 =\n* 2014-08-22\n* Adds WF export capabilities\n\n= 1.0.0 =\n* 2014-07-03\n* Initial release. Woo!\n\n== Changelog ==\n\n= 1.0.1 =\n* 2014-08-22\n* Adds WF export capabilities\n\n= 1.0.0 =\n* 2014-07-03\n* Initial release. Woo!\n", "<?php\n/**\n * Plugin Name: WooFramework Branding\n * Plugin URI: http://woothemes.com/products/wooframework-branding/\n * Description: Well, g'day there! Lets work together to rebrand your copy of the WooFramework using your logo, your icon and your brand name.\n * Version: 1.0.1\n * Author: Matty\n * Author URI: http://woothemes.com/\n * Requires at least: 3.9.1\n * Tested up to: 3.9.1\n *\n * Text Domain: wooframework-branding\n * Domain Path: /languages/\n *\n * @package WooFramework_Branding\n * @category Core\n * @author Matty\n */\n\nif ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly\n\n/**\n * Returns the main instance of WooFramework_Branding to prevent the need to use globals.\n *\n * @since  1.0.0\n * @return object WooFramework_Branding\n */\nfunction WooFramework_Branding() {\n\treturn WooFramework_Branding::instance();\n} // End WooFramework_Branding()\n\nWooFramework_Branding();\n\n/**\n * Main WooFramework_Branding Class\n *\n * @class WooFramework_Branding\n * @version\t1.0.0\n * @since 1.0.0\n * @package\tWooFramework_Branding\n * @author Matty\n */\nfinal class WooFramework_Branding {\n\t/**\n\t * WooFramework_Branding The single instance of WooFramework_Branding.\n\t * @var \tobject\n\t * @access  private\n\t * @since \t1.0.0\n\t */\n\tprivate static $_instance = null;\n\n\t/**\n\t * The token.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $token;\n\n\t/**\n\t * The version number.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $version;\n\n\t/**\n\t * The admin page slug.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $admin_page;\n\n\t/**\n\t * The admin parent page.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $admin_parent_page;\n\n\t/**\n\t * The instance of WF_Fields.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tprivate $_field_obj;\n\n\t/**\n\t * Constructor function.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function __construct () {\n\t\t$this->token \t\t\t= 'wooframework-branding';\n\t\t$this->plugin_url \t\t= plugin_dir_url( __FILE__ );\n\t\t$this->plugin_path \t\t= plugin_dir_path( __FILE__ );\n\t\t$this->version \t\t\t= '1.0.1';\n\n\t\tregister_activation_hook( __FILE__, array( $this, 'install' ) );\n\n\t\tadd_action( 'init', array( $this, 'load_plugin_textdomain' ) );\n\n\t\t// We need to run this only once the theme is setup and ready.\n\t\tadd_action( 'after_setup_theme', array( $this, 'init' ) );\n\t} // End __construct()\n\n\t/**\n\t * Initialise the plugin.\n\t * @access public\n\t * @since  1.0.0\n\t * @return void\n\t */\n\tpublic function init () {\n\t\tif ( is_admin() ) {\n\t\t\t// Register the admin screen.\n\t\t\tadd_action( 'admin_menu', array( $this, 'register_admin_screen' ) );\n\n\t\t\t// Register the admin screen to be able to load the WooFramework's CSS and other assets.\n\t\t\tadd_filter( 'wf_load_admin_css', array( $this, 'register_screen_id' ) );\n\n\t\t\t// If applicable, instantiate WF_Fields from the WooFramework.\n\t\t\tif ( defined( 'THEME_FRAMEWORK' ) && 'woothemes' == constant( 'THEME_FRAMEWORK' ) && class_exists( 'WF_Fields' ) ) {\n\t\t\t\t$this->_field_obj = new WF_Fields();\n\t\t\t\t$this->_field_obj->init( $this->get_settings_template() );\n\t\t\t\t$this->_field_obj->__set( 'token', 'framework_woo' );\n\t\t\t}\n\t\t\t// Maybe override the WooFramework settings screen logo.\n\t\t\tadd_filter( 'wf_branding_logo', array( $this, 'maybe_override_logo_image_url' ) );\n\n\t\t\t// Maybe override the WooFramework administration menu icon.\n\t\t\tadd_filter( 'wf_branding_icon', array( $this, 'maybe_override_icon_url' ) );\n\n\t\t\t// Maybe override the WooFramework administration menu label.\n\t\t\tadd_action( 'admin_menu', array( $this, 'maybe_override_admin_menu_label' ) );\n\t\t}\n\t} // End init()\n\n\t/**\n\t * Register the screen ID with the WooFramework's asset loader.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function register_screen_id ( $screens ) {\n\t\tif ( ! in_array( 'wf-branding', $screens ) ) {\n\t\t\t$screens[] = 'wf-branding';\n\t\t}\n\t\treturn $screens;\n\t} // End register_screen_id()\n\n\t/**\n\t * Register the admin screen within WordPress.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function register_admin_screen () {\n\t\t$this->admin_parent_page = 'themes.php';\n\t\tif ( defined( 'THEME_FRAMEWORK' ) && 'woothemes' == constant( 'THEME_FRAMEWORK' ) ) {\n\t\t\t$this->admin_parent_page = 'woothemes';\n\t\t}\n\n\t\t$this->admin_page = add_submenu_page( $this->admin_parent_page, __( 'Branding', 'wooframework-branding' ), __( 'Branding', 'wooframework-branding' ), 'manage_options', 'wf-branding', array( $this, 'admin_screen' ) );\n\n\t\t// Admin screen logic.\n\t\tadd_action( 'load-' . $this->admin_page, array( $this, 'admin_screen_logic' ) );\n\n\t\t// Add contextual help tabs.\n\t\tadd_action( 'load-' . $this->admin_page, array( $this, 'admin_screen_help' ) );\n\n\t\t// Make sure our data is added to the WooFramework settings exporter.\n\t\tadd_filter( 'wooframework_export_query_inner', array( $this, 'add_exporter_data' ) );\n\n\t\t// Add admin notices.\n\t\tadd_action( 'admin_notices', array( $this, 'admin_notices' ) );\n\t} // End register_admin_screen()\n\n\t/**\n\t * Load the admin screen markup.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_screen () {\n?>\n\t<div class=\"wrap wooframework-branding-wrap\">\n<?php\n\t\t// If a WooThemes theme isn't activated, display a notice.\n\t\tif ( ! defined( 'THEME_FRAMEWORK' ) || 'woothemes' != constant( 'THEME_FRAMEWORK' ) ) {\n\t\t\techo '<div class=\"error fade\"><p>' . __( 'It appears your theme does not contain the WooFramework. In order to use the WooFramework Branding, please use a theme which makes use of the WooFramework.', 'wooframework-branding' ) . '</p></div>' . \"\\n\";\n\t\t} else {\n\t\t\t// If this is an old version of the WooFramework, display a notice.\n\t\t\tif ( ! class_exists( 'WF_Fields' ) ) {\n\t\t\t\techo '<div class=\"error fade\"><p>' . __( 'It appears you\\'re using an older version of the WooFramework. WooFramework Branding requires WooFramework 6.0 or higher.', 'wooframework-branding' ) . '</p></div>' . \"\\n\";\n\t\t\t} else {\n\t\t\t\t// Otherwise, we're good to go!\n\t\t\t\t$hidden_fields = array( 'page' => 'wf-branding' );\n\t\t\t\tdo_action( 'wf_screen_get_header', 'wf-branding', 'themes' );\n\t\t\t\t$this->_field_obj->__set( 'has_tabs', false );\n\t\t\t\t$this->_field_obj->__set( 'extra_hidden_fields', $hidden_fields );\n\t\t\t\t$this->_field_obj->render();\n\t\t\t\tdo_action( 'wf_screen_get_footer', 'wf-branding', 'themes' );\n\t\t\t}\n\t\t}\n?>\n\t</div><!--/.wrap-->\n<?php\n\t\t// This must be present if using fields that require Javascript or styling.\n\t\tadd_action( 'admin_footer', array( $this->_field_obj, 'maybe_enqueue_field_assets' ) );\n\t} // End admin_screen()\n\n\t/**\n\t * Display admin notices for this settings screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_notices () {\n\t\t$notices = array();\n\n\t\tif ( isset( $_GET['page'] ) && 'wf-branding' == $_GET['page'] && isset( $_GET['updated'] ) && 'true' == $_GET['updated'] ) {\n\t\t\t$notices['settings-updated'] = array( 'type' => 'updated', 'message' => __( 'Settings saved.', 'wooframework-branding' ) );\n\t\t}\n\n\t\tif ( 0 < count( $notices ) ) {\n\t\t\t$html = '';\n\t\t\tforeach ( $notices as $k => $v ) {\n\t\t\t\t$html .= '<div id=\"' . esc_attr( $k ) . '\" class=\"fade ' . esc_attr( $v['type'] ) . '\">' . wpautop( '<strong>' . esc_html( $v['message'] ) . '</strong>' ) . '</div>' . \"\\n\";\n\t\t\t}\n\t\t\techo $html;\n\t\t}\n\t} // End admin_notices()\n\n\t/**\n\t * Load contextual help for the admin screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  string Modified contextual help string.\n\t */\n\tpublic function admin_screen_help () {\n\t\t$screen = get_current_screen();\n\t\tif ( $screen->id != $this->admin_page ) return;\n\n\t\t$overview =\n\t\t\t  '<p>' . __( 'Configure the branding settings and hit the \"Save Changes\" button. It\\'s as easy as that!', 'wooframework-branding' ) . '</p>' .\n\t\t\t  '<p><strong>' . __( 'For more information:', 'wooframework-branding' ) . '</strong></p>' .\n\t\t\t  '<p>' . sprintf( __( '<a href=\"%s\" target=\"_blank\">WooThemes Help Desk</a>', 'wooframework-branding' ), 'http://support.woothemes.com/' ) . '</p>';\n\n\t\t$screen->add_help_tab( array( 'id' => 'wooframework_branding_overview', 'title' => __( 'Overview', 'wooframework-branding' ), 'content' => $overview ) );\n\t} // End admin_screen_help()\n\n\t/**\n\t * Logic to run on the admin screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_screen_logic () {\n\t\tif ( ! empty( $_POST ) && check_admin_referer( $this->_field_obj->__get( 'token' ) . '_nonce', $this->_field_obj->__get( 'token' ) . '_nonce' ) ) {\n\t\t\t$data = $_POST;\n\n\t\t\t$page = 'wf-branding';\n\t\t\tif ( isset( $data['page'] ) ) {\n\t\t\t\t$page = $data['page'];\n\t\t\t\tunset( $data['page'] );\n\t\t\t}\n\n\t\t\t$data = $this->_field_obj->validate_fields( $data );\n\n\t\t\tif ( 0 < count( $data ) ) {\n\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\tupdate_option( $k, $v );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Keep track of the last username to edit the branding screen, so as least one user is never locked out. :)\n\t\t\t$user_id = get_current_user_id();\n\t\t\tupdate_option( 'framework_woo_last_branding_editor', intval( $user_id ) );\n\n\t\t\t// Redirect on settings save, and exit.\n\t\t\t$url = add_query_arg( 'page', $page );\n\t\t\t$url = add_query_arg( 'updated', 'true', $url );\n\n\t\t\twp_safe_redirect( $url );\n\t\t\texit;\n\t\t}\n\t} // End admin_screen_logic()\n\n\t/**\n\t * Maybe override the logo image URL.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_logo_image_url ( $url ) {\n\t\t$image_url = get_option( 'framework_woo_backend_header_image', '' );\n\t\tif ( '' != $image_url ) {\n\t\t\t$url = esc_url( $image_url );\n\t\t}\n\t\treturn $url;\n\t} // End maybe_override_logo_image_url()\n\n\t/**\n\t * Maybe override the icon URL.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_icon_url ( $url ) {\n\t\t$image_url = get_option( 'framework_woo_backend_icon', '' );\n\t\tif ( '' != $image_url ) {\n\t\t\t$url = esc_url( $image_url );\n\t\t}\n\t\treturn $url;\n\t} // End maybe_override_icon_url()\n\n\t/**\n\t * Maybe override the menu label.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_admin_menu_label () {\n\t\tglobal $menu;\n\t\t$label = get_option( 'framework_woo_menu_label', '' );\n\t\tif ( '' != $label && 0 < count( (array)$menu ) ) {\n\t\t\tforeach ( $menu as $k => $v ) {\n\t\t\t\tif ( isset( $v[0] ) && isset( $v[2] ) && 'woothemes' == $v[2] ) {\n\t\t\t\t\t$menu[$k][0] = esc_html( $label );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} // End maybe_override_admin_menu_label()\n\n\t/**\n\t * Return an array of the settings scafolding. The field types, names, etc.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function get_settings_template () {\n\t\treturn array(\n\t\t\t\t// We must have a heading, so the fields can be assigned a section, and display correctly. :)\n\t\t\t\t'woo_branding_heading' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Branding', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'woo_branding_heading',\n\t\t\t\t\t\t\t\t\t\t'type' => 'heading'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_backend_header_image' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Your Logo Image', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => __( 'Your logo image, for use on all WooFramework screens.', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_backend_header_image',\n\t\t\t\t\t\t\t\t\t\t'type' => 'upload'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_backend_icon' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Your Logo Icon', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => __( 'Your logo icon, for the WordPress administration menu.', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_backend_icon',\n\t\t\t\t\t\t\t\t\t\t'type' => 'upload'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_menu_label' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Admin Menu Label', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => sprintf( __( 'The label of the %1$s administration menu. Leave empty for the default menu label.', 'wooframework-branding' ), wp_get_theme()->__get( 'Name' ) ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_menu_label',\n\t\t\t\t\t\t\t\t\t\t'type' => 'text'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t);\n\t} // End get_settings_template()\n\n\t/**\n\t * Main WooFramework_Branding Instance\n\t *\n\t * Ensures only one instance of WooFramework_Branding is loaded or can be loaded.\n\t *\n\t * @since 1.0.0\n\t * @static\n\t * @see WooFramework_Branding()\n\t * @return Main WooFramework_Branding instance\n\t */\n\tpublic static function instance () {\n\t\tif ( is_null( self::$_instance ) )\n\t\t\tself::$_instance = new self();\n\t\treturn self::$_instance;\n\t} // End instance()\n\n\t/**\n\t * Load the localisation file.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function load_plugin_textdomain() {\n\t\tload_plugin_textdomain( 'wooframework-branding', false, dirname( plugin_basename( __FILE__ ) ) . '/languages/' );\n\t} // End load_plugin_textdomain()\n\n\t/**\n\t * Cloning is forbidden.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function __clone () {\n\t\t_doing_it_wrong( __FUNCTION__, __( 'Cheatin&#8217; huh?' ), '1.0.0' );\n\t} // End __clone()\n\n\t/**\n\t * Unserializing instances of this class is forbidden.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function __wakeup () {\n\t\t_doing_it_wrong( __FUNCTION__, __( 'Cheatin&#8217; huh?' ), '1.0.0' );\n\t} // End __wakeup()\n\n\t/**\n\t * Installation. Runs on activation.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function install () {\n\t\t$this->_log_version_number();\n\t} // End install()\n\n\t/**\n\t * Log the plugin version number.\n\t * @access  private\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tprivate function _log_version_number () {\n\t\t// Log the version number.\n\t\tupdate_option( $this->token . '-version', $this->version );\n\t} // End _log_version_number()\n\n\t/**\n \t * Add our saved data to the WooFramework data exporter.\n \t * @access  public\n\t * @since   1.0.1\n \t * @param   string $data SQL query.\n \t * @return  string SQL query.\n \t */\n\tpublic function add_exporter_data ( $data ) {\n\t\t$option_keys = array(\n\t\t\t\t\t\t\t\t'framework_woo_last_branding_editor',\n\t\t\t\t\t\t\t\t'framework_woo_backend_header_image',\n\t\t\t\t\t\t\t\t'framework_woo_backend_icon',\n\t\t\t\t\t\t\t\t'framework_woo_menu_label'\n\t\t\t\t\t\t\t\t);\n\t\tforeach ( $option_keys as $key ) {\n\t\t\t$data .= \" OR option_name = '\" . $key . \"'\";\n\t\t} // End For Loop\n\t\treturn $data;\n\t} // End add_exporter_data()\n\n} // End Class\n?>"], "fixing_code": ["=== WooFramework Branding ===\nContributors: woothemes,mattyza,jeffikus\nDonate link: http://woothemes.com/\nTags: wooframework, branding, settings\nRequires at least: 3.9.1\nTested up to: 4.1.1\nStable tag: 1.0.2\nLicense: GPLv3 or later\nLicense URI: http://www.gnu.org/licenses/gpl-3.0.html\n\nRebrand the WooFramework.\n\n== Description ==\n\nUsing WooFramework Branding, it's possible to rebrand WooFramework version 6 or higher with your own logo, admin menu icon and menu label.\n\nLooking for a helping hand? [View plugin documentation](http://docs.woothemes.com/document/wooframework-branding/).\n\n== Usage ==\n\nOnce activated, a \"Branding\" menu item will display underneath the WooThemes administration menu. If you're not using a WooThemes theme, this menu will display under the \"Appearance\" menu item.\n\nVisiting this screen will display a table of settings for customising the logo, admin menu icon and admin menu label.\n\nOnce done, click the \"Save Changes\" button, to save and apply your settings.\n\n== Installation ==\n\nInstalling \"WooFramework Branding\" can be done either by searching for \"WooFramework Branding\" via the \"Plugins > Add New\" screen in your WordPress dashboard, or by using the following steps:\n\n1. Download the plugin via WordPress.org.\n1. Upload the ZIP file through the \"Plugins > Add New > Upload\" screen in your WordPress dashboard.\n1. Activate the plugin through the 'Plugins' menu in WordPress\n1. Visit the \"WooThemes > Tweaks\" (or \"Appearance > Tweaks\") section and configure the settings, as desired.\n\n== Frequently Asked Questions ==\n\n= How do I contribute? =\n\nWe encourage everyone to contribute their ideas, thoughts and code snippets. This can be done by forking the [repository over at GitHub](http://github.com/woothemes/wooframework-branding/).\n\n== Screenshots ==\n\n1. The settings screen.\n\n\n== Upgrade Notice ==\n\n= 1.0.2 =\n* 2015-04-22\n* Security Fix for remove_query_arg vulnerability\n\n= 1.0.1 =\n* 2014-08-22\n* Adds WF export capabilities\n\n= 1.0.0 =\n* 2014-07-03\n* Initial release. Woo!\n\n== Changelog ==\n\n= 1.0.2 =\n* 2015-04-22\n* Security Fix for remove_query_arg vulnerability\n\n= 1.0.1 =\n* 2014-08-22\n* Adds WF export capabilities\n\n= 1.0.0 =\n* 2014-07-03\n* Initial release. Woo!\n", "<?php\n/**\n * Plugin Name: WooFramework Branding\n * Plugin URI: http://woothemes.com/products/wooframework-branding/\n * Description: Well, g'day there! Lets work together to rebrand your copy of the WooFramework using your logo, your icon and your brand name.\n * Version: 1.0.2\n * Author: Matty\n * Author URI: http://woothemes.com/\n * Requires at least: 3.9.1\n * Tested up to: 4.1.1\n *\n * Text Domain: wooframework-branding\n * Domain Path: /languages/\n *\n * @package WooFramework_Branding\n * @category Core\n * @author Matty\n */\n\nif ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly\n\n/**\n * Returns the main instance of WooFramework_Branding to prevent the need to use globals.\n *\n * @since  1.0.0\n * @return object WooFramework_Branding\n */\nfunction WooFramework_Branding() {\n\treturn WooFramework_Branding::instance();\n} // End WooFramework_Branding()\n\nWooFramework_Branding();\n\n/**\n * Main WooFramework_Branding Class\n *\n * @class WooFramework_Branding\n * @version\t1.0.0\n * @since 1.0.0\n * @package\tWooFramework_Branding\n * @author Matty\n */\nfinal class WooFramework_Branding {\n\t/**\n\t * WooFramework_Branding The single instance of WooFramework_Branding.\n\t * @var \tobject\n\t * @access  private\n\t * @since \t1.0.0\n\t */\n\tprivate static $_instance = null;\n\n\t/**\n\t * The token.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $token;\n\n\t/**\n\t * The version number.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $version;\n\n\t/**\n\t * The admin page slug.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $admin_page;\n\n\t/**\n\t * The admin parent page.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tpublic $admin_parent_page;\n\n\t/**\n\t * The instance of WF_Fields.\n\t * @var     string\n\t * @access  public\n\t * @since   1.0.0\n\t */\n\tprivate $_field_obj;\n\n\t/**\n\t * Constructor function.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function __construct () {\n\t\t$this->token \t\t\t= 'wooframework-branding';\n\t\t$this->plugin_url \t\t= plugin_dir_url( __FILE__ );\n\t\t$this->plugin_path \t\t= plugin_dir_path( __FILE__ );\n\t\t$this->version \t\t\t= '1.0.1';\n\n\t\tregister_activation_hook( __FILE__, array( $this, 'install' ) );\n\n\t\tadd_action( 'init', array( $this, 'load_plugin_textdomain' ) );\n\n\t\t// We need to run this only once the theme is setup and ready.\n\t\tadd_action( 'after_setup_theme', array( $this, 'init' ) );\n\t} // End __construct()\n\n\t/**\n\t * Initialise the plugin.\n\t * @access public\n\t * @since  1.0.0\n\t * @return void\n\t */\n\tpublic function init () {\n\t\tif ( is_admin() ) {\n\t\t\t// Register the admin screen.\n\t\t\tadd_action( 'admin_menu', array( $this, 'register_admin_screen' ) );\n\n\t\t\t// Register the admin screen to be able to load the WooFramework's CSS and other assets.\n\t\t\tadd_filter( 'wf_load_admin_css', array( $this, 'register_screen_id' ) );\n\n\t\t\t// If applicable, instantiate WF_Fields from the WooFramework.\n\t\t\tif ( defined( 'THEME_FRAMEWORK' ) && 'woothemes' == constant( 'THEME_FRAMEWORK' ) && class_exists( 'WF_Fields' ) ) {\n\t\t\t\t$this->_field_obj = new WF_Fields();\n\t\t\t\t$this->_field_obj->init( $this->get_settings_template() );\n\t\t\t\t$this->_field_obj->__set( 'token', 'framework_woo' );\n\t\t\t}\n\t\t\t// Maybe override the WooFramework settings screen logo.\n\t\t\tadd_filter( 'wf_branding_logo', array( $this, 'maybe_override_logo_image_url' ) );\n\n\t\t\t// Maybe override the WooFramework administration menu icon.\n\t\t\tadd_filter( 'wf_branding_icon', array( $this, 'maybe_override_icon_url' ) );\n\n\t\t\t// Maybe override the WooFramework administration menu label.\n\t\t\tadd_action( 'admin_menu', array( $this, 'maybe_override_admin_menu_label' ) );\n\t\t}\n\t} // End init()\n\n\t/**\n\t * Register the screen ID with the WooFramework's asset loader.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function register_screen_id ( $screens ) {\n\t\tif ( ! in_array( 'wf-branding', $screens ) ) {\n\t\t\t$screens[] = 'wf-branding';\n\t\t}\n\t\treturn $screens;\n\t} // End register_screen_id()\n\n\t/**\n\t * Register the admin screen within WordPress.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function register_admin_screen () {\n\t\t$this->admin_parent_page = 'themes.php';\n\t\tif ( defined( 'THEME_FRAMEWORK' ) && 'woothemes' == constant( 'THEME_FRAMEWORK' ) ) {\n\t\t\t$this->admin_parent_page = 'woothemes';\n\t\t}\n\n\t\t$this->admin_page = add_submenu_page( $this->admin_parent_page, __( 'Branding', 'wooframework-branding' ), __( 'Branding', 'wooframework-branding' ), 'manage_options', 'wf-branding', array( $this, 'admin_screen' ) );\n\n\t\t// Admin screen logic.\n\t\tadd_action( 'load-' . $this->admin_page, array( $this, 'admin_screen_logic' ) );\n\n\t\t// Add contextual help tabs.\n\t\tadd_action( 'load-' . $this->admin_page, array( $this, 'admin_screen_help' ) );\n\n\t\t// Make sure our data is added to the WooFramework settings exporter.\n\t\tadd_filter( 'wooframework_export_query_inner', array( $this, 'add_exporter_data' ) );\n\n\t\t// Add admin notices.\n\t\tadd_action( 'admin_notices', array( $this, 'admin_notices' ) );\n\t} // End register_admin_screen()\n\n\t/**\n\t * Load the admin screen markup.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_screen () {\n?>\n\t<div class=\"wrap wooframework-branding-wrap\">\n<?php\n\t\t// If a WooThemes theme isn't activated, display a notice.\n\t\tif ( ! defined( 'THEME_FRAMEWORK' ) || 'woothemes' != constant( 'THEME_FRAMEWORK' ) ) {\n\t\t\techo '<div class=\"error fade\"><p>' . __( 'It appears your theme does not contain the WooFramework. In order to use the WooFramework Branding, please use a theme which makes use of the WooFramework.', 'wooframework-branding' ) . '</p></div>' . \"\\n\";\n\t\t} else {\n\t\t\t// If this is an old version of the WooFramework, display a notice.\n\t\t\tif ( ! class_exists( 'WF_Fields' ) ) {\n\t\t\t\techo '<div class=\"error fade\"><p>' . __( 'It appears you\\'re using an older version of the WooFramework. WooFramework Branding requires WooFramework 6.0 or higher.', 'wooframework-branding' ) . '</p></div>' . \"\\n\";\n\t\t\t} else {\n\t\t\t\t// Otherwise, we're good to go!\n\t\t\t\t$hidden_fields = array( 'page' => 'wf-branding' );\n\t\t\t\tdo_action( 'wf_screen_get_header', 'wf-branding', 'themes' );\n\t\t\t\t$this->_field_obj->__set( 'has_tabs', false );\n\t\t\t\t$this->_field_obj->__set( 'extra_hidden_fields', $hidden_fields );\n\t\t\t\t$this->_field_obj->render();\n\t\t\t\tdo_action( 'wf_screen_get_footer', 'wf-branding', 'themes' );\n\t\t\t}\n\t\t}\n?>\n\t</div><!--/.wrap-->\n<?php\n\t\t// This must be present if using fields that require Javascript or styling.\n\t\tadd_action( 'admin_footer', array( $this->_field_obj, 'maybe_enqueue_field_assets' ) );\n\t} // End admin_screen()\n\n\t/**\n\t * Display admin notices for this settings screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_notices () {\n\t\t$notices = array();\n\n\t\tif ( isset( $_GET['page'] ) && 'wf-branding' == $_GET['page'] && isset( $_GET['updated'] ) && 'true' == $_GET['updated'] ) {\n\t\t\t$notices['settings-updated'] = array( 'type' => 'updated', 'message' => __( 'Settings saved.', 'wooframework-branding' ) );\n\t\t}\n\n\t\tif ( 0 < count( $notices ) ) {\n\t\t\t$html = '';\n\t\t\tforeach ( $notices as $k => $v ) {\n\t\t\t\t$html .= '<div id=\"' . esc_attr( $k ) . '\" class=\"fade ' . esc_attr( $v['type'] ) . '\">' . wpautop( '<strong>' . esc_html( $v['message'] ) . '</strong>' ) . '</div>' . \"\\n\";\n\t\t\t}\n\t\t\techo $html;\n\t\t}\n\t} // End admin_notices()\n\n\t/**\n\t * Load contextual help for the admin screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  string Modified contextual help string.\n\t */\n\tpublic function admin_screen_help () {\n\t\t$screen = get_current_screen();\n\t\tif ( $screen->id != $this->admin_page ) return;\n\n\t\t$overview =\n\t\t\t  '<p>' . __( 'Configure the branding settings and hit the \"Save Changes\" button. It\\'s as easy as that!', 'wooframework-branding' ) . '</p>' .\n\t\t\t  '<p><strong>' . __( 'For more information:', 'wooframework-branding' ) . '</strong></p>' .\n\t\t\t  '<p>' . sprintf( __( '<a href=\"%s\" target=\"_blank\">WooThemes Help Desk</a>', 'wooframework-branding' ), 'http://support.woothemes.com/' ) . '</p>';\n\n\t\t$screen->add_help_tab( array( 'id' => 'wooframework_branding_overview', 'title' => __( 'Overview', 'wooframework-branding' ), 'content' => $overview ) );\n\t} // End admin_screen_help()\n\n\t/**\n\t * Logic to run on the admin screen.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function admin_screen_logic () {\n\t\tif ( ! empty( $_POST ) && check_admin_referer( $this->_field_obj->__get( 'token' ) . '_nonce', $this->_field_obj->__get( 'token' ) . '_nonce' ) ) {\n\t\t\t$data = $_POST;\n\n\t\t\t$page = 'wf-branding';\n\t\t\tif ( isset( $data['page'] ) ) {\n\t\t\t\t$page = $data['page'];\n\t\t\t\tunset( $data['page'] );\n\t\t\t}\n\n\t\t\t$data = $this->_field_obj->validate_fields( $data );\n\n\t\t\tif ( 0 < count( $data ) ) {\n\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\tupdate_option( $k, $v );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Keep track of the last username to edit the branding screen, so as least one user is never locked out. :)\n\t\t\t$user_id = get_current_user_id();\n\t\t\tupdate_option( 'framework_woo_last_branding_editor', intval( $user_id ) );\n\n\t\t\t// Redirect on settings save, and exit.\n\t\t\t$url = add_query_arg( 'page', $page );\n\t\t\t$url = add_query_arg( 'updated', 'true', $url );\n\n\t\t\twp_safe_redirect( esc_url( $url ) );\n\t\t\texit;\n\t\t}\n\t} // End admin_screen_logic()\n\n\t/**\n\t * Maybe override the logo image URL.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_logo_image_url ( $url ) {\n\t\t$image_url = get_option( 'framework_woo_backend_header_image', '' );\n\t\tif ( '' != $image_url ) {\n\t\t\t$url = esc_url( $image_url );\n\t\t}\n\t\treturn $url;\n\t} // End maybe_override_logo_image_url()\n\n\t/**\n\t * Maybe override the icon URL.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_icon_url ( $url ) {\n\t\t$image_url = get_option( 'framework_woo_backend_icon', '' );\n\t\tif ( '' != $image_url ) {\n\t\t\t$url = esc_url( $image_url );\n\t\t}\n\t\treturn $url;\n\t} // End maybe_override_icon_url()\n\n\t/**\n\t * Maybe override the menu label.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function maybe_override_admin_menu_label () {\n\t\tglobal $menu;\n\t\t$label = get_option( 'framework_woo_menu_label', '' );\n\t\tif ( '' != $label && 0 < count( (array)$menu ) ) {\n\t\t\tforeach ( $menu as $k => $v ) {\n\t\t\t\tif ( isset( $v[0] ) && isset( $v[2] ) && 'woothemes' == $v[2] ) {\n\t\t\t\t\t$menu[$k][0] = esc_html( $label );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} // End maybe_override_admin_menu_label()\n\n\t/**\n\t * Return an array of the settings scafolding. The field types, names, etc.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  array\n\t */\n\tpublic function get_settings_template () {\n\t\treturn array(\n\t\t\t\t// We must have a heading, so the fields can be assigned a section, and display correctly. :)\n\t\t\t\t'woo_branding_heading' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Branding', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'woo_branding_heading',\n\t\t\t\t\t\t\t\t\t\t'type' => 'heading'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_backend_header_image' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Your Logo Image', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => __( 'Your logo image, for use on all WooFramework screens.', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_backend_header_image',\n\t\t\t\t\t\t\t\t\t\t'type' => 'upload'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_backend_icon' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Your Logo Icon', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => __( 'Your logo icon, for the WordPress administration menu.', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_backend_icon',\n\t\t\t\t\t\t\t\t\t\t'type' => 'upload'\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t'framework_woo_menu_label' => array(\n\t\t\t\t\t\t\t\t\t\t'name' => __( 'Admin Menu Label', 'wooframework-branding' ),\n\t\t\t\t\t\t\t\t\t\t'desc' => sprintf( __( 'The label of the %1$s administration menu. Leave empty for the default menu label.', 'wooframework-branding' ), wp_get_theme()->__get( 'Name' ) ),\n\t\t\t\t\t\t\t\t\t\t'std' => '',\n\t\t\t\t\t\t\t\t\t\t'id' => 'framework_woo_menu_label',\n\t\t\t\t\t\t\t\t\t\t'type' => 'text'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t);\n\t} // End get_settings_template()\n\n\t/**\n\t * Main WooFramework_Branding Instance\n\t *\n\t * Ensures only one instance of WooFramework_Branding is loaded or can be loaded.\n\t *\n\t * @since 1.0.0\n\t * @static\n\t * @see WooFramework_Branding()\n\t * @return Main WooFramework_Branding instance\n\t */\n\tpublic static function instance () {\n\t\tif ( is_null( self::$_instance ) )\n\t\t\tself::$_instance = new self();\n\t\treturn self::$_instance;\n\t} // End instance()\n\n\t/**\n\t * Load the localisation file.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function load_plugin_textdomain() {\n\t\tload_plugin_textdomain( 'wooframework-branding', false, dirname( plugin_basename( __FILE__ ) ) . '/languages/' );\n\t} // End load_plugin_textdomain()\n\n\t/**\n\t * Cloning is forbidden.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function __clone () {\n\t\t_doing_it_wrong( __FUNCTION__, __( 'Cheatin&#8217; huh?' ), '1.0.0' );\n\t} // End __clone()\n\n\t/**\n\t * Unserializing instances of this class is forbidden.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function __wakeup () {\n\t\t_doing_it_wrong( __FUNCTION__, __( 'Cheatin&#8217; huh?' ), '1.0.0' );\n\t} // End __wakeup()\n\n\t/**\n\t * Installation. Runs on activation.\n\t * @access  public\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tpublic function install () {\n\t\t$this->_log_version_number();\n\t} // End install()\n\n\t/**\n\t * Log the plugin version number.\n\t * @access  private\n\t * @since   1.0.0\n\t * @return  void\n\t */\n\tprivate function _log_version_number () {\n\t\t// Log the version number.\n\t\tupdate_option( $this->token . '-version', $this->version );\n\t} // End _log_version_number()\n\n\t/**\n \t * Add our saved data to the WooFramework data exporter.\n \t * @access  public\n\t * @since   1.0.1\n \t * @param   string $data SQL query.\n \t * @return  string SQL query.\n \t */\n\tpublic function add_exporter_data ( $data ) {\n\t\t$option_keys = array(\n\t\t\t\t\t\t\t\t'framework_woo_last_branding_editor',\n\t\t\t\t\t\t\t\t'framework_woo_backend_header_image',\n\t\t\t\t\t\t\t\t'framework_woo_backend_icon',\n\t\t\t\t\t\t\t\t'framework_woo_menu_label'\n\t\t\t\t\t\t\t\t);\n\t\tforeach ( $option_keys as $key ) {\n\t\t\t$data .= \" OR option_name = '\" . $key . \"'\";\n\t\t} // End For Loop\n\t\treturn $data;\n\t} // End add_exporter_data()\n\n} // End Class\n?>"], "filenames": ["readme.txt", "wooframework-branding.php"], "buggy_code_start_loc": [6, 6], "buggy_code_end_loc": [58, 290], "fixing_code_start_loc": [6, 6], "fixing_code_end_loc": [67, 290], "type": "CWE-601", "message": "A vulnerability classified as problematic has been found in WooFramework Branding Plugin up to 1.0.1 on WordPress. Affected is the function admin_screen_logic of the file wooframework-branding.php. The manipulation of the argument url leads to open redirect. It is possible to launch the attack remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is f12fccd7b5eaf66442346f748c901ef504742f78. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230652.", "other": {"cve": {"id": "CVE-2015-10112", "sourceIdentifier": "cna@vuldb.com", "published": "2023-06-05T08:15:09.380", "lastModified": "2024-02-29T01:16:11.497", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic has been found in WooFramework Branding Plugin up to 1.0.1 on WordPress. Affected is the function admin_screen_logic of the file wooframework-branding.php. The manipulation of the argument url leads to open redirect. It is possible to launch the attack remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is f12fccd7b5eaf66442346f748c901ef504742f78. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230652."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-601"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:woocommerce:wooframework_branding:*:*:*:*:*:wordpress:*:*", "versionEndIncluding": "1.0.1", "matchCriteriaId": "26629C8D-D4BB-4CC1-90E1-465C554028AB"}]}]}], "references": [{"url": "https://github.com/wp-plugins/wooframework-branding/commit/f12fccd7b5eaf66442346f748c901ef504742f78", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.230652", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.230652", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/wooframework-branding/commit/f12fccd7b5eaf66442346f748c901ef504742f78"}}