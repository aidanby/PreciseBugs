{"buggy_code": ["/*jshint node:true*/\n\"use strict\";\n\nvar exec = require(\"child_process\").exec;\n\nfunction runCommand(command, args, done) {\n    if(typeof args === \"function\") {\n        done = args;\n        args = \"\";\n    }\n\n    exec(\"p4 \" + command + \" \" + (args || \"\"), function(err, stdOut, stdErr) {\n        if(err) return done(err);\n        if(stdErr) return done(new Error(stdErr));\n\n        done(null, stdOut);\n    });\n}\n\nfunction edit(path, done) {\n    runCommand(\"edit\", path, done);\n}\n\nfunction add(path, done) {\n    runCommand(\"add\", path, done);\n}\n\nfunction smartEdit(path, done) {\n    edit(path, function(err, stdout) {\n        if(!err) return done(err, stdout);\n\n        add(path, done);\n    });\n}\n\nfunction revertUnchanged(path, done) {\n    runCommand(\"revert\", \"-a\", done);\n}\n\nexports.edit = edit;\nexports.add = add;\nexports.smartEdit = smartEdit;\nexports.run = runCommand;\nexports.revertUnchanged = revertUnchanged;\n", "{\n    \"name\": \"p4\",\n    \"version\": \"0.0.6\",\n    \"description\": \"A small utility library for dealing with Perforce\",\n    \"main\": \"p4.js\",\n    \"author\": \"Nate Long <long.nathaniel@gmail.com>\",\n    \"license\": \"MIT\",\n    \"repository\": {\n        \"type\": \"git\",\n        \"url\" : \"https://github.com/natelong/p4.git\"\n    },\n    \"bugs\" : {\n        \"url\" : \"https://github.com/natelong/p4/issues\"\n    },\n    \"keywords\": [\n        \"p4\",\n        \"perforce\"\n    ]\n}\n"], "fixing_code": ["/*jshint node:true*/\n\"use strict\";\n\nvar exec = require(\"child_process\").spawn;\n\nfunction runCommand(command, args, done) {\n    if(typeof args === \"function\") {\n        done = args;\n        args = \"\";\n    }\n\n    if(!Array.isArray(args)) {\n        args = [args];\n    }\n    args.unshift(command);\n\n    var child = spawn(\"p4\", args);\n    var stdOutBuf = \"\";\n    var stdErrBuf = \"\";\n\n    child.stdout.on(\"data\", (data) => stdOutBuf += data);\n    child.stderr.on(\"data\", (data) => stdErrBuf += data)\n    child.on(\"exit\", (code) => {\n        if (code !== 0) {\n            return done(new Error(`p4 subcommand exited with return code ${}`));\n        }\n\n        if (stdErrBuf.length > 0) {\n            return done(new Error(stdErrBuf));\n        }\n\n        done(null, stdOutBuf);\n    });\n}\n\nfunction edit(path, done) {\n    runCommand(\"edit\", path, done);\n}\n\nfunction add(path, done) {\n    runCommand(\"add\", path, done);\n}\n\nfunction smartEdit(path, done) {\n    edit(path, function(err, stdout) {\n        if(!err) return done(err, stdout);\n\n        add(path, done);\n    });\n}\n\nfunction revertUnchanged(path, done) {\n    runCommand(\"revert\", \"-a\", done);\n}\n\nexports.edit = edit;\nexports.add = add;\nexports.smartEdit = smartEdit;\nexports.run = runCommand;\nexports.revertUnchanged = revertUnchanged;\n", "{\n    \"name\": \"p4\",\n    \"version\": \"0.0.7\",\n    \"description\": \"A small utility library for dealing with Perforce\",\n    \"main\": \"p4.js\",\n    \"author\": \"Nate Long <long.nathaniel@gmail.com>\",\n    \"license\": \"MIT\",\n    \"repository\": {\n        \"type\": \"git\",\n        \"url\" : \"https://github.com/natelong/p4.git\"\n    },\n    \"bugs\" : {\n        \"url\" : \"https://github.com/natelong/p4/issues\"\n    },\n    \"keywords\": [\n        \"p4\",\n        \"perforce\"\n    ]\n}\n"], "filenames": ["p4.js", "package.json"], "buggy_code_start_loc": [4, 3], "buggy_code_end_loc": [17, 4], "fixing_code_start_loc": [4, 3], "fixing_code_end_loc": [33, 4], "type": "CWE-77", "message": "The package p4 before 0.0.7 are vulnerable to Command Injection via the run() function due to improper input sanitization", "other": {"cve": {"id": "CVE-2022-25171", "sourceIdentifier": "report@snyk.io", "published": "2022-12-20T05:15:11.260", "lastModified": "2022-12-29T18:43:50.213", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The package p4 before 0.0.7 are vulnerable to Command Injection via the run() function due to improper input sanitization"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "report@snyk.io", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "LOCAL", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.4, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.4, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-77"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:p4_project:p4:*:*:*:*:*:node.js:*:*", "versionEndExcluding": "0.0.7", "matchCriteriaId": "1D061930-7958-4C8C-A8F7-798EFE58E17A"}]}]}], "references": [{"url": "https://github.com/natelong/p4/blob/master/p4.js%23L12", "source": "report@snyk.io", "tags": ["Broken Link", "Third Party Advisory"]}, {"url": "https://github.com/natelong/p4/commit/ae42e251beabf67c00539ec0e1d7aa149ca445fb", "source": "report@snyk.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://security.snyk.io/vuln/SNYK-JS-P4-3167330", "source": "report@snyk.io", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/natelong/p4/commit/ae42e251beabf67c00539ec0e1d7aa149ca445fb"}}