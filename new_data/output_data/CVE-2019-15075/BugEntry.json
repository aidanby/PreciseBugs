{"buggy_code": ["; ASTPP Database Connection Information\ndbhost = 127.0.0.1\ndbname = astpp\ndbuser = astppuser\ndbpass = <PASSSWORD>\n\n\n; Database type:  ASTPP was designed for a MySQL database initially.  Valid options are:\n; MySQL. Pgsql is coming but is not ready yet.\nastpp_dbengine = MySQLi\n\n; Do we want the startup of ASTPP debugged?\ndebug = 0\n\n;Define Baseurl\n;Note : Default we are running ASTPP on 8089. So, please do not remove 8089 from url.\nbase_url=http://localhost:8089/\n", "#!/bin/bash\n###############################################################################\n# ASTPP - Open Source VoIP Billing Solution\n#\n# Copyright (C) 2019 iNextrix Technologies Pvt. Ltd.\n# ASTPP Version 3.5\n# License https://www.gnu.org/licenses/agpl-3.0.html\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU Affero General Public License as\n# published by the Free Software Foundation, either version 3 of the\n# License, or (at your option) any later version.\n# \n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU Affero General Public License for more details.\n# \n# You should have received a copy of the GNU Affero General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n###############################################################################\n\n\n#################################\n##########  variables ###########\n#################################\n\n#General Congifuration\nTEMP_USER_ANSWER=\"no\"\nASTPP_SOURCE_DIR=/opt/ASTPP\nASTPP_HOST_DOMAIN_NAME=\"host.domain.tld\"\nIS_ENTERPRISE=\"False\"\n\n#ASTPP Configuration\nASTPPDIR=/var/lib/astpp/\nASTPPEXECDIR=/usr/local/astpp/\nASTPPLOGDIR=/var/log/astpp/\n\n#Freeswich Configuration\nFS_DIR=/usr/share/freeswitch\nFS_SOUNDSDIR=${FS_DIR}/sounds/en/us/callie\n\n#HTML and Mysql Configuraition\nWWWDIR=/var/www/html\nASTPP_DATABASE_NAME=\"astpp\"\nASTPP_DB_USER=\"astppuser\"\n\n#################################\n####  general functions #########\n#################################\n\n#Generate random password\ngenpasswd() \n{\n\tlength=$1\n\tdigits=({1..9})\n\tlower=({a..z})\n\tupper=({A..Z})\n\tCharArray=(${digits[*]} ${lower[*]} ${upper[*]})\n\tArrayLength=${#CharArray[*]}\n\tpassword=\"\"\n\tfor i in `seq 1 $length`\n\tdo\n\t        index=$(($RANDOM%$ArrayLength))\n\t        char=${CharArray[$index]}\n\t        password=${password}${char}\n\tdone\n\techo $password\n}\n\nMYSQL_ROOT_PASSWORD=`echo \"$(genpasswd 20)\" | sed s/./*/5`\nASTPPUSER_MYSQL_PASSWORD=`echo \"$(genpasswd 20)\" | sed s/./*/5`\n#Fetch OS Distribution\nget_linux_distribution ()\n{ \n        V1=`cat /etc/*release | head -n1 | tail -n1 | cut -c 14- | cut -c1-18`\n        V2=`cat /etc/*release | head -n7 | tail -n1 | cut -c 14- | cut -c1-14`\n        if [[ $V1 = \"Debian GNU/Linux 9\" ]]; then\n                DIST=\"DEBIAN\"\n        else if [[ $V2 = \"CentOS Linux 7\" ]]; then\n                DIST=\"CENTOS\"\n        else\n                DIST=\"OTHER\"\n                echo -e 'Ooops!!! Quick Installation does not support your distribution \\nPlease use manual steps or contact ASTPP Sales Team \\nat sales@astpp.com.'\n                exit 1\n        fi\n        fi\n}\n\n#Install Prerequisties\ninstall_prerequisties ()\n{\n        if [ $DIST = \"CENTOS\" ]; then\n                systemctl stop httpd\n                systemctl disable httpd\n                yum update\n                yum install -y wget curl git bind-utils ntpdate systemd net-tools whois sendmail sendmail-cf mlocate vim\n        else if [ $DIST = \"DEBIAN\" ]; then\n                systemctl stop apache2\n                systemctl disable apache2\n                apt update\n                apt install -y wget curl git dnsutils ntpdate systemd net-tools whois sendmail-bin sensible-mda mlocate vim\n        fi\n        fi\n}\n\n#Fetch ASTPP Source\nget_astpp_source ()\n{\n        cd /opt\n        git clone -b v4.0 https://github.com/iNextrix/ASTPP.git\n}\n\n#License Acceptence\nlicense_accept ()\n{\n        cd /usr/src\n        if [ $IS_ENTERPRISE = \"True\" ]; then\n                echo \"\"\n        fi\n        if [ $IS_ENTERPRISE = \"False\" ]; then\n                clear\n                echo \"********************\"\n                echo \"License acceptance\"\n                echo \"********************\"\n                if [ -f LICENSE ]; then\n                        more LICENSE\n                else\n                        wget --no-check-certificate -q -O GNU-AGPLv4.0.txt https://raw.githubusercontent.com/iNextrix/ASTPP/master/LICENSE\n                        more GNU-AGPLv4.0.txt\n                fi\n                echo \"***\"\n                echo \"*** I agree to be bound by the terms of the license - [YES/NO]\"\n                echo \"*** \" \n                read ACCEPT\n                while [ \"$ACCEPT\" != \"yes\" ] && [ \"$ACCEPT\" != \"Yes\" ] && [ \"$ACCEPT\" != \"YES\" ] && [ \"$ACCEPT\" != \"no\" ] && [ \"$ACCEPT\" != \"No\" ] && [ \"$ACCEPT\" != \"NO\" ]; do\n                        echo \"I agree to be bound by the terms of the license - [YES/NO]\"\n                        read ACCEPT\n                done\n                if [ \"$ACCEPT\" != \"yes\" ] && [ \"$ACCEPT\" != \"Yes\" ] && [ \"$ACCEPT\" != \"YES\" ]; then\n                        echo \"Ooops!!! License rejected!\"\n                        LICENSE_VALID=False\n                        exit 0\n                else\n                        echo \"Hey!!! Licence accepted!\"\n                        LICENSE_VALID=True\n                fi\n        fi\n}\n\n#Install PHP\ninstall_php ()\n{\n        cd /usr/src\n        if [ \"$DIST\" = \"DEBIAN\" ]; then\n                apt -y install lsb-release apt-transport-https ca-certificates \n                wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg\n                echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" | tee /etc/apt/sources.list.d/php7.3.list\n                apt-get update\n                apt install -y php7.3 php7.3-fpm php7.3-mysql php7.3-cli php7.3-json php7.3-readline php7.3-xml php7.3-curl php7.3-gd php7.3-json php7.3-mbstring php7.3-mysql php7.3-opcache\n                systemctl stop apache2\n                systemctl disable apache2\n        else if [ \"$DIST\" = \"CENTOS\" ]; then\n                yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm \n                yum -y install epel-release yum-utils\n                yum-config-manager --disable remi-php54\n                yum-config-manager --enable remi-php73\n                yum install -y php php-fpm php-mysql php-cli php-json php-readline php-xml php-curl php-gd php-json php-mbstring php-mysql php-opcache\n                systemctl stop httpd\n                systemctl disable httpd\n        fi\n        fi \n}\n\n#Install Mysql\ninstall_mysql ()\n{\n        cd /usr/src\n        if [ \"$DIST\" = \"DEBIAN\" ]; then\n                wget https://repo.mysql.com/mysql-apt-config_0.8.13-1_all.deb\n                dpkg -i mysql-apt-config_0.8.13-1_all.deb\n                apt update\n                apt -y install unixodbc unixodbc-bin\n                debconf-set-selections <<< \"mysql-community-server mysql-community-server/root-pass password ${MYSQL_ROOT_PASSWORD}\"\n                debconf-set-selections <<< \"mysql-community-server mysql-community-server/re-root-pass password ${MYSQL_ROOT_PASSWORD}\"\n                debconf-set-selections <<< \"mysql-community-server mysql-server/default-auth-override select Use Legacy Authentication Method (Retain MySQL 5.x Compatibility)\"\n                DEBIAN_FRONTEND=noninteractive apt install -y mysql-server\n                wget https://cdn.mysql.com//Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit.tar.gz\n                tar -xzvf  mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit.tar.gz\n                cd /usr/src/mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit/\n                cp -rf lib/libmyodbc8* /usr/lib/x86_64-linux-gnu/odbc/.\n        else if [ \"$DIST\" = \"CENTOS\" ]; then\n                wget https://repo.mysql.com/mysql80-community-release-el7-1.noarch.rpm\n                yum localinstall -y mysql80-community-release-el7-1.noarch.rpm\n                yum install -y mysql-community-server unixODBC mysql-connector-odbc\n                systemctl start mysqld\n                MYSQL_ROOT_TEMP=$(grep 'temporary password' /var/log/mysqld.log | cut -c 14- | cut -c100-111 2>&1)\n                mysql -uroot -p${MYSQL_ROOT_TEMP} --connect-expired-password -e \"ALTER USER 'root'@'localhost' IDENTIFIED BY '${MYSQL_ROOT_PASSWORD}';FLUSH PRIVILEGES;\"\n        fi\n        fi\n        echo \"\"\n        echo \"MySQL password set to '${MYSQL_ROOT_PASSWORD}'. Remember to delete ~/.mysql_passwd\" >> ~/.mysql_passwd\n        echo \"\" >>  ~/.mysql_passwd\n        echo \"MySQL astppuser password:  ${ASTPPUSER_MYSQL_PASSWORD} \" >>  ~/.mysql_passwd\n        chmod 400 ~/.mysql_passwd\n}\n\n#Normalize mysql installation\nnormalize_mysql ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/misc/odbc/deb_odbc.ini /etc/odbc.ini\n                sed -i '33i wait_timeout=600' /etc/mysql/mysql.conf.d/mysqld.cnf\n        sed -i '33i interactive_timeout = 600' /etc/mysql/mysql.conf.d/mysqld.cnf\n        sed -i '33i sql_mode=\"\"' /etc/mysql/mysql.conf.d/mysqld.cnf\n        systemctl restart mysql\n                systemctl enable mysql\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                systemctl start mysqld\n                systemctl enable mysqld\n                cp ${ASTPP_SOURCE_DIR}/misc/odbc/cent_odbc.ini /etc/odbc.ini\n                sed -i '26i wait_timeout=600' /etc/my.cnf\n        sed -i '26i interactive_timeout = 600' /etc/my.cnf\n        sed -i '26i sql-mode=\"\"' /etc/my.cnf\n\n        systemctl restart mysqld\n                systemctl enable mysqld\n        fi\n}\n\n#User Response Gathering\nget_user_response ()\n{\n        echo \"\"\n        read -p \"Enter FQDN example (i.e ${ASTPP_HOST_DOMAIN_NAME}): \"\n        ASTPP_HOST_DOMAIN_NAME=${REPLY}\n        echo \"Your entered FQDN is : ${ASTPP_HOST_DOMAIN_NAME} \"\n        echo \"\"\n        read -p \"Enter your email address: ${EMAIL}\"\n        EMAIL=${REPLY}\n        read -n 1 -p \"Press any key to continue ... \"\n        NAT1=$(dig +short myip.opendns.com @resolver1.opendns.com)\n        NAT2=$(curl http://ip-api.com/json/)\n        INTF=$(ifconfig $1|sed -n 2p|awk '{ print $2 }'|awk -F : '{ print $2 }')\n        if [ \"${NAT1}\" != \"${INTF}\" ]; then\n                echo \"Server is behind NAT\";\n                NAT=\"True\"\n        fi\n        curl --data \"email=$EMAIL\" --data \"data=$NAT2\" --data \"type=Install\" http://astppbilling.org/lib/\n}\n\n#Install ASTPP with dependencies\ninstall_astpp ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                echo \"Installing dependencies for ASTPP\"\n                apt update\n                apt install -y nginx ntpdate ntp lua5.1 bc libxml2 libxml2-dev openssl libcurl4-openssl-dev gettext gcc g++\n                echo \"Installing dependencies for ASTPP\"\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                echo \"Installing dependencies for ASTPP\"\n                yum install -y nginx libxml2 libxml2-devel openssl openssl-devel gettext-devel fileutils gcc-c++\n        fi\n        echo \"Creating neccessary locations and configuration files ...\"\n        mkdir -p ${ASTPPDIR}\n        mkdir -p ${ASTPPLOGDIR}\n        mkdir -p ${ASTPPEXECDIR}\n        mkdir -p ${WWWDIR}\n        cp -rf ${ASTPP_SOURCE_DIR}/config/astpp-config.conf ${ASTPPDIR}astpp-config.conf\n        cp -rf ${ASTPP_SOURCE_DIR}/config/astpp.lua ${ASTPPDIR}astpp.lua\n        ln -s ${ASTPP_SOURCE_DIR}/web_interface/astpp ${WWWDIR}\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/fs ${WWWDIR}\n}\n\n#Normalize astpp installation\nnormalize_astpp ()\n{\n        mkdir -p /etc/nginx/ssl\n        openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp -rf ${ASTPP_SOURCE_DIR}/web_interface/nginx/deb_astpp.conf /etc/nginx/conf.d/astpp.conf\n                systemctl start nginx\n                systemctl enable nginx\n                systemctl start php7.3-fpm\n                systemctl enable php7.3-fpm\n                chown -Rf root.root ${ASTPPDIR}\n                chown -Rf www-data.www-data ${ASTPPLOGDIR}\n                chown -Rf root.root ${ASTPPEXECDIR}\n                chown -Rf www-data.www-data ${WWWDIR}/astpp\n\t\tchown -Rf www-data.www-data ${ASTPP_SOURCE_DIR}/web_interface/astpp\n                chmod -Rf 755 ${WWWDIR}/astpp     \n                sed -i \"s/;request_terminate_timeout = 0/request_terminate_timeout = 300/\" /etc/php/7.3/fpm/pool.d/www.conf\n                sed -i \"s#short_open_tag = Off#short_open_tag = On#g\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s#;cgi.fix_pathinfo=1#cgi.fix_pathinfo=1#g\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/max_execution_time = 30/max_execution_time = 3000/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/upload_max_filesize = 2M/upload_max_filesize = 20M/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/post_max_size = 8M/post_max_size = 20M/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/memory_limit = 128M/memory_limit = 512M/\" /etc/php/7.3/fpm/php.ini\n                systemctl restart php7.3-fpm\n\t\tCRONPATH='/var/spool/cron/crontabs/astpp'\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/web_interface/nginx/cent_astpp.conf /etc/nginx/conf.d/astpp.conf\n                setenforce 0\n                systemctl start nginx\n                systemctl enable nginx\n                systemctl start php-fpm\n                systemctl enable php-fpm\n                chown -Rf root.root ${ASTPPDIR}\n                chown -Rf apache.apache ${ASTPPLOGDIR}\n                chown -Rf root.root ${ASTPPEXECDIR}\n                chown -Rf apache.apache ${WWWDIR}/astpp\n\t\tchown -Rf apache.apache ${ASTPP_SOURCE_DIR}/web_interface/astpp\n                chmod -Rf 755 ${WWWDIR}/astpp\n                sed -i \"s/;request_terminate_timeout = 0/request_terminate_timeout = 300/\" /etc/php-fpm.d/www.conf\n                sed -i \"s#short_open_tag = Off#short_open_tag = On#g\" /etc/php.ini\n                sed -i \"s#;cgi.fix_pathinfo=1#cgi.fix_pathinfo=1#g\" /etc/php.ini\n                sed -i \"s/max_execution_time = 30/max_execution_time = 3000/\" /etc/php.ini\n                sed -i \"s/upload_max_filesize = 2M/upload_max_filesize = 20M/\" /etc/php.ini\n                sed -i \"s/post_max_size = 8M/post_max_size = 20M/\" /etc/php.ini\n                sed -i \"s/memory_limit = 128M/memory_limit = 512M/\" /etc/php.ini\n\t\tsystemctl restart php-fpm\n\t\tCRONPATH='/var/spool/cron/astpp'\n        fi\n\techo \"# To call all crons   \n\t\t* * * * * cd ${ASTPP_SOURCE_DIR}/web_interface/astpp/cron/ && php cron.php crons\n\t\t\" > $CRONPATH\n\t\tchmod 600 $CRONPATH\n\t\tcrontab $CRONPATH\n        touch /var/log/astpp/astpp.log\n        chmod 777 /var/log/astpp/astpp.log\n        sed -i \"s#dbpass = <PASSSWORD>#dbpass = ${ASTPPUSER_MYSQL_PASSWORD}#g\" ${ASTPPDIR}astpp-config.conf\n        sed -i \"s#DB_PASSWD=\\\"<PASSSWORD>\\\"#DB_PASSWD = \\\"${ASTPPUSER_MYSQL_PASSWORD}\\\"#g\" ${ASTPPDIR}astpp.lua\n        sed -i \"s#base_url=http://localhost:8089/#base_url=https://${ASTPP_HOST_DOMAIN_NAME}/#g\" ${ASTPPDIR}/astpp-config.conf\n        sed -i \"s#PASSWORD = <PASSWORD>#PASSWORD = ${ASTPPUSER_MYSQL_PASSWORD}#g\" /etc/odbc.ini\n        systemctl restart nginx\n}\n\n#Install freeswitch with dependencies\ninstall_freeswitch ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                clear\n                echo \"Installing FREESWITCH\"\n                sleep 5\n                apt-get install -y gnupg2\n                wget -O - https://files.freeswitch.org/repo/deb/freeswitch-1.8/fsstretch-archive-keyring.asc | apt-key add -\n                echo \"deb http://files.freeswitch.org/repo/deb/freeswitch-1.8/ stretch main\" > /etc/apt/sources.list.d/freeswitch.list\n                echo \"deb-src http://files.freeswitch.org/repo/deb/freeswitch-1.8/ stretch main\" >> /etc/apt/sources.list.d/freeswitch.list\n                apt-get update && apt-get install -y freeswitch-meta-all\n                echo \"FREESWITCH installed successfully. . .\"\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                clear\n                sleep 5\n                echo \"Installing FREESWITCH\"\n                yum install -y http://files.freeswitch.org/freeswitch-release-1-6.noarch.rpm epel-release deltarpm\n                yum install -y freeswitch-config-vanilla freeswitch-lang-* freeswitch-sounds-* freeswitch-xml-curl freeswitch-event-json-cdr freeswitch-lua\n                echo \"FREESWITCH installed successfully. . .\"\n        fi\n        mv -f ${FS_DIR}/scripts /tmp/.\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/fs ${WWWDIR}\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/scripts ${FS_DIR}\n        cp -rf ${ASTPP_SOURCE_DIR}/freeswitch/sounds/*.wav ${FS_SOUNDSDIR}/\n        cp -rf ${ASTPP_SOURCE_DIR}/freeswitch/conf/autoload_configs/* /etc/freeswitch/autoload_configs/\n}\n\n#Normalize freeswitch installation\nnormalize_freeswitch ()\n{\n        systemctl start freeswitch\n        systemctl enable freeswitch\n        sed -i \"s#max-sessions\\\" value=\\\"1000#max-sessions\\\" value=\\\"2000#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#sessions-per-second\\\" value=\\\"30#sessions-per-second\\\" value=\\\"50#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#max-db-handles\\\" value=\\\"50#max-db-handles\\\" value=\\\"500#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#db-handle-timeout\\\" value=\\\"10#db-handle-timeout\\\" value=\\\"30#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        rm -rf  /etc/freeswitch/dialplan/*\n        touch /etc/freeswitch/dialplan/astpp.xml\n        rm -rf  /etc/freeswitch/directory/*\n        touch /etc/freeswitch/directory/astpp.xml\n        rm -rf  /etc/freeswitch/sip_profiles/*\n        touch /etc/freeswitch/sip_profiles/astpp.xml\n        chmod -Rf 755 ${FS_SOUNDSDIR}\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp -rf ${ASTPP_SOURCE_DIR}/web_interface/nginx/deb_fs.conf /etc/nginx/conf.d/fs.conf\n                chown -Rf root.root ${WWWDIR}/fs\n                chmod -Rf 755 ${WWWDIR}/fs\n                /bin/systemctl restart freeswitch\n                /bin/systemctl enable freeswitch\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/web_interface/nginx/cent_fs.conf /etc/nginx/conf.d/fs.conf\n                chown -Rf root.root ${WWWDIR}/fs\n                chmod -Rf 755 ${WWWDIR}/fs\n                sed -i \"s/SELINUX=enforcing/SELINUX=disabled/\" /etc/sysconfig/selinux\n                sed -i \"s/SELINUX=enforcing/SELINUX=disabled/\" /etc/selinux/config\n                /usr/bin/systemctl restart freeswitch\n                /usr/bin/systemctl enable freeswitch\n        fi\n}\n\n#Install Database for ASTPP\ninstall_database ()\n{\n        mysqladmin -u root -p${MYSQL_ROOT_PASSWORD} create ${ASTPP_DATABASE_NAME}\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"CREATE USER 'astppuser'@'localhost' IDENTIFIED BY '${ASTPPUSER_MYSQL_PASSWORD}';\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"ALTER USER 'astppuser'@'localhost' IDENTIFIED WITH mysql_native_password BY '${ASTPPUSER_MYSQL_PASSWORD}';\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"GRANT ALL PRIVILEGES ON \\`${ASTPP_DATABASE_NAME}\\` . * TO 'astppuser'@'localhost' WITH GRANT OPTION;FLUSH PRIVILEGES;\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} astpp < ${ASTPP_SOURCE_DIR}/database/astpp-4.0.sql\n}\n\n#Firewall Configuration\nconfigure_firewall ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                apt install -y firewalld\n                systemctl start firewalld\n                systemctl enable firewalld\n                firewall-cmd --permanent --zone=public --add-service=https\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-service=http\n                firewall-cmd --permanent --zone=public --add-port=5060/udp\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-port=5060/tcp\n                firewall-cmd --permanent --zone=public --add-port=16384-32767/udp\n                firewall-cmd --reload\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                yum install -y firewalld\n                systemctl start firewalld\n                systemctl enable firewalld\n                firewall-cmd --permanent --zone=public --add-service=https\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-service=http\n                firewall-cmd --permanent --zone=public --add-port=5060/udp\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-port=5060/tcp\n                firewall-cmd --permanent --zone=public --add-port=16384-32767/udp\n                firewall-cmd --reload\n        fi\n}\n\n#Install Fail2ban for security\ninstall_fail2ban()\n{\n                read -n 1 -p \"Do you want to install and configure Fail2ban ? (y/n) \"\n                if [ \"$REPLY\"   = \"y\" ]; then\n                        if [ -f /etc/debian_version ] ; then\n                                DIST=\"DEBIAN\"\n                                apt-get -y install fail2ban\n                                echo \"\"\n                            read -p \"Enter Client's Notification email address: ${NOTIEMAIL}\"\n                            NOTIEMAIL=${REPLY}\n                            echo \"\"\n                            read -p \"Enter sender email address: ${NOTISENDEREMAIL}\"\n                            NOTISENDEREMAIL=${REPLY}\n                            cd /usr/src\n                            wget --no-check-certificate --max-redirect=0 http://latest.astppbilling.org/fail2ban_Deb.tar.gz\n                            tar xzvf fail2ban_Deb.tar.gz\n                            rm -rf /etc/fail2ban\n                            cp -rf /usr/src/fail2ban /etc/fail2ban\n                                echo '[DEFAULT]\n# Ban hosts for one hour:\nbantime = -1\nignoreip = 127.0.0.0/8 \n# Override /etc/fail2ban/jail.d/00-firewalld.conf:\nbanaction = iptables-multiport\n\n[ssh]\nenabled  = true\naction   = iptables-allports[name=sshd, protocol=all]\n           sendmail-whois[name=Fail2ban-SSH-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 7200\nbantime  = 86400\n[ssh-ddos]\nenabled = true\nmaxretry = 3\nbantime = 10000000\naction   = iptables-multiport[name=ssh-ddos, port=\"ssh\", protocol=tcp]\n          sendmail-whois[name=Fail2ban-SSH-DDOS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-udp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\nsendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-tcp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\n\n[freeswitch-ip-tcp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath  = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[freeswitch-ip-udp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[sip-auth-failure]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-failure\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-failure, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 3\nfindtime = 30\nbantime  = 7200\n\n[sip-auth-challenge]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-challenge\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-challenge, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender=fail2ban@astpptelephony.com ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 50\nfindtime = 30\nbantime  = 7200' >> /etc/fail2ban/jail.local\n                        elif [ -f /etc/redhat-release ] ; then\n                                DIST=\"CENTOS\"\n                                yum install -y fail2ban\n                                echo \"\"\n                            read -p \"Enter Client's Notification email address: ${NOTIEMAIL}\"\n                            NOTIEMAIL=${REPLY}\n                            echo \"\"\n                            read -p \"Enter sender email address: ${NOTISENDEREMAIL}\"\n                            NOTISENDEREMAIL=${REPLY}\n                            cd /usr/src\n                                                        wget --no-check-certificate --max-redirect=0 http://latest.astppbilling.org/fail2ban_Cent.tar.gz\n                            tar xzvf fail2ban_Cent.tar.gz\n                            rm -rf /etc/fail2ban\n                            cp -rf /usr/src/fail2ban /etc/fail2ban\n                                echo '[DEFAULT]\n# Ban hosts for one hour:\nbantime = -1\nignoreip = 127.0.0.0/8 \n# Override /etc/fail2ban/jail.d/00-firewalld.conf:\nbanaction = iptables-multiport\n\n[sshd]\nenabled  = true\naction   = iptables-allports[name=sshd, protocol=all]\n           sendmail-whois[name=Fail2ban-SSHD-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 7200\nbantime  = 86400\n[sshd-ddos]\nenabled = true\nmaxretry = 3\nbantime = 10000000\naction   = iptables-multiport[name=sshd-ddos, port=\"ssh\", protocol=tcp]\n          sendmail-whois[name=Fail2ban-SSHD-DDOS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-udp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\nsendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-tcp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\n\n[freeswitch-ip-tcp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath  = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[freeswitch-ip-udp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[sip-auth-failure]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-failure\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-failure, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 3\nfindtime = 30\nbantime  = 7200\n\n[sip-auth-challenge]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-challenge\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-challenge, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender=fail2ban@astpptelephony.com ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 50\nfindtime = 30\nbantime  = 7200' >> /etc/fail2ban/jail.local\n                        fi\n                        ################################# JAIL.CONF FILE READY ######################\n                        echo \"################################################################\"\n                        mkdir /var/run/fail2ban\n                        chkconfig fail2ban on\n                        systemctl restart fail2ban\n                        systemctl enable fail2ban\n                        echo \"################################################################\"\n                        echo \"Fail2Ban for FreeSwitch & IPtables Integration completed\"\n                        else\n                        echo \"\"\n                        echo \"Fail2ban installation is aborted !\"\n                fi   \n}\n\n#Install Monit for service monitoring\ninstall_monit ()\n{\nif [ ${DIST} = \"DEBIAN\" ]; then\napt-get -y install monit\nsed -i -e 's/# set mailserver mail.bar.baz,/set mailserver localhost/g' /etc/monit/monitrc\nsed -i -e '/# set mail-format { from: monit@foo.bar }/a set alert '$EMAIL /etc/monit/monitrc\nsed -i -e 's/##   subject: monit alert on --  $EVENT $SERVICE/   subject: monit alert --  $EVENT $SERVICE/g' /etc/monit/monitrc\nsed -i -e 's/##   subject: monit alert --  $EVENT $SERVICE/   subject: monit alert on '${INTF}' --  $EVENT $SERVICE/g' /etc/monit/monitrc\nsed -i -e 's/## set mail-format {/set mail-format {/g' /etc/monit/monitrc\nsed -i -e 's/## }/ }/g' /etc/monit/monitrc\necho '\n#------------MySQL\ncheck process mysqld with pidfile /var/run/mysqld/mysqld.pid\n    start program = \"/bin/systemctl start mysql\"\n    stop program = \"/bin/systemctl stop mysql\"\nif failed host 127.0.0.1 port 3306 then restart\nif 5 restarts within 5 cycles then timeout\n\n#------------Fail2ban\ncheck process fail2ban with pidfile /var/run/fail2ban/fail2ban.pid\n    start program = \"/bin/systemctl start fail2ban\"\n    stop program = \"/bin/systemctl stop fail2ban\"\n\n# ---- FreeSWITCH ----\ncheck process freeswitch with pidfile /var/run/freeswitch/freeswitch.pid\n    start program = \"/bin/systemctl start freeswitch\"\n    stop program  = \"/bin/systemctl stop freeswitch\"\n\n#-------nginx----------------------\ncheck process nginx with pidfile /var/run/nginx.pid\n    start program = \"/bin/systemctl start nginx\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop nginx\"\n\n#-------php-fpm----------------------\ncheck process php7.3-fpm with pidfile /var/run/php/php7.3-fpm.pid\n    start program = \"/bin/systemctl start php7.3-fpm\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop php7.3-fpm\"\n\n#--------system\ncheck system localhost\n    if loadavg (5min) > 8 for 4 cycles then alert\n    if loadavg (15min) > 8 for 4 cycles then alert\n    if memory usage > 80% for 4 cycles then alert\n    if swap usage > 20% for 4 cycles then alert\n    if cpu usage (user) > 80% for 4 cycles then alert\n    if cpu usage (system) > 20% for 4 cycles then alert\n    if cpu usage (wait) > 20% for 4 cycles then alert\n\ncheck filesystem \"root\" with path /\n    if space usage > 80% for 1 cycles then alert' >> /etc/monit/monitrc\n\nsystemctl restart monit\nsystemctl enable monit    \n\nelif [ ${DIST} = \"CENTOS\" ]; then\nyum install -y monit\nrm -rf /etc/monit.d\nrpm --force -Uvh /var/cache/yum/x86_64/7/epel/packages/monit-*.rpm\nsed -i -e 's/# set mailserver mail.bar.baz,/set mailserver localhost/g' /etc/monitrc\nsed -i -e '/# set mail-format { from: monit@foo.bar }/a set alert '$EMAIL /etc/monitrc\nsed -i -e 's/##   subject: monit alert --  $EVENT $SERVICE/   subject: monit alert on '${INTF}' --  $EVENT $SERVICE/g' /etc/monitrc\nsed -i -e 's/## set mail-format {/set mail-format {/g' /etc/monitrc\nsed -i -e 's/## }/ }/g' /etc/monitrc\necho '\n#------------MySQL\ncheck process mysqld with pidfile /var/run/mysqld/mysqld.pid\n    start program = \"/bin/systemctl start mysqld\"\n    stop program = \"/bin/systemctl stop mysqld\"\nif failed host 127.0.0.1 port 3306 then restart\nif 5 restarts within 5 cycles then timeout\n\n#------------Fail2ban\ncheck process fail2ban with pidfile /var/run/fail2ban/fail2ban.pid\n    start program = \"/bin/systemctl start fail2ban\"\n    stop program = \"/bin/systemctl stop fail2ban\"\n\n# ---- FreeSWITCH ----\ncheck process freeswitch with pidfile /var/run/freeswitch/freeswitch.pid\n    start program = \"/bin/systemctl start freeswitch\"\n    stop program  = \"/bin/systemctl stop freeswitch\"\n\n#-------nginx----------------------\ncheck process nginx with pidfile /var/run/nginx.pid\n    start program = \"/bin/systemctl start nginx\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop nginx\"\n    \n#-------php-fpm----------------------\ncheck process php-fpm with pidfile /var/run/php-fpm/php-fpm.pid\n    start program = \"/bin/systemctl start php-fpm\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop php-fpm\"\n\n#--------system\ncheck system localhost\n    if loadavg (5min) > 8 for 4 cycles then alert\n    if loadavg (15min) > 8 for 4 cycles then alert\n    if memory usage > 80% for 4 cycles then alert\n    if swap usage > 20% for 4 cycles then alert\n    if cpu usage (user) > 80% for 4 cycles then alert\n    if cpu usage (system) > 20% for 4 cycles then alert\n    if cpu usage (wait) > 20% for 4 cycles then alert\n\ncheck filesystem \"root\" with path /\n    if space usage > 80% for 1 cycles then alert' >> /etc/monitrc\nsystemctl restart monit\nsystemctl enable monit    \nfi\n}\n\n#Configure logrotation for maintain log size\nlogrotate_install ()\n{\nif [ ${DIST} = \"DEBIAN\" ]; then\n        sed -i -e 's/daily/size 30M/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/rotate 7/rotate 5/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/php7.3-fpm\n        sed -i -e 's/rotate 12/rotate 5/g' /etc/logrotate.d/php7.3-fpm\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/nginx\n        sed -i -e 's/rotate 52/rotate 5/g' /etc/logrotate.d/nginx\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/fail2ban\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/monit    \nelif [ ${DIST} = \"CENTOS\" ]; then\n        sed -i '7 i size 30M' /etc/logrotate.d/syslog\n        sed -i '7 i rotate 5' /etc/logrotate.d/syslog\n        sed -i '2 i size 30M' /etc/logrotate.d/php-fpm\n        sed -i '2 i rotate 5' /etc/logrotate.d/php-fpm\n        sed -i -e 's/daily/size 30M/g' /etc/logrotate.d/nginx\n        sed -i -e 's/rotate 10/rotate 5/g' /etc/logrotate.d/nginx\n        sed -i '9 i size 30M' /etc/logrotate.d/fail2ban\n        sed -i '9 i rotate 5' /etc/logrotate.d/fail2ban\n        sed -i '2 i rotate 5' /etc/logrotate.d/monit\n        sed -i -e 's/size 100k/size 30M/g' /etc/logrotate.d/monit\nfi\n}\n\n#Remove all downloaded and temp files from server\nclean_server ()\n{\n        cd /usr/src\n        rm -rf fail2ban* GNU-AGPLv3.6.txt install.sh mysql80-community-release-el7-1.noarch.rpm\n        echo \"FS restarting...!\"\n        systemctl restart freeswitch\n        echo \"FS restarted...!\"\n}\n\n#Installation Information Print\nstart_installation ()\n{\n        get_linux_distribution\n        install_prerequisties\n        license_accept\n        get_astpp_source\n        get_user_response\n        install_mysql\n        normalize_mysql\n        install_freeswitch\n        install_php\n        install_astpp\n        install_database\n        normalize_freeswitch\n        normalize_astpp\n        configure_firewall\n        install_fail2ban\n        install_monit\n        logrotate_install\n        clean_server\n        clear\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"**********                                                                      **********\"\n        echo \"**********           Your ASTPP is installed successfully                       **********\"\n        echo \"                     Browse URL: https://${ASTPP_HOST_DOMAIN_NAME}\"\n        echo \"                     Username: admin\"     \n        echo \"                     Password: admin\"\n        echo \"\"\n        echo \"                     MySQL root user password:\"\n        echo \"                     ${MYSQL_ROOT_PASSWORD}\"                                       \n        echo \"\"\n        echo \"                     MySQL astppuser password:\"\n        echo \"                     ${ASTPPUSER_MYSQL_PASSWORD}\" \n        echo \"\"               \n        echo \"**********           IMPORTANT NOTE: Please reboot your server once.            **********\"\n        echo \"**********                                                                      **********\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n}\nstart_installation\n\n", "<?php\nif (! defined ( 'BASEPATH' ))\n\texit ( 'No direct script access allowed' );\n\n\t/*\n * |--------------------------------------------------------------------------\n * | Base Site URL\n * |--------------------------------------------------------------------------\n * |\n * | URL to your CodeIgniter root. Typically this will be your base URL,\n * | WITH a trailing slash:\n * |\n * | http://example.com/\n * |\n * | If this is not set then CodeIgniter will guess the protocol, domain and\n * | path to your installation.\n * |\n */\n\n\n$astpp_config = parse_ini_file ( \"/var/lib/astpp/astpp-config.conf\" );\n$config ['base_url'] = $astpp_config ['base_url'];\n\n// $config['perl_url'] = $astpp_config['base_url'].\"cgi-bin/astpp-admin/\";\n/*\n * |--------------------------------------------------------------------------\n * | Index File\n * |--------------------------------------------------------------------------\n * |\n * | Typically this will be your index.php file, unless you've renamed it to\n * | something else. If you are using mod_rewrite to remove the page set this\n * | variable so that it is blank.\n * |\n */\n// $config['index_page'] = 'index.php';\n$config ['index_page'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | URI PROTOCOL\n * |--------------------------------------------------------------------------\n * |\n * | This item determines which server global should be used to retrieve the\n * | URI string. The default setting of 'AUTO' works for most servers.\n * | If your links do not seem to work, try one of the other delicious flavors:\n * |\n * | 'AUTO' Default - auto detects\n * | 'PATH_INFO' Uses the PATH_INFO\n * | 'QUERY_STRING' Uses the QUERY_STRING\n * | 'REQUEST_URI' Uses the REQUEST_URI\n * | 'ORIG_PATH_INFO' Uses the ORIG_PATH_INFO\n * |\n */\n$config ['uri_protocol'] = 'AUTO';\n// $config['uri_protocol'] = 'ORIG_PATH_INFO';\n\n/*\n * |--------------------------------------------------------------------------\n * | URL suffix\n * |--------------------------------------------------------------------------\n * |\n * | This option allows you to add a suffix to all URLs generated by CodeIgniter.\n * | For more information please see the user guide:\n * |\n * | http://codeigniter.com/user_guide/general/urls.html\n */\n\n$config ['url_suffix'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | Default Language\n * |--------------------------------------------------------------------------\n * |\n * | This determines which set of language files should be used. Make sure\n * | there is an available translation if you intend to use something other\n * | than english.\n * |\n */\n$config ['language'] = 'english';\n\n/*\n * |--------------------------------------------------------------------------\n * | Default Character Set\n * |--------------------------------------------------------------------------\n * |\n * | This determines which character set is used by default in various methods\n * | that require a character set to be provided.\n * |\n */\n$config ['charset'] = 'UTF-8';\n\n/*\n * |--------------------------------------------------------------------------\n * | Enable/Disable System Hooks\n * |--------------------------------------------------------------------------\n * |\n * | If you would like to use the 'hooks' feature you must enable it by\n * | setting this variable to TRUE (boolean). See the user guide for details.\n * |\n */\n$config ['enable_hooks'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Class Extension Prefix\n * |--------------------------------------------------------------------------\n * |\n * | This item allows you to set the filename/classname prefix when extending\n * | native libraries. For more information please see the user guide:\n * |\n * | http://codeigniter.com/user_guide/general/core_classes.html\n * | http://codeigniter.com/user_guide/general/creating_libraries.html\n * |\n */\n$config ['subclass_prefix'] = 'MY_';\n\n/*\n * |--------------------------------------------------------------------------\n * | Allowed URL Characters\n * |--------------------------------------------------------------------------\n * |\n * | This lets you specify with a regular expression which characters are permitted\n * | within your URLs. When someone tries to submit a URL with disallowed\n * | characters they will get a warning message.\n * |\n * | As a security measure you are STRONGLY encouraged to restrict URLs to\n * | as few characters as possible. By default only these are allowed: a-z 0-9~%.:_-\n * |\n * | Leave blank to allow all characters -- but only if you are insane.\n * |\n * | DO NOT CHANGE THIS UNLESS YOU FULLY UNDERSTAND THE REPERCUSSIONS!!\n * |\n */\n$config ['permitted_uri_chars'] = 'a-z 0-9~%.:_\\-';\n\n/*\n * |--------------------------------------------------------------------------\n * | Enable Query Strings\n * |--------------------------------------------------------------------------\n * |\n * | By default CodeIgniter uses search-engine friendly segment based URLs:\n * | example.com/who/what/where/\n * |\n * | By default CodeIgniter enables access to the $_GET array. If for some\n * | reason you would like to disable it, set 'allow_get_array' to FALSE.\n * |\n * | You can optionally enable standard query string based URLs:\n * | example.com?who=me&what=something&where=here\n * |\n * | Options are: TRUE or FALSE (boolean)\n * |\n * | The other items let you set the query string 'words' that will\n * | invoke your controllers and its functions:\n * | example.com/index.php?c=controller&m=function\n * |\n * | Please note that some of the helpers won't work as expected when\n * | this feature is enabled, since CodeIgniter is designed primarily to\n * | use segment based URLs.\n * |\n */\n$config ['allow_get_array'] = TRUE;\n$config ['enable_query_strings'] = FALSE;\n$config ['controller_trigger'] = 'c';\n$config ['function_trigger'] = 'm';\n$config ['directory_trigger'] = 'd'; // experimental not currently in use\n\n/*\n * |--------------------------------------------------------------------------\n * | Error Logging Threshold\n * |--------------------------------------------------------------------------\n * |\n * | If you have enabled error logging, you can set an error threshold to\n * | determine what gets logged. Threshold options are:\n * | You can enable error logging by setting a threshold over zero. The\n * | threshold determines what gets logged. Threshold options are:\n * |\n * | 0 = Disables logging, Error logging TURNED OFF\n * | 1 = Error Messages (including PHP errors)\n * | 2 = Debug Messages\n * | 3 = Informational Messages\n * | 4 = All Messages\n * |\n * | For a live site you'll usually only enable Errors (1) to be logged otherwise\n * | your log files will fill up very fast.\n * |\n */\n$config ['log_threshold'] = 0;\n\n/*\n * |--------------------------------------------------------------------------\n * | Error Logging Directory Path\n * |--------------------------------------------------------------------------\n * |\n * | Leave this BLANK unless you would like to set something other than the default\n * | application/logs/ folder. Use a full server path with trailing slash.\n * |\n */\n$config ['log_path'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | Date Format for Logs\n * |--------------------------------------------------------------------------\n * |\n * | Each item that is logged has an associated date. You can use PHP date\n * | codes to set your own date formatting\n * |\n */\n$config ['log_date_format'] = 'Y-m-d H:i:s';\n\n/*\n * |--------------------------------------------------------------------------\n * | Cache Directory Path\n * |--------------------------------------------------------------------------\n * |\n * | Leave this BLANK unless you would like to set something other than the default\n * | system/cache/ folder. Use a full server path with trailing slash.\n * |\n */\n$config ['cache_path'] = '';\n/*\n * |--------------------------------------------------------------------------\n * | Private Key\n * |--------------------------------------------------------------------------\n * |\n * | ASTPP Using private key for encryption/decryption of password.\n * | MUST set private key with 32 characters.\n * |\n */\n$config ['private_key'] = '8YSDaBtDHAB3EQkxPAyTz2I5DttzA9uR';\n/*\n * |--------------------------------------------------------------------------\n * | Encryption Key\n * |--------------------------------------------------------------------------\n * |\n * | If you use the Encryption class or the Session class you\n * | MUST set an encryption key. See the user guide for info.\n * |\n */\n$config ['encryption_key'] = 'r)fddEw232f';\n\n/*\n * |--------------------------------------------------------------------------\n * | Session Variables\n * |------------------------------------------------------k--------------------\n * |\n * | 'sess_cookie_name' = the name you want for the cookie\n * | 'sess_expiration' = the number of SECONDS you want the session to last.\n * | by default sessions last 7200 seconds (two hours). Set to zero for no expiration.\n * | 'sess_expire_on_close' = Whether to cause the session to expire automatically\n * | when the browser window is closed\n * | 'sess_encrypt_cookie' = Whether to encrypt the cookie\n * | 'sess_use_database' = Whether to save the session data to a database\n * | 'sess_table_name' = The name of the session database table\n * | 'sess_match_ip' = Whether to match the user's IP address when reading the session data\n * | 'sess_match_useragent' = Whether to match the User Agent when reading the session data\n * | 'sess_time_to_update' = how many seconds between CI refreshing Session Information\n * |\n */\n$config ['sess_cookie_name'] = 'ci_session';\n$config ['sess_expiration'] = 7200;\n$config ['sess_expire_on_close'] = FALSE;\n$config ['sess_encrypt_cookie'] = TRUE;\n$config ['sess_use_database'] = TRUE;\n$config ['sess_table_name'] = 'ci_sessions';\n$config ['sess_match_ip'] = FALSE;\n$config ['sess_match_useragent'] = TRUE;\n$config ['sess_time_to_update'] = 300;\n\n/*\n * |--------------------------------------------------------------------------\n * | Cookie Related Variables\n * |--------------------------------------------------------------------------\n * |\n * | 'cookie_prefix' = Set a prefix if you need to avoid collisions\n * | 'cookie_domain' = Set to .your-domain.com for site-wide cookies\n * | 'cookie_path' = Typically will be a forward slash\n * | 'cookie_secure' = Cookies will only be set if a secure HTTPS connection exists.\n * |\n */\n$config ['cookie_prefix'] = \"ITPLATP\";\n$config ['cookie_domain'] = \"\";\n$config ['cookie_path'] = \"/\";\n$config ['cookie_secure'] = FALSE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Global XSS Filtering\n * |--------------------------------------------------------------------------\n * |\n * | Determines whether the XSS filter is always active when GET, POST or\n * | COOKIE data is encountered\n * |\n */\n$config ['global_xss_filtering'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Cross Site Request Forgery\n * |--------------------------------------------------------------------------\n * | Enables a CSRF cookie token to be set. When set to TRUE, token will be\n * | checked on a submitted form. If you are accepting user data, it is strongly\n * | recommended CSRF protection be enabled.\n * |\n * | 'csrf_token_name' = The token name\n * | 'csrf_cookie_name' = The cookie name\n * | 'csrf_expire' = The number in seconds the token should expire.\n */\n$config ['csrf_protection'] = FALSE;\n$config ['csrf_token_name'] = 'csrf_test_name';\n$config ['csrf_cookie_name'] = 'csrf_cookie_name';\n$config ['csrf_expire'] = 7200;\n\n\n/*\n * |--------------------------------------------------------------------------\n * | Output Compression\n * |--------------------------------------------------------------------------\n * |\n * | Enables Gzip output compression for faster page loads. When enabled,\n * | the output class will test whether your server supports Gzip.\n * | Even if it does, however, not all browsers support compression\n * | so enable only if you are reasonably sure your visitors can handle it.\n * |\n * | VERY IMPORTANT: If you are getting a blank page when compression is enabled it\n * | means you are prematurely outputting something to your browser. It could\n * | even be a line of whitespace at the end of one of your scripts. For\n * | compression to work, nothing can be sent before the output buffer is called\n * | by the output class. Do not 'echo' any values with compression enabled.\n * |\n */\n$config ['compress_output'] = FALSE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Master Time Reference\n * |--------------------------------------------------------------------------\n * |\n * | Options are 'local' or 'gmt'. This pref tells the system whether to use\n * | your server's local time as the master 'now' reference, or convert it to\n * | GMT. See the 'date helper' page of the user guide for information\n * | regarding date handling.\n * |\n */\n$config ['time_reference'] = 'local';\n\n/*\n * |--------------------------------------------------------------------------\n * | Rewrite PHP Short Tags\n * |--------------------------------------------------------------------------\n * |\n * | If your PHP installation does not have short tag support enabled CI\n * | can rewrite the tags on-the-fly, enabling you to utilize that syntax\n * | in your view files. Options are TRUE or FALSE (boolean)\n * |\n */\n$config ['rewrite_short_tags'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Reverse Proxy IPs\n * |--------------------------------------------------------------------------\n * |\n * | If your server is behind a reverse proxy, you must whitelist the proxy IP\n * | addresses from which CodeIgniter should trust the HTTP_X_FORWARDED_FOR\n * | header in order to properly identify the visitor's IP address.\n * | Comma-delimited, e.g. '10.0.1.200,10.0.1.201'\n * |\n */\n$config ['proxy_ips'] = '';\n$config ['Origination-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'destination' => 'comment',\n\t\t'connection cost (CURRENCY)' => 'connectcost',\n\t\t'grace time' => 'includedseconds',\n\t\t'cost / min (CURRENCY)' => 'cost',\n\t\t'initial increment' => 'init_inc',\n\t\t'increment' => 'inc'\n);\n$config ['Termination-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'destination' => 'comment',\n\t\t'connection cost (CURRENCY)' => 'connectcost',\n\t\t'grace time' => 'includedseconds',\n\t\t'cost / min (CURRENCY)' => 'cost',\n\t\t'initial increment' => 'init_inc',\n\t\t'increment' => 'inc',\n\t\t'strip' => \"strip\",\n\t\t'prepend' => 'prepend'\n);\n$config ['DID-rates-field'] = array (\n\t\t'DID' => 'number',\n\t\t'Country' => 'country_id',\n\t\t'City'=>'city',\n\t\t'Province'=>'province',\n\t\t'Account' => 'accountid',\n\t\t'Per Minute Cost(CURRENCY)' => 'cost',\n\t\t\"Initial Increment\" => \"init_inc\",\n\t\t'Increment' => 'inc',\n\t\t'Setup Fee(CURRENCY)' => 'setup',\n\t\t'Monthly Fee(CURRENCY)' => 'monthlycost',\n\t\t'Call Type' => 'call_type',\n\t\t'Destination' => 'extensions'\n);\n$config ['invoices_path'] = FCPATH . \"invoices/\";\n$config ['invoice_screen'] = FCPATH . APPPATH . \"controllers/\";\n$config ['rates-file-path'] = ASSETSDIR . \"Rates_File/uploaded_files/\";\n$config ['db_upload-file-path'] = \"/tmp/\";\n$config ['Origin-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'prepend' => 'prepend',\n\t\t'destination' => 'comment',\n\t\t'connect cost' => 'connectcost',\n\t\t'included seconds' => 'includedseconds',\n\t\t'per minute cost' => 'cost',\n\t\t'increment' => 'inc',\n\t\t'precedence' => 'precedence',\n\t\t'strip' => \"strip\"\n);\n$config ['package-code-field'] = array (\n\t\t'code' => 'patterns',\n\t\t'destination' => 'destination'\n);\n$config ['invoices_path'] = FCPATH . \"invoices/\";\n$config ['invoice_template'] = APPPATH . \"views/\";\n$config ['invoice_screen'] = APPPATH . \"controllers/\";\n$config ['gzip-path'] = \"/bin/gzip\";\n$config ['gunzip-path'] = \"/bin/gunzip\";\n$config['allow_menu_url'] = array('invoice_conf_list','resellersrates_list');\n$config['allow_module'] = array('tariff','configuration');\n\n/*Access Number*/\n$config ['Accessnumber-rates-field'] = array (\n\t\t'Access number' => 'access_number',\n\t\t'Country' => 'country_id'\n);\n/*Access Number*/\n\n\n/*local number */\n$config ['local_number-rates-field'] = array (\n\t\t'Number' => 'number',\n\t\t'Country' => 'country_id',\n\t\t'Province/State' => 'province',\n\t\t'City' => 'city',\n\t\t\"Status\" => 'status'\n);\n\n\n$config['recordings_path'] = FCPATH.\"playlist/example/media/recordings/\";\n\n"], "fixing_code": ["; ASTPP Database Connection Information\ndbhost = 127.0.0.1\ndbname = astpp\ndbuser = astppuser\ndbpass = <PASSSWORD>\nPRIVATE_KEY = <PR_KEY>\nENCRYPTION_KEY = <EN_KEY>\n\n; Database type:  ASTPP was designed for a MySQL database initially.  Valid options are:\n; MySQL. Pgsql is coming but is not ready yet.\nastpp_dbengine = MySQLi\n\n; Do we want the startup of ASTPP debugged?\ndebug = 0\n\n;Define Baseurl\n;Note : Default we are running ASTPP on 8089. So, please do not remove 8089 from url.\nbase_url=http://localhost:8089/\n", "#!/bin/bash\n###############################################################################\n# ASTPP - Open Source VoIP Billing Solution\n#\n# Copyright (C) 2019 iNextrix Technologies Pvt. Ltd.\n# ASTPP Version 3.5\n# License https://www.gnu.org/licenses/agpl-3.0.html\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU Affero General Public License as\n# published by the Free Software Foundation, either version 3 of the\n# License, or (at your option) any later version.\n# \n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU Affero General Public License for more details.\n# \n# You should have received a copy of the GNU Affero General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n###############################################################################\n\n\n#################################\n##########  variables ###########\n#################################\n\n#General Congifuration\nTEMP_USER_ANSWER=\"no\"\nASTPP_SOURCE_DIR=/opt/ASTPP\nASTPP_HOST_DOMAIN_NAME=\"host.domain.tld\"\nIS_ENTERPRISE=\"False\"\n\n#ASTPP Configuration\nASTPPDIR=/var/lib/astpp/\nASTPPEXECDIR=/usr/local/astpp/\nASTPPLOGDIR=/var/log/astpp/\n\n#Freeswich Configuration\nFS_DIR=/usr/share/freeswitch\nFS_SOUNDSDIR=${FS_DIR}/sounds/en/us/callie\n\n#HTML and Mysql Configuraition\nWWWDIR=/var/www/html\nASTPP_DATABASE_NAME=\"astpp\"\nASTPP_DB_USER=\"astppuser\"\n\n#################################\n####  general functions #########\n#################################\n\n#Generate random password\ngenpasswd() \n{\n\tlength=$1\n\tdigits=({1..9})\n\tlower=({a..z})\n\tupper=({A..Z})\n\tCharArray=(${digits[*]} ${lower[*]} ${upper[*]})\n\tArrayLength=${#CharArray[*]}\n\tpassword=\"\"\n\tfor i in `seq 1 $length`\n\tdo\n\t        index=$(($RANDOM%$ArrayLength))\n\t        char=${CharArray[$index]}\n\t        password=${password}${char}\n\tdone\n\techo $password\n}\n\nMYSQL_ROOT_PASSWORD=`echo \"$(genpasswd 20)\" | sed s/./*/5`\nASTPPUSER_MYSQL_PASSWORD=`echo \"$(genpasswd 20)\" | sed s/./*/5`\nPR_KEY=`echo \"$(genpasswd 32)\"`\nEN_KEY=`echo \"$(genpasswd 12)\"`\n#Fetch OS Distribution\nget_linux_distribution ()\n{ \n        V1=`cat /etc/*release | head -n1 | tail -n1 | cut -c 14- | cut -c1-18`\n        V2=`cat /etc/*release | head -n7 | tail -n1 | cut -c 14- | cut -c1-14`\n        if [[ $V1 = \"Debian GNU/Linux 9\" ]]; then\n                DIST=\"DEBIAN\"\n        else if [[ $V2 = \"CentOS Linux 7\" ]]; then\n                DIST=\"CENTOS\"\n        else\n                DIST=\"OTHER\"\n                echo -e 'Ooops!!! Quick Installation does not support your distribution \\nPlease use manual steps or contact ASTPP Sales Team \\nat sales@astpp.com.'\n                exit 1\n        fi\n        fi\n}\n\n#Install Prerequisties\ninstall_prerequisties ()\n{\n        if [ $DIST = \"CENTOS\" ]; then\n                systemctl stop httpd\n                systemctl disable httpd\n                yum update\n                yum install -y wget curl git bind-utils ntpdate systemd net-tools whois sendmail sendmail-cf mlocate vim\n        else if [ $DIST = \"DEBIAN\" ]; then\n                systemctl stop apache2\n                systemctl disable apache2\n                apt update\n                apt install -y wget curl git dnsutils ntpdate systemd net-tools whois sendmail-bin sensible-mda mlocate vim\n        fi\n        fi\n}\n\n#Fetch ASTPP Source\nget_astpp_source ()\n{\n        cd /opt\n        git clone -b v4.0 https://github.com/iNextrix/ASTPP.git\n}\n\n#License Acceptence\nlicense_accept ()\n{\n        cd /usr/src\n        if [ $IS_ENTERPRISE = \"True\" ]; then\n                echo \"\"\n        fi\n        if [ $IS_ENTERPRISE = \"False\" ]; then\n                clear\n                echo \"********************\"\n                echo \"License acceptance\"\n                echo \"********************\"\n                if [ -f LICENSE ]; then\n                        more LICENSE\n                else\n                        wget --no-check-certificate -q -O GNU-AGPLv4.0.txt https://raw.githubusercontent.com/iNextrix/ASTPP/master/LICENSE\n                        more GNU-AGPLv4.0.txt\n                fi\n                echo \"***\"\n                echo \"*** I agree to be bound by the terms of the license - [YES/NO]\"\n                echo \"*** \" \n                read ACCEPT\n                while [ \"$ACCEPT\" != \"yes\" ] && [ \"$ACCEPT\" != \"Yes\" ] && [ \"$ACCEPT\" != \"YES\" ] && [ \"$ACCEPT\" != \"no\" ] && [ \"$ACCEPT\" != \"No\" ] && [ \"$ACCEPT\" != \"NO\" ]; do\n                        echo \"I agree to be bound by the terms of the license - [YES/NO]\"\n                        read ACCEPT\n                done\n                if [ \"$ACCEPT\" != \"yes\" ] && [ \"$ACCEPT\" != \"Yes\" ] && [ \"$ACCEPT\" != \"YES\" ]; then\n                        echo \"Ooops!!! License rejected!\"\n                        LICENSE_VALID=False\n                        exit 0\n                else\n                        echo \"Hey!!! Licence accepted!\"\n                        LICENSE_VALID=True\n                fi\n        fi\n}\n\n#Install PHP\ninstall_php ()\n{\n        cd /usr/src\n        if [ \"$DIST\" = \"DEBIAN\" ]; then\n                apt -y install lsb-release apt-transport-https ca-certificates \n                wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg\n                echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" | tee /etc/apt/sources.list.d/php7.3.list\n                apt-get update\n                apt install -y php7.3 php7.3-fpm php7.3-mysql php7.3-cli php7.3-json php7.3-readline php7.3-xml php7.3-curl php7.3-gd php7.3-json php7.3-mbstring php7.3-mysql php7.3-opcache\n                systemctl stop apache2\n                systemctl disable apache2\n        else if [ \"$DIST\" = \"CENTOS\" ]; then\n                yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm \n                yum -y install epel-release yum-utils\n                yum-config-manager --disable remi-php54\n                yum-config-manager --enable remi-php73\n                yum install -y php php-fpm php-mysql php-cli php-json php-readline php-xml php-curl php-gd php-json php-mbstring php-mysql php-opcache\n                systemctl stop httpd\n                systemctl disable httpd\n        fi\n        fi \n}\n\n#Install Mysql\ninstall_mysql ()\n{\n        cd /usr/src\n        if [ \"$DIST\" = \"DEBIAN\" ]; then\n                wget https://repo.mysql.com/mysql-apt-config_0.8.13-1_all.deb\n                dpkg -i mysql-apt-config_0.8.13-1_all.deb\n                apt update\n                apt -y install unixodbc unixodbc-bin\n                debconf-set-selections <<< \"mysql-community-server mysql-community-server/root-pass password ${MYSQL_ROOT_PASSWORD}\"\n                debconf-set-selections <<< \"mysql-community-server mysql-community-server/re-root-pass password ${MYSQL_ROOT_PASSWORD}\"\n                debconf-set-selections <<< \"mysql-community-server mysql-server/default-auth-override select Use Legacy Authentication Method (Retain MySQL 5.x Compatibility)\"\n                DEBIAN_FRONTEND=noninteractive apt install -y mysql-server\n                wget https://cdn.mysql.com//Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit.tar.gz\n                tar -xzvf  mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit.tar.gz\n                cd /usr/src/mysql-connector-odbc-8.0.15-linux-debian9-x86-64bit/\n                cp -rf lib/libmyodbc8* /usr/lib/x86_64-linux-gnu/odbc/.\n        else if [ \"$DIST\" = \"CENTOS\" ]; then\n                wget https://repo.mysql.com/mysql80-community-release-el7-1.noarch.rpm\n                yum localinstall -y mysql80-community-release-el7-1.noarch.rpm\n                yum install -y mysql-community-server unixODBC mysql-connector-odbc\n                systemctl start mysqld\n                MYSQL_ROOT_TEMP=$(grep 'temporary password' /var/log/mysqld.log | cut -c 14- | cut -c100-111 2>&1)\n                mysql -uroot -p${MYSQL_ROOT_TEMP} --connect-expired-password -e \"ALTER USER 'root'@'localhost' IDENTIFIED BY '${MYSQL_ROOT_PASSWORD}';FLUSH PRIVILEGES;\"\n        fi\n        fi\n        echo \"\"\n        echo \"MySQL password set to '${MYSQL_ROOT_PASSWORD}'. Remember to delete ~/.mysql_passwd\" >> ~/.mysql_passwd\n        echo \"\" >>  ~/.mysql_passwd\n        echo \"MySQL astppuser password:  ${ASTPPUSER_MYSQL_PASSWORD} \" >>  ~/.mysql_passwd\n        chmod 400 ~/.mysql_passwd\n}\n\n#Normalize mysql installation\nnormalize_mysql ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/misc/odbc/deb_odbc.ini /etc/odbc.ini\n                sed -i '33i wait_timeout=600' /etc/mysql/mysql.conf.d/mysqld.cnf\n        sed -i '33i interactive_timeout = 600' /etc/mysql/mysql.conf.d/mysqld.cnf\n        sed -i '33i sql_mode=\"\"' /etc/mysql/mysql.conf.d/mysqld.cnf\n        systemctl restart mysql\n                systemctl enable mysql\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                systemctl start mysqld\n                systemctl enable mysqld\n                cp ${ASTPP_SOURCE_DIR}/misc/odbc/cent_odbc.ini /etc/odbc.ini\n                sed -i '26i wait_timeout=600' /etc/my.cnf\n        sed -i '26i interactive_timeout = 600' /etc/my.cnf\n        sed -i '26i sql-mode=\"\"' /etc/my.cnf\n\n        systemctl restart mysqld\n                systemctl enable mysqld\n        fi\n}\n\n#User Response Gathering\nget_user_response ()\n{\n        echo \"\"\n        read -p \"Enter FQDN example (i.e ${ASTPP_HOST_DOMAIN_NAME}): \"\n        ASTPP_HOST_DOMAIN_NAME=${REPLY}\n        echo \"Your entered FQDN is : ${ASTPP_HOST_DOMAIN_NAME} \"\n        echo \"\"\n        read -p \"Enter your email address: ${EMAIL}\"\n        EMAIL=${REPLY}\n        read -n 1 -p \"Press any key to continue ... \"\n        NAT1=$(dig +short myip.opendns.com @resolver1.opendns.com)\n        NAT2=$(curl http://ip-api.com/json/)\n        INTF=$(ifconfig $1|sed -n 2p|awk '{ print $2 }'|awk -F : '{ print $2 }')\n        if [ \"${NAT1}\" != \"${INTF}\" ]; then\n                echo \"Server is behind NAT\";\n                NAT=\"True\"\n        fi\n        curl --data \"email=$EMAIL\" --data \"data=$NAT2\" --data \"type=Install\" http://astppbilling.org/lib/\n}\n\n#Install ASTPP with dependencies\ninstall_astpp ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                echo \"Installing dependencies for ASTPP\"\n                apt update\n                apt install -y nginx ntpdate ntp lua5.1 bc libxml2 libxml2-dev openssl libcurl4-openssl-dev gettext gcc g++\n                echo \"Installing dependencies for ASTPP\"\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                echo \"Installing dependencies for ASTPP\"\n                yum install -y nginx libxml2 libxml2-devel openssl openssl-devel gettext-devel fileutils gcc-c++\n        fi\n        echo \"Creating neccessary locations and configuration files ...\"\n        mkdir -p ${ASTPPDIR}\n        mkdir -p ${ASTPPLOGDIR}\n        mkdir -p ${ASTPPEXECDIR}\n        mkdir -p ${WWWDIR}\n        cp -rf ${ASTPP_SOURCE_DIR}/config/astpp-config.conf ${ASTPPDIR}astpp-config.conf\n        cp -rf ${ASTPP_SOURCE_DIR}/config/astpp.lua ${ASTPPDIR}astpp.lua\n        ln -s ${ASTPP_SOURCE_DIR}/web_interface/astpp ${WWWDIR}\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/fs ${WWWDIR}\n}\n\n#Normalize astpp installation\nnormalize_astpp ()\n{\n        mkdir -p /etc/nginx/ssl\n        openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp -rf ${ASTPP_SOURCE_DIR}/web_interface/nginx/deb_astpp.conf /etc/nginx/conf.d/astpp.conf\n                systemctl start nginx\n                systemctl enable nginx\n                systemctl start php7.3-fpm\n                systemctl enable php7.3-fpm\n                chown -Rf root.root ${ASTPPDIR}\n                chown -Rf www-data.www-data ${ASTPPLOGDIR}\n                chown -Rf root.root ${ASTPPEXECDIR}\n                chown -Rf www-data.www-data ${WWWDIR}/astpp\n\t\tchown -Rf www-data.www-data ${ASTPP_SOURCE_DIR}/web_interface/astpp\n                chmod -Rf 755 ${WWWDIR}/astpp     \n                sed -i \"s/;request_terminate_timeout = 0/request_terminate_timeout = 300/\" /etc/php/7.3/fpm/pool.d/www.conf\n                sed -i \"s#short_open_tag = Off#short_open_tag = On#g\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s#;cgi.fix_pathinfo=1#cgi.fix_pathinfo=1#g\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/max_execution_time = 30/max_execution_time = 3000/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/upload_max_filesize = 2M/upload_max_filesize = 20M/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/post_max_size = 8M/post_max_size = 20M/\" /etc/php/7.3/fpm/php.ini\n                sed -i \"s/memory_limit = 128M/memory_limit = 512M/\" /etc/php/7.3/fpm/php.ini\n                systemctl restart php7.3-fpm\n\t\tCRONPATH='/var/spool/cron/crontabs/astpp'\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/web_interface/nginx/cent_astpp.conf /etc/nginx/conf.d/astpp.conf\n                setenforce 0\n                systemctl start nginx\n                systemctl enable nginx\n                systemctl start php-fpm\n                systemctl enable php-fpm\n                chown -Rf root.root ${ASTPPDIR}\n                chown -Rf apache.apache ${ASTPPLOGDIR}\n                chown -Rf root.root ${ASTPPEXECDIR}\n                chown -Rf apache.apache ${WWWDIR}/astpp\n\t\tchown -Rf apache.apache ${ASTPP_SOURCE_DIR}/web_interface/astpp\n                chmod -Rf 755 ${WWWDIR}/astpp\n                sed -i \"s/;request_terminate_timeout = 0/request_terminate_timeout = 300/\" /etc/php-fpm.d/www.conf\n                sed -i \"s#short_open_tag = Off#short_open_tag = On#g\" /etc/php.ini\n                sed -i \"s#;cgi.fix_pathinfo=1#cgi.fix_pathinfo=1#g\" /etc/php.ini\n                sed -i \"s/max_execution_time = 30/max_execution_time = 3000/\" /etc/php.ini\n                sed -i \"s/upload_max_filesize = 2M/upload_max_filesize = 20M/\" /etc/php.ini\n                sed -i \"s/post_max_size = 8M/post_max_size = 20M/\" /etc/php.ini\n                sed -i \"s/memory_limit = 128M/memory_limit = 512M/\" /etc/php.ini\n\t\tsystemctl restart php-fpm\n\t\tCRONPATH='/var/spool/cron/astpp'\n        fi\n\techo \"# To call all crons   \n\t\t* * * * * cd ${ASTPP_SOURCE_DIR}/web_interface/astpp/cron/ && php cron.php crons\n\t\t\" > $CRONPATH\n\t\tchmod 600 $CRONPATH\n\t\tcrontab $CRONPATH\n        touch /var/log/astpp/astpp.log\n        chmod 777 /var/log/astpp/astpp.log\n        sed -i \"s#dbpass = <PASSSWORD>#dbpass = ${ASTPPUSER_MYSQL_PASSWORD}#g\" ${ASTPPDIR}astpp-config.conf\n        sed -i \"s#DB_PASSWD=\\\"<PASSSWORD>\\\"#DB_PASSWD = \\\"${ASTPPUSER_MYSQL_PASSWORD}\\\"#g\" ${ASTPPDIR}astpp.lua\n        sed -i \"s#base_url=http://localhost:8089/#base_url=https://${ASTPP_HOST_DOMAIN_NAME}/#g\" ${ASTPPDIR}/astpp-config.conf\n        sed -i \"s#PASSWORD = <PASSWORD>#PASSWORD = ${ASTPPUSER_MYSQL_PASSWORD}#g\" /etc/odbc.ini\n        sed -i \"s#<PR_KEY>#${PR_KEY}#g\" ${ASTPPDIR}astpp-config.conf\n        sed -i \"s#<EN_KEY>#${EN_KEY}#g\" ${ASTPPDIR}astpp-config.conf\n        systemctl restart nginx\n}\n\n#Install freeswitch with dependencies\ninstall_freeswitch ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                clear\n                echo \"Installing FREESWITCH\"\n                sleep 5\n                apt-get install -y gnupg2\n                wget -O - https://files.freeswitch.org/repo/deb/freeswitch-1.8/fsstretch-archive-keyring.asc | apt-key add -\n                echo \"deb http://files.freeswitch.org/repo/deb/freeswitch-1.8/ stretch main\" > /etc/apt/sources.list.d/freeswitch.list\n                echo \"deb-src http://files.freeswitch.org/repo/deb/freeswitch-1.8/ stretch main\" >> /etc/apt/sources.list.d/freeswitch.list\n                apt-get update && apt-get install -y freeswitch-meta-all\n                echo \"FREESWITCH installed successfully. . .\"\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                clear\n                sleep 5\n                echo \"Installing FREESWITCH\"\n                yum install -y http://files.freeswitch.org/freeswitch-release-1-6.noarch.rpm epel-release deltarpm\n                yum install -y freeswitch-config-vanilla freeswitch-lang-* freeswitch-sounds-* freeswitch-xml-curl freeswitch-event-json-cdr freeswitch-lua\n                echo \"FREESWITCH installed successfully. . .\"\n        fi\n        mv -f ${FS_DIR}/scripts /tmp/.\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/fs ${WWWDIR}\n        ln -s ${ASTPP_SOURCE_DIR}/freeswitch/scripts ${FS_DIR}\n        cp -rf ${ASTPP_SOURCE_DIR}/freeswitch/sounds/*.wav ${FS_SOUNDSDIR}/\n        cp -rf ${ASTPP_SOURCE_DIR}/freeswitch/conf/autoload_configs/* /etc/freeswitch/autoload_configs/\n}\n\n#Normalize freeswitch installation\nnormalize_freeswitch ()\n{\n        systemctl start freeswitch\n        systemctl enable freeswitch\n        sed -i \"s#max-sessions\\\" value=\\\"1000#max-sessions\\\" value=\\\"2000#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#sessions-per-second\\\" value=\\\"30#sessions-per-second\\\" value=\\\"50#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#max-db-handles\\\" value=\\\"50#max-db-handles\\\" value=\\\"500#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        sed -i \"s#db-handle-timeout\\\" value=\\\"10#db-handle-timeout\\\" value=\\\"30#g\" /etc/freeswitch/autoload_configs/switch.conf.xml\n        rm -rf  /etc/freeswitch/dialplan/*\n        touch /etc/freeswitch/dialplan/astpp.xml\n        rm -rf  /etc/freeswitch/directory/*\n        touch /etc/freeswitch/directory/astpp.xml\n        rm -rf  /etc/freeswitch/sip_profiles/*\n        touch /etc/freeswitch/sip_profiles/astpp.xml\n        chmod -Rf 755 ${FS_SOUNDSDIR}\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                cp -rf ${ASTPP_SOURCE_DIR}/web_interface/nginx/deb_fs.conf /etc/nginx/conf.d/fs.conf\n                chown -Rf root.root ${WWWDIR}/fs\n                chmod -Rf 755 ${WWWDIR}/fs\n                /bin/systemctl restart freeswitch\n                /bin/systemctl enable freeswitch\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                cp ${ASTPP_SOURCE_DIR}/web_interface/nginx/cent_fs.conf /etc/nginx/conf.d/fs.conf\n                chown -Rf root.root ${WWWDIR}/fs\n                chmod -Rf 755 ${WWWDIR}/fs\n                sed -i \"s/SELINUX=enforcing/SELINUX=disabled/\" /etc/sysconfig/selinux\n                sed -i \"s/SELINUX=enforcing/SELINUX=disabled/\" /etc/selinux/config\n                /usr/bin/systemctl restart freeswitch\n                /usr/bin/systemctl enable freeswitch\n        fi\n}\n\n#Install Database for ASTPP\ninstall_database ()\n{\n        mysqladmin -u root -p${MYSQL_ROOT_PASSWORD} create ${ASTPP_DATABASE_NAME}\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"CREATE USER 'astppuser'@'localhost' IDENTIFIED BY '${ASTPPUSER_MYSQL_PASSWORD}';\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"ALTER USER 'astppuser'@'localhost' IDENTIFIED WITH mysql_native_password BY '${ASTPPUSER_MYSQL_PASSWORD}';\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} -e \"GRANT ALL PRIVILEGES ON \\`${ASTPP_DATABASE_NAME}\\` . * TO 'astppuser'@'localhost' WITH GRANT OPTION;FLUSH PRIVILEGES;\"\n        mysql -uroot -p${MYSQL_ROOT_PASSWORD} astpp < ${ASTPP_SOURCE_DIR}/database/astpp-4.0.sql\n}\n\n#Firewall Configuration\nconfigure_firewall ()\n{\n        if [ ${DIST} = \"DEBIAN\" ]; then\n                apt install -y firewalld\n                systemctl start firewalld\n                systemctl enable firewalld\n                firewall-cmd --permanent --zone=public --add-service=https\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-service=http\n                firewall-cmd --permanent --zone=public --add-port=5060/udp\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-port=5060/tcp\n                firewall-cmd --permanent --zone=public --add-port=16384-32767/udp\n                firewall-cmd --reload\n        elif  [ ${DIST} = \"CENTOS\" ]; then\n                yum install -y firewalld\n                systemctl start firewalld\n                systemctl enable firewalld\n                firewall-cmd --permanent --zone=public --add-service=https\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-service=http\n                firewall-cmd --permanent --zone=public --add-port=5060/udp\n\t\t\t\tfirewall-cmd --permanent --zone=public --add-port=5060/tcp\n                firewall-cmd --permanent --zone=public --add-port=16384-32767/udp\n                firewall-cmd --reload\n        fi\n}\n\n#Install Fail2ban for security\ninstall_fail2ban()\n{\n                read -n 1 -p \"Do you want to install and configure Fail2ban ? (y/n) \"\n                if [ \"$REPLY\"   = \"y\" ]; then\n                        if [ -f /etc/debian_version ] ; then\n                                DIST=\"DEBIAN\"\n                                apt-get -y install fail2ban\n                                echo \"\"\n                            read -p \"Enter Client's Notification email address: ${NOTIEMAIL}\"\n                            NOTIEMAIL=${REPLY}\n                            echo \"\"\n                            read -p \"Enter sender email address: ${NOTISENDEREMAIL}\"\n                            NOTISENDEREMAIL=${REPLY}\n                            cd /usr/src\n                            wget --no-check-certificate --max-redirect=0 http://latest.astppbilling.org/fail2ban_Deb.tar.gz\n                            tar xzvf fail2ban_Deb.tar.gz\n                            rm -rf /etc/fail2ban\n                            cp -rf /usr/src/fail2ban /etc/fail2ban\n                                echo '[DEFAULT]\n# Ban hosts for one hour:\nbantime = -1\nignoreip = 127.0.0.0/8 \n# Override /etc/fail2ban/jail.d/00-firewalld.conf:\nbanaction = iptables-multiport\n\n[ssh]\nenabled  = true\naction   = iptables-allports[name=sshd, protocol=all]\n           sendmail-whois[name=Fail2ban-SSH-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 7200\nbantime  = 86400\n[ssh-ddos]\nenabled = true\nmaxretry = 3\nbantime = 10000000\naction   = iptables-multiport[name=ssh-ddos, port=\"ssh\", protocol=tcp]\n          sendmail-whois[name=Fail2ban-SSH-DDOS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-udp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\nsendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-tcp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\n\n[freeswitch-ip-tcp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath  = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[freeswitch-ip-udp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[sip-auth-failure]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-failure\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-failure, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 3\nfindtime = 30\nbantime  = 7200\n\n[sip-auth-challenge]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-challenge\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-challenge, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender=fail2ban@astpptelephony.com ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 50\nfindtime = 30\nbantime  = 7200' >> /etc/fail2ban/jail.local\n                        elif [ -f /etc/redhat-release ] ; then\n                                DIST=\"CENTOS\"\n                                yum install -y fail2ban\n                                echo \"\"\n                            read -p \"Enter Client's Notification email address: ${NOTIEMAIL}\"\n                            NOTIEMAIL=${REPLY}\n                            echo \"\"\n                            read -p \"Enter sender email address: ${NOTISENDEREMAIL}\"\n                            NOTISENDEREMAIL=${REPLY}\n                            cd /usr/src\n                                                        wget --no-check-certificate --max-redirect=0 http://latest.astppbilling.org/fail2ban_Cent.tar.gz\n                            tar xzvf fail2ban_Cent.tar.gz\n                            rm -rf /etc/fail2ban\n                            cp -rf /usr/src/fail2ban /etc/fail2ban\n                                echo '[DEFAULT]\n# Ban hosts for one hour:\nbantime = -1\nignoreip = 127.0.0.0/8 \n# Override /etc/fail2ban/jail.d/00-firewalld.conf:\nbanaction = iptables-multiport\n\n[sshd]\nenabled  = true\naction   = iptables-allports[name=sshd, protocol=all]\n           sendmail-whois[name=Fail2ban-SSHD-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 7200\nbantime  = 86400\n[sshd-ddos]\nenabled = true\nmaxretry = 3\nbantime = 10000000\naction   = iptables-multiport[name=sshd-ddos, port=\"ssh\", protocol=tcp]\n          sendmail-whois[name=Fail2ban-SSHD-DDOS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-udp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\nsendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\n[freeswitch-tcp]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = freeswitch\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 5\nfindtime = 600\nbantime  = 3600\n#          sendmail-whois[name=FreeSwitch, dest=root, sender=fail2ban@example.org] #no smtp server installed\n\n[freeswitch-ip-tcp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath  = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-tcp, port=\"%(port)s\", protocol=tcp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[freeswitch-ip-udp]\nenabled  = false\nport     = 5060\nprotocol = all\nfilter   = freeswitch-ip\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=freeswitch-ip-udp, port=\"%(port)s\", protocol=udp]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 1\nfindtime = 30\nbantime  = 86400\n\n[sip-auth-failure]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-failure\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-failure, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender='${NOTISENDEREMAIL}' ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 3\nfindtime = 30\nbantime  = 7200\n\n[sip-auth-challenge]\nenabled  = true\nport     = 5060\nprotocol = all\nfilter   = sip-auth-challenge\nlogpath = /var/log/freeswitch/freeswitch.log\naction   = iptables-multiport[name=sip-auth-challenge, port=\"%(port)s\", protocol=all]\n           sendmail-whois[name=Fail2ban-FS-'${INTF}',sender=fail2ban@astpptelephony.com ,dest=\"'${NOTIEMAIL}'\"]\nmaxretry = 50\nfindtime = 30\nbantime  = 7200' >> /etc/fail2ban/jail.local\n                        fi\n                        ################################# JAIL.CONF FILE READY ######################\n                        echo \"################################################################\"\n                        mkdir /var/run/fail2ban\n                        chkconfig fail2ban on\n                        systemctl restart fail2ban\n                        systemctl enable fail2ban\n                        echo \"################################################################\"\n                        echo \"Fail2Ban for FreeSwitch & IPtables Integration completed\"\n                        else\n                        echo \"\"\n                        echo \"Fail2ban installation is aborted !\"\n                fi   \n}\n\n#Install Monit for service monitoring\ninstall_monit ()\n{\nif [ ${DIST} = \"DEBIAN\" ]; then\napt-get -y install monit\nsed -i -e 's/# set mailserver mail.bar.baz,/set mailserver localhost/g' /etc/monit/monitrc\nsed -i -e '/# set mail-format { from: monit@foo.bar }/a set alert '$EMAIL /etc/monit/monitrc\nsed -i -e 's/##   subject: monit alert on --  $EVENT $SERVICE/   subject: monit alert --  $EVENT $SERVICE/g' /etc/monit/monitrc\nsed -i -e 's/##   subject: monit alert --  $EVENT $SERVICE/   subject: monit alert on '${INTF}' --  $EVENT $SERVICE/g' /etc/monit/monitrc\nsed -i -e 's/## set mail-format {/set mail-format {/g' /etc/monit/monitrc\nsed -i -e 's/## }/ }/g' /etc/monit/monitrc\necho '\n#------------MySQL\ncheck process mysqld with pidfile /var/run/mysqld/mysqld.pid\n    start program = \"/bin/systemctl start mysql\"\n    stop program = \"/bin/systemctl stop mysql\"\nif failed host 127.0.0.1 port 3306 then restart\nif 5 restarts within 5 cycles then timeout\n\n#------------Fail2ban\ncheck process fail2ban with pidfile /var/run/fail2ban/fail2ban.pid\n    start program = \"/bin/systemctl start fail2ban\"\n    stop program = \"/bin/systemctl stop fail2ban\"\n\n# ---- FreeSWITCH ----\ncheck process freeswitch with pidfile /var/run/freeswitch/freeswitch.pid\n    start program = \"/bin/systemctl start freeswitch\"\n    stop program  = \"/bin/systemctl stop freeswitch\"\n\n#-------nginx----------------------\ncheck process nginx with pidfile /var/run/nginx.pid\n    start program = \"/bin/systemctl start nginx\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop nginx\"\n\n#-------php-fpm----------------------\ncheck process php7.3-fpm with pidfile /var/run/php/php7.3-fpm.pid\n    start program = \"/bin/systemctl start php7.3-fpm\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop php7.3-fpm\"\n\n#--------system\ncheck system localhost\n    if loadavg (5min) > 8 for 4 cycles then alert\n    if loadavg (15min) > 8 for 4 cycles then alert\n    if memory usage > 80% for 4 cycles then alert\n    if swap usage > 20% for 4 cycles then alert\n    if cpu usage (user) > 80% for 4 cycles then alert\n    if cpu usage (system) > 20% for 4 cycles then alert\n    if cpu usage (wait) > 20% for 4 cycles then alert\n\ncheck filesystem \"root\" with path /\n    if space usage > 80% for 1 cycles then alert' >> /etc/monit/monitrc\n\nsystemctl restart monit\nsystemctl enable monit    \n\nelif [ ${DIST} = \"CENTOS\" ]; then\nyum install -y monit\nrm -rf /etc/monit.d\nrpm --force -Uvh /var/cache/yum/x86_64/7/epel/packages/monit-*.rpm\nsed -i -e 's/# set mailserver mail.bar.baz,/set mailserver localhost/g' /etc/monitrc\nsed -i -e '/# set mail-format { from: monit@foo.bar }/a set alert '$EMAIL /etc/monitrc\nsed -i -e 's/##   subject: monit alert --  $EVENT $SERVICE/   subject: monit alert on '${INTF}' --  $EVENT $SERVICE/g' /etc/monitrc\nsed -i -e 's/## set mail-format {/set mail-format {/g' /etc/monitrc\nsed -i -e 's/## }/ }/g' /etc/monitrc\necho '\n#------------MySQL\ncheck process mysqld with pidfile /var/run/mysqld/mysqld.pid\n    start program = \"/bin/systemctl start mysqld\"\n    stop program = \"/bin/systemctl stop mysqld\"\nif failed host 127.0.0.1 port 3306 then restart\nif 5 restarts within 5 cycles then timeout\n\n#------------Fail2ban\ncheck process fail2ban with pidfile /var/run/fail2ban/fail2ban.pid\n    start program = \"/bin/systemctl start fail2ban\"\n    stop program = \"/bin/systemctl stop fail2ban\"\n\n# ---- FreeSWITCH ----\ncheck process freeswitch with pidfile /var/run/freeswitch/freeswitch.pid\n    start program = \"/bin/systemctl start freeswitch\"\n    stop program  = \"/bin/systemctl stop freeswitch\"\n\n#-------nginx----------------------\ncheck process nginx with pidfile /var/run/nginx.pid\n    start program = \"/bin/systemctl start nginx\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop nginx\"\n    \n#-------php-fpm----------------------\ncheck process php-fpm with pidfile /var/run/php-fpm/php-fpm.pid\n    start program = \"/bin/systemctl start php-fpm\" with timeout 30 seconds\n    stop program  = \"/bin/systemctl stop php-fpm\"\n\n#--------system\ncheck system localhost\n    if loadavg (5min) > 8 for 4 cycles then alert\n    if loadavg (15min) > 8 for 4 cycles then alert\n    if memory usage > 80% for 4 cycles then alert\n    if swap usage > 20% for 4 cycles then alert\n    if cpu usage (user) > 80% for 4 cycles then alert\n    if cpu usage (system) > 20% for 4 cycles then alert\n    if cpu usage (wait) > 20% for 4 cycles then alert\n\ncheck filesystem \"root\" with path /\n    if space usage > 80% for 1 cycles then alert' >> /etc/monitrc\nsystemctl restart monit\nsystemctl enable monit    \nfi\n}\n\n#Configure logrotation for maintain log size\nlogrotate_install ()\n{\nif [ ${DIST} = \"DEBIAN\" ]; then\n        sed -i -e 's/daily/size 30M/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/rotate 7/rotate 5/g' /etc/logrotate.d/rsyslog\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/php7.3-fpm\n        sed -i -e 's/rotate 12/rotate 5/g' /etc/logrotate.d/php7.3-fpm\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/nginx\n        sed -i -e 's/rotate 52/rotate 5/g' /etc/logrotate.d/nginx\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/fail2ban\n        sed -i -e 's/weekly/size 30M/g' /etc/logrotate.d/monit    \nelif [ ${DIST} = \"CENTOS\" ]; then\n        sed -i '7 i size 30M' /etc/logrotate.d/syslog\n        sed -i '7 i rotate 5' /etc/logrotate.d/syslog\n        sed -i '2 i size 30M' /etc/logrotate.d/php-fpm\n        sed -i '2 i rotate 5' /etc/logrotate.d/php-fpm\n        sed -i -e 's/daily/size 30M/g' /etc/logrotate.d/nginx\n        sed -i -e 's/rotate 10/rotate 5/g' /etc/logrotate.d/nginx\n        sed -i '9 i size 30M' /etc/logrotate.d/fail2ban\n        sed -i '9 i rotate 5' /etc/logrotate.d/fail2ban\n        sed -i '2 i rotate 5' /etc/logrotate.d/monit\n        sed -i -e 's/size 100k/size 30M/g' /etc/logrotate.d/monit\nfi\n}\n\n#Remove all downloaded and temp files from server\nclean_server ()\n{\n        cd /usr/src\n        rm -rf fail2ban* GNU-AGPLv3.6.txt install.sh mysql80-community-release-el7-1.noarch.rpm\n        echo \"FS restarting...!\"\n        systemctl restart freeswitch\n        echo \"FS restarted...!\"\n}\n\n#Installation Information Print\nstart_installation ()\n{\n        get_linux_distribution\n        install_prerequisties\n        license_accept\n        get_astpp_source\n        get_user_response\n        install_mysql\n        normalize_mysql\n        install_freeswitch\n        install_php\n        install_astpp\n        install_database\n        normalize_freeswitch\n        normalize_astpp\n        configure_firewall\n        install_fail2ban\n        install_monit\n        logrotate_install\n        clean_server\n        clear\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"**********                                                                      **********\"\n        echo \"**********           Your ASTPP is installed successfully                       **********\"\n        echo \"                     Browse URL: https://${ASTPP_HOST_DOMAIN_NAME}\"\n        echo \"                     Username: admin\"     \n        echo \"                     Password: admin\"\n        echo \"\"\n        echo \"                     MySQL root user password:\"\n        echo \"                     ${MYSQL_ROOT_PASSWORD}\"                                       \n        echo \"\"\n        echo \"                     MySQL astppuser password:\"\n        echo \"                     ${ASTPPUSER_MYSQL_PASSWORD}\" \n        echo \"\"               \n        echo \"**********           IMPORTANT NOTE: Please reboot your server once.            **********\"\n        echo \"**********                                                                      **********\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n        echo \"******************************************************************************************\"\n}\nstart_installation\n\n", "<?php\nif (! defined ( 'BASEPATH' ))\n\texit ( 'No direct script access allowed' );\n\n\t/*\n * |--------------------------------------------------------------------------\n * | Base Site URL\n * |--------------------------------------------------------------------------\n * |\n * | URL to your CodeIgniter root. Typically this will be your base URL,\n * | WITH a trailing slash:\n * |\n * | http://example.com/\n * |\n * | If this is not set then CodeIgniter will guess the protocol, domain and\n * | path to your installation.\n * |\n */\n\n\n$astpp_config = parse_ini_file ( \"/var/lib/astpp/astpp-config.conf\" );\n$config ['base_url'] = $astpp_config ['base_url'];\n\n// $config['perl_url'] = $astpp_config['base_url'].\"cgi-bin/astpp-admin/\";\n/*\n * |--------------------------------------------------------------------------\n * | Index File\n * |--------------------------------------------------------------------------\n * |\n * | Typically this will be your index.php file, unless you've renamed it to\n * | something else. If you are using mod_rewrite to remove the page set this\n * | variable so that it is blank.\n * |\n */\n// $config['index_page'] = 'index.php';\n$config ['index_page'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | URI PROTOCOL\n * |--------------------------------------------------------------------------\n * |\n * | This item determines which server global should be used to retrieve the\n * | URI string. The default setting of 'AUTO' works for most servers.\n * | If your links do not seem to work, try one of the other delicious flavors:\n * |\n * | 'AUTO' Default - auto detects\n * | 'PATH_INFO' Uses the PATH_INFO\n * | 'QUERY_STRING' Uses the QUERY_STRING\n * | 'REQUEST_URI' Uses the REQUEST_URI\n * | 'ORIG_PATH_INFO' Uses the ORIG_PATH_INFO\n * |\n */\n$config ['uri_protocol'] = 'AUTO';\n// $config['uri_protocol'] = 'ORIG_PATH_INFO';\n\n/*\n * |--------------------------------------------------------------------------\n * | URL suffix\n * |--------------------------------------------------------------------------\n * |\n * | This option allows you to add a suffix to all URLs generated by CodeIgniter.\n * | For more information please see the user guide:\n * |\n * | http://codeigniter.com/user_guide/general/urls.html\n */\n\n$config ['url_suffix'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | Default Language\n * |--------------------------------------------------------------------------\n * |\n * | This determines which set of language files should be used. Make sure\n * | there is an available translation if you intend to use something other\n * | than english.\n * |\n */\n$config ['language'] = 'english';\n\n/*\n * |--------------------------------------------------------------------------\n * | Default Character Set\n * |--------------------------------------------------------------------------\n * |\n * | This determines which character set is used by default in various methods\n * | that require a character set to be provided.\n * |\n */\n$config ['charset'] = 'UTF-8';\n\n/*\n * |--------------------------------------------------------------------------\n * | Enable/Disable System Hooks\n * |--------------------------------------------------------------------------\n * |\n * | If you would like to use the 'hooks' feature you must enable it by\n * | setting this variable to TRUE (boolean). See the user guide for details.\n * |\n */\n$config ['enable_hooks'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Class Extension Prefix\n * |--------------------------------------------------------------------------\n * |\n * | This item allows you to set the filename/classname prefix when extending\n * | native libraries. For more information please see the user guide:\n * |\n * | http://codeigniter.com/user_guide/general/core_classes.html\n * | http://codeigniter.com/user_guide/general/creating_libraries.html\n * |\n */\n$config ['subclass_prefix'] = 'MY_';\n\n/*\n * |--------------------------------------------------------------------------\n * | Allowed URL Characters\n * |--------------------------------------------------------------------------\n * |\n * | This lets you specify with a regular expression which characters are permitted\n * | within your URLs. When someone tries to submit a URL with disallowed\n * | characters they will get a warning message.\n * |\n * | As a security measure you are STRONGLY encouraged to restrict URLs to\n * | as few characters as possible. By default only these are allowed: a-z 0-9~%.:_-\n * |\n * | Leave blank to allow all characters -- but only if you are insane.\n * |\n * | DO NOT CHANGE THIS UNLESS YOU FULLY UNDERSTAND THE REPERCUSSIONS!!\n * |\n */\n$config ['permitted_uri_chars'] = 'a-z 0-9~%.:_\\-';\n\n/*\n * |--------------------------------------------------------------------------\n * | Enable Query Strings\n * |--------------------------------------------------------------------------\n * |\n * | By default CodeIgniter uses search-engine friendly segment based URLs:\n * | example.com/who/what/where/\n * |\n * | By default CodeIgniter enables access to the $_GET array. If for some\n * | reason you would like to disable it, set 'allow_get_array' to FALSE.\n * |\n * | You can optionally enable standard query string based URLs:\n * | example.com?who=me&what=something&where=here\n * |\n * | Options are: TRUE or FALSE (boolean)\n * |\n * | The other items let you set the query string 'words' that will\n * | invoke your controllers and its functions:\n * | example.com/index.php?c=controller&m=function\n * |\n * | Please note that some of the helpers won't work as expected when\n * | this feature is enabled, since CodeIgniter is designed primarily to\n * | use segment based URLs.\n * |\n */\n$config ['allow_get_array'] = TRUE;\n$config ['enable_query_strings'] = FALSE;\n$config ['controller_trigger'] = 'c';\n$config ['function_trigger'] = 'm';\n$config ['directory_trigger'] = 'd'; // experimental not currently in use\n\n/*\n * |--------------------------------------------------------------------------\n * | Error Logging Threshold\n * |--------------------------------------------------------------------------\n * |\n * | If you have enabled error logging, you can set an error threshold to\n * | determine what gets logged. Threshold options are:\n * | You can enable error logging by setting a threshold over zero. The\n * | threshold determines what gets logged. Threshold options are:\n * |\n * | 0 = Disables logging, Error logging TURNED OFF\n * | 1 = Error Messages (including PHP errors)\n * | 2 = Debug Messages\n * | 3 = Informational Messages\n * | 4 = All Messages\n * |\n * | For a live site you'll usually only enable Errors (1) to be logged otherwise\n * | your log files will fill up very fast.\n * |\n */\n$config ['log_threshold'] = 0;\n\n/*\n * |--------------------------------------------------------------------------\n * | Error Logging Directory Path\n * |--------------------------------------------------------------------------\n * |\n * | Leave this BLANK unless you would like to set something other than the default\n * | application/logs/ folder. Use a full server path with trailing slash.\n * |\n */\n$config ['log_path'] = '';\n\n/*\n * |--------------------------------------------------------------------------\n * | Date Format for Logs\n * |--------------------------------------------------------------------------\n * |\n * | Each item that is logged has an associated date. You can use PHP date\n * | codes to set your own date formatting\n * |\n */\n$config ['log_date_format'] = 'Y-m-d H:i:s';\n\n/*\n * |--------------------------------------------------------------------------\n * | Cache Directory Path\n * |--------------------------------------------------------------------------\n * |\n * | Leave this BLANK unless you would like to set something other than the default\n * | system/cache/ folder. Use a full server path with trailing slash.\n * |\n */\n$config ['cache_path'] = '';\n/*\n * |--------------------------------------------------------------------------\n * | Private Key\n * |--------------------------------------------------------------------------\n * |\n * | ASTPP Using private key for encryption/decryption of password.\n * | MUST set private key with 32 characters.\n * |\n */\n$config ['private_key'] = $astpp_config ['PRIVATE_KEY'];\n/*\n * |--------------------------------------------------------------------------\n * | Encryption Key\n * |--------------------------------------------------------------------------\n * |\n * | If you use the Encryption class or the Session class you\n * | MUST set an encryption key. See the user guide for info.\n * |\n */\n$config ['encryption_key'] = $astpp_config ['ENCRYPTION_KEY'];\n/*\n * |--------------------------------------------------------------------------\n * | Session Variables\n * |------------------------------------------------------k--------------------\n * |\n * | 'sess_cookie_name' = the name you want for the cookie\n * | 'sess_expiration' = the number of SECONDS you want the session to last.\n * | by default sessions last 7200 seconds (two hours). Set to zero for no expiration.\n * | 'sess_expire_on_close' = Whether to cause the session to expire automatically\n * | when the browser window is closed\n * | 'sess_encrypt_cookie' = Whether to encrypt the cookie\n * | 'sess_use_database' = Whether to save the session data to a database\n * | 'sess_table_name' = The name of the session database table\n * | 'sess_match_ip' = Whether to match the user's IP address when reading the session data\n * | 'sess_match_useragent' = Whether to match the User Agent when reading the session data\n * | 'sess_time_to_update' = how many seconds between CI refreshing Session Information\n * |\n */\n$config ['sess_cookie_name'] = 'ci_session';\n$config ['sess_expiration'] = 7200;\n$config ['sess_expire_on_close'] = FALSE;\n$config ['sess_encrypt_cookie'] = TRUE;\n$config ['sess_use_database'] = TRUE;\n$config ['sess_table_name'] = 'ci_sessions';\n$config ['sess_match_ip'] = FALSE;\n$config ['sess_match_useragent'] = TRUE;\n$config ['sess_time_to_update'] = 300;\n\n/*\n * |--------------------------------------------------------------------------\n * | Cookie Related Variables\n * |--------------------------------------------------------------------------\n * |\n * | 'cookie_prefix' = Set a prefix if you need to avoid collisions\n * | 'cookie_domain' = Set to .your-domain.com for site-wide cookies\n * | 'cookie_path' = Typically will be a forward slash\n * | 'cookie_secure' = Cookies will only be set if a secure HTTPS connection exists.\n * |\n */\n$config ['cookie_prefix'] = \"ITPLATP\";\n$config ['cookie_domain'] = \"\";\n$config ['cookie_path'] = \"/\";\n$config ['cookie_secure'] = FALSE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Global XSS Filtering\n * |--------------------------------------------------------------------------\n * |\n * | Determines whether the XSS filter is always active when GET, POST or\n * | COOKIE data is encountered\n * |\n */\n$config ['global_xss_filtering'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Cross Site Request Forgery\n * |--------------------------------------------------------------------------\n * | Enables a CSRF cookie token to be set. When set to TRUE, token will be\n * | checked on a submitted form. If you are accepting user data, it is strongly\n * | recommended CSRF protection be enabled.\n * |\n * | 'csrf_token_name' = The token name\n * | 'csrf_cookie_name' = The cookie name\n * | 'csrf_expire' = The number in seconds the token should expire.\n */\n$config ['csrf_protection'] = FALSE;\n$config ['csrf_token_name'] = 'csrf_test_name';\n$config ['csrf_cookie_name'] = 'csrf_cookie_name';\n$config ['csrf_expire'] = 7200;\n\n\n/*\n * |--------------------------------------------------------------------------\n * | Output Compression\n * |--------------------------------------------------------------------------\n * |\n * | Enables Gzip output compression for faster page loads. When enabled,\n * | the output class will test whether your server supports Gzip.\n * | Even if it does, however, not all browsers support compression\n * | so enable only if you are reasonably sure your visitors can handle it.\n * |\n * | VERY IMPORTANT: If you are getting a blank page when compression is enabled it\n * | means you are prematurely outputting something to your browser. It could\n * | even be a line of whitespace at the end of one of your scripts. For\n * | compression to work, nothing can be sent before the output buffer is called\n * | by the output class. Do not 'echo' any values with compression enabled.\n * |\n */\n$config ['compress_output'] = FALSE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Master Time Reference\n * |--------------------------------------------------------------------------\n * |\n * | Options are 'local' or 'gmt'. This pref tells the system whether to use\n * | your server's local time as the master 'now' reference, or convert it to\n * | GMT. See the 'date helper' page of the user guide for information\n * | regarding date handling.\n * |\n */\n$config ['time_reference'] = 'local';\n\n/*\n * |--------------------------------------------------------------------------\n * | Rewrite PHP Short Tags\n * |--------------------------------------------------------------------------\n * |\n * | If your PHP installation does not have short tag support enabled CI\n * | can rewrite the tags on-the-fly, enabling you to utilize that syntax\n * | in your view files. Options are TRUE or FALSE (boolean)\n * |\n */\n$config ['rewrite_short_tags'] = TRUE;\n\n/*\n * |--------------------------------------------------------------------------\n * | Reverse Proxy IPs\n * |--------------------------------------------------------------------------\n * |\n * | If your server is behind a reverse proxy, you must whitelist the proxy IP\n * | addresses from which CodeIgniter should trust the HTTP_X_FORWARDED_FOR\n * | header in order to properly identify the visitor's IP address.\n * | Comma-delimited, e.g. '10.0.1.200,10.0.1.201'\n * |\n */\n$config ['proxy_ips'] = '';\n$config ['Origination-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'destination' => 'comment',\n\t\t'connection cost (CURRENCY)' => 'connectcost',\n\t\t'grace time' => 'includedseconds',\n\t\t'cost / min (CURRENCY)' => 'cost',\n\t\t'initial increment' => 'init_inc',\n\t\t'increment' => 'inc'\n);\n$config ['Termination-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'destination' => 'comment',\n\t\t'connection cost (CURRENCY)' => 'connectcost',\n\t\t'grace time' => 'includedseconds',\n\t\t'cost / min (CURRENCY)' => 'cost',\n\t\t'initial increment' => 'init_inc',\n\t\t'increment' => 'inc',\n\t\t'strip' => \"strip\",\n\t\t'prepend' => 'prepend'\n);\n$config ['DID-rates-field'] = array (\n\t\t'DID' => 'number',\n\t\t'Country' => 'country_id',\n\t\t'City'=>'city',\n\t\t'Province'=>'province',\n\t\t'Account' => 'accountid',\n\t\t'Per Minute Cost(CURRENCY)' => 'cost',\n\t\t\"Initial Increment\" => \"init_inc\",\n\t\t'Increment' => 'inc',\n\t\t'Setup Fee(CURRENCY)' => 'setup',\n\t\t'Monthly Fee(CURRENCY)' => 'monthlycost',\n\t\t'Call Type' => 'call_type',\n\t\t'Destination' => 'extensions'\n);\n$config ['invoices_path'] = FCPATH . \"invoices/\";\n$config ['invoice_screen'] = FCPATH . APPPATH . \"controllers/\";\n$config ['rates-file-path'] = ASSETSDIR . \"Rates_File/uploaded_files/\";\n$config ['db_upload-file-path'] = \"/tmp/\";\n$config ['Origin-rates-field'] = array (\n\t\t'code' => 'pattern',\n\t\t'prepend' => 'prepend',\n\t\t'destination' => 'comment',\n\t\t'connect cost' => 'connectcost',\n\t\t'included seconds' => 'includedseconds',\n\t\t'per minute cost' => 'cost',\n\t\t'increment' => 'inc',\n\t\t'precedence' => 'precedence',\n\t\t'strip' => \"strip\"\n);\n$config ['package-code-field'] = array (\n\t\t'code' => 'patterns',\n\t\t'destination' => 'destination'\n);\n$config ['invoices_path'] = FCPATH . \"invoices/\";\n$config ['invoice_template'] = APPPATH . \"views/\";\n$config ['invoice_screen'] = APPPATH . \"controllers/\";\n$config ['gzip-path'] = \"/bin/gzip\";\n$config ['gunzip-path'] = \"/bin/gunzip\";\n$config['allow_menu_url'] = array('invoice_conf_list','resellersrates_list');\n$config['allow_module'] = array('tariff','configuration');\n\n/*Access Number*/\n$config ['Accessnumber-rates-field'] = array (\n\t\t'Access number' => 'access_number',\n\t\t'Country' => 'country_id'\n);\n/*Access Number*/\n\n\n/*local number */\n$config ['local_number-rates-field'] = array (\n\t\t'Number' => 'number',\n\t\t'Country' => 'country_id',\n\t\t'Province/State' => 'province',\n\t\t'City' => 'city',\n\t\t\"Status\" => 'status'\n);\n\n\n$config['recordings_path'] = FCPATH.\"playlist/example/media/recordings/\";\n\n"], "filenames": ["config/astpp-config.conf", "install.sh", "web_interface/astpp/application/config/config.php"], "buggy_code_start_loc": [6, 72, 231], "buggy_code_end_loc": [7, 334, 243], "fixing_code_start_loc": [6, 73, 231], "fixing_code_end_loc": [8, 339, 242], "type": "CWE-327", "message": "An issue was discovered in iNextrix ASTPP before 4.0.1. web_interface/astpp/application/config/config.php does not have strong random keys, as demonstrated by use of the 8YSDaBtDHAB3EQkxPAyTz2I5DttzA9uR private key and the r)fddEw232f encryption key.", "other": {"cve": {"id": "CVE-2019-15075", "sourceIdentifier": "cve@mitre.org", "published": "2020-03-20T18:15:13.293", "lastModified": "2021-07-21T11:39:23.747", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in iNextrix ASTPP before 4.0.1. web_interface/astpp/application/config/config.php does not have strong random keys, as demonstrated by use of the 8YSDaBtDHAB3EQkxPAyTz2I5DttzA9uR private key and the r)fddEw232f encryption key."}, {"lang": "es", "value": "Se detect\u00f3 un problema en iNextrix ASTPP versiones anteriores a  4.0.1. En el archivo web_interface/astpp/application/config/config.php no presenta claves aleatorias fuertes, como es demostrado mediante el uso de la clave privada 8YSDaBtDHAB3EQkxPAyTz2I5DttzA9uR y la clave de cifrado r)fddEw232f."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-327"}, {"lang": "en", "value": "CWE-798"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:inextrix:astpp:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.0.1", "matchCriteriaId": "2DAFCEB4-F875-4A5C-81B6-5509459365E9"}]}]}], "references": [{"url": "https://github.com/iNextrix/ASTPP/commit/9877ec62556f0470030acd306b24bc94fdcbe2ae", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/iNextrix/ASTPP/commit/9877ec62556f0470030acd306b24bc94fdcbe2ae"}}