{"buggy_code": ["# WP-UserOnline\nContributors: GamerZ  \nDonate link: https://lesterchan.net/site/donation/  \nTags: useronline, usersonline, wp-useronline, online, users, user, ajax, widget  \nRequires at least: 4.0  \nTested up to: 6.0  \nStable tag: 2.88.0  \nLicense: GPLv2 or later  \nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html  \n\nEnable you to display how many users are online on your Wordpress blog with detailed statistics.\n\n## Description\nThis plugin enables you to display how many users are online on your Wordpress site, with detailed statistics of where they are and who they are (Members/Guests/Search Bots).\n\n### Usage (With Widget)\n1. Go to `WP-Admin -> Appearance -> Widgets`\n1. The widget name is <strong>UserOnline</strong>.\n1. Scroll down for instructions on how to create a *UserOnline Page*.\n\n### Usage (Without Widget)\n* Open `wp-content/themes/<YOUR THEME NAME>/sidebar.php` and add Anywhere:\n\n```php\n<?php if (function_exists('users_online')): ?>\n\t<p>Users online: <div id=\"useronline-count\"><?php users_online(); ?></div></p>\n<?php endif; ?>\n```\n\n### Build Status\n[![Build Status](https://travis-ci.org/lesterchan/wp-useronline.svg?branch=master)](https://travis-ci.org/lesterchan/wp-useronline)\n\n### Development\n[https://github.com/lesterchan/wp-useronline](https://github.com/lesterchan/wp-useronline \"https://github.com/lesterchan/wp-useronline\")\n\n### Credits\n* Plugin icon by [Freepik](http://www.freepik.com) from [Flaticon](http://www.flaticon.com)\n\n### Donations\nI spent most of my free time creating, updating, maintaining and supporting these plugins, if you really love my plugins and could spare me a couple of bucks, I will really appreciate it. If not feel free to use it without any obligations.\n\n## Screenshots\n\n1. Admin - Dashboard's Right Now\n2. UserOnline Page\n3. Admin - Settings Page\n\n## Frequently Asked Questions\n\n### Creating A UserOnline Page\n1. Go to `WP-Admin -> Pages -> Add New`\n1. Type any title you like in the post's title area\n1. If you ARE using nice permalinks, after typing the title, WordPress will generate the permalink to the page. You will see an 'Edit' link just beside the permalink.\n1. Click 'Edit' and type in `useronline` in the text field and click 'Save'.\n1. Type `[page_useronline]` in the post's content area\n1. Click 'Publish'\n\nIf you ARE NOT using nice permalinks, you need to go to `WP-Admin -> Settings -> UserOnline` and under 'UserOnline URL', you need to fill in the URL to the UserOnline Page you created above.\n\n### To Display Most Number Of Users Online\n* Use:\n```php\n<?php if (function_exists('get_most_users_online')): ?>\n   <p>Most Users Ever Online Is <?php echo get_most_users_online(); ?> On <?php echo get_most_users_online_date(); ?></p>\n<?php endif; ?>\n```\n\n### To Display Users Browsing Site\n* Use:\n```php\n<?php if (function_exists('get_users_browsing_site')): ?>\n   <div id=\"useronline-browsing-site\"><?php echo get_users_browsing_site(); ?></div>\n<?php endif; ?>\n```\n\n### To Display Users Browsing A Page\n* Use:\n```php\n<?php if (function_exists('get_users_browsing_page')): ?>\n   <div id=\"useronline-browsing-page\"><?php echo get_users_browsing_page(); ?></div>\n<?php endif; ?>\n```\n\n### Error on activation: \"Parse error: syntax error, unexpected...\"\n\nMake sure your host is running PHP 5. The only foolproof way to do this is to add this line to wp-config.php (after the opening `<?php` tag):\n\n`var_dump(PHP_VERSION);`\n\n## Changelog\n### 2.88.0\n* NEW: Bump to WordPress 6.0.\n* FIXED: Fixed XSS. Props @steffinstanly.\n\n### 2.85.6\n* NEW: Bump to WordPress 5.6\n* NEW: Added more bots\n* NEW: Remove hardcoded Archive text in page title\n* FIXED: Update SCB Framework to support PHP 8\n\n### 2.85.5\n* NEW: Bump to WordPress 5.4\n* NEW: Added more bots\n\n### 2.87.4\n* NEW: Bump to WordPress 5.3\n* NEW: Added more bots\n* FIXED: Update SCB Framework To Remove contextual_help\n\n### 2.87.3\n* FIXED: Duplicated Settings Saved admin_notices\n* FIXED: Missing arrow\n* FIXED: Updated bots list\n\n### 2.87.2\n* NEW: Bump to 4.9\n* FIXED: Notices in SCB Framework\n\n### 2.87.1\n* NEW: Bump to 4.7\n* NEW: New useronline_custom_template filter\n\n### 2.87\n* NEW: Remove po/mo files from the plugin\n* NEW: Use translate.wordpress.org to translate the plugin\n* FIXED: Update SCB Framework\n* FIXED: Incompatible scbAdminPage::validate()\n\n### 2.86\n* FIXED: Notices in Widget Constructor for WordPress 4.3\n\n### 2.85\n* NEW: Uses WordPress native uninstall.php\n\n### 2.84\n* NEW: Bump to 4.0\n\n### 2.83\n* Show user agent when hovering over IP, instead of address lookup\n* Use local time for UserOnline Page\n* Fixed 'Strict Standards: Non-static method' warnings\n* Update scb Framework\n\n### 2.82\n* show most recent visitors first\n* fix duplicate entry errors\n* fix ajax requests for SSL\n\n### 2.81\n* fixed settings page\n* fixed \"Return to default\" buttons\n* show user list in admin only to users with 'manage_options' capability\n* added 'useronline_bots' filter\n\n### 2.80\n* don't show url and referral links for users in the admin area\n* smarter detection via ajax requests\n* fix SQL errors\n\n### 2.72\n* fix fatal error on upgrade\n\n### 2.71\n* fix %USERONLINE_COUNT% problem\n\n### 2.70\n* added option to link user names to their author page\n* allow displaying online users from a different page than the current page\n* bundle language files\n* [more info](http://scribu.net/wordpress/wp-useronline/wu-2-70.html)\n\n### 2.62 (2010-03-07)\n* fix integration with WP-Stats\n* fix error with get_admin_page_title()\n", "<?php\n\nclass UserOnline_Admin_Integration extends scbAdminPage {\n\n\tfunction setup() {\n\t\t$this->textdomain = 'wp-useronline';\n\n\t\t$this->args = array(\n\t\t\t'page_title' => __( 'Users Online Now', $this->textdomain ),\n\t\t\t'menu_title' => __( 'WP-UserOnline', $this->textdomain ),\n\t\t\t'page_slug' => 'useronline',\n\t\t\t'parent' => 'index.php',\n\t\t\t'action_link' => false,\n\t\t\t'capability' => 'list_users',\n\t\t);\n\n\t\tadd_action( 'rightnow_end', array( $this, 'rightnow' ) );\n\t}\n\n\tfunction rightnow() {\n\t\tif ( !current_user_can( 'manage_options' ) )\n\t\t\treturn;\n\n\t\t$total_users = get_users_online_count();\n\n\t\t$str = _n(\n\t\t\t\"There is <strong><a href='%s'>%s user</a></strong> online now.\",\n\t\t\t\"There are a total of <strong><a href='%s'>%s users</a></strong> online now.\",\n\t\t\t$total_users, 'wp-useronline'\n\t\t);\n\n\t\t$out = sprintf( $str, add_query_arg( 'page', $this->args['page_slug'], admin_url( 'index.php' ) ), number_format_i18n( $total_users ) );\n\t\t$out .= '<br>';\n\n\t\tif ( $tmp = get_users_browsing_site() )\n\t\t\t$out .= $tmp . '<br>';\n\n\t\t$out .= UserOnline_Template::format_most_users();\n\n\t\techo html( 'p', $out );\n\t}\n\n\tfunction page_content() {\n\t\techo users_online_page();\n\t}\n}\n\n\nclass UserOnline_Options extends scbAdminPage {\n\n\tpublic function setup() {\n\t\t$this->textdomain = 'wp-useronline';\n\n\t\t$this->args = array(\n\t\t\t'page_title' => __( 'UserOnline Options', $this->textdomain ),\n\t\t\t'menu_title' => __( 'UserOnline', $this->textdomain ),\n\t\t\t'page_slug' => 'useronline-settings',\n\t\t);\n\n\t\t$this->option_name = 'useronline';\n\t}\n\n\tpublic function validate( $options, $old_data = array() ) {\n\t\t$options['timeout'] = isset( $options['timeout'] ) ? absint( $options['timeout'] ) : 0;\n\t\t$options['url'] = ! empty( $options['url'] ) ? esc_url_raw( trim( $options['url'] ) ) : '';\n\t\t$options['names'] = ! empty( $options['names'] ) ? (int) $options['names'] : 0;\n\n\t\tforeach ( $options['templates'] as $key => $template )\n\t\t\tif ( is_array( $template ) )\n\t\t\t\t$options['templates'][$key]['text'] = wp_kses_post( trim( $template['text'] ) );\n\t\t\telse\n\t\t\t\t$options['templates'][$key] = wp_kses_post( trim( $template ) );\n\n\t\treturn $options;\n\t}\n\n\tpublic function page_head() {\n?>\n<style type=\"text/css\">\n.form-table td {vertical-align: top}\n.form-table .form-table {margin-top: 0}\n.form-table .form-table th, .form-table .form-table td {padding: 0}\n.form-table textarea {width: 100%; height: 150px}\n</style>\n\n<script type=\"text/javascript\">\n\tfunction useronline_default_naming() {\n\t\tjQuery( \"#current_naming\" ).html( jQuery( \"#default_naming\" ).html() );\n\n\t\treturn false;\n\t}\n\n\tfunction useronline_default_template( template ) {\n\t\tjQuery( '#current_template_' + template ).html( jQuery( '#default_template_' + template ).html() );\n\n\t\treturn false;\n\t}\n</script>\n<?php\n\t}\n\n\tpublic function page_content() {\n\t\t$options = $this->options->get();\n\t\t$defaults = $this->options->get_defaults();\n\n?>\n\t<form method=\"post\" action=\"\">\n\t\t<?php wp_nonce_field( $this->nonce ); ?>\n\t\t<table class=\"form-table\">\n<?php\n\t\t$rows = array(\n\t\t\tarray(\n\t\t\t\t'title' => __( 'Time Out', 'wp-useronline' ),\n\t\t\t\t'type' => 'text',\n\t\t\t\t'name' => 'timeout',\n\t\t\t\t'desc' => '<br />' . __( 'How long until it will remove the user from the database (in seconds).', 'wp-useronline' ),\n\t\t\t\t'extra' => 'size=\"4\"'\n\t\t\t),\n\n\t\t\tarray(\n\t\t\t\t'title' => __( 'UserOnline URL', 'wp-useronline' ),\n\t\t\t\t'type' => 'text',\n\t\t\t\t'name' => 'url',\n\t\t\t\t'desc' => '<br />' . __( 'URL To UserOnline Page<br />Example: http://www.yoursite.com/useronline/<br />Example: http://www.yoursite.com/?page_id=2', 'wp-useronline' ),\n\t\t\t),\n\n\t\t\tarray(\n\t\t\t\t'title' => __( 'Link user names?', 'wp-useronline' ),\n\t\t\t\t'type' => 'radio',\n\t\t\t\t'name' => 'names',\n\t\t\t\t'choices' => array( 1 => __( 'Yes', 'wp-useronline' ), 0 => __( 'No', 'wp-useronline' ) ),\n\t\t\t\t'desc' => '<br />' . __( 'Link user names to their author page', 'wp-useronline' )\n\t\t\t),\n\t\t);\n\n\t\tforeach ( $rows as $row ) {\n\t\t\techo $this->table_row( $row );\n\t\t}\n\n?>\n\t\t<tbody id=\"default_naming\" style=\"display:none\">\n\t\t\t<?php $this->naming_table( $defaults ); ?>\n\t\t</tbody>\n\n\t\t<tbody id=\"current_naming\">\n\t\t\t<?php $this->naming_table( $options ); ?>\n\t\t</tbody>\n\n\t\t</table>\n\n\t\t<h3><?php _e( 'Useronline Templates', 'wp-useronline' ); ?></h3>\n\t\t<table class=\"form-table\">\n\t\t\t<tbody id=\"default_template_useronline\" style=\"display:none\">\n\t\t\t\t<?php $this->useronline_template_table( $defaults ); ?>\n\t\t\t</tbody>\n\n\t\t\t<tbody id=\"current_template_useronline\">\n\t\t\t\t<?php $this->useronline_template_table( $options ); ?>\n\t\t\t</tbody>\n\n\t\t\t<?php\n\t\t\t$templates = array(\n\t\t\t\t'browsingsite' => __( 'User(s) Browsing Site:', 'wp-useronline' ),\n\t\t\t\t'browsingpage' => __( 'User(s) Browsing Page:', 'wp-useronline' ),\n\t\t\t);\n\t\t\tforeach ( $templates as $name => $title ) { ?>\n\t\t\t\t<tbody id=\"default_template_<?php echo $name; ?>\" style=\"display:none\">\n\t\t\t\t\t<?php $this->template_table( $title, $name, $defaults ); ?>\n\t\t\t\t</tbody>\n\n\t\t\t\t<tbody id=\"current_template_<?php echo $name; ?>\">\n\t\t\t\t\t<?php $this->template_table( $title, $name, $options ); ?>\n\t\t\t\t</tbody>\n\t\t\t<?php } ?>\n\t\t</table>\n\t\t<p class=\"submit\">\n\t\t\t<input type=\"submit\" name=\"action\" class=\"button\" value=\"<?php _e( 'Save Changes', 'wp-useronline' ); ?>\" />\n\t\t</p>\n\t</form>\n<?php\n\t}\n\n\tprivate function naming_table( $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php _e( 'Naming Conventions:', 'wp-useronline' ); ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %COUNT%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Defaults', 'wp-useronline' ); ?>\" onclick=\"useronline_default_naming();\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<table class=\"form-table\">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Singular Form', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Plural Form', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tforeach ( array( 'user', 'member', 'guest', 'bot' ) as $tmp ) {\n\t\t\t\t\t\t\t\techo \"\\n<tr>\\n\";\n\t\t\t\t\t\t\t\tforeach ( array( $tmp, $tmp . 's' ) as $type ) {\n\t\t\t\t\t\t\t\t\techo $this->input( array(\n\t\t\t\t\t\t\t\t\t\t'type' => 'text',\n\t\t\t\t\t\t\t\t\t\t'name' => array( 'naming', $type ),\n\t\t\t\t\t\t\t\t\t\t'extra' => 'size=\"30\"',\n\t\t\t\t\t\t\t\t\t\t'desc' => html( 'td', '%input%' )\n\t\t\t\t\t\t\t\t\t), $data );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\techo \"\\n</tr>\\n\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t\t<br />\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n\n\tprivate function useronline_template_table( $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php _e( 'User(s) Online:', 'wp-useronline' ); ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %USERS%<br />\n\t\t\t\t\t- %PAGE_URL%<br />\n\t\t\t\t\t- %MOSTONLINE_COUNT%<br />\n\t\t\t\t\t- %MOSTONLINE_DATE%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Default Template', 'wp-useronline' ); ?>\" onclick=\"useronline_default_template( 'useronline' );\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<?php echo $this->input( array(\n\t\t\t\t\t\t'type' => 'textarea',\n\t\t\t\t\t\t'name' => array( 'templates', 'useronline' ),\n\t\t\t\t\t), $data ); ?>\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n\n\tprivate function template_table( $title, $option, $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php echo $title; ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %USERS%<br />\n\t\t\t\t\t- %MEMBERS%<br />\n\t\t\t\t\t- %MEMBER_NAMES%<br />\n\t\t\t\t\t- %GUESTS_SEPARATOR%<br />\n\t\t\t\t\t- %GUESTS%<br />\n\t\t\t\t\t- %BOTS_SEPARATOR%<br />\n\t\t\t\t\t- %BOTS%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Default Template', 'wp-useronline' ); ?>\" onclick=\"useronline_default_template( '<?php echo $option; ?>' );\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<table class=\"form-table\">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Member Names Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Guests Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Bots Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<?php foreach ( array_keys( $this->options->templates[$option]['separators'] ) as $type ) {\n\t\t\t\t\t\t\t\techo html( 'td', $this->input( array(\n\t\t\t\t\t\t\t\t\t'type' => 'text',\n\t\t\t\t\t\t\t\t\t'name' => array( 'templates', $option, 'separators', $type ),\n\t\t\t\t\t\t\t\t\t'extra' => \"size='15'\",\n\t\t\t\t\t\t\t\t), $data ) );\n\t\t\t\t\t\t\t} ?>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<br />\n\t\t\t\t\t<?php echo $this->input( array(\n\t\t\t\t\t\t'type' => 'textarea',\n\t\t\t\t\t\t'name' => array( 'templates', $option, 'text' )\n\t\t\t\t\t), $data ); ?>\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n}\n\n", "<?php\n/*\nPlugin Name: WP-UserOnline\nPlugin URI: https://lesterchan.net/portfolio/programming/php/\nDescription: Enable you to display how many users are online on your Wordpress site\nVersion: 2.88.0\nAuthor: Lester 'GaMerZ' Chan\nAuthor URI: https://lesterchan.net\nText Domain: wp-useronline\n*/\n\nif ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly\n\ninclude __DIR__ . '/scb/load.php';\n\nfunction _useronline_init() {\n\tload_plugin_textdomain( 'wp-useronline', false, dirname( plugin_basename( __FILE__ ) ) );\n\n\trequire_once __DIR__ . '/core.php';\n\trequire_once __DIR__ . '/template-tags.php';\n\trequire_once __DIR__ . '/deprecated.php';\n\trequire_once __DIR__ . '/widget.php';\n\n\tnew scbTable( 'useronline', __FILE__, \"\n\t\ttimestamp timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\t\tuser_type varchar( 20 ) NOT NULL default 'guest',\n\t\tuser_id bigint( 20 ) NOT NULL default 0,\n\t\tuser_name varchar( 250 ) NOT NULL default '',\n\t\tuser_ip varchar( 39 ) NOT NULL default '',\n\t\tuser_agent text NOT NULL,\n\t\tpage_title text NOT NULL,\n\t\tpage_url varchar( 255 ) NOT NULL default '',\n\t\treferral varchar( 255 ) NOT NULL default '',\n\t\tUNIQUE KEY useronline_id ( timestamp, user_type, user_ip )\n\t\", 'delete_first' );\n\n\t$most = new scbOptions( 'useronline_most', __FILE__, array(\n\t\t'count' => 1,\n\t\t'date' => current_time( 'timestamp' )\n\t) );\n\n\t$options = new scbOptions( 'useronline', __FILE__, array(\n\t\t'timeout' => 300,\n\t\t'url' => trailingslashit( get_bloginfo( 'url' ) ) . 'useronline',\n\t\t'names' => false,\n\n\t\t'naming' => array(\n\t\t\t'user'\t\t=> __( '1 User', 'wp-useronline' ),\n\t\t\t'users'\t\t=> __( '%COUNT% Users', 'wp-useronline' ),\n\t\t\t'member'\t=> __( '1 Member', 'wp-useronline' ),\n\t\t\t'members'\t=> __( '%COUNT% Members', 'wp-useronline' ),\n\t\t\t'guest' \t=> __( '1 Guest', 'wp-useronline' ),\n\t\t\t'guests'\t=> __( '%COUNT% Guests', 'wp-useronline' ),\n\t\t\t'bot'\t\t=> __( '1 Bot', 'wp-useronline' ),\n\t\t\t'bots'\t\t=> __( '%COUNT% Bots', 'wp-useronline' )\n\t\t),\n\n\t\t'templates' => array(\n\t\t\t'useronline' => '<a href=\"%PAGE_URL%\"><strong>%USERS%</strong> '.__( 'Online', 'wp-useronline' ).'</a>',\n\n\t\t\t'browsingsite' => array(\n\t\t\t\t'separators' => array(\n\t\t\t\t\t'members' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'guests' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'bots' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t),\n\t\t\t\t'text' => _x( 'Users', 'Template Element', 'wp-useronline' ).': <strong>%MEMBER_NAMES%%GUESTS_SEPARATOR%%GUESTS%%BOTS_SEPARATOR%%BOTS%</strong>'\n\t\t\t),\n\n\t\t\t'browsingpage' => array(\n\t\t\t\t'separators' => array(\n\t\t\t\t\t'members' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'guests' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'bots' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t),\n\t\t\t\t'text' => '<strong>%USERS%</strong> '.__( 'Browsing This Page.', 'wp-useronline' ).'<br />'._x( 'Users', 'Template Element', 'wp-useronline' ).': <strong>%MEMBER_NAMES%%GUESTS_SEPARATOR%%GUESTS%%BOTS_SEPARATOR%%BOTS%</strong>'\n\t\t\t)\n\t\t)\n\t) );\n\n\tUserOnline_Core::init( $options, $most );\n\n\tscbWidget::init( 'UserOnline_Widget', __FILE__, 'useronline' );\n\n\tif ( is_admin() ) {\n\t\trequire_once __DIR__ . '/admin.php';\n\t\tscbAdminPage::register( 'UserOnline_Admin_Integration', __FILE__ );\n\t\tscbAdminPage::register( 'UserOnline_Options', __FILE__, UserOnline_Core::$options );\n\t}\n\n\tif ( function_exists( 'stats_page' ) )\n\t\trequire_once __DIR__ . '/wp-stats.php';\n\n#\tscbUtil::do_uninstall( __FILE__ );\n#\tscbUtil::do_activation( __FILE__ );\n}\nscb_init( '_useronline_init' );\n\n"], "fixing_code": ["# WP-UserOnline\nContributors: GamerZ  \nDonate link: https://lesterchan.net/site/donation/  \nTags: useronline, usersonline, wp-useronline, online, users, user, ajax, widget  \nRequires at least: 4.0  \nTested up to: 6.0  \nStable tag: 2.88.1  \nLicense: GPLv2 or later  \nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html  \n\nEnable you to display how many users are online on your Wordpress blog with detailed statistics.\n\n## Description\nThis plugin enables you to display how many users are online on your Wordpress site, with detailed statistics of where they are and who they are (Members/Guests/Search Bots).\n\n### Usage (With Widget)\n1. Go to `WP-Admin -> Appearance -> Widgets`\n1. The widget name is <strong>UserOnline</strong>.\n1. Scroll down for instructions on how to create a *UserOnline Page*.\n\n### Usage (Without Widget)\n* Open `wp-content/themes/<YOUR THEME NAME>/sidebar.php` and add Anywhere:\n\n```php\n<?php if (function_exists('users_online')): ?>\n\t<p>Users online: <div id=\"useronline-count\"><?php users_online(); ?></div></p>\n<?php endif; ?>\n```\n\n### Build Status\n[![Build Status](https://travis-ci.org/lesterchan/wp-useronline.svg?branch=master)](https://travis-ci.org/lesterchan/wp-useronline)\n\n### Development\n[https://github.com/lesterchan/wp-useronline](https://github.com/lesterchan/wp-useronline \"https://github.com/lesterchan/wp-useronline\")\n\n### Credits\n* Plugin icon by [Freepik](http://www.freepik.com) from [Flaticon](http://www.flaticon.com)\n\n### Donations\nI spent most of my free time creating, updating, maintaining and supporting these plugins, if you really love my plugins and could spare me a couple of bucks, I will really appreciate it. If not feel free to use it without any obligations.\n\n## Screenshots\n\n1. Admin - Dashboard's Right Now\n2. UserOnline Page\n3. Admin - Settings Page\n\n## Frequently Asked Questions\n\n### Creating A UserOnline Page\n1. Go to `WP-Admin -> Pages -> Add New`\n1. Type any title you like in the post's title area\n1. If you ARE using nice permalinks, after typing the title, WordPress will generate the permalink to the page. You will see an 'Edit' link just beside the permalink.\n1. Click 'Edit' and type in `useronline` in the text field and click 'Save'.\n1. Type `[page_useronline]` in the post's content area\n1. Click 'Publish'\n\nIf you ARE NOT using nice permalinks, you need to go to `WP-Admin -> Settings -> UserOnline` and under 'UserOnline URL', you need to fill in the URL to the UserOnline Page you created above.\n\n### To Display Most Number Of Users Online\n* Use:\n```php\n<?php if (function_exists('get_most_users_online')): ?>\n   <p>Most Users Ever Online Is <?php echo get_most_users_online(); ?> On <?php echo get_most_users_online_date(); ?></p>\n<?php endif; ?>\n```\n\n### To Display Users Browsing Site\n* Use:\n```php\n<?php if (function_exists('get_users_browsing_site')): ?>\n   <div id=\"useronline-browsing-site\"><?php echo get_users_browsing_site(); ?></div>\n<?php endif; ?>\n```\n\n### To Display Users Browsing A Page\n* Use:\n```php\n<?php if (function_exists('get_users_browsing_page')): ?>\n   <div id=\"useronline-browsing-page\"><?php echo get_users_browsing_page(); ?></div>\n<?php endif; ?>\n```\n\n### Error on activation: \"Parse error: syntax error, unexpected...\"\n\nMake sure your host is running PHP 5. The only foolproof way to do this is to add this line to wp-config.php (after the opening `<?php` tag):\n\n`var_dump(PHP_VERSION);`\n\n## Changelog\n### 2.88.1\n* FIXED: Fixed XSS. Props Juampa Rodriguez.\n\n### 2.88.0\n* NEW: Bump to WordPress 6.0.\n* FIXED: Fixed XSS. Props @steffinstanly.\n\n### 2.85.6\n* NEW: Bump to WordPress 5.6\n* NEW: Added more bots\n* NEW: Remove hardcoded Archive text in page title\n* FIXED: Update SCB Framework to support PHP 8\n\n### 2.85.5\n* NEW: Bump to WordPress 5.4\n* NEW: Added more bots\n\n### 2.87.4\n* NEW: Bump to WordPress 5.3\n* NEW: Added more bots\n* FIXED: Update SCB Framework To Remove contextual_help\n\n### 2.87.3\n* FIXED: Duplicated Settings Saved admin_notices\n* FIXED: Missing arrow\n* FIXED: Updated bots list\n\n### 2.87.2\n* NEW: Bump to 4.9\n* FIXED: Notices in SCB Framework\n\n### 2.87.1\n* NEW: Bump to 4.7\n* NEW: New useronline_custom_template filter\n\n### 2.87\n* NEW: Remove po/mo files from the plugin\n* NEW: Use translate.wordpress.org to translate the plugin\n* FIXED: Update SCB Framework\n* FIXED: Incompatible scbAdminPage::validate()\n\n### 2.86\n* FIXED: Notices in Widget Constructor for WordPress 4.3\n\n### 2.85\n* NEW: Uses WordPress native uninstall.php\n\n### 2.84\n* NEW: Bump to 4.0\n\n### 2.83\n* Show user agent when hovering over IP, instead of address lookup\n* Use local time for UserOnline Page\n* Fixed 'Strict Standards: Non-static method' warnings\n* Update scb Framework\n\n### 2.82\n* show most recent visitors first\n* fix duplicate entry errors\n* fix ajax requests for SSL\n\n### 2.81\n* fixed settings page\n* fixed \"Return to default\" buttons\n* show user list in admin only to users with 'manage_options' capability\n* added 'useronline_bots' filter\n\n### 2.80\n* don't show url and referral links for users in the admin area\n* smarter detection via ajax requests\n* fix SQL errors\n\n### 2.72\n* fix fatal error on upgrade\n\n### 2.71\n* fix %USERONLINE_COUNT% problem\n\n### 2.70\n* added option to link user names to their author page\n* allow displaying online users from a different page than the current page\n* bundle language files\n* [more info](http://scribu.net/wordpress/wp-useronline/wu-2-70.html)\n\n### 2.62 (2010-03-07)\n* fix integration with WP-Stats\n* fix error with get_admin_page_title()\n", "<?php\n\nclass UserOnline_Admin_Integration extends scbAdminPage {\n\n\tfunction setup() {\n\t\t$this->textdomain = 'wp-useronline';\n\n\t\t$this->args = array(\n\t\t\t'page_title' => __( 'Users Online Now', $this->textdomain ),\n\t\t\t'menu_title' => __( 'WP-UserOnline', $this->textdomain ),\n\t\t\t'page_slug' => 'useronline',\n\t\t\t'parent' => 'index.php',\n\t\t\t'action_link' => false,\n\t\t\t'capability' => 'list_users',\n\t\t);\n\n\t\tadd_action( 'rightnow_end', array( $this, 'rightnow' ) );\n\t}\n\n\tfunction rightnow() {\n\t\tif ( !current_user_can( 'manage_options' ) )\n\t\t\treturn;\n\n\t\t$total_users = get_users_online_count();\n\n\t\t$str = _n(\n\t\t\t\"There is <strong><a href='%s'>%s user</a></strong> online now.\",\n\t\t\t\"There are a total of <strong><a href='%s'>%s users</a></strong> online now.\",\n\t\t\t$total_users, 'wp-useronline'\n\t\t);\n\n\t\t$out = sprintf( $str, add_query_arg( 'page', $this->args['page_slug'], admin_url( 'index.php' ) ), number_format_i18n( $total_users ) );\n\t\t$out .= '<br>';\n\n\t\tif ( $tmp = get_users_browsing_site() )\n\t\t\t$out .= $tmp . '<br>';\n\n\t\t$out .= UserOnline_Template::format_most_users();\n\n\t\techo html( 'p', $out );\n\t}\n\n\tfunction page_content() {\n\t\techo users_online_page();\n\t}\n}\n\n\nclass UserOnline_Options extends scbAdminPage {\n\n\tpublic function setup() {\n\t\t$this->textdomain = 'wp-useronline';\n\n\t\t$this->args = array(\n\t\t\t'page_title' => __( 'UserOnline Options', $this->textdomain ),\n\t\t\t'menu_title' => __( 'UserOnline', $this->textdomain ),\n\t\t\t'page_slug' => 'useronline-settings',\n\t\t);\n\n\t\t$this->option_name = 'useronline';\n\t}\n\n\tpublic function validate( $options, $old_data = array() ) {\n\t\t$options['timeout'] = isset( $options['timeout'] ) ? absint( $options['timeout'] ) : 0;\n\t\t$options['url'] = ! empty( $options['url'] ) ? esc_url_raw( trim( $options['url'] ) ) : '';\n\t\t$options['names'] = ! empty( $options['names'] ) ? (int) $options['names'] : 0;\n\n\t\tforeach ( $options['naming'] as $key => $template ) {\n\t\t\t$options['naming'][$key] = wp_kses_post( trim( $template ) );\n\t\t}\n\t\tforeach ( $options['templates'] as $key => $template ) {\n\t\t\tif ( is_array( $template ) ) {\n\t\t\t\t$options['templates'][$key]['text'] = wp_kses_post( trim( $template['text'] ) );\n\t\t\t\tif ( ! empty( $template['separators'] ) && is_array( $template['separators'] ) ) {\n\t\t\t\t\t\tforeach( $template['separators'] as $seperator_key => $seperator_value ) {\n\t\t\t\t\t\t\t$options['templates'][$key]['separators'][$seperator_key] = wp_kses_post( trim( $seperator_value ) );\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$options['templates'][$key] = wp_kses_post( trim( $template ) );\n\t\t\t}\n\t\t}\n\n\t\treturn $options;\n\t}\n\n\tpublic function page_head() {\n?>\n<style type=\"text/css\">\n.form-table td {vertical-align: top}\n.form-table .form-table {margin-top: 0}\n.form-table .form-table th, .form-table .form-table td {padding: 0}\n.form-table textarea {width: 100%; height: 150px}\n</style>\n\n<script type=\"text/javascript\">\n\tfunction useronline_default_naming() {\n\t\tjQuery( \"#current_naming\" ).html( jQuery( \"#default_naming\" ).html() );\n\n\t\treturn false;\n\t}\n\n\tfunction useronline_default_template( template ) {\n\t\tjQuery( '#current_template_' + template ).html( jQuery( '#default_template_' + template ).html() );\n\n\t\treturn false;\n\t}\n</script>\n<?php\n\t}\n\n\tpublic function page_content() {\n\t\t$options = $this->options->get();\n\t\t$defaults = $this->options->get_defaults();\n\n?>\n\t<form method=\"post\" action=\"\">\n\t\t<?php wp_nonce_field( $this->nonce ); ?>\n\t\t<table class=\"form-table\">\n<?php\n\t\t$rows = array(\n\t\t\tarray(\n\t\t\t\t'title' => __( 'Time Out', 'wp-useronline' ),\n\t\t\t\t'type' => 'text',\n\t\t\t\t'name' => 'timeout',\n\t\t\t\t'desc' => '<br />' . __( 'How long until it will remove the user from the database (in seconds).', 'wp-useronline' ),\n\t\t\t\t'extra' => 'size=\"4\"'\n\t\t\t),\n\n\t\t\tarray(\n\t\t\t\t'title' => __( 'UserOnline URL', 'wp-useronline' ),\n\t\t\t\t'type' => 'text',\n\t\t\t\t'name' => 'url',\n\t\t\t\t'desc' => '<br />' . __( 'URL To UserOnline Page<br />Example: http://www.yoursite.com/useronline/<br />Example: http://www.yoursite.com/?page_id=2', 'wp-useronline' ),\n\t\t\t),\n\n\t\t\tarray(\n\t\t\t\t'title' => __( 'Link user names?', 'wp-useronline' ),\n\t\t\t\t'type' => 'radio',\n\t\t\t\t'name' => 'names',\n\t\t\t\t'choices' => array( 1 => __( 'Yes', 'wp-useronline' ), 0 => __( 'No', 'wp-useronline' ) ),\n\t\t\t\t'desc' => '<br />' . __( 'Link user names to their author page', 'wp-useronline' )\n\t\t\t),\n\t\t);\n\n\t\tforeach ( $rows as $row ) {\n\t\t\techo $this->table_row( $row );\n\t\t}\n\n?>\n\t\t<tbody id=\"default_naming\" style=\"display:none\">\n\t\t\t<?php $this->naming_table( $defaults ); ?>\n\t\t</tbody>\n\n\t\t<tbody id=\"current_naming\">\n\t\t\t<?php $this->naming_table( $options ); ?>\n\t\t</tbody>\n\n\t\t</table>\n\n\t\t<h3><?php _e( 'Useronline Templates', 'wp-useronline' ); ?></h3>\n\t\t<table class=\"form-table\">\n\t\t\t<tbody id=\"default_template_useronline\" style=\"display:none\">\n\t\t\t\t<?php $this->useronline_template_table( $defaults ); ?>\n\t\t\t</tbody>\n\n\t\t\t<tbody id=\"current_template_useronline\">\n\t\t\t\t<?php $this->useronline_template_table( $options ); ?>\n\t\t\t</tbody>\n\n\t\t\t<?php\n\t\t\t$templates = array(\n\t\t\t\t'browsingsite' => __( 'User(s) Browsing Site:', 'wp-useronline' ),\n\t\t\t\t'browsingpage' => __( 'User(s) Browsing Page:', 'wp-useronline' ),\n\t\t\t);\n\t\t\tforeach ( $templates as $name => $title ) { ?>\n\t\t\t\t<tbody id=\"default_template_<?php echo $name; ?>\" style=\"display:none\">\n\t\t\t\t\t<?php $this->template_table( $title, $name, $defaults ); ?>\n\t\t\t\t</tbody>\n\n\t\t\t\t<tbody id=\"current_template_<?php echo $name; ?>\">\n\t\t\t\t\t<?php $this->template_table( $title, $name, $options ); ?>\n\t\t\t\t</tbody>\n\t\t\t<?php } ?>\n\t\t</table>\n\t\t<p class=\"submit\">\n\t\t\t<input type=\"submit\" name=\"action\" class=\"button\" value=\"<?php _e( 'Save Changes', 'wp-useronline' ); ?>\" />\n\t\t</p>\n\t</form>\n<?php\n\t}\n\n\tprivate function naming_table( $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php _e( 'Naming Conventions:', 'wp-useronline' ); ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %COUNT%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Defaults', 'wp-useronline' ); ?>\" onclick=\"useronline_default_naming();\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<table class=\"form-table\">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Singular Form', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Plural Form', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tforeach ( array( 'user', 'member', 'guest', 'bot' ) as $tmp ) {\n\t\t\t\t\t\t\t\techo \"\\n<tr>\\n\";\n\t\t\t\t\t\t\t\tforeach ( array( $tmp, $tmp . 's' ) as $type ) {\n\t\t\t\t\t\t\t\t\techo $this->input( array(\n\t\t\t\t\t\t\t\t\t\t'type' => 'text',\n\t\t\t\t\t\t\t\t\t\t'name' => array( 'naming', $type ),\n\t\t\t\t\t\t\t\t\t\t'extra' => 'size=\"30\"',\n\t\t\t\t\t\t\t\t\t\t'desc' => html( 'td', $type )\n\t\t\t\t\t\t\t\t\t), $data );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\techo \"\\n</tr>\\n\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t\t<br />\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n\n\tprivate function useronline_template_table( $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php _e( 'User(s) Online:', 'wp-useronline' ); ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %USERS%<br />\n\t\t\t\t\t- %PAGE_URL%<br />\n\t\t\t\t\t- %MOSTONLINE_COUNT%<br />\n\t\t\t\t\t- %MOSTONLINE_DATE%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Default Template', 'wp-useronline' ); ?>\" onclick=\"useronline_default_template( 'useronline' );\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<?php echo $this->input( array(\n\t\t\t\t\t\t'type' => 'textarea',\n\t\t\t\t\t\t'name' => array( 'templates', 'useronline' ),\n\t\t\t\t\t), $data ); ?>\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n\n\tprivate function template_table( $title, $option, $data ) {\n?>\n\t\t\t<tr>\n\t\t\t\t<td width=\"30%\">\n\t\t\t\t\t<strong><?php echo $title; ?></strong><br /><br />\n\t\t\t\t\t<?php _e( 'Allowed Variables:', 'wp-useronline' ); ?><br />\n\t\t\t\t\t- %USERS%<br />\n\t\t\t\t\t- %MEMBERS%<br />\n\t\t\t\t\t- %MEMBER_NAMES%<br />\n\t\t\t\t\t- %GUESTS_SEPARATOR%<br />\n\t\t\t\t\t- %GUESTS%<br />\n\t\t\t\t\t- %BOTS_SEPARATOR%<br />\n\t\t\t\t\t- %BOTS%<br /><br />\n\t\t\t\t\t<input type=\"button\" value=\"<?php _e( 'Restore Default Template', 'wp-useronline' ); ?>\" onclick=\"useronline_default_template( '<?php echo $option; ?>' );\" class=\"button\" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<table class=\"form-table\">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Member Names Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Guests Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t\t<th><?php _e( 'Bots Separator', 'wp-useronline' ); ?></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<?php foreach ( array_keys( $this->options->templates[$option]['separators'] ) as $type ) {\n\t\t\t\t\t\t\t\techo html( 'td', $this->input( array(\n\t\t\t\t\t\t\t\t\t'type' => 'text',\n\t\t\t\t\t\t\t\t\t'name' => array( 'templates', $option, 'separators', $type ),\n\t\t\t\t\t\t\t\t\t'extra' => \"size='15'\",\n\t\t\t\t\t\t\t\t), $data ) );\n\t\t\t\t\t\t\t} ?>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<br />\n\t\t\t\t\t<?php echo $this->input( array(\n\t\t\t\t\t\t'type' => 'textarea',\n\t\t\t\t\t\t'name' => array( 'templates', $option, 'text' )\n\t\t\t\t\t), $data ); ?>\n\t\t\t\t</td>\n\t\t\t</tr>\n<?php\n\t}\n}\n\n", "<?php\n/*\nPlugin Name: WP-UserOnline\nPlugin URI: https://lesterchan.net/portfolio/programming/php/\nDescription: Enable you to display how many users are online on your Wordpress site\nVersion: 2.88.1\nAuthor: Lester 'GaMerZ' Chan\nAuthor URI: https://lesterchan.net\nText Domain: wp-useronline\n*/\n\nif ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly\n\ninclude __DIR__ . '/scb/load.php';\n\nfunction _useronline_init() {\n\tload_plugin_textdomain( 'wp-useronline', false, dirname( plugin_basename( __FILE__ ) ) );\n\n\trequire_once __DIR__ . '/core.php';\n\trequire_once __DIR__ . '/template-tags.php';\n\trequire_once __DIR__ . '/deprecated.php';\n\trequire_once __DIR__ . '/widget.php';\n\n\tnew scbTable( 'useronline', __FILE__, \"\n\t\ttimestamp timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\t\tuser_type varchar( 20 ) NOT NULL default 'guest',\n\t\tuser_id bigint( 20 ) NOT NULL default 0,\n\t\tuser_name varchar( 250 ) NOT NULL default '',\n\t\tuser_ip varchar( 39 ) NOT NULL default '',\n\t\tuser_agent text NOT NULL,\n\t\tpage_title text NOT NULL,\n\t\tpage_url varchar( 255 ) NOT NULL default '',\n\t\treferral varchar( 255 ) NOT NULL default '',\n\t\tUNIQUE KEY useronline_id ( timestamp, user_type, user_ip )\n\t\", 'delete_first' );\n\n\t$most = new scbOptions( 'useronline_most', __FILE__, array(\n\t\t'count' => 1,\n\t\t'date' => current_time( 'timestamp' )\n\t) );\n\n\t$options = new scbOptions( 'useronline', __FILE__, array(\n\t\t'timeout' => 300,\n\t\t'url' => trailingslashit( get_bloginfo( 'url' ) ) . 'useronline',\n\t\t'names' => false,\n\n\t\t'naming' => array(\n\t\t\t'user'\t\t=> __( '1 User', 'wp-useronline' ),\n\t\t\t'users'\t\t=> __( '%COUNT% Users', 'wp-useronline' ),\n\t\t\t'member'\t=> __( '1 Member', 'wp-useronline' ),\n\t\t\t'members'\t=> __( '%COUNT% Members', 'wp-useronline' ),\n\t\t\t'guest' \t=> __( '1 Guest', 'wp-useronline' ),\n\t\t\t'guests'\t=> __( '%COUNT% Guests', 'wp-useronline' ),\n\t\t\t'bot'\t\t=> __( '1 Bot', 'wp-useronline' ),\n\t\t\t'bots'\t\t=> __( '%COUNT% Bots', 'wp-useronline' )\n\t\t),\n\n\t\t'templates' => array(\n\t\t\t'useronline' => '<a href=\"%PAGE_URL%\"><strong>%USERS%</strong> '.__( 'Online', 'wp-useronline' ).'</a>',\n\n\t\t\t'browsingsite' => array(\n\t\t\t\t'separators' => array(\n\t\t\t\t\t'members' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'guests' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'bots' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t),\n\t\t\t\t'text' => _x( 'Users', 'Template Element', 'wp-useronline' ).': <strong>%MEMBER_NAMES%%GUESTS_SEPARATOR%%GUESTS%%BOTS_SEPARATOR%%BOTS%</strong>'\n\t\t\t),\n\n\t\t\t'browsingpage' => array(\n\t\t\t\t'separators' => array(\n\t\t\t\t\t'members' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'guests' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t\t'bots' => __( ',', 'wp-useronline' ).' ',\n\t\t\t\t),\n\t\t\t\t'text' => '<strong>%USERS%</strong> '.__( 'Browsing This Page.', 'wp-useronline' ).'<br />'._x( 'Users', 'Template Element', 'wp-useronline' ).': <strong>%MEMBER_NAMES%%GUESTS_SEPARATOR%%GUESTS%%BOTS_SEPARATOR%%BOTS%</strong>'\n\t\t\t)\n\t\t)\n\t) );\n\n\tUserOnline_Core::init( $options, $most );\n\n\tscbWidget::init( 'UserOnline_Widget', __FILE__, 'useronline' );\n\n\tif ( is_admin() ) {\n\t\trequire_once __DIR__ . '/admin.php';\n\t\tscbAdminPage::register( 'UserOnline_Admin_Integration', __FILE__ );\n\t\tscbAdminPage::register( 'UserOnline_Options', __FILE__, UserOnline_Core::$options );\n\t}\n\n\tif ( function_exists( 'stats_page' ) )\n\t\trequire_once __DIR__ . '/wp-stats.php';\n\n#\tscbUtil::do_uninstall( __FILE__ );\n#\tscbUtil::do_activation( __FILE__ );\n}\nscb_init( '_useronline_init' );\n\n"], "filenames": ["README.md", "admin.php", "wp-useronline.php"], "buggy_code_start_loc": [7, 68, 6], "buggy_code_end_loc": [90, 210, 7], "fixing_code_start_loc": [7, 68, 6], "fixing_code_end_loc": [94, 220, 7], "type": "CWE-79", "message": "The WP-UserOnline plugin for WordPress has multiple Stored Cross-Site Scripting vulnerabilities in versions up to, and including 2.88.0. This is due to the fact that all fields in the \"Naming Conventions\" section do not properly sanitize user input, nor escape it on output. This makes it possible for authenticated attackers, with administrative privileges, to inject JavaScript code into the setting that will execute whenever a user accesses the injected page. This only affects multi-site installations and installations where unfiltered_html has been disabled.", "other": {"cve": {"id": "CVE-2022-2941", "sourceIdentifier": "security@wordfence.com", "published": "2022-09-06T18:15:15.200", "lastModified": "2022-10-01T02:16:20.627", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The WP-UserOnline plugin for WordPress has multiple Stored Cross-Site Scripting vulnerabilities in versions up to, and including 2.88.0. This is due to the fact that all fields in the \"Naming Conventions\" section do not properly sanitize user input, nor escape it on output. This makes it possible for authenticated attackers, with administrative privileges, to inject JavaScript code into the setting that will execute whenever a user accesses the injected page. This only affects multi-site installations and installations where unfiltered_html has been disabled."}, {"lang": "es", "value": "El plugin WP-UserOnline para WordPress presenta m\u00faltiples vulnerabilidades de tipo Cross-Site Scripting Almacenado en versiones hasta 2.88.0 incluy\u00e9ndola. Esto es debido a que todos los campos de la secci\u00f3n \"Naming Conventions\" no sanean apropiadamente la entrada del usuario, ni la escapan en la salida. Esto hace posible a atacantes autenticados, con privilegios administrativos, inyectar c\u00f3digo JavaScript en la configuraci\u00f3n que es ejecutada cada vez que un usuario acceda a la p\u00e1gina inyectada. Esto s\u00f3lo afecta a las instalaciones multisitio y a las instalaciones en las que se ha desactivado unfiltered_html.\n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "security@wordfence.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}]}, "weaknesses": [{"source": "security@wordfence.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wp-useronline_project:wp-useronline:*:*:*:*:*:wordpress:*:*", "versionEndIncluding": "2.88.0", "matchCriteriaId": "18214189-9B13-4D53-ACE3-8213B73CF4F2"}]}]}], "references": [{"url": "http://packetstormsecurity.com/files/168479/WordPress-WP-UserOnline-2.88.0-Cross-Site-Scripting.html", "source": "security@wordfence.com", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/lesterchan/wp-useronline/commit/59c76b20e4e27489f93dee4ef1254d6204e08b3c", "source": "security@wordfence.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2770235%40wp-useronline&new=2770235%40wp-useronline&sfp_email=&sfph_mail=", "source": "security@wordfence.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://www.wordfence.com/vulnerability-advisories/#CVE-2022-2941", "source": "security@wordfence.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/lesterchan/wp-useronline/commit/59c76b20e4e27489f93dee4ef1254d6204e08b3c"}}