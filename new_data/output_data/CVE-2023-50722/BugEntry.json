{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.ConfigurableClass\" locale=\"\">\n  <web>XWiki</web>\n  <name>ConfigurableClass</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('xe.admin.configurable.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{include reference=\"XWiki.ConfigurableClassMacros\" /}}\n\n{{velocity}}\n#*\n * This part takes the configuration from any documents containing XWiki.ConfigurableClass objects and creates a form\n * for each. To includeForm this document, you may specify:\n *\n * $section - String - The section which we are administrating eg: \"Registration\", \"Users\", or \"Import\".\n *                     If none is specified then it checks for a request parameter called \"section\" and uses that,\n *                     if no parameter, then this code assumes that it is part of the admin icons sheet and adds icons\n *                     for any section which is not in $sections, in that event, this code assumes it is being run\n *                     inside of a &lt;ul&gt; block.\n *\n * $sections - List&lt;String&gt; - If section is not specified, any sections on this list will not have icons made for them,\n *                            the assumption being that the icons are already there. If section is specified then this\n *                            is not taken into account and may safely be undefined.\n *\n * $currentDoc - String (document.fullName) - The administration document, users who don't have permission to edit\n *                                            it will not be able to include applications (possibly injecting\n *                                            arbitrary code.) if none specified then $doc.getFullName() is used.\n *\n * $globaladmin - boolean - If set true then we will assume we are administrationg the entire wiki.\n *                          If not set then we look for a request parameter called \"editor\" if that exists and equals\n *                          \"globaladmin\" then $globaladmin is true, if it doesn't exist then we check to see if\n *                          $currentDoc.getFullName() equals \"XWiki.XWikiPreferences\".\n *###\n##\n## Form submission depends on this.\n$xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n## In case of conflict issue we want to display the diff properly\n#set ($discard = $xwiki.ssfx.use('uicomponents/viewers/diff.css', true))\n#set ($discard = $xwiki.jsfx.use('uicomponents/viewers/diff.js'))\n##\n#if(!$section)\n  #set($section = $request.getParameter('section'))\n#end\n#if(!$currentDoc)\n  #set($currentDoc = $doc.getFullName())\n#end\n## Get value of $globaladmin if not specified.\n#if(\"$!globaladmin\" == '')\n  #if($editor != 'globaladmin'\n      &amp;&amp; $request.getParameter('editor') != 'globaladmin'\n      &amp;&amp; $currentDoc != 'XWiki.XWikiPreferences')\n  ##\n    #set($globaladmin = false)\n  #else\n    #set($globaladmin = true)\n  #end\n#end\n#set($currentSpace = $xwiki.getDocument($currentDoc).getSpace())\n##\n##------------------------------------------------------------------------------------------------------------\n## If $section exists then we are viewing the admin page for a particular section.\n## eg: 'Registration', 'Presentation', 'Import' etc.\n##------------------------------------------------------------------------------------------------------------\n##\n#if($section &amp;&amp; $section != '')\n  ##\n  ## This is for keeping track of whether we have shown the heading yet or not.\n  ## If the heading doesn't need to be shown, but an error occurs in processing, then we show the heading\n  ## so that the user knows what the error relates to.\n  #set($headingShowing = false)\n  ##\n  ## Searches the database for names of apps to be configured\n  #set($outputList = [])\n  #findNamesOfAppsToConfigure($section, $globaladmin, $xwiki.getDocument($currentDoc).getSpace(), $outputList)\n  ##\n  #foreach($appName in $outputList)\n    ##\n    ## Make sure the current user has permission to edit the configurable application.\n    #set($userHasAccessToDocument = $xcontext.hasAccessLevel('edit', $appName))\n    ##\n    ## If the document was not last saved by a user with edit privilege on this page\n    ## then we can't safely display the page but we should warn the viewer.\n    #if($userHasAccessToDocument)\n      ## Get the configurable application\n      #set($app = $xwiki.getDocument($appName))\n      ##\n      #set($documentSavedByAuthorizedUser = false)\n      #checkDocumentSavedByAuthorizedUser($app, $currentDoc, $documentSavedByAuthorizedUser)\n    #end\n    ##\n    ## There is no need to display a heading unless:\n    ## 1. There was already a section before this document.\n    ## 2. This is not the first document in this section.\n    ##\n    ## If we are displaying the heading and there is an error to be shown Javascript will not strip the heading.\n    #if(!$appName.equals($outputList.get(0)) || $sections.contains($section))\n      ## Create a document heading.\n      #showHeading($appName, $headingShowing)\n    #end\n    ##\n    #if(!$userHasAccessToDocument)\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"xe.admin.configurable.noPermissionThisApplication\"/}}{{/error}}\n\n    #elseif(!$documentSavedByAuthorizedUser)\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"xe.admin.configurable.applicationAuthorNoAdmin\" parameters=\"$app.Author\"/}}{{/error}}\n\n    ##\n    ##------------------------------------------------------------------------------------------------------------\n    ## If the document is locked and not by the current user and forceEdit is not set true,\n    #elseif($app.getLocked() &amp;&amp; $app.getLockingUser() != $xcontext.getUser() &amp;&amp; !$request.getParameter('forceEdit'))\n      #set($requestURL = \"$request.getRequestURL()\")\n      #if($requestURL.indexOf('?') == -1)\n        #set($requestURL = \"${requestURL}?$request.queryString\")\n      #end\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"doclockedby\"/}} $app.getLockingUser() [[{{translation key=\"forcelock\"/}}&gt;&gt;${requestURL}&amp;forceEdit=1]]{{/error}}\n\n    #else\n      ## If the document is not already locked, attempt to acquire the lock.\n      #if(!$app.getLocked())\n\n        {{html wiki=true}}\n          &lt;noscript&gt;\n\n            {{warning}}{{translation key=\"xe.admin.configurable.cannotLockNoJavascript\"/}}{{/warning}}\n\n          &lt;/noscript&gt;\n        {{/html}}\n\n        {{html clean=false}}\n          &lt;script&gt;\n            document.observe(\"xwiki:dom:loaded\", function() {\n              XWiki.DocumentLock &amp;&amp; new XWiki.DocumentLock('$escapetool.javascript($app.prefixedFullName)').lock();\n            });\n          &lt;/script&gt;\n        {{/html}}\n      #end\n      ##------------------------------------------------------------------------------------------------------------\n      ## Done Locking.\n      ##\n      ## Get all objects of the \"ConfigurableClass\" from this document.\n      #set($allConfigurableObjs = $app.getObjects($nameOfThisDocument))\n      ## Separate out the objects which are for this section.\n      #set($configurableObjs = [])\n      #foreach($configurableObj in $allConfigurableObjs)\n        #if($app.getValue('displayInSection', $configurableObj) == $section)\n          #set($discard = $configurableObjs.add($configurableObj))\n        #end\n      #end\n      #if($configurableObjs.size() == 0)\n        ## Internal error, not translated.\n        #showHeading($appName, $headingShowing)\n\n        {{error}}Internal error: All objects were filtered out for application:\n        $services.rendering.escape($appName, 'xwiki/2.1').{{/error}}\n\n      #else\n        #set($formAction = $xwiki.getURL($app.getFullName(), 'save'))\n        #set($formId = \"${section.toLowerCase()}_${app.getFullName()}\")\n        #set($escapedAppName = $escapetool.xml($app.getFullName()))\n        #foreach($configurableObj in $configurableObjs)\n          ## Execute the content code if any\n          ## FIXME: we have to do that before the title before of the dropPermissions\n          #set($codeToExecute = \"$!app.getValue('codeToExecute', $configurableObj)\")\n          #if($codeToExecute != '')\n            #set($codeToExecuteResult = $configurableObj.display('codeToExecute', 'view', false))\n          #end\n          ## Display the header if one exists.\n          #set($heading = $app.getValue('heading', $configurableObj))\n          #if($heading &amp;&amp; $heading != '')\n            ## This application should not run with programming rights because it evaluates code which may not be trustworthy.\n            ## Removing the next line will open a security hole.\n            ## Can't use $configurableObj.display('heading', 'view', false) to have proper heading id (because of the html macro)\n            ## FIXME: find a cleaner solution\n            #set($void = $doc.dropPermissions())\n            #if ($services.security.authorization.hasAccess(\"script\",\n              $app.authors.effectiveMetadataAuthor, $app.documentReference) &amp;&amp; !$app.restricted)\n              #set($evaluatedHeading = \"#evaluate($heading)\")\n            #else\n              #set($evaluatedHeading = $heading)\n            #end\n            == $services.rendering.escape($evaluatedHeading, 'xwiki/2.1') ==\n          #end\n          ## Display code to execute\n          #if($codeToExecute != '')\n            (%class=\"codeToExecute\"%)(((##\n              $codeToExecuteResult\n            )))\n          #end\n          ##\n          ## If propertiesToShow is set, then we will only show the properties contained therein.\n          #set($propertiesToShow = $app.getValue('propertiesToShow', $configurableObj))\n          #if(!$propertiesToShow || $propertiesToShow.getClass().getName().indexOf('List') == -1)\n            #set($propertiesToShow = [])\n          #end\n          ##\n          ## If linkPrefix is set, then we will make each property label a link which starts with that prefix.\n          #set($linkPrefix = \"$!app.getValue('linkPrefix', $configurableObj)\")\n          ##\n          ## If the Configurable object specifies a configuration class, use it,\n          ## otherwise assume custom forms are used instead.\n          #set($configClassName = \"$!app.getValue('configurationClass', $configurableObj)\")\n          #if($configClassName != '')\n            #set($objClass = $xwiki.getDocument($configClassName).getxWikiClass())\n            #if(!$objClass || $objClass.getClass().getName().indexOf('.Class') == -1)\n              #showHeading($appName, $headingShowing)\n\n              {{error}}{{translation key=\"xe.admin.configurable.configurationClassNonexistant\"/}}{{/error}}\n\n            #else\n              ## Use the first object from the document which is of the configuration class.\n              #set($obj = $app.getObject($objClass.getName()))\n              ##\n              #if(!$obj || $obj.getClass().getName().indexOf('.Object') == -1)\n                #showHeading($appName, $headingShowing)\n\n                {{error}}\n                  #set($escapedObjClassName =\n                    $services.rendering.escape($escapetool.java($objClass.getName()), 'xwiki/2.1'))\n                  #set($translationEscapedAppName =\n                    $services.rendering.escape($escapetool.java($app.getFullName()), 'xwiki/2.1'))\n                  {{translation key=\"xe.admin.configurable.noObjectOfConfigurationClassFound\"\n                    parameters=\"~\"$escapedObjClassName~\", ~\"$translationEscapedAppName~\"\"/}}\n                {{/error}}\n\n              #else\n                ##\n                ## Merge save buttons, remove headings from subsections, and make information links into popups.\n                ## This is not done if there is only a custom defined form.\n                $xwiki.jsx.use($nameOfThisDocument)##\n                ##\n                ## We don't begin the form until we have content for it so that a configurable can specify a\n                ## custom form in codeToExecute and if that configurable object is the first of it's kind in that\n                ## document, the custom form will not be put inside of our form.\n                #if(!$insideForm)\n                  ## We are opening a form and fieldset without closing it, thus we cannot clean this html.\n\n                  {{html clean=false}}\n                    &lt;form id=\"$formId\" method=\"post\" action=\"$formAction\" class=\"xform\"&gt;\n                      &lt;fieldset&gt;\n                  {{/html}}\n                  #set($insideForm = true)\n                #end\n\n                {{html}}\n                  $formHtml.toString()\n                {{/html}}\n              #end## If object exists\n            #end## If class exists\n          #end## If class name is specified.\n        #end## Foreach configurable object found in this document\n        ## If a form was started then we end it.\n        #if($insideForm)\n\n          ## This is closing an open form which was opened above, we cannot clean this html.\n          {{html clean=false}}\n          ## We add in a redirect field to prevent the user from being carried away when they save\n          ## if they don't have javascript.\n          #set($thisURL = $request.getRequestURL())\n          #if($request.getQueryString() &amp;&amp; $request.getQueryString().length() &gt; 0)\n            #set($thisURL = \"${thisURL}?$request.getQueryString()\")\n          #end\n          &lt;input type=\"hidden\" id=\"${escapedAppName}_redirect\" name=\"$redirectParameter\" value=\"$escapetool.xml($thisURL)\" /&gt;\n          &lt;input type=\"hidden\" name=\"form_token\" value=\"$!{services.csrf.getToken()}\" /&gt;\n          &lt;/fieldset&gt;\n          &lt;div class=\"bottombuttons\"&gt;\n            &lt;p class=\"admin-buttons\"&gt;\n              &lt;span class=\"buttonwrapper\"&gt;\n                ## Text to display on the button. If there is a heading then this button should be labeled\n                ## that it is for saving this section. Otherwise it should be a generic \"save\" button.\n                #if($headingShowing)\n                  #set($buttonText = \"$services.localization.render('admin.save') $escapedAppName\")\n                #else\n                  #set($buttonText = \"$services.localization.render('admin.save')\")\n                #end\n                &lt;input class=\"button\" type=\"submit\" name=\"action_saveandcontinue\" value=\"$buttonText\" /&gt;\n              &lt;/span&gt;\n            &lt;/p&gt;\n          &lt;/div&gt; ## bottombuttons\n          &lt;/form&gt;\n          #set($insideForm = false)\n          {{/html}}\n        #end\n      #end## If there are configurable objects\n    #end## If document is not locked or forceEdit is enabled\n  #end## Foreach document name in names to configure\n\n  {{html}}\n  &lt;script&gt;\n  /* &lt;![CDATA[ */\n  ## Alt+Shift+S presses the first saveAndContinue button it finds, not what we want so we will disable edit shortcuts.\n  document.observe('xwiki:dom:loaded', function() {\n    XWiki.actionButtons.EditActions = Object.extend(XWiki.actionButtons.EditActions, {addShortcuts : function() { }});\n  });\n  //]]&gt;\n  &lt;/script&gt;\n  {{/html}}##\n  ##\n#elseif ($currentDoc != 'XWiki.ConfigurableClass')\n  ##\n  ##------------------------------------------------------------------------------------------------------------\n  ## If section is not set then we are viewing the main administration page.\n  ##------------------------------------------------------------------------------------------------------------\n  ##\n  ## If there is no list called sections then we set sections to an empty list.\n  #if(!$sections || $sections.getClass().getName().indexOf('List') == -1)\n    #set($sections = [])\n  #end\n  ##\n  ## We have to create a list of documents which the current user doesn't have permission to view.\n  ## So we can add an error message to the bottom of the page if there are any.\n  #set($appsUserCannotView = [])\n  ##\n  ## A list of sections (to be added) which the user is not allowed to edit, icons will be displayed with a message\n  #set($sectionsUserCannotEdit = [])\n  ## List of sections to be added, in order by creationDate of oldest contained application.\n  #set($sectionsToAdd = [])\n  ## Map of URL of icon to use by the name of the section to use that icon on.\n  #set($iconBySection = {})\n  ##\n  #set($outputList = [])\n  #findNamesOfAppsToConfigure(\"\", $globaladmin, $currentSpace, $outputList)\n  ##\n  #foreach($appName in $outputList)\n    ##\n    ## Get the configurable application\n    #set($app = $xwiki.getDocument($appName))\n    ##\n    ## If getDocument returns null, then warn the user that they don't have view access to that application.\n    #if(!$app)\n      #set($discard = $appsUserCannotView.add($appName))\n    #end\n    ##\n    #set($configurableObjects = $app.getObjects($nameOfThisDocument))\n    #foreach($configurableObject in $configurableObjects)\n      #set($displayInSection = $app.getValue('displayInSection', $configurableObject))\n      ##\n      ## If there is no section for this configurable or if the section cannot be edited, then check if the\n      ## application can be edited by the current user, if so then we display the icon from the current app and\n      ## don't display any message to tell the user they can't edit that section.\n      #if(!$sections.contains($displayInSection) || $sectionsUserCannotEdit.contains($displayInSection))\n        ##\n        ## If there is no section for this configurable, then we will have to add one.\n        #if(!$sections.contains($displayInSection) &amp;&amp; !$sectionsToAdd.contains($displayInSection))\n          #set($discard = $sectionsToAdd.add($displayInSection))\n        #end\n        ##\n        ## If an attachment by the filename iconAttachment exists and is an image\n        #set($attachment = $app.getAttachment(\"$app.getValue('iconAttachment', $configurableObject)\"))\n        #if($attachment &amp;&amp; $attachment.isImage())\n          ## Set the icon for this section as the attachment URL.\n          #set($discard = $iconBySection.put($displayInSection, $app.getAttachmentURL($attachment.getFilename())))\n        #end\n        ##\n        ## If the user doesn't have edit access to the application, we want to show a message on the icon\n        #if(!$xcontext.hasAccessLevel(\"edit\", $app.getFullName()))\n          #if(!$sectionsUserCannotEdit.contains($displayInSection))\n            #set($discard = $sectionsUserCannotEdit.add($displayInSection))\n          #end\n        #elseif($sectionsUserCannotEdit.contains($displayInSection))\n          ## If the user didn't have access to the section before but does have access to _this_ app which is\n          ## configured in the section, then the section becomes accessible.\n          #set($discard = $sectionsUserCannotEdit.remove($displayInSection))\n        #end\n      #end## If section doesn't exist or user doesn't have access.\n    #end## Foreach configurable object in this app.\n  #end## Foreach application which is configurable.\n  ##\n  ## Now we go through sectionsToAdd and generate icons for them\n  #set($defaultIcon = $xwiki.getAttachmentURL($nameOfThisDocument, 'DefaultAdminSectionIcon.png'))\n  #if($globaladmin)\n    #set($queryString = \"editor=globaladmin&amp;amp;section=\")\n  #else\n    #set($queryString = \"space=${currentSpace}&amp;amp;section=\")\n    #if($request.getParameter('editor'))\n      #set($queryString = \"editor=$escapetool.url($request.getParameter('editor'))&amp;amp;$queryString\")\n    #end\n  #end\n\n  ## This is an html fragment and thus cannot be cleaned\n  {{html clean=false}}\n  #foreach($sectionToAdd in $sectionsToAdd)\n    #set($icon = $iconBySection.get($sectionToAdd))\n    #if(!$icon)\n      #set($icon = $defaultIcon)\n    #end\n    &lt;li class=\"$escapetool.xml($sectionToAdd).replaceAll(' ', '_')\"&gt;\n      #set($hasAccess = !$sectionsUserCannotEdit.contains($sectionToAdd))\n      #if($hasAccess)\n        &lt;a href=\"$xwiki.getURL($currentDoc, $xcontext.getAction(), \"$queryString$escapetool.url($sectionToAdd)\")\"&gt;\n      #else\n        &lt;a title=\"$services.localization.render('xe.admin.configurable.sectionIconNoAccessTooltip')\"&gt;\n      #end\n      &lt;span&gt;\n      &lt;img src=\"$icon\" alt=\"$escapetool.xml($sectionToAdd) icon\"/&gt;\n      ## Try to translate the names of the sections, build the key by adding an \"admin.\" in front.\n      ## Not the best way to translate, but very inline with the way the translations are done in XWiki.AdminSheet for individual administration page titles.\n      ## If there is no translation (translated message is equals to key), don't display the message key, but the section name instead.\n      #if($services.localization.get(\"admin.${sectionToAdd.toLowerCase()}\"))\n        #set($sectionDisplayName = $services.localization.render(\"admin.${sectionToAdd.toLowerCase()}\"))\n      #else\n        #set($sectionDisplayName = $sectionToAdd)\n      #end\n      $escapetool.xml($sectionDisplayName)\n      &lt;/span&gt;\n      #if(!$hasAccess)\n        &lt;br/&gt;&lt;span class=\"errormessage\"&gt;$services.localization.render('xe.admin.configurable.sectionIconNoAccess')&lt;/span&gt;\n      #end\n      &lt;/a&gt;\n    &lt;/li&gt;\n  #end\n  {{/html}}\n\n  ## Finally we display an error message if there are any applications which we were unable to view.\n  #if($appsUserCannotView.size() &gt; 0)\n    {{error}}$services.localization.render('xe.admin.configurable.noViewAccessSomeApplications',\n      'xwiki/2.1', [$appsUserCannotView]){{/error}}\n\n  #end\n#end## If we should be looking at the main administration page.\n{{/velocity}}</content>\n  <attachment>\n    <filename>DefaultAdminSectionIcon.png</filename>\n    <mimetype>image/png</mimetype>\n    <author>xwiki:XWiki.Admin</author>\n    <version>1.1</version>\n    <comment/>\n    <content>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</content>\n    <filesize>7257</filesize>\n  </attachment>\n  <class>\n    <name>XWiki.ConfigurableClass</name>\n    <customClass/>\n    <customMapping/>\n    <defaultViewSheet/>\n    <defaultEditSheet/>\n    <defaultWeb/>\n    <nameField/>\n    <validationScript/>\n    <categoryIcon>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>categoryIcon</name>\n      <number>11</number>\n      <picker>0</picker>\n      <prettyName>categoryIcon</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </categoryIcon>\n    <codeToExecute>\n      <contenttype>VelocityWiki</contenttype>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <editor>---</editor>\n      <hint/>\n      <name>codeToExecute</name>\n      <number>7</number>\n      <picker>0</picker>\n      <prettyName>codeToExecute</prettyName>\n      <rows>5</rows>\n      <size>40</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n    </codeToExecute>\n    <configurationClass>\n      <cache>0</cache>\n      <classname/>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>input</displayType>\n      <freeText/>\n      <hint/>\n      <idField/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>0</multiSelect>\n      <name>configurationClass</name>\n      <number>3</number>\n      <picker>1</picker>\n      <prettyName>configurationClass</prettyName>\n      <relationalStorage>0</relationalStorage>\n      <separator> </separator>\n      <separators/>\n      <size>30</size>\n      <sort>none</sort>\n      <sql/>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <valueField/>\n      <classType>com.xpn.xwiki.objects.classes.PageClass</classType>\n    </configurationClass>\n    <displayBeforeCategory>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayBeforeCategory</name>\n      <number>10</number>\n      <picker>0</picker>\n      <prettyName>displayBeforeCategory</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayBeforeCategory>\n    <displayInCategory>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayInCategory</name>\n      <number>9</number>\n      <picker>0</picker>\n      <prettyName>displayInCategory</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayInCategory>\n    <displayInSection>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayInSection</name>\n      <number>1</number>\n      <picker>0</picker>\n      <prettyName>displayInSection</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayInSection>\n    <heading>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>heading</name>\n      <number>2</number>\n      <picker>0</picker>\n      <prettyName>heading</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </heading>\n    <iconAttachment>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>iconAttachment</name>\n      <number>8</number>\n      <picker>0</picker>\n      <prettyName>iconAttachment</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </iconAttachment>\n    <linkPrefix>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>linkPrefix</name>\n      <number>5</number>\n      <picker>0</picker>\n      <prettyName>linkPrefix</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </linkPrefix>\n    <propertiesToShow>\n      <cache>0</cache>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>input</displayType>\n      <freeText/>\n      <hint/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>1</multiSelect>\n      <name>propertiesToShow</name>\n      <number>6</number>\n      <picker>0</picker>\n      <prettyName>propertiesToShow</prettyName>\n      <relationalStorage>1</relationalStorage>\n      <separator> </separator>\n      <separators> ,|</separators>\n      <size>20</size>\n      <sort>none</sort>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <values/>\n      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n    </propertiesToShow>\n    <scope>\n      <cache>0</cache>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>select</displayType>\n      <freeText/>\n      <hint/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>0</multiSelect>\n      <name>scope</name>\n      <number>12</number>\n      <picker>1</picker>\n      <prettyName>scope</prettyName>\n      <relationalStorage>0</relationalStorage>\n      <separator> </separator>\n      <separators>|, </separators>\n      <size>1</size>\n      <sort/>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <values>WIKI|SPACE|ALL_SPACES|WIKI+ALL_SPACES</values>\n      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n    </scope>\n    <sectionOrder>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>sectionOrder</name>\n      <number>12</number>\n      <numberType>integer</numberType>\n      <prettyName>sectionOrder</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n    </sectionOrder>\n  </class>\n  <object>\n    <name>XWiki.ConfigurableClass</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>71fc6ffa-92cb-48f1-9d80-a845d1807b10</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>document.observe('xwiki:dom:loaded', function() {\n  // Hide headers unless they have error messages under them.\n  var elementsInPage = $('admin-page-content').childNodes;\n  var errorShown = false;\n  for (var i = elementsInPage.length - 1; i &gt; -1; i--) {\n    var e = elementsInPage[i];\n    if (e.tagName != undefined &amp;&amp; e.tagName.toLowerCase() == 'div' &amp;&amp; e.getAttribute('class') != undefined &amp;&amp; e.getAttribute('class').indexOf('errormessage') != -1)\n    {\n      errorShown = true;\n    } else if (!errorShown\n               &amp;&amp; e.tagName != undefined\n               &amp;&amp; e.tagName.toLowerCase() == 'h1'\n               &amp;&amp; e.getAttribute('id') != undefined\n               &amp;&amp; e.getAttribute('id').toLowerCase().indexOf('hcustomize') == 0)\n    {\n      e.parentNode.removeChild(e);\n      errorShown = false;\n    }\n  }\n\n  // Hide individual submit buttons.\n  var forms = $('admin-page-content').select('form');\n  var inputs = $('admin-page-content').select('input');\n  for (var i = 0; i &lt; inputs.length; i++) {\n    if (inputs[i].getAttribute('type') != undefined &amp;&amp; inputs[i].getAttribute('type').toLowerCase() == 'submit') {\n      var bottombuttons = inputs[i].up('.bottombuttons');\n      bottombuttons &amp;&amp; bottombuttons.remove();\n    }\n  }\n\n  // Add a submit button for saving all sections at once.\n  var button = new Element('input', {'type':'submit', 'class':'button', 'value':'$services.localization.render(\"admin.save\")', 'name':'formactionsac'});\n  var wrapper = new Element('span', {'class':'buttonwrapper'});\n  var adminButtons = new Element('p', {'class':'admin-buttons'});\n  var bottomButtons = new Element('div', {'class':'bottombuttons'});\n  $('admin-page-content').appendChild(bottomButtons);\n  bottomButtons.appendChild(adminButtons);\n  adminButtons.appendChild(wrapper);\n  wrapper.appendChild(button);\n\n  Event.observe(button, 'click', function() {\n    var forms = $('admin-page-content').getElementsByTagName('form');\n    for (var i = 0; i &lt; forms.length; i++) {\n      Event.fire(document, 'xwiki:actions:save', {'form':forms[i].id, 'continue':true});\n    }\n  });\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n", "/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\npackage org.xwiki.administration;\n\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Objects;\n\nimport org.jsoup.nodes.Document;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.params.ParameterizedTest;\nimport org.junit.jupiter.params.provider.ValueSource;\nimport org.mockito.Mock;\nimport org.xwiki.localization.macro.internal.TranslationMacro;\nimport org.xwiki.model.reference.DocumentReference;\nimport org.xwiki.query.internal.ScriptQuery;\nimport org.xwiki.query.script.QueryManagerScriptService;\nimport org.xwiki.rendering.RenderingScriptServiceComponentList;\nimport org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;\nimport org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;\nimport org.xwiki.rendering.internal.macro.message.WarningMessageMacro;\nimport org.xwiki.script.service.ScriptService;\nimport org.xwiki.security.authorization.Right;\nimport org.xwiki.security.script.SecurityScriptServiceComponentList;\nimport org.xwiki.test.annotation.ComponentList;\nimport org.xwiki.test.page.HTML50ComponentList;\nimport org.xwiki.test.page.PageTest;\nimport org.xwiki.test.page.TestNoScriptMacro;\nimport org.xwiki.test.page.XWikiSyntax21ComponentList;\nimport org.xwiki.user.UserReferenceComponentList;\nimport org.xwiki.user.internal.converter.DocumentUserReferenceConverter;\nimport org.xwiki.user.internal.document.DocumentUserReference;\n\nimport com.xpn.xwiki.doc.XWikiDocument;\nimport com.xpn.xwiki.internal.model.reference.DocumentReferenceConverter;\nimport com.xpn.xwiki.objects.BaseObject;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.ArgumentMatchers.anyInt;\nimport static org.mockito.ArgumentMatchers.anyString;\nimport static org.mockito.ArgumentMatchers.eq;\nimport static org.mockito.Mockito.when;\n\n/**\n * Page test of {@code XWiki.ConfigurableClass}.\n *\n * @version $Id$\n */\n@HTML50ComponentList\n@XWikiSyntax21ComponentList\n@RenderingScriptServiceComponentList\n@DefaultRenderingConfigurationComponentList\n@SecurityScriptServiceComponentList\n@UserReferenceComponentList\n@ComponentList({\n    TestNoScriptMacro.class,\n    TranslationMacro.class,\n    ErrorMessageMacro.class,\n    WarningMessageMacro.class,\n    DocumentUserReferenceConverter.class,\n    DocumentReferenceConverter.class\n})\nclass ConfigurableClassPageTest extends PageTest\n{\n    private static final String WIKI_NAME = \"xwiki\";\n\n    private static final String SPACE_NAME = \"XWiki\";\n\n    private static final DocumentReference CONFIGURABLE_CLASS =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"ConfigurableClass\");\n\n    private static final DocumentReference CONFIGURABLE_CLASS_MACROS =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"ConfigurableClassMacros\");\n\n    private static final DocumentReference MY_SECTION =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"]],{{noscript /}}\");\n\n    private static final String MY_SECTION_SERIALIZED = \"XWiki.]],{{noscript /}}\";\n\n    @Mock\n    private QueryManagerScriptService queryService;\n\n    @Mock\n    private ScriptQuery query;\n\n    @BeforeEach\n    void setUp() throws Exception\n    {\n        // Load the macros page so it can be included.\n        loadPage(CONFIGURABLE_CLASS_MACROS);\n\n        // Mock the query.\n        this.oldcore.getMocker().registerComponent(ScriptService.class, \"query\", this.queryService);\n        when(this.queryService.hql(anyString())).thenReturn(this.query);\n        when(this.query.addFilter(anyString())).thenReturn(this.query);\n        when(this.query.setLimit(anyInt())).thenReturn(this.query);\n        when(this.query.setOffset(anyInt())).thenReturn(this.query);\n        when(this.query.bindValues(any(Map.class))).thenReturn(this.query);\n        when(this.query.bindValues(any(List.class))).thenReturn(this.query);\n    }\n\n    @Test\n    void escapeHeadingForError() throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        assertEquals(String.format(\"admin.customize %s:\", MY_SECTION_SERIALIZED),\n            htmlPage.selectFirst(\"h1\").text());\n    }\n\n    @Test\n    void escapeHeading() throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n        object.setStringValue(\"displayInCategory\", \"other\");\n        object.setStringValue(\"displayInSection\", \"other\");\n        object.setStringValue(\"heading\", \"{{noscript /}}\");\n        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        assertEquals(\"{{noscript /}}\", htmlPage.selectFirst(\"h2\").text());\n    }\n\n    @ParameterizedTest\n    @ValueSource(booleans = {true, false})\n    void checkScriptRight(boolean hasScript) throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n        object.setStringValue(\"displayInCategory\", \"other\");\n        object.setStringValue(\"displayInSection\", \"other\");\n        String originalHeading = \"$appName {{noscript /}}\";\n        object.setStringValue(\"heading\", originalHeading);\n        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n        DocumentReference userReference = new DocumentReference(WIKI_NAME, SPACE_NAME, \"Admin\");\n        mySectionDoc.getAuthors().setEffectiveMetadataAuthor(new DocumentUserReference(userReference, true));\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n        when(this.oldcore.getMockAuthorizationManager().hasAccess(Right.SCRIPT,\n            userReference, mySectionDoc.getDocumentReference())).thenReturn(hasScript);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        String expected;\n        if (hasScript) {\n            expected = String.format(\"%s {{noscript /}}\", MY_SECTION_SERIALIZED);\n        } else {\n            expected = originalHeading;\n        }\n        assertEquals(expected, htmlPage.selectFirst(\"h2\").text());\n    }\n\n    @Test\n    void escapeNonViewableSections() throws Exception\n    {\n        // Create a new section document.\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"view\"), any(), eq(\"xwiki:\" + MY_SECTION_SERIALIZED), any())).thenReturn(false);\n\n        // Make sure the section document is returned by the query.\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n\n        DocumentReference docRef = new DocumentReference(WIKI_NAME, \"\\\">{{/html}}{{noscript /}}\", \"WebHome\");\n        XWikiDocument contextDoc = new XWikiDocument(docRef);\n        this.xwiki.saveDocument(contextDoc, this.context);\n        this.context.setDoc(contextDoc);\n\n        XWikiDocument doc = loadPage(CONFIGURABLE_CLASS);\n        Document htmlPage = renderHTMLPage(doc);\n        String errorMessage = Objects.requireNonNull(htmlPage.selectFirst(\"div.errormessage p\")).text();\n        assertEquals(String.format(\"xe.admin.configurable.noViewAccessSomeApplications [[%s]]\", MY_SECTION_SERIALIZED),\n            errorMessage);\n    }\n}\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.ConfigurableClass\" locale=\"\">\n  <web>XWiki</web>\n  <name>ConfigurableClass</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('xe.admin.configurable.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{include reference=\"XWiki.ConfigurableClassMacros\" /}}\n\n{{velocity}}\n#*\n * This part takes the configuration from any documents containing XWiki.ConfigurableClass objects and creates a form\n * for each. To includeForm this document, you may specify:\n *\n * $section - String - The section which we are administrating eg: \"Registration\", \"Users\", or \"Import\".\n *                     If none is specified then it checks for a request parameter called \"section\" and uses that,\n *                     if no parameter, then this code assumes that it is part of the admin icons sheet and adds icons\n *                     for any section which is not in $sections, in that event, this code assumes it is being run\n *                     inside of a &lt;ul&gt; block.\n *\n * $sections - List&lt;String&gt; - If section is not specified, any sections on this list will not have icons made for them,\n *                            the assumption being that the icons are already there. If section is specified then this\n *                            is not taken into account and may safely be undefined.\n *\n * $currentDoc - String (document.fullName) - The administration document, users who don't have permission to edit\n *                                            it will not be able to include applications (possibly injecting\n *                                            arbitrary code.) if none specified then $doc.getFullName() is used.\n *\n * $globaladmin - boolean - If set true then we will assume we are administrationg the entire wiki.\n *                          If not set then we look for a request parameter called \"editor\" if that exists and equals\n *                          \"globaladmin\" then $globaladmin is true, if it doesn't exist then we check to see if\n *                          $currentDoc.getFullName() equals \"XWiki.XWikiPreferences\".\n *###\n##\n## Form submission depends on this.\n$xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n## In case of conflict issue we want to display the diff properly\n#set ($discard = $xwiki.ssfx.use('uicomponents/viewers/diff.css', true))\n#set ($discard = $xwiki.jsfx.use('uicomponents/viewers/diff.js'))\n##\n#if(!$section)\n  #set($section = $request.getParameter('section'))\n#end\n#if(!$currentDoc)\n  #set($currentDoc = $doc.getFullName())\n#end\n## Get value of $globaladmin if not specified.\n#if(\"$!globaladmin\" == '')\n  #if($editor != 'globaladmin'\n      &amp;&amp; $request.getParameter('editor') != 'globaladmin'\n      &amp;&amp; $currentDoc != 'XWiki.XWikiPreferences')\n  ##\n    #set($globaladmin = false)\n  #else\n    #set($globaladmin = true)\n  #end\n#end\n#set($currentSpace = $xwiki.getDocument($currentDoc).getSpace())\n##\n##------------------------------------------------------------------------------------------------------------\n## If $section exists then we are viewing the admin page for a particular section.\n## eg: 'Registration', 'Presentation', 'Import' etc.\n##------------------------------------------------------------------------------------------------------------\n##\n#if($section &amp;&amp; $section != '')\n  ##\n  ## This is for keeping track of whether we have shown the heading yet or not.\n  ## If the heading doesn't need to be shown, but an error occurs in processing, then we show the heading\n  ## so that the user knows what the error relates to.\n  #set($headingShowing = false)\n  ##\n  ## Searches the database for names of apps to be configured\n  #set($outputList = [])\n  #findNamesOfAppsToConfigure($section, $globaladmin, $xwiki.getDocument($currentDoc).getSpace(), $outputList)\n  ##\n  #foreach($appName in $outputList)\n    ##\n    ## Make sure the current user has permission to edit the configurable application.\n    #set($userHasAccessToDocument = $xcontext.hasAccessLevel('edit', $appName))\n    ##\n    ## If the document was not last saved by a user with edit privilege on this page\n    ## then we can't safely display the page but we should warn the viewer.\n    #if($userHasAccessToDocument)\n      ## Get the configurable application\n      #set($app = $xwiki.getDocument($appName))\n      ##\n      #set($documentSavedByAuthorizedUser = false)\n      #checkDocumentSavedByAuthorizedUser($app, $currentDoc, $documentSavedByAuthorizedUser)\n    #end\n    ##\n    ## There is no need to display a heading unless:\n    ## 1. There was already a section before this document.\n    ## 2. This is not the first document in this section.\n    ##\n    ## If we are displaying the heading and there is an error to be shown Javascript will not strip the heading.\n    #if(!$appName.equals($outputList.get(0)) || $sections.contains($section))\n      ## Create a document heading.\n      #showHeading($appName, $headingShowing)\n    #end\n    ##\n    #if(!$userHasAccessToDocument)\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"xe.admin.configurable.noPermissionThisApplication\"/}}{{/error}}\n\n    #elseif(!$documentSavedByAuthorizedUser)\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"xe.admin.configurable.applicationAuthorNoAdmin\" parameters=\"$app.Author\"/}}{{/error}}\n\n    ##\n    ##------------------------------------------------------------------------------------------------------------\n    ## If the document is locked and not by the current user and forceEdit is not set true,\n    #elseif($app.getLocked() &amp;&amp; $app.getLockingUser() != $xcontext.getUser() &amp;&amp; !$request.getParameter('forceEdit'))\n      #set($requestURL = \"$request.getRequestURL()\")\n      #if($requestURL.indexOf('?') == -1)\n        #set($requestURL = \"${requestURL}?$request.queryString\")\n      #end\n      #showHeading($appName, $headingShowing)\n\n      {{error}}{{translation key=\"doclockedby\"/}} $app.getLockingUser() [[{{translation key=\"forcelock\"/}}&gt;&gt;${requestURL}&amp;forceEdit=1]]{{/error}}\n\n    #else\n      ## If the document is not already locked, attempt to acquire the lock.\n      #if(!$app.getLocked())\n\n        {{html wiki=true}}\n          &lt;noscript&gt;\n\n            {{warning}}{{translation key=\"xe.admin.configurable.cannotLockNoJavascript\"/}}{{/warning}}\n\n          &lt;/noscript&gt;\n        {{/html}}\n\n        {{html clean=false}}\n          &lt;script&gt;\n            document.observe(\"xwiki:dom:loaded\", function() {\n              XWiki.DocumentLock &amp;&amp; new XWiki.DocumentLock('$escapetool.javascript($app.prefixedFullName)').lock();\n            });\n          &lt;/script&gt;\n        {{/html}}\n      #end\n      ##------------------------------------------------------------------------------------------------------------\n      ## Done Locking.\n      ##\n      ## Get all objects of the \"ConfigurableClass\" from this document.\n      #set($allConfigurableObjs = $app.getObjects($nameOfThisDocument))\n      ## Separate out the objects which are for this section.\n      #set($configurableObjs = [])\n      #foreach($configurableObj in $allConfigurableObjs)\n        #if($app.getValue('displayInSection', $configurableObj) == $section)\n          #set($discard = $configurableObjs.add($configurableObj))\n        #end\n      #end\n      #if($configurableObjs.size() == 0)\n        ## Internal error, not translated.\n        #showHeading($appName, $headingShowing)\n\n        {{error}}Internal error: All objects were filtered out for application:\n        $services.rendering.escape($appName, 'xwiki/2.1').{{/error}}\n\n      #else\n        #set($formAction = $xwiki.getURL($app.getFullName(), 'save'))\n        #set($formId = \"${section.toLowerCase()}_${app.getFullName()}\")\n        #set($escapedAppName = $escapetool.xml($app.getFullName()))\n        #foreach($configurableObj in $configurableObjs)\n          ## Execute the content code if any\n          ## FIXME: we have to do that before the title before of the dropPermissions\n          #set($codeToExecute = \"$!app.getValue('codeToExecute', $configurableObj)\")\n          #if($codeToExecute != '')\n            #set($codeToExecuteResult = $configurableObj.display('codeToExecute', 'view', false))\n          #end\n          ## Display the header if one exists.\n          #set($heading = $app.getValue('heading', $configurableObj))\n          #if($heading &amp;&amp; $heading != '')\n            ## This application should not run with programming rights because it evaluates code which may not be trustworthy.\n            ## Removing the next line will open a security hole.\n            ## Can't use $configurableObj.display('heading', 'view', false) to have proper heading id (because of the html macro)\n            ## FIXME: find a cleaner solution\n            #set($void = $doc.dropPermissions())\n            #if ($services.security.authorization.hasAccess(\"script\",\n              $app.authors.effectiveMetadataAuthor, $app.documentReference) &amp;&amp; !$app.restricted)\n              #set($evaluatedHeading = \"#evaluate($heading)\")\n            #else\n              #set($evaluatedHeading = $heading)\n            #end\n            == $services.rendering.escape($evaluatedHeading, 'xwiki/2.1') ==\n          #end\n          ## Display code to execute\n          #if($codeToExecute != '')\n            (%class=\"codeToExecute\"%)(((##\n              $codeToExecuteResult\n            )))\n          #end\n          ##\n          ## If propertiesToShow is set, then we will only show the properties contained therein.\n          #set($propertiesToShow = $app.getValue('propertiesToShow', $configurableObj))\n          #if(!$propertiesToShow || $propertiesToShow.getClass().getName().indexOf('List') == -1)\n            #set($propertiesToShow = [])\n          #end\n          ##\n          ## If linkPrefix is set, then we will make each property label a link which starts with that prefix.\n          #set($linkPrefix = \"$!app.getValue('linkPrefix', $configurableObj)\")\n          ##\n          ## If the Configurable object specifies a configuration class, use it,\n          ## otherwise assume custom forms are used instead.\n          #set($configClassName = \"$!app.getValue('configurationClass', $configurableObj)\")\n          #if($configClassName != '')\n            #set($objClass = $xwiki.getDocument($configClassName).getxWikiClass())\n            #if(!$objClass || $objClass.getClass().getName().indexOf('.Class') == -1)\n              #showHeading($appName, $headingShowing)\n\n              {{error}}{{translation key=\"xe.admin.configurable.configurationClassNonexistant\"/}}{{/error}}\n\n            #else\n              ## Use the first object from the document which is of the configuration class.\n              #set($obj = $app.getObject($objClass.getName()))\n              ##\n              #if(!$obj || $obj.getClass().getName().indexOf('.Object') == -1)\n                #showHeading($appName, $headingShowing)\n\n                {{error}}\n                  #set($escapedObjClassName =\n                    $services.rendering.escape($escapetool.java($objClass.getName()), 'xwiki/2.1'))\n                  #set($translationEscapedAppName =\n                    $services.rendering.escape($escapetool.java($app.getFullName()), 'xwiki/2.1'))\n                  {{translation key=\"xe.admin.configurable.noObjectOfConfigurationClassFound\"\n                    parameters=\"~\"$escapedObjClassName~\", ~\"$translationEscapedAppName~\"\"/}}\n                {{/error}}\n\n              #else\n                ##\n                ## Merge save buttons, remove headings from subsections, and make information links into popups.\n                ## This is not done if there is only a custom defined form.\n                $xwiki.jsx.use($nameOfThisDocument)##\n                ##\n                ## We don't begin the form until we have content for it so that a configurable can specify a\n                ## custom form in codeToExecute and if that configurable object is the first of it's kind in that\n                ## document, the custom form will not be put inside of our form.\n                #if(!$insideForm)\n                  ## We are opening a form and fieldset without closing it, thus we cannot clean this html.\n\n                  {{html clean=false}}\n                    &lt;form id=\"$formId\" method=\"post\" action=\"$formAction\" class=\"xform\"&gt;\n                      &lt;fieldset&gt;\n                  {{/html}}\n                  #set($insideForm = true)\n                #end\n\n                {{html}}\n                  $formHtml.toString()\n                {{/html}}\n              #end## If object exists\n            #end## If class exists\n          #end## If class name is specified.\n        #end## Foreach configurable object found in this document\n        ## If a form was started then we end it.\n        #if($insideForm)\n\n          ## This is closing an open form which was opened above, we cannot clean this html.\n          {{html clean=false}}\n          ## We add in a redirect field to prevent the user from being carried away when they save\n          ## if they don't have javascript.\n          #set($thisURL = $request.getRequestURL())\n          #if($request.getQueryString() &amp;&amp; $request.getQueryString().length() &gt; 0)\n            #set($thisURL = \"${thisURL}?$request.getQueryString()\")\n          #end\n          &lt;input type=\"hidden\" id=\"${escapedAppName}_redirect\" name=\"$redirectParameter\" value=\"$escapetool.xml($thisURL)\" /&gt;\n          &lt;input type=\"hidden\" name=\"form_token\" value=\"$!{services.csrf.getToken()}\" /&gt;\n          &lt;/fieldset&gt;\n          &lt;div class=\"bottombuttons\"&gt;\n            &lt;p class=\"admin-buttons\"&gt;\n              &lt;span class=\"buttonwrapper\"&gt;\n                ## Text to display on the button. If there is a heading then this button should be labeled\n                ## that it is for saving this section. Otherwise it should be a generic \"save\" button.\n                #if($headingShowing)\n                  #set($buttonText = \"$services.localization.render('admin.save') $escapedAppName\")\n                #else\n                  #set($buttonText = \"$services.localization.render('admin.save')\")\n                #end\n                &lt;input class=\"button\" type=\"submit\" name=\"action_saveandcontinue\" value=\"$buttonText\" /&gt;\n              &lt;/span&gt;\n            &lt;/p&gt;\n          &lt;/div&gt; ## bottombuttons\n          &lt;/form&gt;\n          #set($insideForm = false)\n          {{/html}}\n        #end\n      #end## If there are configurable objects\n    #end## If document is not locked or forceEdit is enabled\n  #end## Foreach document name in names to configure\n\n  {{html}}\n  &lt;script&gt;\n  /* &lt;![CDATA[ */\n  ## Alt+Shift+S presses the first saveAndContinue button it finds, not what we want so we will disable edit shortcuts.\n  document.observe('xwiki:dom:loaded', function() {\n    XWiki.actionButtons.EditActions = Object.extend(XWiki.actionButtons.EditActions, {addShortcuts : function() { }});\n  });\n  //]]&gt;\n  &lt;/script&gt;\n  {{/html}}##\n  ##\n#elseif ($currentDoc != 'XWiki.ConfigurableClass')\n  ##\n  ##------------------------------------------------------------------------------------------------------------\n  ## If section is not set then we are viewing the main administration page.\n  ##------------------------------------------------------------------------------------------------------------\n  ##\n  ## If there is no list called sections then we set sections to an empty list.\n  #if(!$sections || $sections.getClass().getName().indexOf('List') == -1)\n    #set($sections = [])\n  #end\n  ##\n  ## We have to create a list of documents which the current user doesn't have permission to view.\n  ## So we can add an error message to the bottom of the page if there are any.\n  #set($appsUserCannotView = [])\n  ##\n  ## A list of sections (to be added) which the user is not allowed to edit, icons will be displayed with a message\n  #set($sectionsUserCannotEdit = [])\n  ## List of sections to be added, in order by creationDate of oldest contained application.\n  #set($sectionsToAdd = [])\n  ## Map of URL of icon to use by the name of the section to use that icon on.\n  #set($iconBySection = {})\n  ##\n  #set($outputList = [])\n  #findNamesOfAppsToConfigure(\"\", $globaladmin, $currentSpace, $outputList)\n  ##\n  #foreach($appName in $outputList)\n    ##\n    ## Get the configurable application\n    #set($app = $xwiki.getDocument($appName))\n    ##\n    ## If getDocument returns null, then warn the user that they don't have view access to that application.\n    #if(!$app)\n      #set($discard = $appsUserCannotView.add($appName))\n    #end\n    ##\n    #set($configurableObjects = $app.getObjects($nameOfThisDocument))\n    #foreach($configurableObject in $configurableObjects)\n      #set($displayInSection = $app.getValue('displayInSection', $configurableObject))\n      ##\n      ## If there is no section for this configurable or if the section cannot be edited, then check if the\n      ## application can be edited by the current user, if so then we display the icon from the current app and\n      ## don't display any message to tell the user they can't edit that section.\n      #if(!$sections.contains($displayInSection) || $sectionsUserCannotEdit.contains($displayInSection))\n        ##\n        ## If there is no section for this configurable, then we will have to add one.\n        #if(!$sections.contains($displayInSection) &amp;&amp; !$sectionsToAdd.contains($displayInSection))\n          #set($discard = $sectionsToAdd.add($displayInSection))\n        #end\n        ##\n        ## If an attachment by the filename iconAttachment exists and is an image\n        #set($attachment = $app.getAttachment(\"$app.getValue('iconAttachment', $configurableObject)\"))\n        #if($attachment &amp;&amp; $attachment.isImage())\n          ## Set the icon for this section as the attachment URL.\n          #set($discard = $iconBySection.put($displayInSection, $app.getAttachmentURL($attachment.getFilename())))\n        #end\n        ##\n        ## If the user doesn't have edit access to the application, we want to show a message on the icon\n        #if(!$xcontext.hasAccessLevel(\"edit\", $app.getFullName()))\n          #if(!$sectionsUserCannotEdit.contains($displayInSection))\n            #set($discard = $sectionsUserCannotEdit.add($displayInSection))\n          #end\n        #elseif($sectionsUserCannotEdit.contains($displayInSection))\n          ## If the user didn't have access to the section before but does have access to _this_ app which is\n          ## configured in the section, then the section becomes accessible.\n          #set($discard = $sectionsUserCannotEdit.remove($displayInSection))\n        #end\n      #end## If section doesn't exist or user doesn't have access.\n    #end## Foreach configurable object in this app.\n  #end## Foreach application which is configurable.\n  ##\n  ## Now we go through sectionsToAdd and generate icons for them\n  #set($defaultIcon = $xwiki.getAttachmentURL($nameOfThisDocument, 'DefaultAdminSectionIcon.png'))\n  #if($globaladmin)\n    #set($queryString = \"editor=globaladmin&amp;amp;section=\")\n  #else\n    #set($queryString = \"space=$escapetool.url($currentSpace)&amp;amp;section=\")\n    #if($request.getParameter('editor'))\n      #set($queryString = \"editor=$escapetool.url($request.getParameter('editor'))&amp;amp;$queryString\")\n    #end\n  #end\n\n  ## This is an html fragment and thus cannot be cleaned\n  {{html clean=false}}\n  #foreach($sectionToAdd in $sectionsToAdd)\n    #set($icon = $iconBySection.get($sectionToAdd))\n    #if(!$icon)\n      #set($icon = $defaultIcon)\n    #end\n    &lt;li class=\"$escapetool.xml($sectionToAdd).replaceAll(' ', '_')\"&gt;\n      #set($hasAccess = !$sectionsUserCannotEdit.contains($sectionToAdd))\n      #if($hasAccess)\n        &lt;a href=\"$xwiki.getURL($currentDoc, $xcontext.getAction(), \"$queryString$escapetool.url($sectionToAdd)\")\"&gt;\n      #else\n        &lt;a title=\"$services.localization.render('xe.admin.configurable.sectionIconNoAccessTooltip')\"&gt;\n      #end\n      &lt;span&gt;\n      &lt;img src=\"$icon\" alt=\"$escapetool.xml($sectionToAdd) icon\"/&gt;\n      ## Try to translate the names of the sections, build the key by adding an \"admin.\" in front.\n      ## Not the best way to translate, but very inline with the way the translations are done in XWiki.AdminSheet for individual administration page titles.\n      ## If there is no translation (translated message is equals to key), don't display the message key, but the section name instead.\n      #if($services.localization.get(\"admin.${sectionToAdd.toLowerCase()}\"))\n        #set($sectionDisplayName = $services.localization.render(\"admin.${sectionToAdd.toLowerCase()}\"))\n      #else\n        #set($sectionDisplayName = $sectionToAdd)\n      #end\n      $escapetool.xml($sectionDisplayName)\n      &lt;/span&gt;\n      #if(!$hasAccess)\n        &lt;br/&gt;&lt;span class=\"errormessage\"&gt;$services.localization.render('xe.admin.configurable.sectionIconNoAccess')&lt;/span&gt;\n      #end\n      &lt;/a&gt;\n    &lt;/li&gt;\n  #end\n  {{/html}}\n\n  ## Finally we display an error message if there are any applications which we were unable to view.\n  #if($appsUserCannotView.size() &gt; 0)\n    {{error}}$services.localization.render('xe.admin.configurable.noViewAccessSomeApplications',\n      'xwiki/2.1', [$appsUserCannotView]){{/error}}\n\n  #end\n#end## If we should be looking at the main administration page.\n{{/velocity}}</content>\n  <attachment>\n    <filename>DefaultAdminSectionIcon.png</filename>\n    <mimetype>image/png</mimetype>\n    <author>xwiki:XWiki.Admin</author>\n    <version>1.1</version>\n    <comment/>\n    <content>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</content>\n    <filesize>7257</filesize>\n  </attachment>\n  <class>\n    <name>XWiki.ConfigurableClass</name>\n    <customClass/>\n    <customMapping/>\n    <defaultViewSheet/>\n    <defaultEditSheet/>\n    <defaultWeb/>\n    <nameField/>\n    <validationScript/>\n    <categoryIcon>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>categoryIcon</name>\n      <number>11</number>\n      <picker>0</picker>\n      <prettyName>categoryIcon</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </categoryIcon>\n    <codeToExecute>\n      <contenttype>VelocityWiki</contenttype>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <editor>---</editor>\n      <hint/>\n      <name>codeToExecute</name>\n      <number>7</number>\n      <picker>0</picker>\n      <prettyName>codeToExecute</prettyName>\n      <rows>5</rows>\n      <size>40</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n    </codeToExecute>\n    <configurationClass>\n      <cache>0</cache>\n      <classname/>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>input</displayType>\n      <freeText/>\n      <hint/>\n      <idField/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>0</multiSelect>\n      <name>configurationClass</name>\n      <number>3</number>\n      <picker>1</picker>\n      <prettyName>configurationClass</prettyName>\n      <relationalStorage>0</relationalStorage>\n      <separator> </separator>\n      <separators/>\n      <size>30</size>\n      <sort>none</sort>\n      <sql/>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <valueField/>\n      <classType>com.xpn.xwiki.objects.classes.PageClass</classType>\n    </configurationClass>\n    <displayBeforeCategory>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayBeforeCategory</name>\n      <number>10</number>\n      <picker>0</picker>\n      <prettyName>displayBeforeCategory</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayBeforeCategory>\n    <displayInCategory>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayInCategory</name>\n      <number>9</number>\n      <picker>0</picker>\n      <prettyName>displayInCategory</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayInCategory>\n    <displayInSection>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>displayInSection</name>\n      <number>1</number>\n      <picker>0</picker>\n      <prettyName>displayInSection</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </displayInSection>\n    <heading>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>heading</name>\n      <number>2</number>\n      <picker>0</picker>\n      <prettyName>heading</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </heading>\n    <iconAttachment>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>iconAttachment</name>\n      <number>8</number>\n      <picker>0</picker>\n      <prettyName>iconAttachment</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </iconAttachment>\n    <linkPrefix>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>linkPrefix</name>\n      <number>5</number>\n      <picker>0</picker>\n      <prettyName>linkPrefix</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n    </linkPrefix>\n    <propertiesToShow>\n      <cache>0</cache>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>input</displayType>\n      <freeText/>\n      <hint/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>1</multiSelect>\n      <name>propertiesToShow</name>\n      <number>6</number>\n      <picker>0</picker>\n      <prettyName>propertiesToShow</prettyName>\n      <relationalStorage>1</relationalStorage>\n      <separator> </separator>\n      <separators> ,|</separators>\n      <size>20</size>\n      <sort>none</sort>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <values/>\n      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n    </propertiesToShow>\n    <scope>\n      <cache>0</cache>\n      <customDisplay/>\n      <defaultValue/>\n      <disabled>0</disabled>\n      <displayType>select</displayType>\n      <freeText/>\n      <hint/>\n      <largeStorage>0</largeStorage>\n      <multiSelect>0</multiSelect>\n      <name>scope</name>\n      <number>12</number>\n      <picker>1</picker>\n      <prettyName>scope</prettyName>\n      <relationalStorage>0</relationalStorage>\n      <separator> </separator>\n      <separators>|, </separators>\n      <size>1</size>\n      <sort/>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <values>WIKI|SPACE|ALL_SPACES|WIKI+ALL_SPACES</values>\n      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n    </scope>\n    <sectionOrder>\n      <customDisplay/>\n      <disabled>0</disabled>\n      <hint/>\n      <name>sectionOrder</name>\n      <number>12</number>\n      <numberType>integer</numberType>\n      <prettyName>sectionOrder</prettyName>\n      <size>30</size>\n      <unmodifiable>0</unmodifiable>\n      <validationMessage/>\n      <validationRegExp/>\n      <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n    </sectionOrder>\n  </class>\n  <object>\n    <name>XWiki.ConfigurableClass</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>71fc6ffa-92cb-48f1-9d80-a845d1807b10</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>document.observe('xwiki:dom:loaded', function() {\n  // Hide headers unless they have error messages under them.\n  var elementsInPage = $('admin-page-content').childNodes;\n  var errorShown = false;\n  for (var i = elementsInPage.length - 1; i &gt; -1; i--) {\n    var e = elementsInPage[i];\n    if (e.tagName != undefined &amp;&amp; e.tagName.toLowerCase() == 'div' &amp;&amp; e.getAttribute('class') != undefined &amp;&amp; e.getAttribute('class').indexOf('errormessage') != -1)\n    {\n      errorShown = true;\n    } else if (!errorShown\n               &amp;&amp; e.tagName != undefined\n               &amp;&amp; e.tagName.toLowerCase() == 'h1'\n               &amp;&amp; e.getAttribute('id') != undefined\n               &amp;&amp; e.getAttribute('id').toLowerCase().indexOf('hcustomize') == 0)\n    {\n      e.parentNode.removeChild(e);\n      errorShown = false;\n    }\n  }\n\n  // Hide individual submit buttons.\n  var forms = $('admin-page-content').select('form');\n  var inputs = $('admin-page-content').select('input');\n  for (var i = 0; i &lt; inputs.length; i++) {\n    if (inputs[i].getAttribute('type') != undefined &amp;&amp; inputs[i].getAttribute('type').toLowerCase() == 'submit') {\n      var bottombuttons = inputs[i].up('.bottombuttons');\n      bottombuttons &amp;&amp; bottombuttons.remove();\n    }\n  }\n\n  // Add a submit button for saving all sections at once.\n  var button = new Element('input', {'type':'submit', 'class':'button', 'value':'$services.localization.render(\"admin.save\")', 'name':'formactionsac'});\n  var wrapper = new Element('span', {'class':'buttonwrapper'});\n  var adminButtons = new Element('p', {'class':'admin-buttons'});\n  var bottomButtons = new Element('div', {'class':'bottombuttons'});\n  $('admin-page-content').appendChild(bottomButtons);\n  bottomButtons.appendChild(adminButtons);\n  adminButtons.appendChild(wrapper);\n  wrapper.appendChild(button);\n\n  Event.observe(button, 'click', function() {\n    var forms = $('admin-page-content').getElementsByTagName('form');\n    for (var i = 0; i &lt; forms.length; i++) {\n      Event.fire(document, 'xwiki:actions:save', {'form':forms[i].id, 'continue':true});\n    }\n  });\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n", "/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\npackage org.xwiki.administration;\n\nimport java.net.URI;\nimport java.nio.charset.StandardCharsets;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Objects;\n\nimport org.apache.http.client.utils.URLEncodedUtils;\nimport org.jsoup.nodes.Document;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.params.ParameterizedTest;\nimport org.junit.jupiter.params.provider.ValueSource;\nimport org.mockito.Mock;\nimport org.xwiki.localization.macro.internal.TranslationMacro;\nimport org.xwiki.model.reference.DocumentReference;\nimport org.xwiki.query.internal.ScriptQuery;\nimport org.xwiki.query.script.QueryManagerScriptService;\nimport org.xwiki.rendering.RenderingScriptServiceComponentList;\nimport org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;\nimport org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;\nimport org.xwiki.rendering.internal.macro.message.WarningMessageMacro;\nimport org.xwiki.script.service.ScriptService;\nimport org.xwiki.security.authorization.Right;\nimport org.xwiki.security.script.SecurityScriptServiceComponentList;\nimport org.xwiki.test.annotation.ComponentList;\nimport org.xwiki.test.page.HTML50ComponentList;\nimport org.xwiki.test.page.PageTest;\nimport org.xwiki.test.page.TestNoScriptMacro;\nimport org.xwiki.test.page.XWikiSyntax21ComponentList;\nimport org.xwiki.user.UserReferenceComponentList;\nimport org.xwiki.user.internal.converter.DocumentUserReferenceConverter;\nimport org.xwiki.user.internal.document.DocumentUserReference;\n\nimport com.xpn.xwiki.doc.XWikiDocument;\nimport com.xpn.xwiki.internal.model.reference.DocumentReferenceConverter;\nimport com.xpn.xwiki.objects.BaseObject;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\nimport static org.junit.jupiter.api.Assertions.fail;\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.ArgumentMatchers.anyInt;\nimport static org.mockito.ArgumentMatchers.anyString;\nimport static org.mockito.ArgumentMatchers.eq;\nimport static org.mockito.Mockito.when;\n\n/**\n * Page test of {@code XWiki.ConfigurableClass}.\n *\n * @version $Id$\n */\n@HTML50ComponentList\n@XWikiSyntax21ComponentList\n@RenderingScriptServiceComponentList\n@DefaultRenderingConfigurationComponentList\n@SecurityScriptServiceComponentList\n@UserReferenceComponentList\n@ComponentList({\n    TestNoScriptMacro.class,\n    TranslationMacro.class,\n    ErrorMessageMacro.class,\n    WarningMessageMacro.class,\n    DocumentUserReferenceConverter.class,\n    DocumentReferenceConverter.class\n})\nclass ConfigurableClassPageTest extends PageTest\n{\n    private static final String WIKI_NAME = \"xwiki\";\n\n    private static final String SPACE_NAME = \"XWiki\";\n\n    private static final DocumentReference CONFIGURABLE_CLASS =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"ConfigurableClass\");\n\n    private static final DocumentReference CONFIGURABLE_CLASS_MACROS =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"ConfigurableClassMacros\");\n\n    private static final DocumentReference MY_SECTION =\n        new DocumentReference(WIKI_NAME, SPACE_NAME, \"]],{{noscript /}}\");\n\n    private static final String MY_SECTION_SERIALIZED = \"XWiki.]],{{noscript /}}\";\n\n    @Mock\n    private QueryManagerScriptService queryService;\n\n    @Mock\n    private ScriptQuery query;\n\n    @BeforeEach\n    void setUp() throws Exception\n    {\n        // Load the macros page so it can be included.\n        loadPage(CONFIGURABLE_CLASS_MACROS);\n\n        // Mock the query.\n        this.oldcore.getMocker().registerComponent(ScriptService.class, \"query\", this.queryService);\n        when(this.queryService.hql(anyString())).thenReturn(this.query);\n        when(this.query.addFilter(anyString())).thenReturn(this.query);\n        when(this.query.setLimit(anyInt())).thenReturn(this.query);\n        when(this.query.setOffset(anyInt())).thenReturn(this.query);\n        when(this.query.bindValues(any(Map.class))).thenReturn(this.query);\n        when(this.query.bindValues(any(List.class))).thenReturn(this.query);\n    }\n\n    @Test\n    void escapeHeadingForError() throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        assertEquals(String.format(\"admin.customize %s:\", MY_SECTION_SERIALIZED),\n            htmlPage.selectFirst(\"h1\").text());\n    }\n\n    @Test\n    void escapeHeading() throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n        object.setStringValue(\"displayInCategory\", \"other\");\n        object.setStringValue(\"displayInSection\", \"other\");\n        object.setStringValue(\"heading\", \"{{noscript /}}\");\n        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        assertEquals(\"{{noscript /}}\", htmlPage.selectFirst(\"h2\").text());\n    }\n\n    @ParameterizedTest\n    @ValueSource(booleans = {true, false})\n    void checkScriptRight(boolean hasScript) throws Exception\n    {\n        this.request.put(\"section\", \"other\");\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n        object.setStringValue(\"displayInCategory\", \"other\");\n        object.setStringValue(\"displayInSection\", \"other\");\n        String originalHeading = \"$appName {{noscript /}}\";\n        object.setStringValue(\"heading\", originalHeading);\n        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n        DocumentReference userReference = new DocumentReference(WIKI_NAME, SPACE_NAME, \"Admin\");\n        mySectionDoc.getAuthors().setEffectiveMetadataAuthor(new DocumentUserReference(userReference, true));\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n        when(this.oldcore.getMockAuthorizationManager().hasAccess(Right.SCRIPT,\n            userReference, mySectionDoc.getDocumentReference())).thenReturn(hasScript);\n\n        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n        String expected;\n        if (hasScript) {\n            expected = String.format(\"%s {{noscript /}}\", MY_SECTION_SERIALIZED);\n        } else {\n            expected = originalHeading;\n        }\n        assertEquals(expected, htmlPage.selectFirst(\"h2\").text());\n    }\n\n    @Test\n    void escapeNonViewableSections() throws Exception\n    {\n        // Create a new section document.\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"view\"), any(), eq(\"xwiki:\" + MY_SECTION_SERIALIZED), any())).thenReturn(false);\n\n        // Make sure the section document is returned by the query.\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n\n        DocumentReference docRef = new DocumentReference(WIKI_NAME, \"\\\">{{/html}}{{noscript /}}\", \"WebHome\");\n        XWikiDocument contextDoc = new XWikiDocument(docRef);\n        this.xwiki.saveDocument(contextDoc, this.context);\n        this.context.setDoc(contextDoc);\n\n        XWikiDocument doc = loadPage(CONFIGURABLE_CLASS);\n        Document htmlPage = renderHTMLPage(doc);\n        String errorMessage = Objects.requireNonNull(htmlPage.selectFirst(\"div.errormessage p\")).text();\n        assertEquals(String.format(\"xe.admin.configurable.noViewAccessSomeApplications [[%s]]\", MY_SECTION_SERIALIZED),\n            errorMessage);\n    }\n\n    @Test\n    void escapeSectionLink() throws Exception\n    {\n        // Create a new section document.\n        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n        object.setStringValue(\"displayInCategory\", \"other\");\n        object.setStringValue(\"displayInSection\", \"other\");\n        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n        this.xwiki.saveDocument(mySectionDoc, this.context);\n\n        // Make sure the section document is returned by the query and the user has access to edit.\n        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n        when(this.oldcore.getMockRightService()\n            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n\n        // Set a new document with space \">{{/html}}{{noscript /}} as context document to check escaping of the\n        // current space.\n        String spaceName = \"\\\">{{/html}}{{noscript /}}\";\n        DocumentReference docRef = new DocumentReference(WIKI_NAME, spaceName, \"WebHome\");\n        XWikiDocument contextDoc = new XWikiDocument(docRef);\n        this.xwiki.saveDocument(contextDoc, this.context);\n        this.context.setDoc(contextDoc);\n\n        XWikiDocument doc = loadPage(CONFIGURABLE_CLASS);\n        Document htmlPage = renderHTMLPage(doc);\n        String link = Objects.requireNonNull(htmlPage.selectFirst(\"li.other a\")).attr(\"href\");\n        URI uri = new URI(link);\n        // Parse the query parameters and check the space name.\n        URLEncodedUtils.parse(uri, StandardCharsets.UTF_8).stream()\n            .filter(pair -> pair.getName().equals(\"space\"))\n            .findFirst()\n            .ifPresentOrElse(pair -> assertEquals(spaceName, pair.getValue()), () -> fail(\"No space parameter in URL\"));\n    }\n}\n"], "filenames": ["xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ConfigurableClass.xml", "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/ConfigurableClassPageTest.java"], "buggy_code_start_loc": [410, 21], "buggy_code_end_loc": [411, 210], "fixing_code_start_loc": [410, 22], "fixing_code_end_loc": [411, 250], "type": "CWE-352", "message": "XWiki Platform is a generic wiki platform. Starting in 2.3 and prior to versions 14.10.15, 15.5.2, and 15.7-rc-1, there is a reflected XSS or also direct remote code execution vulnerability in the code for displaying configurable admin sections. The code that can be passed through a URL parameter is only executed when the user who is visiting the crafted URL has edit right on at least one configuration section. While any user of the wiki could easily create such a section, this vulnerability doesn't require the attacker to have an account or any access on the wiki. It is sufficient to trick any admin user of the XWiki installation to visit the crafted URL. This vulnerability allows full remote code execution with programming rights and thus impacts the confidentiality, integrity and availability of the whole XWiki installation. This has been fixed in XWiki 14.10.15, 15.5.2 and 15.7RC1. The patch can be manually applied to the document `XWiki.ConfigurableClass`.\n", "other": {"cve": {"id": "CVE-2023-50722", "sourceIdentifier": "security-advisories@github.com", "published": "2023-12-15T19:15:09.870", "lastModified": "2023-12-19T20:33:20.713", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform is a generic wiki platform. Starting in 2.3 and prior to versions 14.10.15, 15.5.2, and 15.7-rc-1, there is a reflected XSS or also direct remote code execution vulnerability in the code for displaying configurable admin sections. The code that can be passed through a URL parameter is only executed when the user who is visiting the crafted URL has edit right on at least one configuration section. While any user of the wiki could easily create such a section, this vulnerability doesn't require the attacker to have an account or any access on the wiki. It is sufficient to trick any admin user of the XWiki installation to visit the crafted URL. This vulnerability allows full remote code execution with programming rights and thus impacts the confidentiality, integrity and availability of the whole XWiki installation. This has been fixed in XWiki 14.10.15, 15.5.2 and 15.7RC1. The patch can be manually applied to the document `XWiki.ConfigurableClass`.\n"}, {"lang": "es", "value": "XWiki Platform es una plataforma wiki gen\u00e9rica. A partir de la versi\u00f3n 2.3 y anteriores a las versiones 14.10.15, 15.5.2 y 15.7-rc-1, hay una vulnerabilidad XSS reflejada o tambi\u00e9n de ejecuci\u00f3n remota directa de c\u00f3digo en el c\u00f3digo para mostrar secciones de administraci\u00f3n configurables. El c\u00f3digo que se puede pasar a trav\u00e9s de un par\u00e1metro de URL solo se ejecuta cuando el usuario que visita la URL manipulada tiene derecho de edici\u00f3n en al menos una secci\u00f3n de configuraci\u00f3n. Si bien cualquier usuario de la wiki podr\u00eda crear f\u00e1cilmente una secci\u00f3n de este tipo, esta vulnerabilidad no requiere que el atacante tenga una cuenta ni acceso a la wiki. Es suficiente enga\u00f1ar a cualquier usuario administrador de la instalaci\u00f3n de XWiki para que visite la URL manipulada. Esta vulnerabilidad permite la ejecuci\u00f3n remota completa de c\u00f3digo con derechos de programaci\u00f3n y, por lo tanto, afecta la confidencialidad, integridad y disponibilidad de toda la instalaci\u00f3n de XWiki. Esto se solucion\u00f3 en XWiki 14.10.15, 15.5.2 y 15.7RC1. El parche se puede aplicar manualmente al documento `XWiki.ConfigurableClass`."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}, {"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-352"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.3", "versionEndExcluding": "14.10.5", "matchCriteriaId": "2503AFD2-8705-405C-BBA7-273F644C0AA9"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "15.0", "versionEndExcluding": "15.5.2", "matchCriteriaId": "1EF6C37A-D19A-4179-8DBA-2573A61E73CF"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:15.6:-:*:*:*:*:*:*", "matchCriteriaId": "E0E3BBA4-5DBC-45F8-ACD2-1969FB3098FB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:15.6:rc1:*:*:*:*:*:*", "matchCriteriaId": "96F8B723-5227-4590-8626-C9CF0D3BC2B8"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:15.7:rc1:*:*:*:*:*:*", "matchCriteriaId": "EC6DB176-8A0C-4BB3-8C97-0CDBC52F1810"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/5e14c8d08fd0c5b619833d35090b470aa4cb52b0", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-cp3j-273x-3jxc", "source": "security-advisories@github.com", "tags": ["Patch", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-21167", "source": "security-advisories@github.com", "tags": ["Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/5e14c8d08fd0c5b619833d35090b470aa4cb52b0"}}