{"buggy_code": ["<?php\n\n/**\n * The main administration file for the news.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2003-02-23\n */\n\nuse phpMyFAQ\\Comments;\nuse phpMyFAQ\\Date;\nuse phpMyFAQ\\Entity\\CommentType;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Helper\\LanguageHelper;\nuse phpMyFAQ\\News;use phpMyFAQ\\Strings;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n$news = new News($faqConfig);\n\n$csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\nif (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n    $csrfCheck = false;\n} else {\n    $csrfCheck = true;\n}\n\nif ('add-news' == $action && $user->perm->hasPermission($user->getUserId(), 'addnews')) { ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_add'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <form id=\"faqEditor\" name=\"faqEditor\" action=\"?action=save-news\" method=\"post\" novalidate>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"newsheader\">\n                            <?= $PMF_LANG['ad_news_header'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"text\" name=\"newsheader\" id=\"newsheader\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"news\"><?= $PMF_LANG['ad_news_text'] ?>:</label>\n                        <div class=\"col-9\">\n                            <textarea name=\"news\" rows=\"5\" class=\"form-control\" id=\"news\"></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorName\">\n                        <?= $PMF_LANG['ad_news_author_name'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"text\" name=\"authorName\" id=\"authorName\"\n                                   value=\"<?= $user->getUserData('display_name') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorEmail\">\n                        <?= $PMF_LANG['ad_news_author_email'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"email\" name=\"authorEmail\" id=\"authorEmail\"\n                                   value=\"<?= $user->getUserData('email') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"active\">\n                            <?= $PMF_LANG['ad_news_set_active'] ?>:\n                        </label>\n                        <div class=\"col-9 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\">\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"comment\">\n                        <?= $PMF_LANG['ad_news_allowComments'] ?>\n                        </label>\n                        <div class=\"col-9 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\">\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"link\"><?= $PMF_LANG['ad_news_link_url'] ?></label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"text\" name=\"link\" id=\"link\"\n                            placeholder=\"http://www.example.com/\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"linkTitle\">\n                        <?= $PMF_LANG['ad_news_link_title'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"linkTitle\" id=\"linkTitle\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" ><?= $PMF_LANG['ad_news_link_target'] ?></label>\n                        <div class=\"col-9 radio\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\">\n                                <?= $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\">\n                                <?= $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\">\n                                <?= $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"langTo\"><?= $PMF_LANG['ad_entry_locale'] ?>:</label>\n                        <div class=\"col-9\">\n                            <?= LanguageHelper::renderSelectLanguage($faqLangCode, false, [], 'langTo') ?>\n                        </div>\n                    </div>\n\n                    <legend><?= $PMF_LANG['ad_news_expiration_window'] ?></legend>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateStart\"><?= $PMF_LANG['ad_news_from'] ?></label>\n                        <div class=\"col-3\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateEnd\"><?= $PMF_LANG['ad_news_to'] ?></label>\n                        <div class=\"col-3\">\n                            <input type=\"date\" name=\"dateEnd\" id=\"dateEnd\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                      <div class=\"col-12\">\n                        <div class=\"btn-group float-right mt-2\" role=\"group\">\n                          <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?= $PMF_LANG['ad_entry_back'] ?>\n                          </a>\n                          <button class=\"btn btn-primary\" type=\"submit\">\n                            <?= $PMF_LANG['ad_news_add'] ?>\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n    <?php\n} elseif ('news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    ?>\n         <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n              <?= $PMF_LANG['msgNews'] ?>\n          </h1>\n          <div class=\"btn-toolbar mb-2 mb-md-0\">\n            <div class=\"btn-group mr-2\">\n              <a href=\"?action=add-news\">\n                  <button class=\"btn btn-sm     btn-success\">\n                    <i aria-hidden=\"true\" class=\"fa fa-plus\"></i> <?= $PMF_LANG['ad_menu_news_add'] ?>\n                  </button>\n              </a>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <table class=\"table table-hover\">\n                <thead class=\"thead-dark\">\n                    <tr>\n                        <th><?= $PMF_LANG['ad_news_headline'] ?></th>\n                        <th><?= $PMF_LANG['ad_news_date'] ?></th>\n                        <th colspan=\"2\">&nbsp;</th>\n                    </tr>\n                </thead>\n                <tbody>\n    <?php\n    $newsHeader = $news->getNewsHeader();\n    $date = new Date($faqConfig);\n    if (count($newsHeader)) {\n        foreach ($newsHeader as $newsItem) {\n            ?>\n                    <tr>\n                        <td><?= Strings::htmlentities($newsItem['header']) ?></td>\n                        <td><?= $date->format($newsItem['date']) ?></td>\n                        <td>\n                            <a class=\"btn btn-primary\" href=\"?action=edit-news&amp;id=<?= $newsItem['id'] ?>\">\n                                <span title=\"<?= $PMF_LANG['ad_news_update'] ?>\" class=\"fa fa-edit\"></span>\n                            </a>\n                        </td>\n                        <td>\n                            <a class=\"btn btn-danger\" href=\"?action=delete-news&amp;id=<?= $newsItem['id'] ?>\">\n                                <span title=\"<?= $PMF_LANG['ad_news_delete'] ?>\" class=\"fa fa-trash\"></span>\n                            </a>\n                        </td>\n                    </tr>\n            <?php\n        }\n    } else {\n        printf(\n            '<tr><td colspan=\"3\">%s</td></tr>',\n            $PMF_LANG['ad_news_nodata']\n        );\n    }\n    ?>\n                </tbody>\n                </table>\n            </div>\n        </div>\n    <?php\n} elseif ('edit-news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    $id = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $newsData = $news->getNewsEntry($id, true);\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_edit'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <form  action=\"?action=update-news\" method=\"post\" accept-charset=\"utf-8\">\n                    <input type=\"hidden\" name=\"id\" value=\"<?= $newsData['id'] ?>\">\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"newsheader\"><?= $PMF_LANG['ad_news_header'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"newsheader\" id=\"newsheader\" class=\"form-control\"\n                                   value=\"<?= Strings::htmlentities($newsData['header']) ?? '' ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"news\"><?= $PMF_LANG['ad_news_text'] ?>:</label>\n                        <div class=\"col-9\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea id=\"news\" name=\"news\" class=\"form-control\" rows=\"5\"><?php\n                            if (isset($newsData['content'])) {\n                                echo htmlspecialchars($newsData['content'], ENT_QUOTES);\n                            } ?></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorName\">\n                        <?= $PMF_LANG['ad_news_author_name'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"authorName\" class=\"form-control\"\n                                value=\"<?= Strings::htmlentities($newsData['authorName']) ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorEmail\"><?= $PMF_LANG['ad_news_author_email'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"email\" name=\"authorEmail\" class=\"form-control\"\n                                value=\"<?= Strings::htmlentities($newsData['authorEmail']) ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"active\">\n                            <?= $PMF_LANG['ad_news_set_active'] ?>:\n                        </label>\n                        <div class=\"col-9\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\"\n                                    <?php if (isset($newsData['active']) && $newsData['active']) {\n                                        echo ' checked';\n                                    } ?>\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"comment\"><?= $PMF_LANG['ad_news_allowComments'] ?></label>\n                        <div class=\"col-9\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\"\n                                <?php if (isset($newsData['allowComments']) && $newsData['allowComments']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"link\"><?= $PMF_LANG['ad_news_link_url'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" id=\"link\" name=\"link\"\n                            value=\"<?= Strings::htmlentities($newsData['link']) ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"linkTitle\"><?= $PMF_LANG['ad_news_link_title'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" id=\"linkTitle\" name=\"linkTitle\"\n                            value=\"<?= Strings::htmlentities($newsData['linkTitle']) ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"target\"><?= $PMF_LANG['ad_news_link_target'] ?></label>\n                        <div class=\"col-9\">\n                        <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\"\n                                <?php if ('blank' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\"\n                                <?php if ('self' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\"\n                                <?php if ('parent' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"langTo\"><?= $PMF_LANG['ad_entry_locale'] ?>:</label>\n                        <div class=\"col-9\">\n                        <?= LanguageHelper::renderSelectLanguage($newsData['lang'], false, [], 'langTo') ?>\n                        </div>\n                    </div>\n    <?php\n    $dateStart = ($newsData['dateStart'] != '00000000000000' ? Date::createIsoDate($newsData['dateStart'], 'Y-m-d') : '');\n    $dateEnd = ($newsData['dateEnd'] != '99991231235959' ? Date::createIsoDate($newsData['dateEnd'], 'Y-m-d') : '');\n    ?>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateStart\"><?= $PMF_LANG['ad_news_from'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control\" value=\"<?= $dateStart ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateEnd\"><?= $PMF_LANG['ad_news_to'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"date\"  name=\"dateEnd\" id=\"dateEnd\" class=\"form-control\" value=\"<?= $dateEnd ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                      <div class=\"col-12\">\n                        <div class=\"btn-group float-right mt-2\" role=\"group\">\n                          <button class=\"btn btn-primary\" type=\"submit\">\n                            <?= $PMF_LANG['ad_news_edit'] ?>\n                          </button>\n                          <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?= $PMF_LANG['ad_entry_back'] ?>\n                          </a>\n                        </div>\n                      </div>\n                    </div>\n                </form>\n    <?php\n    $newsId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $oComment = new Comments($faqConfig);\n    $comments = $oComment->getCommentsData($newsId, CommentType::NEWS);\n    if (count($comments) > 0) {\n        ?>\n                <div class=\"form-group row\"><strong><?= $PMF_LANG['ad_entry_comment'] ?></strong></div>\n        <?php\n    }\n    foreach ($comments as $item) {\n        ?>\n                <div class=\"form-group row\">\n                    <?= $PMF_LANG['ad_entry_commentby'] ?>\n                    <a href=\"mailto:<?= $item->email ?>\">\n                        <?= $item->username ?>\n                    </a>:<br>\n                    <?= $item->comment ?><br>\n                    <?= $PMF_LANG['newsCommentDate'] . Date::createIsoDate((int)$item->date, 'Y-m-d H:i', false) ?>\n                    <a href=\"?action=delcomment&artid=<?= $newsId ?>&cmtid=<?= $item->id ?>&type=<?= CommentType::NEWS ?>\">\n                        <i aria-hidden=\"true\" class=\"fa fa-trash\"></i>\n                    </a>\n                </div>\n            </div>\n        </div>\n        <?php\n    }\n} elseif ('save-news' == $action && $user->perm->hasPermission($user->getUserId(), 'addnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $dateStart = Filter::filterInput(INPUT_POST, 'dateStart', FILTER_UNSAFE_RAW);\n    $dateEnd = Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_UNSAFE_RAW);\n    $header = Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_SPECIAL_CHARS);\n    $content = Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = Filter::filterInput(INPUT_POST, 'authorName', FILTER_UNSAFE_RAW);\n    $email = Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = Filter::filterInput(INPUT_POST, 'active', FILTER_UNSAFE_RAW);\n    $comment = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n    $link = Filter::filterInput(INPUT_POST, 'link', FILTER_SANITIZE_SPECIAL_CHARS);\n    $linkTitle = Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_SPECIAL_CHARS);\n    $newsLang = Filter::filterInput(INPUT_POST, 'langTo', FILTER_UNSAFE_RAW);\n    $target = Filter::filterInput(INPUT_POST, 'target', FILTER_UNSAFE_RAW);\n\n    $newsData = array(\n        'lang' => $newsLang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart) . '000000',\n        'dateEnd' => (empty($dateEnd)) ? '99991231235959' : str_replace('-', '', $dateEnd) . '235959',\n        'link' => $link,\n        'linkTitle' => $linkTitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    if ($news->addNewsEntry($newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_insertfail']);\n    }\n    printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n    <?php\n} elseif ('update-news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $dateStart = Filter::filterInput(INPUT_POST, 'dateStart', FILTER_UNSAFE_RAW);\n    $dateEnd = Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_UNSAFE_RAW);\n    $header = Filter::filterInput(INPUT_POST, 'newsheader', FILTER_UNSAFE_RAW);\n    $content = Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = Filter::filterInput(INPUT_POST, 'authorName', FILTER_UNSAFE_RAW);\n    $email = Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = Filter::filterInput(INPUT_POST, 'active', FILTER_UNSAFE_RAW);\n    $comment = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n    $link = Filter::filterInput(INPUT_POST, 'link', FILTER_UNSAFE_RAW);\n    $linkTitle = Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_UNSAFE_RAW);\n    $newsLang = Filter::filterInput(INPUT_POST, 'langTo', FILTER_UNSAFE_RAW);\n    $target = Filter::filterInput(INPUT_POST, 'target', FILTER_UNSAFE_RAW);\n\n    $newsData = [\n        'lang' => $newsLang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart) . '000000',\n        'dateEnd' => (empty($dateEnd)) ? '99991231235959' : str_replace('-', '', $dateEnd) . '235959',\n        'link' => $link,\n        'linkTitle' => $linkTitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    ];\n\n    $newsId = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n    if ($news->updateNewsEntry((int) $newsId, $newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_updatefail']);\n    }\n    printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n    <?php\n} elseif ('delete-news' == $action && $user->perm->hasPermission($user->getUserId(), 'delnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $precheck = Filter::filterInput(INPUT_POST, 'really', FILTER_UNSAFE_RAW, 'no');\n    $deleteId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n\n    if ('no' == $precheck) {\n        ?>\n    <div class=\"form-group row\"><?= $PMF_LANG['ad_news_del'];\n    ?></div>\n    <div class=\"text-center\">\n    <form action=\"?action=delete-news\" method=\"post\" accept-charset=\"utf-8\">\n    <input type=\"hidden\" name=\"id\" value=\"<?= $deleteId ?>\">\n    <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n    <input type=\"hidden\" name=\"really\" value=\"yes\">\n        <button class=\"btn btn-warning\" type=\"submit\" name=\"submit\">\n            <?= $PMF_LANG['ad_news_yesdelete'];\n            ?>\n        </button>\n        <a class=\"btn btn-inverse\" onclick=\"history.back();\">\n            <?= $PMF_LANG['ad_news_nodelete'];\n            ?>\n        </a>\n    </form>\n    </div>\n    \n        <?php\n    } else {\n        if ($csrfCheck) {\n            $deleteId = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n            $news->deleteNews((int)$deleteId);\n            printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_delsuc']);\n            printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n        }\n    }\n} else {\n    echo $PMF_LANG['err_NotAuth'];\n}\n", "<?php\n\n/**\n * The News class for phpMyFAQ news.\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@scaramuccia.com>\n * @copyright 2006-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2006-06-25\n */\n\nnamespace phpMyFAQ;\n\nuse Exception;\n\n/**\n * Class News\n *\n * @package phpMyFAQ\n */\nclass News\n{\n    /**\n     * @var Configuration\n     */\n    private Configuration $config;\n\n    /**\n     * Language strings.\n     *\n     * @var array<string>\n     */\n    private $pmfLang;\n\n    /**\n     * Constructor.\n     *\n     * @param Configuration $config\n     */\n    public function __construct(Configuration $config)\n    {\n        global $PMF_LANG;\n\n        $this->config = $config;\n        $this->pmfLang = $PMF_LANG;\n    }\n\n    /**\n     * Function for generating the HTML5 code for the current news.\n     *\n     * @param bool $showArchive Show archived news\n     * @param bool $active Show active news\n     * @return string\n     * @throws Exception\n     */\n    public function getNews(bool $showArchive = false, bool $active = true): string\n    {\n        $output = '';\n        $news = $this->getLatestData($showArchive, $active);\n        $date = new Date($this->config);\n\n        foreach ($news as $item) {\n            $url = sprintf(\n                '%sindex.php?action=news&amp;newsid=%d&amp;newslang=%s',\n                $this->config->getDefaultUrl(),\n                $item['id'],\n                $item['lang']\n            );\n\n            $oLink = new Link($url, $this->config);\n\n            if (isset($item['header'])) {\n                $oLink->itemTitle = Strings::htmlentities($item['header']);\n            }\n\n            $output .= sprintf(\n                '<h6%s><a id=\"news_%d\" href=\"%s\">%s <i aria-hidden=\"true\" class=\"fa fa-caret-right\"></i></a></h6>',\n                ' class=\"pmf-news-heading\"',\n                $item['id'],\n                Strings::htmlentities($oLink->toString()),\n                Strings::htmlentities($item['header'])\n            );\n\n            $output .= sprintf('%s', $item['content']);\n\n            if (strlen($item['link']) > 1) {\n                $output .= sprintf(\n                    '<br>%s <a href=\"%s\" target=\"_%s\">%s</a>',\n                    $this->pmfLang['msgInfo'],\n                    Strings::htmlentities($item['link']),\n                    $item['target'],\n                    $item['linkTitle']\n                );\n            }\n\n            $output .= sprintf('<small class=\"text-muted\">%s</small>', $date->format($item['date']));\n        }\n\n        return ('' == $output) ? $this->pmfLang['msgNoNews'] : $output;\n    }\n\n    /**\n     * Return the latest news data.\n     *\n     * @param bool $showArchive Show archived news\n     * @param bool $active Show active news\n     * @param bool $forceConfLimit Force to limit in configuration\n     * @return array<int, array<mixed>>\n     */\n    public function getLatestData($showArchive = false, $active = true, $forceConfLimit = false): array\n    {\n        $news = [];\n        $counter = 0;\n        $now = date('YmdHis');\n\n        $query = sprintf(\n            \"\n            SELECT\n                *\n            FROM\n                %sfaqnews\n            WHERE\n                date_start <= '%s'\n            AND \n                date_end   >= '%s'\n            %s\n            AND\n                lang = '%s'\n            ORDER BY\n                datum DESC\",\n            Database::getTablePrefix(),\n            $now,\n            $now,\n            $active ? \"AND active = 'y'\" : '',\n            $this->config->getLanguage()->getLanguage()\n        );\n\n        $result = $this->config->getDb()->query($query);\n        $numberOfShownNewsEntries = $this->config->get('records.numberOfShownNewsEntries');\n        if ($numberOfShownNewsEntries > 0 && $this->config->getDb()->numRows($result) > 0) {\n            while (($row = $this->config->getDb()->fetchObject($result))) {\n                ++$counter;\n                if (\n                    ($showArchive && ($counter > $numberOfShownNewsEntries)) ||\n                    ((!$showArchive) && (!$forceConfLimit) && ($counter <= $numberOfShownNewsEntries)) ||\n                    ((!$showArchive) && $forceConfLimit)\n                ) {\n                    $url = sprintf(\n                        '%sindex.php?action=news&amp;newsid=%d&amp;newslang=%s',\n                        $this->config->getDefaultUrl(),\n                        $row->id,\n                        $row->lang\n                    );\n                    $oLink = new Link($url, $this->config);\n                    $oLink->itemTitle = $row->header;\n\n                    $item = [\n                        'id' => (int)$row->id,\n                        'lang' => $row->lang,\n                        'date' => Date::createIsoDate($row->datum, DATE_ISO8601, true),\n                        'header' => $row->header,\n                        'content' => $row->artikel,\n                        'authorName' => $row->author_name,\n                        'authorEmail' => $row->author_email,\n                        'dateStart' => $row->date_start,\n                        'dateEnd' => $row->date_end,\n                        'active' => ('y' == $row->active),\n                        'allowComments' => ('y' == $row->comment),\n                        'link' => $row->link,\n                        'linkTitle' => $row->linktitel,\n                        'target' => $row->target,\n                        'url' => $oLink->toString()\n                    ];\n                    $news[] = $item;\n                }\n            }\n        }\n\n        return $news;\n    }\n\n    /**\n     * Fetches all news headers.\n     *\n     * @return array<mixed>\n     */\n    public function getNewsHeader(): array\n    {\n        $headers = [];\n        $now = date('YmdHis');\n\n        $query = sprintf(\"\n            SELECT\n                id, datum, lang, header, active, date_start, date_end\n            FROM\n                %sfaqnews\n            WHERE\n                lang = '%s'\n            ORDER BY\n                datum DESC\", Database::getTablePrefix(), $this->config->getLanguage()->getLanguage());\n\n        $result = $this->config->getDb()->query($query);\n\n        if ($this->config->getDb()->numRows($result) > 0) {\n            while ($row = $this->config->getDb()->fetchObject($result)) {\n                $expired = ($now > $row->date_end);\n                $headers[] = array(\n                    'id' => $row->id,\n                    'lang' => $row->lang,\n                    'header' => $row->header,\n                    'date' => Date::createIsoDate($row->datum),\n                    'active' => $row->active,\n                    'expired' => $expired,\n                );\n            }\n        }\n\n        return $headers;\n    }\n\n    /**\n     * Fetches a news entry identified by its ID.\n     *\n     * @param int  $id ID of news\n     * @param bool $admin Is admin\n     * @return array<mixed>\n     */\n    public function getNewsEntry($id, $admin = false): array\n    {\n        $news = [];\n\n        $query = sprintf(\"SELECT\n                *\n            FROM\n                %sfaqnews\n            WHERE\n                id = %d\n            AND\n                lang = '%s'\", Database::getTablePrefix(), $id, $this->config->getLanguage()->getLanguage());\n\n        $result = $this->config->getDb()->query($query);\n\n        if ($this->config->getDb()->numRows($result) > 0) {\n            if ($row = $this->config->getDb()->fetchObject($result)) {\n                $content = $row->artikel;\n                $active = ('y' == $row->active);\n                $allowComments = ('y' == $row->comment);\n                $expired = (date('YmdHis') > $row->date_end);\n\n                if (!$admin) {\n                    if (!$active) {\n                        $content = $this->pmfLang['err_inactiveNews'];\n                    }\n                    if ($expired) {\n                        $content = $this->pmfLang['err_expiredNews'];\n                    }\n                }\n\n                $news = array(\n                    'id' => $row->id,\n                    'lang' => $row->lang,\n                    'date' => Date::createIsoDate($row->datum),\n                    'header' => $row->header,\n                    'content' => $content,\n                    'authorName' => $row->author_name,\n                    'authorEmail' => $row->author_email,\n                    'dateStart' => $row->date_start,\n                    'dateEnd' => $row->date_end,\n                    'active' => $active,\n                    'allowComments' => $allowComments,\n                    'link' => $row->link,\n                    'linkTitle' => $row->linktitel,\n                    'target' => $row->target,\n                );\n            }\n        }\n\n        return $news;\n    }\n\n    /**\n     * Adds a new news entry.\n     *\n     * @param array<mixed> $data Array with news data\n     * @return bool\n     */\n    public function addNewsEntry(array $data): bool\n    {\n        $query = sprintf(\n            \"\n            INSERT INTO\n                %sfaqnews\n            (id, datum, lang, header, artikel, author_name, author_email, date_start, date_end, active, comment,\n            link, linktitel, target)\n                VALUES\n            (%d, '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')\",\n            Database::getTablePrefix(),\n            $this->config->getDb()->nextId(Database::getTablePrefix() . 'faqnews', 'id'),\n            $data['date'],\n            $data['lang'],\n            $this->config->getDb()->escape($data['header']),\n            $this->config->getDb()->escape($data['content']),\n            $this->config->getDb()->escape($data['authorName']),\n            $data['authorEmail'],\n            $data['dateStart'],\n            $data['dateEnd'],\n            $data['active'],\n            $data['comment'],\n            $this->config->getDb()->escape($data['link']),\n            $this->config->getDb()->escape($data['linkTitle']),\n            $data['target']\n        );\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Updates a new news entry identified by its ID.\n     *\n     * @param int          $id News ID\n     * @param array<mixed> $data Array with news data\n     * @return bool\n     */\n    public function updateNewsEntry(int $id, array $data): bool\n    {\n        $query = sprintf(\n            \"\n            UPDATE\n                %sfaqnews\n            SET\n                datum = '%s',\n                lang = '%s',\n                header = '%s',\n                artikel = '%s',\n                author_name = '%s',\n                author_email = '%s',\n                date_start = '%s',\n                date_end = '%s',\n                active = '%s',\n                comment = '%s',\n                link = '%s',\n                linktitel = '%s',\n                target = '%s'\n            WHERE\n                id = %d\",\n            Database::getTablePrefix(),\n            $data['date'],\n            $data['lang'],\n            $this->config->getDb()->escape($data['header']),\n            $this->config->getDb()->escape($data['content']),\n            $this->config->getDb()->escape($data['authorName']),\n            $data['authorEmail'],\n            $data['dateStart'],\n            $data['dateEnd'],\n            $data['active'],\n            $data['comment'],\n            $this->config->getDb()->escape($data['link']),\n            $this->config->getDb()->escape($data['linkTitle']),\n            $data['target'],\n            $id\n        );\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Deletes a news entry identified by its ID.\n     *\n     * @param int $id News ID\n     * @return bool\n     * @todo   check if there are comments attached to the deleted news\n     */\n    public function deleteNews($id): bool\n    {\n        $query = sprintf(\"DELETE FROM\n                %sfaqnews\n            WHERE\n                id = %d\n            AND\n                lang = '%s'\", Database::getTablePrefix(), $id, $this->config->getLanguage()->getLanguage());\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n}\n"], "fixing_code": ["<?php\n\n/**\n * The main administration file for the news.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2003-02-23\n */\n\nuse phpMyFAQ\\Comments;\nuse phpMyFAQ\\Date;\nuse phpMyFAQ\\Entity\\CommentType;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Helper\\LanguageHelper;\nuse phpMyFAQ\\News;use phpMyFAQ\\Strings;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n$news = new News($faqConfig);\n\n$csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\nif (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n    $csrfCheck = false;\n} else {\n    $csrfCheck = true;\n}\n\nif ('add-news' == $action && $user->perm->hasPermission($user->getUserId(), 'addnews')) { ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_add'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <form id=\"faqEditor\" name=\"faqEditor\" action=\"?action=save-news\" method=\"post\" class=\"needs-validation\"\n                      novalidate>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"newsheader\">\n                            <?= $PMF_LANG['ad_news_header'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"text\" name=\"newsheader\" id=\"newsheader\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"news\"><?= $PMF_LANG['ad_news_text'] ?>:</label>\n                        <div class=\"col-9\">\n                            <textarea name=\"news\" rows=\"5\" class=\"form-control\" id=\"news\"></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorName\">\n                        <?= $PMF_LANG['ad_news_author_name'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"text\" name=\"authorName\" id=\"authorName\"\n                                   value=\"<?= $user->getUserData('display_name') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorEmail\">\n                        <?= $PMF_LANG['ad_news_author_email'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"email\" name=\"authorEmail\" id=\"authorEmail\"\n                                   value=\"<?= $user->getUserData('email') ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"active\">\n                            <?= $PMF_LANG['ad_news_set_active'] ?>:\n                        </label>\n                        <div class=\"col-9 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\">\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"comment\">\n                        <?= $PMF_LANG['ad_news_allowComments'] ?>\n                        </label>\n                        <div class=\"col-9 checkbox\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\">\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"link\"><?= $PMF_LANG['ad_news_link_url'] ?></label>\n                        <div class=\"col-9\">\n                            <input class=\"form-control\" type=\"url\" name=\"link\" id=\"link\"\n                            placeholder=\"http://www.example.com/\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"linkTitle\">\n                        <?= $PMF_LANG['ad_news_link_title'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"linkTitle\" id=\"linkTitle\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" ><?= $PMF_LANG['ad_news_link_target'] ?></label>\n                        <div class=\"col-9 radio\">\n                            <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\">\n                                <?= $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\">\n                                <?= $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\">\n                                <?= $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"langTo\"><?= $PMF_LANG['ad_entry_locale'] ?>:</label>\n                        <div class=\"col-9\">\n                            <?= LanguageHelper::renderSelectLanguage($faqLangCode, false, [], 'langTo') ?>\n                        </div>\n                    </div>\n\n                    <legend><?= $PMF_LANG['ad_news_expiration_window'] ?></legend>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateStart\"><?= $PMF_LANG['ad_news_from'] ?></label>\n                        <div class=\"col-3\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateEnd\"><?= $PMF_LANG['ad_news_to'] ?></label>\n                        <div class=\"col-3\">\n                            <input type=\"date\" name=\"dateEnd\" id=\"dateEnd\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                      <div class=\"col-12\">\n                        <div class=\"btn-group float-right mt-2\" role=\"group\">\n                          <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?= $PMF_LANG['ad_entry_back'] ?>\n                          </a>\n                          <button class=\"btn btn-primary\" type=\"submit\">\n                            <?= $PMF_LANG['ad_news_add'] ?>\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n    <?php\n} elseif ('news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    ?>\n         <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n              <?= $PMF_LANG['msgNews'] ?>\n          </h1>\n          <div class=\"btn-toolbar mb-2 mb-md-0\">\n            <div class=\"btn-group mr-2\">\n              <a href=\"?action=add-news\">\n                  <button class=\"btn btn-sm     btn-success\">\n                    <i aria-hidden=\"true\" class=\"fa fa-plus\"></i> <?= $PMF_LANG['ad_menu_news_add'] ?>\n                  </button>\n              </a>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <table class=\"table table-hover\">\n                <thead class=\"thead-dark\">\n                    <tr>\n                        <th><?= $PMF_LANG['ad_news_headline'] ?></th>\n                        <th><?= $PMF_LANG['ad_news_date'] ?></th>\n                        <th colspan=\"2\">&nbsp;</th>\n                    </tr>\n                </thead>\n                <tbody>\n    <?php\n    $newsHeader = $news->getNewsHeader();\n    $date = new Date($faqConfig);\n    if (count($newsHeader)) {\n        foreach ($newsHeader as $newsItem) {\n            ?>\n                    <tr>\n                        <td><?= Strings::htmlentities($newsItem['header']) ?></td>\n                        <td><?= $date->format($newsItem['date']) ?></td>\n                        <td>\n                            <a class=\"btn btn-primary\" href=\"?action=edit-news&amp;id=<?= $newsItem['id'] ?>\">\n                                <span title=\"<?= $PMF_LANG['ad_news_update'] ?>\" class=\"fa fa-edit\"></span>\n                            </a>\n                        </td>\n                        <td>\n                            <a class=\"btn btn-danger\" href=\"?action=delete-news&amp;id=<?= $newsItem['id'] ?>\">\n                                <span title=\"<?= $PMF_LANG['ad_news_delete'] ?>\" class=\"fa fa-trash\"></span>\n                            </a>\n                        </td>\n                    </tr>\n            <?php\n        }\n    } else {\n        printf(\n            '<tr><td colspan=\"3\">%s</td></tr>',\n            $PMF_LANG['ad_news_nodata']\n        );\n    }\n    ?>\n                </tbody>\n                </table>\n            </div>\n        </div>\n    <?php\n} elseif ('edit-news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    $id = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $newsData = $news->getNewsEntry($id, true);\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_edit'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <form action=\"?action=update-news\" method=\"post\" accept-charset=\"utf-8\" class=\"needs-validation\"\n                      novalidate>\n                    <input type=\"hidden\" name=\"id\" value=\"<?= $newsData['id'] ?>\">\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"newsheader\"><?= $PMF_LANG['ad_news_header'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"newsheader\" id=\"newsheader\" class=\"form-control\"\n                                   value=\"<?= Strings::htmlentities($newsData['header']) ?? '' ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"news\"><?= $PMF_LANG['ad_news_text'] ?>:</label>\n                        <div class=\"col-9\">\n                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>\n                            <textarea id=\"news\" name=\"news\" class=\"form-control\" rows=\"5\"><?php\n                            if (isset($newsData['content'])) {\n                                echo htmlspecialchars($newsData['content'], ENT_QUOTES);\n                            } ?></textarea>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorName\">\n                        <?= $PMF_LANG['ad_news_author_name'] ?>\n                        </label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" name=\"authorName\" class=\"form-control\"\n                                value=\"<?= Strings::htmlentities($newsData['authorName']) ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"authorEmail\"><?= $PMF_LANG['ad_news_author_email'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"email\" name=\"authorEmail\" class=\"form-control\"\n                                value=\"<?= Strings::htmlentities($newsData['authorEmail']) ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"active\">\n                            <?= $PMF_LANG['ad_news_set_active'] ?>:\n                        </label>\n                        <div class=\"col-9\">\n                            <label>\n                                <input type=\"checkbox\" name=\"active\" id=\"active\" value=\"y\"\n                                    <?php if (isset($newsData['active']) && $newsData['active']) {\n                                        echo ' checked';\n                                    } ?>\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"comment\"><?= $PMF_LANG['ad_news_allowComments'] ?></label>\n                        <div class=\"col-9\">\n                            <label>\n                                <input type=\"checkbox\" name=\"comment\" id=\"comment\" value=\"y\"\n                                <?php if (isset($newsData['allowComments']) && $newsData['allowComments']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_gen_yes'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"link\"><?= $PMF_LANG['ad_news_link_url'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"url\" id=\"link\" name=\"link\"\n                            value=\"<?= Strings::htmlentities($newsData['link']) ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"linkTitle\"><?= $PMF_LANG['ad_news_link_title'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"text\" id=\"linkTitle\" name=\"linkTitle\"\n                            value=\"<?= Strings::htmlentities($newsData['linkTitle']) ?>\" class=\"form-control\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"target\"><?= $PMF_LANG['ad_news_link_target'] ?></label>\n                        <div class=\"col-9\">\n                        <label>\n                                <input type=\"radio\" name=\"target\" value=\"blank\"\n                                <?php if ('blank' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_window'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"self\"\n                                <?php if ('self' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_faq'] ?>\n                                <br>\n                                <input type=\"radio\" name=\"target\" value=\"parent\"\n                                <?php if ('parent' == $newsData['target']) {\n                                    echo ' checked';\n                                } ?>>\n                                <?= $PMF_LANG['ad_news_link_parent'] ?>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"langTo\"><?= $PMF_LANG['ad_entry_locale'] ?>:</label>\n                        <div class=\"col-9\">\n                        <?= LanguageHelper::renderSelectLanguage($newsData['lang'], false, [], 'langTo') ?>\n                        </div>\n                    </div>\n    <?php\n    $dateStart = ($newsData['dateStart'] != '00000000000000' ? Date::createIsoDate($newsData['dateStart'], 'Y-m-d') : '');\n    $dateEnd = ($newsData['dateEnd'] != '99991231235959' ? Date::createIsoDate($newsData['dateEnd'], 'Y-m-d') : '');\n    ?>\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateStart\"><?= $PMF_LANG['ad_news_from'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"date\" name=\"dateStart\" id=\"dateStart\" class=\"form-control\" value=\"<?= $dateStart ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label class=\"col-3 col-form-label\" for=\"dateEnd\"><?= $PMF_LANG['ad_news_to'] ?></label>\n                        <div class=\"col-9\">\n                            <input type=\"date\"  name=\"dateEnd\" id=\"dateEnd\" class=\"form-control\" value=\"<?= $dateEnd ?>\">\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                      <div class=\"col-12\">\n                        <div class=\"btn-group float-right mt-2\" role=\"group\">\n                          <button class=\"btn btn-primary\" type=\"submit\">\n                            <?= $PMF_LANG['ad_news_edit'] ?>\n                          </button>\n                          <a class=\"btn btn-info\" href=\"?action=news\">\n                            <?= $PMF_LANG['ad_entry_back'] ?>\n                          </a>\n                        </div>\n                      </div>\n                    </div>\n                </form>\n    <?php\n    $newsId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n    $oComment = new Comments($faqConfig);\n    $comments = $oComment->getCommentsData($newsId, CommentType::NEWS);\n    if (count($comments) > 0) {\n        ?>\n                <div class=\"form-group row\"><strong><?= $PMF_LANG['ad_entry_comment'] ?></strong></div>\n        <?php\n    }\n    foreach ($comments as $item) {\n        ?>\n                <div class=\"form-group row\">\n                    <?= $PMF_LANG['ad_entry_commentby'] ?>\n                    <a href=\"mailto:<?= $item->email ?>\">\n                        <?= $item->username ?>\n                    </a>:<br>\n                    <?= $item->comment ?><br>\n                    <?= $PMF_LANG['newsCommentDate'] . Date::createIsoDate((int)$item->date, 'Y-m-d H:i', false) ?>\n                    <a href=\"?action=delcomment&artid=<?= $newsId ?>&cmtid=<?= $item->id ?>&type=<?= CommentType::NEWS ?>\">\n                        <i aria-hidden=\"true\" class=\"fa fa-trash\"></i>\n                    </a>\n                </div>\n            </div>\n        </div>\n        <?php\n    }\n} elseif ('save-news' == $action && $user->perm->hasPermission($user->getUserId(), 'addnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $dateStart = Filter::filterInput(INPUT_POST, 'dateStart', FILTER_UNSAFE_RAW);\n    $dateEnd = Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_UNSAFE_RAW);\n    $header = Filter::filterInput(INPUT_POST, 'newsheader', FILTER_SANITIZE_SPECIAL_CHARS);\n    $content = Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = Filter::filterInput(INPUT_POST, 'authorName', FILTER_UNSAFE_RAW);\n    $email = Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = Filter::filterInput(INPUT_POST, 'active', FILTER_UNSAFE_RAW);\n    $comment = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n    $link = Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linkTitle = Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_ENCODED);\n    $newsLang = Filter::filterInput(INPUT_POST, 'langTo', FILTER_UNSAFE_RAW);\n    $target = Filter::filterInput(INPUT_POST, 'target', FILTER_UNSAFE_RAW);\n\n    $newsData = array(\n        'lang' => $newsLang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart) . '000000',\n        'dateEnd' => (empty($dateEnd)) ? '99991231235959' : str_replace('-', '', $dateEnd) . '235959',\n        'link' => $link,\n        'linkTitle' => $linkTitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    );\n\n    if ($news->addNewsEntry($newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_insertfail']);\n    }\n    printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n    <?php\n} elseif ('update-news' == $action && $user->perm->hasPermission($user->getUserId(), 'editnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $dateStart = Filter::filterInput(INPUT_POST, 'dateStart', FILTER_UNSAFE_RAW);\n    $dateEnd = Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_UNSAFE_RAW);\n    $header = Filter::filterInput(INPUT_POST, 'newsheader', FILTER_UNSAFE_RAW);\n    $content = Filter::filterInput(INPUT_POST, 'news', FILTER_SANITIZE_SPECIAL_CHARS);\n    $author = Filter::filterInput(INPUT_POST, 'authorName', FILTER_UNSAFE_RAW);\n    $email = Filter::filterInput(INPUT_POST, 'authorEmail', FILTER_VALIDATE_EMAIL);\n    $active = Filter::filterInput(INPUT_POST, 'active', FILTER_UNSAFE_RAW);\n    $comment = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n    $link = Filter::filterInput(INPUT_POST, 'link', FILTER_VALIDATE_URL);\n    $linkTitle = Filter::filterInput(INPUT_POST, 'linkTitle', FILTER_SANITIZE_ENCODED);\n    $newsLang = Filter::filterInput(INPUT_POST, 'langTo', FILTER_UNSAFE_RAW);\n    $target = Filter::filterInput(INPUT_POST, 'target', FILTER_UNSAFE_RAW);\n\n    $newsData = [\n        'lang' => $newsLang,\n        'header' => $header,\n        'content' => html_entity_decode($content),\n        'authorName' => $author,\n        'authorEmail' => $email,\n        'active' => (is_null($active)) ? 'n' : 'y',\n        'comment' => (is_null($comment)) ? 'n' : 'y',\n        'dateStart' => (empty($dateStart)) ? '00000000000000' : str_replace('-', '', $dateStart) . '000000',\n        'dateEnd' => (empty($dateEnd)) ? '99991231235959' : str_replace('-', '', $dateEnd) . '235959',\n        'link' => $link,\n        'linkTitle' => $linkTitle,\n        'date' => date('YmdHis'),\n        'target' => (is_null($target)) ? '' : $target,\n    ];\n\n    $newsId = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n    if ($news->updateNewsEntry((int) $newsId, $newsData)) {\n        printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_updatesuc']);\n    } else {\n        printf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_news_updatefail']);\n    }\n    printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n    ?>\n            </div>\n        </div>\n    <?php\n} elseif ('delete-news' == $action && $user->perm->hasPermission($user->getUserId(), 'delnews')) {\n    ?>\n        <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n          <h1 class=\"h2\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n            <?= $PMF_LANG['ad_news_data'] ?>\n          </h1>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-12\">\n    <?php\n    $precheck = Filter::filterInput(INPUT_POST, 'really', FILTER_UNSAFE_RAW, 'no');\n    $deleteId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n\n    if ('no' == $precheck) {\n        ?>\n    <div class=\"form-group row\"><?= $PMF_LANG['ad_news_del'];\n    ?></div>\n    <div class=\"text-center\">\n    <form action=\"?action=delete-news\" method=\"post\" accept-charset=\"utf-8\">\n    <input type=\"hidden\" name=\"id\" value=\"<?= $deleteId ?>\">\n    <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n    <input type=\"hidden\" name=\"really\" value=\"yes\">\n        <button class=\"btn btn-warning\" type=\"submit\" name=\"submit\">\n            <?= $PMF_LANG['ad_news_yesdelete'];\n            ?>\n        </button>\n        <a class=\"btn btn-inverse\" onclick=\"history.back();\">\n            <?= $PMF_LANG['ad_news_nodelete'];\n            ?>\n        </a>\n    </form>\n    </div>\n    \n        <?php\n    } else {\n        if ($csrfCheck) {\n            $deleteId = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);\n            $news->deleteNews((int)$deleteId);\n            printf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_news_delsuc']);\n            printf('<div class=\"form-group row\">&rarr; <a href=\"?action=news\">%s</a></p>', $PMF_LANG['msgNews']);\n        }\n    }\n} else {\n    echo $PMF_LANG['err_NotAuth'];\n}\n", "<?php\n\n/**\n * The News class for phpMyFAQ news.\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Matteo Scaramuccia <matteo@scaramuccia.com>\n * @copyright 2006-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2006-06-25\n */\n\nnamespace phpMyFAQ;\n\nuse Exception;\n\n/**\n * Class News\n *\n * @package phpMyFAQ\n */\nclass News\n{\n    /**\n     * @var Configuration\n     */\n    private Configuration $config;\n\n    /**\n     * Language strings.\n     *\n     * @var array<string>\n     */\n    private $pmfLang;\n\n    /**\n     * Constructor.\n     *\n     * @param Configuration $config\n     */\n    public function __construct(Configuration $config)\n    {\n        global $PMF_LANG;\n\n        $this->config = $config;\n        $this->pmfLang = $PMF_LANG;\n    }\n\n    /**\n     * Function for generating the HTML5 code for the current news.\n     *\n     * @param bool $showArchive Show archived news\n     * @param bool $active Show active news\n     * @return string\n     * @throws Exception\n     */\n    public function getNews(bool $showArchive = false, bool $active = true): string\n    {\n        $output = '';\n        $news = $this->getLatestData($showArchive, $active);\n        $date = new Date($this->config);\n\n        foreach ($news as $item) {\n            $url = sprintf(\n                '%sindex.php?action=news&amp;newsid=%d&amp;newslang=%s',\n                $this->config->getDefaultUrl(),\n                $item['id'],\n                $item['lang']\n            );\n\n            $oLink = new Link($url, $this->config);\n\n            if (isset($item['header'])) {\n                $oLink->itemTitle = Strings::htmlentities($item['header']);\n            }\n\n            $output .= sprintf(\n                '<h6%s><a id=\"news_%d\" href=\"%s\">%s <i aria-hidden=\"true\" class=\"fa fa-caret-right\"></i></a></h6>',\n                ' class=\"pmf-news-heading\"',\n                $item['id'],\n                Strings::htmlentities($oLink->toString()),\n                Strings::htmlentities($item['header'])\n            );\n\n            $output .= sprintf('%s', $item['content']);\n\n            if (strlen($item['link']) > 1) {\n                $output .= sprintf(\n                    '<br>%s <a href=\"%s\" target=\"_%s\">%s</a>',\n                    $this->pmfLang['msgInfo'],\n                    Strings::htmlentities($item['link']),\n                    $item['target'],\n                    Strings::htmlentities($item['linkTitle'])\n                );\n            }\n\n            $output .= sprintf('<small class=\"text-muted\">%s</small>', $date->format($item['date']));\n        }\n\n        return ('' == $output) ? $this->pmfLang['msgNoNews'] : $output;\n    }\n\n    /**\n     * Return the latest news data.\n     *\n     * @param bool $showArchive Show archived news\n     * @param bool $active Show active news\n     * @param bool $forceConfLimit Force to limit in configuration\n     * @return array<int, array<mixed>>\n     */\n    public function getLatestData($showArchive = false, $active = true, $forceConfLimit = false): array\n    {\n        $news = [];\n        $counter = 0;\n        $now = date('YmdHis');\n\n        $query = sprintf(\n            \"\n            SELECT\n                *\n            FROM\n                %sfaqnews\n            WHERE\n                date_start <= '%s'\n            AND \n                date_end   >= '%s'\n            %s\n            AND\n                lang = '%s'\n            ORDER BY\n                datum DESC\",\n            Database::getTablePrefix(),\n            $now,\n            $now,\n            $active ? \"AND active = 'y'\" : '',\n            $this->config->getLanguage()->getLanguage()\n        );\n\n        $result = $this->config->getDb()->query($query);\n        $numberOfShownNewsEntries = $this->config->get('records.numberOfShownNewsEntries');\n        if ($numberOfShownNewsEntries > 0 && $this->config->getDb()->numRows($result) > 0) {\n            while (($row = $this->config->getDb()->fetchObject($result))) {\n                ++$counter;\n                if (\n                    ($showArchive && ($counter > $numberOfShownNewsEntries)) ||\n                    ((!$showArchive) && (!$forceConfLimit) && ($counter <= $numberOfShownNewsEntries)) ||\n                    ((!$showArchive) && $forceConfLimit)\n                ) {\n                    $url = sprintf(\n                        '%sindex.php?action=news&amp;newsid=%d&amp;newslang=%s',\n                        $this->config->getDefaultUrl(),\n                        $row->id,\n                        $row->lang\n                    );\n                    $oLink = new Link($url, $this->config);\n                    $oLink->itemTitle = $row->header;\n\n                    $item = [\n                        'id' => (int)$row->id,\n                        'lang' => $row->lang,\n                        'date' => Date::createIsoDate($row->datum, DATE_ISO8601, true),\n                        'header' => $row->header,\n                        'content' => $row->artikel,\n                        'authorName' => $row->author_name,\n                        'authorEmail' => $row->author_email,\n                        'dateStart' => $row->date_start,\n                        'dateEnd' => $row->date_end,\n                        'active' => ('y' == $row->active),\n                        'allowComments' => ('y' == $row->comment),\n                        'link' => $row->link,\n                        'linkTitle' => $row->linktitel,\n                        'target' => $row->target,\n                        'url' => $oLink->toString()\n                    ];\n                    $news[] = $item;\n                }\n            }\n        }\n\n        return $news;\n    }\n\n    /**\n     * Fetches all news headers.\n     *\n     * @return array<mixed>\n     */\n    public function getNewsHeader(): array\n    {\n        $headers = [];\n        $now = date('YmdHis');\n\n        $query = sprintf(\"\n            SELECT\n                id, datum, lang, header, active, date_start, date_end\n            FROM\n                %sfaqnews\n            WHERE\n                lang = '%s'\n            ORDER BY\n                datum DESC\", Database::getTablePrefix(), $this->config->getLanguage()->getLanguage());\n\n        $result = $this->config->getDb()->query($query);\n\n        if ($this->config->getDb()->numRows($result) > 0) {\n            while ($row = $this->config->getDb()->fetchObject($result)) {\n                $expired = ($now > $row->date_end);\n                $headers[] = array(\n                    'id' => $row->id,\n                    'lang' => $row->lang,\n                    'header' => $row->header,\n                    'date' => Date::createIsoDate($row->datum),\n                    'active' => $row->active,\n                    'expired' => $expired,\n                );\n            }\n        }\n\n        return $headers;\n    }\n\n    /**\n     * Fetches a news entry identified by its ID.\n     *\n     * @param int  $id ID of news\n     * @param bool $admin Is admin\n     * @return array<mixed>\n     */\n    public function getNewsEntry($id, $admin = false): array\n    {\n        $news = [];\n\n        $query = sprintf(\"SELECT\n                *\n            FROM\n                %sfaqnews\n            WHERE\n                id = %d\n            AND\n                lang = '%s'\", Database::getTablePrefix(), $id, $this->config->getLanguage()->getLanguage());\n\n        $result = $this->config->getDb()->query($query);\n\n        if ($this->config->getDb()->numRows($result) > 0) {\n            if ($row = $this->config->getDb()->fetchObject($result)) {\n                $content = $row->artikel;\n                $active = ('y' == $row->active);\n                $allowComments = ('y' == $row->comment);\n                $expired = (date('YmdHis') > $row->date_end);\n\n                if (!$admin) {\n                    if (!$active) {\n                        $content = $this->pmfLang['err_inactiveNews'];\n                    }\n                    if ($expired) {\n                        $content = $this->pmfLang['err_expiredNews'];\n                    }\n                }\n\n                $news = array(\n                    'id' => $row->id,\n                    'lang' => $row->lang,\n                    'date' => Date::createIsoDate($row->datum),\n                    'header' => $row->header,\n                    'content' => $content,\n                    'authorName' => $row->author_name,\n                    'authorEmail' => $row->author_email,\n                    'dateStart' => $row->date_start,\n                    'dateEnd' => $row->date_end,\n                    'active' => $active,\n                    'allowComments' => $allowComments,\n                    'link' => $row->link,\n                    'linkTitle' => $row->linktitel,\n                    'target' => $row->target,\n                );\n            }\n        }\n\n        return $news;\n    }\n\n    /**\n     * Adds a new news entry.\n     *\n     * @param array<mixed> $data Array with news data\n     * @return bool\n     */\n    public function addNewsEntry(array $data): bool\n    {\n        $query = sprintf(\n            \"\n            INSERT INTO\n                %sfaqnews\n            (id, datum, lang, header, artikel, author_name, author_email, date_start, date_end, active, comment,\n            link, linktitel, target)\n                VALUES\n            (%d, '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')\",\n            Database::getTablePrefix(),\n            $this->config->getDb()->nextId(Database::getTablePrefix() . 'faqnews', 'id'),\n            $data['date'],\n            $data['lang'],\n            $this->config->getDb()->escape($data['header']),\n            $this->config->getDb()->escape($data['content']),\n            $this->config->getDb()->escape($data['authorName']),\n            $data['authorEmail'],\n            $data['dateStart'],\n            $data['dateEnd'],\n            $data['active'],\n            $data['comment'],\n            $this->config->getDb()->escape($data['link']),\n            $this->config->getDb()->escape($data['linkTitle']),\n            $data['target']\n        );\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Updates a new news entry identified by its ID.\n     *\n     * @param int          $id News ID\n     * @param array<mixed> $data Array with news data\n     * @return bool\n     */\n    public function updateNewsEntry(int $id, array $data): bool\n    {\n        $query = sprintf(\n            \"\n            UPDATE\n                %sfaqnews\n            SET\n                datum = '%s',\n                lang = '%s',\n                header = '%s',\n                artikel = '%s',\n                author_name = '%s',\n                author_email = '%s',\n                date_start = '%s',\n                date_end = '%s',\n                active = '%s',\n                comment = '%s',\n                link = '%s',\n                linktitel = '%s',\n                target = '%s'\n            WHERE\n                id = %d\",\n            Database::getTablePrefix(),\n            $data['date'],\n            $data['lang'],\n            $this->config->getDb()->escape($data['header']),\n            $this->config->getDb()->escape($data['content']),\n            $this->config->getDb()->escape($data['authorName']),\n            $data['authorEmail'],\n            $data['dateStart'],\n            $data['dateEnd'],\n            $data['active'],\n            $data['comment'],\n            $this->config->getDb()->escape($data['link']),\n            $this->config->getDb()->escape($data['linkTitle']),\n            $data['target'],\n            $id\n        );\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Deletes a news entry identified by its ID.\n     *\n     * @param int $id News ID\n     * @return bool\n     * @todo   check if there are comments attached to the deleted news\n     */\n    public function deleteNews($id): bool\n    {\n        $query = sprintf(\"DELETE FROM\n                %sfaqnews\n            WHERE\n                id = %d\n            AND\n                lang = '%s'\", Database::getTablePrefix(), $id, $this->config->getLanguage()->getLanguage());\n\n        if (!$this->config->getDb()->query($query)) {\n            return false;\n        }\n\n        return true;\n    }\n}\n"], "filenames": ["phpmyfaq/admin/news.php", "phpmyfaq/src/phpMyFAQ/News.php"], "buggy_code_start_loc": [50, 98], "buggy_code_end_loc": [505, 99], "fixing_code_start_loc": [50, 98], "fixing_code_end_loc": [507, 99], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.12.", "other": {"cve": {"id": "CVE-2023-1757", "sourceIdentifier": "security@huntr.dev", "published": "2023-04-05T16:15:07.317", "lastModified": "2023-04-11T18:56:21.400", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.12."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 8.1, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.7, "impactScore": 5.8}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.1.12", "matchCriteriaId": "653EC167-06FC-4D30-AAF8-B75F596519AE"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/5061e5841be6c218ebb0de0cbf7b7f195dc46d19", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/584a200a-6ff8-4d53-a3c0-e7893edff60c", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/5061e5841be6c218ebb0de0cbf7b7f195dc46d19"}}