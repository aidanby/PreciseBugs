{"buggy_code": ["<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\ninclude('../../../inc/includes.php');\n\nSession::checkLoginUser();\n\nHtml::header_nocache();\nheader(\"Content-Type: text/html; charset=UTF-8\");\n\nif (isset($_POST['action']) && $_POST['action'] == 'viewFilter') {\n   if (isset($_POST['items_id'])\n       && isset($_POST[\"id\"])) {\n      $filter = new PluginAddressingFilter();\n      $filter->showForm($_POST[\"id\"], ['items_id' => $_POST['items_id']]);\n   } else {\n      echo __('Access denied');\n   }\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_networkip') {\n   IPNetwork::showIPNetworkProperties($_POST['entities_id']);\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_location') {\n   Dropdown::show('Location', ['name'   => \"locations_id\",\n                               'value'  => $_POST[\"value\"],\n                               'entity' => $_POST['entities_id']]);\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_fqdn') {\n   Dropdown::show('FQDN', ['name'   => \"fqdns_id\",\n                           'value'  => $_POST[\"value\"],\n                           'entity' => $_POST['entities_id']]);\n\n} else {\n   Html::popHeader(__s('IP reservation', 'addressing'), $_SERVER['PHP_SELF']);\n   $PluginAddressingReserveip = new PluginAddressingReserveip();\n   $PluginAddressingReserveip->showReservationForm($_GET[\"ip\"], $_GET['id_addressing'], $_GET['rand']);\n   Html::popFooter();\n}\n", "<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\n// ----------------------------------------------------------------------\n// Original Author of file: Alexandre DELAUNAY\n// Purpose of file:\n// ----------------------------------------------------------------------\n\n\ninclude('../../../inc/includes.php');\n\nheader(\"Content-Type: text/html; charset=UTF-8\");\nHtml::header_nocache();\n\nSession::checkLoginUser();\n\nif (!isset($_POST['ip'])) {\n   exit();\n}\n$ip = $_POST['ip'];\n$itemtype = $_POST['itemtype'];\n$items_id = $_POST['items_id'];\n\n$config = new PluginAddressingConfig();\n$config->getFromDB('1');\n$system = $config->fields[\"used_system\"];\n\n$ping_equip = new PluginAddressingPing_Equipment();\nlist($message, $error) = $ping_equip->ping($system, $ip);\n\n$plugin_addressing_pinginfo = new PluginAddressingPinginfo();\n\n$ping_value = $ping_equip->ping($system, $ip, \"true\");\n\n$id = 0;\n$ping_date = 0;\nif ($ping_value == false || $ping_value == true) {\n\n   $ping_date = $_SESSION['glpi_currenttime'];\n   if ($pings = $plugin_addressing_pinginfo->find(['itemtype' => $itemtype,\n      'items_id' => $items_id])) {\n      foreach ($pings as $ping) {\n         $id = $ping['id'];\n\n         $plugin_addressing_pinginfo->update(['id' => $id,\n            'ping_response' => $ping_value,\n            'ping_date' => $ping_date]);\n      }\n   } else {\n\n      $num = \"IP\".PluginAddressingReport::ip2string($ip);\n      $plugin_addressing_pinginfo->add(['ping_response' => $ping_value,\n         'ping_date' => $ping_date, 'itemtype' => $itemtype,\n         'items_id' => $items_id, 'ipname' => $num]);\n   }\n}\n\necho $ping_response = $message;\n\n", "<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\ninclude ('../../../inc/includes.php');\n\n$reserveip = new PluginAddressingReserveip();\n\nif (isset($_POST['add'])) {\n   $reserveip->check(-1, CREATE, $_POST);\n   $reserveip->reserveip($_POST);\n   Html::back();\n} else {\n   Html::header(PluginAddressingReserveip::getTypeName(), '', \"tools\", \"pluginaddressingmenu\");\n   $reserveip->showReservationForm($_REQUEST[\"ip\"], $_REQUEST[\"id_addressing\"], $_REQUEST['rand']);\n   Html::footer();\n}\n"], "fixing_code": ["<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\ninclude('../../../inc/includes.php');\n\nSession::checkLoginUser();\n\nHtml::header_nocache();\nheader(\"Content-Type: text/html; charset=UTF-8\");\n\nif (isset($_POST['action']) && $_POST['action'] == 'viewFilter') {\n   if (isset($_POST['items_id'])\n       && isset($_POST[\"id\"])) {\n      $filter = new PluginAddressingFilter();\n      $filter->showForm($_POST[\"id\"], ['items_id' => $_POST['items_id']]);\n   } else {\n      echo __('Access denied');\n   }\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_networkip') {\n   IPNetwork::showIPNetworkProperties($_POST['entities_id']);\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_location') {\n   Dropdown::show('Location', ['name'   => \"locations_id\",\n                               'value'  => $_POST[\"value\"],\n                               'entity' => $_POST['entities_id']]);\n\n} else if (isset($_POST['action']) && $_POST['action'] == 'entities_fqdn') {\n   Dropdown::show('FQDN', ['name'   => \"fqdns_id\",\n                           'value'  => $_POST[\"value\"],\n                           'entity' => $_POST['entities_id']]);\n\n} else {\n   Html::popHeader(__s('IP reservation', 'addressing'), $_SERVER['PHP_SELF']);\n   $PluginAddressingReserveip = new PluginAddressingReserveip();\n   if(filter_var($_GET[\"ip\"], FILTER_VALIDATE_IP)) {\n      $PluginAddressingReserveip->showReservationForm($_GET[\"ip\"], $_GET['id_addressing'], $_GET['rand']);\n   }\n\n   Html::popFooter();\n}\n", "<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\n// ----------------------------------------------------------------------\n// Original Author of file: Alexandre DELAUNAY\n// Purpose of file:\n// ----------------------------------------------------------------------\n\n\ninclude('../../../inc/includes.php');\n\nheader(\"Content-Type: text/html; charset=UTF-8\");\nHtml::header_nocache();\n\nSession::checkLoginUser();\n\nif (!isset($_POST['ip']) || !filter_var($_POST[\"ip\"], FILTER_VALIDATE_IP)) {\n   exit();\n}\n$ip = $_POST['ip'];\n$itemtype = $_POST['itemtype'];\n$items_id = $_POST['items_id'];\n\n$config = new PluginAddressingConfig();\n$config->getFromDB('1');\n$system = $config->fields[\"used_system\"];\n\n$ping_equip = new PluginAddressingPing_Equipment();\nlist($message, $error) = $ping_equip->ping($system, $ip);\n\n$plugin_addressing_pinginfo = new PluginAddressingPinginfo();\n\n$ping_value = $ping_equip->ping($system, $ip, \"true\");\n\n$id = 0;\n$ping_date = 0;\nif ($ping_value == false || $ping_value == true) {\n\n   $ping_date = $_SESSION['glpi_currenttime'];\n   if ($pings = $plugin_addressing_pinginfo->find(['itemtype' => $itemtype,\n      'items_id' => $items_id])) {\n      foreach ($pings as $ping) {\n         $id = $ping['id'];\n\n         $plugin_addressing_pinginfo->update(['id' => $id,\n            'ping_response' => $ping_value,\n            'ping_date' => $ping_date]);\n      }\n   } else {\n\n      $num = \"IP\".PluginAddressingReport::ip2string($ip);\n      $plugin_addressing_pinginfo->add(['ping_response' => $ping_value,\n         'ping_date' => $ping_date, 'itemtype' => $itemtype,\n         'items_id' => $items_id, 'ipname' => $num]);\n   }\n}\n\necho $ping_response = $message;\n\n", "<?php\n/*\n * @version $Id$\n -------------------------------------------------------------------------\n addressing plugin for GLPI\n Copyright (C) 2009-2016 by the addressing Development Team.\n\n https://github.com/pluginsGLPI/addressing\n -------------------------------------------------------------------------\n\n LICENSE\n\n This file is part of addressing.\n\n addressing is free software; you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation; either version 2 of the License, or\n (at your option) any later version.\n\n addressing is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with addressing. If not, see <http://www.gnu.org/licenses/>.\n --------------------------------------------------------------------------\n */\n\ninclude ('../../../inc/includes.php');\n\n$reserveip = new PluginAddressingReserveip();\n\nif (isset($_POST['add'])) {\n   $reserveip->check(-1, CREATE, $_POST);\n   $reserveip->reserveip($_POST);\n   Html::back();\n} else {\n   Html::header(PluginAddressingReserveip::getTypeName(), '', \"tools\", \"pluginaddressingmenu\");\n   if(filter_var($_REQUEST[\"ip\"], FILTER_VALIDATE_IP)) {\n      $reserveip->showReservationForm($_REQUEST[\"ip\"], $_REQUEST[\"id_addressing\"], $_REQUEST['rand']);\n   }\n   Html::footer();\n}\n"], "filenames": ["ajax/addressing.php", "ajax/ping.php", "front/reserveip.form.php"], "buggy_code_start_loc": [62, 43, 40], "buggy_code_end_loc": [63, 44, 41], "fixing_code_start_loc": [62, 43, 40], "fixing_code_end_loc": [66, 44, 43], "type": "CWE-78", "message": "GLPI is an open source IT Asset Management, issue tracking system and service desk system. The GLPI addressing plugin in versions < 2.9.1 suffers from authenticated Remote Code Execution vulnerability, allowing access to the server's underlying operating system using command injection abuse of functionality. There is no workaround for this issue and users are advised to upgrade or to disable the addressing plugin.", "other": {"cve": {"id": "CVE-2021-43779", "sourceIdentifier": "security-advisories@github.com", "published": "2022-01-05T19:15:08.627", "lastModified": "2022-08-09T00:52:26.057", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "GLPI is an open source IT Asset Management, issue tracking system and service desk system. The GLPI addressing plugin in versions < 2.9.1 suffers from authenticated Remote Code Execution vulnerability, allowing access to the server's underlying operating system using command injection abuse of functionality. There is no workaround for this issue and users are advised to upgrade or to disable the addressing plugin."}, {"lang": "es", "value": "GLPI es un sistema de administraci\u00f3n de activos de TI de c\u00f3digo abierto, un sistema de seguimiento de incidencias y un sistema de servicio t\u00e9cnico. El plugin de direccionamiento de GLPI en versiones anteriores a 2.9.1, sufre una vulnerabilidad de Ejecuci\u00f3n de C\u00f3digo Remota autenticada, que permite acceder al sistema operativo subyacente del servidor mediante el abuso de inyecci\u00f3n de comandos. No se presenta medidas de mitigaci\u00f3n adicionales para este problema y se recomienda a usuarios que actualicen o deshabiliten el plugin de direccionamiento."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.3}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:C/I:C/A:C", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "COMPLETE", "integrityImpact": "COMPLETE", "availabilityImpact": "COMPLETE", "baseScore": 9.0}, "baseSeverity": "HIGH", "exploitabilityScore": 8.0, "impactScore": 10.0, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-20"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:teclib-edition:addressing:*:*:*:*:*:glpi:*:*", "versionEndExcluding": "2.9.1", "matchCriteriaId": "9A8A3CB6-A060-49FA-BC4F-9EC99206CFB6"}]}]}], "references": [{"url": "https://github.com/hansmach1ne/MyExploits/tree/main/RCE_GLPI_addressing_plugin", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/pluginsGLPI/addressing/commit/6f55964803054a5acb5feda92c7c7f1d91ab5366", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/pluginsGLPI/addressing/security/advisories/GHSA-q5fp-xpr8-77jh", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pluginsGLPI/addressing/commit/6f55964803054a5acb5feda92c7c7f1d91ab5366"}}