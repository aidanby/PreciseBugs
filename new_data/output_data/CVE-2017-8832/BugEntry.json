{"buggy_code": ["<?php\n/*\nAllen Disk 1.6\nCopyright (C) 2012~2016 Allen Chou\nAuthor: Allen Chou ( http://allenchou.cc )\nLicense: MIT License\n*/\ninclude 'config.php';\nif (!session_id()) {\n    session_start();\n}\nset_time_limit(10);\n$show = true;\nfunction sizecount($size)\n{\n    if ($size >= 0.001 && $size < 1) {\n        echo round(($size * 1000), 2).'KB';\n    } elseif ($size >= 1 && $size < 1000) {\n        echo round($size, 2).'MB';\n    } elseif ($size >= 1000) {\n        echo round(($size / 1000), 2).'GB';\n    }\n}\nfunction check_dir($id)\n{\n    $dir = $GLOBALS['db']->select('dir', array('id' => $id));\n    if ($dir[0]['recycle'] == '1' || $dir[0]['share'] == '0') {\n        return false;\n    }\n    if ($dir[0]['parent'] != '0') {\n        $updir = $GLOBALS['db']->select('dir', array('id' => $dir[0]['parent']));\n        if ($updir[0]['recycle'] == '1' || $updir[0]['share'] == '0') {\n            return false;\n        } else {\n            return check_dir($updir[0]['id']);\n        }\n    } else {\n        return true;\n    }\n}\n$res = $db->select('file', array('id' => $_GET['id']));\nif ($_SESSION['login'] && $_SESSION['username'] == $res[0]['owner'] && isset($_GET['download']) && $_GET['download'] == 'true') {\n    header('Location: rdownfile.php?id='.$_GET['id'].'&download=true');\n}\nif ($res[0]['recycle'] == '1' || $res[0]['share'] == '0') {\n    $show = false;\n} else {\n    if ($res[0]['dir'] != 0) {\n        //if(!check_dir($res[0][\"dir\"])) $show = false;\n    }\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<title><?php echo $res[0]['name']; ?> - <?php echo $config['sitename'];?></title>\n<meta charset=\"utf-8\" />\n<link href=\"css/bootstrap.min.css\" rel=\"stylesheet\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<style>body{ background-color: #F8F8F8; }</style>\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\"></script>\n<script src=\"js/bootstrap.min.js\"></script>\n</head>\n<body>\n<div class=\"container\">\n    <h1 class=\"text-center\"><?php echo $config['sitetitle']; ?></h1>\n        <?php\n        if ($_SESSION['login']) {\n            ?>\n            <ul class=\"nav nav-tabs\">\n                <li><a href=\"index.php\">\u9996\u9801</a></li>\n                <li><a href=\"logout.php\">\u767b\u51fa</a></li>\n            </ul>\n        <?php \n        } else {\n            ?>\n            <ul class=\"nav nav-tabs\">\n                <li><a href=\"index.php\">\u9996\u9801</a></li>\n                <?php if ($config['why']) {\n    ?><li><a href=\"why.php\"><?php echo $config['sitename'];\n    ?>\u7684\u597d\u8655</a></li><?php \n}\n            ?>\n                <li><a href=\"login.php\">\u767b\u5165</a></li>\n                <?php if ($config['reg']) {\n    ?><li><a href=\"reg.php\">\u8a3b\u518a</a></li><?php \n}\n            ?>\n                <?php if ($config['tos']) {\n    ?><li><a href=\"tos.php\">\u4f7f\u7528\u689d\u6b3e</a></li><?php \n}\n            ?>\n            </ul>\n        <?php \n        } ?>\n    <div class=\"jumbotron\">\n        <?php if ($show) {\n    ?>\n        <h1><?php echo $res[0]['name'];\n    ?></h1>\n        <p>\u64c1\u6709\u8005\uff1a<?php echo $res[0]['owner'];\n    ?></br>\u6a94\u6848\u5927\u5c0f\uff1a<?php sizecount($res[0]['size'] / 1000 / 1000);\n    ?></br>\u4e0a\u50b3\u6642\u9593\uff1a<?php echo $res[0]['date'];\n    ?></p>\n        <p><a href=\"rdownfile.php?id=<?php echo $_GET['id'];\n    ?>&password=<?php echo $_GET['password'];\n    ?>\" class=\"btn btn-large btn-primary\">\u4e0b\u8f09</a></p>\n        <?php \n} else {\n    ?>\n        <h1>404 Not Found</h1>\n        <p>\u6b64\u6a94\u6848\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u4e0d\u5b58\u5728\u3001\u5df2\u7d93\u88ab\u522a\u9664\u6216\u662f\u88ab\u8a2d\u5b9a\u70ba\u4e0d\u516c\u958b\u3002</p>\n        <?php \n} ?>\n    </div>\n    <p class=\"text-center text-info\">Proudly Powered by <a href=\"http://ad.allenchou.cc/\">Allen Disk</a></p>\n</div>\n</body>\n</html>\n", "<?php\n\n/*\nAllen Disk 1.6\nCopyright (C) 2012~2016 Allen Chou\nAuthor: Allen Chou ( http://allenchou.cc )\nLicense: MIT License\n*/\n\ninclude 'config.php';\nif (!session_id()) {\n    session_start();\n}\ninclude dirname(__FILE__).'/class/password_compat.php';\nfunction login($username, $password)\n{\n    $res = $GLOBALS['db']->select('user', array('name' => $username));\n\n    if (password_verify($password, $res[0]['pass'])) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction md5_128($text)\n{\n    for ($i = 0; $i < 128; ++$i) {\n        $text = md5($text);\n    }\n\n    return $text;\n}\n\n$username = $_POST['name'];\n$password = $_POST['password'];\n$res = login($username, $password);\nswitch ($res) {\n    case 0:\n        echo 1;\n    break;\n\n    case 1:\n        $_SESSION['login'] = true;\n        $_SESSION['username'] = $username;\n        $_SESSION['password'] = md5_128($password);\n        echo 2;\n    break;\n\n    default:\n        echo 0;\n    break;\n}\n"], "fixing_code": ["<?php\n/*\nAllen Disk 1.6\nCopyright (C) 2012~2016 Allen Chou\nAuthor: Allen Chou ( http://allenchou.cc )\nLicense: MIT License\n*/\ninclude 'config.php';\nif (!session_id()) {\n    session_start();\n}\nset_time_limit(10);\n$show = true;\nfunction sizecount($size)\n{\n    if ($size >= 0.001 && $size < 1) {\n        echo round(($size * 1000), 2).'KB';\n    } elseif ($size >= 1 && $size < 1000) {\n        echo round($size, 2).'MB';\n    } elseif ($size >= 1000) {\n        echo round(($size / 1000), 2).'GB';\n    }\n}\nfunction check_dir($id)\n{\n    $dir = $GLOBALS['db']->select('dir', array('id' => $id));\n    if ($dir[0]['recycle'] == '1' || $dir[0]['share'] == '0') {\n        return false;\n    }\n    if ($dir[0]['parent'] != '0') {\n        $updir = $GLOBALS['db']->select('dir', array('id' => $dir[0]['parent']));\n        if ($updir[0]['recycle'] == '1' || $updir[0]['share'] == '0') {\n            return false;\n        } else {\n            return check_dir($updir[0]['id']);\n        }\n    } else {\n        return true;\n    }\n}\n$res = $db->select('file', array('id' => $_GET['id']));\nif ($_SESSION['login'] && $_SESSION['username'] == $res[0]['owner'] && isset($_GET['download']) && $_GET['download'] == 'true') {\n    header('Location: rdownfile.php?id='.$_GET['id'].'&download=true');\n}\nif ($res[0]['recycle'] == '1' || $res[0]['share'] == '0') {\n    $show = false;\n} else {\n    if ($res[0]['dir'] != 0) {\n        //if(!check_dir($res[0][\"dir\"])) $show = false;\n    }\n}\n?>\n<!DOCTYPE html>\n<html>\n<head>\n<title><?php echo $res[0]['name']; ?> - <?php echo $config['sitename'];?></title>\n<meta charset=\"utf-8\" />\n<link href=\"css/bootstrap.min.css\" rel=\"stylesheet\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<style>body{ background-color: #F8F8F8; }</style>\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\"></script>\n<script src=\"js/bootstrap.min.js\"></script>\n</head>\n<body>\n<div class=\"container\">\n    <h1 class=\"text-center\"><?php echo $config['sitetitle']; ?></h1>\n        <?php\n        if ($_SESSION['login']) {\n            ?>\n            <ul class=\"nav nav-tabs\">\n                <li><a href=\"index.php\">\u9996\u9801</a></li>\n                <li><a href=\"logout.php\">\u767b\u51fa</a></li>\n            </ul>\n        <?php \n        } else {\n            ?>\n            <ul class=\"nav nav-tabs\">\n                <li><a href=\"index.php\">\u9996\u9801</a></li>\n                <?php if ($config['why']) {\n    ?><li><a href=\"why.php\"><?php echo $config['sitename'];\n    ?>\u7684\u597d\u8655</a></li><?php \n}\n            ?>\n                <li><a href=\"login.php\">\u767b\u5165</a></li>\n                <?php if ($config['reg']) {\n    ?><li><a href=\"reg.php\">\u8a3b\u518a</a></li><?php \n}\n            ?>\n                <?php if ($config['tos']) {\n    ?><li><a href=\"tos.php\">\u4f7f\u7528\u689d\u6b3e</a></li><?php \n}\n            ?>\n            </ul>\n        <?php \n        } ?>\n    <div class=\"jumbotron\">\n        <?php if ($show) {\n    ?>\n        <h1><?php echo $res[0]['name'];\n    ?></h1>\n        <p>\u64c1\u6709\u8005\uff1a<?php echo $res[0]['owner'];\n    ?></br>\u6a94\u6848\u5927\u5c0f\uff1a<?php sizecount($res[0]['size'] / 1000 / 1000);\n    ?></br>\u4e0a\u50b3\u6642\u9593\uff1a<?php echo $res[0]['date'];\n    ?></p>\n        <p><a href=\"rdownfile.php?id=<?php echo htmlspecialchars($_GET['id']);\n    ?>&password=<?php echo htmlspecialchars($_GET['password']);\n    ?>\" class=\"btn btn-large btn-primary\">\u4e0b\u8f09</a></p>\n        <?php \n} else {\n    ?>\n        <h1>404 Not Found</h1>\n        <p>\u6b64\u6a94\u6848\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u4e0d\u5b58\u5728\u3001\u5df2\u7d93\u88ab\u522a\u9664\u6216\u662f\u88ab\u8a2d\u5b9a\u70ba\u4e0d\u516c\u958b\u3002</p>\n        <?php \n} ?>\n    </div>\n    <p class=\"text-center text-info\">Proudly Powered by <a href=\"http://ad.allenchou.cc/\">Allen Disk</a></p>\n</div>\n</body>\n</html>\n", "<?php\n\n/*\nAllen Disk 1.6\nCopyright (C) 2012~2016 Allen Chou\nAuthor: Allen Chou ( http://allenchou.cc )\nLicense: MIT License\n*/\n\ninclude 'config.php';\nif (!session_id()) {\n    session_start();\n}\ninclude dirname(__FILE__).'/class/password_compat.php';\nfunction login($username, $password)\n{\n    $res = $GLOBALS['db']->select('user', array('name' => $username));\n\n    if (password_verify($password, $res[0]['pass'])) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction md5_128($text)\n{\n    for ($i = 0; $i < 128; ++$i) {\n        $text = md5($text);\n    }\n\n    return $text;\n}\n\n$username = $_POST['name'];\n$password = $_POST['password'];\n$res = login($username, $password);\nswitch ($res) {\n    case 0:\n        echo 1;\n    break;\n\n    case 1:\n        $_SESSION['login'] = true;\n        $_SESSION['username'] = htmlspecialchars($username);\n        $_SESSION['password'] = md5_128($password);\n        echo 2;\n    break;\n\n    default:\n        echo 0;\n    break;\n}\n"], "filenames": ["downfile.php", "loginc.php"], "buggy_code_start_loc": [105, 45], "buggy_code_end_loc": [107, 46], "fixing_code_start_loc": [105, 45], "fixing_code_end_loc": [107, 46], "type": "CWE-79", "message": "Allen Disk 1.6 has XSS in the id parameter to downfile.php.", "other": {"cve": {"id": "CVE-2017-8832", "sourceIdentifier": "cve@mitre.org", "published": "2017-05-08T06:29:00.317", "lastModified": "2020-03-02T18:58:23.600", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Allen Disk 1.6 has XSS in the id parameter to downfile.php."}, {"lang": "es", "value": "Allen Disk 1.6 tiene un XSS en el par\u00e1metro id de downfile.php"}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:allen_disk_project:allen_disk:1.6:*:*:*:*:*:*:*", "matchCriteriaId": "58574971-6FAE-43CC-871E-13F36772BD73"}]}]}], "references": [{"url": "https://github.com/s3131212/allendisk/commit/37b6a63b85d5ab3ed81141cadc47489d7571664b", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/s3131212/allendisk/commit/37b6a63b85d5ab3ed81141cadc47489d7571664b"}}