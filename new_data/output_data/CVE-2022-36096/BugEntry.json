{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.3\" reference=\"XWiki.DeletedAttachments\" locale=\"\">\n  <web>XWiki</web>\n  <name>DeletedAttachments</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.AllDocs</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('platform.index.attachmentsTrash')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.0</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#set($dateFormat = 'yyyy MMMM d, HH:mm')\n#if(!$request.list)\n$xwiki.ssx.use('XWiki.DeletedAttachments')##\n$xwiki.jsx.use('XWiki.DeletedAttachments', {'minify' : 'false'})##\n##\n#set($columns = ['datt.filename', 'datt.docName', 'datt.date', 'datt.deleter', 'actions'])\n#set($columnsProperties = {\n    'datt.filename'  : { 'type' : 'text', 'size' : 10 },\n    'datt.docName'   : { 'type' : 'text', 'size' : 10 },\n    'datt.date'      : { 'type' : 'date'},\n    'datt.deleter'   : { 'type' : 'text', 'size' : 10 },\n    'actions'        : { 'type' : 'text', 'filterable' : false, 'sortable' : false }\n  })##\n#set($options = {\n    'url'               : \"$xwiki.getURL('XWiki.DeletedAttachments', 'view', 'list=1&amp;xpage=plain&amp;outputSyntax=plain')\",\n    'callback'          : 'XWiki.index.trash.attachments.displayEntry',\n    'translationPrefix' : 'platform.index.trashAttachments.'\n  })##\n##\n##\n##\n{{html wiki=\"true\" clean=\"false\"}}\n&lt;div class=\"hidden\"&gt;\n#livetable('attachmentTrash' $columns $columnsProperties $options)\n&lt;/div&gt;\n{{/html}}\n\n{{html wiki=\"true\" clean=\"false\"}}\n&lt;noscript&gt;\n\n  #set($deletedAttachments = $services.query.hql('select count(datt.id) from DeletedAttachment as datt').execute().get(0))\n  #if($deletedAttachments == 0)\n\n    {{info}}$services.localization.render('platform.index.trashAttachmentsEmpty'){{/info}}\n\n  #else\n  #macro(displayDeletedAttachment $id)\n    #set($datt = $xwiki.getDeletedAttachment(\"$id\"))\n    #set($originalAttachment = $datt.getAttachment())\n    #set($originalDocument = $xwiki.getDocument($datt.docName))\n    &lt;tr&gt;\n      &lt;td&gt;&lt;a href=\"$originalDocument.getAttachmentRevisionURL($originalAttachment.filename, $originalAttachment.version, \"rid=${datt.id}\").replaceAll('&amp;', '&amp;amp;')\"&gt;$escapetool.xml($datt.filename)&lt;/a&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;a href=\"$originalDocument.getURL()\"&gt;$escapetool.xml($originalDocument.plainTitle) ($escapetool.xml(${originalDocument.fullName}))&lt;/a&gt;&lt;/td&gt;\n      &lt;td&gt;$xwiki.formatDate($datt.getDate(), $dateFormat)&lt;/td&gt;\n      &lt;td&gt;$xwiki.getUserName($datt.getDeleter())&lt;/td&gt;\n      &lt;td class=\"itemActions\"&gt;\n        #if($datt.canDelete())\n          &lt;a href=\"${originalDocument.getAttachmentURL($datt.filename, 'delattachment', \"trashId=${datt.id}&amp;amp;xredirect=$escapetool.url($!request.getRequestURI())?$escapetool.url($!request.getQueryString())\")}\" class=\"tool delete\" title=\"$services.localization.render('platform.index.trashAttachmentsActionsDeleteTooltip')\"&gt;$services.localization.render('platform.index.trashAttachmentsDeleteText')&lt;/a&gt;\n        #end\n      &lt;/td&gt;\n    &lt;/tr&gt;\n  #end\n##\n  #if(\"$!{request.view}\" == '')\n    #set($queryParams = '')\n  #else\n    #set($queryParams = \"view=$!{escapetool.url($request.view)}\")\n  #end\n  #set($paginationParameters = {\n    'totalItems' : $services.query.hql('select count(datt.id) from DeletedAttachment as datt').execute().get(0),\n    'defaultItemsPerPage' : 15,\n    'url' : $doc.getURL('view', $queryParams)\n  })\n  #pagination($paginationParameters)\n  &lt;table id=\"searchResults\" class=\"xwiki-livetable xwiki-livetable-display\"&gt;\n    &lt;thead class=\"xwiki-livetable-display-header\"&gt;&lt;tr&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text selected asc\"&gt;$services.localization.render('platform.index.trashAttachments.datt.filename')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.docName')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.date')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.deleter')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.actions')&lt;/th&gt;\n    &lt;/tr&gt;&lt;/thead&gt;\n    &lt;tbody class=\"xwiki-livetable-display-body\"&gt;\n    #set ($query = $services.query.hql('select datt.id from DeletedAttachment as datt order by datt.filename asc'))\n    #foreach($item in $query.setLimit($paginationParameters.itemsPerPage).setOffset($paginationParameters.firstItem).execute())\n      #displayDeletedAttachment($item)\n    #end\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n  #set($discard = $paginationParameters.put('position', 'bottom'))\n  #pagination($paginationParameters)\n  #end ## deletedAttachments != 0\n&lt;/noscript&gt;\n{{/html}}##\n#end## !$request.list\n{{/velocity}}\n\n{{velocity output=\"false\"}}\n## ============================================================================================\n## This page is called from live table via Ajax with the argument xpage=plain. It returns a\n## set of results serialized in JSON.\n## @programming This service page needs to be saved by a user with the programming access level\n## to work as expected\n## ============================================================================================\n#if ($request.list &amp;&amp; $request.xpage == 'plain')\n  #set ($offset = $numbertool.toNumber($request.get('offset')).intValue())\n  ## offset starts from 0 in velocity and 1 in javascript\n  #set ($offset = $offset - 1)\n  #if (!$offset || $offset &lt; 0)\n    #set ($offset = 0)\n  #end\n  #set ($limit = $numbertool.toNumber($request.get('limit')).intValue())\n  #if (!$limit)\n    #set ($limit = 15)\n  #end\n  #set ($filenameFilter = $request.get('datt.filename'))\n  #set ($docNameFilter = $request.get('datt.docName'))\n  #set ($dateFilter = $request.get('datt.date'))\n  #set ($deleterFilter = $request.get('datt.deleter'))\n  #set ($sql = '')\n  #set ($params = {})\n  #if (\"$!filenameFilter\" != '')\n    #set ($sql = \"and lower(datt.filename) like '%${filenameFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!docNameFilter\" != '')\n    #set ($sql = \"and lower(datt.docName) like '%${docNameFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!dateFilter\" != '')\n    #set ($dates = $dateFilter.split('-'))\n    #if ($dates.size() == 2)\n      ## Date range matching\n      #set ($sql = \"${sql} and datt.date between :startDate and :endDate \")\n      #set ($discard = $params.put('startDate', $datetool.toDate($numbertool.toNumber($dates[0]))))\n      #set ($discard = $params.put('endDate', $datetool.toDate($numbertool.toNumber($dates[1]))))\n    #else\n      ## Single value matching\n      #set ($sql = \"${sql} and upper(str(datt.date)) like upper(str(:date)) \")\n      #set ($discard = $params.put('date', $dateFilter))\n    #end\n  #end\n  #if (\"$!deleterFilter\" != '')\n    #set ($sql = $sql + \"and lower(datt.deleter) like '%${deleterFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!request.sort\" != '')\n    #set ($order = $request.sort)\n  #else\n    #set ($order = 'datt.id')\n  #end\n  #if (\"$!request.dir\" != '')\n    #set ($dir = $request.dir)\n  #else\n    #set ($dir = 'asc')\n  #end\n  #set ($selectSql = \"select datt.id, $order from DeletedAttachment as datt where 1=1 \" + $sql + \" order by $order $dir\")\n  #set ($countSql = \"select count(*) from DeletedAttachment as datt where 1=1 \" + $sql)\n  #set ($items = $services.query.hql($selectSql).bindValues($params).setLimit($limit).setOffset($offset).execute())\n  #set ($totalItems = $services.query.hql($countSql).bindValues($params).execute().get(0))\n  #set ($json = {\n    'totalrows': $totalItems,\n    'returnedrows': $items.size(),\n    'offset': $mathtool.add($offset, 1),\n    'reqNo': $request.reqNo,\n    'query': $selectSql,\n    \"rows\": []\n  })\n  #foreach ($item in $items)\n    #set ($datt = $xwiki.getDeletedAttachment(\"$item.get(0)\"))\n    #set ($originalDocument = $xwiki.getDocument($datt.docName))\n    #set ($row = {\n      'filename': $datt.filename,\n      'docName': $datt.docName,\n      'documentUrl': $xwiki.getURL($datt.docName),\n      'canDelete': $datt.canDelete(),\n      'canRestore': $datt.canRestore(),\n      'restoreUrl': $xwiki.getAttachmentURL($datt.docName, $datt.filename),\n      'date': $xwiki.formatDate($datt.date, $dateFormat),\n      'deleter': $datt.deleter,\n      'deletername': $xwiki.getUserName($datt.deleter, false),\n      'deleterurl': $xwiki.getURL($datt.deleter, 'view')\n    })\n    #set ($row.alreadyExists = \"$!originalDocument.getAttachment($datt.filename)\" != '')\n    #if ($originalDocument)\n      #set ($row.title = $originalDocument.plainTitle)\n      #set ($row.deleteUrl = $originalDocument.getAttachmentURL($datt.filename, 'delattachment', $escapetool.url({\n        'trashId': $datt.id,\n        'form_token': $services.csrf.token\n      })))\n      #set ($originalAttachment = $datt.getAttachment())\n      #if ($originalAttachment)\n        #set ($row.url = $originalDocument.getAttachmentRevisionURL($originalAttachment.filename, $originalAttachment.version, $escapetool.url({\n          'rid': $datt.id\n        })))\n      #end\n    #else\n      #set ($row.title = $datt.docName)\n    #end\n    #set ($discard = $json.rows.add($row))\n  #end\n  #jsonResponse($json)\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>2b1a4426-e37b-40ba-9ad3-4055a466da0a</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>// Make sure the XWiki.index.trash.attachments 'namespace' exists.\nif (typeof XWiki == \"undefined\") {\n  XWiki = new Object();\n}\nif (typeof XWiki.index == \"undefined\") {\n  XWiki.index = new Object();\n}\nif (typeof XWiki.index.trash == \"undefined\") {\n  XWiki.index.trash = new Object();\n}\nif (typeof XWiki.index.trash.attachments == \"undefined\") {\n  XWiki.index.trash.attachments = new Object();\n}\n\n/**\n * Callback function used by the DeletedAttachments livetable for generating the HTML code needed to display an entry.\n * \n * @param row the JSON data corresponding to the entry to be displayed\n * @param i the index of the row in the list of entries\n * @param table the LiveTable javascript object\n */\nXWiki.index.trash.attachments.displayEntry = function (row, i, table) {\n  var tr = new Element('tr'); // The resulting table row\n  var file = new Element('a', {'href' : row.url}).update(row.filename);\n  tr.appendChild(new Element('td').update(file));\n  var doc = new Element('a', {'href' : row.documentUrl}).update(row.title);\n  doc.appendChild(document.createTextNode(' (' + row.docName + ')'));\n  tr.appendChild(new Element('td').update(doc));\n  tr.appendChild(new Element('td').update(row.date));\n  var deleter = new Element('a', {'href' : row.deleterurl}).update(row.deletername);\n  tr.appendChild(new Element('td').update(deleter));\n  var actions = new Element('td', {'class' : 'itemActions'});\n  if(row.canDelete) {\n    var delete_ = new Element('a', {\n        'href' : row.deleteUrl,\n        'class' : \"tool delete\",\n        'title' : \"$services.localization.render('platform.index.trashAttachmentsActionsDeleteTooltip')\"\n      }).update(\"$services.localization.render('platform.index.trashAttachmentsActionsDeleteText')\");\n    actions.appendChild(delete_);\n    delete_.observe('click', XWiki.index.trash.attachments.confirmDelete.bindAsEventListener(delete_, table, i));\n  }\n  tr.appendChild(actions);\n  return tr;\n}\n\n/**\n * Event listener, called when clicking a delete version link. It displays a confirmation box, speeding up the two-step\n * deletion process.\n * \n * @param event the link activation event\n * @param table the LiveTable javascript object\n * @param rowIdx the index of the row corresponding to the entry to be deleted\n */\nXWiki.index.trash.attachments.confirmDelete = function(event, table, rowIdx) {\n  event.stop();\n  if (this.disabled) {\n    // Do nothing if the button was already clicked and it's waiting for a response from the server.\n    return;\n  } else {\n    new XWiki.widgets.ConfirmedAjaxRequest(\n      /* Ajax request URL */\n      this.href + '&amp;confirm=1' + (Prototype.Browser.Opera ? \"\" : \"&amp;ajax=1\"),\n      /* Ajax request parameters */\n      {\n        onCreate : function() {\n          // Disable the button, to avoid a cascade of clicks from impatient users\n          this.disabled = true;\n        }.bind(this),\n        onSuccess : function(table, rowIdx) {\n          // Remove the corresponding HTML element from the UI and update the livetable\n          table.deleteRow(rowIdx);\n        }.bind(this, table, rowIdx),\n        // This is an expected 404, returned when the document has been successfully deleted and is no longer found\n        on404 : function(response, table, rowIdx) {\n          response.request.options.onSuccess(table, rowIdx);\n        }.bindAsEventListener(this, table, rowIdx),\n        onComplete : function() {\n          // In the end: re-enable the button\n          this.disabled = false;\n        }.bind(this)\n      },\n      /* Interaction parameters */\n      {\n         confirmationText: \"$services.localization.render('core.recyclebin.completelyDeleteConfirm')\",\n         progressMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteInProgress')\",\n         successMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteDone')\",\n         failureMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteFailed')\"\n      }\n      );\n  }\n}\n/*\n * The livetable is hidden when javascript is disabled, so that an alternative &lt;noscript&gt; table is displayed.\n * Re-display it when the document loads and Javascript is available.\n */\ndocument.observe('xwiki:dom:loaded', function() {\n  if ($('attachmentTrash')) {\n    $('attachmentTrash').up('.hidden').removeClassName('hidden');\n  }\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>33778e4e-5d86-472e-b065-c9c87b5b282e</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.itemActions .tool {\n  width: 16px;\n  height: 16px;\n  margin: 0 2px;\n  float: left;\n  text-indent: -1000em;\n  overflow: hidden;\n  background: transparent no-repeat center center;\n}\n.itemActions .delete {\n  background-image: url(\"$xwiki.getSkinFile('icons/silk/cross.png')\") !important;\n}\n.itemActions .restore {\n   background-image: url(\"$xwiki.getSkinFile('icons/silk/arrow_refresh.png')\") !important;\n}\n.itemActions .cannot-restore {\n   background-image: url(\"$xwiki.getSkinFile('icons/silk/page_error.png')\") !important;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>8d68ba7a-72d3-4f9f-a984-c7c47139b0a8</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>1</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAdminGroup</groups>\n    </property>\n    <property>\n      <levels>view,edit</levels>\n    </property>\n    <property>\n      <users/>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.3\" reference=\"XWiki.DeletedAttachments\" locale=\"\">\n  <web>XWiki</web>\n  <name>DeletedAttachments</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.AllDocs</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('platform.index.attachmentsTrash')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.0</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#set($dateFormat = 'yyyy MMMM d, HH:mm')\n#if(!$request.list)\n$xwiki.ssx.use('XWiki.DeletedAttachments')##\n$xwiki.jsx.use('XWiki.DeletedAttachments', {'minify' : 'false'})##\n##\n#set($columns = ['datt.filename', 'datt.docName', 'datt.date', 'datt.deleter', 'actions'])\n#set($columnsProperties = {\n    'datt.filename'  : { 'type' : 'text', 'size' : 10 },\n    'datt.docName'   : { 'type' : 'text', 'size' : 10 },\n    'datt.date'      : { 'type' : 'date'},\n    'datt.deleter'   : { 'type' : 'text', 'size' : 10 },\n    'actions'        : { 'type' : 'text', 'filterable' : false, 'sortable' : false }\n  })##\n#set($options = {\n    'url'               : \"$xwiki.getURL('XWiki.DeletedAttachments', 'view', 'list=1&amp;xpage=plain&amp;outputSyntax=plain')\",\n    'callback'          : 'XWiki.index.trash.attachments.displayEntry',\n    'translationPrefix' : 'platform.index.trashAttachments.'\n  })##\n##\n##\n##\n{{html wiki=\"true\" clean=\"false\"}}\n&lt;div class=\"hidden\"&gt;\n#livetable('attachmentTrash' $columns $columnsProperties $options)\n&lt;/div&gt;\n{{/html}}\n\n{{html wiki=\"true\" clean=\"false\"}}\n&lt;noscript&gt;\n\n  #set($deletedAttachments = $services.query.hql('select count(datt.id) from DeletedAttachment as datt').execute().get(0))\n  #if($deletedAttachments == 0)\n\n    {{info}}$services.localization.render('platform.index.trashAttachmentsEmpty'){{/info}}\n\n  #else\n  #macro(displayDeletedAttachment $id)\n    #set($datt = $xwiki.getDeletedAttachment(\"$id\"))\n    #set($originalAttachment = $datt.getAttachment())\n    #set($originalDocument = $xwiki.getDocument($datt.docName))\n    &lt;tr&gt;\n      &lt;td&gt;&lt;a href=\"$originalDocument.getAttachmentRevisionURL($originalAttachment.filename, $originalAttachment.version, \"rid=${datt.id}\").replaceAll('&amp;', '&amp;amp;')\"&gt;$escapetool.xml($datt.filename)&lt;/a&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;a href=\"$originalDocument.getURL()\"&gt;$escapetool.xml($originalDocument.plainTitle) ($escapetool.xml(${originalDocument.fullName}))&lt;/a&gt;&lt;/td&gt;\n      &lt;td&gt;$xwiki.formatDate($datt.getDate(), $dateFormat)&lt;/td&gt;\n      &lt;td&gt;$xwiki.getUserName($datt.getDeleter())&lt;/td&gt;\n      &lt;td class=\"itemActions\"&gt;\n        #if($datt.canDelete())\n          &lt;a href=\"${originalDocument.getAttachmentURL($datt.filename, 'delattachment', \"trashId=${datt.id}&amp;amp;xredirect=$escapetool.url($!request.getRequestURI())?$escapetool.url($!request.getQueryString())\")}\" class=\"tool delete\" title=\"$services.localization.render('platform.index.trashAttachmentsActionsDeleteTooltip')\"&gt;$services.localization.render('platform.index.trashAttachmentsDeleteText')&lt;/a&gt;\n        #end\n      &lt;/td&gt;\n    &lt;/tr&gt;\n  #end\n##\n  #if(\"$!{request.view}\" == '')\n    #set($queryParams = '')\n  #else\n    #set($queryParams = \"view=$!{escapetool.url($request.view)}\")\n  #end\n  #set($paginationParameters = {\n    'totalItems' : $services.query.hql('select count(datt.id) from DeletedAttachment as datt').execute().get(0),\n    'defaultItemsPerPage' : 15,\n    'url' : $doc.getURL('view', $queryParams)\n  })\n  #pagination($paginationParameters)\n  &lt;table id=\"searchResults\" class=\"xwiki-livetable xwiki-livetable-display\"&gt;\n    &lt;thead class=\"xwiki-livetable-display-header\"&gt;&lt;tr&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text selected asc\"&gt;$services.localization.render('platform.index.trashAttachments.datt.filename')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.docName')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.date')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.datt.deleter')&lt;/th&gt;\n      &lt;th scope=\"col\" class=\"xwiki-livetable-display-header-text\"&gt;$services.localization.render('platform.index.trashAttachments.actions')&lt;/th&gt;\n    &lt;/tr&gt;&lt;/thead&gt;\n    &lt;tbody class=\"xwiki-livetable-display-body\"&gt;\n    #set ($query = $services.query.hql('select datt.id from DeletedAttachment as datt order by datt.filename asc'))\n    #foreach($item in $query.setLimit($paginationParameters.itemsPerPage).setOffset($paginationParameters.firstItem).execute())\n      #displayDeletedAttachment($item)\n    #end\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n  #set($discard = $paginationParameters.put('position', 'bottom'))\n  #pagination($paginationParameters)\n  #end ## deletedAttachments != 0\n&lt;/noscript&gt;\n{{/html}}##\n#end## !$request.list\n{{/velocity}}\n\n{{velocity output=\"false\"}}\n## ============================================================================================\n## This page is called from live table via Ajax with the argument xpage=plain. It returns a\n## set of results serialized in JSON.\n## @programming This service page needs to be saved by a user with the programming access level\n## to work as expected\n## ============================================================================================\n#if ($request.list &amp;&amp; $request.xpage == 'plain')\n  #set ($offset = $numbertool.toNumber($request.get('offset')).intValue())\n  ## offset starts from 0 in velocity and 1 in javascript\n  #set ($offset = $offset - 1)\n  #if (!$offset || $offset &lt; 0)\n    #set ($offset = 0)\n  #end\n  #set ($limit = $numbertool.toNumber($request.get('limit')).intValue())\n  #if (!$limit)\n    #set ($limit = 15)\n  #end\n  #set ($filenameFilter = $request.get('datt.filename'))\n  #set ($docNameFilter = $request.get('datt.docName'))\n  #set ($dateFilter = $request.get('datt.date'))\n  #set ($deleterFilter = $request.get('datt.deleter'))\n  #set ($sql = '')\n  #set ($params = {})\n  #if (\"$!filenameFilter\" != '')\n    #set ($sql = \"and lower(datt.filename) like '%${filenameFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!docNameFilter\" != '')\n    #set ($sql = \"and lower(datt.docName) like '%${docNameFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!dateFilter\" != '')\n    #set ($dates = $dateFilter.split('-'))\n    #if ($dates.size() == 2)\n      ## Date range matching\n      #set ($sql = \"${sql} and datt.date between :startDate and :endDate \")\n      #set ($discard = $params.put('startDate', $datetool.toDate($numbertool.toNumber($dates[0]))))\n      #set ($discard = $params.put('endDate', $datetool.toDate($numbertool.toNumber($dates[1]))))\n    #else\n      ## Single value matching\n      #set ($sql = \"${sql} and upper(str(datt.date)) like upper(str(:date)) \")\n      #set ($discard = $params.put('date', $dateFilter))\n    #end\n  #end\n  #if (\"$!deleterFilter\" != '')\n    #set ($sql = $sql + \"and lower(datt.deleter) like '%${deleterFilter.trim().toLowerCase()}%' \")\n  #end\n  #if (\"$!request.sort\" != '')\n    #set ($order = $request.sort)\n  #else\n    #set ($order = 'datt.id')\n  #end\n  #if (\"$!request.dir\" != '')\n    #set ($dir = $request.dir)\n  #else\n    #set ($dir = 'asc')\n  #end\n  #set ($selectSql = \"select datt.id, $order from DeletedAttachment as datt where 1=1 \" + $sql + \" order by $order $dir\")\n  #set ($countSql = \"select count(*) from DeletedAttachment as datt where 1=1 \" + $sql)\n  #set ($items = $services.query.hql($selectSql).bindValues($params).setLimit($limit).setOffset($offset).execute())\n  #set ($totalItems = $services.query.hql($countSql).bindValues($params).execute().get(0))\n  #set ($json = {\n    'totalrows': $totalItems,\n    'returnedrows': $items.size(),\n    'offset': $mathtool.add($offset, 1),\n    'reqNo': $request.reqNo,\n    'query': $selectSql,\n    \"rows\": []\n  })\n  #foreach ($item in $items)\n    #set ($datt = $xwiki.getDeletedAttachment(\"$item.get(0)\"))\n    #set ($originalDocument = $xwiki.getDocument($datt.docName))\n    #set ($row = {\n      'filename': $datt.filename,\n      'docName': $datt.docName,\n      'documentUrl': $xwiki.getURL($datt.docName),\n      'canDelete': $datt.canDelete(),\n      'canRestore': $datt.canRestore(),\n      'restoreUrl': $xwiki.getAttachmentURL($datt.docName, $datt.filename),\n      'date': $xwiki.formatDate($datt.date, $dateFormat),\n      'deleter': $datt.deleter,\n      'deletername': $xwiki.getUserName($datt.deleter, false),\n      'deleterurl': $xwiki.getURL($datt.deleter, 'view')\n    })\n    #set ($row.alreadyExists = \"$!originalDocument.getAttachment($datt.filename)\" != '')\n    #if ($originalDocument)\n      #set ($row.title = $originalDocument.plainTitle)\n      #set ($row.deleteUrl = $originalDocument.getAttachmentURL($datt.filename, 'delattachment', $escapetool.url({\n        'trashId': $datt.id,\n        'form_token': $services.csrf.token\n      })))\n      #set ($originalAttachment = $datt.getAttachment())\n      #if ($originalAttachment)\n        #set ($row.url = $originalDocument.getAttachmentRevisionURL($originalAttachment.filename, $originalAttachment.version, $escapetool.url({\n          'rid': $datt.id\n        })))\n      #end\n    #else\n      #set ($row.title = $datt.docName)\n    #end\n    #set ($discard = $json.rows.add($row))\n  #end\n  #jsonResponse($json)\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>2b1a4426-e37b-40ba-9ad3-4055a466da0a</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>// Make sure the XWiki.index.trash.attachments 'namespace' exists.\nif (typeof XWiki == \"undefined\") {\n  XWiki = new Object();\n}\nif (typeof XWiki.index == \"undefined\") {\n  XWiki.index = new Object();\n}\nif (typeof XWiki.index.trash == \"undefined\") {\n  XWiki.index.trash = new Object();\n}\nif (typeof XWiki.index.trash.attachments == \"undefined\") {\n  XWiki.index.trash.attachments = new Object();\n}\n\n/**\n * Callback function used by the DeletedAttachments livetable for generating the HTML code needed to display an entry.\n * \n * @param row the JSON data corresponding to the entry to be displayed\n * @param i the index of the row in the list of entries\n * @param table the LiveTable javascript object\n */\nXWiki.index.trash.attachments.displayEntry = function (row, i, table) {\n  var tr = new Element('tr'); // The resulting table row\n  var file = new Element('a', {'href' : row.url}).update((row.filename || '').escapeHTML());\n  tr.appendChild(new Element('td').update(file));\n  var doc = new Element('a', {'href' : row.documentUrl}).update((row.title || '').escapeHTML());\n  doc.appendChild(document.createTextNode(' (' + row.docName + ')'));\n  tr.appendChild(new Element('td').update(doc));\n  tr.appendChild(new Element('td').update((row.date || '').escapeHTML()));\n  var deleter = new Element('a', {'href' : row.deleterurl}).update((row.deletername || '').escapeHTML());\n  tr.appendChild(new Element('td').update(deleter));\n  var actions = new Element('td', {'class' : 'itemActions'});\n  if(row.canDelete) {\n    var delete_ = new Element('a', {\n        'href' : row.deleteUrl,\n        'class' : \"tool delete\",\n        'title' : \"$services.localization.render('platform.index.trashAttachmentsActionsDeleteTooltip')\"\n      }).update(\"$services.localization.render('platform.index.trashAttachmentsActionsDeleteText')\");\n    actions.appendChild(delete_);\n    delete_.observe('click', XWiki.index.trash.attachments.confirmDelete.bindAsEventListener(delete_, table, i));\n  }\n  tr.appendChild(actions);\n  return tr;\n}\n\n/**\n * Event listener, called when clicking a delete version link. It displays a confirmation box, speeding up the two-step\n * deletion process.\n * \n * @param event the link activation event\n * @param table the LiveTable javascript object\n * @param rowIdx the index of the row corresponding to the entry to be deleted\n */\nXWiki.index.trash.attachments.confirmDelete = function(event, table, rowIdx) {\n  event.stop();\n  if (this.disabled) {\n    // Do nothing if the button was already clicked and it's waiting for a response from the server.\n    return;\n  } else {\n    new XWiki.widgets.ConfirmedAjaxRequest(\n      /* Ajax request URL */\n      this.href + '&amp;confirm=1' + (Prototype.Browser.Opera ? \"\" : \"&amp;ajax=1\"),\n      /* Ajax request parameters */\n      {\n        onCreate : function() {\n          // Disable the button, to avoid a cascade of clicks from impatient users\n          this.disabled = true;\n        }.bind(this),\n        onSuccess : function(table, rowIdx) {\n          // Remove the corresponding HTML element from the UI and update the livetable\n          table.deleteRow(rowIdx);\n        }.bind(this, table, rowIdx),\n        // This is an expected 404, returned when the document has been successfully deleted and is no longer found\n        on404 : function(response, table, rowIdx) {\n          response.request.options.onSuccess(table, rowIdx);\n        }.bindAsEventListener(this, table, rowIdx),\n        onComplete : function() {\n          // In the end: re-enable the button\n          this.disabled = false;\n        }.bind(this)\n      },\n      /* Interaction parameters */\n      {\n         confirmationText: \"$services.localization.render('core.recyclebin.completelyDeleteConfirm')\",\n         progressMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteInProgress')\",\n         successMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteDone')\",\n         failureMessageText : \"$services.localization.render('platform.index.trashAttachmentsDeleteFailed')\"\n      }\n      );\n  }\n}\n/*\n * The livetable is hidden when javascript is disabled, so that an alternative &lt;noscript&gt; table is displayed.\n * Re-display it when the document loads and Javascript is available.\n */\ndocument.observe('xwiki:dom:loaded', function() {\n  if ($('attachmentTrash')) {\n    $('attachmentTrash').up('.hidden').removeClassName('hidden');\n  }\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>33778e4e-5d86-472e-b065-c9c87b5b282e</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.itemActions .tool {\n  width: 16px;\n  height: 16px;\n  margin: 0 2px;\n  float: left;\n  text-indent: -1000em;\n  overflow: hidden;\n  background: transparent no-repeat center center;\n}\n.itemActions .delete {\n  background-image: url(\"$xwiki.getSkinFile('icons/silk/cross.png')\") !important;\n}\n.itemActions .restore {\n   background-image: url(\"$xwiki.getSkinFile('icons/silk/arrow_refresh.png')\") !important;\n}\n.itemActions .cannot-restore {\n   background-image: url(\"$xwiki.getSkinFile('icons/silk/page_error.png')\") !important;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.DeletedAttachments</name>\n    <number>0</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>8d68ba7a-72d3-4f9f-a984-c7c47139b0a8</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>1</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAdminGroup</groups>\n    </property>\n    <property>\n      <levels>view,edit</levels>\n    </property>\n    <property>\n      <users/>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-index/xwiki-platform-index-ui/src/main/resources/XWiki/DeletedAttachments.xml"], "buggy_code_start_loc": [336], "buggy_code_end_loc": [343], "fixing_code_start_loc": [336], "fixing_code_end_loc": [343], "type": "CWE-79", "message": "The XWiki Platform Index UI is an Index of all pages, attachments, orphans and deleted pages and attachments for XWiki Platform, a generic wiki platform. Prior to versions 13.10.6 and 14.3, it's possible to store JavaScript which will be executed by anyone viewing the deleted attachments index with an attachment containing javascript in its name. This issue has been patched in XWiki 13.10.6 and 14.3. As a workaround, modify fix the vulnerability by editing the wiki page `XWiki.DeletedAttachments` with the object editor, open the `JavaScriptExtension` object and apply on the content the changes that can be found on the fix commit.", "other": {"cve": {"id": "CVE-2022-36096", "sourceIdentifier": "security-advisories@github.com", "published": "2022-09-08T21:15:07.950", "lastModified": "2022-09-13T19:30:02.850", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The XWiki Platform Index UI is an Index of all pages, attachments, orphans and deleted pages and attachments for XWiki Platform, a generic wiki platform. Prior to versions 13.10.6 and 14.3, it's possible to store JavaScript which will be executed by anyone viewing the deleted attachments index with an attachment containing javascript in its name. This issue has been patched in XWiki 13.10.6 and 14.3. As a workaround, modify fix the vulnerability by editing the wiki page `XWiki.DeletedAttachments` with the object editor, open the `JavaScriptExtension` object and apply on the content the changes that can be found on the fix commit."}, {"lang": "es", "value": "XWiki Platform Index UI es un \u00edndice de todas las p\u00e1ginas, archivos adjuntos, p\u00e1ginas hu\u00e9rfanas y eliminadas y archivos adjuntos para la plataforma XWiki, una plataforma wiki gen\u00e9rica.&#xa0;En versiones anteriores a 13.10.6 y 14.3, es posible almacenar JavaScript que ejecutar\u00e1 cualquiera que visualice el \u00edndice de archivos adjuntos eliminados con un archivo adjunto que contenga javascript en su nombre.&#xa0;Este problema ha sido parcheado en XWiki versiones 13.10.6 y 14.3.&#xa0;Como mitigaci\u00f3n, corrija y modifique la vulnerabilidad al editar la p\u00e1gina wiki \"XWiki.DeletedAttachments\" con el editor de objetos, abra el objeto \"JavaScriptExtension\" y aplique en el contenido los cambios que pueden encontrarse en la confirmaci\u00f3n de correcci\u00f3n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.0, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.9, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.3, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}, {"lang": "en", "value": "CWE-80"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.3", "versionEndExcluding": "13.10.6", "matchCriteriaId": "CA38BFD3-071C-41C6-8BD7-41D9237A24DE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.3", "matchCriteriaId": "9B57E523-06A8-4964-84FE-361C9AA26990"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:2.2:milestone1:*:*:*:*:*:*", "matchCriteriaId": "C5DB4CA3-913F-48F6-95A9-25F350DDB537"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/6705b0cd0289d1c90ed354bd4ecc1508c4b25745", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-gjmq-x5x7-wc36", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-19613", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/6705b0cd0289d1c90ed354bd4ecc1508c4b25745"}}