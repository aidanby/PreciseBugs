{"buggy_code": ["#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\nimport re\nimport mistune\nimport tornado.web\n\n\nfrom urllib.parse import unquote, quote\n\nfrom .models import *\nfrom .markdown import *\nfrom tornado.escape import to_unicode\n\nclass BaseHandler(tornado.web.RequestHandler):\n    def description(self, text):\n        if len(text) <= 200:\n            return re.sub('(<.*?>)', '', text).replace('\\n', ' ')[:int(len(text)/2-4)] + '...'\n        elif len(text) > 200:\n            return re.sub('(<.*?>)', '', text).replace('\\n', ' ')[:195] + '...'\n\n    def md_to_html(self, text):\n        text = to_unicode(text)\n        renderer = MyRenderer()\n        md = mistune.Markdown(renderer=renderer)\n        return md.render(text)\n\n    def urlencode(self, text):\n        return quote(text.encode('utf8'))\n\n    def urldecode(self, text):\n        return unquote(text.encode('utf8'))\n\n    def get_custom_page(self):\n        return get_all_pages()\n\n    def get_current_user(self):\n        username = self.get_secure_cookie(\"username\")\n        if not username:\n            return None\n        return username\n\n    def get_error_html(self, status_code, **kwargs):\n        if status_code == 404:\n            self.render(\"404.html\",\n                title = \"404 Page Not Found\",\n                )\n        else:\n            try:\n                exception = \"%s\\n\\n%s\" % (kwargs[\"exception\"],\n                    traceback.format_exc())\n                if self.settings.get(\"debug\"):\n                    self.set_header('Content-Type', 'text/plain')\n                    for line in exception:\n                        self.write(line)\n                else:\n                    self.write(\"oOps...! I made \u200b\u200ba mistake... \")\n            except Exception:\n                return super(BaseHandler, self).get_error_html(status_code,\n                    **kwargs)", "{% extends 'layout.html' %}\n\n{% block title %} | Editor{% end %}\n\n{% block head %}\n<script>\n    function AutoSave(it) {\n        var _value = it.value;\n        var _LastContent = GetCookie('AutoSaveContent');\n        if (_value.length >= _LastContent.length) {\n            var expDays = 30;\n            var exp = new Date();\n            exp.setTime(exp.getTime() + (expDays * 86400000));\n            var expires = '; expires=' + exp.toGMTString();\n            document.cookie = \"AutoSaveContent=\" + escape(_value) + expires;\n        }\n    }\n\n    function AutoLoad(it) {\n        var _value = it.value;\n        if (!_value) {\n            var _LastContent = GetCookie('AutoSaveContent');\n            if (!_LastContent) return;\n            if (confirm(\"Load Last AutoSave Content?\")) {\n                it.value = _LastContent;\n                return true;\n            }\n        }\n    }\n\n    function getCookieVal(offset) {\n        var endstr = document.cookie.indexOf(\";\",offset);\n        if (endstr === -1) endstr = document.cookie.length;\n        return unescape(document.cookie.substring(offset, endstr));\n    }\n\n    function GetCookie(name) {\n        var arg = name+\"=\";\n        var alen = arg.length;\n        var clen = document.cookie.length;\n        var i = 0;\n        while (i < clen){\n            var j = i + alen;\n            if(document.cookie.substring(i,j) === arg) return getCookieVal (j);\n            i = document.cookie.indexOf(\" \",i)+1;\n            if (i === 0) break;\n        }\n        return null;\n    }\n\n    function DeleteCookie (name) {\n        var exp = new Date();\n        exp.setTime(exp.getTime() - 1);\n        var cval = GetCookie(name);\n        document.cookie = name + \"=\" + cval + \";expires=\" + exp.toGMTString();\n    }\n</script>\n{% end %}\n\n{% block content %}\n<div class=\"post\" id=\"editor\">\n    <h1 id=\"title\">Editor</h1>\n    <article>\n        <form action=\"#\" method=\"post\" id=\"article_editor\">\n            <div class=\"input\">\n                <label for=\"title\">Title</label>\n                <input id=\"title\" name=\"title\" type=\"text\" value=\"{% if not is_page and not new %}{{ article.title }}{% elif is_page and not new %}{{ content.title }}{% end %}\" style=\"width:100%;\">\n            </div>\n            <div v-if=\"!is_page\" class=\"input\">\n                <label for=\"tag\">Tag</label>\n                <input id=\"tag\" name=\"tag\" type=\"text\" value=\"{% if not is_page and not new %}{{ article.tag }}{% end %}\" style=\"width:100%;\">\n            </div>\n            <div class=\"input\">\n                <label for=\"content\">Content</label>\n                <textarea :value=\"input\" @input=\"update\" rows=\"30\" id=\"content\" name=\"content\" onkeyup=\"AutoSave(this);\"  onchange=\"AutoSave(this);\"ondblclick=\"AutoLoad(this);\"></textarea>\n                <label>Tip: Double click box to load last autosave content</label>\n            <div id=\"submit\">\n                <button type=\"submit\">Post</button>\n            </div>\n        </form>\n    </article>\n    <div class=\"post\">\n        <h1 id=\"title\">Preview</h1>\n        <article id=\"preview\" v-html=\"compiledMarkdown\"></article>\n    </div>\n</div>\n<script src=\"https://cdn.jsdelivr.net/npm/vue/dist/vue.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css\" integrity=\"sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y\" crossorigin=\"anonymous\">\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js\" integrity=\"sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx\" crossorigin=\"anonymous\"></script>\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js\" integrity=\"sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe\" crossorigin=\"anonymous\"></script>\n<script src='{{ static_url(\"js/marked.min.js\") }}'></script>\n<script src=\"https://unpkg.com/lodash@4.16.0\"></script>\n<script>\n    document.addEventListener(\"wheel\", function() {\n        renderMathInElement(document.getElementById(\"preview\"), {\n            delimiters: [\n                {left: \"$$\", right: \"$$\", display: true},\n                {left: \"$\", right: \"$\", display: false}\n            ]\n        });\n    });\n    document.addEventListener(\"touchmove\", function() {\n        renderMathInElement(document.getElementById(\"preview\"), {\n            delimiters: [\n                {left: \"$$\", right: \"$$\", display: true},\n                {left: \"$\", right: \"$\", display: false}\n            ]\n        });\n    });\n    var editor = new Vue({\n        el: '#editor',\n        data: {\n            {% if new %}\n            is_new: true,\n            input: '',\n            {% if is_page %}\n            is_page: true,\n            {% else %}\n            is_page: false,\n            {% end %}\n            {% else %}\n            is_new: false,\n            {% if is_page %}\n            is_page: true,\n            input: {{ json_encode(content.content) }}\n            {% else %}\n            is_page: false,\n            input: {{ json_encode(article.content) }}\n            {% end %}\n            {% end %}\n        },\n        computed: {\n            compiledMarkdown: function () {\n                return marked(this.input, { sanitize: true })\n            }\n        },\n        methods: {\n            update: _.debounce(function (e) {\n                this.input = e.target.value\n            }, 300)\n        }\n    });\n</script>\n{% end %}", "{% extends 'layout.html' %}\n\n{% block title %} | {{ article.title }}{% end %}\n\n{% block content %}\n<div class=\"post\">\n    <h1 id=\"title\">{{ article.title }}</h1>\n    <article>\n    {{ handler.md_to_html(article.content) }}\n    </article>\n</div>\n{% end %}"], "fixing_code": ["#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\nimport re\nimport mistune\nimport tornado.web\n\nfrom urllib.parse import unquote, quote\n\nfrom .models import *\nfrom .markdown import *\nfrom tornado.escape import to_unicode, xhtml_escape\n\nclass BaseHandler(tornado.web.RequestHandler):\n    def get_pure_title(self, title):\n        return re.sub('''<(\"[^\"]*\"|'[^']*'|[^'\">])*>''', \"\", title).strip()\n\n    def escape_string(self, s):\n        return xhtml_escape(s)\n        \n    def description(self, text):\n        if len(text) <= 200:\n            return re.sub('(<.*?>)', '', text).replace('\\n', ' ')[:int(len(text)/2-4)] + '...'\n        elif len(text) > 200:\n            return re.sub('(<.*?>)', '', text).replace('\\n', ' ')[:195] + '...'\n\n    def md_to_html(self, text):\n        text = to_unicode(text)\n        renderer = MyRenderer()\n        md = mistune.Markdown(renderer=renderer)\n        return md.render(text)\n\n    def urlencode(self, text):\n        return quote(text.encode('utf8'))\n\n    def urldecode(self, text):\n        return unquote(text.encode('utf8'))\n\n    def get_custom_page(self):\n        return get_all_pages()\n\n    def get_current_user(self):\n        username = self.get_secure_cookie(\"username\")\n        if not username:\n            return None\n        return username\n\n    def get_error_html(self, status_code, **kwargs):\n        if status_code == 404:\n            self.render(\"404.html\",\n                title = \"404 Page Not Found\",\n                )\n        else:\n            try:\n                exception = \"%s\\n\\n%s\" % (kwargs[\"exception\"],\n                    traceback.format_exc())\n                if self.settings.get(\"debug\"):\n                    self.set_header('Content-Type', 'text/plain')\n                    for line in exception:\n                        self.write(line)\n                else:\n                    self.write(\"oOps...! I made \u200b\u200ba mistake... \")\n            except Exception:\n                return super(BaseHandler, self).get_error_html(status_code,\n                    **kwargs)", "{% extends 'layout.html' %}\n\n{% block title %} | Editor{% end %}\n\n{% block head %}\n<script>\n    function AutoSave(it) {\n        var _value = it.value;\n        var _LastContent = GetCookie('AutoSaveContent');\n        if (_value.length >= _LastContent.length) {\n            var expDays = 30;\n            var exp = new Date();\n            exp.setTime(exp.getTime() + (expDays * 86400000));\n            var expires = '; expires=' + exp.toGMTString();\n            document.cookie = \"AutoSaveContent=\" + escape(_value) + expires;\n        }\n    }\n\n    function AutoLoad(it) {\n        var _value = it.value;\n        if (!_value) {\n            var _LastContent = GetCookie('AutoSaveContent');\n            if (!_LastContent) return;\n            if (confirm(\"Load Last AutoSave Content?\")) {\n                it.value = _LastContent;\n                return true;\n            }\n        }\n    }\n\n    function getCookieVal(offset) {\n        var endstr = document.cookie.indexOf(\";\",offset);\n        if (endstr === -1) endstr = document.cookie.length;\n        return unescape(document.cookie.substring(offset, endstr));\n    }\n\n    function GetCookie(name) {\n        var arg = name+\"=\";\n        var alen = arg.length;\n        var clen = document.cookie.length;\n        var i = 0;\n        while (i < clen){\n            var j = i + alen;\n            if(document.cookie.substring(i,j) === arg) return getCookieVal (j);\n            i = document.cookie.indexOf(\" \",i)+1;\n            if (i === 0) break;\n        }\n        return null;\n    }\n\n    function DeleteCookie (name) {\n        var exp = new Date();\n        exp.setTime(exp.getTime() - 1);\n        var cval = GetCookie(name);\n        document.cookie = name + \"=\" + cval + \";expires=\" + exp.toGMTString();\n    }\n</script>\n{% end %}\n\n{% block content %}\n<div class=\"post\" id=\"editor\">\n    <h1 id=\"title\">Editor</h1>\n    <article>\n        <form action=\"#\" method=\"post\" id=\"article_editor\">\n            <div class=\"input\">\n                <label for=\"title\">Title</label>\n                <input id=\"title\" name=\"title\" type=\"text\" value=\"{% if not is_page and not new %}{{ handler.escape_string(article.title) }}{% elif is_page and not new %}{{ handler.escape_string(content.title) }}{% end %}\" style=\"width:100%;\">\n            </div>\n            <div v-if=\"!is_page\" class=\"input\">\n                <label for=\"tag\">Tag</label>\n                <input id=\"tag\" name=\"tag\" type=\"text\" value=\"{% if not is_page and not new %}{{ handler.escape_string(article.tag) }}{% end %}\" style=\"width:100%;\">\n            </div>\n            <div class=\"input\">\n                <label for=\"content\">Content</label>\n                <textarea :value=\"input\" @input=\"update\" rows=\"30\" id=\"content\" name=\"content\" onkeyup=\"AutoSave(this);\"  onchange=\"AutoSave(this);\"ondblclick=\"AutoLoad(this);\"></textarea>\n                <label>Tip: Double click box to load last autosave content</label>\n            <div id=\"submit\">\n                <button type=\"submit\">Post</button>\n            </div>\n        </form>\n    </article>\n    <div class=\"post\">\n        <h1 id=\"title\">Preview</h1>\n        <article id=\"preview\" v-html=\"compiledMarkdown\"></article>\n    </div>\n</div>\n<script src=\"https://cdn.jsdelivr.net/npm/vue/dist/vue.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css\" integrity=\"sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y\" crossorigin=\"anonymous\">\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js\" integrity=\"sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx\" crossorigin=\"anonymous\"></script>\n<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js\" integrity=\"sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe\" crossorigin=\"anonymous\"></script>\n<script src='{{ static_url(\"js/marked.min.js\") }}'></script>\n<script src=\"https://unpkg.com/lodash@4.16.0\"></script>\n<script>\n    document.addEventListener(\"wheel\", function() {\n        renderMathInElement(document.getElementById(\"preview\"), {\n            delimiters: [\n                {left: \"$$\", right: \"$$\", display: true},\n                {left: \"$\", right: \"$\", display: false}\n            ]\n        });\n    });\n    document.addEventListener(\"touchmove\", function() {\n        renderMathInElement(document.getElementById(\"preview\"), {\n            delimiters: [\n                {left: \"$$\", right: \"$$\", display: true},\n                {left: \"$\", right: \"$\", display: false}\n            ]\n        });\n    });\n    var editor = new Vue({\n        el: '#editor',\n        data: {\n            {% if new %}\n            is_new: true,\n            input: '',\n            {% if is_page %}\n            is_page: true,\n            {% else %}\n            is_page: false,\n            {% end %}\n            {% else %}\n            is_new: false,\n            {% if is_page %}\n            is_page: true,\n            input: {{ json_encode(content.content) }}\n            {% else %}\n            is_page: false,\n            input: {{ json_encode(article.content) }}\n            {% end %}\n            {% end %}\n        },\n        computed: {\n            compiledMarkdown: function () {\n                return marked(this.input, { sanitize: true })\n            }\n        },\n        methods: {\n            update: _.debounce(function (e) {\n                this.input = e.target.value\n            }, 300)\n        }\n    });\n</script>\n{% end %}", "{% extends 'layout.html' %}\n\n{% block title %} | {{ handler.get_pure_title(article.title) }}{% end %}\n\n{% block head %}\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css\" integrity=\"sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y\" crossorigin=\"anonymous\">\n    <script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js\" integrity=\"sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx\" crossorigin=\"anonymous\"></script>\n    <script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js\" integrity=\"sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe\" crossorigin=\"anonymous\"></script>\n    <script>\n        document.addEventListener(\"DOMContentLoaded\", function() {\n            renderMathInElement(document.getElementById(\"article\"), {\n                delimiters: [\n                    {left: \"$$\", right: \"$$\", display: true},\n                    {left: \"$\", right: \"$\", display: false}\n                ]\n            });\n        });\n    </script>\n{% end %}\n\n{% block content %}\n<div class=\"post\">\n    <h1 id=\"title\">{{ article.title }}</h1>\n    <article>\n    {{ handler.md_to_html(article.content) }}\n    </article>\n</div>\n{% end %}"], "filenames": ["Pomash/libs/handler.py", "Pomash/theme/clean/templates/editor.html", "Pomash/theme/clean/templates/page.html"], "buggy_code_start_loc": [8, 67, 3], "buggy_code_end_loc": [15, 72, 4], "fixing_code_start_loc": [7, 67, 3], "fixing_code_end_loc": [21, 72, 20], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, was found in JmPotato Pomash. This affects an unknown part of the file Pomash/theme/clean/templates/editor.html. The manipulation of the argument article.title/content.title/article.tag leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is be1914ef0a6808e00f51618b2de92496a3604415. It is recommended to apply a patch to fix this issue. The identifier VDB-216957 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2018-25051", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-28T12:15:08.527", "lastModified": "2023-01-06T19:59:34.643", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, was found in JmPotato Pomash. This affects an unknown part of the file Pomash/theme/clean/templates/editor.html. The manipulation of the argument article.title/content.title/article.tag leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is be1914ef0a6808e00f51618b2de92496a3604415. It is recommended to apply a patch to fix this issue. The identifier VDB-216957 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 2.4, "baseSeverity": "LOW"}, "exploitabilityScore": 0.9, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pomash_project:pomash:*:*:*:*:*:*:*:*", "versionEndExcluding": "2018-12-29", "matchCriteriaId": "30E5C023-669C-4F7D-B99F-0A322AB9F1E0"}]}]}], "references": [{"url": "https://github.com/JmPotato/Pomash/commit/be1914ef0a6808e00f51618b2de92496a3604415", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.216957", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216957", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/JmPotato/Pomash/commit/be1914ef0a6808e00f51618b2de92496a3604415"}}