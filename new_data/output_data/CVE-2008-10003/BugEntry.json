{"buggy_code": ["<?php\r\n\r\n\r\n// ------------------------------------------------------------------------- //\r\n//                      flashgames                                           //\r\n//                     <http://www.tipsmitgrips.de>                          //\r\n// ------------------------------------------------------------------------- //\r\n// based on                                                                  //\r\n// Xoops module \"myalbum\"          - http://bluetopia.homeip.net/            //\r\n// Postnuke module \"pnflashgames\"  - http://www.pnflashgames.com             //\r\n// Mainly based on:                                                          //\r\n// XOOPS PHP Content Management System - http://www.xoops.org/               //\r\n// and:                                                                      //\r\n// myPHPNUKE Web Portal System - http://myphpnuke.com/                       //\r\n// PHP-NUKE Web Portal System - http://phpnuke.org/                          //\r\n// Thatware - http://thatware.org/                                           //\r\n// ------------------------------------------------------------------------- //\r\n//  This program is free software; you can redistribute it and/or modify     //\r\n//  it under the terms of the GNU General Public License as published by     //\r\n//  the Free Software Foundation; either version 2 of the License, or        //\r\n//  (at your option) any later version.                                      //\r\n//                                                                           //\r\n//  This program is distributed in the hope that it will be useful,          //\r\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of           //\r\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            //\r\n//  GNU General Public License for more details.                             //\r\n//                                                                           //\r\n//  You should have received a copy of the GNU General Public License        //\r\n//  along with this program; if not, write to the Free Software              //\r\n//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA //\r\n// ------------------------------------------------------------------------- //\r\ninclude(\"header.php\");\r\nglobal $full, $item_id, $url, $email, $logourl ;\r\n$myts =& MyTextSanitizer::getInstance();// MyTextSanitizer object\r\ninclude_once(XOOPS_ROOT_PATH.\"/class/xoopstree.php\");\r\n//include_once(XOOPS_ROOT_PATH.\"/class/xoopscomments.php\");\r\n$mytree = new XoopsTree($xoopsDB->prefix(\"flashgames_cat\"),\"cid\",\"pid\");\r\n$xoopsOption['template_main'] = 'flashgames_game.html';\r\n\r\n$lid = $HTTP_GET_VARS['lid'];\r\nif(!$full) {\r\n    include(XOOPS_ROOT_PATH.\"/header.php\");\r\n//    OpenTable();\r\n}\r\n//mainheader();\r\n\r\nif ($lid == \"\") {\r\n\t$lid = $item_id;\r\n}\r\nif ($item_id == \"\") {\r\n\t$item_id = $lid;\r\n}\r\n\r\n\r\n$q = \"select l.lid, l.cid, l.title, l.ext, l.res_x, l.res_y, l.bgcolor, l.status, l.members, l.date, l.hits, l.rating, l.votes, l.comments, l.submitter, t.description, l.gametype, l.license, l.classfile from \".$xoopsDB->prefix(\"flashgames_games\").\" l, \".$xoopsDB->prefix(\"flashgames_text\").\" t where l.lid=$lid and l.lid=t.lid and status>0\";\r\n$result=$xoopsDB->query($q);\r\n\r\nlist($lid, $cid, $ltitle, $ext, $res_x, $res_y, $bgcolor, $status, $members, $time, $hits, $rating, $votes, $comments, $submitter, $description, $gametype, $license, $classfile)=$xoopsDB->fetchRow($result);\r\n\r\nif($full) {\r\n    print \"<html><body><center><br>\";\r\n    print \"<img src=\".XOOPS_URL.\"/modules/flashgames/games/$lid.$ext><br><br>\";  \r\n    print \"<input type=button value=\"._ALBM_BACK.\" onclick=\\\"javascript:history.go(-1)\\\">\";\r\n    print \"<center></body></html>\";\r\n    exit;\r\n}\r\n\r\n//echo \"<table width=\\\"100%\\\" cellspacing=\\\"0\\\" cellpadding=\\\"3\\\" border=\\\"0\\\"><tr><td align=\\\"center\\\">\\n\";\r\n//echo \"<table width=\\\"100%\\\" cellspacing=\\\"2\\\" cellpadding=\\\"2\\\" border=\\\"0\\\" bgcolor=\\\"cccccc\\\"><tr><td>\\n\";\r\n\r\n//$pathstring = \"<a href=index.php>\"._ALBM_MAIN.\"</a>&nbsp;:&nbsp;\";\r\n$pathstring = \"<a href=index.php>\"._ALBM_HOME.\"</a>&nbsp;:&nbsp;\";  // Oka\r\n\r\n$nicepath = $mytree->getNicePathFromId($cid, \"title\", \"viewcat.php?op=\");\r\n$pathstring .= $nicepath;\r\n//echo \"<b>\".$pathstring.\"</b>\";\r\n//echo \"</td><td align='right'><a href='submit.php?cid=$cid'><b>Add game</b></a></td></tr></table><br><div align=\\\"center\\\">\";\r\n$xoopsTpl->assign('category_path', $pathstring);\r\n\r\n// category navigation\r\n$fullcountresult=$xoopsDB->query(\"select lid from \".$xoopsDB->prefix(\"flashgames_games\").\" where cid=$cid and status>0\");\r\nwhile (list($id) = $xoopsDB->fetchRow($fullcountresult)) {\r\n\t$ids[] = $id;\r\n}\r\n\r\nif ($ids[0] != $lid) {\r\n\t$prev = array_search($lid,$ids)-1;\r\n//\tprint \"<a href='game.php?lid=\".$ids[0].\"'><b>[&lt; </b></a>&nbsp;&nbsp;\";\t\r\n//\tprint \"<a href='game.php?lid=\".$ids[$prev].\"'><b>\"._ALBM_PREVIOUS.\"</b></a>&nbsp;&nbsp;\";\r\n\t$game_nav = \"<a href='game.php?lid=\".$ids[0].\"'><b>[&lt; </b></a>&nbsp;&nbsp;\";\t\r\n\t$game_nav .= \"<a href='game.php?lid=\".$ids[$prev].\"'><b>\"._ALBM_PREVIOUS.\"</b></a>&nbsp;&nbsp;\";\r\n    \r\n}\r\n\r\n$nwin = 7;\r\nif (count($ids) > $nwin) { // window\r\n\t$pos = array_search($lid,$ids);\r\n\tif ($pos > $nwin/2) {\r\n\t\tif ($pos > round(count($ids) - ($nwin/2)-1) ) {\r\n\t\t\t$start = count($ids) - $nwin + 1;\r\n\t\t} else {\r\n\t\t\t$start = round($pos - ($nwin/2))+1;\r\n\t\t}\r\n\t} else {\r\n\t\t$start = 1;\r\n\t}\r\n}\r\n\r\n\r\n\r\n// OKa  Navigation deaktiviert\r\nfor($i = $start; ($i < count($ids)+1) and ($i < $start + $nwin); $i++) {\r\n\tif ($ids[$i-1] == $lid) {\r\n\t\t//print \"$i&nbsp;&nbsp;\";\r\n        $game_nav .= \"$i&nbsp;&nbsp;\";\r\n\t} else {\r\n\t\t//print \"<a href='game.php?lid=\".$ids[$i-1].\"'>$i</a>&nbsp;&nbsp;\";\r\n        $game_nav .= \"<a href='game.php?lid=\".$ids[$i-1].\"'>$i</a>&nbsp;&nbsp;\";\r\n\t}\r\n}\r\n\r\nif ($ids[count($ids)-1] != $lid) {\r\n\t$next = array_search($lid,$ids)+1;\r\n//\tprint \"<a href='game.php?lid=\".$ids[$next].\"'><b>\"._ALBM_NEXT.\"</b></a>&nbsp;&nbsp;\";\r\n//\tprint \"<a href='game.php?lid=\".$ids[count($ids)-1].\"'><b> &gt;]</b></a>\";\r\n   \t$game_nav .= \"<a href='game.php?lid=\".$ids[$next].\"'><b>\"._ALBM_NEXT.\"</b></a>&nbsp;&nbsp;\";\r\n\t$game_nav .= \"<a href='game.php?lid=\".$ids[count($ids)-1].\"'><b> &gt;]</b></a>\";\r\n}\r\n\r\n\r\n\r\n$xoopsTpl->assign('game_nav', $game_nav);\r\n\r\n// OKa\r\n// User logged in ? if not then show text;\r\nif ( !$xoopsUser ) {\r\n$xoopsTpl->assign('flashgames_notloggedin' ,  _ALBM_NOTLOGGEDIN); \r\n\r\nif ( $members == 1 ){ \r\n   $members = 2;}\r\n  \r\n}\r\n\r\n\r\nif ($members <> 2){\r\n$xoopsDB->queryF(\"update \".$xoopsDB->prefix(\"flashgames_games\").\" set hits=hits+1 where lid=$lid and status>0\");\r\n}\r\n\r\n\r\n//echo \"</div><table width=\\\"100%\\\" cellspacing=0 cellpadding=10 border=0>\";\r\n$rating = number_format($rating, 2);\r\n$title = $myts->makeTboxData4Show($ltitle);\r\n$url = $myts->makeTboxData4Show($url);\r\n$url = urldecode($url);\r\n$email = $myts->makeTboxData4Show($email);\r\n$logourl = $myts->makeTboxData4Show($logourl);\r\n#\t$logourl = urldecode($logourl);\r\n$datetime = formatTimestamp($time,\"m\");\r\n$description = $myts->makeTareaData4Show($description,0);\r\n\r\n//PNFG UPDATE: get the game's checksum and domain\r\n$domain = pnFlashGames_getDomain();\r\n$gamefile = \"games/$lid.$ext\";\r\n$checksum = pnFlashGames_getChecksum($gamefile);\r\n\r\nglobal $xoopsUser;\r\n\r\nif ( $xoopsUser ) {\r\n//echo $xoopsUser->uid();\r\n\tif ( $xoopsUser->uid() == $submitter or $xoopsUser->isAdmin($xoopsModule->mid()) ) {\r\n\t\t$admin = \"<a href=\\\"\".XOOPS_URL.\"/modules/flashgames/editgame.php?lid=$lid\\\"><img src=\\\"\".XOOPS_URL.\"/modules/flashgames/images/editicon.gif\\\" border=\\\"0\\\" alt=\\\"\"._ALBM_EDITTHISLINK.\"\\\" /></a>  \";\r\n\t}\r\n}\r\n\r\n$big = 1;\r\n//include(\"include/linkformat.php\");\r\n\r\n\r\n$xoopsTpl->assign('game', array('id' => $lid, 'ext' => $ext, 'rating' => $rating,\r\n'title' => $title, 'url' => $url, 'email' => $email, 'logourl' => $logourl,\r\n'datetime' => $datetime, 'description' => $description, 'hits' => $hits,\r\n'votes' => $votes, 'license' => $license, 'checksum' => $checksum, 'domain' => $domain, 'res_x' => $res_x,\r\n'res_y' => $res_y, 'bgcolor' => $bgcolor, 'classfile' => $classfile, 'members' => $members));\r\n$xoopsTpl->assign('admin', $admin);\r\n$xoopsTpl->assign('game_title', $title);  // Oka\r\n $xoopsTpl->assign('lang_description', _ALBM_DESCRIPTIONC);\r\n$xoopsTpl->assign('lang_lastupdate', _ALBM_LASTUPDATEC);\r\n$xoopsTpl->assign('lang_hits', _ALBM_HITSC);\r\n$xoopsTpl->assign('lang_rating', _ALBM_RATINGC);\r\n$xoopsTpl->assign('lang_email', _ALBM_EMAILC);\r\n$xoopsTpl->assign('lang_ratethissite', _ALBM_RATETHISGAME);\r\n$xoopsTpl->assign('lang_reportbroken', _ALBM_REPORTBROKEN);\r\n$xoopsTpl->assign('lang_tellafriend', _ALBM_TELLAFRIEND);\r\n$xoopsTpl->assign('lang_modify', _ALBM_MODIFY);\r\n$xoopsTpl->assign('lang_category' , _ALBM_CATEGORYC);\r\n$xoopsTpl->assign('lang_visit' , _ALBM_VISIT);\r\n$xoopsTpl->assign('lang_comments' , _COMMENTS);\r\n$xoopsTpl->assign('lang_notamember' , _ALBM_NOTAMEMBER);\r\n\r\n\r\n\r\n\r\n\r\n//PNFG UPDATE: Moved footer output to common funtion for ease of maintenence.\r\n$xoopsTpl->assign('flashgames_footer' , GetFooter());\r\n\r\n//echo \"</table>\";\r\n//echo \"</td></tr></table>\\n\";\r\n\r\n// comments\r\n\r\n// OKa begin\r\n// get player name from DB\r\n\r\nif ( $xoopsUser ){\r\n $uid = $xoopsUser->uid();\r\n $result=$xoopsDB->query(\"SELECT uname FROM \".$xoopsDB->prefix(\"users\").\" WHERE uid = $uid\") or die(\"Error\");\r\n $myrow = $xoopsDB->fetchArray($result);\r\n $playername = $myrow['uname'];\r\n}else{\r\n $playername = \"Guest\";\r\n}\r\n$xoopsTpl->assign('username' , $playername);\r\n\r\n// Highscoretabelle laden\r\n//$myts =& MyTextSanitizer::getInstance();\r\n\r\n$xoopsTpl->assign('gametype', $gametype);\r\n\r\n$xoopsTpl->assign(array(\r\n            \"lang_halloffame\"   => _ALBM_HIGHSCORE ,\r\n\t\t\t\"lang_rang\" \t\t=> _ALBM_RANG , \r\n\t\t\t\"lang_name\" \t=> _ALBM_NAME, \r\n\t\t\t\"lang_score\"    => _ALBM_SCORE, \r\n\t\t\t\"lang_date\"\t\t=> _ALBM_DATE));\r\n\r\n\r\nif ($gametype == 1)\r\n{\r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score DESC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\"));\r\n}\r\n\r\nif ($gametype == 2)\r\n{\r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score ASC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\"));\r\n} \r\n\r\nif ($gametype == 3) \r\n{ \r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score DESC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\")); \r\n$xoopsTpl->assign('lang_score' , \"Zeit\");\r\n}\r\n\r\nif ($gametype == 4)\r\n{ \r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score ASC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\")); \r\n$xoopsTpl->assign('lang_score' , \"Zeit\");\r\n}\r\n\r\n\r\n\r\n\r\n$counter = 1;\r\n$rank = 0;\r\n$lastscore = -999999999999999;\r\n\r\n// $result=$xoopsDB->queryF($sql,10);\r\n$result=$xoopsDB->queryF($sql,$flashgames_scoreshow); //oka\r\n\r\n\r\nwhile($row1 = $xoopsDB->fetchArray($result))\r\n{\r\n//\t$time = floor($row1['time']/1000);\r\n//\t$minutes = (string)(floor($time/60));\r\n//\t$seconds = (string)($time % 60);\t\r\n//\t$hall_time =sprintf(\"%d'%d\\\"\",$minutes,$seconds);\r\n//\t$hall_name = $myts->makeTboxData4Show($row1['uname']);\r\n\t$name = $myts->makeTboxData4Show($row1['name']);\r\n        \r\n        $date1 = $row1['date'];\r\n        $date =  get_DateTime($date1);\r\n\r\n//        $date = formatTimestamp($sqlfetch[\"record_date\"],\"m\");\r\n\r\n$score = $row1['score'] ;\t\r\nif ( $gametype == 3  or  $gametype == 4 ) {\r\n //This is a time based score, so format it accordingly.  All time based scores are stored in seconds\r\n $timestamp = mktime(0, 0, $score);\r\n $score = strftime(\"%H:%M:%S\", $timestamp);\r\n}\r\n\r\n// $xoopsTpl->append('halloffamescores',array('rang'=>$counter, 'name'=>$name, 'score'=>$row1['score'], 'date' =>  // $date ));\r\n\r\nif ($name == $playername)\r\n{\r\n  $name = \"<strong>\".$name.\"</strong>\"; \r\n\r\n}\r\n\r\n\r\n\r\n\r\n           if ($lastscore != $score) \r\n           {\r\n        \t$rank++;\r\n        \r\n\t\t}\r\n                         \r\n\r\n            $lastscore = $score;\r\n\r\n\r\n\r\n$xoopsTpl->append('halloffamescores',array('rang'=>$rank, 'name'=>$name, 'score'=>$score, 'date' =>  $date));\r\n\r\n $counter++;\r\n}\r\n// OKa end\r\n\r\n\r\n\r\ninclude XOOPS_ROOT_PATH.'/include/comment_view.php';\r\n\r\n//CloseTable();\r\n//include(\"footer.php\");\r\n\r\ninclude_once(\"../../footer.php\");\r\n?>\r\n"], "fixing_code": ["<?php\r\n\r\n\r\n// ------------------------------------------------------------------------- //\r\n//                      flashgames                                           //\r\n//                     <http://www.tipsmitgrips.de>                          //\r\n// ------------------------------------------------------------------------- //\r\n// based on                                                                  //\r\n// Xoops module \"myalbum\"          - http://bluetopia.homeip.net/            //\r\n// Postnuke module \"pnflashgames\"  - http://www.pnflashgames.com             //\r\n// Mainly based on:                                                          //\r\n// XOOPS PHP Content Management System - http://www.xoops.org/               //\r\n// and:                                                                      //\r\n// myPHPNUKE Web Portal System - http://myphpnuke.com/                       //\r\n// PHP-NUKE Web Portal System - http://phpnuke.org/                          //\r\n// Thatware - http://thatware.org/                                           //\r\n// ------------------------------------------------------------------------- //\r\n//  This program is free software; you can redistribute it and/or modify     //\r\n//  it under the terms of the GNU General Public License as published by     //\r\n//  the Free Software Foundation; either version 2 of the License, or        //\r\n//  (at your option) any later version.                                      //\r\n//                                                                           //\r\n//  This program is distributed in the hope that it will be useful,          //\r\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of           //\r\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            //\r\n//  GNU General Public License for more details.                             //\r\n//                                                                           //\r\n//  You should have received a copy of the GNU General Public License        //\r\n//  along with this program; if not, write to the Free Software              //\r\n//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA //\r\n// ------------------------------------------------------------------------- //\r\ninclude(\"header.php\");\r\nglobal $full, $item_id, $url, $email, $logourl ;\r\n$myts =& MyTextSanitizer::getInstance();// MyTextSanitizer object\r\ninclude_once(XOOPS_ROOT_PATH.\"/class/xoopstree.php\");\r\n//include_once(XOOPS_ROOT_PATH.\"/class/xoopscomments.php\");\r\n$mytree = new XoopsTree($xoopsDB->prefix(\"flashgames_cat\"),\"cid\",\"pid\");\r\n$xoopsOption['template_main'] = 'flashgames_game.html';\r\n\r\n$lid = $HTTP_GET_VARS['lid'];\r\n\r\nif (!is_numeric($lid) or $lid<=0) \r\n{ exit;\r\n}\r\n\r\n\r\nif(!$full) {\r\n    include(XOOPS_ROOT_PATH.\"/header.php\");\r\n//    OpenTable();\r\n}\r\n//mainheader();\r\n\r\nif ($lid == \"\") {\r\n\t$lid = $item_id;\r\n}\r\nif ($item_id == \"\") {\r\n\t$item_id = $lid;\r\n}\r\n\r\n\r\n$q = \"select l.lid, l.cid, l.title, l.ext, l.res_x, l.res_y, l.bgcolor, l.status, l.members, l.date, l.hits, l.rating, l.votes, l.comments, l.submitter, t.description, l.gametype, l.license, l.classfile from \".$xoopsDB->prefix(\"flashgames_games\").\" l, \".$xoopsDB->prefix(\"flashgames_text\").\" t where l.lid=$lid and l.lid=t.lid and status>0\";\r\n$result=$xoopsDB->query($q);\r\n\r\nlist($lid, $cid, $ltitle, $ext, $res_x, $res_y, $bgcolor, $status, $members, $time, $hits, $rating, $votes, $comments, $submitter, $description, $gametype, $license, $classfile)=$xoopsDB->fetchRow($result);\r\n\r\nif($full) {\r\n    print \"<html><body><center><br>\";\r\n    print \"<img src=\".XOOPS_URL.\"/modules/flashgames/games/$lid.$ext><br><br>\";  \r\n    print \"<input type=button value=\"._ALBM_BACK.\" onclick=\\\"javascript:history.go(-1)\\\">\";\r\n    print \"<center></body></html>\";\r\n    exit;\r\n}\r\n\r\n//echo \"<table width=\\\"100%\\\" cellspacing=\\\"0\\\" cellpadding=\\\"3\\\" border=\\\"0\\\"><tr><td align=\\\"center\\\">\\n\";\r\n//echo \"<table width=\\\"100%\\\" cellspacing=\\\"2\\\" cellpadding=\\\"2\\\" border=\\\"0\\\" bgcolor=\\\"cccccc\\\"><tr><td>\\n\";\r\n\r\n//$pathstring = \"<a href=index.php>\"._ALBM_MAIN.\"</a>&nbsp;:&nbsp;\";\r\n$pathstring = \"<a href=index.php>\"._ALBM_HOME.\"</a>&nbsp;:&nbsp;\";  // Oka\r\n\r\n$nicepath = $mytree->getNicePathFromId($cid, \"title\", \"viewcat.php?op=\");\r\n$pathstring .= $nicepath;\r\n//echo \"<b>\".$pathstring.\"</b>\";\r\n//echo \"</td><td align='right'><a href='submit.php?cid=$cid'><b>Add game</b></a></td></tr></table><br><div align=\\\"center\\\">\";\r\n$xoopsTpl->assign('category_path', $pathstring);\r\n\r\n// category navigation\r\n$fullcountresult=$xoopsDB->query(\"select lid from \".$xoopsDB->prefix(\"flashgames_games\").\" where cid=$cid and status>0\");\r\nwhile (list($id) = $xoopsDB->fetchRow($fullcountresult)) {\r\n\t$ids[] = $id;\r\n}\r\n\r\nif ($ids[0] != $lid) {\r\n\t$prev = array_search($lid,$ids)-1;\r\n//\tprint \"<a href='game.php?lid=\".$ids[0].\"'><b>[&lt; </b></a>&nbsp;&nbsp;\";\t\r\n//\tprint \"<a href='game.php?lid=\".$ids[$prev].\"'><b>\"._ALBM_PREVIOUS.\"</b></a>&nbsp;&nbsp;\";\r\n\t$game_nav = \"<a href='game.php?lid=\".$ids[0].\"'><b>[&lt; </b></a>&nbsp;&nbsp;\";\t\r\n\t$game_nav .= \"<a href='game.php?lid=\".$ids[$prev].\"'><b>\"._ALBM_PREVIOUS.\"</b></a>&nbsp;&nbsp;\";\r\n    \r\n}\r\n\r\n$nwin = 7;\r\nif (count($ids) > $nwin) { // window\r\n\t$pos = array_search($lid,$ids);\r\n\tif ($pos > $nwin/2) {\r\n\t\tif ($pos > round(count($ids) - ($nwin/2)-1) ) {\r\n\t\t\t$start = count($ids) - $nwin + 1;\r\n\t\t} else {\r\n\t\t\t$start = round($pos - ($nwin/2))+1;\r\n\t\t}\r\n\t} else {\r\n\t\t$start = 1;\r\n\t}\r\n}\r\n\r\n\r\n\r\n// OKa  Navigation deaktiviert\r\nfor($i = $start; ($i < count($ids)+1) and ($i < $start + $nwin); $i++) {\r\n\tif ($ids[$i-1] == $lid) {\r\n\t\t//print \"$i&nbsp;&nbsp;\";\r\n        $game_nav .= \"$i&nbsp;&nbsp;\";\r\n\t} else {\r\n\t\t//print \"<a href='game.php?lid=\".$ids[$i-1].\"'>$i</a>&nbsp;&nbsp;\";\r\n        $game_nav .= \"<a href='game.php?lid=\".$ids[$i-1].\"'>$i</a>&nbsp;&nbsp;\";\r\n\t}\r\n}\r\n\r\nif ($ids[count($ids)-1] != $lid) {\r\n\t$next = array_search($lid,$ids)+1;\r\n//\tprint \"<a href='game.php?lid=\".$ids[$next].\"'><b>\"._ALBM_NEXT.\"</b></a>&nbsp;&nbsp;\";\r\n//\tprint \"<a href='game.php?lid=\".$ids[count($ids)-1].\"'><b> &gt;]</b></a>\";\r\n   \t$game_nav .= \"<a href='game.php?lid=\".$ids[$next].\"'><b>\"._ALBM_NEXT.\"</b></a>&nbsp;&nbsp;\";\r\n\t$game_nav .= \"<a href='game.php?lid=\".$ids[count($ids)-1].\"'><b> &gt;]</b></a>\";\r\n}\r\n\r\n\r\n\r\n$xoopsTpl->assign('game_nav', $game_nav);\r\n\r\n// OKa\r\n// User logged in ? if not then show text;\r\nif ( !$xoopsUser ) {\r\n$xoopsTpl->assign('flashgames_notloggedin' ,  _ALBM_NOTLOGGEDIN); \r\n\r\nif ( $members == 1 ){ \r\n   $members = 2;}\r\n  \r\n}\r\n\r\n\r\nif ($members <> 2){\r\n$xoopsDB->queryF(\"update \".$xoopsDB->prefix(\"flashgames_games\").\" set hits=hits+1 where lid=$lid and status>0\");\r\n}\r\n\r\n\r\n//echo \"</div><table width=\\\"100%\\\" cellspacing=0 cellpadding=10 border=0>\";\r\n$rating = number_format($rating, 2);\r\n$title = $myts->makeTboxData4Show($ltitle);\r\n$url = $myts->makeTboxData4Show($url);\r\n$url = urldecode($url);\r\n$email = $myts->makeTboxData4Show($email);\r\n$logourl = $myts->makeTboxData4Show($logourl);\r\n#\t$logourl = urldecode($logourl);\r\n$datetime = formatTimestamp($time,\"m\");\r\n$description = $myts->makeTareaData4Show($description,0);\r\n\r\n//PNFG UPDATE: get the game's checksum and domain\r\n$domain = pnFlashGames_getDomain();\r\n$gamefile = \"games/$lid.$ext\";\r\n$checksum = pnFlashGames_getChecksum($gamefile);\r\n\r\nglobal $xoopsUser;\r\n\r\nif ( $xoopsUser ) {\r\n//echo $xoopsUser->uid();\r\n\tif ( $xoopsUser->uid() == $submitter or $xoopsUser->isAdmin($xoopsModule->mid()) ) {\r\n\t\t$admin = \"<a href=\\\"\".XOOPS_URL.\"/modules/flashgames/editgame.php?lid=$lid\\\"><img src=\\\"\".XOOPS_URL.\"/modules/flashgames/images/editicon.gif\\\" border=\\\"0\\\" alt=\\\"\"._ALBM_EDITTHISLINK.\"\\\" /></a>  \";\r\n\t}\r\n}\r\n\r\n$big = 1;\r\n//include(\"include/linkformat.php\");\r\n\r\n\r\n$xoopsTpl->assign('game', array('id' => $lid, 'ext' => $ext, 'rating' => $rating,\r\n'title' => $title, 'url' => $url, 'email' => $email, 'logourl' => $logourl,\r\n'datetime' => $datetime, 'description' => $description, 'hits' => $hits,\r\n'votes' => $votes, 'license' => $license, 'checksum' => $checksum, 'domain' => $domain, 'res_x' => $res_x,\r\n'res_y' => $res_y, 'bgcolor' => $bgcolor, 'classfile' => $classfile, 'members' => $members));\r\n$xoopsTpl->assign('admin', $admin);\r\n$xoopsTpl->assign('game_title', $title);  // Oka\r\n $xoopsTpl->assign('lang_description', _ALBM_DESCRIPTIONC);\r\n$xoopsTpl->assign('lang_lastupdate', _ALBM_LASTUPDATEC);\r\n$xoopsTpl->assign('lang_hits', _ALBM_HITSC);\r\n$xoopsTpl->assign('lang_rating', _ALBM_RATINGC);\r\n$xoopsTpl->assign('lang_email', _ALBM_EMAILC);\r\n$xoopsTpl->assign('lang_ratethissite', _ALBM_RATETHISGAME);\r\n$xoopsTpl->assign('lang_reportbroken', _ALBM_REPORTBROKEN);\r\n$xoopsTpl->assign('lang_tellafriend', _ALBM_TELLAFRIEND);\r\n$xoopsTpl->assign('lang_modify', _ALBM_MODIFY);\r\n$xoopsTpl->assign('lang_category' , _ALBM_CATEGORYC);\r\n$xoopsTpl->assign('lang_visit' , _ALBM_VISIT);\r\n$xoopsTpl->assign('lang_comments' , _COMMENTS);\r\n$xoopsTpl->assign('lang_notamember' , _ALBM_NOTAMEMBER);\r\n\r\n\r\n\r\n\r\n\r\n//PNFG UPDATE: Moved footer output to common funtion for ease of maintenence.\r\n$xoopsTpl->assign('flashgames_footer' , GetFooter());\r\n\r\n//echo \"</table>\";\r\n//echo \"</td></tr></table>\\n\";\r\n\r\n// comments\r\n\r\n// OKa begin\r\n// get player name from DB\r\n\r\nif ( $xoopsUser ){\r\n $uid = $xoopsUser->uid();\r\n $result=$xoopsDB->query(\"SELECT uname FROM \".$xoopsDB->prefix(\"users\").\" WHERE uid = $uid\") or die(\"Error\");\r\n $myrow = $xoopsDB->fetchArray($result);\r\n $playername = $myrow['uname'];\r\n}else{\r\n $playername = \"Guest\";\r\n}\r\n$xoopsTpl->assign('username' , $playername);\r\n\r\n// Highscoretabelle laden\r\n//$myts =& MyTextSanitizer::getInstance();\r\n\r\n$xoopsTpl->assign('gametype', $gametype);\r\n\r\n$xoopsTpl->assign(array(\r\n            \"lang_halloffame\"   => _ALBM_HIGHSCORE ,\r\n\t\t\t\"lang_rang\" \t\t=> _ALBM_RANG , \r\n\t\t\t\"lang_name\" \t=> _ALBM_NAME, \r\n\t\t\t\"lang_score\"    => _ALBM_SCORE, \r\n\t\t\t\"lang_date\"\t\t=> _ALBM_DATE));\r\n\r\n\r\nif ($gametype == 1)\r\n{\r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score DESC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\"));\r\n}\r\n\r\nif ($gametype == 2)\r\n{\r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score ASC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\"));\r\n} \r\n\r\nif ($gametype == 3) \r\n{ \r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score DESC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\")); \r\n$xoopsTpl->assign('lang_score' , \"Zeit\");\r\n}\r\n\r\nif ($gametype == 4)\r\n{ \r\n$sql=sprintf(\"SELECT   g.score, g.name , g.date from %s g where g.lid = $lid order\r\nBY g.score ASC, g.name, g.date\",$xoopsDB->prefix(\"flashgames_score\")); \r\n$xoopsTpl->assign('lang_score' , \"Zeit\");\r\n}\r\n\r\n\r\n\r\n\r\n$counter = 1;\r\n$rank = 0;\r\n$lastscore = -999999999999999;\r\n\r\n// $result=$xoopsDB->queryF($sql,10);\r\n$result=$xoopsDB->queryF($sql,$flashgames_scoreshow); //oka\r\n\r\n\r\nwhile($row1 = $xoopsDB->fetchArray($result))\r\n{\r\n//\t$time = floor($row1['time']/1000);\r\n//\t$minutes = (string)(floor($time/60));\r\n//\t$seconds = (string)($time % 60);\t\r\n//\t$hall_time =sprintf(\"%d'%d\\\"\",$minutes,$seconds);\r\n//\t$hall_name = $myts->makeTboxData4Show($row1['uname']);\r\n\t$name = $myts->makeTboxData4Show($row1['name']);\r\n        \r\n        $date1 = $row1['date'];\r\n        $date =  get_DateTime($date1);\r\n\r\n//        $date = formatTimestamp($sqlfetch[\"record_date\"],\"m\");\r\n\r\n$score = $row1['score'] ;\t\r\nif ( $gametype == 3  or  $gametype == 4 ) {\r\n //This is a time based score, so format it accordingly.  All time based scores are stored in seconds\r\n $timestamp = mktime(0, 0, $score);\r\n $score = strftime(\"%H:%M:%S\", $timestamp);\r\n}\r\n\r\n// $xoopsTpl->append('halloffamescores',array('rang'=>$counter, 'name'=>$name, 'score'=>$row1['score'], 'date' =>  // $date ));\r\n\r\nif ($name == $playername)\r\n{\r\n  $name = \"<strong>\".$name.\"</strong>\"; \r\n\r\n}\r\n\r\n\r\n\r\n\r\n           if ($lastscore != $score) \r\n           {\r\n        \t$rank++;\r\n        \r\n\t\t}\r\n                         \r\n\r\n            $lastscore = $score;\r\n\r\n\r\n\r\n$xoopsTpl->append('halloffamescores',array('rang'=>$rank, 'name'=>$name, 'score'=>$score, 'date' =>  $date));\r\n\r\n $counter++;\r\n}\r\n// OKa end\r\n\r\n\r\n\r\ninclude XOOPS_ROOT_PATH.'/include/comment_view.php';\r\n\r\n//CloseTable();\r\n//include(\"footer.php\");\r\n\r\ninclude_once(\"../../footer.php\");\r\n?>\r\n"], "filenames": ["game.php"], "buggy_code_start_loc": [40], "buggy_code_end_loc": [40], "fixing_code_start_loc": [41], "fixing_code_end_loc": [47], "type": "CWE-89", "message": "A vulnerability was found in iGamingModules flashgames 1.1.0. It has been classified as critical. Affected is an unknown function of the file game.php. The manipulation of the argument lid leads to sql injection. It is possible to launch the attack remotely. The name of the patch is 6e57683704885be32eea2ea614f80c9bb8f012c5. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-222288.", "other": {"cve": {"id": "CVE-2008-10003", "sourceIdentifier": "cna@vuldb.com", "published": "2023-03-05T02:15:58.983", "lastModified": "2023-03-09T20:41:49.320", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in iGamingModules flashgames 1.1.0. It has been classified as critical. Affected is an unknown function of the file game.php. The manipulation of the argument lid leads to sql injection. It is possible to launch the attack remotely. The name of the patch is 6e57683704885be32eea2ea614f80c9bb8f012c5. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-222288."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:flashgames_project:flashgames:1.1.0:*:*:*:*:*:*:*", "matchCriteriaId": "2287DFE8-34D1-4BFA-BC0A-B7DBB4205731"}]}]}], "references": [{"url": "https://github.com/iGamingModules/flashgames/commit/6e57683704885be32eea2ea614f80c9bb8f012c5", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.222288", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.222288", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/iGamingModules/flashgames/commit/6e57683704885be32eea2ea614f80c9bb8f012c5"}}