{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2012\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\ninclude \"root.php\";\nrequire_once \"resources/require.php\";\nrequire_once \"resources/check_auth.php\";\nif (permission_exists('call_center_queue_add') || permission_exists('call_center_queue_edit')) {\n\t//access granted\n}\nelse {\n\techo \"access denied\";\n\texit;\n}\n\n$cmd = $_GET['cmd'];\n$rdr = $_GET['rdr'];\n\n//connect to event socket\n$fp = event_socket_create($_SESSION['event_socket_ip_address'], $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\nif ($fp) {\n\t$response = event_socket_request($fp, 'api reloadxml');\n\t$response = event_socket_request($fp, $cmd);\n\tfclose($fp);\n}\nelse {\n\t$response = '';\n}\nif ($rdr == \"false\") {\n\t//redirect false\n\techo $response;\n}\nelse {\n\t$_SESSION[\"message\"] = $response;\n\theader(\"Location: call_center_queues.php?savemsg=\".urlencode($response));\n}\n?>"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2019\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('call_center_queue_add') || permission_exists('call_center_queue_edit')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//get the variables\n\t$cmd = $_GET['cmd'];\n\t$queue = $_GET['queue'];\n\n//validate the variables\n\tswitch ($cmd) {\n\t\tcase \"load\":\n\t\t\t//allow the command\n\t\t\tbreak;\n\t\tcase \"unload\":\n\t\t\t//allow the command\n\t\t\tbreak;\n\t\tcase \"reload\":\n\t\t\t//allow the command\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tunset($cmd);\n\t}\n\n//only allow a uuid for the queue name\n\tif (!is_uuid($queue)) {\n\t\tunset($queue);\n\t}\n\n//connect to event socket\n\t$fp = event_socket_create($_SESSION['event_socket_ip_address'], $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\n\tif ($fp) {\n\t\t$response = event_socket_request($fp, 'api reloadxml');\n\t\tif (isset($cmd) && isset($queue)) {\n\t\t\t$response = event_socket_request($fp, 'api callcenter_config queue '.$cmd. ' '.$queue);\n\t\t}\n\t\tfclose($fp);\n\t}\n\telse {\n\t\t$response = '';\n\t}\n\n//send the redirect\n\t$_SESSION[\"message\"] = $response;\n\theader(\"Location: call_center_queues.php?savemsg=\".urlencode($response));\n\n?>\n"], "filenames": ["app/call_centers/cmd.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [59], "fixing_code_start_loc": [20], "fixing_code_end_loc": [83], "type": "CWE-78", "message": "app/call_centers/cmd.php in the Call Center Queue Module in FusionPBX up to 4.5.7 suffers from a command injection vulnerability due to a lack of input validation, which allows authenticated attackers (with at least the permission call_center_queue_add or call_center_queue_edit) to execute any commands on the host as www-data.", "other": {"cve": {"id": "CVE-2019-16964", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T19:15:10.907", "lastModified": "2020-08-24T17:37:01.140", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "app/call_centers/cmd.php in the Call Center Queue Module in FusionPBX up to 4.5.7 suffers from a command injection vulnerability due to a lack of input validation, which allows authenticated attackers (with at least the permission call_center_queue_add or call_center_queue_edit) to execute any commands on the host as www-data."}, {"lang": "es", "value": "El archivo app/call_centers/cmd.php en el Call Center Queue Module en FusionPBX versiones hasta 4.5.7, sufre de una vulnerabilidad de inyecci\u00f3n de comando debido a la falta de comprobaci\u00f3n de entrada, lo que permite a atacantes autenticados (con al menos el permiso call_center_queue_add o call_center_queue_edit) ejecutar cualquier comando en el host como www-data."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:C/I:C/A:C", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "COMPLETE", "integrityImpact": "COMPLETE", "availabilityImpact": "COMPLETE", "baseScore": 9.0}, "baseSeverity": "HIGH", "exploitabilityScore": 8.0, "impactScore": 10.0, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/2f9e591a4034c3aea70185dcab837946096449bf", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-sofia-api-command-injection-1/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/2f9e591a4034c3aea70185dcab837946096449bf"}}