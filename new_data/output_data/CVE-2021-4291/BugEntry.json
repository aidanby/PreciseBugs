{"buggy_code": ["<%\n    ui.decorateWith(\"appui\", \"standardEmrPage\")\n\n    ui.includeCss(\"adminui\", \"adminui.css\")\n\n    ui.includeJavascript(\"adminui\", \"jquery.validate.js\")\n\n    def createLocation = (location.locationId == null ? true : false);\n\n    def parentLocationOptions = []\n    existingLocations.each {\n        parentLocationOptions.push([ label: ui.escapeJs(ui.format(it)), value: it.id ])\n    }\n%>\n\n<script type=\"text/javascript\">\n    var breadcrumbs = [\n        { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n        { label: \"${ ui.message('adminui.app.configureMetadata.label')}\" , link: '${ui.pageLink(\"adminui\", \"metadata/configureMetadata\")}'},\n        { label: \"${ ui.message(\"adminui.manageLocations.label\")}\", link: '${ui.pageLink(\"adminui\",\"metadata/locations/manageLocations\")}' },\n        { label: \"${ (createLocation) ? ui.message(\"adminui.createLocation.locationManagement.label\") : ui.message(\"adminui.editLocation.locationManagement.label\")}\" }\n    ];\n\n</script>\n\n<script type=\"text/javascript\">\n\n    jq().ready(function () {\n\n        jq(\"#locationForm\").validate({\n            rules: {\n                \"name\": {\n                    required: true,\n                    minlength: 3,\n                    maxlength: 255\n                },\n                \"description\": {\n                    required: false,\n                    maxlength: 1024\n                }\n            },\n            errorClass: \"error\",\n            validClass: \"\",\n            onfocusout: function (element) {\n                jq(element).valid();\n            },\n            errorPlacement: function (error, element) {\n                element.next().text(error.text());\n            },\n            highlight: function (element, errorClass, validClass) {\n                jq(element).addClass(errorClass);\n                jq(element).next().addClass(errorClass);\n                jq(element).next().show();\n            },\n            unhighlight: function (element, errorClass, validClass) {\n                jq(element).removeClass(errorClass);\n                jq(element).next().removeClass(errorClass);\n                jq(element).next().hide();\n            }\n        });\n    });\n</script>\n\n<h2>${ (createLocation) ? ui.message(\"adminui.addNewLocation.label\") : ui.message(\"adminui.editLocation.label\") }</h2>\n\n\n<form class=\"simple-form-ui\" method=\"post\" id=\"locationForm\" autocomplete=\"off\">\n<fieldset>\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"general.name\")+\"*\",\n            formFieldName: \"name\",\n            id           : \"name\",\n            maxLength    : 101,\n            initialValue : ui.encodeHtml((location.name ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/textarea\", [\n            label        : ui.message(\"general.description\"),\n            formFieldName: \"description\",\n            id           : \"description\",\n            initialValue : ui.encodeHtml((location.description ?: ''))\n    ])}\n\n    <p>\n\t${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.address1\"),\n            formFieldName: \"address1\",\n            id           : \"address1\",\n            initialValue : ui.encodeHtml((location.address1 ?: ''))\n    ])}\n\n\t${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.address2\"),\n            formFieldName: \"address2\",\n            id           : \"address2\",\n            initialValue : ui.encodeHtml((location.address2 ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.city_village\"),\n            formFieldName: \"cityVillage\",\n            id           : \"cityVillage\",\n            initialValue : ui.encodeHtml((location.cityVillage ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.state_province\"),\n            formFieldName: \"stateProvince\",\n            id           : \"stateProvince\",\n            initialValue : ui.encodeHtml((location.stateProvince ?: ''))\n    ])}\n\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.country\"),\n            formFieldName: \"country\",\n            id           : \"country\",\n            initialValue : ui.encodeHtml((location.country ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.postalCode\"),\n            formFieldName: \"postalCode\",\n            id           : \"postalCode\",\n            initialValue : ui.encodeHtml((location.postalCode ?: ''))\n    ])}\n    </p>\n\n    ${ ui.includeFragment(\"uicommons\", \"field/dropDown\", [\n            label: ui.message(\"adminui.location.parentLocation\"),\n            emptyOptionLabel: ui.message(\"adminui.chooseOne\"),\n            formFieldName: \"parentLocation\",\n            options: parentLocationOptions,\n            initialValue : (location.parentLocation?.id  ?: '')\n    ])}\n\n    <% attributeTypes.each{ %>\n\t${ ui.includeFragment(\"uicommons\", \"field/text\", [\n\t       \tlabel: ui.encodeHtml(ui.format(it)),\n\t        formFieldName: \"attribute.\"+it.id+\"\",\n\t\t    value: it.id,\n\t\t    checked: false\n    ])}\n    <% } %>\n\n    <label>${ui.message(\"adminui.location.tags\")}</label>\n    <br>\n\t<table class=\"adminui-display-table\" cellspacing=\"0\" cellpadding=\"0\">\n\t\t<tr>\n    \t<% locationTags.eachWithIndex { tag, index -> %>\n\t\t\t<td valign=\"top\">\n\t\t        <input type=\"checkbox\" name=\"locTags\" value=\"${tag.id}\"\n                    <% if (location.tags && location.tags.contains(tag)) { %> checked='checked'<% } %>> ${ui.encodeHtml(ui.format(tag))}\n\t        </td>\n\t        <% if ((index + 1) % 2 == 0) { %> </tr> <tr> <% } %>\n    \t<% } %>\n    \t</tr>\n\t</table>\n\n    </fieldset>\n\n    <div>\n        <input type=\"button\" class=\"cancel left\" value='${ui.message(\"general.cancel\")}' onclick='window.location=\"/${ contextPath }/adminui/metadata/locations/manageLocations.page\"' />\n        <input type=\"submit\" class=\"confirm right\" name=\"save\" id=\"save-button\" value=\"${ui.message(\"general.save\")}\"/>\n    </div>\n\n</form>\n"], "fixing_code": ["<%\n    ui.decorateWith(\"appui\", \"standardEmrPage\")\n\n    ui.includeCss(\"adminui\", \"adminui.css\")\n\n    ui.includeJavascript(\"adminui\", \"jquery.validate.js\")\n\n    def createLocation = (location.locationId == null ? true : false);\n\n    def parentLocationOptions = []\n    existingLocations.each {\n        parentLocationOptions.push([ label: ui.encodeJavaScript(ui.format(it)), value: it.id ])\n    }\n%>\n\n<script type=\"text/javascript\">\n    var breadcrumbs = [\n        { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n        { label: \"${ ui.message('adminui.app.configureMetadata.label')}\" , link: '${ui.pageLink(\"adminui\", \"metadata/configureMetadata\")}'},\n        { label: \"${ ui.message(\"adminui.manageLocations.label\")}\", link: '${ui.pageLink(\"adminui\",\"metadata/locations/manageLocations\")}' },\n        { label: \"${ (createLocation) ? ui.message(\"adminui.createLocation.locationManagement.label\") : ui.message(\"adminui.editLocation.locationManagement.label\")}\" }\n    ];\n\n</script>\n\n<script type=\"text/javascript\">\n\n    jq().ready(function () {\n\n        jq(\"#locationForm\").validate({\n            rules: {\n                \"name\": {\n                    required: true,\n                    minlength: 3,\n                    maxlength: 255\n                },\n                \"description\": {\n                    required: false,\n                    maxlength: 1024\n                }\n            },\n            errorClass: \"error\",\n            validClass: \"\",\n            onfocusout: function (element) {\n                jq(element).valid();\n            },\n            errorPlacement: function (error, element) {\n                element.next().text(error.text());\n            },\n            highlight: function (element, errorClass, validClass) {\n                jq(element).addClass(errorClass);\n                jq(element).next().addClass(errorClass);\n                jq(element).next().show();\n            },\n            unhighlight: function (element, errorClass, validClass) {\n                jq(element).removeClass(errorClass);\n                jq(element).next().removeClass(errorClass);\n                jq(element).next().hide();\n            }\n        });\n    });\n</script>\n\n<h2>${ (createLocation) ? ui.message(\"adminui.addNewLocation.label\") : ui.message(\"adminui.editLocation.label\") }</h2>\n\n\n<form class=\"simple-form-ui\" method=\"post\" id=\"locationForm\" autocomplete=\"off\">\n<fieldset>\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"general.name\")+\"*\",\n            formFieldName: \"name\",\n            id           : \"name\",\n            maxLength    : 101,\n            initialValue : ui.encodeHtml((location.name ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/textarea\", [\n            label        : ui.message(\"general.description\"),\n            formFieldName: \"description\",\n            id           : \"description\",\n            initialValue : ui.encodeHtml((location.description ?: ''))\n    ])}\n\n    <p>\n\t${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.address1\"),\n            formFieldName: \"address1\",\n            id           : \"address1\",\n            initialValue : ui.encodeHtml((location.address1 ?: ''))\n    ])}\n\n\t${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.address2\"),\n            formFieldName: \"address2\",\n            id           : \"address2\",\n            initialValue : ui.encodeHtml((location.address2 ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.city_village\"),\n            formFieldName: \"cityVillage\",\n            id           : \"cityVillage\",\n            initialValue : ui.encodeHtml((location.cityVillage ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.state_province\"),\n            formFieldName: \"stateProvince\",\n            id           : \"stateProvince\",\n            initialValue : ui.encodeHtml((location.stateProvince ?: ''))\n    ])}\n\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.country\"),\n            formFieldName: \"country\",\n            id           : \"country\",\n            initialValue : ui.encodeHtml((location.country ?: ''))\n    ])}\n\n    ${ui.includeFragment(\"uicommons\", \"field/text\", [\n            label        : ui.message(\"adminui.location.postalCode\"),\n            formFieldName: \"postalCode\",\n            id           : \"postalCode\",\n            initialValue : ui.encodeHtml((location.postalCode ?: ''))\n    ])}\n    </p>\n\n    ${ ui.includeFragment(\"uicommons\", \"field/dropDown\", [\n            label: ui.message(\"adminui.location.parentLocation\"),\n            emptyOptionLabel: ui.message(\"adminui.chooseOne\"),\n            formFieldName: \"parentLocation\",\n            options: parentLocationOptions,\n            initialValue : (location.parentLocation?.id  ?: '')\n    ])}\n\n    <% attributeTypes.each{ %>\n\t${ ui.includeFragment(\"uicommons\", \"field/text\", [\n\t       \tlabel: ui.encodeHtml(ui.format(it)),\n\t        formFieldName: \"attribute.\"+it.id+\"\",\n\t\t    value: it.id,\n\t\t    checked: false\n    ])}\n    <% } %>\n\n    <label>${ui.message(\"adminui.location.tags\")}</label>\n    <br>\n\t<table class=\"adminui-display-table\" cellspacing=\"0\" cellpadding=\"0\">\n\t\t<tr>\n    \t<% locationTags.eachWithIndex { tag, index -> %>\n\t\t\t<td valign=\"top\">\n\t\t        <input type=\"checkbox\" name=\"locTags\" value=\"${tag.id}\"\n                    <% if (location.tags && location.tags.contains(tag)) { %> checked='checked'<% } %>> ${ui.encodeHtml(ui.format(tag))}\n\t        </td>\n\t        <% if ((index + 1) % 2 == 0) { %> </tr> <tr> <% } %>\n    \t<% } %>\n    \t</tr>\n\t</table>\n\n    </fieldset>\n\n    <div>\n        <input type=\"button\" class=\"cancel left\" value='${ui.message(\"general.cancel\")}' onclick='window.location=\"/${ contextPath }/adminui/metadata/locations/manageLocations.page\"' />\n        <input type=\"submit\" class=\"confirm right\" name=\"save\" id=\"save-button\" value=\"${ui.message(\"general.save\")}\"/>\n    </div>\n\n</form>\n"], "filenames": ["omod/src/main/webapp/pages/metadata/locations/location.gsp"], "buggy_code_start_loc": [12], "buggy_code_end_loc": [13], "fixing_code_start_loc": [12], "fixing_code_end_loc": [13], "type": "CWE-79", "message": "A vulnerability was found in OpenMRS Admin UI Module up to 1.5.x. It has been declared as problematic. This vulnerability affects unknown code of the file omod/src/main/webapp/pages/metadata/locations/location.gsp. The manipulation leads to cross site scripting. The attack can be initiated remotely. Upgrading to version 1.6.0 is able to address this issue. The name of the patch is a7eefb5f69f6c50a3bffcb138bb8ea57cb41a9b6. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-216916.", "other": {"cve": {"id": "CVE-2021-4291", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-27T23:15:10.677", "lastModified": "2023-01-06T02:31:09.170", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in OpenMRS Admin UI Module up to 1.5.x. It has been declared as problematic. This vulnerability affects unknown code of the file omod/src/main/webapp/pages/metadata/locations/location.gsp. The manipulation leads to cross site scripting. The attack can be initiated remotely. Upgrading to version 1.6.0 is able to address this issue. The name of the patch is a7eefb5f69f6c50a3bffcb138bb8ea57cb41a9b6. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-216916."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:openmrs:admin_ui_module:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.6.0", "matchCriteriaId": "B26A5092-9284-4F08-B333-55D2A8E18AA2"}]}]}], "references": [{"url": "https://github.com/openmrs/openmrs-module-adminui/commit/a7eefb5f69f6c50a3bffcb138bb8ea57cb41a9b6", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/openmrs/openmrs-module-adminui/pull/61", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/openmrs/openmrs-module-adminui/releases/tag/1.6.0", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.216916", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216916", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/openmrs/openmrs-module-adminui/commit/a7eefb5f69f6c50a3bffcb138bb8ea57cb41a9b6"}}