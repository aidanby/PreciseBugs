{"buggy_code": ["#!/usr/local/bin/perl\n# view_man.cgi\n# Display a single manual page\n\nrequire './man-lib.pl';\n&ReadParse();\n&ui_print_header(undef, $text{'man_title'}, \"\");\n\nif (&has_command($config{'man2html_path'})) {\n\t$ocmd = $in{'sec'} ? $config{'list_cmd_sect'}\n\t\t\t   : $config{'list_cmd'};\n\t}\nelse {\n\t$ocmd = $in{'sec'} ? $config{'man_cmd_sect'}\n\t\t\t   : $config{'man_cmd'};\n\t}\nif ($config{'strip_letters'}) {\n\t$in{'sec'} =~ s/^(\\d+).*$/$1/;\n\t}\n&set_manpath($in{'opts'});\n\n# Try various man commands, like :\n# man -s 3x Foo, man -s 3x foo, man -s 3 Foo, man -s 3 foo\n@sects = ( $in{'sec'} );\nif ($in{'sec'} =~ /^(\\d+)[^0-9]+$/) {\n\tpush(@sects, $1);\n\t}\nSECT: foreach $sec (@sects) {\n\tforeach $page ($in{'page'}, lc($in{'page'})) {\n\t\t$page =~ /\\// && &error($text{'man_epath'});\n\t\t$qpage = quotemeta($page);\n\t\t$qsec = quotemeta($sec);\n\t\t$cmd = $ocmd;\n\t\t$cmd =~ s/PAGE/$qpage/;\n\t\t$cmd =~ s/SECTION/$qsec/;\n\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\tif ($out !~ /^.*no manual entry/i && $out !~ /^.*no entry/i &&\n\t\t    $out !~ /^.*nothing appropriate/i) {\n\t\t\t# Found it\n\t\t\t$found++;\n\t\t\tlast SECT;\n\t\t\t}\n\t\t}\n\t}\nif (!$found) {\n\tprint \"<p><b>\",&text('man_noentry', \"<tt>$in{'page'}</tt>\"),\n\t      \"</b><p>\\n\";\n\t}\nelse {\n\tif (&has_command($config{'man2html_path'})) {\n\t\t# Last line only\n\t\t@lines = split(/\\r?\\n/, $out);\n\t\t$out = $lines[$#lines];\n                if ($out =~ /\\(<--\\s+(.*)\\)/) {\n                        # Output has cached file and original path\n                        $out = $1;\n                        }\n\t\t$out =~ s/ .*//;\n\t\tif( $out =~ /^.*\\.gz/i ) {\n\t\t\t$cmd = \"gunzip -c\";\n\t\t\t}\n\t\telsif ($out =~ /^.*\\.(bz2|bz)/i) {\n\t\t\t$cmd = \"bunzip2 -c\";\n\t\t\t}\n\t\telse {\n\t\t\t$cmd = \"cat\";\n\t\t\t}\n\t\t$qout = quotemeta($out);\n\t\t$manout = &backquote_command(\"$config{'man2html_path'} -v 2>&1\", 1);\n\t\tif ($manout =~ /Version:\\s+([0-9\\.]+)/i && $1 >= 3) {\n\t\t\t# New version uses a different syntax!\n\t\t\t$cmd .= \" $qout | nroff -mman | $config{'man2html_path'} --cgiurl \\\"view_man.cgi?page=\\\\\\${title}&sec=\\\\\\${section}&opts=$in{'opts'}\\\" --bare\";\n\t\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\t\t}\n\t\telse {\n\t\t\t# Old version of man2html\n\t\t\t$cmd .= \" $qout | $config{'man2html_path'} -H \\\"\\\" -M \\\"view_man.cgi\\\"\";\n\t\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\t\t$out =~ s/^.*Content-type:.*\\n//i;\n\t\t\t$out =~ s/http:\\/\\///ig;\n\t\t\t$out =~ s/\\?/\\?sec=/ig;\n\t\t\t$out =~ s/\\+/&opts=$in{'opts'}&page=/ig;\n\t\t\t$out =~ s/<HTML>.*<BODY>//isg;\n\t\t\t$out =~ s/<\\/HTML>//ig;\n\t\t\t$out =~ s/<\\/BODY>//ig;\n\t\t\t$out =~ s/<A HREF=\"file:[^\"]+\">([^<]+)<\\/a>/$1/ig;\n\t\t\t$out =~ s/<A HREF=\"view_man.cgi\">/<A HREF=\\\"\\\">/i;\n\t\t\t}\n\t\t&show_view_table(&text('man_header', $in{'page'}, $in{'sec'}),\n\t\t\t\t $out);\n\t} else {\n\t\t$out =~ s/.\\010//g;\n\t\t$out =~ s/^(man:\\s*)?(re)?formatting.*//i;\n\t\t&show_view_table(&text('man_header', $in{'page'}, $in{'sec'}),\n\t\t\t\t \"<pre>\".&html_escape($out).\"</pre>\");\n\t\t}\n\t}\n\n&ui_print_footer(\"\", $text{'index_return'});\n\n"], "fixing_code": ["#!/usr/local/bin/perl\n# view_man.cgi\n# Display a single manual page\n\nrequire './man-lib.pl';\n&ReadParse();\n&ui_print_header(undef, $text{'man_title'}, \"\");\n\nif (&has_command($config{'man2html_path'})) {\n\t$ocmd = $in{'sec'} ? $config{'list_cmd_sect'}\n\t\t\t   : $config{'list_cmd'};\n\t}\nelse {\n\t$ocmd = $in{'sec'} ? $config{'man_cmd_sect'}\n\t\t\t   : $config{'man_cmd'};\n\t}\nif ($config{'strip_letters'}) {\n\t$in{'sec'} =~ s/^(\\d+).*$/$1/;\n\t}\n&set_manpath($in{'opts'});\n\n# Try various man commands, like :\n# man -s 3x Foo, man -s 3x foo, man -s 3 Foo, man -s 3 foo\n@sects = ( $in{'sec'} );\nif ($in{'sec'} =~ /^(\\d+)[^0-9]+$/) {\n\tpush(@sects, $1);\n\t}\nSECT: foreach $sec (@sects) {\n\tforeach $page ($in{'page'}, lc($in{'page'})) {\n\t\t$page =~ /\\// && &error($text{'man_epath'});\n\t\t$qpage = quotemeta($page);\n\t\t$qsec = quotemeta($sec);\n\t\t$cmd = $ocmd;\n\t\t$cmd =~ s/PAGE/$qpage/;\n\t\t$cmd =~ s/SECTION/$qsec/;\n\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\tif ($out !~ /^.*no manual entry/i && $out !~ /^.*no entry/i &&\n\t\t    $out !~ /^.*nothing appropriate/i) {\n\t\t\t# Found it\n\t\t\t$found++;\n\t\t\tlast SECT;\n\t\t\t}\n\t\t}\n\t}\nif (!$found) {\n\tprint \"<p><b>\",&text('man_noentry',\n\t\t     \"<tt>\".&html_escape($in{'page'}).\"</tt>\"),\"</b><p>\\n\";\n\t}\nelse {\n\tif (&has_command($config{'man2html_path'})) {\n\t\t# Last line only\n\t\t@lines = split(/\\r?\\n/, $out);\n\t\t$out = $lines[$#lines];\n                if ($out =~ /\\(<--\\s+(.*)\\)/) {\n                        # Output has cached file and original path\n                        $out = $1;\n                        }\n\t\t$out =~ s/ .*//;\n\t\tif( $out =~ /^.*\\.gz/i ) {\n\t\t\t$cmd = \"gunzip -c\";\n\t\t\t}\n\t\telsif ($out =~ /^.*\\.(bz2|bz)/i) {\n\t\t\t$cmd = \"bunzip2 -c\";\n\t\t\t}\n\t\telse {\n\t\t\t$cmd = \"cat\";\n\t\t\t}\n\t\t$qout = quotemeta($out);\n\t\t$manout = &backquote_command(\"$config{'man2html_path'} -v 2>&1\", 1);\n\t\tif ($manout =~ /Version:\\s+([0-9\\.]+)/i && $1 >= 3) {\n\t\t\t# New version uses a different syntax!\n\t\t\t$cmd .= \" $qout | nroff -mman | $config{'man2html_path'} --cgiurl \\\"view_man.cgi?page=\\\\\\${title}&sec=\\\\\\${section}&opts=$in{'opts'}\\\" --bare\";\n\t\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\t\t}\n\t\telse {\n\t\t\t# Old version of man2html\n\t\t\t$cmd .= \" $qout | $config{'man2html_path'} -H \\\"\\\" -M \\\"view_man.cgi\\\"\";\n\t\t\t$out = &backquote_command(\"$cmd 2>&1\", 1);\n\t\t\t$out =~ s/^.*Content-type:.*\\n//i;\n\t\t\t$out =~ s/http:\\/\\///ig;\n\t\t\t$out =~ s/\\?/\\?sec=/ig;\n\t\t\t$out =~ s/\\+/&opts=$in{'opts'}&page=/ig;\n\t\t\t$out =~ s/<HTML>.*<BODY>//isg;\n\t\t\t$out =~ s/<\\/HTML>//ig;\n\t\t\t$out =~ s/<\\/BODY>//ig;\n\t\t\t$out =~ s/<A HREF=\"file:[^\"]+\">([^<]+)<\\/a>/$1/ig;\n\t\t\t$out =~ s/<A HREF=\"view_man.cgi\">/<A HREF=\\\"\\\">/i;\n\t\t\t}\n\t\t&show_view_table(\n\t\t\t&text('man_header',\n\t\t\t      &html_escape($in{'page'}),\n\t\t\t      &html_escape($in{'sec'})),\n\t\t\t$out);\n\t} else {\n\t\t$out =~ s/.\\010//g;\n\t\t$out =~ s/^(man:\\s*)?(re)?formatting.*//i;\n\t\t&show_view_table(\n\t\t\t&text('man_header',\n\t\t\t      &html_escape($in{'page'}),\n\t\t\t      &html_escape($in{'sec'})),\n\t\t\t\"<pre>\".&html_escape($out).\"</pre>\");\n\t\t}\n\t}\n\n&ui_print_footer(\"\", $text{'index_return'});\n\n"], "filenames": ["man/view_man.cgi"], "buggy_code_start_loc": [46], "buggy_code_end_loc": [96], "fixing_code_start_loc": [46], "fixing_code_end_loc": [102], "type": "CWE-79", "message": "Multiple Cross-site scripting (XSS) vulnerabilities in Webmin before 1.850 allow remote attackers to inject arbitrary web script or HTML via the sec parameter to view_man.cgi, the referers parameter to change_referers.cgi, or the name parameter to save_user.cgi. NOTE: these issues were not fixed in 1.840.", "other": {"cve": {"id": "CVE-2017-9313", "sourceIdentifier": "cve@mitre.org", "published": "2017-07-04T02:29:00.283", "lastModified": "2017-07-10T17:03:22.877", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Multiple Cross-site scripting (XSS) vulnerabilities in Webmin before 1.850 allow remote attackers to inject arbitrary web script or HTML via the sec parameter to view_man.cgi, the referers parameter to change_referers.cgi, or the name parameter to save_user.cgi. NOTE: these issues were not fixed in 1.840."}, {"lang": "es", "value": "M\u00faltiples vulnerabilidades de tipo cross-site-scripting (XSS) en Webmin anterior a la versi\u00f3n 1.850, permiten a los atacantes remotos inyectar script web o HTML arbitrario por medio del par\u00e1metro sec en el archivo view_man.cgi, el par\u00e1metro referers en el archivo change_referers.cgi, o el par\u00e1metro name en el archivo save_user.cgi. NOTA: estos problemas no fueron corregidos en la versi\u00f3n 1.840."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:webmin:webmin:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.840", "matchCriteriaId": "84CBDEDB-2FA2-47C2-BC5C-8AAFBC2ECAB7"}]}]}], "references": [{"url": "http://seclists.org/bugtraq/2017/Jul/3", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "http://www.securityfocus.com/bid/99373", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "http://www.securitytracker.com/id/1038814", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "http://www.webmin.com/changes.html", "source": "cve@mitre.org", "tags": ["Release Notes", "Vendor Advisory"]}, {"url": "https://github.com/webmin/webmin/commit/a330e913ee099cb9c586ce1b9267647fc566c1ab", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/webmin/webmin/commit/c2d4a90639afb2403979aa91ba75cb332ae16d1b", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/webmin/webmin/commit/a330e913ee099cb9c586ce1b9267647fc566c1ab"}}