{"buggy_code": ["#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.ComponentModel;\n#if !(NET35 || NET20)\nusing System.Collections.Concurrent;\n#endif\nusing System.Collections.Generic;\n#if !(NET20 || NET35 || PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\nusing System.Numerics;\n#endif\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\nusing System.ComponentModel.DataAnnotations;\nusing System.Configuration;\nusing System.Runtime.CompilerServices;\nusing System.Runtime.Serialization.Formatters;\nusing System.Threading;\n#endif\n#if !(NET20 || DNXCORE50)\nusing System.Web.Script.Serialization;\n#endif\nusing System.Text;\nusing System.Text.RegularExpressions;\n#if DNXCORE50\nusing Xunit;\nusing Test = Xunit.FactAttribute;\nusing Assert = Newtonsoft.Json.Tests.XUnitAssert;\n#else\nusing NUnit.Framework;\n#endif\nusing Newtonsoft.Json;\nusing System.IO;\nusing System.Collections;\nusing System.Xml;\nusing System.Xml.Serialization;\nusing System.Collections.ObjectModel;\nusing System.Diagnostics;\nusing Newtonsoft.Json.Bson;\nusing Newtonsoft.Json.Linq;\nusing Newtonsoft.Json.Converters;\n#if !(NET20 || NET35)\nusing System.Runtime.Serialization.Json;\n#endif\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Tests.Linq;\nusing Newtonsoft.Json.Tests.TestObjects;\nusing Newtonsoft.Json.Tests.TestObjects.Events;\nusing Newtonsoft.Json.Tests.TestObjects.GeoCoding;\nusing Newtonsoft.Json.Tests.TestObjects.Organization;\nusing System.Runtime.Serialization;\nusing System.Globalization;\nusing Newtonsoft.Json.Utilities;\nusing System.Reflection;\n#if !NET20\nusing System.Xml.Linq;\nusing System.Collections.Specialized;\nusing System.Linq.Expressions;\n#endif\n#if !(NET35 || NET20)\nusing System.Dynamic;\n#endif\n#if NET20\nusing Newtonsoft.Json.Utilities.LinqBridge;\nusing Action = Newtonsoft.Json.Serialization.Action;\n#else\nusing System.Linq;\n#endif\n#if !(DNXCORE50)\nusing System.Drawing;\n\n#endif\n\nnamespace Newtonsoft.Json.Tests.Serialization\n{\n    [TestFixture]\n    public class JsonSerializerTest : TestFixtureBase\n    {\n        [Test]\n        public void ListSourceSerialize()\n        {\n            ListSourceTest c = new ListSourceTest();\n            c.strprop = \"test\";\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(@\"{\"\"strprop\"\":\"\"test\"\"}\", json);\n\n            ListSourceTest c2 = JsonConvert.DeserializeObject<ListSourceTest>(json);\n\n            Assert.AreEqual(\"test\", c2.strprop);\n        }\n\n        [Test]\n        public void DeserializeImmutableStruct()\n        {\n            var result = JsonConvert.DeserializeObject<ImmutableStruct>(\"{ \\\"Value\\\": \\\"working\\\", \\\"Value2\\\": 2 }\");\n\n            Assert.AreEqual(\"working\", result.Value);\n            Assert.AreEqual(2, result.Value2);\n        }\n\n        public struct AlmostImmutableStruct\n        {\n            public AlmostImmutableStruct(string value, int value2)\n            {\n                Value = value;\n                Value2 = value2;\n            }\n\n            public string Value { get; }\n            public int Value2 { get; set; }\n        }\n\n        [Test]\n        public void DeserializeAlmostImmutableStruct()\n        {\n            var result = JsonConvert.DeserializeObject<AlmostImmutableStruct>(\"{ \\\"Value\\\": \\\"working\\\", \\\"Value2\\\": 2 }\");\n\n            Assert.AreEqual(null, result.Value);\n            Assert.AreEqual(2, result.Value2);\n        }\n\n        [Test]\n        public void DontCloseInputOnDeserializeError()\n        {\n            using (var s = System.IO.File.OpenRead(ResolvePath(\"large.json\")))\n            {\n                try\n                {\n                    using (JsonTextReader reader = new JsonTextReader(new StreamReader(s)))\n                    {\n                        reader.SupportMultipleContent = true;\n                        reader.CloseInput = false;\n\n                        // read into array\n                        reader.Read();\n\n                        var ser = new JsonSerializer();\n                        ser.CheckAdditionalContent = false;\n\n                        ser.Deserialize<IList<ErroringClass>>(reader);\n                    }\n\n                    Assert.Fail();\n                }\n                catch (Exception)\n                {\n                    Assert.IsTrue(s.Position > 0);\n\n                    s.Seek(0, SeekOrigin.Begin);\n\n                    Assert.AreEqual(0, s.Position);\n                }\n            }\n        }\n\n        [Test]\n        public void SerializeInterfaceWithHiddenProperties()\n        {\n            var mySubclass = MyFactory.InstantiateSubclass();\n            var myMainClass = MyFactory.InstantiateManiClass();\n\n            //Class implementing interface with hidden members - flat object. \n            var strJsonSubclass = JsonConvert.SerializeObject(mySubclass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"ID\"\": 123,\n  \"\"Name\"\": \"\"ABC\"\",\n  \"\"P1\"\": true,\n  \"\"P2\"\": 44\n}\", strJsonSubclass);\n\n            //Class implementing interface with hidden members - member of another class. \n            var strJsonMainClass = JsonConvert.SerializeObject(myMainClass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"ID\"\": 567,\n  \"\"Name\"\": \"\"XYZ\"\",\n  \"\"Subclass\"\": {\n    \"\"ID\"\": 123,\n    \"\"Name\"\": \"\"ABC\"\",\n    \"\"P1\"\": true,\n    \"\"P2\"\": 44\n  }\n}\", strJsonMainClass);\n        }\n\n        [Test]\n        public void DeserializeGenericIEnumerableWithImplicitConversion()\n        {\n            string deserialized = @\"{\n  \"\"Enumerable\"\": [ \"\"abc\"\", \"\"def\"\" ] \n}\";\n            var enumerableClass = JsonConvert.DeserializeObject<GenericIEnumerableWithImplicitConversion>(deserialized);\n            var enumerableObject = enumerableClass.Enumerable.ToArray();\n            Assert.AreEqual(2, enumerableObject.Length);\n            Assert.AreEqual(\"abc\", enumerableObject[0].Value);\n            Assert.AreEqual(\"def\", enumerableObject[1].Value);\n        }\n\n#if !(PORTABLE || PORTABLE40 || NET20 || NET35) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void LargeIntegerAsString()\n        {\n            var largeBrokenNumber = JsonConvert.DeserializeObject<Foo64>(\"{\\\"Blah\\\": 43443333222211111117 }\");\n            Assert.AreEqual(\"43443333222211111117\", largeBrokenNumber.Blah);\n\n            var largeOddWorkingNumber = JsonConvert.DeserializeObject<Foo64>(\"{\\\"Blah\\\": 53443333222211111117 }\");\n            Assert.AreEqual(\"53443333222211111117\", largeOddWorkingNumber.Blah);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void DeserializeMSDateTimeOffset()\n        {\n            DateTimeOffset d = JsonConvert.DeserializeObject<DateTimeOffset>(@\"\"\"/Date(1418924498000+0800)/\"\"\");\n            long initialTicks = DateTimeUtils.ConvertDateTimeToJavaScriptTicks(d.DateTime, d.Offset);\n\n            Assert.AreEqual(1418924498000, initialTicks);\n            Assert.AreEqual(8, d.Offset.Hours);\n        }\n#endif\n\n        [Test]\n        public void DeserializeBoolean_Null()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"[null]\"),\n                \"Error converting value {null} to type 'System.Boolean'. Path '[0]', line 1, position 5.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_DateTime()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['2000-12-20T10:55:55Z']\"),\n                \"Could not convert string to boolean: 2000-12-20T10:55:55Z. Path '[0]', line 1, position 23.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_BadString()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['pie']\"),\n                @\"Could not convert string to boolean: pie. Path '[0]', line 1, position 6.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_EmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['']\"),\n                @\"Error converting value {null} to type 'System.Boolean'. Path '[0]', line 1, position 3.\");\n        }\n\n#if !(PORTABLE || PORTABLE40 || NET35 || NET20) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeBooleans()\n        {\n            IList<bool> l = JsonConvert.DeserializeObject<IList<bool>>(@\"[\n  1,\n  0,\n  1.1,\n  0.0,\n  0.000000000001,\n  9999999999,\n  -9999999999,\n  9999999999999999999999999999999999999999999999999999999999999999999999,\n  -9999999999999999999999999999999999999999999999999999999999999999999999,\n  'true',\n  'TRUE',\n  'false',\n  'FALSE'\n]\");\n\n            int i = 0;\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n        }\n\n        [Test]\n        public void DeserializeNullableBooleans()\n        {\n            IList<bool?> l = JsonConvert.DeserializeObject<IList<bool?>>(@\"[\n  1,\n  0,\n  1.1,\n  0.0,\n  0.000000000001,\n  9999999999,\n  -9999999999,\n  9999999999999999999999999999999999999999999999999999999999999999999999,\n  -9999999999999999999999999999999999999999999999999999999999999999999999,\n  'true',\n  'TRUE',\n  'false',\n  'FALSE',\n  '',\n  null\n]\");\n\n            int i = 0;\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(null, l[i++]);\n            Assert.AreEqual(null, l[i++]);\n        }\n#endif\n\n        [Test]\n        public void CaseInsensitiveRequiredPropertyConstructorCreation()\n        {\n            FooRequired foo1 = new FooRequired(new[] { \"A\", \"B\", \"C\" });\n            string json = JsonConvert.SerializeObject(foo1);\n\n            StringAssert.AreEqual(@\"{\"\"Bars\"\":[\"\"A\"\",\"\"B\"\",\"\"C\"\"]}\", json);\n\n            FooRequired foo2 = JsonConvert.DeserializeObject<FooRequired>(json);\n            Assert.AreEqual(foo1.Bars.Count, foo2.Bars.Count);\n            Assert.AreEqual(foo1.Bars[0], foo2.Bars[0]);\n            Assert.AreEqual(foo1.Bars[1], foo2.Bars[1]);\n            Assert.AreEqual(foo1.Bars[2], foo2.Bars[2]);\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequired()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Binding>(\"{requiredProperty:''}\"); }, \"Required property 'RequiredProperty' expects a value but got null. Path '', line 1, position 21.\");\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequired_DisallowNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Binding_DisallowNull>(\"{requiredProperty:''}\"); }, \"Required property 'RequiredProperty' expects a non-null value. Path '', line 1, position 21.\");\n        }\n\n        [Test]\n        public void DisallowNull_NoValue()\n        {\n            Binding_DisallowNull o = JsonConvert.DeserializeObject<Binding_DisallowNull>(\"{}\");\n            Assert.IsNull(o.RequiredProperty);\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequiredConstructor()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<FooRequired>(\"{Bars:''}\"); }, \"Required property 'Bars' expects a value but got null. Path '', line 1, position 9.\");\n        }\n\n        [Test]\n        public void NoErrorWhenValueDoesNotMatchIgnoredProperty()\n        {\n            IgnoredProperty p = JsonConvert.DeserializeObject<IgnoredProperty>(\"{'StringProp1':[1,2,3],'StringProp2':{}}\");\n            Assert.IsNull(p.StringProp1);\n            Assert.IsNull(p.StringProp2);\n        }\n\n        [Test]\n        public void Serialize_Required_DisallowedNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new Binding_DisallowNull()); }, \"Cannot write a null value for property 'RequiredProperty'. Property requires a non-null value. Path ''.\");\n        }\n\n        [Test]\n        public void Serialize_Required_DisallowedNull_NullValueHandlingIgnore()\n        {\n            string json = JsonConvert.SerializeObject(new Binding_DisallowNull(), new JsonSerializerSettings\n            {\n                NullValueHandling = NullValueHandling.Ignore\n            });\n            Assert.AreEqual(\"{}\", json);\n        }\n\n        [Test]\n        public void Serialize_ItemRequired_DisallowedNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new DictionaryWithNoNull()); }, \"Cannot write a null value for property 'Name'. Property requires a non-null value. Path ''.\");\n        }\n\n        [Test]\n        public void DictionaryKeyContractResolverTest()\n        {\n            var person = new\n            {\n                Name = \"James\",\n                Age = 1,\n                RoleNames = new Dictionary<string, bool>\n                {\n                    { \"IsAdmin\", true },\n                    { \"IsModerator\", false }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(person, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = new DictionaryKeyContractResolver()\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"NAME\"\": \"\"James\"\",\n  \"\"AGE\"\": 1,\n  \"\"ROLENAMES\"\": {\n    \"\"IsAdmin\"\": true,\n    \"\"IsModerator\"\": false\n  }\n}\", json);\n        }\n\n        [Test]\n        public void IncompleteContainers()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<object>>(\"[1,\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 3.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<int>>(\"[1,\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 3.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<int>>(\"[1\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 2.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IDictionary<string, int>>(\"{'key':1,\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 9.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IDictionary<string, int>>(\"{'key':1\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 8.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IncompleteTestClass>(\"{'key':1,\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 9.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IncompleteTestClass>(\"{'key':1\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 8.\");\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeEnumsByName()\n        {\n            var e1 = JsonConvert.DeserializeObject<EnumA>(\"'ValueA'\");\n            Assert.AreEqual(EnumA.ValueA, e1);\n\n            var e2 = JsonConvert.DeserializeObject<EnumA>(\"'value_a'\", new StringEnumConverter());\n            Assert.AreEqual(EnumA.ValueA, e2);\n        }\n#endif\n\n        [Test]\n        public void RequiredPropertyTest()\n        {\n            RequiredPropertyTestClass c1 = new RequiredPropertyTestClass();\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.SerializeObject(c1),\n                \"Cannot write a null value for property 'Name'. Property requires a value. Path ''.\");\n\n            RequiredPropertyTestClass c2 = new RequiredPropertyTestClass\n            {\n                Name = \"Name!\"\n            };\n\n            string json = JsonConvert.SerializeObject(c2);\n\n            Assert.AreEqual(@\"{\"\"Name\"\":\"\"Name!\"\"}\", json);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{}\"),\n                \"Required property 'Name' not found in JSON. Path '', line 1, position 2.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{\"\"Name\"\":null}\"),\n                \"Required property 'Name' expects a value but got null. Path '', line 1, position 13.\");\n\n            RequiredPropertyTestClass c3 = JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{\"\"Name\"\":\"\"Name!\"\"}\");\n\n            Assert.AreEqual(\"Name!\", c3.Name);\n        }\n\n        [Test]\n        public void RequiredPropertyConstructorTest()\n        {\n            RequiredPropertyConstructorTestClass c1 = new RequiredPropertyConstructorTestClass(null);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.SerializeObject(c1),\n                \"Cannot write a null value for property 'Name'. Property requires a value. Path ''.\");\n\n            RequiredPropertyConstructorTestClass c2 = new RequiredPropertyConstructorTestClass(\"Name!\");\n\n            string json = JsonConvert.SerializeObject(c2);\n\n            Assert.AreEqual(@\"{\"\"Name\"\":\"\"Name!\"\"}\", json);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyConstructorTestClass>(@\"{}\"),\n                \"Required property 'Name' not found in JSON. Path '', line 1, position 2.\");\n\n            RequiredPropertyConstructorTestClass c3 = JsonConvert.DeserializeObject<RequiredPropertyConstructorTestClass>(@\"{\"\"Name\"\":\"\"Name!\"\"}\");\n\n            Assert.AreEqual(\"Name!\", c3.Name);\n        }\n\n        [Test]\n        public void NeverResolveIgnoredPropertyTypes()\n        {\n            Version v = new Version(1, 2, 3, 4);\n\n            IgnoredPropertiesTestClass c1 = new IgnoredPropertiesTestClass\n            {\n                IgnoredProperty = v,\n                IgnoredList = new List<Version>\n                {\n                    v\n                },\n                IgnoredDictionary = new Dictionary<string, Version>\n                {\n                    { \"Value\", v }\n                },\n                Name = \"Name!\"\n            };\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = new IgnoredPropertiesContractResolver()\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": \"\"Name!\"\"\n}\", json);\n\n            string deserializeJson = @\"{\n  \"\"IgnoredList\"\": [\n    {\n      \"\"Major\"\": 1,\n      \"\"Minor\"\": 2,\n      \"\"Build\"\": 3,\n      \"\"Revision\"\": 4,\n      \"\"MajorRevision\"\": 0,\n      \"\"MinorRevision\"\": 4\n    }\n  ],\n  \"\"IgnoredDictionary\"\": {\n    \"\"Value\"\": {\n      \"\"Major\"\": 1,\n      \"\"Minor\"\": 2,\n      \"\"Build\"\": 3,\n      \"\"Revision\"\": 4,\n      \"\"MajorRevision\"\": 0,\n      \"\"MinorRevision\"\": 4\n    }\n  },\n  \"\"Name\"\": \"\"Name!\"\"\n}\";\n\n            IgnoredPropertiesTestClass c2 = JsonConvert.DeserializeObject<IgnoredPropertiesTestClass>(deserializeJson, new JsonSerializerSettings\n            {\n                ContractResolver = new IgnoredPropertiesContractResolver()\n            });\n\n            Assert.AreEqual(\"Name!\", c2.Name);\n        }\n\n#if !(NET20 || NET35 || PORTABLE40)\n        [Test]\n        public void SerializeValueTuple()\n        {\n            ValueTuple<int, int, string> t = ValueTuple.Create(1, 2, \"string\");\n\n            string json = JsonConvert.SerializeObject(t, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Item1\"\": 1,\n  \"\"Item2\"\": 2,\n  \"\"Item3\"\": \"\"string\"\"\n}\", json);\n\n            ValueTuple<int, int, string> t2 = JsonConvert.DeserializeObject<ValueTuple<int, int, string>>(json);\n\n            Assert.AreEqual(1, t2.Item1);\n            Assert.AreEqual(2, t2.Item2);\n            Assert.AreEqual(\"string\", t2.Item3);\n        }\n#endif\n\n        [Test]\n        public void DeserializeStructWithConstructorAttribute()\n        {\n            ImmutableStructWithConstructorAttribute result = JsonConvert.DeserializeObject<ImmutableStructWithConstructorAttribute>(\"{ \\\"Value\\\": \\\"working\\\" }\");\n\n            Assert.AreEqual(\"working\", result.Value);\n        }\n\n        public struct ImmutableStructWithConstructorAttribute\n        {\n            [JsonConstructor]\n            public ImmutableStructWithConstructorAttribute(string value)\n            {\n                Value = value;\n            }\n\n            public string Value { get; }\n        }\n\n#if !(DNXCORE50 || NET20)\n        [Test]\n        public void SerializeMetadataType()\n        {\n            CustomerWithMetadataType c = new CustomerWithMetadataType()\n            {\n                UpdatedBy_Id = Guid.NewGuid()\n            };\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(\"{}\", json);\n\n            CustomerWithMetadataType c2 = JsonConvert.DeserializeObject<CustomerWithMetadataType>(\"{'UpdatedBy_Id':'F6E0666D-13C7-4745-B486-800812C8F6DE'}\");\n\n            Assert.AreEqual(Guid.Empty, c2.UpdatedBy_Id);\n        }\n\n        [Test]\n        public void SerializeMetadataType2()\n        {\n            FaqItem c = new FaqItem()\n            {\n                FaqId = 1,\n                Sections =\n                {\n                    new FaqSection()\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"FaqId\"\": 1,\n  \"\"Name\"\": null,\n  \"\"IsDeleted\"\": false,\n  \"\"FullSectionsProp\"\": [\n    {}\n  ]\n}\", json);\n\n            FaqItem c2 = JsonConvert.DeserializeObject<FaqItem>(json);\n\n            Assert.AreEqual(1, c2.FaqId);\n            Assert.AreEqual(1, c2.Sections.Count);\n        }\n\n        [Test]\n        public void SerializeMetadataTypeInheritance()\n        {\n            FaqItemProxy c = new FaqItemProxy();\n            c.FaqId = 1;\n            c.Sections.Add(new FaqSection());\n            c.IsProxy = true;\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"IsProxy\"\": true,\n  \"\"FaqId\"\": 1,\n  \"\"Name\"\": null,\n  \"\"IsDeleted\"\": false,\n  \"\"FullSectionsProp\"\": [\n    {}\n  ]\n}\", json);\n\n            FaqItemProxy c2 = JsonConvert.DeserializeObject<FaqItemProxy>(json);\n\n            Assert.AreEqual(1, c2.FaqId);\n            Assert.AreEqual(1, c2.Sections.Count);\n        }\n#endif\n\n        [Test]\n        public void DeserializeNullToJTokenProperty()\n        {\n            NullTestClass otc = JsonConvert.DeserializeObject<NullTestClass>(@\"{\n    \"\"Value1\"\": null,\n    \"\"Value2\"\": null,\n    \"\"Value3\"\": null,\n    \"\"Value4\"\": null,\n    \"\"Value5\"\": null\n}\");\n            Assert.IsNull(otc.Value1);\n            Assert.AreEqual(JTokenType.Null, otc.Value2.Type);\n            Assert.AreEqual(JTokenType.Raw, otc.Value3.Type);\n            Assert.AreEqual(JTokenType.Null, otc.Value4.Type);\n            Assert.IsNull(otc.Value5);\n        }\n\n#if !(NET20 || NET35 || PORTABLE40 || PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ReadIntegerWithError()\n        {\n            string json = @\"{\n    ParentId: 1,\n    ChildId: 333333333333333333333333333333333333333\n}\";\n\n            Link l = JsonConvert.DeserializeObject<Link>(json, new JsonSerializerSettings\n            {\n                Error = (s, a) => a.ErrorContext.Handled = true\n            });\n\n            Assert.AreEqual(0, l.ChildId);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void DeserializeObservableCollection()\n        {\n            ObservableCollection<string> s = JsonConvert.DeserializeObject<ObservableCollection<string>>(\"['1','2']\");\n            Assert.AreEqual(2, s.Count);\n            Assert.AreEqual(\"1\", s[0]);\n            Assert.AreEqual(\"2\", s[1]);\n        }\n\n        [Test]\n        public void SerializeObservableCollection()\n        {\n            ObservableCollection<string> c1 = new ObservableCollection<string> { \"1\", \"2\" };\n\n            string output = JsonConvert.SerializeObject(c1);\n            Assert.AreEqual(\"[\\\"1\\\",\\\"2\\\"]\", output);\n\n            ObservableCollection<string> c2 = JsonConvert.DeserializeObject<ObservableCollection<string>>(output);\n            Assert.AreEqual(2, c2.Count);\n            Assert.AreEqual(\"1\", c2[0]);\n            Assert.AreEqual(\"2\", c2[1]);\n        }\n#endif\n\n        [Test]\n        public void DeserializeBoolAsStringInDictionary()\n        {\n            Dictionary<string, string> d = JsonConvert.DeserializeObject<Dictionary<string, string>>(\"{\\\"Test1\\\":false}\");\n            Assert.AreEqual(1, d.Count);\n            Assert.AreEqual(\"false\", d[\"Test1\"]);\n        }\n\n#if !NET20\n        [Test]\n        public void PopulateResetSettings()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(@\"[\"\"2000-01-01T01:01:01+00:00\"\"]\"));\n            Assert.AreEqual(DateParseHandling.DateTime, reader.DateParseHandling);\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.DateParseHandling = DateParseHandling.DateTimeOffset;\n\n            IList<object> l = new List<object>();\n            serializer.Populate(reader, l);\n\n            Assert.AreEqual(typeof(DateTimeOffset), l[0].GetType());\n            Assert.AreEqual(new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero), l[0]);\n\n            Assert.AreEqual(DateParseHandling.DateTime, reader.DateParseHandling);\n        }\n#endif\n\n        [Test]\n        public void NewProperty()\n        {\n            Assert.AreEqual(@\"{\"\"IsTransient\"\":true}\", JsonConvert.SerializeObject(new ChildClass { IsTransient = true }));\n\n            var childClass = JsonConvert.DeserializeObject<ChildClass>(@\"{\"\"IsTransient\"\":true}\");\n            Assert.AreEqual(true, childClass.IsTransient);\n        }\n\n        [Test]\n        public void NewPropertyVirtual()\n        {\n            Assert.AreEqual(@\"{\"\"IsTransient\"\":true}\", JsonConvert.SerializeObject(new ChildClassVirtual { IsTransient = true }));\n\n            var childClass = JsonConvert.DeserializeObject<ChildClassVirtual>(@\"{\"\"IsTransient\"\":true}\");\n            Assert.AreEqual(true, childClass.IsTransient);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgument()\n        {\n            var input = new ResponseWithNewGenericProperty<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericProperty<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgumentVirtual()\n        {\n            var input = new ResponseWithNewGenericPropertyVirtual<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericPropertyVirtual<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgumentOverride()\n        {\n            var input = new ResponseWithNewGenericPropertyOverride<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericPropertyOverride<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializedWithGenericClosedTypeAsArgument()\n        {\n            var input = new ResponseWithNewGenericProperty<List<int>>()\n            {\n                Message = \"More complex case - generic list of int\",\n                Data = Enumerable.Range(50, 70).ToList(),\n                Result = \"This should be fine too\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericProperty<List<int>>>(json);\n\n            CollectionAssert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void DeserializeVersionString()\n        {\n            string json = \"['1.2.3.4']\";\n            List<Version> deserialized = JsonConvert.DeserializeObject<List<Version>>(json);\n\n            Assert.AreEqual(1, deserialized[0].Major);\n            Assert.AreEqual(2, deserialized[0].Minor);\n            Assert.AreEqual(3, deserialized[0].Build);\n            Assert.AreEqual(4, deserialized[0].Revision);\n        }\n\n        [Test]\n        public void DeserializeVersionString_Fail()\n        {\n            string json = \"['1.2.3.4444444444444444444444']\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<List<Version>>(json); }, @\"Error converting value \"\"1.2.3.4444444444444444444444\"\" to type 'System.Version'. Path '[0]', line 1, position 31.\");\n        }\n\n        [Test]\n        public void DeserializeJObjectWithComments()\n        {\n            string json = @\"/* Test */\n            {\n                /*Test*/\"\"A\"\":/* Test */true/* Test */,\n                /* Test */\"\"B\"\":/* Test */false/* Test */,\n                /* Test */\"\"C\"\":/* Test */[\n                    /* Test */\n                    1/* Test */\n                ]/* Test */\n            }\n            /* Test */\";\n            JObject o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(3, o.Count);\n            Assert.AreEqual(true, (bool)o[\"A\"]);\n            Assert.AreEqual(false, (bool)o[\"B\"]);\n            Assert.AreEqual(1, o[\"C\"].Count());\n            Assert.AreEqual(1, (int)o[\"C\"][0]);\n\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n\n            json = @\"{/* Test */}\";\n            o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(0, o.Count);\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n\n            json = @\"{\"\"A\"\": true/* Test */}\";\n            o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(1, o.Count);\n            Assert.AreEqual(true, (bool)o[\"A\"]);\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n        }\n\n        [Test]\n        public void DeserializeCommentTestObjectWithComments()\n        {\n            CommentTestObject o = JsonConvert.DeserializeObject<CommentTestObject>(@\"{/* Test */}\");\n            Assert.AreEqual(null, o.A);\n\n            o = JsonConvert.DeserializeObject<CommentTestObject>(@\"{\"\"A\"\": true/* Test */}\");\n            Assert.AreEqual(true, o.A);\n        }\n\n        [Test]\n        public void JsonSerializerProperties()\n        {\n            JsonSerializer serializer = new JsonSerializer();\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializer.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            serializer.Binder = customBinder;\n            Assert.AreEqual(customBinder, serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            Assert.IsInstanceOf(typeof(DefaultSerializationBinder), serializer.SerializationBinder);\n\n            serializer.SerializationBinder = customBinder;\n            Assert.AreEqual(customBinder, serializer.SerializationBinder);\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            // can still fetch because DefaultSerializationBinder inherits from SerializationBinder\n            Assert.AreEqual(customBinder, serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            serializer.CheckAdditionalContent = true;\n            Assert.AreEqual(true, serializer.CheckAdditionalContent);\n\n            serializer.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, serializer.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            serializer.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), serializer.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            serializer.ContractResolver = resolver;\n            Assert.AreEqual(resolver, serializer.ContractResolver);\n\n            serializer.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, serializer.Converters.Count);\n\n            serializer.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", serializer.Culture.ToString());\n\n            serializer.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, serializer.EqualityComparer);\n\n            serializer.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, serializer.DateFormatHandling);\n\n            serializer.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", serializer.DateFormatString);\n\n            serializer.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, serializer.DateParseHandling);\n\n            serializer.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, serializer.DateTimeZoneHandling);\n\n            serializer.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, serializer.DefaultValueHandling);\n\n            serializer.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, serializer.FloatFormatHandling);\n\n            serializer.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, serializer.FloatParseHandling);\n\n            serializer.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, serializer.Formatting);\n\n            serializer.MaxDepth = 9001;\n            Assert.AreEqual(9001, serializer.MaxDepth);\n\n            serializer.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, serializer.MissingMemberHandling);\n\n            serializer.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, serializer.NullValueHandling);\n\n            serializer.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, serializer.ObjectCreationHandling);\n\n            serializer.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, serializer.PreserveReferencesHandling);\n\n            serializer.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, serializer.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n            serializer.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, serializer.ReferenceResolver);\n\n            serializer.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, serializer.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializer.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, serializer.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            serializer.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, serializer.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializer.TypeNameAssemblyFormatHandling);\n\n            serializer.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, serializer.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            serializer.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializer.TypeNameAssemblyFormatHandling);\n\n            serializer.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, serializer.TypeNameHandling);\n        }\n\n        [Test]\n        public void JsonSerializerSettingsProperties()\n        {\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNull(settings.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNull(settings.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            settings.Binder = customBinder;\n            Assert.AreEqual(customBinder, settings.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            settings.CheckAdditionalContent = true;\n            Assert.AreEqual(true, settings.CheckAdditionalContent);\n\n            settings.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, settings.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            settings.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), settings.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            settings.ContractResolver = resolver;\n            Assert.AreEqual(resolver, settings.ContractResolver);\n\n            settings.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, settings.Converters.Count);\n\n            settings.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", settings.Culture.ToString());\n\n            settings.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, settings.EqualityComparer);\n\n            settings.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, settings.DateFormatHandling);\n\n            settings.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", settings.DateFormatString);\n\n            settings.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, settings.DateParseHandling);\n\n            settings.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, settings.DateTimeZoneHandling);\n\n            settings.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, settings.DefaultValueHandling);\n\n            settings.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, settings.FloatFormatHandling);\n\n            settings.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, settings.FloatParseHandling);\n\n            settings.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, settings.Formatting);\n\n            settings.MaxDepth = 9001;\n            Assert.AreEqual(9001, settings.MaxDepth);\n\n            settings.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, settings.MissingMemberHandling);\n\n            settings.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, settings.NullValueHandling);\n\n            settings.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, settings.ObjectCreationHandling);\n\n            settings.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, settings.PreserveReferencesHandling);\n\n            settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, settings.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n#pragma warning disable 618\n            settings.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolver);\n#pragma warning restore 618\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolverProvider());\n\n            settings.ReferenceResolverProvider = () => referenceResolver;\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolverProvider());\n\n            settings.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, settings.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            settings.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, settings.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            settings.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, settings.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, settings.TypeNameAssemblyFormatHandling);\n\n            settings.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, settings.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            settings.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, settings.TypeNameAssemblyFormatHandling);\n\n            settings.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, settings.TypeNameHandling);\n        }\n\n        [Test]\n        public void JsonSerializerProxyProperties()\n        {\n            JsonSerializerProxy serializerProxy = new JsonSerializerProxy(new JsonSerializerInternalReader(new JsonSerializer()));\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializerProxy.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            serializerProxy.Binder = customBinder;\n            Assert.AreEqual(customBinder, serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            Assert.IsInstanceOf(typeof(DefaultSerializationBinder), serializerProxy.SerializationBinder);\n\n            serializerProxy.SerializationBinder = customBinder;\n            Assert.AreEqual(customBinder, serializerProxy.SerializationBinder);\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            // can still fetch because DefaultSerializationBinder inherits from SerializationBinder\n            Assert.AreEqual(customBinder, serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n\n            serializerProxy.CheckAdditionalContent = true;\n            Assert.AreEqual(true, serializerProxy.CheckAdditionalContent);\n\n            serializerProxy.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, serializerProxy.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            serializerProxy.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), serializerProxy.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            serializerProxy.ContractResolver = resolver;\n            Assert.AreEqual(resolver, serializerProxy.ContractResolver);\n\n            serializerProxy.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, serializerProxy.Converters.Count);\n\n            serializerProxy.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", serializerProxy.Culture.ToString());\n\n            serializerProxy.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, serializerProxy.EqualityComparer);\n\n            serializerProxy.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, serializerProxy.DateFormatHandling);\n\n            serializerProxy.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", serializerProxy.DateFormatString);\n\n            serializerProxy.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, serializerProxy.DateParseHandling);\n\n            serializerProxy.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, serializerProxy.DateTimeZoneHandling);\n\n            serializerProxy.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, serializerProxy.DefaultValueHandling);\n\n            serializerProxy.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, serializerProxy.FloatFormatHandling);\n\n            serializerProxy.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, serializerProxy.FloatParseHandling);\n\n            serializerProxy.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, serializerProxy.Formatting);\n\n            serializerProxy.MaxDepth = 9001;\n            Assert.AreEqual(9001, serializerProxy.MaxDepth);\n\n            serializerProxy.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, serializerProxy.MissingMemberHandling);\n\n            serializerProxy.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, serializerProxy.NullValueHandling);\n\n            serializerProxy.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, serializerProxy.ObjectCreationHandling);\n\n            serializerProxy.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, serializerProxy.PreserveReferencesHandling);\n\n            serializerProxy.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, serializerProxy.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n            serializerProxy.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, serializerProxy.ReferenceResolver);\n\n            serializerProxy.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, serializerProxy.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializerProxy.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, serializerProxy.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            serializerProxy.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, serializerProxy.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializerProxy.TypeNameAssemblyFormatHandling);\n\n            serializerProxy.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, serializerProxy.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            serializerProxy.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializerProxy.TypeNameAssemblyFormatHandling);\n\n            serializerProxy.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, serializerProxy.TypeNameHandling);\n        }\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeISerializableIConvertible()\n        {\n            Ratio ratio = new Ratio(2, 1);\n            string json = JsonConvert.SerializeObject(ratio);\n\n            Assert.AreEqual(@\"{\"\"n\"\":2,\"\"d\"\":1}\", json);\n\n            Ratio ratio2 = JsonConvert.DeserializeObject<Ratio>(json);\n\n            Assert.AreEqual(ratio.Denominator, ratio2.Denominator);\n            Assert.AreEqual(ratio.Numerator, ratio2.Numerator);\n        }\n    \n        [Test]\n        public void PreserveReferencesCallbackTest()\n        {\n            var p1 = new PersonReference\n            {\n                Name = \"John Smith\"\n            };\n            var p2 = new PersonReference\n            {\n                Name = \"Mary Sue\",\n            };\n\n            p1.Spouse = p2;\n            p2.Spouse = p1;\n\n            var obj = new PreserveReferencesCallbackTestObject(\"string!\", 42, p1, p2, p1);\n            obj._parent = obj;\n\n            var settings = new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.All,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(obj, settings);\n\n            StringAssert.AreEqual(json, @\"{\n  \"\"$id\"\": \"\"1\"\",\n  \"\"stringValue\"\": \"\"string!\"\",\n  \"\"intValue\"\": 42,\n  \"\"person1\"\": {\n    \"\"$id\"\": \"\"2\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"3\"\",\n      \"\"Name\"\": \"\"Mary Sue\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"2\"\"\n      }\n    }\n  },\n  \"\"person2\"\": {\n    \"\"$ref\"\": \"\"3\"\"\n  },\n  \"\"person3\"\": {\n    \"\"$ref\"\": \"\"2\"\"\n  },\n  \"\"parent\"\": {\n    \"\"$ref\"\": \"\"1\"\"\n  }\n}\");\n\n            PreserveReferencesCallbackTestObject obj2 = JsonConvert.DeserializeObject<PreserveReferencesCallbackTestObject>(json);\n\n            Assert.AreEqual(obj._stringValue, obj2._stringValue);\n            Assert.AreEqual(obj._intValue, obj2._intValue);\n            Assert.AreEqual(obj._person1.Name, obj2._person1.Name);\n            Assert.AreEqual(obj._person2.Name, obj2._person2.Name);\n            Assert.AreEqual(obj._person3.Name, obj2._person3.Name);\n            Assert.AreEqual(obj2._person1, obj2._person3);\n            Assert.AreEqual(obj2._person1.Spouse, obj2._person2);\n            Assert.AreEqual(obj2._person2.Spouse, obj2._person1);\n            Assert.AreEqual(obj2._parent, obj2);\n        }\n#endif\n\n        [Test]\n        public void DeserializeLargeFloat()\n        {\n            object o = JsonConvert.DeserializeObject(\"100000000000000000000000000000000000000.0\");\n\n            CustomAssert.IsInstanceOfType(typeof(double), o);\n\n            Assert.IsTrue(MathUtils.ApproxEquals(1E+38, (double)o));\n        }\n\n        [Test]\n        public void SerializeDeserializeRegex()\n        {\n            Regex regex = new Regex(\"(hi)\", RegexOptions.CultureInvariant);\n\n            string json = JsonConvert.SerializeObject(regex, Formatting.Indented);\n\n            Regex r2 = JsonConvert.DeserializeObject<Regex>(json);\n\n            Assert.AreEqual(\"(hi)\", r2.ToString());\n            Assert.AreEqual(RegexOptions.CultureInvariant, r2.Options);\n        }\n\n        [Test]\n        public void EmbedJValueStringInNewJObject()\n        {\n            string s = null;\n            var v = new JValue(s);\n            var o = JObject.FromObject(new { title = v });\n\n            JObject oo = new JObject\n            {\n                { \"title\", v }\n            };\n\n            string output = o.ToString();\n\n            Assert.AreEqual(null, v.Value);\n            Assert.AreEqual(JTokenType.String, v.Type);\n\n            StringAssert.AreEqual(@\"{\n  \"\"title\"\": null\n}\", output);\n        }\n\n        // bug: the generic member (T) that hides the base member will not\n        // be used when serializing and deserializing the object,\n        // resulting in unexpected behavior during serialization and deserialization.\n\n        [Test]\n        public void BaseClassSerializesAsExpected()\n        {\n            var original = new Foo1 { foo = \"value\" };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":\"\"value\"\"}\";\n            Assert.AreEqual(expectedJson, json); // passes\n        }\n\n        [Test]\n        public void BaseClassDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":\"\"value\"\"}\";\n            var deserialized = JsonConvert.DeserializeObject<Foo1>(json);\n            Assert.AreEqual(\"value\", deserialized.foo); // passes\n        }\n\n        [Test]\n        public void DerivedClassHidingBasePropertySerializesAsExpected()\n        {\n            var original = new FooBar1 { foo = new Bar1 { bar = \"value\" } };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"}}\";\n            Assert.AreEqual(expectedJson, json); // passes\n        }\n\n        [Test]\n        public void DerivedClassHidingBasePropertyDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"}}\";\n            var deserialized = JsonConvert.DeserializeObject<FooBar1>(json);\n            Assert.IsNotNull(deserialized.foo); // passes\n            Assert.AreEqual(\"value\", deserialized.foo.bar); // passes\n        }\n\n        [Test]\n        public void DerivedGenericClassHidingBasePropertySerializesAsExpected()\n        {\n            var original = new Foo1<Bar1> { foo = new Bar1 { bar = \"value\" }, foo2 = new Bar1 { bar = \"value2\" } };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"},\"\"foo2\"\":{\"\"bar\"\":\"\"value2\"\"}}\";\n            Assert.AreEqual(expectedJson, json);\n        }\n\n        [Test]\n        public void DerivedGenericClassHidingBasePropertyDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"},\"\"foo2\"\":{\"\"bar\"\":\"\"value2\"\"}}\";\n            var deserialized = JsonConvert.DeserializeObject<Foo1<Bar1>>(json);\n            Assert.IsNotNull(deserialized.foo2); // passes (bug only occurs for generics that /hide/ another property)\n            Assert.AreEqual(\"value2\", deserialized.foo2.bar); // also passes, with no issue\n            Assert.IsNotNull(deserialized.foo);\n            Assert.AreEqual(\"value\", deserialized.foo.bar);\n        }\n\n        [Test]\n        public void ConversionOperator()\n        {\n            // Creating a simple dictionary that has a non-string key\n            var dictStore = new Dictionary<DictionaryKeyCast, int>();\n            for (var i = 0; i < 800; i++)\n            {\n                dictStore.Add(new DictionaryKeyCast(i.ToString(CultureInfo.InvariantCulture), i), i);\n            }\n            var settings = new JsonSerializerSettings { Formatting = Formatting.Indented };\n            var jsonSerializer = JsonSerializer.Create(settings);\n            var ms = new MemoryStream();\n\n            var streamWriter = new StreamWriter(ms);\n            jsonSerializer.Serialize(streamWriter, dictStore);\n            streamWriter.Flush();\n\n            ms.Seek(0, SeekOrigin.Begin);\n\n            var stopWatch = Stopwatch.StartNew();\n            var deserialize = jsonSerializer.Deserialize(new StreamReader(ms), typeof(Dictionary<DictionaryKeyCast, int>));\n            stopWatch.Stop();\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void ChildDataContractTestWithHidden()\n        {\n            var cc = new ChildDataContractWithHidden\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\",\n                NewMember = \"NewMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"NewMember\"\":\"\"NewMember!\"\",\"\"virtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void SubWithoutContractNewPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithoutContractNewProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"WithDataMemberSub\"\": \"\"WithDataMember!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithoutContractVirtualPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithoutContractVirtualProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = JsonConvert.SerializeObject(baseWith, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualSub\"\": \"\"Virtual2!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithContractNewPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithContractNewProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"JustAProperty2\"\": \"\"JustAProperty!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"Virtual2\"\": \"\"Virtual!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"WithDataMemberSub\"\": \"\"WithDataMember!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithContractVirtualPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithContractVirtualProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\"\n}\", json);\n        }\n\n        private string AssertSerializeDeserializeEqual(object o)\n        {\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer s = new DataContractJsonSerializer(o.GetType());\n            s.WriteObject(ms, o);\n\n            var data = ms.ToArray();\n            JObject dataContractJson = JObject.Parse(Encoding.UTF8.GetString(data, 0, data.Length));\n            dataContractJson = new JObject(dataContractJson.Properties().OrderBy(p => p.Name));\n\n            JObject jsonNetJson = JObject.Parse(JsonConvert.SerializeObject(o));\n            jsonNetJson = new JObject(jsonNetJson.Properties().OrderBy(p => p.Name));\n\n            //Console.WriteLine(\"Results for \" + o.GetType().Name);\n            //Console.WriteLine(\"DataContractJsonSerializer: \" + dataContractJson);\n            //Console.WriteLine(\"JsonDotNetSerializer      : \" + jsonNetJson);\n\n            Assert.AreEqual(dataContractJson.Count, jsonNetJson.Count);\n            foreach (KeyValuePair<string, JToken> property in dataContractJson)\n            {\n                Assert.IsTrue(JToken.DeepEquals(jsonNetJson[property.Key], property.Value), \"Property not equal: \" + property.Key);\n            }\n\n            return jsonNetJson.ToString();\n        }\n#endif\n\n        [Test]\n        public void PersonTypedObjectDeserialization()\n        {\n            Store store = new Store();\n\n            string jsonText = JsonConvert.SerializeObject(store);\n\n            Store deserializedStore = (Store)JsonConvert.DeserializeObject(jsonText, typeof(Store));\n\n            Assert.AreEqual(store.Establised, deserializedStore.Establised);\n            Assert.AreEqual(store.product.Count, deserializedStore.product.Count);\n\n            Console.WriteLine(jsonText);\n        }\n\n        [Test]\n        public void TypedObjectDeserialization()\n        {\n            Product product = new Product();\n\n            product.Name = \"Apple\";\n            product.ExpiryDate = new DateTime(2008, 12, 28);\n            product.Price = 3.99M;\n            product.Sizes = new string[] { \"Small\", \"Medium\", \"Large\" };\n\n            string output = JsonConvert.SerializeObject(product);\n            //{\n            //  \"Name\": \"Apple\",\n            //  \"ExpiryDate\": \"\\/Date(1230375600000+1300)\\/\",\n            //  \"Price\": 3.99,\n            //  \"Sizes\": [\n            //    \"Small\",\n            //    \"Medium\",\n            //    \"Large\"\n            //  ]\n            //}\n\n            Product deserializedProduct = (Product)JsonConvert.DeserializeObject(output, typeof(Product));\n\n            Assert.AreEqual(\"Apple\", deserializedProduct.Name);\n            Assert.AreEqual(new DateTime(2008, 12, 28), deserializedProduct.ExpiryDate);\n            Assert.AreEqual(3.99m, deserializedProduct.Price);\n            Assert.AreEqual(\"Small\", deserializedProduct.Sizes[0]);\n            Assert.AreEqual(\"Medium\", deserializedProduct.Sizes[1]);\n            Assert.AreEqual(\"Large\", deserializedProduct.Sizes[2]);\n        }\n\n        //[Test]\n        //public void Advanced()\n        //{\n        //  Product product = new Product();\n        //  product.ExpiryDate = new DateTime(2008, 12, 28);\n\n        //  JsonSerializer serializer = new JsonSerializer();\n        //  serializer.Converters.Add(new JavaScriptDateTimeConverter());\n        //  serializer.NullValueHandling = NullValueHandling.Ignore;\n\n        //  using (StreamWriter sw = new StreamWriter(@\"c:\\json.txt\"))\n        //  using (JsonWriter writer = new JsonTextWriter(sw))\n        //  {\n        //    serializer.Serialize(writer, product);\n        //    // {\"ExpiryDate\":new Date(1230375600000),\"Price\":0}\n        //  }\n        //}\n\n        [Test]\n        public void JsonConvertSerializer()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Price\"\":3.99, \"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\"}\";\n\n            Product p = JsonConvert.DeserializeObject(value, typeof(Product)) as Product;\n\n            Assert.AreEqual(\"Orange\", p.Name);\n            Assert.AreEqual(new DateTime(2010, 1, 24, 12, 0, 0), p.ExpiryDate);\n            Assert.AreEqual(3.99m, p.Price);\n        }\n\n        [Test]\n        public void DeserializeJavaScriptDate()\n        {\n            DateTime dateValue = new DateTime(2010, 3, 30);\n            Dictionary<string, object> testDictionary = new Dictionary<string, object>();\n            testDictionary[\"date\"] = dateValue;\n\n            string jsonText = JsonConvert.SerializeObject(testDictionary);\n\n#if !(NET20 || NET35)\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(Dictionary<string, object>));\n            serializer.WriteObject(ms, testDictionary);\n\n            byte[] data = ms.ToArray();\n            string output = Encoding.UTF8.GetString(data, 0, data.Length);\n#endif\n\n            Dictionary<string, object> deserializedDictionary = (Dictionary<string, object>)JsonConvert.DeserializeObject(jsonText, typeof(Dictionary<string, object>));\n            DateTime deserializedDate = (DateTime)deserializedDictionary[\"date\"];\n\n            Assert.AreEqual(dateValue, deserializedDate);\n        }\n\n        [Test]\n        public void TestMethodExecutorObject()\n        {\n            MethodExecutorObject executorObject = new MethodExecutorObject();\n            executorObject.serverClassName = \"BanSubs\";\n            executorObject.serverMethodParams = new object[] { \"21321546\", \"101\", \"1236\", \"D:\\\\1.txt\" };\n            executorObject.clientGetResultFunction = \"ClientBanSubsCB\";\n\n            string output = JsonConvert.SerializeObject(executorObject);\n\n            MethodExecutorObject executorObject2 = JsonConvert.DeserializeObject(output, typeof(MethodExecutorObject)) as MethodExecutorObject;\n\n            Assert.AreNotSame(executorObject, executorObject2);\n            Assert.AreEqual(executorObject2.serverClassName, \"BanSubs\");\n            Assert.AreEqual(executorObject2.serverMethodParams.Length, 4);\n            CustomAssert.Contains(executorObject2.serverMethodParams, \"101\");\n            Assert.AreEqual(executorObject2.clientGetResultFunction, \"ClientBanSubsCB\");\n        }\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void HashtableDeserialization()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Price\"\":3.99, \"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\"}\";\n\n            Hashtable p = JsonConvert.DeserializeObject(value, typeof(Hashtable)) as Hashtable;\n\n            Assert.AreEqual(\"Orange\", p[\"Name\"].ToString());\n        }\n\n        [Test]\n        public void TypedHashtableDeserialization()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Hash\"\":{\"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\",\"\"UntypedArray\"\":[\"\"01/24/2010 12:00:00\"\"]}}\";\n\n            TypedSubHashtable p = JsonConvert.DeserializeObject(value, typeof(TypedSubHashtable)) as TypedSubHashtable;\n\n            Assert.AreEqual(\"01/24/2010 12:00:00\", p.Hash[\"ExpiryDate\"].ToString());\n            StringAssert.AreEqual(@\"[\n  \"\"01/24/2010 12:00:00\"\"\n]\", p.Hash[\"UntypedArray\"].ToString());\n        }\n#endif\n\n        [Test]\n        public void SerializeDeserializeGetOnlyProperty()\n        {\n            string value = JsonConvert.SerializeObject(new GetOnlyPropertyClass());\n\n            GetOnlyPropertyClass c = JsonConvert.DeserializeObject<GetOnlyPropertyClass>(value);\n\n            Assert.AreEqual(c.Field, \"Field\");\n            Assert.AreEqual(c.GetOnlyProperty, \"GetOnlyProperty\");\n        }\n\n        [Test]\n        public void SerializeDeserializeSetOnlyProperty()\n        {\n            string value = JsonConvert.SerializeObject(new SetOnlyPropertyClass());\n\n            SetOnlyPropertyClass c = JsonConvert.DeserializeObject<SetOnlyPropertyClass>(value);\n\n            Assert.AreEqual(c.Field, \"Field\");\n        }\n\n        [Test]\n        public void JsonIgnoreAttributeTest()\n        {\n            string json = JsonConvert.SerializeObject(new JsonIgnoreAttributeTestClass());\n\n            Assert.AreEqual(@\"{\"\"Field\"\":0,\"\"Property\"\":21}\", json);\n\n            JsonIgnoreAttributeTestClass c = JsonConvert.DeserializeObject<JsonIgnoreAttributeTestClass>(@\"{\"\"Field\"\":99,\"\"Property\"\":-1,\"\"IgnoredField\"\":-1,\"\"IgnoredObject\"\":[1,2,3,4,5]}\");\n\n            Assert.AreEqual(0, c.IgnoredField);\n            Assert.AreEqual(99, c.Field);\n        }\n\n        [Test]\n        public void GoogleSearchAPI()\n        {\n            string json = @\"{\n    results:\n        [\n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://www.google.com/\"\",\n                url : \"\"http://www.google.com/\"\",\n                visibleUrl : \"\"www.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:zhool8dxBV4J:www.google.com\"\",\n                title : \"\"Google\"\",\n                titleNoFormatting : \"\"Google\"\",\n                content : \"\"Enables users to search the Web, Usenet, and \nimages. Features include PageRank,   caching and translation of \nresults, and an option to find similar pages.\"\"\n            },\n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://news.google.com/\"\",\n                url : \"\"http://news.google.com/\"\",\n                visibleUrl : \"\"news.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:Va_XShOz_twJ:news.google.com\"\",\n                title : \"\"Google News\"\",\n                titleNoFormatting : \"\"Google News\"\",\n                content : \"\"Aggregated headlines and a search engine of many of the world's news sources.\"\"\n            },\n            \n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://groups.google.com/\"\",\n                url : \"\"http://groups.google.com/\"\",\n                visibleUrl : \"\"groups.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:x2uPD3hfkn0J:groups.google.com\"\",\n                title : \"\"Google Groups\"\",\n                titleNoFormatting : \"\"Google Groups\"\",\n                content : \"\"Enables users to search and browse the Usenet \narchives which consist of over 700   million messages, and post new \ncomments.\"\"\n            },\n            \n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://maps.google.com/\"\",\n                url : \"\"http://maps.google.com/\"\",\n                visibleUrl : \"\"maps.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:dkf5u2twBXIJ:maps.google.com\"\",\n                title : \"\"Google Maps\"\",\n                titleNoFormatting : \"\"Google Maps\"\",\n                content : \"\"Provides directions, interactive maps, and \nsatellite/aerial imagery of the United   States. Can also search by \nkeyword such as type of business.\"\"\n            }\n        ],\n        \n    adResults:\n        [\n            {\n                GsearchResultClass:\"\"GwebSearch.ad\"\",\n                title : \"\"Gartner Symposium/ITxpo\"\",\n                content1 : \"\"Meet brilliant Gartner IT analysts\"\",\n                content2 : \"\"20-23 May 2007- Barcelona, Spain\"\",\n                url : \n\"\"http://www.google.com/url?sa=L&ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB&num=1&q=http://www.gartner.com/it/sym/2007/spr8/spr8.jsp%3Fsrc%3D_spain_07_%26WT.srch%3D1&usg=__CxRH06E4Xvm9Muq13S4MgMtnziY=\"\", \n\n                impressionUrl : \n\"\"http://www.google.com/uds/css/ad-indicator-on.gif?ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB\"\", \n\n                unescapedUrl : \n\"\"http://www.google.com/url?sa=L&ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB&num=1&q=http://www.gartner.com/it/sym/2007/spr8/spr8.jsp%3Fsrc%3D_spain_07_%26WT.srch%3D1&usg=__CxRH06E4Xvm9Muq13S4MgMtnziY=\"\", \n\n                visibleUrl : \"\"www.gartner.com\"\"\n            }\n        ]\n}\n\";\n            object o = JsonConvert.DeserializeObject(json);\n            string s = string.Empty;\n            s += s;\n        }\n\n        [Test]\n        public void TorrentDeserializeTest()\n        {\n            string jsonText = @\"{\n\"\"\"\":\"\"\"\",\n\"\"label\"\": [\n       [\"\"SomeName\"\",6]\n],\n\"\"torrents\"\": [\n       [\"\"192D99A5C943555CB7F00A852821CF6D6DB3008A\"\",201,\"\"filename.avi\"\",178311826,1000,178311826,72815250,408,1603,7,121430,\"\"NameOfLabelPrevioslyDefined\"\",3,6,0,8,128954,-1,0],\n],\n\"\"torrentc\"\": \"\"1816000723\"\"\n}\";\n\n            JObject o = (JObject)JsonConvert.DeserializeObject(jsonText);\n            Assert.AreEqual(4, o.Children().Count());\n\n            JToken torrentsArray = (JToken)o[\"torrents\"];\n            JToken nestedTorrentsArray = (JToken)torrentsArray[0];\n            Assert.AreEqual(nestedTorrentsArray.Children().Count(), 19);\n        }\n\n        [Test]\n        public void JsonPropertyClassSerialize()\n        {\n            JsonPropertyClass test = new JsonPropertyClass();\n            test.Pie = \"Delicious\";\n            test.SweetCakesCount = int.MaxValue;\n\n            string jsonText = JsonConvert.SerializeObject(test);\n\n            Assert.AreEqual(@\"{\"\"pie\"\":\"\"Delicious\"\",\"\"pie1\"\":\"\"PieChart!\"\",\"\"sweet_cakes_count\"\":2147483647}\", jsonText);\n\n            JsonPropertyClass test2 = JsonConvert.DeserializeObject<JsonPropertyClass>(jsonText);\n\n            Assert.AreEqual(test.Pie, test2.Pie);\n            Assert.AreEqual(test.SweetCakesCount, test2.SweetCakesCount);\n        }\n\n        [Test]\n        public void BadJsonPropertyClassSerialize()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new BadJsonPropertyClass()); }, @\"A member with the name 'pie' already exists on 'Newtonsoft.Json.Tests.TestObjects.BadJsonPropertyClass'. Use the JsonPropertyAttribute to specify another name.\");\n        }\n\n        [Test]\n        public void InvalidBackslash()\n        {\n            string json = @\"[\"\"vvv\\jvvv\"\"]\";\n\n            ExceptionAssert.Throws<JsonReaderException>(() => { JsonConvert.DeserializeObject<List<string>>(json); }, @\"Bad JSON escape sequence: \\j. Path '', line 1, position 7.\");\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void Unicode()\n        {\n            string json = @\"[\"\"PRE\\u003cPOST\"\"]\";\n\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<string>));\n            List<string> dataContractResult = (List<string>)s.ReadObject(new MemoryStream(Encoding.UTF8.GetBytes(json)));\n\n            List<string> jsonNetResult = JsonConvert.DeserializeObject<List<string>>(json);\n\n            Assert.AreEqual(1, jsonNetResult.Count);\n            Assert.AreEqual(dataContractResult[0], jsonNetResult[0]);\n        }\n\n        [Test]\n        public void BackslashEqivilence()\n        {\n            string json = @\"[\"\"vvv\\/vvv\\tvvv\\\"\"vvv\\bvvv\\nvvv\\rvvv\\\\vvv\\fvvv\"\"]\";\n\n#if !(DNXCORE50)\n            JavaScriptSerializer javaScriptSerializer = new JavaScriptSerializer();\n            List<string> javaScriptSerializerResult = javaScriptSerializer.Deserialize<List<string>>(json);\n#endif\n\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<string>));\n            List<string> dataContractResult = (List<string>)s.ReadObject(new MemoryStream(Encoding.UTF8.GetBytes(json)));\n\n            List<string> jsonNetResult = JsonConvert.DeserializeObject<List<string>>(json);\n\n            Assert.AreEqual(1, jsonNetResult.Count);\n            Assert.AreEqual(dataContractResult[0], jsonNetResult[0]);\n#if !(DNXCORE50)\n            Assert.AreEqual(javaScriptSerializerResult[0], jsonNetResult[0]);\n#endif\n        }\n\n        [Test]\n        public void DateTimeTest()\n        {\n            List<DateTime> testDates = new List<DateTime>\n            {\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Local),\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Unspecified),\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Local),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Unspecified),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc),\n            };\n\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<DateTime>));\n            s.WriteObject(ms, testDates);\n            ms.Seek(0, SeekOrigin.Begin);\n            StreamReader sr = new StreamReader(ms);\n\n            string expected = sr.ReadToEnd();\n\n            string result = JsonConvert.SerializeObject(testDates, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n            Assert.AreEqual(expected, result);\n        }\n\n        [Test]\n        public void DateTimeOffsetIso()\n        {\n            List<DateTimeOffset> testDates = new List<DateTimeOffset>\n            {\n                new DateTimeOffset(new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(13)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(-3.5)),\n            };\n\n            string result = JsonConvert.SerializeObject(testDates);\n            Assert.AreEqual(@\"[\"\"0100-01-01T01:01:01+00:00\"\",\"\"2000-01-01T01:01:01+00:00\"\",\"\"2000-01-01T01:01:01+13:00\"\",\"\"2000-01-01T01:01:01-03:30\"\"]\", result);\n        }\n\n        [Test]\n        public void DateTimeOffsetMsAjax()\n        {\n            List<DateTimeOffset> testDates = new List<DateTimeOffset>\n            {\n                new DateTimeOffset(new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(13)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(-3.5)),\n            };\n\n            string result = JsonConvert.SerializeObject(testDates, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n            Assert.AreEqual(@\"[\"\"\\/Date(-59011455539000+0000)\\/\"\",\"\"\\/Date(946688461000+0000)\\/\"\",\"\"\\/Date(946641661000+1300)\\/\"\",\"\"\\/Date(946701061000-0330)\\/\"\"]\", result);\n        }\n#endif\n\n        [Test]\n        public void NonStringKeyDictionary()\n        {\n            Dictionary<int, int> values = new Dictionary<int, int>();\n            values.Add(-5, 6);\n            values.Add(int.MinValue, int.MaxValue);\n\n            string json = JsonConvert.SerializeObject(values);\n\n            Assert.AreEqual(@\"{\"\"-5\"\":6,\"\"-2147483648\"\":2147483647}\", json);\n\n            Dictionary<int, int> newValues = JsonConvert.DeserializeObject<Dictionary<int, int>>(json);\n\n            CollectionAssert.AreEqual(values, newValues);\n        }\n\n        [Test]\n        public void AnonymousObjectSerialization()\n        {\n            var anonymous =\n                new\n                {\n                    StringValue = \"I am a string\",\n                    IntValue = int.MaxValue,\n                    NestedAnonymous = new { NestedValue = byte.MaxValue },\n                    NestedArray = new[] { 1, 2 },\n                    Product = new Product() { Name = \"TestProduct\" }\n                };\n\n            string json = JsonConvert.SerializeObject(anonymous);\n            Assert.AreEqual(@\"{\"\"StringValue\"\":\"\"I am a string\"\",\"\"IntValue\"\":2147483647,\"\"NestedAnonymous\"\":{\"\"NestedValue\"\":255},\"\"NestedArray\"\":[1,2],\"\"Product\"\":{\"\"Name\"\":\"\"TestProduct\"\",\"\"ExpiryDate\"\":\"\"2000-01-01T00:00:00Z\"\",\"\"Price\"\":0.0,\"\"Sizes\"\":null}}\", json);\n\n            anonymous = JsonConvert.DeserializeAnonymousType(json, anonymous);\n            Assert.AreEqual(\"I am a string\", anonymous.StringValue);\n            Assert.AreEqual(int.MaxValue, anonymous.IntValue);\n            Assert.AreEqual(255, anonymous.NestedAnonymous.NestedValue);\n            Assert.AreEqual(2, anonymous.NestedArray.Length);\n            Assert.AreEqual(1, anonymous.NestedArray[0]);\n            Assert.AreEqual(2, anonymous.NestedArray[1]);\n            Assert.AreEqual(\"TestProduct\", anonymous.Product.Name);\n        }\n\n        [Test]\n        public void AnonymousObjectSerializationWithSetting()\n        {\n            DateTime d = new DateTime(2000, 1, 1);\n\n            var anonymous =\n                new\n                {\n                    DateValue = d\n                };\n\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n            settings.Converters.Add(new IsoDateTimeConverter\n            {\n                DateTimeFormat = \"yyyy\"\n            });\n\n            string json = JsonConvert.SerializeObject(anonymous, settings);\n            Assert.AreEqual(@\"{\"\"DateValue\"\":\"\"2000\"\"}\", json);\n\n            anonymous = JsonConvert.DeserializeAnonymousType(json, anonymous, settings);\n            Assert.AreEqual(d, anonymous.DateValue);\n        }\n\n        [Test]\n        public void SerializeObject()\n        {\n            string json = JsonConvert.SerializeObject(new object());\n            Assert.AreEqual(\"{}\", json);\n        }\n\n        [Test]\n        public void SerializeNull()\n        {\n            string json = JsonConvert.SerializeObject(null);\n            Assert.AreEqual(\"null\", json);\n        }\n\n        [Test]\n        public void CanDeserializeIntArrayWhenNotFirstPropertyInJson()\n        {\n            string json = \"{foo:'hello',bar:[1,2,3]}\";\n            ClassWithArray wibble = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(4, wibble.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibble.Bar[0]);\n            Assert.AreEqual(1, wibble.Bar[1]);\n            Assert.AreEqual(2, wibble.Bar[2]);\n            Assert.AreEqual(3, wibble.Bar[3]);\n        }\n\n        [Test]\n        public void CanDeserializeIntArray_WhenArrayIsFirstPropertyInJson()\n        {\n            string json = \"{bar:[1,2,3], foo:'hello'}\";\n            ClassWithArray wibble = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(4, wibble.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibble.Bar[0]);\n            Assert.AreEqual(1, wibble.Bar[1]);\n            Assert.AreEqual(2, wibble.Bar[2]);\n            Assert.AreEqual(3, wibble.Bar[3]);\n        }\n\n        [Test]\n        public void ObjectCreationHandlingReplace()\n        {\n            string json = \"{bar:[1,2,3], foo:'hello'}\";\n\n            JsonSerializer s = new JsonSerializer();\n            s.ObjectCreationHandling = ObjectCreationHandling.Replace;\n\n            ClassWithArray wibble = (ClassWithArray)s.Deserialize(new StringReader(json), typeof(ClassWithArray));\n\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(1, wibble.Bar.Count);\n        }\n\n        [Test]\n        public void CanDeserializeSerializedJson()\n        {\n            ClassWithArray wibble = new ClassWithArray();\n            wibble.Foo = \"hello\";\n            wibble.Bar.Add(1);\n            wibble.Bar.Add(2);\n            wibble.Bar.Add(3);\n            string json = JsonConvert.SerializeObject(wibble);\n\n            ClassWithArray wibbleOut = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibbleOut.Foo);\n\n            Assert.AreEqual(5, wibbleOut.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibbleOut.Bar[0]);\n            Assert.AreEqual(int.MaxValue, wibbleOut.Bar[1]);\n            Assert.AreEqual(1, wibbleOut.Bar[2]);\n            Assert.AreEqual(2, wibbleOut.Bar[3]);\n            Assert.AreEqual(3, wibbleOut.Bar[4]);\n        }\n\n        [Test]\n        public void SerializeConverableObjects()\n        {\n            string json = JsonConvert.SerializeObject(new ConverableMembers(), Formatting.Indented);\n\n            string expected = null;\n#if (NETSTANDARD2_0)\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.4028235E+38,\n  \"\"DBNull\"\": null,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#elif NETSTANDARD1_3\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.4028235E+38,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#elif !(PORTABLE || DNXCORE50) || NETSTANDARD1_3\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.40282347E+38,\n  \"\"DBNull\"\": null,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#else\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.40282347E+38,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#endif\n\n            StringAssert.AreEqual(expected, json);\n\n            ConverableMembers c = JsonConvert.DeserializeObject<ConverableMembers>(json);\n            Assert.AreEqual(\"string\", c.String);\n            Assert.AreEqual(double.MaxValue, c.Double);\n#if !(PORTABLE || DNXCORE50 || PORTABLE40)\n            Assert.AreEqual(DBNull.Value, c.DBNull);\n#endif\n        }\n\n        [Test]\n        public void SerializeStack()\n        {\n            Stack<object> s = new Stack<object>();\n            s.Push(1);\n            s.Push(2);\n            s.Push(3);\n\n            string json = JsonConvert.SerializeObject(s);\n            Assert.AreEqual(\"[3,2,1]\", json);\n        }\n\n        [Test]\n        public void FormattingOverride()\n        {\n            var obj = new { Formatting = \"test\" };\n\n            JsonSerializerSettings settings = new JsonSerializerSettings { Formatting = Formatting.Indented };\n            string indented = JsonConvert.SerializeObject(obj, settings);\n\n            string none = JsonConvert.SerializeObject(obj, Formatting.None, settings);\n            Assert.AreNotEqual(indented, none);\n        }\n\n        [Test]\n        public void DateTimeTimeZone()\n        {\n            var date = new DateTime(2001, 4, 4, 0, 0, 0, DateTimeKind.Utc);\n\n            string json = JsonConvert.SerializeObject(date);\n            Assert.AreEqual(@\"\"\"2001-04-04T00:00:00Z\"\"\", json);\n        }\n\n        [Test]\n        public void GuidTest()\n        {\n            Guid guid = new Guid(\"BED7F4EA-1A96-11d2-8F08-00A0C9A6186D\");\n\n            string json = JsonConvert.SerializeObject(new ClassWithGuid { GuidField = guid });\n            Assert.AreEqual(@\"{\"\"GuidField\"\":\"\"bed7f4ea-1a96-11d2-8f08-00a0c9a6186d\"\"}\", json);\n\n            ClassWithGuid c = JsonConvert.DeserializeObject<ClassWithGuid>(json);\n            Assert.AreEqual(guid, c.GuidField);\n        }\n\n        [Test]\n        public void EnumTest()\n        {\n            string json = JsonConvert.SerializeObject(StringComparison.CurrentCultureIgnoreCase);\n            Assert.AreEqual(@\"1\", json);\n\n            StringComparison s = JsonConvert.DeserializeObject<StringComparison>(json);\n            Assert.AreEqual(StringComparison.CurrentCultureIgnoreCase, s);\n        }\n\n        [Test]\n        public void TimeSpanTest()\n        {\n            TimeSpan ts = new TimeSpan(00, 23, 59, 1);\n\n            string json = JsonConvert.SerializeObject(new ClassWithTimeSpan { TimeSpanField = ts }, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"TimeSpanField\"\": \"\"23:59:01\"\"\n}\", json);\n\n            ClassWithTimeSpan c = JsonConvert.DeserializeObject<ClassWithTimeSpan>(json);\n            Assert.AreEqual(ts, c.TimeSpanField);\n        }\n\n        [Test]\n        public void JsonIgnoreAttributeOnClassTest()\n        {\n            string json = JsonConvert.SerializeObject(new JsonIgnoreAttributeOnClassTestClass());\n\n            Assert.AreEqual(@\"{\"\"TheField\"\":0,\"\"Property\"\":21}\", json);\n\n            JsonIgnoreAttributeOnClassTestClass c = JsonConvert.DeserializeObject<JsonIgnoreAttributeOnClassTestClass>(@\"{\"\"TheField\"\":99,\"\"Property\"\":-1,\"\"IgnoredField\"\":-1}\");\n\n            Assert.AreEqual(0, c.IgnoredField);\n            Assert.AreEqual(99, c.Field);\n        }\n\n        [Test]\n        public void ConstructorCaseSensitivity()\n        {\n            ConstructorCaseSensitivityClass c = new ConstructorCaseSensitivityClass(\"param1\", \"Param1\", \"Param2\");\n\n            string json = JsonConvert.SerializeObject(c);\n\n            ConstructorCaseSensitivityClass deserialized = JsonConvert.DeserializeObject<ConstructorCaseSensitivityClass>(json);\n\n            Assert.AreEqual(\"param1\", deserialized.param1);\n            Assert.AreEqual(\"Param1\", deserialized.Param1);\n            Assert.AreEqual(\"Param2\", deserialized.Param2);\n        }\n\n        [Test]\n        public void SerializerShouldUseClassConverter()\n        {\n            ConverterPrecedenceClass c1 = new ConverterPrecedenceClass(\"!Test!\");\n\n            string json = JsonConvert.SerializeObject(c1);\n            Assert.AreEqual(@\"[\"\"Class\"\",\"\"!Test!\"\"]\", json);\n\n            ConverterPrecedenceClass c2 = JsonConvert.DeserializeObject<ConverterPrecedenceClass>(json);\n\n            Assert.AreEqual(\"!Test!\", c2.TestValue);\n        }\n\n        [Test]\n        public void SerializerShouldUseClassConverterOverArgumentConverter()\n        {\n            ConverterPrecedenceClass c1 = new ConverterPrecedenceClass(\"!Test!\");\n\n            string json = JsonConvert.SerializeObject(c1, new ArgumentConverterPrecedenceClassConverter());\n            Assert.AreEqual(@\"[\"\"Class\"\",\"\"!Test!\"\"]\", json);\n\n            ConverterPrecedenceClass c2 = JsonConvert.DeserializeObject<ConverterPrecedenceClass>(json, new ArgumentConverterPrecedenceClassConverter());\n\n            Assert.AreEqual(\"!Test!\", c2.TestValue);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_IsoDate()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1);\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"1970-01-01T00:00:00Z\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_MsDate()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"\\/Date(0)\\/\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_MsDate_DateParseNone()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat,\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"\\/Date(0)\\/\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            var m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.None\n            });\n\n            Assert.AreEqual(new DateTime(1970, 1, 1), m2.DefaultConverter);\n            Assert.AreEqual(new DateTime(1970, 1, 1), m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_IsoDate_DateParseNone()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.IsoDateFormat,\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"1970-01-01T00:00:00Z\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverterOverArgumentConverter()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JavaScriptDateTimeConverter());\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":new Date(0),\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json, new JavaScriptDateTimeConverter());\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void ConverterAttributeExample()\n        {\n            DateTime date = Convert.ToDateTime(\"1970-01-01T00:00:00Z\").ToUniversalTime();\n\n            MemberConverterClass c = new MemberConverterClass\n            {\n                DefaultConverter = date,\n                MemberConverter = date\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultConverter\"\": \"\"1970-01-01T00:00:00Z\"\",\n  \"\"MemberConverter\"\": \"\"1970-01-01T00:00:00Z\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverterOverClassAndArgumentConverter()\n        {\n            ClassAndMemberConverterClass c1 = new ClassAndMemberConverterClass();\n            c1.DefaultConverter = new ConverterPrecedenceClass(\"DefaultConverterValue\");\n            c1.MemberConverter = new ConverterPrecedenceClass(\"MemberConverterValue\");\n\n            string json = JsonConvert.SerializeObject(c1, new ArgumentConverterPrecedenceClassConverter());\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":[\"\"Class\"\",\"\"DefaultConverterValue\"\"],\"\"MemberConverter\"\":[\"\"Member\"\",\"\"MemberConverterValue\"\"]}\", json);\n\n            ClassAndMemberConverterClass c2 = JsonConvert.DeserializeObject<ClassAndMemberConverterClass>(json, new ArgumentConverterPrecedenceClassConverter());\n\n            Assert.AreEqual(\"DefaultConverterValue\", c2.DefaultConverter.TestValue);\n            Assert.AreEqual(\"MemberConverterValue\", c2.MemberConverter.TestValue);\n        }\n\n        [Test]\n        public void IncompatibleJsonAttributeShouldThrow()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                IncompatibleJsonAttributeClass c = new IncompatibleJsonAttributeClass();\n                JsonConvert.SerializeObject(c);\n            }, \"Unexpected value when converting date. Expected DateTime or DateTimeOffset, got Newtonsoft.Json.Tests.TestObjects.IncompatibleJsonAttributeClass.\");\n        }\n\n        [Test]\n        public void GenericAbstractProperty()\n        {\n            string json = JsonConvert.SerializeObject(new GenericImpl());\n            Assert.AreEqual(@\"{\"\"Id\"\":0}\", json);\n        }\n\n        [Test]\n        public void DeserializeNullable()\n        {\n            string json;\n\n            json = JsonConvert.SerializeObject((int?)null);\n            Assert.AreEqual(\"null\", json);\n\n            json = JsonConvert.SerializeObject((int?)1);\n            Assert.AreEqual(\"1\", json);\n        }\n\n        [Test]\n        public void SerializeJsonRaw()\n        {\n            PersonRaw personRaw = new PersonRaw\n            {\n                FirstName = \"FirstNameValue\",\n                RawContent = new JRaw(\"[1,2,3,4,5]\"),\n                LastName = \"LastNameValue\"\n            };\n\n            string json;\n\n            json = JsonConvert.SerializeObject(personRaw);\n            Assert.AreEqual(@\"{\"\"first_name\"\":\"\"FirstNameValue\"\",\"\"RawContent\"\":[1,2,3,4,5],\"\"last_name\"\":\"\"LastNameValue\"\"}\", json);\n        }\n\n        [Test]\n        public void DeserializeJsonRaw()\n        {\n            string json = @\"{\"\"first_name\"\":\"\"FirstNameValue\"\",\"\"RawContent\"\":[1,2,3,4,5],\"\"last_name\"\":\"\"LastNameValue\"\"}\";\n\n            PersonRaw personRaw = JsonConvert.DeserializeObject<PersonRaw>(json);\n\n            Assert.AreEqual(\"FirstNameValue\", personRaw.FirstName);\n            Assert.AreEqual(\"[1,2,3,4,5]\", personRaw.RawContent.ToString());\n            Assert.AreEqual(\"LastNameValue\", personRaw.LastName);\n        }\n\n        [Test]\n        public void DeserializeNullableMember()\n        {\n            UserNullable userNullablle = new UserNullable\n            {\n                Id = new Guid(\"AD6205E8-0DF4-465d-AEA6-8BA18E93A7E7\"),\n                FName = \"FirstValue\",\n                LName = \"LastValue\",\n                RoleId = 5,\n                NullableRoleId = 6,\n                NullRoleId = null,\n                Active = true\n            };\n\n            string json = JsonConvert.SerializeObject(userNullablle);\n\n            Assert.AreEqual(@\"{\"\"Id\"\":\"\"ad6205e8-0df4-465d-aea6-8ba18e93a7e7\"\",\"\"FName\"\":\"\"FirstValue\"\",\"\"LName\"\":\"\"LastValue\"\",\"\"RoleId\"\":5,\"\"NullableRoleId\"\":6,\"\"NullRoleId\"\":null,\"\"Active\"\":true}\", json);\n\n            UserNullable userNullablleDeserialized = JsonConvert.DeserializeObject<UserNullable>(json);\n\n            Assert.AreEqual(new Guid(\"AD6205E8-0DF4-465d-AEA6-8BA18E93A7E7\"), userNullablleDeserialized.Id);\n            Assert.AreEqual(\"FirstValue\", userNullablleDeserialized.FName);\n            Assert.AreEqual(\"LastValue\", userNullablleDeserialized.LName);\n            Assert.AreEqual(5, userNullablleDeserialized.RoleId);\n            Assert.AreEqual(6, userNullablleDeserialized.NullableRoleId);\n            Assert.AreEqual(null, userNullablleDeserialized.NullRoleId);\n            Assert.AreEqual(true, userNullablleDeserialized.Active);\n        }\n\n        [Test]\n        public void DeserializeInt64ToNullableDouble()\n        {\n            string json = @\"{\"\"Height\"\":1}\";\n\n            DoubleClass c = JsonConvert.DeserializeObject<DoubleClass>(json);\n            Assert.AreEqual(1, c.Height);\n        }\n\n        [Test]\n        public void SerializeTypeProperty()\n        {\n            string boolRef = typeof(bool).AssemblyQualifiedName;\n            TypeClass typeClass = new TypeClass { TypeProperty = typeof(bool) };\n\n            string json = JsonConvert.SerializeObject(typeClass);\n            Assert.AreEqual(@\"{\"\"TypeProperty\"\":\"\"\" + boolRef + @\"\"\"}\", json);\n\n            TypeClass typeClass2 = JsonConvert.DeserializeObject<TypeClass>(json);\n            Assert.AreEqual(typeof(bool), typeClass2.TypeProperty);\n\n            string jsonSerializerTestRef = typeof(JsonSerializerTest).AssemblyQualifiedName;\n            typeClass = new TypeClass { TypeProperty = typeof(JsonSerializerTest) };\n\n            json = JsonConvert.SerializeObject(typeClass);\n            Assert.AreEqual(@\"{\"\"TypeProperty\"\":\"\"\" + jsonSerializerTestRef + @\"\"\"}\", json);\n\n            typeClass2 = JsonConvert.DeserializeObject<TypeClass>(json);\n            Assert.AreEqual(typeof(JsonSerializerTest), typeClass2.TypeProperty);\n        }\n\n        [Test]\n        public void RequiredMembersClass()\n        {\n            RequiredMembersClass c = new RequiredMembersClass()\n            {\n                BirthDate = new DateTime(2000, 12, 20, 10, 55, 55, DateTimeKind.Utc),\n                FirstName = \"Bob\",\n                LastName = \"Smith\",\n                MiddleName = \"Cosmo\"\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"FirstName\"\": \"\"Bob\"\",\n  \"\"MiddleName\"\": \"\"Cosmo\"\",\n  \"\"LastName\"\": \"\"Smith\"\",\n  \"\"BirthDate\"\": \"\"2000-12-20T10:55:55Z\"\"\n}\", json);\n\n            RequiredMembersClass c2 = JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n\n            Assert.AreEqual(\"Bob\", c2.FirstName);\n            Assert.AreEqual(new DateTime(2000, 12, 20, 10, 55, 55, DateTimeKind.Utc), c2.BirthDate);\n        }\n\n        [Test]\n        public void DeserializeRequiredMembersClassWithNullValues()\n        {\n            string json = @\"{\n  \"\"FirstName\"\": \"\"I can't be null bro!\"\",\n  \"\"MiddleName\"\": null,\n  \"\"LastName\"\": null,\n  \"\"BirthDate\"\": \"\"\\/Date(977309755000)\\/\"\"\n}\";\n\n            RequiredMembersClass c = JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n\n            Assert.AreEqual(\"I can't be null bro!\", c.FirstName);\n            Assert.AreEqual(null, c.MiddleName);\n            Assert.AreEqual(null, c.LastName);\n        }\n\n        [Test]\n        public void DeserializeRequiredMembersClassNullRequiredValueProperty()\n        {\n            try\n            {\n                string json = @\"{\n  \"\"FirstName\"\": null,\n  \"\"MiddleName\"\": null,\n  \"\"LastName\"\": null,\n  \"\"BirthDate\"\": \"\"\\/Date(977309755000)\\/\"\"\n}\";\n\n                JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'FirstName' expects a value but got null. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void SerializeRequiredMembersClassNullRequiredValueProperty()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                RequiredMembersClass requiredMembersClass = new RequiredMembersClass\n                {\n                    FirstName = null,\n                    BirthDate = new DateTime(2000, 10, 10, 10, 10, 10, DateTimeKind.Utc),\n                    LastName = null,\n                    MiddleName = null\n                };\n\n                string json = JsonConvert.SerializeObject(requiredMembersClass);\n            }, \"Cannot write a null value for property 'FirstName'. Property requires a value. Path ''.\");\n        }\n\n        [Test]\n        public void RequiredMembersClassMissingRequiredProperty()\n        {\n            try\n            {\n                string json = @\"{\n  \"\"FirstName\"\": \"\"Bob\"\"\n}\";\n\n                JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'LastName' not found in JSON. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void SerializeJaggedArray()\n        {\n            JaggedArray aa = new JaggedArray();\n            aa.Before = \"Before!\";\n            aa.After = \"After!\";\n            aa.Coordinates = new[] { new[] { 1, 1 }, new[] { 1, 2 }, new[] { 2, 1 }, new[] { 2, 2 } };\n\n            string json = JsonConvert.SerializeObject(aa);\n\n            Assert.AreEqual(@\"{\"\"Before\"\":\"\"Before!\"\",\"\"Coordinates\"\":[[1,1],[1,2],[2,1],[2,2]],\"\"After\"\":\"\"After!\"\"}\", json);\n        }\n\n        [Test]\n        public void DeserializeJaggedArray()\n        {\n            string json = @\"{\"\"Before\"\":\"\"Before!\"\",\"\"Coordinates\"\":[[1,1],[1,2],[2,1],[2,2]],\"\"After\"\":\"\"After!\"\"}\";\n\n            JaggedArray aa = JsonConvert.DeserializeObject<JaggedArray>(json);\n\n            Assert.AreEqual(\"Before!\", aa.Before);\n            Assert.AreEqual(\"After!\", aa.After);\n            Assert.AreEqual(4, aa.Coordinates.Length);\n            Assert.AreEqual(2, aa.Coordinates[0].Length);\n            Assert.AreEqual(1, aa.Coordinates[0][0]);\n            Assert.AreEqual(2, aa.Coordinates[1][1]);\n\n            string after = JsonConvert.SerializeObject(aa);\n\n            Assert.AreEqual(json, after);\n        }\n\n        [Test]\n        public void DeserializeGoogleGeoCode()\n        {\n            string json = @\"{\n  \"\"name\"\": \"\"1600 Amphitheatre Parkway, Mountain View, CA, USA\"\",\n  \"\"Status\"\": {\n    \"\"code\"\": 200,\n    \"\"request\"\": \"\"geocode\"\"\n  },\n  \"\"Placemark\"\": [\n    {\n      \"\"address\"\": \"\"1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA\"\",\n      \"\"AddressDetails\"\": {\n        \"\"Country\"\": {\n          \"\"CountryNameCode\"\": \"\"US\"\",\n          \"\"AdministrativeArea\"\": {\n            \"\"AdministrativeAreaName\"\": \"\"CA\"\",\n            \"\"SubAdministrativeArea\"\": {\n              \"\"SubAdministrativeAreaName\"\": \"\"Santa Clara\"\",\n              \"\"Locality\"\": {\n                \"\"LocalityName\"\": \"\"Mountain View\"\",\n                \"\"Thoroughfare\"\": {\n                  \"\"ThoroughfareName\"\": \"\"1600 Amphitheatre Pkwy\"\"\n                },\n                \"\"PostalCode\"\": {\n                  \"\"PostalCodeNumber\"\": \"\"94043\"\"\n                }\n              }\n            }\n          }\n        },\n        \"\"Accuracy\"\": 8\n      },\n      \"\"Point\"\": {\n        \"\"coordinates\"\": [-122.083739, 37.423021, 0]\n      }\n    }\n  ]\n}\";\n\n            GoogleMapGeocoderStructure jsonGoogleMapGeocoder = JsonConvert.DeserializeObject<GoogleMapGeocoderStructure>(json);\n        }\n\n        [Test]\n        public void DeserializeInterfaceProperty()\n        {\n            InterfacePropertyTestClass testClass = new InterfacePropertyTestClass();\n            testClass.co = new Co();\n            String strFromTest = JsonConvert.SerializeObject(testClass);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                InterfacePropertyTestClass testFromDe = (InterfacePropertyTestClass)JsonConvert.DeserializeObject(strFromTest, typeof(InterfacePropertyTestClass));\n            }, @\"Could not create an instance of type Newtonsoft.Json.Tests.TestObjects.ICo. Type is an interface or abstract class and cannot be instantiated. Path 'co.Name', line 1, position 14.\");\n        }\n\n        private Person GetPerson()\n        {\n            Person person = new Person\n            {\n                Name = \"Mike Manager\",\n                BirthDate = new DateTime(1983, 8, 3, 0, 0, 0, DateTimeKind.Utc),\n                Department = \"IT\",\n                LastModified = new DateTime(2009, 2, 15, 0, 0, 0, DateTimeKind.Utc)\n            };\n            return person;\n        }\n\n        [Test]\n        public void WriteJsonDates()\n        {\n            LogEntry entry = new LogEntry\n            {\n                LogDate = new DateTime(2009, 2, 15, 0, 0, 0, DateTimeKind.Utc),\n                Details = \"Application started.\"\n            };\n\n            string defaultJson = JsonConvert.SerializeObject(entry);\n            // {\"Details\":\"Application started.\",\"LogDate\":\"\\/Date(1234656000000)\\/\"}\n\n            string isoJson = JsonConvert.SerializeObject(entry, new IsoDateTimeConverter());\n            // {\"Details\":\"Application started.\",\"LogDate\":\"2009-02-15T00:00:00.0000000Z\"}\n\n            string javascriptJson = JsonConvert.SerializeObject(entry, new JavaScriptDateTimeConverter());\n            // {\"Details\":\"Application started.\",\"LogDate\":new Date(1234656000000)}\n\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":\"\"2009-02-15T00:00:00Z\"\"}\", defaultJson);\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":\"\"2009-02-15T00:00:00Z\"\"}\", isoJson);\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":new Date(1234656000000)}\", javascriptJson);\n        }\n\n        [Test]\n        public void GenericListAndDictionaryInterfaceProperties()\n        {\n            GenericListAndDictionaryInterfaceProperties o = new GenericListAndDictionaryInterfaceProperties();\n            o.IDictionaryProperty = new Dictionary<string, int>\n            {\n                { \"one\", 1 },\n                { \"two\", 2 },\n                { \"three\", 3 }\n            };\n            o.IListProperty = new List<int>\n            {\n                1, 2, 3\n            };\n            o.IEnumerableProperty = new List<int>\n            {\n                4, 5, 6\n            };\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"IEnumerableProperty\"\": [\n    4,\n    5,\n    6\n  ],\n  \"\"IListProperty\"\": [\n    1,\n    2,\n    3\n  ],\n  \"\"IDictionaryProperty\"\": {\n    \"\"one\"\": 1,\n    \"\"two\"\": 2,\n    \"\"three\"\": 3\n  }\n}\", json);\n\n            GenericListAndDictionaryInterfaceProperties deserializedObject = JsonConvert.DeserializeObject<GenericListAndDictionaryInterfaceProperties>(json);\n            Assert.IsNotNull(deserializedObject);\n\n            CollectionAssert.AreEqual(o.IListProperty.ToArray(), deserializedObject.IListProperty.ToArray());\n            CollectionAssert.AreEqual(o.IEnumerableProperty.ToArray(), deserializedObject.IEnumerableProperty.ToArray());\n            CollectionAssert.AreEqual(o.IDictionaryProperty.ToArray(), deserializedObject.IDictionaryProperty.ToArray());\n        }\n\n        [Test]\n        public void DeserializeBestMatchPropertyCase()\n        {\n            string json = @\"{\n  \"\"firstName\"\": \"\"firstName\"\",\n  \"\"FirstName\"\": \"\"FirstName\"\",\n  \"\"LastName\"\": \"\"LastName\"\",\n  \"\"lastName\"\": \"\"lastName\"\",\n}\";\n\n            PropertyCase o = JsonConvert.DeserializeObject<PropertyCase>(json);\n            Assert.IsNotNull(o);\n\n            Assert.AreEqual(\"firstName\", o.firstName);\n            Assert.AreEqual(\"FirstName\", o.FirstName);\n            Assert.AreEqual(\"LastName\", o.LastName);\n            Assert.AreEqual(\"lastName\", o.lastName);\n        }\n\n        [Test]\n        public void PopulateDefaultValueWhenUsingConstructor()\n        {\n            string json = \"{ 'testProperty1': 'value' }\";\n\n            ConstructorAndDefaultValueAttributeTestClass c = JsonConvert.DeserializeObject<ConstructorAndDefaultValueAttributeTestClass>(json, new JsonSerializerSettings\n            {\n                DefaultValueHandling = DefaultValueHandling.Populate\n            });\n            Assert.AreEqual(\"value\", c.TestProperty1);\n            Assert.AreEqual(21, c.TestProperty2);\n\n            c = JsonConvert.DeserializeObject<ConstructorAndDefaultValueAttributeTestClass>(json, new JsonSerializerSettings\n            {\n                DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate\n            });\n            Assert.AreEqual(\"value\", c.TestProperty1);\n            Assert.AreEqual(21, c.TestProperty2);\n        }\n\n        [Test]\n        public void RequiredWhenUsingConstructor()\n        {\n            try\n            {\n                string json = \"{ 'testProperty1': 'value' }\";\n                JsonConvert.DeserializeObject<ConstructorAndRequiredTestClass>(json);\n\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'TestProperty2' not found in JSON. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void DeserializePropertiesOnToNonDefaultConstructor()\n        {\n            SubKlass i = new SubKlass(\"my subprop\");\n            i.SuperProp = \"overrided superprop\";\n\n            string json = JsonConvert.SerializeObject(i);\n            Assert.AreEqual(@\"{\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", json);\n\n            SubKlass ii = JsonConvert.DeserializeObject<SubKlass>(json);\n\n            string newJson = JsonConvert.SerializeObject(ii);\n            Assert.AreEqual(@\"{\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", newJson);\n        }\n\n        [Test]\n        public void DeserializePropertiesOnToNonDefaultConstructorWithReferenceTracking()\n        {\n            SubKlass i = new SubKlass(\"my subprop\");\n            i.SuperProp = \"overrided superprop\";\n\n            string json = JsonConvert.SerializeObject(i, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n\n            Assert.AreEqual(@\"{\"\"$id\"\":\"\"1\"\",\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", json);\n\n            SubKlass ii = JsonConvert.DeserializeObject<SubKlass>(json, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n\n            string newJson = JsonConvert.SerializeObject(ii, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n            Assert.AreEqual(@\"{\"\"$id\"\":\"\"1\"\",\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", newJson);\n        }\n\n        [Test]\n        public void SerializeJsonPropertyWithHandlingValues()\n        {\n            JsonPropertyWithHandlingValues o = new JsonPropertyWithHandlingValues();\n            o.DefaultValueHandlingIgnoreProperty = \"Default!\";\n            o.DefaultValueHandlingIncludeProperty = \"Default!\";\n            o.DefaultValueHandlingPopulateProperty = \"Default!\";\n            o.DefaultValueHandlingIgnoreAndPopulateProperty = \"Default!\";\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultValueHandlingIncludeProperty\"\": \"\"Default!\"\",\n  \"\"DefaultValueHandlingPopulateProperty\"\": \"\"Default!\"\",\n  \"\"NullValueHandlingIncludeProperty\"\": null,\n  \"\"ReferenceLoopHandlingErrorProperty\"\": null,\n  \"\"ReferenceLoopHandlingIgnoreProperty\"\": null,\n  \"\"ReferenceLoopHandlingSerializeProperty\"\": null\n}\", json);\n\n            json = JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings { NullValueHandling = NullValueHandling.Ignore });\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultValueHandlingIncludeProperty\"\": \"\"Default!\"\",\n  \"\"DefaultValueHandlingPopulateProperty\"\": \"\"Default!\"\",\n  \"\"NullValueHandlingIncludeProperty\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeJsonPropertyWithHandlingValues()\n        {\n            string json = \"{}\";\n\n            JsonPropertyWithHandlingValues o = JsonConvert.DeserializeObject<JsonPropertyWithHandlingValues>(json);\n            Assert.AreEqual(\"Default!\", o.DefaultValueHandlingIgnoreAndPopulateProperty);\n            Assert.AreEqual(\"Default!\", o.DefaultValueHandlingPopulateProperty);\n            Assert.AreEqual(null, o.DefaultValueHandlingIgnoreProperty);\n            Assert.AreEqual(null, o.DefaultValueHandlingIncludeProperty);\n        }\n\n        [Test]\n        public void JsonPropertyWithHandlingValues_ReferenceLoopError()\n        {\n            string classRef = typeof(JsonPropertyWithHandlingValues).FullName;\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonPropertyWithHandlingValues o = new JsonPropertyWithHandlingValues();\n                o.ReferenceLoopHandlingErrorProperty = o;\n\n                JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings { ReferenceLoopHandling = ReferenceLoopHandling.Ignore });\n            }, \"Self referencing loop detected for property 'ReferenceLoopHandlingErrorProperty' with type '\" + classRef + \"'. Path ''.\");\n        }\n\n        [Test]\n        public void PartialClassDeserialize()\n        {\n            string json = @\"{\n    \"\"request\"\": \"\"ux.settings.update\"\",\n    \"\"sid\"\": \"\"14c561bd-32a8-457e-b4e5-4bba0832897f\"\",\n    \"\"uid\"\": \"\"30c39065-0f31-de11-9442-001e3786a8ec\"\",\n    \"\"fidOrder\"\": [\n        \"\"id\"\",\n        \"\"andytest_name\"\",\n        \"\"andytest_age\"\",\n        \"\"andytest_address\"\",\n        \"\"andytest_phone\"\",\n        \"\"date\"\",\n        \"\"title\"\",\n        \"\"titleId\"\"\n    ],\n    \"\"entityName\"\": \"\"Andy Test\"\",\n    \"\"setting\"\": \"\"entity.field.order\"\"\n}\";\n\n            RequestOnly r = JsonConvert.DeserializeObject<RequestOnly>(json);\n            Assert.AreEqual(\"ux.settings.update\", r.Request);\n\n            NonRequest n = JsonConvert.DeserializeObject<NonRequest>(json);\n            Assert.AreEqual(new Guid(\"14c561bd-32a8-457e-b4e5-4bba0832897f\"), n.Sid);\n            Assert.AreEqual(new Guid(\"30c39065-0f31-de11-9442-001e3786a8ec\"), n.Uid);\n            Assert.AreEqual(8, n.FidOrder.Count);\n            Assert.AreEqual(\"id\", n.FidOrder[0]);\n            Assert.AreEqual(\"titleId\", n.FidOrder[n.FidOrder.Count - 1]);\n        }\n\n#if !(NET20 || DNXCORE50)\n        [Test]\n        public void OptInClassMetadataSerialization()\n        {\n            OptInClass optInClass = new OptInClass();\n            optInClass.Age = 26;\n            optInClass.Name = \"James NK\";\n            optInClass.NotIncluded = \"Poor me :(\";\n\n            string json = JsonConvert.SerializeObject(optInClass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": \"\"James NK\"\",\n  \"\"Age\"\": 26\n}\", json);\n\n            OptInClass newOptInClass = JsonConvert.DeserializeObject<OptInClass>(@\"{\n  \"\"Name\"\": \"\"James NK\"\",\n  \"\"NotIncluded\"\": \"\"Ignore me!\"\",\n  \"\"Age\"\": 26\n}\");\n            Assert.AreEqual(26, newOptInClass.Age);\n            Assert.AreEqual(\"James NK\", newOptInClass.Name);\n            Assert.AreEqual(null, newOptInClass.NotIncluded);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void SerializeDataContractPrivateMembers()\n        {\n            DataContractPrivateMembers c = new DataContractPrivateMembers(\"Jeff\", 26, 10, \"Dr\");\n            c.NotIncluded = \"Hi\";\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"_name\"\": \"\"Jeff\"\",\n  \"\"_age\"\": 26,\n  \"\"Rank\"\": 10,\n  \"\"JsonTitle\"\": \"\"Dr\"\"\n}\", json);\n\n            DataContractPrivateMembers cc = JsonConvert.DeserializeObject<DataContractPrivateMembers>(json);\n            Assert.AreEqual(\"_name: Jeff, _age: 26, Rank: 10, JsonTitle: Dr\", cc.ToString());\n        }\n#endif\n\n        [Test]\n        public void DeserializeDictionaryInterface()\n        {\n            string json = @\"{\n  \"\"Name\"\": \"\"Name!\"\",\n  \"\"Dictionary\"\": {\n    \"\"Item\"\": 11\n  }\n}\";\n\n            DictionaryInterfaceClass c = JsonConvert.DeserializeObject<DictionaryInterfaceClass>(\n                json,\n                new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Replace });\n\n            Assert.AreEqual(\"Name!\", c.Name);\n            Assert.AreEqual(1, c.Dictionary.Count);\n            Assert.AreEqual(11, c.Dictionary[\"Item\"]);\n        }\n\n        [Test]\n        public void DeserializeDictionaryInterfaceWithExistingValues()\n        {\n            string json = @\"{\n  \"\"Random\"\": {\n    \"\"blah\"\": 1\n  },\n  \"\"Name\"\": \"\"Name!\"\",\n  \"\"Dictionary\"\": {\n    \"\"Item\"\": 11,\n    \"\"Item1\"\": 12\n  },\n  \"\"Collection\"\": [\n    999\n  ],\n  \"\"Employee\"\": {\n    \"\"Manager\"\": {\n      \"\"Name\"\": \"\"ManagerName!\"\"\n    }\n  }\n}\";\n\n            DictionaryInterfaceClass c = JsonConvert.DeserializeObject<DictionaryInterfaceClass>(json,\n                new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Reuse });\n\n            Assert.AreEqual(\"Name!\", c.Name);\n            Assert.AreEqual(3, c.Dictionary.Count);\n            Assert.AreEqual(11, c.Dictionary[\"Item\"]);\n            Assert.AreEqual(1, c.Dictionary[\"existing\"]);\n            Assert.AreEqual(4, c.Collection.Count);\n            Assert.AreEqual(1, c.Collection.ElementAt(0));\n            Assert.AreEqual(999, c.Collection.ElementAt(3));\n            Assert.AreEqual(\"EmployeeName!\", c.Employee.Name);\n            Assert.AreEqual(\"ManagerName!\", c.Employee.Manager.Name);\n            Assert.IsNotNull(c.Random);\n        }\n\n        [Test]\n        public void TypedObjectDeserializationWithComments()\n        {\n            string json = @\"/*comment1*/ { /*comment2*/\n        \"\"Name\"\": /*comment3*/ \"\"Apple\"\" /*comment4*/, /*comment5*/\n        \"\"ExpiryDate\"\": \"\"\\/Date(1230422400000)\\/\"\",\n        \"\"Price\"\": 3.99,\n        \"\"Sizes\"\": /*comment6*/ [ /*comment7*/\n          \"\"Small\"\", /*comment8*/\n          \"\"Medium\"\" /*comment9*/,\n          /*comment10*/ \"\"Large\"\"\n        /*comment11*/ ] /*comment12*/\n      } /*comment13*/\";\n\n            Product deserializedProduct = (Product)JsonConvert.DeserializeObject(json, typeof(Product));\n\n            Assert.AreEqual(\"Apple\", deserializedProduct.Name);\n            Assert.AreEqual(new DateTime(2008, 12, 28, 0, 0, 0, DateTimeKind.Utc), deserializedProduct.ExpiryDate);\n            Assert.AreEqual(3.99m, deserializedProduct.Price);\n            Assert.AreEqual(\"Small\", deserializedProduct.Sizes[0]);\n            Assert.AreEqual(\"Medium\", deserializedProduct.Sizes[1]);\n            Assert.AreEqual(\"Large\", deserializedProduct.Sizes[2]);\n        }\n\n        [Test]\n        public void NestedInsideOuterObject()\n        {\n            string json = @\"{\n  \"\"short\"\": {\n    \"\"original\"\": \"\"http://www.contrast.ie/blog/online&#45;marketing&#45;2009/\"\",\n    \"\"short\"\": \"\"m2sqc6\"\",\n    \"\"shortened\"\": \"\"http://short.ie/m2sqc6\"\",\n    \"\"error\"\": {\n      \"\"code\"\": 0,\n      \"\"msg\"\": \"\"No action taken\"\"\n    }\n  }\n}\";\n\n            JObject o = JObject.Parse(json);\n\n            Shortie s = JsonConvert.DeserializeObject<Shortie>(o[\"short\"].ToString());\n            Assert.IsNotNull(s);\n\n            Assert.AreEqual(s.Original, \"http://www.contrast.ie/blog/online&#45;marketing&#45;2009/\");\n            Assert.AreEqual(s.Short, \"m2sqc6\");\n            Assert.AreEqual(s.Shortened, \"http://short.ie/m2sqc6\");\n        }\n\n        [Test]\n        public void UriSerialization()\n        {\n            Uri uri = new Uri(\"http://codeplex.com\");\n            string json = JsonConvert.SerializeObject(uri);\n\n            Assert.AreEqual(\"http://codeplex.com/\", uri.ToString());\n\n            Uri newUri = JsonConvert.DeserializeObject<Uri>(json);\n            Assert.AreEqual(uri, newUri);\n        }\n\n        [Test]\n        public void AnonymousPlusLinqToSql()\n        {\n            var value = new\n            {\n                bar = new JObject(new JProperty(\"baz\", 13))\n            };\n\n            string json = JsonConvert.SerializeObject(value);\n\n            Assert.AreEqual(@\"{\"\"bar\"\":{\"\"baz\"\":13}}\", json);\n        }\n\n        [Test]\n        public void SerializeEnumerableAsObject()\n        {\n            Content content = new Content\n            {\n                Text = \"Blah, blah, blah\",\n                Children = new List<Content>\n                {\n                    new Content { Text = \"First\" },\n                    new Content { Text = \"Second\" }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(content, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Children\"\": [\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"First\"\"\n    },\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"Second\"\"\n    }\n  ],\n  \"\"Text\"\": \"\"Blah, blah, blah\"\"\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeEnumerableAsObject()\n        {\n            string json = @\"{\n  \"\"Children\"\": [\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"First\"\"\n    },\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"Second\"\"\n    }\n  ],\n  \"\"Text\"\": \"\"Blah, blah, blah\"\"\n}\";\n\n            Content content = JsonConvert.DeserializeObject<Content>(json);\n\n            Assert.AreEqual(\"Blah, blah, blah\", content.Text);\n            Assert.AreEqual(2, content.Children.Count);\n            Assert.AreEqual(\"First\", content.Children[0].Text);\n            Assert.AreEqual(\"Second\", content.Children[1].Text);\n        }\n\n        [Test]\n        public void RoleTransferTest()\n        {\n            string json = @\"{\"\"Operation\"\":\"\"1\"\",\"\"RoleName\"\":\"\"Admin\"\",\"\"Direction\"\":\"\"0\"\"}\";\n\n            RoleTransfer r = JsonConvert.DeserializeObject<RoleTransfer>(json);\n\n            Assert.AreEqual(RoleTransferOperation.Second, r.Operation);\n            Assert.AreEqual(\"Admin\", r.RoleName);\n            Assert.AreEqual(RoleTransferDirection.First, r.Direction);\n        }\n\n        [Test]\n        public void DeserializeGenericDictionary()\n        {\n            string json = @\"{\"\"key1\"\":\"\"value1\"\",\"\"key2\"\":\"\"value2\"\"}\";\n\n            Dictionary<string, string> values = JsonConvert.DeserializeObject<Dictionary<string, string>>(json);\n\n            Assert.AreEqual(2, values.Count);\n            Assert.AreEqual(\"value1\", values[\"key1\"]);\n            Assert.AreEqual(\"value2\", values[\"key2\"]);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeEmptyStringToNullableDateTime()\n        {\n            string json = @\"{\"\"DateTimeField\"\":\"\"\"\"}\";\n\n            NullableDateTimeTestClass c = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(json);\n            Assert.AreEqual(null, c.DateTimeField);\n        }\n#endif\n\n        [Test]\n        public void FailWhenClassWithNoDefaultConstructorHasMultipleConstructorsWithArguments()\n        {\n            string json = @\"{\"\"sublocation\"\":\"\"AlertEmailSender.Program.Main\"\",\"\"userId\"\":0,\"\"type\"\":0,\"\"summary\"\":\"\"Loading settings variables\"\",\"\"details\"\":null,\"\"stackTrace\"\":\"\"   at System.Environment.GetStackTrace(Exception e, Boolean needFileInfo)\\r\\n   at System.Environment.get_StackTrace()\\r\\n   at mr.Logging.Event..ctor(String summary) in C:\\\\Projects\\\\MRUtils\\\\Logging\\\\Event.vb:line 71\\r\\n   at AlertEmailSender.Program.Main(String[] args) in C:\\\\Projects\\\\AlertEmailSender\\\\AlertEmailSender\\\\Program.cs:line 25\"\",\"\"tag\"\":null,\"\"time\"\":\"\"\\/Date(1249591032026-0400)\\/\"\"}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Event>(json); }, @\"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.Events.Event. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'sublocation', line 1, position 15.\");\n        }\n\n        [Test]\n        public void DeserializeObjectSetOnlyProperty()\n        {\n            string json = @\"{'SetOnlyProperty':[1,2,3,4,5]}\";\n\n            SetOnlyPropertyClass2 setOnly = JsonConvert.DeserializeObject<SetOnlyPropertyClass2>(json);\n            JArray a = (JArray)setOnly.GetValue();\n            Assert.AreEqual(5, a.Count);\n            Assert.AreEqual(1, (int)a[0]);\n            Assert.AreEqual(5, (int)a[a.Count - 1]);\n        }\n\n        [Test]\n        public void DeserializeOptInClasses()\n        {\n            string json = @\"{id: \"\"12\"\", name: \"\"test\"\", items: [{id: \"\"112\"\", name: \"\"testing\"\"}]}\";\n\n            ListTestClass l = JsonConvert.DeserializeObject<ListTestClass>(json);\n        }\n\n        [Test]\n        public void DeserializeNullableListWithNulls()\n        {\n            List<decimal?> l = JsonConvert.DeserializeObject<List<decimal?>>(\"[ 3.3, null, 1.1 ] \");\n            Assert.AreEqual(3, l.Count);\n\n            Assert.AreEqual(3.3m, l[0]);\n            Assert.AreEqual(null, l[1]);\n            Assert.AreEqual(1.1m, l[2]);\n        }\n\n        [Test]\n        public void CannotDeserializeArrayIntoObject()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Person>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n\n        [Test]\n        public void CannotDeserializeArrayIntoDictionary()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Dictionary<string, string>>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'System.Collections.Generic.Dictionary`2[System.String,System.String]' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n\n#if !(PORTABLE || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void CannotDeserializeArrayIntoSerializable()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Exception>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'System.Exception' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n#endif\n\n        [Test]\n        public void CannotDeserializeArrayIntoDouble()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => { JsonConvert.DeserializeObject<double>(json); },\n                @\"Unexpected character encountered while parsing value: [. Path '', line 1, position 1.\");\n        }\n\n#if !(NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void CannotDeserializeArrayIntoDynamic()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => { JsonConvert.DeserializeObject<DynamicDictionary>(json); },\n                @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'Newtonsoft.Json.Tests.Linq.DynamicDictionary' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n#endif\n\n        [Test]\n        public void CannotDeserializeArrayIntoLinqToJson()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<InvalidCastException>(\n                () => { JsonConvert.DeserializeObject<JObject>(json); },\n                new[]\n                {\n                    \"Unable to cast object of type 'Newtonsoft.Json.Linq.JArray' to type 'Newtonsoft.Json.Linq.JObject'.\",\n                    \"Cannot cast from source type to destination type.\" // mono\n                });\n        }\n\n        [Test]\n        public void CannotDeserializeConstructorIntoObject()\n        {\n            string json = @\"new Constructor(123)\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Person>(json); }, @\"Error converting value \"\"Constructor\"\" to type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '', line 1, position 16.\");\n        }\n\n        [Test]\n        public void CannotDeserializeConstructorIntoObjectNested()\n        {\n            string json = @\"[new Constructor(123)]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<List<Person>>(json); }, @\"Error converting value \"\"Constructor\"\" to type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '[0]', line 1, position 17.\");\n        }\n\n        [Test]\n        public void CannotDeserializeObjectIntoArray()\n        {\n            string json = @\"{}\";\n\n            try\n            {\n                JsonConvert.DeserializeObject<List<Person>>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(@\"Cannot deserialize the current JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) into type 'System.Collections.Generic.List`1[Newtonsoft.Json.Tests.TestObjects.Organization.Person]' because the type requires a JSON array (e.g. [1,2,3]) to deserialize correctly.\" + Environment.NewLine +\n                                                    @\"To fix this error either change the JSON to a JSON array (e.g. [1,2,3]) or change the deserialized type so that it is a normal .NET type (e.g. not a primitive type like integer, not a collection type like an array or List<T>) that can be deserialized from a JSON object. JsonObjectAttribute can also be added to the type to force it to deserialize from a JSON object.\" + Environment.NewLine +\n                                                    @\"Path ''\"));\n            }\n        }\n\n        [Test]\n        public void CannotPopulateArrayIntoObject()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.PopulateObject(json, new Person()); }, @\"Cannot populate JSON array onto type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '', line 1, position 1.\");\n        }\n\n        [Test]\n        public void CannotPopulateObjectIntoArray()\n        {\n            string json = @\"{}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.PopulateObject(json, new List<Person>()); }, @\"Cannot populate JSON object onto type 'System.Collections.Generic.List`1[Newtonsoft.Json.Tests.TestObjects.Organization.Person]'. Path '', line 1, position 2.\");\n        }\n\n        [Test]\n        public void DeserializeEmptyString()\n        {\n            string json = @\"{\"\"Name\"\":\"\"\"\"}\";\n\n            Person p = JsonConvert.DeserializeObject<Person>(json);\n            Assert.AreEqual(\"\", p.Name);\n        }\n\n        [Test]\n        public void SerializePropertyGetError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.SerializeObject(new MemoryStream(), new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error getting value from 'ReadTimeout' on 'System.IO.MemoryStream'.\");\n        }\n\n        [Test]\n        public void DeserializePropertySetError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:0}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error setting value to 'ReadTimeout' on 'System.IO.MemoryStream'.\");\n        }\n\n        [Test]\n        public void DeserializeEnsureTypeEmptyStringToIntError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:''}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error converting value {null} to type 'System.Int32'. Path 'ReadTimeout', line 1, position 15.\");\n        }\n\n        [Test]\n        public void DeserializeEnsureTypeNullToIntError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:null}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error converting value {null} to type 'System.Int32'. Path 'ReadTimeout', line 1, position 17.\");\n        }\n\n        [Test]\n        public void SerializeGenericListOfStrings()\n        {\n            List<String> strings = new List<String>();\n\n            strings.Add(\"str_1\");\n            strings.Add(\"str_2\");\n            strings.Add(\"str_3\");\n\n            string json = JsonConvert.SerializeObject(strings);\n            Assert.AreEqual(@\"[\"\"str_1\"\",\"\"str_2\"\",\"\"str_3\"\"]\", json);\n        }\n\n        [Test]\n        public void ConstructorReadonlyFieldsTest()\n        {\n            ConstructorReadonlyFields c1 = new ConstructorReadonlyFields(\"String!\", int.MaxValue);\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"A\"\": \"\"String!\"\",\n  \"\"B\"\": 2147483647\n}\", json);\n\n            ConstructorReadonlyFields c2 = JsonConvert.DeserializeObject<ConstructorReadonlyFields>(json);\n            Assert.AreEqual(\"String!\", c2.A);\n            Assert.AreEqual(int.MaxValue, c2.B);\n        }\n\n        [Test]\n        public void SerializeStruct()\n        {\n            StructTest structTest = new StructTest\n            {\n                StringProperty = \"StringProperty!\",\n                StringField = \"StringField\",\n                IntProperty = 5,\n                IntField = 10\n            };\n\n            string json = JsonConvert.SerializeObject(structTest, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"StringField\"\": \"\"StringField\"\",\n  \"\"IntField\"\": 10,\n  \"\"StringProperty\"\": \"\"StringProperty!\"\",\n  \"\"IntProperty\"\": 5\n}\", json);\n\n            StructTest deserialized = JsonConvert.DeserializeObject<StructTest>(json);\n            Assert.AreEqual(structTest.StringProperty, deserialized.StringProperty);\n            Assert.AreEqual(structTest.StringField, deserialized.StringField);\n            Assert.AreEqual(structTest.IntProperty, deserialized.IntProperty);\n            Assert.AreEqual(structTest.IntField, deserialized.IntField);\n        }\n\n        [Test]\n        public void SerializeListWithJsonConverter()\n        {\n            Foo f = new Foo();\n            f.Bars.Add(new Bar { Id = 0 });\n            f.Bars.Add(new Bar { Id = 1 });\n            f.Bars.Add(new Bar { Id = 2 });\n\n            string json = JsonConvert.SerializeObject(f, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Bars\"\": [\n    0,\n    1,\n    2\n  ]\n}\", json);\n\n            Foo newFoo = JsonConvert.DeserializeObject<Foo>(json);\n            Assert.AreEqual(3, newFoo.Bars.Count);\n            Assert.AreEqual(0, newFoo.Bars[0].Id);\n            Assert.AreEqual(1, newFoo.Bars[1].Id);\n            Assert.AreEqual(2, newFoo.Bars[2].Id);\n        }\n\n        [Test]\n        public void SerializeGuidKeyedDictionary()\n        {\n            Dictionary<Guid, int> dictionary = new Dictionary<Guid, int>();\n            dictionary.Add(new Guid(\"F60EAEE0-AE47-488E-B330-59527B742D77\"), 1);\n            dictionary.Add(new Guid(\"C2594C02-EBA1-426A-AA87-8DD8871350B0\"), 2);\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"f60eaee0-ae47-488e-b330-59527b742d77\"\": 1,\n  \"\"c2594c02-eba1-426a-aa87-8dd8871350b0\"\": 2\n}\", json);\n        }\n\n        [Test]\n        public void SerializePersonKeyedDictionary()\n        {\n            Dictionary<Person, int> dictionary = new Dictionary<Person, int>();\n            dictionary.Add(new Person { Name = \"p1\" }, 1);\n            dictionary.Add(new Person { Name = \"p2\" }, 2);\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 1,\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 2\n}\", json);\n        }\n\n        [Test]\n        public void DeserializePersonKeyedDictionary()\n        {\n            try\n            {\n                string json =\n                    @\"{\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 1,\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 2\n}\";\n\n                JsonConvert.DeserializeObject<Dictionary<Person, int>>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Could not convert string 'Newtonsoft.Json.Tests.TestObjects.Organization.Person' to dictionary key type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Create a TypeConverter to convert from the string to the key type object. Path '['Newtonsoft.Json.Tests.TestObjects.Organization.Person']'\"));\n            }\n        }\n\n        [Test]\n        public void SerializeFragment()\n        {\n            string googleSearchText = @\"{\n        \"\"responseData\"\": {\n          \"\"results\"\": [\n            {\n              \"\"GsearchResultClass\"\": \"\"GwebSearch\"\",\n              \"\"unescapedUrl\"\": \"\"http://en.wikipedia.org/wiki/Paris_Hilton\"\",\n              \"\"url\"\": \"\"http://en.wikipedia.org/wiki/Paris_Hilton\"\",\n              \"\"visibleUrl\"\": \"\"en.wikipedia.org\"\",\n              \"\"cacheUrl\"\": \"\"http://www.google.com/search?q=cache:TwrPfhd22hYJ:en.wikipedia.org\"\",\n              \"\"title\"\": \"\"<b>Paris Hilton</b> - Wikipedia, the free encyclopedia\"\",\n              \"\"titleNoFormatting\"\": \"\"Paris Hilton - Wikipedia, the free encyclopedia\"\",\n              \"\"content\"\": \"\"[1] In 2006, she released her debut album...\"\"\n            },\n            {\n              \"\"GsearchResultClass\"\": \"\"GwebSearch\"\",\n              \"\"unescapedUrl\"\": \"\"http://www.imdb.com/name/nm0385296/\"\",\n              \"\"url\"\": \"\"http://www.imdb.com/name/nm0385296/\"\",\n              \"\"visibleUrl\"\": \"\"www.imdb.com\"\",\n              \"\"cacheUrl\"\": \"\"http://www.google.com/search?q=cache:1i34KkqnsooJ:www.imdb.com\"\",\n              \"\"title\"\": \"\"<b>Paris Hilton</b>\"\",\n              \"\"titleNoFormatting\"\": \"\"Paris Hilton\"\",\n              \"\"content\"\": \"\"Self: Zoolander. Socialite <b>Paris Hilton</b>...\"\"\n            }\n          ],\n          \"\"cursor\"\": {\n            \"\"pages\"\": [\n              {\n                \"\"start\"\": \"\"0\"\",\n                \"\"label\"\": 1\n              },\n              {\n                \"\"start\"\": \"\"4\"\",\n                \"\"label\"\": 2\n              },\n              {\n                \"\"start\"\": \"\"8\"\",\n                \"\"label\"\": 3\n              },\n              {\n                \"\"start\"\": \"\"12\"\",\n                \"\"label\"\": 4\n              }\n            ],\n            \"\"estimatedResultCount\"\": \"\"59600000\"\",\n            \"\"currentPageIndex\"\": 0,\n            \"\"moreResultsUrl\"\": \"\"http://www.google.com/search?oe=utf8&ie=utf8...\"\"\n          }\n        },\n        \"\"responseDetails\"\": null,\n        \"\"responseStatus\"\": 200\n      }\";\n\n            JObject googleSearch = JObject.Parse(googleSearchText);\n\n            // get JSON result objects into a list\n            IList<JToken> results = googleSearch[\"responseData\"][\"results\"].Children().ToList();\n\n            // serialize JSON results into .NET objects\n            IList<SearchResult> searchResults = new List<SearchResult>();\n            foreach (JToken result in results)\n            {\n                SearchResult searchResult = JsonConvert.DeserializeObject<SearchResult>(result.ToString());\n                searchResults.Add(searchResult);\n            }\n\n            // Title = <b>Paris Hilton</b> - Wikipedia, the free encyclopedia\n            // Content = [1] In 2006, she released her debut album...\n            // Url = http://en.wikipedia.org/wiki/Paris_Hilton\n\n            // Title = <b>Paris Hilton</b>\n            // Content = Self: Zoolander. Socialite <b>Paris Hilton</b>...\n            // Url = http://www.imdb.com/name/nm0385296/\n\n            Assert.AreEqual(2, searchResults.Count);\n            Assert.AreEqual(\"<b>Paris Hilton</b> - Wikipedia, the free encyclopedia\", searchResults[0].Title);\n            Assert.AreEqual(\"<b>Paris Hilton</b>\", searchResults[1].Title);\n        }\n\n        [Test]\n        public void DeserializeBaseReferenceWithDerivedValue()\n        {\n            PersonPropertyClass personPropertyClass = new PersonPropertyClass();\n            WagePerson wagePerson = (WagePerson)personPropertyClass.Person;\n\n            wagePerson.BirthDate = new DateTime(2000, 11, 29, 23, 59, 59, DateTimeKind.Utc);\n            wagePerson.Department = \"McDees\";\n            wagePerson.HourlyWage = 12.50m;\n            wagePerson.LastModified = new DateTime(2000, 11, 29, 23, 59, 59, DateTimeKind.Utc);\n            wagePerson.Name = \"Jim Bob\";\n\n            string json = JsonConvert.SerializeObject(personPropertyClass, Formatting.Indented);\n            StringAssert.AreEqual(\n                @\"{\n  \"\"Person\"\": {\n    \"\"HourlyWage\"\": 12.50,\n    \"\"Name\"\": \"\"Jim Bob\"\",\n    \"\"BirthDate\"\": \"\"2000-11-29T23:59:59Z\"\",\n    \"\"LastModified\"\": \"\"2000-11-29T23:59:59Z\"\"\n  }\n}\",\n                json);\n\n            PersonPropertyClass newPersonPropertyClass = JsonConvert.DeserializeObject<PersonPropertyClass>(json);\n            Assert.AreEqual(wagePerson.HourlyWage, ((WagePerson)newPersonPropertyClass.Person).HourlyWage);\n        }\n\n        [Test]\n        public void DeserializePopulateDictionaryAndList()\n        {\n            ExistingValueClass d = JsonConvert.DeserializeObject<ExistingValueClass>(@\"{'Dictionary':{appended:'appended',existing:'new'}}\");\n\n            Assert.IsNotNull(d);\n            Assert.IsNotNull(d.Dictionary);\n            Assert.AreEqual(typeof(Dictionary<string, string>), d.Dictionary.GetType());\n            Assert.AreEqual(typeof(List<string>), d.List.GetType());\n            Assert.AreEqual(2, d.Dictionary.Count);\n            Assert.AreEqual(\"new\", d.Dictionary[\"existing\"]);\n            Assert.AreEqual(\"appended\", d.Dictionary[\"appended\"]);\n            Assert.AreEqual(1, d.List.Count);\n            Assert.AreEqual(\"existing\", d.List[0]);\n        }\n\n        [Test]\n        public void IgnoreIndexedProperties()\n        {\n            ThisGenericTest<KeyValueId> g = new ThisGenericTest<KeyValueId>();\n\n            g.Add(new KeyValueId { Id = 1, Key = \"key1\", Value = \"value1\" });\n            g.Add(new KeyValueId { Id = 2, Key = \"key2\", Value = \"value2\" });\n\n            g.MyProperty = \"some value\";\n\n            string json = g.ToJson();\n\n            StringAssert.AreEqual(@\"{\n  \"\"MyProperty\"\": \"\"some value\"\",\n  \"\"TheItems\"\": [\n    {\n      \"\"Id\"\": 1,\n      \"\"Key\"\": \"\"key1\"\",\n      \"\"Value\"\": \"\"value1\"\"\n    },\n    {\n      \"\"Id\"\": 2,\n      \"\"Key\"\": \"\"key2\"\",\n      \"\"Value\"\": \"\"value2\"\"\n    }\n  ]\n}\", json);\n\n            ThisGenericTest<KeyValueId> gen = JsonConvert.DeserializeObject<ThisGenericTest<KeyValueId>>(json);\n            Assert.AreEqual(\"some value\", gen.MyProperty);\n        }\n\n        [Test]\n        public void JRawValue()\n        {\n            JRawValueTestObject deserialized = JsonConvert.DeserializeObject<JRawValueTestObject>(\"{value:3}\");\n            Assert.AreEqual(\"3\", deserialized.Value.ToString());\n\n            deserialized = JsonConvert.DeserializeObject<JRawValueTestObject>(\"{value:'3'}\");\n            Assert.AreEqual(@\"\"\"3\"\"\", deserialized.Value.ToString());\n        }\n\n        [Test]\n        public void DeserializeDictionaryWithNoDefaultConstructor()\n        {\n            string json = \"{key1:'value1',key2:'value2',key3:'value3'}\";\n\n            var dic = JsonConvert.DeserializeObject<DictionaryWithNoDefaultConstructor>(json);\n\n            Assert.AreEqual(3, dic.Count);\n            Assert.AreEqual(\"value1\", dic[\"key1\"]);\n            Assert.AreEqual(\"value2\", dic[\"key2\"]);\n            Assert.AreEqual(\"value3\", dic[\"key3\"]);\n        }\n\n        [Test]\n        public void DeserializeDictionaryWithNoDefaultConstructor_PreserveReferences()\n        {\n            string json = \"{'$id':'1',key1:'value1',key2:'value2',key3:'value3'}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<DictionaryWithNoDefaultConstructor>(json, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.All,\n                MetadataPropertyHandling = MetadataPropertyHandling.Default\n            }), \"Cannot preserve reference to readonly dictionary, or dictionary created from a non-default constructor: Newtonsoft.Json.Tests.TestObjects.DictionaryWithNoDefaultConstructor. Path 'key1', line 1, position 16.\");\n        }\n\n        [Test]\n        public void SerializeNonPublicBaseJsonProperties()\n        {\n            B value = new B();\n            string json = JsonConvert.SerializeObject(value, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"B2\"\": null,\n  \"\"A1\"\": null,\n  \"\"B3\"\": null,\n  \"\"A2\"\": null\n}\", json);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeDateTimeOffsetAndDateTime()\n        {\n            string jsonIsoText =\n                @\"{\"\"DateTimeOffsetValue\"\":\"\"2012-02-25T19:55:50.6095676+00:00\"\", \"\"DateTimeValue\"\":\"\"2012-02-25T19:55:50.6095676+00:00\"\"}\";\n\n            DateTimeOffsetWrapper cISO = JsonConvert.DeserializeObject<DateTimeOffsetWrapper>(jsonIsoText, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.DateTimeOffset,\n                Converters =\n                {\n                    new IsoDateTimeConverter()\n                }\n            });\n            DateTimeOffsetWrapper c = JsonConvert.DeserializeObject<DateTimeOffsetWrapper>(jsonIsoText, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.DateTimeOffset\n            });\n\n            Assert.AreEqual(c.DateTimeOffsetValue, cISO.DateTimeOffsetValue);\n        }\n#endif\n\n        [Test]\n        public void CircularConstructorDeserialize()\n        {\n            CircularConstructor1 c1 = new CircularConstructor1(null)\n            {\n                StringProperty = \"Value!\"\n            };\n\n            CircularConstructor2 c2 = new CircularConstructor2(null)\n            {\n                IntProperty = 1\n            };\n\n            c1.C2 = c2;\n            c2.C1 = c1;\n\n            string json = JsonConvert.SerializeObject(c1, new JsonSerializerSettings\n            {\n                ReferenceLoopHandling = ReferenceLoopHandling.Ignore,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"C2\"\": {\n    \"\"IntProperty\"\": 1\n  },\n  \"\"StringProperty\"\": \"\"Value!\"\"\n}\", json);\n\n            CircularConstructor1 newC1 = JsonConvert.DeserializeObject<CircularConstructor1>(@\"{\n  \"\"C2\"\": {\n    \"\"IntProperty\"\": 1,\n    \"\"C1\"\": {}\n  },\n  \"\"StringProperty\"\": \"\"Value!\"\"\n}\");\n\n            Assert.AreEqual(\"Value!\", newC1.StringProperty);\n            Assert.AreEqual(1, newC1.C2.IntProperty);\n            Assert.AreEqual(null, newC1.C2.C1.StringProperty);\n            Assert.AreEqual(null, newC1.C2.C1.C2);\n        }\n\n        [Test]\n        public void DeserializeToObjectProperty()\n        {\n            var json = \"{ Key: 'abc', Value: 123 }\";\n            var item = JsonConvert.DeserializeObject<KeyValueTestClass>(json);\n\n            Assert.AreEqual(123L, item.Value);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void DataContractJsonSerializerTest()\n        {\n            DataContractJsonSerializerTestClass c = new DataContractJsonSerializerTestClass()\n            {\n                TimeSpanProperty = new TimeSpan(200, 20, 59, 30, 900),\n                GuidProperty = new Guid(\"66143115-BE2A-4a59-AF0A-348E1EA15B1E\"),\n                AnimalProperty = new Human() { Ethnicity = \"European\" }\n            };\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer serializer = new DataContractJsonSerializer(\n                typeof(DataContractJsonSerializerTestClass),\n                new Type[] { typeof(Human) });\n            serializer.WriteObject(ms, c);\n\n            byte[] jsonBytes = ms.ToArray();\n            string json = Encoding.UTF8.GetString(jsonBytes, 0, jsonBytes.Length);\n\n            //Console.WriteLine(JObject.Parse(json).ToString());\n            //Console.WriteLine();\n\n            //Console.WriteLine(JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            //  {\n            //    //               TypeNameHandling = TypeNameHandling.Objects\n            //  }));\n        }\n#endif\n\n        [Test]\n        public void SerializeNonIDictionary()\n        {\n            ModelStateDictionary<string> modelStateDictionary = new ModelStateDictionary<string>();\n            modelStateDictionary.Add(\"key\", \"value\");\n\n            string json = JsonConvert.SerializeObject(modelStateDictionary);\n\n            Assert.AreEqual(@\"{\"\"key\"\":\"\"value\"\"}\", json);\n\n            ModelStateDictionary<string> newModelStateDictionary = JsonConvert.DeserializeObject<ModelStateDictionary<string>>(json);\n            Assert.AreEqual(1, newModelStateDictionary.Count);\n            Assert.AreEqual(\"value\", newModelStateDictionary[\"key\"]);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n#if DEBUG\n        [Test]\n        public void SerializeISerializableInPartialTrustWithIgnoreInterface()\n        {\n            try\n            {\n                JsonTypeReflector.SetFullyTrusted(false);\n                ISerializableTestObject value = new ISerializableTestObject(\"string!\", 0, default(DateTimeOffset), null);\n\n                string json = JsonConvert.SerializeObject(value, new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableInterface = true\n                    }\n                });\n\n                Assert.AreEqual(\"{}\", json);\n\n                value = JsonConvert.DeserializeObject<ISerializableTestObject>(\"{booleanValue:true}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableInterface = true\n                    }\n                });\n\n                Assert.IsNotNull(value);\n                Assert.AreEqual(false, value._booleanValue);\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n\n        [Test]\n        public void SerializeISerializableInPartialTrust()\n        {\n            try\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonTypeReflector.SetFullyTrusted(false);\n\n                    JsonConvert.DeserializeObject<ISerializableTestObject>(\"{booleanValue:true}\");\n                }, @\"Type 'Newtonsoft.Json.Tests.TestObjects.ISerializableTestObject' implements ISerializable but cannot be deserialized using the ISerializable interface because the current application is not fully trusted and ISerializable can expose secure data.\" + Environment.NewLine +\n                   @\"To fix this error either change the environment to be fully trusted, change the application to not deserialize the type, add JsonObjectAttribute to the type or change the JsonSerializer setting ContractResolver to use a new DefaultContractResolver with IgnoreSerializableInterface set to true.\" + Environment.NewLine +\n                   @\"Path 'booleanValue', line 1, position 14.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n\n        [Test]\n        public void DeserializeISerializableInPartialTrust()\n        {\n            try\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonTypeReflector.SetFullyTrusted(false);\n                    ISerializableTestObject value = new ISerializableTestObject(\"string!\", 0, default(DateTimeOffset), null);\n\n                    JsonConvert.SerializeObject(value);\n                }, @\"Type 'Newtonsoft.Json.Tests.TestObjects.ISerializableTestObject' implements ISerializable but cannot be serialized using the ISerializable interface because the current application is not fully trusted and ISerializable can expose secure data.\" + Environment.NewLine +\n                   @\"To fix this error either change the environment to be fully trusted, change the application to not deserialize the type, add JsonObjectAttribute to the type or change the JsonSerializer setting ContractResolver to use a new DefaultContractResolver with IgnoreSerializableInterface set to true.\" + Environment.NewLine +\n                   @\"Path ''.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n#endif\n\n        [Test]\n        public void SerializeISerializableTestObject_IsoDate()\n        {\n            Person person = new Person();\n            person.BirthDate = new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc);\n            person.LastModified = person.BirthDate;\n            person.Department = \"Department!\";\n            person.Name = \"Name!\";\n\n            DateTimeOffset dateTimeOffset = new DateTimeOffset(2000, 12, 20, 22, 59, 59, TimeSpan.FromHours(2));\n            string dateTimeOffsetText;\n#if !NET20\n            dateTimeOffsetText = @\"2000-12-20T22:59:59+02:00\";\n#else\n            dateTimeOffsetText = @\"12/20/2000 22:59:59 +02:00\";\n#endif\n\n            ISerializableTestObject o = new ISerializableTestObject(\"String!\", int.MinValue, dateTimeOffset, person);\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"stringValue\"\": \"\"String!\"\",\n  \"\"intValue\"\": -2147483648,\n  \"\"dateTimeOffsetValue\"\": \"\"\" + dateTimeOffsetText + @\"\"\",\n  \"\"personValue\"\": {\n    \"\"Name\"\": \"\"Name!\"\",\n    \"\"BirthDate\"\": \"\"2000-01-01T01:01:01Z\"\",\n    \"\"LastModified\"\": \"\"2000-01-01T01:01:01Z\"\"\n  },\n  \"\"nullPersonValue\"\": null,\n  \"\"nullableInt\"\": null,\n  \"\"booleanValue\"\": false,\n  \"\"byteValue\"\": 0,\n  \"\"charValue\"\": \"\"\\u0000\"\",\n  \"\"dateTimeValue\"\": \"\"0001-01-01T00:00:00Z\"\",\n  \"\"decimalValue\"\": 0.0,\n  \"\"shortValue\"\": 0,\n  \"\"longValue\"\": 0,\n  \"\"sbyteValue\"\": 0,\n  \"\"floatValue\"\": 0.0,\n  \"\"ushortValue\"\": 0,\n  \"\"uintValue\"\": 0,\n  \"\"ulongValue\"\": 0\n}\", json);\n\n            ISerializableTestObject o2 = JsonConvert.DeserializeObject<ISerializableTestObject>(json);\n            Assert.AreEqual(\"String!\", o2._stringValue);\n            Assert.AreEqual(int.MinValue, o2._intValue);\n            Assert.AreEqual(dateTimeOffset, o2._dateTimeOffsetValue);\n            Assert.AreEqual(\"Name!\", o2._personValue.Name);\n            Assert.AreEqual(null, o2._nullPersonValue);\n            Assert.AreEqual(null, o2._nullableInt);\n        }\n\n        [Test]\n        public void SerializeISerializableTestObject_MsAjax()\n        {\n            Person person = new Person();\n            person.BirthDate = new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc);\n            person.LastModified = person.BirthDate;\n            person.Department = \"Department!\";\n            person.Name = \"Name!\";\n\n            DateTimeOffset dateTimeOffset = new DateTimeOffset(2000, 12, 20, 22, 59, 59, TimeSpan.FromHours(2));\n            string dateTimeOffsetText;\n#if !NET20\n            dateTimeOffsetText = @\"\\/Date(977345999000+0200)\\/\";\n#else\n            dateTimeOffsetText = @\"12/20/2000 22:59:59 +02:00\";\n#endif\n\n            ISerializableTestObject o = new ISerializableTestObject(\"String!\", int.MinValue, dateTimeOffset, person);\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n            StringAssert.AreEqual(@\"{\n  \"\"stringValue\"\": \"\"String!\"\",\n  \"\"intValue\"\": -2147483648,\n  \"\"dateTimeOffsetValue\"\": \"\"\" + dateTimeOffsetText + @\"\"\",\n  \"\"personValue\"\": {\n    \"\"Name\"\": \"\"Name!\"\",\n    \"\"BirthDate\"\": \"\"\\/Date(946688461000)\\/\"\",\n    \"\"LastModified\"\": \"\"\\/Date(946688461000)\\/\"\"\n  },\n  \"\"nullPersonValue\"\": null,\n  \"\"nullableInt\"\": null,\n  \"\"booleanValue\"\": false,\n  \"\"byteValue\"\": 0,\n  \"\"charValue\"\": \"\"\\u0000\"\",\n  \"\"dateTimeValue\"\": \"\"\\/Date(-62135596800000)\\/\"\",\n  \"\"decimalValue\"\": 0.0,\n  \"\"shortValue\"\": 0,\n  \"\"longValue\"\": 0,\n  \"\"sbyteValue\"\": 0,\n  \"\"floatValue\"\": 0.0,\n  \"\"ushortValue\"\": 0,\n  \"\"uintValue\"\": 0,\n  \"\"ulongValue\"\": 0\n}\", json);\n\n            ISerializableTestObject o2 = JsonConvert.DeserializeObject<ISerializableTestObject>(json);\n            Assert.AreEqual(\"String!\", o2._stringValue);\n            Assert.AreEqual(int.MinValue, o2._intValue);\n            Assert.AreEqual(dateTimeOffset, o2._dateTimeOffsetValue);\n            Assert.AreEqual(\"Name!\", o2._personValue.Name);\n            Assert.AreEqual(null, o2._nullPersonValue);\n            Assert.AreEqual(null, o2._nullableInt);\n        }\n#endif\n\n        [Test]\n        public void DeserializeUsingNonDefaultConstructorWithLeftOverValues()\n        {\n            List<KVPair<string, string>> kvPairs =\n                JsonConvert.DeserializeObject<List<KVPair<string, string>>>(\n                    \"[{\\\"Key\\\":\\\"Two\\\",\\\"Value\\\":\\\"2\\\"},{\\\"Key\\\":\\\"One\\\",\\\"Value\\\":\\\"1\\\"}]\");\n\n            Assert.AreEqual(2, kvPairs.Count);\n            Assert.AreEqual(\"Two\", kvPairs[0].Key);\n            Assert.AreEqual(\"2\", kvPairs[0].Value);\n            Assert.AreEqual(\"One\", kvPairs[1].Key);\n            Assert.AreEqual(\"1\", kvPairs[1].Value);\n        }\n\n        [Test]\n        public void SerializeClassWithInheritedProtectedMember()\n        {\n            AATestClass myA = new AATestClass(2);\n            string json = JsonConvert.SerializeObject(myA, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"AA_field1\"\": 2,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2\n}\", json);\n\n            BBTestClass myB = new BBTestClass(3, 4);\n            json = JsonConvert.SerializeObject(myB, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"BB_field1\"\": 4,\n  \"\"BB_field2\"\": 4,\n  \"\"AA_field1\"\": 3,\n  \"\"BB_property1\"\": 4,\n  \"\"BB_property2\"\": 4,\n  \"\"BB_property3\"\": 4,\n  \"\"BB_property4\"\": 4,\n  \"\"BB_property5\"\": 4,\n  \"\"BB_property7\"\": 4,\n  \"\"AA_property1\"\": 3,\n  \"\"AA_property2\"\": 3,\n  \"\"AA_property3\"\": 3,\n  \"\"AA_property4\"\": 3\n}\", json);\n        }\n\n#if !(PORTABLE) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeClassWithInheritedProtectedMember()\n        {\n            AATestClass myA = JsonConvert.DeserializeObject<AATestClass>(\n                @\"{\n  \"\"AA_field1\"\": 2,\n  \"\"AA_field2\"\": 2,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2,\n  \"\"AA_property5\"\": 2,\n  \"\"AA_property6\"\": 2\n}\");\n\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field1\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field2\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property1\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property2\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property3\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property5\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property6\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n\n            BBTestClass myB = JsonConvert.DeserializeObject<BBTestClass>(\n                @\"{\n  \"\"BB_field1\"\": 4,\n  \"\"BB_field2\"\": 4,\n  \"\"AA_field1\"\": 3,\n  \"\"AA_field2\"\": 3,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2,\n  \"\"AA_property5\"\": 2,\n  \"\"AA_property6\"\": 2,\n  \"\"BB_property1\"\": 3,\n  \"\"BB_property2\"\": 3,\n  \"\"BB_property3\"\": 3,\n  \"\"BB_property4\"\": 3,\n  \"\"BB_property5\"\": 3,\n  \"\"BB_property6\"\": 3,\n  \"\"BB_property7\"\": 3,\n  \"\"BB_property8\"\": 3\n}\");\n\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field1\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field2\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property1\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property2\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property3\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property5\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property6\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n\n            Assert.AreEqual(4, myB.BB_field1);\n            Assert.AreEqual(4, myB.BB_field2);\n            Assert.AreEqual(3, myB.BB_property1);\n            Assert.AreEqual(3, myB.BB_property2);\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property3\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, myB.BB_property5);\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property6\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property7\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property8\", BindingFlags.Instance | BindingFlags.Public), myB));\n        }\n#endif\n\n#if !(NET20 || PORTABLE40)\n        [Test]\n        public void SerializeDeserializeXNodeProperties()\n        {\n            XNodeTestObject testObject = new XNodeTestObject();\n            testObject.Document = XDocument.Parse(\"<root>hehe, root</root>\");\n            testObject.Element = XElement.Parse(@\"<fifth xmlns:json=\"\"http://json.org\"\" json:Awesome=\"\"true\"\">element</fifth>\");\n\n            string json = JsonConvert.SerializeObject(testObject, Formatting.Indented);\n            string expected = @\"{\n  \"\"Document\"\": {\n    \"\"root\"\": \"\"hehe, root\"\"\n  },\n  \"\"Element\"\": {\n    \"\"fifth\"\": {\n      \"\"@xmlns:json\"\": \"\"http://json.org\"\",\n      \"\"@json:Awesome\"\": \"\"true\"\",\n      \"\"#text\"\": \"\"element\"\"\n    }\n  }\n}\";\n            StringAssert.AreEqual(expected, json);\n\n            XNodeTestObject newTestObject = JsonConvert.DeserializeObject<XNodeTestObject>(json);\n            Assert.AreEqual(testObject.Document.ToString(), newTestObject.Document.ToString());\n            Assert.AreEqual(testObject.Element.ToString(), newTestObject.Element.ToString());\n\n            Assert.IsNull(newTestObject.Element.Parent);\n        }\n#endif\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeDeserializeXmlNodeProperties()\n        {\n            XmlNodeTestObject testObject = new XmlNodeTestObject();\n            XmlDocument document = new XmlDocument();\n            document.LoadXml(\"<root>hehe, root</root>\");\n            testObject.Document = document;\n\n            string json = JsonConvert.SerializeObject(testObject, Formatting.Indented);\n            string expected = @\"{\n  \"\"Document\"\": {\n    \"\"root\"\": \"\"hehe, root\"\"\n  }\n}\";\n            StringAssert.AreEqual(expected, json);\n\n            XmlNodeTestObject newTestObject = JsonConvert.DeserializeObject<XmlNodeTestObject>(json);\n            Assert.AreEqual(testObject.Document.InnerXml, newTestObject.Document.InnerXml);\n        }\n#endif\n\n        [Test]\n        public void FullClientMapSerialization()\n        {\n            ClientMap source = new ClientMap()\n            {\n                position = new Pos() { X = 100, Y = 200 },\n                center = new PosDouble() { X = 251.6, Y = 361.3 }\n            };\n\n            string json = JsonConvert.SerializeObject(source, new PosConverter(), new PosDoubleConverter());\n            Assert.AreEqual(\"{\\\"position\\\":new Pos(100,200),\\\"center\\\":new PosD(251.6,361.3)}\", json);\n        }\n\n        [Test]\n        public void SerializeRefAdditionalContent()\n        {\n            //Additional text found in JSON string after finishing deserializing object.\n            //Test 1\n            var reference = new Dictionary<string, object>();\n            reference.Add(\"$ref\", \"Persons\");\n            reference.Add(\"$id\", 1);\n\n            var child = new Dictionary<string, object>();\n            child.Add(\"_id\", 2);\n            child.Add(\"Name\", \"Isabell\");\n            child.Add(\"Father\", reference);\n\n            var json = JsonConvert.SerializeObject(child, Formatting.Indented);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Dictionary<string, object>>(json); }, \"Additional content found in JSON reference object. A JSON reference object should only have a $ref property. Path 'Father.$id', line 6, position 10.\");\n        }\n\n        [Test]\n        public void SerializeRefBadType()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                //Additional text found in JSON string after finishing deserializing object.\n                //Test 1\n                var reference = new Dictionary<string, object>();\n                reference.Add(\"$ref\", 1);\n                reference.Add(\"$id\", 1);\n\n                var child = new Dictionary<string, object>();\n                child.Add(\"_id\", 2);\n                child.Add(\"Name\", \"Isabell\");\n                child.Add(\"Father\", reference);\n\n                var json = JsonConvert.SerializeObject(child, Formatting.Indented);\n                JsonConvert.DeserializeObject<Dictionary<string, object>>(json);\n            }, \"JSON reference $ref property must have a string or null value. Path 'Father.$ref', line 5, position 13.\");\n        }\n\n        [Test]\n        public void SerializeRefNull()\n        {\n            var reference = new Dictionary<string, object>();\n            reference.Add(\"$ref\", null);\n            reference.Add(\"$id\", null);\n            reference.Add(\"blah\", \"blah!\");\n\n            var child = new Dictionary<string, object>();\n            child.Add(\"_id\", 2);\n            child.Add(\"Name\", \"Isabell\");\n            child.Add(\"Father\", reference);\n\n            string json = JsonConvert.SerializeObject(child);\n\n            Assert.AreEqual(@\"{\"\"_id\"\":2,\"\"Name\"\":\"\"Isabell\"\",\"\"Father\"\":{\"\"$ref\"\":null,\"\"$id\"\":null,\"\"blah\"\":\"\"blah!\"\"}}\", json);\n\n            Dictionary<string, object> result = JsonConvert.DeserializeObject<Dictionary<string, object>>(json);\n\n            Assert.AreEqual(3, result.Count);\n            Assert.AreEqual(1, ((JObject)result[\"Father\"]).Count);\n            Assert.AreEqual(\"blah!\", (string)((JObject)result[\"Father\"])[\"blah\"]);\n        }\n\n        [Test]\n        public void DeserializeIgnoredPropertyInConstructor()\n        {\n            string json = @\"{\"\"First\"\":\"\"First\"\",\"\"Second\"\":2,\"\"Ignored\"\":{\"\"Name\"\":\"\"James\"\"},\"\"AdditionalContent\"\":{\"\"LOL\"\":true}}\";\n\n            var cc = JsonConvert.DeserializeObject<ConstructorCompexIgnoredProperty>(json);\n            Assert.AreEqual(\"First\", cc.First);\n            Assert.AreEqual(2, cc.Second);\n            Assert.AreEqual(null, cc.Ignored);\n        }\n        \n        [Test]\n        public void DeserializeIgnoredPropertyInConstructorWithoutThrowingMissingMemberError()\n        {\n            string json = @\"{\"\"First\"\":\"\"First\"\",\"\"Second\"\":2,\"\"Ignored\"\":{\"\"Name\"\":\"\"James\"\"}}\";\n\n            var cc = JsonConvert.DeserializeObject<ConstructorCompexIgnoredProperty>(\n                json, new JsonSerializerSettings\n                {\n                    MissingMemberHandling = MissingMemberHandling.Error\n                });\n            Assert.AreEqual(\"First\", cc.First);\n            Assert.AreEqual(2, cc.Second);\n            Assert.AreEqual(null, cc.Ignored);\n        }\n\n        [Test]\n        public void DeserializeFloatAsDecimal()\n        {\n            string json = @\"{'value':9.9}\";\n\n            var dic = JsonConvert.DeserializeObject<IDictionary<string, object>>(\n                json, new JsonSerializerSettings\n                {\n                    FloatParseHandling = FloatParseHandling.Decimal\n                });\n\n            Assert.AreEqual(typeof(decimal), dic[\"value\"].GetType());\n            Assert.AreEqual(9.9m, dic[\"value\"]);\n        }\n\n        [Test]\n        public void SerializeDeserializeDictionaryKey()\n        {\n            Dictionary<DictionaryKey, string> dictionary = new Dictionary<DictionaryKey, string>();\n\n            dictionary.Add(new DictionaryKey() { Value = \"First!\" }, \"First\");\n            dictionary.Add(new DictionaryKey() { Value = \"Second!\" }, \"Second\");\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"First!\"\": \"\"First\"\",\n  \"\"Second!\"\": \"\"Second\"\"\n}\", json);\n\n            Dictionary<DictionaryKey, string> newDictionary =\n                JsonConvert.DeserializeObject<Dictionary<DictionaryKey, string>>(json);\n\n            Assert.AreEqual(2, newDictionary.Count);\n        }\n\n        [Test]\n        public void SerializeNullableArray()\n        {\n            string jsonText = JsonConvert.SerializeObject(new double?[] { 2.4, 4.3, null }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  2.4,\n  4.3,\n  null\n]\", jsonText);\n        }\n\n        [Test]\n        public void DeserializeNullableArray()\n        {\n            double?[] d = (double?[])JsonConvert.DeserializeObject(@\"[\n  2.4,\n  4.3,\n  null\n]\", typeof(double?[]));\n\n            Assert.AreEqual(3, d.Length);\n            Assert.AreEqual(2.4, d[0]);\n            Assert.AreEqual(4.3, d[1]);\n            Assert.AreEqual(null, d[2]);\n        }\n\n#if !NET20\n        [Test]\n        public void SerializeHashSet()\n        {\n            string jsonText = JsonConvert.SerializeObject(new HashSet<string>()\n            {\n                \"One\",\n                \"2\",\n                \"III\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  \"\"One\"\",\n  \"\"2\"\",\n  \"\"III\"\"\n]\", jsonText);\n\n            HashSet<string> d = JsonConvert.DeserializeObject<HashSet<string>>(jsonText);\n\n            Assert.AreEqual(3, d.Count);\n            Assert.IsTrue(d.Contains(\"One\"));\n            Assert.IsTrue(d.Contains(\"2\"));\n            Assert.IsTrue(d.Contains(\"III\"));\n        }\n#endif\n\n        [Test]\n        public void DeserializeByteArray()\n        {\n            JsonSerializer serializer1 = new JsonSerializer();\n            serializer1.Converters.Add(new IsoDateTimeConverter());\n            serializer1.NullValueHandling = NullValueHandling.Ignore;\n\n            string json = @\"[{\"\"Prop1\"\":\"\"\"\"},{\"\"Prop1\"\":\"\"\"\"}]\";\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n\n            ByteArrayTestClass[] z = (ByteArrayTestClass[])serializer1.Deserialize(reader, typeof(ByteArrayTestClass[]));\n            Assert.AreEqual(2, z.Length);\n            Assert.AreEqual(0, z[0].Prop1.Length);\n            Assert.AreEqual(0, z[1].Prop1.Length);\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void StringDictionaryTest()\n        {\n            string classRef = typeof(StringDictionary).FullName;\n\n            StringDictionaryTestClass s1 = new StringDictionaryTestClass()\n            {\n                StringDictionaryProperty = new StringDictionary()\n                {\n                    { \"1\", \"One\" },\n                    { \"2\", \"II\" },\n                    { \"3\", \"3\" }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(s1, Formatting.Indented);\n\n            // .NET 4.5.3 added IDictionary<string, string> to StringDictionary\n            if (s1.StringDictionaryProperty is IDictionary<string, string>)\n            {\n                StringDictionaryTestClass d = JsonConvert.DeserializeObject<StringDictionaryTestClass>(json);\n\n                Assert.AreEqual(3, d.StringDictionaryProperty.Count);\n                Assert.AreEqual(\"One\", d.StringDictionaryProperty[\"1\"]);\n                Assert.AreEqual(\"II\", d.StringDictionaryProperty[\"2\"]);\n                Assert.AreEqual(\"3\", d.StringDictionaryProperty[\"3\"]);\n            }\n            else\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<StringDictionaryTestClass>(json); }, \"Cannot create and populate list type \" + classRef + \". Path 'StringDictionaryProperty', line 2, position 31.\");\n            }\n        }\n#endif\n\n        [Test]\n        public void SerializeStructWithJsonObjectAttribute()\n        {\n            StructWithAttribute testStruct = new StructWithAttribute\n            {\n                MyInt = int.MaxValue\n            };\n\n            string json = JsonConvert.SerializeObject(testStruct, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"MyInt\"\": 2147483647\n}\", json);\n\n            StructWithAttribute newStruct = JsonConvert.DeserializeObject<StructWithAttribute>(json);\n\n            Assert.AreEqual(int.MaxValue, newStruct.MyInt);\n        }\n\n#if !NET20\n        [Test]\n        public void ReadWriteTimeZoneOffsetIso()\n        {\n            var serializeObject = JsonConvert.SerializeObject(new TimeZoneOffsetObject\n            {\n                Offset = new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6))\n            });\n\n            Assert.AreEqual(\"{\\\"Offset\\\":\\\"2000-01-01T00:00:00+06:00\\\"}\", serializeObject);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(serializeObject))\n            {\n                DateParseHandling = DateParseHandling.None\n            };\n            JsonSerializer serializer = new JsonSerializer();\n\n            var deserializeObject = serializer.Deserialize<TimeZoneOffsetObject>(reader);\n\n            Assert.AreEqual(TimeSpan.FromHours(6), deserializeObject.Offset.Offset);\n            Assert.AreEqual(new DateTime(2000, 1, 1), deserializeObject.Offset.Date);\n        }\n\n        [Test]\n        public void DeserializePropertyNullableDateTimeOffsetExactIso()\n        {\n            NullableDateTimeTestClass d = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\"{\\\"DateTimeOffsetField\\\":\\\"2000-01-01T00:00:00+06:00\\\"}\");\n            Assert.AreEqual(new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6)), d.DateTimeOffsetField);\n        }\n\n        [Test]\n        public void ReadWriteTimeZoneOffsetMsAjax()\n        {\n            var serializeObject = JsonConvert.SerializeObject(new TimeZoneOffsetObject\n            {\n                Offset = new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6))\n            }, Formatting.None, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n\n            Assert.AreEqual(\"{\\\"Offset\\\":\\\"\\\\/Date(946663200000+0600)\\\\/\\\"}\", serializeObject);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(serializeObject));\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.DateParseHandling = DateParseHandling.None;\n\n            var deserializeObject = serializer.Deserialize<TimeZoneOffsetObject>(reader);\n\n            Assert.AreEqual(TimeSpan.FromHours(6), deserializeObject.Offset.Offset);\n            Assert.AreEqual(new DateTime(2000, 1, 1), deserializeObject.Offset.Date);\n        }\n\n        [Test]\n        public void DeserializePropertyNullableDateTimeOffsetExactMsAjax()\n        {\n            NullableDateTimeTestClass d = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\"{\\\"DateTimeOffsetField\\\":\\\"\\\\/Date(946663200000+0600)\\\\/\\\"}\");\n            Assert.AreEqual(new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6)), d.DateTimeOffsetField);\n        }\n#endif\n\n        [Test]\n        public void OverridenPropertyMembers()\n        {\n            string json = JsonConvert.SerializeObject(new DerivedEvent(), Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"event\"\": \"\"derived\"\"\n}\", json);\n        }\n\n#if !(NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void SerializeExpandoObject()\n        {\n            dynamic expando = new ExpandoObject();\n            expando.Int = 1;\n            expando.Decimal = 99.9d;\n            expando.Complex = new ExpandoObject();\n            expando.Complex.String = \"I am a string\";\n            expando.Complex.DateTime = new DateTime(2000, 12, 20, 18, 55, 0, DateTimeKind.Utc);\n\n            string json = JsonConvert.SerializeObject(expando, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Int\"\": 1,\n  \"\"Decimal\"\": 99.9,\n  \"\"Complex\"\": {\n    \"\"String\"\": \"\"I am a string\"\",\n    \"\"DateTime\"\": \"\"2000-12-20T18:55:00Z\"\"\n  }\n}\", json);\n\n            IDictionary<string, object> newExpando = JsonConvert.DeserializeObject<ExpandoObject>(json);\n\n            CustomAssert.IsInstanceOfType(typeof(long), newExpando[\"Int\"]);\n            Assert.AreEqual((long)expando.Int, newExpando[\"Int\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(double), newExpando[\"Decimal\"]);\n            Assert.AreEqual(expando.Decimal, newExpando[\"Decimal\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(ExpandoObject), newExpando[\"Complex\"]);\n            IDictionary<string, object> o = (ExpandoObject)newExpando[\"Complex\"];\n\n            CustomAssert.IsInstanceOfType(typeof(string), o[\"String\"]);\n            Assert.AreEqual(expando.Complex.String, o[\"String\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(DateTime), o[\"DateTime\"]);\n            Assert.AreEqual(expando.Complex.DateTime, o[\"DateTime\"]);\n        }\n#endif\n\n        [Test]\n        public void DeserializeDecimalExact()\n        {\n            decimal d = JsonConvert.DeserializeObject<decimal>(\"123456789876543.21\");\n            Assert.AreEqual(123456789876543.21m, d);\n        }\n\n        [Test]\n        public void DeserializeNullableDecimalExact()\n        {\n            decimal? d = JsonConvert.DeserializeObject<decimal?>(\"123456789876543.21\");\n            Assert.AreEqual(123456789876543.21m, d);\n        }\n\n        [Test]\n        public void DeserializeDecimalPropertyExact()\n        {\n            string json = \"{Amount:123456789876543.21}\";\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n            reader.FloatParseHandling = FloatParseHandling.Decimal;\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            Invoice i = serializer.Deserialize<Invoice>(reader);\n            Assert.AreEqual(123456789876543.21m, i.Amount);\n        }\n\n        [Test]\n        public void DeserializeDecimalArrayExact()\n        {\n            string json = \"[123456789876543.21]\";\n            IList<decimal> a = JsonConvert.DeserializeObject<IList<decimal>>(json);\n            Assert.AreEqual(123456789876543.21m, a[0]);\n        }\n\n        [Test]\n        public void DeserializeDecimalDictionaryExact()\n        {\n            string json = \"{'Value':123456789876543.21}\";\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n            reader.FloatParseHandling = FloatParseHandling.Decimal;\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            IDictionary<string, decimal> d = serializer.Deserialize<IDictionary<string, decimal>>(reader);\n            Assert.AreEqual(123456789876543.21m, d[\"Value\"]);\n        }\n\n        [Test]\n        public void DeserializeStructProperty()\n        {\n            VectorParent obj = new VectorParent();\n            obj.Position = new TestObjects.Vector { X = 1, Y = 2, Z = 3 };\n\n            string str = JsonConvert.SerializeObject(obj);\n\n            obj = JsonConvert.DeserializeObject<VectorParent>(str);\n\n            Assert.AreEqual(1, obj.Position.X);\n            Assert.AreEqual(2, obj.Position.Y);\n            Assert.AreEqual(3, obj.Position.Z);\n        }\n\n        [Test]\n        public void PrivateSetterOnBaseClassProperty()\n        {\n            var derived = new PrivateSetterDerived(\"meh\", \"woo\");\n\n            var settings = new JsonSerializerSettings\n            {\n                TypeNameHandling = TypeNameHandling.Objects,\n                ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor\n            };\n\n            string json = JsonConvert.SerializeObject(derived, Formatting.Indented, settings);\n\n            var meh = JsonConvert.DeserializeObject<PrivateSetterBase>(json, settings);\n\n            Assert.AreEqual(((PrivateSetterDerived)meh).IDoWork, \"woo\");\n            Assert.AreEqual(meh.IDontWork, \"meh\");\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeNullableStruct()\n        {\n            NullableStructPropertyClass nullableStructPropertyClass = new NullableStructPropertyClass()\n            {\n                Foo1 = new StructISerializable() { Name = \"foo 1\" },\n                Foo2 = new StructISerializable() { Name = \"foo 2\" }\n            };\n            NullableStructPropertyClass barWithNull = new NullableStructPropertyClass()\n            {\n                Foo1 = new StructISerializable() { Name = \"foo 1\" },\n                Foo2 = null\n            };\n\n            //throws error on deserialization because bar1.Foo2 is of type Foo?\n            string s = JsonConvert.SerializeObject(nullableStructPropertyClass);\n            NullableStructPropertyClass deserialized = deserialize(s);\n            Assert.AreEqual(deserialized.Foo1.Name, \"foo 1\");\n            Assert.AreEqual(deserialized.Foo2.Value.Name, \"foo 2\");\n\n            //no error Foo2 is null\n            s = JsonConvert.SerializeObject(barWithNull);\n            deserialized = deserialize(s);\n            Assert.AreEqual(deserialized.Foo1.Name, \"foo 1\");\n            Assert.AreEqual(deserialized.Foo2, null);\n        }\n\n        private static NullableStructPropertyClass deserialize(string serStr)\n        {\n            return JsonConvert.DeserializeObject<NullableStructPropertyClass>(\n                serStr,\n                new JsonSerializerSettings\n                {\n                    NullValueHandling = NullValueHandling.Ignore,\n                    MissingMemberHandling = MissingMemberHandling.Ignore\n                });\n        }\n#endif\n\n        [Test]\n        public void DeserializeJToken()\n        {\n            JTokenTestClass c = new JTokenTestClass\n            {\n                Name = \"Success\",\n                Data = new JObject(new JProperty(\"First\", \"Value1\"), new JProperty(\"Second\", \"Value2\"))\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            JTokenTestClass deserializedResponse = JsonConvert.DeserializeObject<JTokenTestClass>(json);\n\n            Assert.AreEqual(\"Success\", deserializedResponse.Name);\n            Assert.IsTrue(deserializedResponse.Data.DeepEquals(c.Data));\n        }\n\n        [Test]\n        public void DeserializeMinValueDecimal()\n        {\n            var data = new DecimalTest(decimal.MinValue);\n            var json = JsonConvert.SerializeObject(data);\n            var obj = JsonConvert.DeserializeObject<DecimalTest>(json, new JsonSerializerSettings { MetadataPropertyHandling = MetadataPropertyHandling.Default });\n\n            Assert.AreEqual(decimal.MinValue, obj.Value);\n        }\n\n        [Test]\n        public void NonPublicConstructorWithJsonConstructorTest()\n        {\n            NonPublicConstructorWithJsonConstructor c = JsonConvert.DeserializeObject<NonPublicConstructorWithJsonConstructor>(\"{}\");\n            Assert.AreEqual(\"NonPublic\", c.Constructor);\n        }\n\n        [Test]\n        public void PublicConstructorOverridenByJsonConstructorTest()\n        {\n            PublicConstructorOverridenByJsonConstructor c = JsonConvert.DeserializeObject<PublicConstructorOverridenByJsonConstructor>(\"{Value:'value!'}\");\n            Assert.AreEqual(\"Public Parameterized\", c.Constructor);\n            Assert.AreEqual(\"value!\", c.Value);\n        }\n\n        [Test]\n        public void MultipleParametrizedConstructorsJsonConstructorTest()\n        {\n            MultipleParametrizedConstructorsJsonConstructor c = JsonConvert.DeserializeObject<MultipleParametrizedConstructorsJsonConstructor>(\"{Value:'value!', Age:1}\");\n            Assert.AreEqual(\"Public Parameterized 2\", c.Constructor);\n            Assert.AreEqual(\"value!\", c.Value);\n            Assert.AreEqual(1, c.Age);\n        }\n\n        [Test]\n        public void DeserializeEnumerable()\n        {\n            EnumerableClass c = new EnumerableClass\n            {\n                Enumerable = new List<string> { \"One\", \"Two\", \"Three\" }\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Enumerable\"\": [\n    \"\"One\"\",\n    \"\"Two\"\",\n    \"\"Three\"\"\n  ]\n}\", json);\n\n            EnumerableClass c2 = JsonConvert.DeserializeObject<EnumerableClass>(json);\n\n            Assert.AreEqual(\"One\", c2.Enumerable.ElementAt(0));\n            Assert.AreEqual(\"Two\", c2.Enumerable.ElementAt(1));\n            Assert.AreEqual(\"Three\", c2.Enumerable.ElementAt(2));\n        }\n\n        [Test]\n        public void SerializeAttributesOnBase()\n        {\n            ComplexItem i = new ComplexItem();\n\n            string json = JsonConvert.SerializeObject(i, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeStringEnglish()\n        {\n            string json = @\"{\n  'Name': 'James Hughes',\n  'Age': '40',\n  'Height': '44.4',\n  'Price': '4'\n}\";\n\n            DeserializeStringConvert p = JsonConvert.DeserializeObject<DeserializeStringConvert>(json);\n            Assert.AreEqual(40, p.Age);\n            Assert.AreEqual(44.4, p.Height);\n            Assert.AreEqual(4m, p.Price);\n        }\n\n        [Test]\n        public void DeserializeNullDateTimeValueTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject(\"null\", typeof(DateTime)); }, \"Error converting value {null} to type 'System.DateTime'. Path '', line 1, position 4.\");\n        }\n\n        [Test]\n        public void DeserializeNullNullableDateTimeValueTest()\n        {\n            object dateTime = JsonConvert.DeserializeObject(\"null\", typeof(DateTime?));\n\n            Assert.IsNull(dateTime);\n        }\n\n        [Test]\n        public void MultiIndexSuperTest()\n        {\n            MultiIndexSuper e = new MultiIndexSuper();\n\n            string json = JsonConvert.SerializeObject(e, Formatting.Indented);\n\n            Assert.AreEqual(@\"{}\", json);\n        }\n\n        [Test]\n        public void CommentTestClassTest()\n        {\n            string json = @\"{\"\"indexed\"\":true, \"\"startYear\"\":1939, \"\"values\"\":\n                            [  3000,  /* 1940-1949 */\n                               3000,   3600,   3600,   3600,   3600,   4200,   4200,   4200,   4200,   4800,  /* 1950-1959 */\n                               4800,   4800,   4800,   4800,   4800,   4800,   6600,   6600,   7800,   7800,  /* 1960-1969 */\n                               7800,   7800,   9000,  10800,  13200,  14100,  15300,  16500,  17700,  22900,  /* 1970-1979 */\n                              25900,  29700,  32400,  35700,  37800,  39600,  42000,  43800,  45000,  48000,  /* 1980-1989 */\n                              51300,  53400,  55500,  57600,  60600,  61200,  62700,  65400,  68400,  72600,  /* 1990-1999 */\n                              76200,  80400,  84900,  87000,  87900,  90000,  94200,  97500, 102000, 106800,  /* 2000-2009 */\n                             106800, 106800]  /* 2010-2011 */\n                                }\";\n\n            CommentTestClass commentTestClass = JsonConvert.DeserializeObject<CommentTestClass>(json);\n\n            Assert.AreEqual(true, commentTestClass.Indexed);\n            Assert.AreEqual(1939, commentTestClass.StartYear);\n            Assert.AreEqual(63, commentTestClass.Values.Count);\n        }\n\n        [Test]\n        public void PopulationBehaviourForOmittedPropertiesIsTheSameForParameterisedConstructorAsForDefaultConstructor()\n        {\n            string json = @\"{A:\"\"Test\"\"}\";\n\n            var withoutParameterisedConstructor = JsonConvert.DeserializeObject<DTOWithoutParameterisedConstructor>(json);\n            var withParameterisedConstructor = JsonConvert.DeserializeObject<DTOWithParameterisedConstructor>(json);\n            Assert.AreEqual(withoutParameterisedConstructor.B, withParameterisedConstructor.B);\n        }\n\n        [Test]\n        public void SkipPopulatingArrayPropertyClass()\n        {\n            string json = JsonConvert.SerializeObject(new EnumerableArrayPropertyClass());\n            JsonConvert.DeserializeObject<EnumerableArrayPropertyClass>(json);\n        }\n\n#if !(NET20)\n        [Test]\n        public void ChildDataContractTest()\n        {\n            ChildDataContract cc = new ChildDataContract\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc, Formatting.Indented);\n            //      Assert.AreEqual(@\"{\n            //  \"\"VirtualMember\"\": \"\"VirtualMember!\"\",\n            //  \"\"NewMember\"\": null,\n            //  \"\"nonVirtualMember\"\": \"\"NonVirtualMember!\"\"\n            //}\", result);\n\n            StringAssert.AreEqual(@\"{\n  \"\"virtualMember\"\": \"\"VirtualMember!\"\",\n  \"\"nonVirtualMember\"\": \"\"NonVirtualMember!\"\"\n}\", result);\n        }\n\n        [Test]\n        public void ChildDataContractTestWithDataContractSerializer()\n        {\n            ChildDataContract cc = new ChildDataContract\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            DataContractSerializer serializer = new DataContractSerializer(typeof(ChildDataContract));\n\n            MemoryStream ms = new MemoryStream();\n            serializer.WriteObject(ms, cc);\n\n            string xml = Encoding.UTF8.GetString(ms.ToArray(), 0, Convert.ToInt32(ms.Length));\n\n            Assert.AreEqual(@\"<ChildDataContract xmlns=\"\"http://schemas.datacontract.org/2004/07/Newtonsoft.Json.Tests.TestObjects\"\" xmlns:i=\"\"http://www.w3.org/2001/XMLSchema-instance\"\"><nonVirtualMember>NonVirtualMember!</nonVirtualMember><virtualMember>VirtualMember!</virtualMember><NewMember i:nil=\"\"true\"\"/></ChildDataContract>\", xml);\n        }\n#endif\n\n        [Test]\n        public void ChildObjectTest()\n        {\n            VirtualOverrideNewChildObject cc = new VirtualOverrideNewChildObject\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"virtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void ChildWithDifferentOverrideObjectTest()\n        {\n            VirtualOverrideNewChildWithDifferentOverrideObject cc = new VirtualOverrideNewChildWithDifferentOverrideObject\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"differentVirtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void ImplementInterfaceObjectTest()\n        {\n            ImplementInterfaceObject cc = new ImplementInterfaceObject\n            {\n                InterfaceMember = new DateTime(2010, 12, 31, 0, 0, 0, DateTimeKind.Utc),\n                NewMember = \"NewMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"virtualMember\"\": \"\"2010-12-31T00:00:00Z\"\",\n  \"\"newMemberWithProperty\"\": null\n}\", result);\n        }\n\n        [Test]\n        public void NonDefaultConstructorWithReadOnlyCollectionPropertyTest()\n        {\n            NonDefaultConstructorWithReadOnlyCollectionProperty c1 = new NonDefaultConstructorWithReadOnlyCollectionProperty(\"blah\");\n            c1.Categories.Add(\"one\");\n            c1.Categories.Add(\"two\");\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Title\"\": \"\"blah\"\",\n  \"\"Categories\"\": [\n    \"\"one\"\",\n    \"\"two\"\"\n  ]\n}\", json);\n\n            NonDefaultConstructorWithReadOnlyCollectionProperty c2 = JsonConvert.DeserializeObject<NonDefaultConstructorWithReadOnlyCollectionProperty>(json);\n            Assert.AreEqual(c1.Title, c2.Title);\n            Assert.AreEqual(c1.Categories.Count, c2.Categories.Count);\n            Assert.AreEqual(\"one\", c2.Categories[0]);\n            Assert.AreEqual(\"two\", c2.Categories[1]);\n        }\n\n        [Test]\n        public void NonDefaultConstructorWithReadOnlyDictionaryPropertyTest()\n        {\n            NonDefaultConstructorWithReadOnlyDictionaryProperty c1 = new NonDefaultConstructorWithReadOnlyDictionaryProperty(\"blah\");\n            c1.Categories.Add(\"one\", 1);\n            c1.Categories.Add(\"two\", 2);\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Title\"\": \"\"blah\"\",\n  \"\"Categories\"\": {\n    \"\"one\"\": 1,\n    \"\"two\"\": 2\n  }\n}\", json);\n\n            NonDefaultConstructorWithReadOnlyDictionaryProperty c2 = JsonConvert.DeserializeObject<NonDefaultConstructorWithReadOnlyDictionaryProperty>(json);\n            Assert.AreEqual(c1.Title, c2.Title);\n            Assert.AreEqual(c1.Categories.Count, c2.Categories.Count);\n            Assert.AreEqual(1, c2.Categories[\"one\"]);\n            Assert.AreEqual(2, c2.Categories[\"two\"]);\n        }\n\n        [Test]\n        public void ClassAttributesInheritance()\n        {\n            string json = JsonConvert.SerializeObject(new ClassAttributeDerived\n            {\n                BaseClassValue = \"BaseClassValue!\",\n                DerivedClassValue = \"DerivedClassValue!\",\n                NonSerialized = \"NonSerialized!\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DerivedClassValue\"\": \"\"DerivedClassValue!\"\",\n  \"\"BaseClassValue\"\": \"\"BaseClassValue!\"\"\n}\", json);\n\n            json = JsonConvert.SerializeObject(new CollectionClassAttributeDerived\n            {\n                BaseClassValue = \"BaseClassValue!\",\n                CollectionDerivedClassValue = \"CollectionDerivedClassValue!\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"CollectionDerivedClassValue\"\": \"\"CollectionDerivedClassValue!\"\",\n  \"\"BaseClassValue\"\": \"\"BaseClassValue!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void PrivateMembersClassWithAttributesTest()\n        {\n            PrivateMembersClassWithAttributes c1 = new PrivateMembersClassWithAttributes(\"privateString!\", \"internalString!\", \"readonlyString!\");\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"_privateString\"\": \"\"privateString!\"\",\n  \"\"_readonlyString\"\": \"\"readonlyString!\"\",\n  \"\"_internalString\"\": \"\"internalString!\"\"\n}\", json);\n\n            PrivateMembersClassWithAttributes c2 = JsonConvert.DeserializeObject<PrivateMembersClassWithAttributes>(json);\n            Assert.AreEqual(\"readonlyString!\", c2.UseValue());\n        }\n\n        [Test]\n        public void DeserializeGenericEnumerableProperty()\n        {\n            BusRun r = JsonConvert.DeserializeObject<BusRun>(\"{\\\"Departures\\\":[\\\"\\\\/Date(1309874148734-0400)\\\\/\\\",\\\"\\\\/Date(1309874148739-0400)\\\\/\\\",null],\\\"WheelchairAccessible\\\":true}\");\n\n            Assert.AreEqual(typeof(List<DateTime?>), r.Departures.GetType());\n            Assert.AreEqual(3, r.Departures.Count());\n            Assert.IsNotNull(r.Departures.ElementAt(0));\n            Assert.IsNotNull(r.Departures.ElementAt(1));\n            Assert.IsNull(r.Departures.ElementAt(2));\n        }\n\n#if !(NET20)\n        [Test]\n        public void JsonPropertyDataMemberOrder()\n        {\n            DerivedType d = new DerivedType();\n            string json = JsonConvert.SerializeObject(d, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"dinosaur\"\": null,\n  \"\"dog\"\": null,\n  \"\"cat\"\": null,\n  \"\"zebra\"\": null,\n  \"\"bird\"\": null,\n  \"\"parrot\"\": null,\n  \"\"albatross\"\": null,\n  \"\"antelope\"\": null\n}\", json);\n        }\n#endif\n\n        public class CustomClass\n        {\n#if !(NET20 || PORTABLE)\n            [Required]\n#endif\n            public System.Guid? clientId { get; set; }\n        }\n\n        [Test]\n        public void DeserializeStringIntoNullableGuid()\n        {\n            string json = @\"{ 'clientId': 'bb2f3da7-bf79-4d14-9d54-0a1f7ff5f902' }\";\n\n            CustomClass c = JsonConvert.DeserializeObject<CustomClass>(json);\n\n            Assert.AreEqual(new Guid(\"bb2f3da7-bf79-4d14-9d54-0a1f7ff5f902\"), c.clientId);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD2_0\n        [Test]\n        public void SerializeException1()\n        {\n            ClassWithException classWithException = new ClassWithException();\n            try\n            {\n                throw new Exception(\"Test Exception\");\n            }\n            catch (Exception ex)\n            {\n                classWithException.Exceptions.Add(ex);\n            }\n            string sex = JsonConvert.SerializeObject(classWithException);\n            ClassWithException dex = JsonConvert.DeserializeObject<ClassWithException>(sex);\n            Assert.AreEqual(dex.Exceptions[0].ToString(), dex.Exceptions[0].ToString());\n\n            sex = JsonConvert.SerializeObject(classWithException, Formatting.Indented);\n\n            dex = JsonConvert.DeserializeObject<ClassWithException>(sex); // this fails!\n            Assert.AreEqual(dex.Exceptions[0].ToString(), dex.Exceptions[0].ToString());\n        }\n#endif\n\n        [Test]\n        public void UriGuidTimeSpanTestClassEmptyTest()\n        {\n            UriGuidTimeSpanTestClass c1 = new UriGuidTimeSpanTestClass();\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Guid\"\": \"\"00000000-0000-0000-0000-000000000000\"\",\n  \"\"NullableGuid\"\": null,\n  \"\"TimeSpan\"\": \"\"00:00:00\"\",\n  \"\"NullableTimeSpan\"\": null,\n  \"\"Uri\"\": null\n}\", json);\n\n            UriGuidTimeSpanTestClass c2 = JsonConvert.DeserializeObject<UriGuidTimeSpanTestClass>(json);\n            Assert.AreEqual(c1.Guid, c2.Guid);\n            Assert.AreEqual(c1.NullableGuid, c2.NullableGuid);\n            Assert.AreEqual(c1.TimeSpan, c2.TimeSpan);\n            Assert.AreEqual(c1.NullableTimeSpan, c2.NullableTimeSpan);\n            Assert.AreEqual(c1.Uri, c2.Uri);\n        }\n\n        [Test]\n        public void UriGuidTimeSpanTestClassValuesTest()\n        {\n            UriGuidTimeSpanTestClass c1 = new UriGuidTimeSpanTestClass\n            {\n                Guid = new Guid(\"1924129C-F7E0-40F3-9607-9939C531395A\"),\n                NullableGuid = new Guid(\"9E9F3ADF-E017-4F72-91E0-617EBE85967D\"),\n                TimeSpan = TimeSpan.FromDays(1),\n                NullableTimeSpan = TimeSpan.FromHours(1),\n                Uri = new Uri(\"http://testuri.com\")\n            };\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Guid\"\": \"\"1924129c-f7e0-40f3-9607-9939c531395a\"\",\n  \"\"NullableGuid\"\": \"\"9e9f3adf-e017-4f72-91e0-617ebe85967d\"\",\n  \"\"TimeSpan\"\": \"\"1.00:00:00\"\",\n  \"\"NullableTimeSpan\"\": \"\"01:00:00\"\",\n  \"\"Uri\"\": \"\"http://testuri.com\"\"\n}\", json);\n\n            UriGuidTimeSpanTestClass c2 = JsonConvert.DeserializeObject<UriGuidTimeSpanTestClass>(json);\n            Assert.AreEqual(c1.Guid, c2.Guid);\n            Assert.AreEqual(c1.NullableGuid, c2.NullableGuid);\n            Assert.AreEqual(c1.TimeSpan, c2.TimeSpan);\n            Assert.AreEqual(c1.NullableTimeSpan, c2.NullableTimeSpan);\n            Assert.AreEqual(c1.Uri, c2.Uri);\n        }\n\n        [Test]\n        public void UsingJsonTextWriter()\n        {\n            // The property of the object has to be a number for the cast exception to occure\n            object o = new { p = 1 };\n\n            var json = JObject.FromObject(o);\n\n            using (var sw = new StringWriter())\n            using (var jw = new JsonTextWriter(sw))\n            {\n                jw.WriteToken(json.CreateReader());\n                jw.Flush();\n\n                string result = sw.ToString();\n                Assert.AreEqual(@\"{\"\"p\"\":1}\", result);\n            }\n        }\n\n        [Test]\n        public void SerializeUriWithQuotes()\n        {\n            string input = \"http://test.com/%22foo+bar%22\";\n            Uri uri = new Uri(input);\n            string json = JsonConvert.SerializeObject(uri);\n            Uri output = JsonConvert.DeserializeObject<Uri>(json);\n\n            Assert.AreEqual(uri, output);\n        }\n\n        [Test]\n        public void SerializeUriWithSlashes()\n        {\n            string input = @\"http://tes/?a=b\\\\c&d=e\\\";\n            Uri uri = new Uri(input);\n            string json = JsonConvert.SerializeObject(uri);\n            Uri output = JsonConvert.DeserializeObject<Uri>(json);\n\n            Assert.AreEqual(uri, output);\n        }\n\n        [Test]\n        public void DeserializeByteArrayWithTypeNameHandling()\n        {\n            TestObject test = new TestObject(\"Test\", new byte[] { 72, 63, 62, 71, 92, 55 });\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.TypeNameHandling = TypeNameHandling.All;\n\n            byte[] objectBytes;\n            using (MemoryStream stream = new MemoryStream())\n            using (JsonWriter jsonWriter = new JsonTextWriter(new StreamWriter(stream)))\n            {\n                serializer.Serialize(jsonWriter, test);\n                jsonWriter.Flush();\n\n                objectBytes = stream.ToArray();\n            }\n\n            using (MemoryStream stream = new MemoryStream(objectBytes))\n            using (JsonReader jsonReader = new JsonTextReader(new StreamReader(stream)))\n            {\n                // Get exception here\n                TestObject newObject = (TestObject)serializer.Deserialize(jsonReader);\n\n                Assert.AreEqual(\"Test\", newObject.Name);\n                CollectionAssert.AreEquivalent(new byte[] { 72, 63, 62, 71, 92, 55 }, newObject.Data);\n            }\n        }\n\n        [Test]\n        public void SerializeStaticDefault()\n        {\n            DefaultContractResolver contractResolver = new DefaultContractResolver();\n\n            StaticTestClass c = new StaticTestClass\n            {\n                x = int.MaxValue\n            };\n            StaticTestClass.y = 2;\n            StaticTestClass.z = 3;\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"x\"\": 2147483647,\n  \"\"y\"\": 2,\n  \"\"z\"\": 3\n}\", json);\n\n            StaticTestClass c2 = JsonConvert.DeserializeObject<StaticTestClass>(@\"{\n  \"\"x\"\": -1,\n  \"\"y\"\": -2,\n  \"\"z\"\": -3\n}\",\n                new JsonSerializerSettings\n                {\n                    ContractResolver = contractResolver\n                });\n\n            Assert.AreEqual(-1, c2.x);\n            Assert.AreEqual(-2, StaticTestClass.y);\n            Assert.AreEqual(-3, StaticTestClass.z);\n        }\n\n        [Test]\n        public void SerializeStaticReflection()\n        {\n            ReflectionContractResolver contractResolver = new ReflectionContractResolver();\n\n            StaticTestClass c = new StaticTestClass\n            {\n                x = int.MaxValue\n            };\n            StaticTestClass.y = 2;\n            StaticTestClass.z = 3;\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"x\"\": 2147483647,\n  \"\"y\"\": 2,\n  \"\"z\"\": 3\n}\", json);\n\n            StaticTestClass c2 = JsonConvert.DeserializeObject<StaticTestClass>(@\"{\n  \"\"x\"\": -1,\n  \"\"y\"\": -2,\n  \"\"z\"\": -3\n}\",\n                new JsonSerializerSettings\n                {\n                    ContractResolver = contractResolver\n                });\n\n            Assert.AreEqual(-1, c2.x);\n            Assert.AreEqual(-2, StaticTestClass.y);\n            Assert.AreEqual(-3, StaticTestClass.z);\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeDecimalsWithCulture()\n        {\n            CultureInfo initialCulture = Thread.CurrentThread.CurrentCulture;\n\n            try\n            {\n                CultureInfo testCulture = CultureInfo.CreateSpecificCulture(\"nb-NO\");\n\n                Thread.CurrentThread.CurrentCulture = testCulture;\n                Thread.CurrentThread.CurrentUICulture = testCulture;\n\n                string json = @\"{ 'Quantity': '1.5', 'OptionalQuantity': '2.2' }\";\n\n                DecimalTestClass c = JsonConvert.DeserializeObject<DecimalTestClass>(json);\n\n                Assert.AreEqual(1.5m, c.Quantity);\n                Assert.AreEqual(2.2d, c.OptionalQuantity);\n            }\n            finally\n            {\n                Thread.CurrentThread.CurrentCulture = initialCulture;\n                Thread.CurrentThread.CurrentUICulture = initialCulture;\n            }\n        }\n#endif\n\n        [Test]\n        public void ReadForTypeHackFixDecimal()\n        {\n            IList<decimal> d1 = new List<decimal> { 1.1m };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<decimal> d2 = JsonConvert.DeserializeObject<IList<decimal>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void ReadForTypeHackFixDateTimeOffset()\n        {\n            IList<DateTimeOffset?> d1 = new List<DateTimeOffset?> { null };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<DateTimeOffset?> d2 = JsonConvert.DeserializeObject<IList<DateTimeOffset?>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void ReadForTypeHackFixByteArray()\n        {\n            IList<byte[]> d1 = new List<byte[]> { null };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<byte[]> d2 = JsonConvert.DeserializeObject<IList<byte[]>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void SerializeInheritanceHierarchyWithDuplicateProperty()\n        {\n            Bb b = new Bb();\n            b.no = true;\n            Aa a = b;\n            a.no = int.MaxValue;\n\n            string json = JsonConvert.SerializeObject(b);\n\n            Assert.AreEqual(@\"{\"\"no\"\":true}\", json);\n\n            Bb b2 = JsonConvert.DeserializeObject<Bb>(json);\n\n            Assert.AreEqual(true, b2.no);\n        }\n\n        [Test]\n        public void DeserializeNullInt()\n        {\n            string json = @\"[\n  1,\n  2,\n  3,\n  null\n]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                List<int> numbers = JsonConvert.DeserializeObject<List<int>>(json);\n            }, \"Error converting value {null} to type 'System.Int32'. Path '[3]', line 5, position 6.\");\n        }\n\n#if !(PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeIConvertible()\n        {\n            ConvertableIntTestClass c = new ConvertableIntTestClass\n            {\n                Integer = new ConvertibleInt(1),\n                NullableInteger1 = new ConvertibleInt(2),\n                NullableInteger2 = null\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Integer\"\": 1,\n  \"\"NullableInteger1\"\": 2,\n  \"\"NullableInteger2\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeIConvertible()\n        {\n            string json = @\"{\n  \"\"Integer\"\": 1,\n  \"\"NullableInteger1\"\": 2,\n  \"\"NullableInteger2\"\": null\n}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<ConvertableIntTestClass>(json), \"Error converting value 1 to type 'Newtonsoft.Json.Tests.TestObjects.ConvertibleInt'. Path 'Integer', line 2, position 14.\");\n        }\n#endif\n\n        [Test]\n        public void SerializeNullableWidgetStruct()\n        {\n            Widget widget = new Widget { Id = new WidgetId { Value = \"id\" } };\n\n            string json = JsonConvert.SerializeObject(widget);\n\n            Assert.AreEqual(@\"{\"\"Id\"\":{\"\"Value\"\":\"\"id\"\"}}\", json);\n        }\n\n        [Test]\n        public void DeserializeNullableWidgetStruct()\n        {\n            string json = @\"{\"\"Id\"\":{\"\"Value\"\":\"\"id\"\"}}\";\n\n            Widget w = JsonConvert.DeserializeObject<Widget>(json);\n\n            Assert.AreEqual(new WidgetId { Value = \"id\" }, w.Id);\n            Assert.AreEqual(new WidgetId { Value = \"id\" }, w.Id.Value);\n            Assert.AreEqual(\"id\", w.Id.Value.Value);\n        }\n\n        [Test]\n        public void DeserializeBoolInt()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(() =>\n            {\n                string json = @\"{\n  \"\"PreProperty\"\": true,\n  \"\"PostProperty\"\": \"\"-1\"\"\n}\";\n\n                JsonConvert.DeserializeObject<TestObjects.MyClass>(json);\n            }, \"Unexpected character encountered while parsing value: t. Path 'PreProperty', line 2, position 18.\");\n        }\n\n        [Test]\n        public void DeserializeUnexpectedEndInt()\n        {\n            ExceptionAssert.Throws<JsonException>(() =>\n            {\n                string json = @\"{\n  \"\"PreProperty\"\": \";\n\n                JsonConvert.DeserializeObject<TestObjects.MyClass>(json);\n            });\n        }\n\n        [Test]\n        public void DeserializeNullableGuid()\n        {\n            string json = @\"{\"\"Id\"\":null}\";\n            var c = JsonConvert.DeserializeObject<NullableGuid>(json);\n\n            Assert.AreEqual(null, c.Id);\n\n            json = @\"{\"\"Id\"\":\"\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"\"}\";\n            c = JsonConvert.DeserializeObject<NullableGuid>(json);\n\n            Assert.AreEqual(new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"), c.Id);\n        }\n\n        [Test]\n        public void SerializeNullableGuidCustomWriterOverridesNullableGuid()\n        {\n            NullableGuid ng = new NullableGuid {Id = Guid.Empty};\n            NullableGuidCountingJsonTextWriter writer = new NullableGuidCountingJsonTextWriter(new StreamWriter(Stream.Null));\n            JsonSerializer serializer = JsonSerializer.Create();\n            serializer.Serialize(writer, ng);\n            Assert.AreEqual(1, writer.NullableGuidCount);\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializer.TraceWriter = traceWriter;\n            serializer.Serialize(writer, ng);\n            Assert.AreEqual(2, writer.NullableGuidCount);\n        }\n\n        [Test]\n        public void DeserializeGuid()\n        {\n            Item expected = new Item()\n            {\n                SourceTypeID = new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"),\n                BrokerID = new Guid(\"951663c4-924e-4c86-a57a-7ed737501dbd\"),\n                Latitude = 33.657145,\n                Longitude = -117.766684,\n                TimeStamp = new DateTime(2000, 3, 1, 23, 59, 59, DateTimeKind.Utc),\n                Payload = new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }\n            };\n\n            string jsonString = JsonConvert.SerializeObject(expected, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"SourceTypeID\"\": \"\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"\",\n  \"\"BrokerID\"\": \"\"951663c4-924e-4c86-a57a-7ed737501dbd\"\",\n  \"\"Latitude\"\": 33.657145,\n  \"\"Longitude\"\": -117.766684,\n  \"\"TimeStamp\"\": \"\"2000-03-01T23:59:59Z\"\",\n  \"\"Payload\"\": {\n    \"\"$type\"\": \"\"\" + ReflectionUtils.GetTypeName(typeof(byte[]), 0, DefaultSerializationBinder.Instance) + @\"\"\",\n    \"\"$value\"\": \"\"AAECAwQFBgcICQ==\"\"\n  }\n}\", jsonString);\n\n            Item actual = JsonConvert.DeserializeObject<Item>(jsonString);\n\n            Assert.AreEqual(new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"), actual.SourceTypeID);\n            Assert.AreEqual(new Guid(\"951663c4-924e-4c86-a57a-7ed737501dbd\"), actual.BrokerID);\n            byte[] bytes = (byte[])actual.Payload;\n            CollectionAssert.AreEquivalent((new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }).ToList(), bytes.ToList());\n        }\n\n        [Test]\n        public void DeserializeObjectDictionary()\n        {\n            var serializer = JsonSerializer.Create(new JsonSerializerSettings());\n            var dict = serializer.Deserialize<Dictionary<string, string>>(new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\")));\n\n            Assert.AreEqual(\"\", dict[\"k1\"]);\n            Assert.AreEqual(\"v2\", dict[\"k2\"]);\n        }\n\n        [Test]\n        public void DeserializeNullableEnum()\n        {\n            string json = JsonConvert.SerializeObject(new WithEnums\n            {\n                Id = 7,\n                NullableEnum = null\n            });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":7,\"\"NullableEnum\"\":null}\", json);\n\n            WithEnums e = JsonConvert.DeserializeObject<WithEnums>(json);\n\n            Assert.AreEqual(null, e.NullableEnum);\n\n            json = JsonConvert.SerializeObject(new WithEnums\n            {\n                Id = 7,\n                NullableEnum = MyEnum.Value2\n            });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":7,\"\"NullableEnum\"\":1}\", json);\n\n            e = JsonConvert.DeserializeObject<WithEnums>(json);\n\n            Assert.AreEqual(MyEnum.Value2, e.NullableEnum);\n        }\n\n        [Test]\n        public void NullableStructWithConverter()\n        {\n            string json = JsonConvert.SerializeObject(new Widget1 { Id = new WidgetId1 { Value = 1234 } });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":\"\"1234\"\"}\", json);\n\n            Widget1 w = JsonConvert.DeserializeObject<Widget1>(@\"{\"\"Id\"\":\"\"1234\"\"}\");\n\n            Assert.AreEqual(new WidgetId1 { Value = 1234 }, w.Id);\n        }\n\n        [Test]\n        public void SerializeDictionaryStringStringAndStringObject()\n        {\n            var serializer = JsonSerializer.Create(new JsonSerializerSettings());\n            var dict = serializer.Deserialize<Dictionary<string, string>>(new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\")));\n\n            var reader = new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\"));\n            var dict2 = serializer.Deserialize<Dictionary<string, object>>(reader);\n\n            Assert.AreEqual(dict[\"k1\"], dict2[\"k1\"]);\n        }\n\n        [Test]\n        public void DeserializeEmptyStrings()\n        {\n            object v = JsonConvert.DeserializeObject<double?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<char?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<int?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<decimal?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<DateTime?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<DateTimeOffset?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<byte[]>(\"\");\n            Assert.IsNull(v);\n        }\n\n        [Test]\n        public void DeserializeDoubleFromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<double>(\"\"); }, \"No JSON content found and type 'System.Double' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeEnumFromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<StringComparison>(\"\"); }, \"No JSON content found and type 'System.StringComparison' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeInt32FromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<int>(\"\"); }, \"No JSON content found and type 'System.Int32' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeByteArrayFromEmptyString()\n        {\n            byte[] b = JsonConvert.DeserializeObject<byte[]>(\"\");\n            Assert.IsNull(b);\n        }\n\n        [Test]\n        public void DeserializeDoubleFromNullString()\n        {\n            ExceptionAssert.Throws<ArgumentNullException>(\n                () => { JsonConvert.DeserializeObject<double>(null); },\n                new[]\n                {\n                    \"Value cannot be null.\" + Environment.NewLine + \"Parameter name: value\",\n                    \"Argument cannot be null.\" + Environment.NewLine + \"Parameter name: value\", // mono\n                    \"Value cannot be null. (Parameter 'value')\"\n                });\n        }\n\n        [Test]\n        public void DeserializeFromNullString()\n        {\n            ExceptionAssert.Throws<ArgumentNullException>(\n                () => { JsonConvert.DeserializeObject(null); },\n                new[]\n                {\n                    \"Value cannot be null.\" + Environment.NewLine + \"Parameter name: value\",\n                    \"Argument cannot be null.\" + Environment.NewLine + \"Parameter name: value\", // mono\n                    \"Value cannot be null. (Parameter 'value')\"\n                });\n        }\n\n        [Test]\n        public void DeserializeIsoDatesWithIsoConverter()\n        {\n            string jsonIsoText =\n                @\"{\"\"Value\"\":\"\"2012-02-25T19:55:50.6095676+13:00\"\"}\";\n\n            DateTimeWrapper c = JsonConvert.DeserializeObject<DateTimeWrapper>(jsonIsoText, new IsoDateTimeConverter());\n            Assert.AreEqual(DateTimeKind.Local, c.Value.Kind);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeUTC()\n        {\n            DateTimeTestClass c =\n                JsonConvert.DeserializeObject<DateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 12, 12, 12, 12, 12, 0, DateTimeKind.Utc).ToLocalTime(), c.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 12, 12, 12, 12, 12, 0, TimeSpan.Zero), c.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c.PreField);\n            Assert.AreEqual(\"Post\", c.PostField);\n\n            DateTimeTestClass c2 =\n                JsonConvert.DeserializeObject<DateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-01-01T01:01:01Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-01-01T01:01:01Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 1, 1, 1, 1, 1, 0, DateTimeKind.Utc).ToLocalTime(), c2.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 1, 1, 1, 1, 1, 0, TimeSpan.Zero), c2.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c2.PreField);\n            Assert.AreEqual(\"Post\", c2.PostField);\n        }\n\n        [Test]\n        public void NullableDeserializeUTC()\n        {\n            NullableDateTimeTestClass c =\n                JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 12, 12, 12, 12, 12, 0, DateTimeKind.Utc).ToLocalTime(), c.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 12, 12, 12, 12, 12, 0, TimeSpan.Zero), c.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c.PreField);\n            Assert.AreEqual(\"Post\", c.PostField);\n\n            NullableDateTimeTestClass c2 =\n                JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":null,\"\"DateTimeOffsetField\"\":null,\"\"PostField\"\":\"\"Post\"\"}\");\n\n            Assert.AreEqual(null, c2.DateTimeField);\n            Assert.AreEqual(null, c2.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c2.PreField);\n            Assert.AreEqual(\"Post\", c2.PostField);\n        }\n\n        [Test]\n        public void PrivateConstructor()\n        {\n            var person = PersonWithPrivateConstructor.CreatePerson();\n            person.Name = \"John Doe\";\n            person.Age = 25;\n\n            var serializedPerson = JsonConvert.SerializeObject(person);\n            var roundtrippedPerson = JsonConvert.DeserializeObject<PersonWithPrivateConstructor>(serializedPerson);\n\n            Assert.AreEqual(person.Name, roundtrippedPerson.Name);\n        }\n#endif\n\n#if !(DNXCORE50)\n        [Test]\n        public void MetroBlogPost()\n        {\n            Product product = new Product()\n            {\n                Name = \"Apple\",\n                ExpiryDate = new DateTime(2012, 4, 1),\n                Price = 3.99M,\n                Sizes = new[] { \"Small\", \"Medium\", \"Large\" }\n            };\n\n            string json = JsonConvert.SerializeObject(product);\n            //{\n            //  \"Name\": \"Apple\",\n            //  \"ExpiryDate\": \"2012-04-01T00:00:00\",\n            //  \"Price\": 3.99,\n            //  \"Sizes\": [ \"Small\", \"Medium\", \"Large\" ]\n            //}\n\n            string metroJson = JsonConvert.SerializeObject(product, new JsonSerializerSettings\n            {\n                ContractResolver = new MetroPropertyNameResolver(),\n                Converters = { new MetroStringConverter() },\n                Formatting = Formatting.Indented\n            });\n            StringAssert.AreEqual(@\"{\n  \"\":::NAME:::\"\": \"\":::APPLE:::\"\",\n  \"\":::EXPIRYDATE:::\"\": \"\"2012-04-01T00:00:00\"\",\n  \"\":::PRICE:::\"\": 3.99,\n  \"\":::SIZES:::\"\": [\n    \"\":::SMALL:::\"\",\n    \"\":::MEDIUM:::\"\",\n    \"\":::LARGE:::\"\"\n  ]\n}\", metroJson);\n            //{\n            //  \":::NAME:::\": \":::APPLE:::\",\n            //  \":::EXPIRYDATE:::\": \"2012-04-01T00:00:00\",\n            //  \":::PRICE:::\": 3.99,\n            //  \":::SIZES:::\": [ \":::SMALL:::\", \":::MEDIUM:::\", \":::LARGE:::\" ]\n            //}\n\n            Color[] colors = new[] { Color.Blue, Color.Red, Color.Yellow, Color.Green, Color.Black, Color.Brown };\n\n            string json2 = JsonConvert.SerializeObject(colors, new JsonSerializerSettings\n            {\n                ContractResolver = new MetroPropertyNameResolver(),\n                Converters = { new MetroStringConverter(), new MetroColorConverter() },\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::BLACK:::\"\",\n  \"\":::GRAY:::\"\"\n]\", json2);\n        }\n#endif\n\n        [Test]\n        public void MultipleItems()\n        {\n            IList<MultipleItemsClass> values = new List<MultipleItemsClass>();\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(@\"{ \"\"name\"\": \"\"bar\"\" }{ \"\"name\"\": \"\"baz\"\" }\"));\n            reader.SupportMultipleContent = true;\n\n            while (true)\n            {\n                if (!reader.Read())\n                {\n                    break;\n                }\n\n                JsonSerializer serializer = new JsonSerializer();\n                MultipleItemsClass foo = serializer.Deserialize<MultipleItemsClass>(reader);\n\n                values.Add(foo);\n            }\n\n            Assert.AreEqual(2, values.Count);\n            Assert.AreEqual(\"bar\", values[0].Name);\n            Assert.AreEqual(\"baz\", values[1].Name);\n        }\n\n#pragma warning disable 618\n        [Test]\n        public void TokenFromBson()\n        {\n            MemoryStream ms = new MemoryStream();\n            BsonWriter writer = new BsonWriter(ms);\n            writer.WriteStartArray();\n            writer.WriteValue(\"2000-01-02T03:04:05+06:00\");\n            writer.WriteEndArray();\n\n            byte[] data = ms.ToArray();\n            BsonReader reader = new BsonReader(new MemoryStream(data))\n            {\n                ReadRootValueAsArray = true\n            };\n\n            JArray a = (JArray)JArray.ReadFrom(reader);\n            JValue v = (JValue)a[0];\n\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            StringAssert.AreEqual(@\"[\n  \"\"2000-01-02T03:04:05+06:00\"\"\n]\", a.ToString());\n        }\n#pragma warning restore 618\n\n        [Test]\n        public void ObjectRequiredDeserializeMissing()\n        {\n            string json = \"{}\";\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            var o = JsonConvert.DeserializeObject<RequiredObject>(json, new JsonSerializerSettings\n            {\n                Error = error\n            });\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(4, errors.Count);\n            Assert.IsTrue(errors[0].StartsWith(\"Required property 'NonAttributeProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[1].StartsWith(\"Required property 'UnsetProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[2].StartsWith(\"Required property 'AllowNullProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[3].StartsWith(\"Required property 'AlwaysProperty' not found in JSON. Path ''\"));\n        }\n\n        [Test]\n        public void ObjectRequiredDeserializeNull()\n        {\n            string json = \"{'NonAttributeProperty':null,'UnsetProperty':null,'AllowNullProperty':null,'AlwaysProperty':null}\";\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            var o = JsonConvert.DeserializeObject<RequiredObject>(json, new JsonSerializerSettings\n            {\n                Error = error\n            });\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(3, errors.Count);\n            Assert.IsTrue(errors[0].StartsWith(\"Required property 'NonAttributeProperty' expects a value but got null. Path ''\"));\n            Assert.IsTrue(errors[1].StartsWith(\"Required property 'UnsetProperty' expects a value but got null. Path ''\"));\n            Assert.IsTrue(errors[2].StartsWith(\"Required property 'AlwaysProperty' expects a value but got null. Path ''\"));\n        }\n\n        [Test]\n        public void ObjectRequiredSerialize()\n        {\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            string json = JsonConvert.SerializeObject(new RequiredObject(), new JsonSerializerSettings\n            {\n                Error = error,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultProperty\"\": null,\n  \"\"AllowNullProperty\"\": null\n}\", json);\n\n            Assert.AreEqual(3, errors.Count);\n            Assert.AreEqual(\"Cannot write a null value for property 'NonAttributeProperty'. Property requires a value. Path ''.\", errors[0]);\n            Assert.AreEqual(\"Cannot write a null value for property 'UnsetProperty'. Property requires a value. Path ''.\", errors[1]);\n            Assert.AreEqual(\"Cannot write a null value for property 'AlwaysProperty'. Property requires a value. Path ''.\", errors[2]);\n        }\n\n        [Test]\n        public void DeserializeCollectionItemConverter()\n        {\n            PropertyItemConverter c = new PropertyItemConverter\n            {\n                Data =\n                    new[]\n                    {\n                        \"one\",\n                        \"two\",\n                        \"three\"\n                    }\n            };\n\n            var c2 = JsonConvert.DeserializeObject<PropertyItemConverter>(\"{'Data':['::ONE::','::TWO::']}\");\n\n            Assert.IsNotNull(c2);\n            Assert.AreEqual(2, c2.Data.Count);\n            Assert.AreEqual(\"one\", c2.Data[0]);\n            Assert.AreEqual(\"two\", c2.Data[1]);\n        }\n\n        [Test]\n        public void SerializeCollectionItemConverter()\n        {\n            PropertyItemConverter c = new PropertyItemConverter\n            {\n                Data = new[]\n                {\n                    \"one\",\n                    \"two\",\n                    \"three\"\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(@\"{\"\"Data\"\":[\"\":::ONE:::\"\",\"\":::TWO:::\"\",\"\":::THREE:::\"\"]}\", json);\n        }\n\n#if !NET20\n        [Test]\n        public void DateTimeDictionaryKey_DateTimeOffset_Iso()\n        {\n            IDictionary<DateTimeOffset, int> dic1 = new Dictionary<DateTimeOffset, int>\n            {\n                { new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero), 1 },\n                { new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-12-12T12:12:12+00:00\"\": 1,\n  \"\"2013-12-12T12:12:12+00:00\"\": 2\n}\", json);\n\n            IDictionary<DateTimeOffset, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTimeOffset, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n            Assert.AreEqual(2, dic2[new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTimeOffset_MS()\n        {\n            IDictionary<DateTimeOffset?, int> dic1 = new Dictionary<DateTimeOffset?, int>\n            {\n                { new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero), 1 },\n                { new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"\\/Date(976623132000+0000)\\/\"\": 1,\n  \"\"\\/Date(1386850332000+0000)\\/\"\": 2\n}\", json);\n\n            IDictionary<DateTimeOffset?, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTimeOffset?, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n            Assert.AreEqual(2, dic2[new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n        }\n#endif\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_Iso()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-12-12T12:12:12Z\"\": 1,\n  \"\"2013-12-12T12:12:12Z\"\": 2\n}\", json);\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_Iso_Local()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2020, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2023, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateTimeZoneHandling = DateTimeZoneHandling.Local\n            });\n\n            JObject o = JObject.Parse(json);\n            Assert.IsFalse(o.Properties().ElementAt(0).Name.Contains(\"Z\"));\n            Assert.IsFalse(o.Properties().ElementAt(1).Name.Contains(\"Z\"));\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json, new JsonSerializerSettings\n            {\n                DateTimeZoneHandling = DateTimeZoneHandling.Utc\n            });\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2020, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2023, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_MS()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"\\/Date(976623132000)\\/\"\": 1,\n  \"\"\\/Date(1386850332000)\\/\"\": 2\n}\", json);\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DeserializeEmptyJsonString()\n        {\n            string s = (string)new JsonSerializer().Deserialize(new JsonTextReader(new StringReader(\"''\")));\n            Assert.AreEqual(\"\", s);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeAndDeserializeWithAttributes()\n        {\n            var testObj = new PersonSerializable() { Name = \"John Doe\", Age = 28 };\n\n            var json = Serialize(testObj);\n            var objDeserialized = Deserialize<PersonSerializable>(json);\n\n            Assert.AreEqual(testObj.Name, objDeserialized.Name);\n            Assert.AreEqual(0, objDeserialized.Age);\n        }\n\n        private string Serialize<T>(T obj)\n            where T : class\n        {\n            var stringWriter = new StringWriter();\n            var serializer = new JsonSerializer();\n            serializer.ContractResolver = new DefaultContractResolver\n            {\n                IgnoreSerializableAttribute = false\n            };\n            serializer.Serialize(stringWriter, obj);\n\n            return stringWriter.ToString();\n        }\n\n        private T Deserialize<T>(string json)\n            where T : class\n        {\n            var jsonReader = new JsonTextReader(new StringReader(json));\n            var serializer = new JsonSerializer();\n            serializer.ContractResolver = new DefaultContractResolver\n            {\n                IgnoreSerializableAttribute = false\n            };\n\n            return serializer.Deserialize(jsonReader, typeof(T)) as T;\n        }\n#endif\n\n        [Test]\n        public void PropertyItemConverter()\n        {\n            Event1 e = new Event1\n            {\n                EventName = \"Blackadder III\",\n                Venue = \"Gryphon Theatre\",\n                Performances = new List<DateTime>\n                {\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336458600000),\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336545000000),\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336636800000)\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(e, Formatting.Indented);\n            //{\n            //  \"EventName\": \"Blackadder III\",\n            //  \"Venue\": \"Gryphon Theatre\",\n            //  \"Performances\": [\n            //    new Date(1336458600000),\n            //    new Date(1336545000000),\n            //    new Date(1336636800000)\n            //  ]\n            //}\n\n            StringAssert.AreEqual(@\"{\n  \"\"EventName\"\": \"\"Blackadder III\"\",\n  \"\"Venue\"\": \"\"Gryphon Theatre\"\",\n  \"\"Performances\"\": [\n    new Date(\n      1336458600000\n    ),\n    new Date(\n      1336545000000\n    ),\n    new Date(\n      1336636800000\n    )\n  ]\n}\", json);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void IgnoreDataMemberTest()\n        {\n            string json = JsonConvert.SerializeObject(new IgnoreDataMemberTestClass() { Ignored = int.MaxValue }, Formatting.Indented);\n            Assert.AreEqual(@\"{}\", json);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void SerializeDataContractSerializationAttributes()\n        {\n            DataContractSerializationAttributesClass dataContract = new DataContractSerializationAttributesClass\n            {\n                NoAttribute = \"Value!\",\n                IgnoreDataMemberAttribute = \"Value!\",\n                DataMemberAttribute = \"Value!\",\n                IgnoreDataMemberAndDataMemberAttribute = \"Value!\"\n            };\n\n            //MemoryStream ms = new MemoryStream();\n            //DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(DataContractSerializationAttributesClass));\n            //serializer.WriteObject(ms, dataContract);\n\n            //Console.WriteLine(Encoding.UTF8.GetString(ms.ToArray()));\n\n            string json = JsonConvert.SerializeObject(dataContract, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"DataMemberAttribute\"\": \"\"Value!\"\",\n  \"\"IgnoreDataMemberAndDataMemberAttribute\"\": \"\"Value!\"\"\n}\", json);\n\n            PocoDataContractSerializationAttributesClass poco = new PocoDataContractSerializationAttributesClass\n            {\n                NoAttribute = \"Value!\",\n                IgnoreDataMemberAttribute = \"Value!\",\n                DataMemberAttribute = \"Value!\",\n                IgnoreDataMemberAndDataMemberAttribute = \"Value!\"\n            };\n\n            json = JsonConvert.SerializeObject(poco, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"NoAttribute\"\": \"\"Value!\"\",\n  \"\"DataMemberAttribute\"\": \"\"Value!\"\"\n}\", json);\n        }\n#endif\n\n        [Test]\n        public void CheckAdditionalContent()\n        {\n            string json = \"{one:1}{}\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n\n            settings.CheckAdditionalContent = true;\n            s = JsonSerializer.Create(settings);\n            ExceptionAssert.Throws<JsonReaderException>(() => { s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json))); }, \"Additional text encountered after finished reading JSON content: {. Path '', line 1, position 7.\");\n        }\n\n        [Test]\n        public void CheckAdditionalContentJustComment()\n        {\n            string json = \"{one:1} // This is just a comment\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings {CheckAdditionalContent = true};\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n        }\n\n        [Test]\n        public void CheckAdditionalContentJustMultipleComments()\n        {\n            string json = @\"{one:1} // This is just a comment\n/* This is just a comment\nover multiple\nlines.*/\n\n// This is just another comment.\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings {CheckAdditionalContent = true};\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n        }\n\n        [Test]\n        public void CheckAdditionalContentCommentsThenAnotherObject()\n        {\n            string json = @\"{one:1} // This is just a comment\n/* This is just a comment\nover multiple\nlines.*/\n\n// This is just another comment. But here comes an empty object.\n{}\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings { CheckAdditionalContent = true };\n            JsonSerializer s = JsonSerializer.Create(settings);\n            ExceptionAssert.Throws<JsonReaderException>(() => { s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json))); }, \"Additional text encountered after finished reading JSON content: {. Path '', line 7, position 0.\");\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40)\n        [Test]\n        public void DeserializeException()\n        {\n            string json = @\"{ \"\"ClassName\"\" : \"\"System.InvalidOperationException\"\",\n  \"\"Data\"\" : null,\n  \"\"ExceptionMethod\"\" : \"\"8\\nLogin\\nAppBiz, Version=4.0.0.0, Culture=neutral, PublicKeyToken=null\\nMyApp.LoginBiz\\nMyApp.User Login()\"\",\n  \"\"HResult\"\" : -2146233079,\n  \"\"HelpURL\"\" : null,\n  \"\"InnerException\"\" : { \"\"ClassName\"\" : \"\"System.Exception\"\",\n      \"\"Data\"\" : null,\n      \"\"ExceptionMethod\"\" : null,\n      \"\"HResult\"\" : -2146233088,\n      \"\"HelpURL\"\" : null,\n      \"\"InnerException\"\" : null,\n      \"\"Message\"\" : \"\"Inner exception...\"\",\n      \"\"RemoteStackIndex\"\" : 0,\n      \"\"RemoteStackTraceString\"\" : null,\n      \"\"Source\"\" : null,\n      \"\"StackTraceString\"\" : null,\n      \"\"WatsonBuckets\"\" : null\n    },\n  \"\"Message\"\" : \"\"Outter exception...\"\",\n  \"\"RemoteStackIndex\"\" : 0,\n  \"\"RemoteStackTraceString\"\" : null,\n  \"\"Source\"\" : \"\"AppBiz\"\",\n  \"\"StackTraceString\"\" : \"\" at MyApp.LoginBiz.Login() in C:\\\\MyApp\\\\LoginBiz.cs:line 44\\r\\n at MyApp.LoginSvc.Login() in C:\\\\MyApp\\\\LoginSvc.cs:line 71\\r\\n at SyncInvokeLogin(Object , Object[] , Object[] )\\r\\n at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]& outputs)\\r\\n at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)\"\",\n  \"\"WatsonBuckets\"\" : null\n}\";\n\n            InvalidOperationException exception = JsonConvert.DeserializeObject<InvalidOperationException>(json);\n            Assert.IsNotNull(exception);\n            CustomAssert.IsInstanceOfType(typeof(InvalidOperationException), exception);\n\n            Assert.AreEqual(\"Outter exception...\", exception.Message);\n        }\n#endif\n\n        [Test]\n        public void AdditionalContentAfterFinish()\n        {\n            ExceptionAssert.Throws<JsonException>(() =>\n            {\n                string json = \"[{},1]\";\n\n                JsonSerializer serializer = new JsonSerializer();\n                serializer.CheckAdditionalContent = true;\n\n                var reader = new JsonTextReader(new StringReader(json));\n                reader.Read();\n                reader.Read();\n\n                serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            }, \"Additional text found in JSON string after finishing deserializing object. Path '[1]', line 1, position 5.\");\n        }\n\n        [Test]\n        public void AdditionalContentAfterFinishCheckNotRequested()\n        {\n            string json = @\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} A bunch of junk at the end of the json\";\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            var reader = new JsonTextReader(new StringReader(json));\n\n            ItemConverterTestClass mt = (ItemConverterTestClass)serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            Assert.AreEqual(1, mt.MyProperty.Count);\n        }\n\n        [Test]\n        public void AdditionalContentAfterCommentsCheckNotRequested()\n        {\n            string json = @\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} /*this is a comment */\n// this is also a comment\nThis is just junk, though.\";\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            var reader = new JsonTextReader(new StringReader(json));\n\n            ItemConverterTestClass mt = (ItemConverterTestClass)serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            Assert.AreEqual(1, mt.MyProperty.Count);\n        }\n\n        [Test]\n        public void AdditionalContentAfterComments()\n        {\n            string json = @\"[{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} /*this is a comment */\n// this is also a comment\n,{}\";\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.CheckAdditionalContent = true;\n            var reader = new JsonTextReader(new StringReader(json));\n            reader.Read();\n            reader.Read();\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => serializer.Deserialize(reader, typeof(ItemConverterTestClass)),\n                \"Additional text found in JSON string after finishing deserializing object. Path '[1]', line 3, position 2.\");\n        }\n\n        [Test]\n        public void DeserializeRelativeUri()\n        {\n            IList<Uri> uris = JsonConvert.DeserializeObject<IList<Uri>>(@\"[\"\"http://localhost/path?query#hash\"\"]\");\n            Assert.AreEqual(1, uris.Count);\n            Assert.AreEqual(new Uri(\"http://localhost/path?query#hash\"), uris[0]);\n\n            Uri uri = JsonConvert.DeserializeObject<Uri>(@\"\"\"http://localhost/path?query#hash\"\"\");\n            Assert.IsNotNull(uri);\n\n            Uri i1 = new Uri(\"http://localhost/path?query#hash\", UriKind.RelativeOrAbsolute);\n            Uri i2 = new Uri(\"http://localhost/path?query#hash\");\n            Assert.AreEqual(i1, i2);\n\n            uri = JsonConvert.DeserializeObject<Uri>(@\"\"\"/path?query#hash\"\"\");\n            Assert.IsNotNull(uri);\n            Assert.AreEqual(new Uri(\"/path?query#hash\", UriKind.RelativeOrAbsolute), uri);\n        }\n\n        [Test]\n        public void DeserializeDictionaryItemConverter()\n        {\n            var actual = JsonConvert.DeserializeObject<ItemConverterTestClass>(@\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Y\"\"}}\");\n            Assert.AreEqual(\"X\", actual.MyProperty[\"Key\"]);\n        }\n\n        [Test]\n        public void DeserializeCaseInsensitiveKeyValuePairConverter()\n        {\n            KeyValuePair<int, string> result =\n                JsonConvert.DeserializeObject<KeyValuePair<int, string>>(\n                    \"{key: 123, \\\"VALUE\\\": \\\"test value\\\"}\"\n                );\n\n            Assert.AreEqual(123, result.Key);\n            Assert.AreEqual(\"test value\", result.Value);\n        }\n\n        [Test]\n        public void SerializeKeyValuePairConverterWithCamelCase()\n        {\n            string json =\n                JsonConvert.SerializeObject(new KeyValuePair<int, string>(123, \"test value\"), Formatting.Indented, new JsonSerializerSettings\n                {\n                    ContractResolver = new CamelCasePropertyNamesContractResolver()\n                });\n\n            StringAssert.AreEqual(@\"{\n  \"\"key\"\": 123,\n  \"\"value\"\": \"\"test value\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SerializeFloatingPointHandling()\n        {\n            string json;\n            IList<double> d = new List<double> { 1.1, double.NaN, double.PositiveInfinity };\n\n            json = JsonConvert.SerializeObject(d);\n            // [1.1,\"NaN\",\"Infinity\"]\n\n            json = JsonConvert.SerializeObject(d, new JsonSerializerSettings { FloatFormatHandling = FloatFormatHandling.Symbol });\n            // [1.1,NaN,Infinity]\n\n            json = JsonConvert.SerializeObject(d, new JsonSerializerSettings { FloatFormatHandling = FloatFormatHandling.DefaultValue });\n            // [1.1,0.0,0.0]\n\n            Assert.AreEqual(\"[1.1,0.0,0.0]\", json);\n        }\n\n#if !(NET20 || NET35 || NET40 || PORTABLE40)\n#if !PORTABLE || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeReadOnlyListWithBigInteger()\n        {\n            string json = @\"[\n        9000000000000000000000000000000000000000000000000\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<BigInteger>>(json);\n\n            BigInteger nineQuindecillion = l[0];\n            // 9000000000000000000000000000000000000000000000000\n\n            Assert.AreEqual(BigInteger.Parse(\"9000000000000000000000000000000000000000000000000\"), nineQuindecillion);\n        }\n#endif\n\n        [Test]\n        public void DeserializeReadOnlyListWithInt()\n        {\n            string json = @\"[\n        900\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<int>>(json);\n\n            int i = l[0];\n            // 900\n\n            Assert.AreEqual(900, i);\n        }\n\n        [Test]\n        public void DeserializeReadOnlyListWithNullableType()\n        {\n            string json = @\"[\n        1,\n        null\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<int?>>(json);\n\n            Assert.AreEqual(1, l[0]);\n            Assert.AreEqual(null, l[1]);\n        }\n#endif\n\n        [Test]\n        public void SerializeCustomTupleWithSerializableAttribute()\n        {\n            var tuple = new MyTuple<int>(500);\n            var json = JsonConvert.SerializeObject(tuple);\n            Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n            MyTuple<int> obj = null;\n\n            Action doStuff = () => { obj = JsonConvert.DeserializeObject<MyTuple<int>>(json); };\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD2_0\n            doStuff();\n            Assert.AreEqual(500, obj.Item1);\n#else\n            ExceptionAssert.Throws<JsonSerializationException>(\n                doStuff,\n                \"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.MyTuple`1[System.Int32]. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'm_Item1', line 1, position 11.\");\n#endif\n        }\n\n#if DEBUG\n        [Test]\n        public void SerializeCustomTupleWithSerializableAttributeInPartialTrust()\n        {\n            try\n            {\n                JsonTypeReflector.SetFullyTrusted(false);\n\n                var tuple = new MyTuplePartial<int>(500);\n                var json = JsonConvert.SerializeObject(tuple);\n                Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n                ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<MyTuplePartial<int>>(json), \"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.MyTuplePartial`1[System.Int32]. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'm_Item1', line 1, position 11.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(true);\n            }\n        }\n#endif\n\n#if !(PORTABLE || NET35 || NET20 || PORTABLE40 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void SerializeTupleWithSerializableAttribute()\n        {\n            var tuple = Tuple.Create(500);\n\n            SerializableContractResolver contractResolver = new SerializableContractResolver();\n\n            var json = JsonConvert.SerializeObject(tuple, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n            Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n            var obj = JsonConvert.DeserializeObject<Tuple<int>>(json, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n            Assert.AreEqual(500, obj.Item1);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void RoundtripOfDateTimeOffset()\n        {\n            var content = @\"{\"\"startDateTime\"\":\"\"2012-07-19T14:30:00+09:30\"\"}\";\n\n            var jsonSerializerSettings = new JsonSerializerSettings() { DateFormatHandling = DateFormatHandling.IsoDateFormat, DateParseHandling = DateParseHandling.DateTimeOffset, DateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind };\n\n            var obj = (JObject)JsonConvert.DeserializeObject(content, jsonSerializerSettings);\n\n            var dateTimeOffset = (DateTimeOffset)((JValue)obj[\"startDateTime\"]).Value;\n\n            Assert.AreEqual(TimeSpan.FromHours(9.5), dateTimeOffset.Offset);\n            Assert.AreEqual(\"07/19/2012 14:30:00 +09:30\", dateTimeOffset.ToString(CultureInfo.InvariantCulture));\n        }\n\n        [Test]\n        public void NullableFloatingPoint()\n        {\n            NullableFloats floats = new NullableFloats\n            {\n                Object = double.NaN,\n                ObjectNull = null,\n                Float = float.NaN,\n                NullableDouble = double.NaN,\n                NullableFloat = null\n            };\n\n            string json = JsonConvert.SerializeObject(floats, Formatting.Indented, new JsonSerializerSettings\n            {\n                FloatFormatHandling = FloatFormatHandling.DefaultValue\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"Object\"\": 0.0,\n  \"\"Float\"\": 0.0,\n  \"\"Double\"\": 0.0,\n  \"\"NullableFloat\"\": null,\n  \"\"NullableDouble\"\": null,\n  \"\"ObjectNull\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DateFormatString()\n        {\n            CultureInfo culture = new CultureInfo(\"en-NZ\");\n            culture.DateTimeFormat.AMDesignator = \"a.m.\";\n            culture.DateTimeFormat.PMDesignator = \"p.m.\";\n\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            string json = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = \"yyyy tt\",\n                Culture = culture\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000 p.m.\"\",\n  \"\"2000 p.m.\"\"\n]\", json);\n        }\n\n        [Test]\n        public void DateFormatStringForInternetExplorer()\n        {\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            string json = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = @\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.fffK\"\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000-12-12T12:12:12.000Z\"\",\n  \"\"2000-12-12T12:12:12.000+01:00\"\"\n]\", json);\n        }\n\n        [Test]\n        public void JsonSerializerDateFormatString()\n        {\n            CultureInfo culture = new CultureInfo(\"en-NZ\");\n            culture.DateTimeFormat.AMDesignator = \"a.m.\";\n            culture.DateTimeFormat.PMDesignator = \"p.m.\";\n\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            StringWriter sw = new StringWriter();\n            JsonTextWriter jsonWriter = new JsonTextWriter(sw);\n\n            JsonSerializer serializer = JsonSerializer.Create(new JsonSerializerSettings\n            {\n                DateFormatString = \"yyyy tt\",\n                Culture = culture,\n                Formatting = Formatting.Indented\n            });\n            serializer.Serialize(jsonWriter, dates);\n\n            Assert.IsNull(jsonWriter.DateFormatString);\n            Assert.AreEqual(CultureInfo.InvariantCulture, jsonWriter.Culture);\n            Assert.AreEqual(Formatting.None, jsonWriter.Formatting);\n\n            string json = sw.ToString();\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000 p.m.\"\",\n  \"\"2000 p.m.\"\"\n]\", json);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void SerializeDeserializeTuple()\n        {\n            Tuple<int, int> tuple = Tuple.Create(500, 20);\n            string json = JsonConvert.SerializeObject(tuple);\n            Assert.AreEqual(@\"{\"\"Item1\"\":500,\"\"Item2\"\":20}\", json);\n\n            Tuple<int, int> tuple2 = JsonConvert.DeserializeObject<Tuple<int, int>>(json);\n            Assert.AreEqual(500, tuple2.Item1);\n            Assert.AreEqual(20, tuple2.Item2);\n        }\n#endif\n\n        [Test]\n        public void JsonSerializerStringEscapeHandling()\n        {\n            StringWriter sw = new StringWriter();\n            JsonTextWriter jsonWriter = new JsonTextWriter(sw);\n\n            JsonSerializer serializer = JsonSerializer.Create(new JsonSerializerSettings\n            {\n                StringEscapeHandling = StringEscapeHandling.EscapeHtml,\n                Formatting = Formatting.Indented\n            });\n            serializer.Serialize(jsonWriter, new { html = \"<html></html>\" });\n\n            Assert.AreEqual(StringEscapeHandling.Default, jsonWriter.StringEscapeHandling);\n\n            string json = sw.ToString();\n\n            StringAssert.AreEqual(@\"{\n  \"\"html\"\": \"\"\\u003chtml\\u003e\\u003c/html\\u003e\"\"\n}\", json);\n        }\n\n        [Test]\n        public void NoConstructorReadOnlyCollectionTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<NoConstructorReadOnlyCollection<int>>(\"[1]\"), \"Cannot deserialize readonly or fixed size list: Newtonsoft.Json.Tests.TestObjects.NoConstructorReadOnlyCollection`1[System.Int32]. Path '', line 1, position 1.\");\n        }\n\n#if !(NET40 || NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void NoConstructorReadOnlyDictionaryTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<NoConstructorReadOnlyDictionary<int, int>>(\"{'1':1}\"), \"Cannot deserialize readonly or fixed size dictionary: Newtonsoft.Json.Tests.TestObjects.NoConstructorReadOnlyDictionary`2[System.Int32,System.Int32]. Path '1', line 1, position 5.\");\n        }\n#endif\n\n#if !(PORTABLE || NET35 || NET20 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ReadTooLargeInteger()\n        {\n            string json = @\"[999999999999999999999999999999999999999999999999]\";\n\n            IList<BigInteger> l = JsonConvert.DeserializeObject<IList<BigInteger>>(json);\n\n            Assert.AreEqual(BigInteger.Parse(\"999999999999999999999999999999999999999999999999\"), l[0]);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<IList<long>>(json), \"Error converting value 999999999999999999999999999999999999999999999999 to type 'System.Int64'. Path '[0]', line 1, position 49.\");\n        }\n#endif\n\n        [Test]\n        public void SerializeStructWithSerializableAndDataContract()\n        {\n            Pair<string, int> p = new Pair<string, int>(\"One\", 2);\n\n            string json = JsonConvert.SerializeObject(p);\n\n            Assert.AreEqual(@\"{\"\"First\"\":\"\"One\"\",\"\"Second\"\":2}\", json);\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n            DefaultContractResolver r = new DefaultContractResolver();\n            r.IgnoreSerializableAttribute = false;\n\n            json = JsonConvert.SerializeObject(p, new JsonSerializerSettings\n            {\n                ContractResolver = r\n            });\n\n            Assert.AreEqual(@\"{\"\"First\"\":\"\"One\"\",\"\"Second\"\":2}\", json);\n#endif\n        }\n\n        [Test]\n        public void ReadStringFloatingPointSymbols()\n        {\n            string json = @\"[\n  \"\"NaN\"\",\n  \"\"Infinity\"\",\n  \"\"-Infinity\"\"\n]\";\n\n            IList<float> floats = JsonConvert.DeserializeObject<IList<float>>(json);\n            Assert.AreEqual(float.NaN, floats[0]);\n            Assert.AreEqual(float.PositiveInfinity, floats[1]);\n            Assert.AreEqual(float.NegativeInfinity, floats[2]);\n\n            IList<double> doubles = JsonConvert.DeserializeObject<IList<double>>(json);\n            Assert.AreEqual(float.NaN, doubles[0]);\n            Assert.AreEqual(float.PositiveInfinity, doubles[1]);\n            Assert.AreEqual(float.NegativeInfinity, doubles[2]);\n        }\n\n        [Test]\n        public void DefaultDateStringFormatVsUnsetDateStringFormat()\n        {\n            IDictionary<string, object> dates = new Dictionary<string, object>\n            {\n                { \"DateTime-Unspecified\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Unspecified) },\n                { \"DateTime-Utc\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc) },\n                { \"DateTime-Local\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Local) },\n                { \"DateTimeOffset-Zero\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero) },\n                { \"DateTimeOffset-Plus1\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1)) },\n                { \"DateTimeOffset-Plus15\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1.5)) }\n            };\n\n            string expected = JsonConvert.SerializeObject(dates, Formatting.Indented);\n\n            string actual = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = JsonSerializerSettings.DefaultDateFormatString\n            });\n\n            Assert.AreEqual(expected, actual);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void TestStringToNullableDeserialization()\n        {\n            string json = @\"{\n  \"\"MyNullableBool\"\": \"\"\"\",\n  \"\"MyNullableInteger\"\": \"\"\"\",\n  \"\"MyNullableDateTime\"\": \"\"\"\",\n  \"\"MyNullableDateTimeOffset\"\": \"\"\"\",\n  \"\"MyNullableDecimal\"\": \"\"\"\"\n}\";\n\n            NullableTestClass c2 = JsonConvert.DeserializeObject<NullableTestClass>(json);\n            Assert.IsNull(c2.MyNullableBool);\n            Assert.IsNull(c2.MyNullableInteger);\n            Assert.IsNull(c2.MyNullableDateTime);\n            Assert.IsNull(c2.MyNullableDateTimeOffset);\n            Assert.IsNull(c2.MyNullableDecimal);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void HashSetInterface()\n        {\n            ISet<string> s1 = new HashSet<string>(new[] { \"1\", \"two\", \"III\" });\n\n            string json = JsonConvert.SerializeObject(s1);\n\n            ISet<string> s2 = JsonConvert.DeserializeObject<ISet<string>>(json);\n\n            Assert.AreEqual(s1.Count, s2.Count);\n            foreach (string s in s1)\n            {\n                Assert.IsTrue(s2.Contains(s));\n            }\n        }\n#endif\n\n        [Test]\n        public void DeserializeDecimal()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(\"1234567890.123456\"));\n            var settings = new JsonSerializerSettings();\n            var serialiser = JsonSerializer.Create(settings);\n            decimal? d = serialiser.Deserialize<decimal?>(reader);\n\n            Assert.AreEqual(1234567890.123456m, d);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DontSerializeStaticFields()\n        {\n            string json =\n                JsonConvert.SerializeObject(new AnswerFilterModel(), Formatting.Indented, new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableAttribute = false\n                    }\n                });\n\n            StringAssert.AreEqual(@\"{\n  \"\"<Active>k__BackingField\"\": false,\n  \"\"<Ja>k__BackingField\"\": false,\n  \"\"<Handlungsbedarf>k__BackingField\"\": false,\n  \"\"<Beratungsbedarf>k__BackingField\"\": false,\n  \"\"<Unzutreffend>k__BackingField\"\": false,\n  \"\"<Unbeantwortet>k__BackingField\"\": false\n}\", json);\n        }\n#endif\n\n#if !(NET20 || NET35 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeBigInteger()\n        {\n            BigInteger i = BigInteger.Parse(\"123456789999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999990\");\n\n            string json = JsonConvert.SerializeObject(new[] { i }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  123456789999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999990\n]\", json);\n        }\n#endif\n\n        [Test]\n        public void DeserializeWithConstructor()\n        {\n            const string json = @\"{\"\"something_else\"\":\"\"my value\"\"}\";\n            var foo = JsonConvert.DeserializeObject<FooConstructor>(json);\n            Assert.AreEqual(\"my value\", foo.Bar);\n        }\n\n        [Test]\n        public void SerializeCustomReferenceResolver()\n        {\n            PersonReference john = new PersonReference\n            {\n                Id = new Guid(\"0B64FFDF-D155-44AD-9689-58D9ADB137F3\"),\n                Name = \"John Smith\"\n            };\n\n            PersonReference jane = new PersonReference\n            {\n                Id = new Guid(\"AE3C399C-058D-431D-91B0-A36C266441B9\"),\n                Name = \"Jane Smith\"\n            };\n\n            john.Spouse = jane;\n            jane.Spouse = john;\n\n            IList<PersonReference> people = new List<PersonReference>\n            {\n                john,\n                jane\n            };\n\n            string json = JsonConvert.SerializeObject(people, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = new IdReferenceResolver(),\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\", json);\n        }\n\n        [Test]\n        public void NullReferenceResolver()\n        {\n            PersonReference john = new PersonReference\n            {\n                Id = new Guid(\"0B64FFDF-D155-44AD-9689-58D9ADB137F3\"),\n                Name = \"John Smith\"\n            };\n\n            PersonReference jane = new PersonReference\n            {\n                Id = new Guid(\"AE3C399C-058D-431D-91B0-A36C266441B9\"),\n                Name = \"Jane Smith\"\n            };\n\n            john.Spouse = jane;\n            jane.Spouse = john;\n\n            IList<PersonReference> people = new List<PersonReference>\n            {\n                john,\n                jane\n            };\n\n            string json = JsonConvert.SerializeObject(people, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = null,\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  {\n    \"\"$id\"\": \"\"1\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"2\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"1\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"2\"\"\n  }\n]\", json);\n        }\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50)\n        [Test]\n        public void SerializeDictionaryWithStructKey()\n        {\n            string json = JsonConvert.SerializeObject(\n                new Dictionary<Size, Size> { { new Size(1, 2), new Size(3, 4) } }\n            );\n\n            Assert.AreEqual(@\"{\"\"1, 2\"\":\"\"3, 4\"\"}\", json);\n\n            Dictionary<Size, Size> d = JsonConvert.DeserializeObject<Dictionary<Size, Size>>(json);\n\n            Assert.AreEqual(new Size(1, 2), d.Keys.First());\n            Assert.AreEqual(new Size(3, 4), d.Values.First());\n        }\n#endif\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50) || NETSTANDARD1_0 || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeDictionaryWithStructKey_Custom()\n        {\n            string json = JsonConvert.SerializeObject(\n                new Dictionary<TypeConverterSize, TypeConverterSize> { { new TypeConverterSize(1, 2), new TypeConverterSize(3, 4) } }\n            );\n\n            Assert.AreEqual(@\"{\"\"1, 2\"\":\"\"3, 4\"\"}\", json);\n\n            Dictionary<TypeConverterSize, TypeConverterSize> d = JsonConvert.DeserializeObject<Dictionary<TypeConverterSize, TypeConverterSize>>(json);\n\n            Assert.AreEqual(new TypeConverterSize(1, 2), d.Keys.First());\n            Assert.AreEqual(new TypeConverterSize(3, 4), d.Values.First());\n        }\n#endif\n\n        [Test]\n        public void DeserializeCustomReferenceResolver()\n        {\n            string json = @\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\";\n\n            IList<PersonReference> people = JsonConvert.DeserializeObject<IList<PersonReference>>(json, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = new IdReferenceResolver(),\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            Assert.AreEqual(2, people.Count);\n\n            PersonReference john = people[0];\n            PersonReference jane = people[1];\n\n            Assert.AreEqual(john, jane.Spouse);\n            Assert.AreEqual(jane, john.Spouse);\n        }\n\n        [Test]\n        public void DeserializeCustomReferenceResolver_ViaProvider()\n        {\n            string json = @\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\";\n\n            IList<PersonReference> people = JsonConvert.DeserializeObject<IList<PersonReference>>(json, new JsonSerializerSettings\n            {\n                ReferenceResolverProvider = () => new IdReferenceResolver(),\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            Assert.AreEqual(2, people.Count);\n\n            PersonReference john = people[0];\n            PersonReference jane = people[1];\n\n            Assert.AreEqual(john, jane.Spouse);\n            Assert.AreEqual(jane, john.Spouse);\n        }\n\n#if !(NET35 || NET20 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void TypeConverterOnInterface()\n        {\n            var consoleWriter = new ConsoleWriter();\n\n            // If dynamic type handling is enabled, case 1 and 3 work fine\n            var options = new JsonSerializerSettings\n            {\n                Converters = new JsonConverterCollection { new TypeConverterJsonConverter() },\n                //TypeNameHandling = TypeNameHandling.All\n            };\n\n            //\n            // Case 1: Serialize the concrete value and restore it from the interface\n            // Therefore we need dynamic handling of type information if the type is not serialized with the type converter directly\n            //\n            var text1 = JsonConvert.SerializeObject(consoleWriter, Formatting.Indented, options);\n            Assert.AreEqual(@\"\"\"Console Writer\"\"\", text1);\n\n            var restoredWriter = JsonConvert.DeserializeObject<IMyInterface>(text1, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredWriter.PrintTest());\n\n            //\n            // Case 2: Serialize a dictionary where the interface is the key\n            // The key is always serialized with its ToString() method and therefore needs a mechanism to be restored from that (using the type converter)\n            //\n            var dict2 = new Dictionary<IMyInterface, string>();\n            dict2.Add(consoleWriter, \"Console\");\n\n            var text2 = JsonConvert.SerializeObject(dict2, Formatting.Indented, options);\n            StringAssert.AreEqual(@\"{\n  \"\"Console Writer\"\": \"\"Console\"\"\n}\", text2);\n\n            var restoredObject = JsonConvert.DeserializeObject<Dictionary<IMyInterface, string>>(text2, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredObject.First().Key.PrintTest());\n\n            //\n            // Case 3 Serialize a dictionary where the interface is the value\n            // The key is always serialized with its ToString() method and therefore needs a mechanism to be restored from that (using the type converter)\n            //\n            var dict3 = new Dictionary<string, IMyInterface>();\n            dict3.Add(\"Console\", consoleWriter);\n\n            var text3 = JsonConvert.SerializeObject(dict3, Formatting.Indented, options);\n            StringAssert.AreEqual(@\"{\n  \"\"Console\"\": \"\"Console Writer\"\"\n}\", text3);\n\n            var restoredDict2 = JsonConvert.DeserializeObject<Dictionary<string, IMyInterface>>(text3, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredDict2.First().Value.PrintTest());\n        }\n#endif\n\n        [Test]\n        public void Main()\n        {\n            ParticipantEntity product = new ParticipantEntity();\n            product.Properties = new Dictionary<string, string> { { \"s\", \"d\" } };\n            string json = JsonConvert.SerializeObject(product);\n\n            Assert.AreEqual(@\"{\"\"pa_info\"\":{\"\"s\"\":\"\"d\"\"}}\", json);\n            ParticipantEntity deserializedProduct = JsonConvert.DeserializeObject<ParticipantEntity>(json);\n        }\n\n#if !(PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ConvertibleIdTest()\n        {\n            var c = new TestClassConvertable { Id = new ConvertibleId { Value = 1 }, X = 2 };\n            var s = JsonConvert.SerializeObject(c, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Id\"\": \"\"1\"\",\n  \"\"X\"\": 2\n}\", s);\n        }\n#endif\n\n        [Test]\n        public void DuplicatePropertiesInNestedObject()\n        {\n            string content = @\"{\"\"result\"\":{\"\"time\"\":1408188592,\"\"time\"\":1408188593},\"\"error\"\":null,\"\"id\"\":\"\"1\"\"}\";\n            JObject o = JsonConvert.DeserializeObject<JObject>(content);\n            int time = (int)o[\"result\"][\"time\"];\n\n            Assert.AreEqual(1408188593, time);\n        }\n\n        [Test]\n        public void RoundtripUriOriginalString()\n        {\n            string originalUri = \"https://test.com?m=a%2bb\";\n\n            Uri uriWithPlus = new Uri(originalUri);\n\n            string jsonWithPlus = JsonConvert.SerializeObject(uriWithPlus);\n\n            Uri uriWithPlus2 = JsonConvert.DeserializeObject<Uri>(jsonWithPlus);\n\n            Assert.AreEqual(originalUri, uriWithPlus2.OriginalString);\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTime()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Dec-Friday-22\"\"\", json);\n\n            DateTime dt1 = JsonConvert.DeserializeObject<DateTime>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTime), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTime)v.Value);\n\n            reader = new JsonTextReader(new StringReader(@\"\"\"abc\"\"\"))\n            {\n                DateFormatString = dateFormatString\n            };\n            v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.String, v.Type);\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            Assert.AreEqual(\"abc\", v.Value);\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTimeAndCulture()\n        {\n            CultureInfo culture = new CultureInfo(\"tr-TR\");\n\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Ara-Cuma-22\"\"\", json);\n\n            DateTime dt1 = JsonConvert.DeserializeObject<DateTime>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTime), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTime)v.Value);\n\n            reader = new JsonTextReader(new StringReader(@\"\"\"2000-pie-Dec-Friday-22\"\"\"))\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n            v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.String, v.Type);\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            Assert.AreEqual(\"2000-pie-Dec-Friday-22\", v.Value);\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTime()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTime, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTime, string> d = JsonConvert.DeserializeObject<Dictionary<DateTime, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTime_ReadAhead()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                MetadataPropertyHandling = MetadataPropertyHandling.ReadAhead,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTime, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTime, string> d = JsonConvert.DeserializeObject<Dictionary<DateTime, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n#if !NET20\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTimeOffset()\n        {\n            DateTimeOffset dt = new DateTimeOffset(2000, 12, 22, 0, 0, 0, TimeSpan.Zero);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd'!'K\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTimeOffset, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22!+00:00\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTimeOffset, string> d = JsonConvert.DeserializeObject<Dictionary<DateTimeOffset, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTimeOffset_ReadAhead()\n        {\n            DateTimeOffset dt = new DateTimeOffset(2000, 12, 22, 0, 0, 0, TimeSpan.Zero);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd'!'K\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                MetadataPropertyHandling = MetadataPropertyHandling.ReadAhead,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTimeOffset, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22!+00:00\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTimeOffset, string> d = JsonConvert.DeserializeObject<Dictionary<DateTimeOffset, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTimeOffset()\n        {\n            DateTimeOffset dt = new DateTimeOffset(new DateTime(2000, 12, 22));\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Dec-Friday-22\"\"\", json);\n\n            DateTimeOffset dt1 = JsonConvert.DeserializeObject<DateTimeOffset>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString,\n                DateParseHandling = DateParseHandling.DateTimeOffset\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTimeOffset), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTimeOffset)v.Value);\n        }\n\n        [Test]\n        public void DeserializeConstantProperty()\n        {\n            ConstantTestClass c1 = new ConstantTestClass();\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"MY_CONSTANT\"\": \"\".\"\"\n}\", json);\n\n            JsonConvert.DeserializeObject<ConstantTestClass>(json);\n        }\n#endif\n\n        [Test]\n        public void SerializeObjectWithEvent()\n        {\n            MyObservableObject o = new MyObservableObject\n            {\n                TestString = \"Test string\"\n            };\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"PropertyChanged\"\": null,\n  \"\"TestString\"\": \"\"Test string\"\"\n}\", json);\n\n            MyObservableObject o2 = JsonConvert.DeserializeObject<MyObservableObject>(json);\n            Assert.AreEqual(\"Test string\", o2.TestString);\n        }\n\n        [Test]\n        public void ParameterizedConstructorWithBasePrivateProperties()\n        {\n            var original = new DerivedConstructorType(\"Base\", \"Derived\");\n\n            var serializerSettings = new JsonSerializerSettings();\n            var jsonCopy = JsonConvert.SerializeObject(original, serializerSettings);\n\n            var clonedObject = JsonConvert.DeserializeObject<DerivedConstructorType>(jsonCopy, serializerSettings);\n\n            Assert.AreEqual(\"Base\", clonedObject.BaseProperty);\n            Assert.AreEqual(\"Derived\", clonedObject.DerivedProperty);\n        }\n\n        [Test]\n        public void ErrorCreatingJsonConverter()\n        {\n            ExceptionAssert.Throws<JsonException>(() => JsonConvert.SerializeObject(new ErroringTestClass()), \"Error creating 'Newtonsoft.Json.Tests.TestObjects.ErroringJsonConverter'.\");\n        }\n\n        [Test]\n        public void DeserializeInvalidOctalRootError()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(() => JsonConvert.DeserializeObject<string>(\"020474068\"), \"Input string '020474068' is not a valid number. Path '', line 1, position 9.\");\n        }\n\n        [Test]\n        public void DeserializedDerivedWithPrivate()\n        {\n            string json = @\"{\n  \"\"DerivedProperty\"\": \"\"derived\"\",\n  \"\"BaseProperty\"\": \"\"base\"\"\n}\";\n\n            var d = JsonConvert.DeserializeObject<DerivedWithPrivate>(json);\n\n            Assert.AreEqual(\"base\", d.BaseProperty);\n            Assert.AreEqual(\"derived\", d.DerivedProperty);\n        }\n\n#if !(NET20 || NET35 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeNullableUnsignedLong()\n        {\n            NullableLongTestClass instance = new NullableLongTestClass\n            {\n                Value = ulong.MaxValue\n            };\n            string output = JsonConvert.SerializeObject(instance);\n            NullableLongTestClass result = JsonConvert.DeserializeObject<NullableLongTestClass>(output);\n\n            Assert.AreEqual(ulong.MaxValue, result.Value);\n        }\n#endif\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void MailMessageConverterTest()\n        {\n            const string JsonMessage = @\"{\n  \"\"From\"\": {\n    \"\"Address\"\": \"\"askywalker@theEmpire.gov\"\",\n    \"\"DisplayName\"\": \"\"Darth Vader\"\"\n  },\n  \"\"Sender\"\": null,\n  \"\"ReplyTo\"\": null,\n  \"\"ReplyToList\"\": [],\n  \"\"To\"\": [\n    {\n      \"\"Address\"\": \"\"lskywalker@theRebellion.org\"\",\n      \"\"DisplayName\"\": \"\"Luke Skywalker\"\"\n    }\n  ],\n  \"\"Bcc\"\": [],\n  \"\"CC\"\": [\n    {\n      \"\"Address\"\": \"\"lorgana@alderaan.gov\"\",\n      \"\"DisplayName\"\": \"\"Princess Leia\"\"\n    }\n  ],\n  \"\"Priority\"\": 0,\n  \"\"DeliveryNotificationOptions\"\": 0,\n  \"\"Subject\"\": \"\"Family tree\"\",\n  \"\"SubjectEncoding\"\": null,\n  \"\"Headers\"\": [],\n  \"\"HeadersEncoding\"\": null,\n  \"\"Body\"\": \"\"<strong>I am your father!</strong>\"\",\n  \"\"BodyEncoding\"\": \"\"US-ASCII\"\",\n  \"\"BodyTransferEncoding\"\": -1,\n  \"\"IsBodyHtml\"\": true,\n  \"\"Attachments\"\": [\n    {\n      \"\"FileName\"\": \"\"skywalker family tree.jpg\"\",\n      \"\"ContentBase64\"\": \"\"AQIDBAU=\"\"\n    }\n  ],\n  \"\"AlternateViews\"\": []\n}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonConvert.DeserializeObject<System.Net.Mail.MailMessage>(\n                        JsonMessage,\n                        new MailAddressReadConverter(),\n                        new AttachmentReadConverter(),\n                        new EncodingReadConverter());\n                },\n                \"Cannot populate list type System.Net.Mime.HeaderCollection. Path 'Headers', line 26, position 14.\");\n        }\n#endif\n\n        [Test]\n        public void ParametrizedConstructor_IncompleteJson()\n        {\n            string s = @\"{\"\"text\"\":\"\"s\"\",\"\"cursorPosition\"\":189,\"\"dataSource\"\":\"\"json_northwind\"\",\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<CompletionDataRequest>(s), \"Unexpected end when deserializing object. Path 'dataSource', line 1, position 63.\");\n        }\n\n        [Test]\n        public void ChildClassWithProtectedOverridePlusJsonProperty_Serialize()\n        {\n            JsonObjectContract c = (JsonObjectContract)DefaultContractResolver.Instance.ResolveContract(typeof(ChildClassWithProtectedOverridePlusJsonProperty));\n            Assert.AreEqual(1, c.Properties.Count);\n\n            var propertyValue = \"test\";\n            var testJson = @\"{ 'MyProperty' : '\" + propertyValue + \"' }\";\n\n            var testObject = JsonConvert.DeserializeObject<ChildClassWithProtectedOverridePlusJsonProperty>(testJson);\n\n            Assert.AreEqual(propertyValue, testObject.GetPropertyValue(), \"MyProperty should be populated\");\n        }\n\n        [Test]\n        public void JsonPropertyConverter()\n        {\n            DateTime dt = new DateTime(2000, 12, 20, 0, 0, 0, DateTimeKind.Utc);\n\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                ContractResolver = new JsonPropertyConverterContractResolver(),\n                Formatting = Formatting.Indented\n            };\n\n            JsonPropertyConverterTestClass c1 = new JsonPropertyConverterTestClass\n            {\n                NormalDate = dt,\n                JavaScriptDate = dt\n            };\n\n            string json = JsonConvert.SerializeObject(c1, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"NormalDate\"\": \"\"2000-12-20T00:00:00Z\"\",\n  \"\"JavaScriptDate\"\": new Date(\n    977270400000\n  )\n}\", json);\n\n            JsonPropertyConverterTestClass c2 = JsonConvert.DeserializeObject<JsonPropertyConverterTestClass>(json, settings);\n\n            Assert.AreEqual(dt, c2.NormalDate);\n            Assert.AreEqual(dt, c2.JavaScriptDate);\n        }\n\n        [Test]\n        public void StringEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: , B: 1, C: 123, D: 1.23, E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'A', line 1, position 6.\");\n        }\n\n        [Test]\n        public void NullableIntEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: , C: 123, D: 1.23, E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'B', line 1, position 13.\");\n        }\n\n        [Test]\n        public void NullableLongEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: , D: 1.23, E: 3.45, F: null }\"),\n                \"An undefined token is not a valid System.Nullable`1[System.Int64]. Path 'C', line 1, position 18.\");\n        }\n\n        [Test]\n        public void NullableDecimalEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: 123, D: , E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'D', line 1, position 27.\");\n        }\n\n        [Test]\n        public void NullableDoubleEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: 123, D: 1.23, E: , F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'E', line 1, position 36.\");\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Globalization;\n#if HAVE_BIG_INTEGER\nusing System.Numerics;\n#endif\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Utilities;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Represents a reader that provides fast, non-cached, forward-only access to serialized JSON data.\n    /// </summary>\n    public abstract partial class JsonReader : IDisposable\n    {\n        /// <summary>\n        /// Specifies the state of the reader.\n        /// </summary>\n        protected internal enum State\n        {\n            /// <summary>\n            /// A <see cref=\"JsonReader\"/> read method has not been called.\n            /// </summary>\n            Start,\n\n            /// <summary>\n            /// The end of the file has been reached successfully.\n            /// </summary>\n            Complete,\n\n            /// <summary>\n            /// Reader is at a property.\n            /// </summary>\n            Property,\n\n            /// <summary>\n            /// Reader is at the start of an object.\n            /// </summary>\n            ObjectStart,\n\n            /// <summary>\n            /// Reader is in an object.\n            /// </summary>\n            Object,\n\n            /// <summary>\n            /// Reader is at the start of an array.\n            /// </summary>\n            ArrayStart,\n\n            /// <summary>\n            /// Reader is in an array.\n            /// </summary>\n            Array,\n\n            /// <summary>\n            /// The <see cref=\"JsonReader.Close()\"/> method has been called.\n            /// </summary>\n            Closed,\n\n            /// <summary>\n            /// Reader has just read a value.\n            /// </summary>\n            PostValue,\n\n            /// <summary>\n            /// Reader is at the start of a constructor.\n            /// </summary>\n            ConstructorStart,\n\n            /// <summary>\n            /// Reader is in a constructor.\n            /// </summary>\n            Constructor,\n\n            /// <summary>\n            /// An error occurred that prevents the read operation from continuing.\n            /// </summary>\n            Error,\n\n            /// <summary>\n            /// The end of the file has been reached successfully.\n            /// </summary>\n            Finished\n        }\n\n        // current Token data\n        private JsonToken _tokenType;\n        private object? _value;\n        internal char _quoteChar;\n        internal State _currentState;\n        private JsonPosition _currentPosition;\n        private CultureInfo? _culture;\n        private DateTimeZoneHandling _dateTimeZoneHandling;\n        private int? _maxDepth;\n        private bool _hasExceededMaxDepth;\n        internal DateParseHandling _dateParseHandling;\n        internal FloatParseHandling _floatParseHandling;\n        private string? _dateFormatString;\n        private List<JsonPosition>? _stack;\n\n        /// <summary>\n        /// Gets the current reader state.\n        /// </summary>\n        /// <value>The current reader state.</value>\n        protected State CurrentState => _currentState;\n\n        /// <summary>\n        /// Gets or sets a value indicating whether the source should be closed when this reader is closed.\n        /// </summary>\n        /// <value>\n        /// <c>true</c> to close the source when this reader is closed; otherwise <c>false</c>. The default is <c>true</c>.\n        /// </value>\n        public bool CloseInput { get; set; }\n\n        /// <summary>\n        /// Gets or sets a value indicating whether multiple pieces of JSON content can\n        /// be read from a continuous stream without erroring.\n        /// </summary>\n        /// <value>\n        /// <c>true</c> to support reading multiple pieces of JSON content; otherwise <c>false</c>.\n        /// The default is <c>false</c>.\n        /// </value>\n        public bool SupportMultipleContent { get; set; }\n\n        /// <summary>\n        /// Gets the quotation mark character used to enclose the value of a string.\n        /// </summary>\n        public virtual char QuoteChar\n        {\n            get => _quoteChar;\n            protected internal set => _quoteChar = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled when reading JSON.\n        /// </summary>\n        public DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling;\n            set\n            {\n                if (value < DateTimeZoneHandling.Local || value > DateTimeZoneHandling.RoundtripKind)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _dateTimeZoneHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. \"\\/Date(1198908717056)\\/\" and \"2012-03-21T05:40Z\", are parsed when reading JSON.\n        /// </summary>\n        public DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling;\n            set\n            {\n                if (value < DateParseHandling.None ||\n#if HAVE_DATE_TIME_OFFSET\n                    value > DateParseHandling.DateTimeOffset\n#else\n                    value > DateParseHandling.DateTime\n#endif\n                    )\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _dateParseHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// </summary>\n        public FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling;\n            set\n            {\n                if (value < FloatParseHandling.Double || value > FloatParseHandling.Decimal)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _floatParseHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how custom date formatted strings are parsed when reading JSON.\n        /// </summary>\n        public string? DateFormatString\n        {\n            get => _dateFormatString;\n            set => _dateFormatString = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// </summary>\n        public int? MaxDepth\n        {\n            get => _maxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets the type of the current JSON token. \n        /// </summary>\n        public virtual JsonToken TokenType => _tokenType;\n\n        /// <summary>\n        /// Gets the text value of the current JSON token.\n        /// </summary>\n        public virtual object? Value => _value;\n\n        /// <summary>\n        /// Gets the .NET type for the current JSON token.\n        /// </summary>\n        public virtual Type? ValueType => _value?.GetType();\n\n        /// <summary>\n        /// Gets the depth of the current token in the JSON document.\n        /// </summary>\n        /// <value>The depth of the current token in the JSON document.</value>\n        public virtual int Depth\n        {\n            get\n            {\n                int depth = _stack?.Count ?? 0;\n                if (JsonTokenUtils.IsStartToken(TokenType) || _currentPosition.Type == JsonContainerType.None)\n                {\n                    return depth;\n                }\n                else\n                {\n                    return depth + 1;\n                }\n            }\n        }\n\n        /// <summary>\n        /// Gets the path of the current JSON token. \n        /// </summary>\n        public virtual string Path\n        {\n            get\n            {\n                if (_currentPosition.Type == JsonContainerType.None)\n                {\n                    return string.Empty;\n                }\n\n                bool insideContainer = (_currentState != State.ArrayStart\n                                        && _currentState != State.ConstructorStart\n                                        && _currentState != State.ObjectStart);\n\n                JsonPosition? current = insideContainer ? (JsonPosition?)_currentPosition : null;\n\n                return JsonPosition.BuildPath(_stack!, current);\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON. Defaults to <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public CultureInfo Culture\n        {\n            get => _culture ?? CultureInfo.InvariantCulture;\n            set => _culture = value;\n        }\n\n        internal JsonPosition GetPosition(int depth)\n        {\n            if (_stack != null && depth < _stack.Count)\n            {\n                return _stack[depth];\n            }\n\n            return _currentPosition;\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonReader\"/> class.\n        /// </summary>\n        protected JsonReader()\n        {\n            _currentState = State.Start;\n            _dateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind;\n            _dateParseHandling = DateParseHandling.DateTime;\n            _floatParseHandling = FloatParseHandling.Double;\n\n            CloseInput = true;\n        }\n\n        private void Push(JsonContainerType value)\n        {\n            UpdateScopeWithFinishedValue();\n\n            if (_currentPosition.Type == JsonContainerType.None)\n            {\n                _currentPosition = new JsonPosition(value);\n            }\n            else\n            {\n                if (_stack == null)\n                {\n                    _stack = new List<JsonPosition>();\n                }\n\n                _stack.Add(_currentPosition);\n                _currentPosition = new JsonPosition(value);\n\n                // this is a little hacky because Depth increases when first property/value is written but only testing here is faster/simpler\n                if (_maxDepth != null && Depth + 1 > _maxDepth && !_hasExceededMaxDepth)\n                {\n                    _hasExceededMaxDepth = true;\n                    throw JsonReaderException.Create(this, \"The reader's MaxDepth of {0} has been exceeded.\".FormatWith(CultureInfo.InvariantCulture, _maxDepth));\n                }\n            }\n        }\n\n        private JsonContainerType Pop()\n        {\n            JsonPosition oldPosition;\n            if (_stack != null && _stack.Count > 0)\n            {\n                oldPosition = _currentPosition;\n                _currentPosition = _stack[_stack.Count - 1];\n                _stack.RemoveAt(_stack.Count - 1);\n            }\n            else\n            {\n                oldPosition = _currentPosition;\n                _currentPosition = new JsonPosition();\n            }\n\n            if (_maxDepth != null && Depth <= _maxDepth)\n            {\n                _hasExceededMaxDepth = false;\n            }\n\n            return oldPosition.Type;\n        }\n\n        private JsonContainerType Peek()\n        {\n            return _currentPosition.Type;\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source.\n        /// </summary>\n        /// <returns><c>true</c> if the next token was read successfully; <c>false</c> if there are no more tokens to read.</returns>\n        public abstract bool Read();\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Int32\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Int32\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual int? ReadAsInt32()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    if (v is int i)\n                    {\n                        return i;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        i = (int)value;\n                    }\n                    else\n#endif\n                    {\n                        try\n                        {\n                            i = Convert.ToInt32(v, CultureInfo.InvariantCulture);\n                        }\n                        catch (Exception ex)\n                        {\n                            // handle error for large integer overflow exceptions\n                            throw JsonReaderException.Create(this, \"Could not convert to integer: {0}.\".FormatWith(CultureInfo.InvariantCulture, v), ex);\n                        }\n                    }\n\n                    SetToken(JsonToken.Integer, i, false);\n                    return i;\n                case JsonToken.String:\n                    string? s = (string?)Value;\n                    return ReadInt32String(s);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading integer. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal int? ReadInt32String(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (int.TryParse(s, NumberStyles.Integer, Culture, out int i))\n            {\n                SetToken(JsonToken.Integer, i, false);\n                return i;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to integer: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"String\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"String\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual string? ReadAsString()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.String:\n                    return (string?)Value;\n            }\n\n            if (JsonTokenUtils.IsPrimitiveToken(t))\n            {\n                object? v = Value;\n                if (v != null)\n                {\n                    string s;\n                    if (v is IFormattable formattable)\n                    {\n                        s = formattable.ToString(null, Culture);\n                    }\n                    else\n                    {\n                        s = v is Uri uri ? uri.OriginalString : v.ToString();\n                    }\n\n                    SetToken(JsonToken.String, s, false);\n                    return s;\n                }\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading string. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Byte\"/>[].\n        /// </summary>\n        /// <returns>A <see cref=\"Byte\"/>[] or <c>null</c> if the next JSON token is null. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual byte[]? ReadAsBytes()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.StartObject:\n                {\n                    ReadIntoWrappedTypeObject();\n\n                    byte[]? data = ReadAsBytes();\n                    ReaderReadAndAssert();\n\n                    if (TokenType != JsonToken.EndObject)\n                    {\n                        throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n                    }\n\n                    SetToken(JsonToken.Bytes, data, false);\n                    return data;\n                }\n                case JsonToken.String:\n                {\n                    // attempt to convert possible base 64 or GUID string to bytes\n                    // GUID has to have format 00000000-0000-0000-0000-000000000000\n                    string s = (string)Value!;\n\n                    byte[] data;\n\n                    if (s.Length == 0)\n                    {\n                        data = CollectionUtils.ArrayEmpty<byte>();\n                    }\n                    else if (ConvertUtils.TryConvertGuid(s, out Guid g1))\n                    {\n                        data = g1.ToByteArray();\n                    }\n                    else\n                    {\n                        data = Convert.FromBase64String(s);\n                    }\n\n                    SetToken(JsonToken.Bytes, data, false);\n                    return data;\n                }\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Bytes:\n                    if (Value is Guid g2)\n                    {\n                        byte[] data = g2.ToByteArray();\n                        SetToken(JsonToken.Bytes, data, false);\n                        return data;\n                    }\n\n                    return (byte[]?)Value;\n                case JsonToken.StartArray:\n                    return ReadArrayIntoByteArray();\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal byte[] ReadArrayIntoByteArray()\n        {\n            List<byte> buffer = new List<byte>();\n\n            while (true)\n            {\n                if (!Read())\n                {\n                    SetToken(JsonToken.None);\n                }\n\n                if (ReadArrayElementIntoByteArrayReportDone(buffer))\n                {\n                    byte[] d = buffer.ToArray();\n                    SetToken(JsonToken.Bytes, d, false);\n                    return d;\n                }\n            }\n        }\n\n        private bool ReadArrayElementIntoByteArrayReportDone(List<byte> buffer)\n        {\n            switch (TokenType)\n            {\n                case JsonToken.None:\n                    throw JsonReaderException.Create(this, \"Unexpected end when reading bytes.\");\n                case JsonToken.Integer:\n                    buffer.Add(Convert.ToByte(Value, CultureInfo.InvariantCulture));\n                    return false;\n                case JsonToken.EndArray:\n                    return true;\n                case JsonToken.Comment:\n                    return false;\n                default:\n                    throw JsonReaderException.Create(this, \"Unexpected token when reading bytes: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Double\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Double\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual double? ReadAsDouble()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    if (v is double d)\n                    {\n                        return d;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        d = (double)value;\n                    }\n                    else\n#endif\n                    {\n                        d = Convert.ToDouble(v, CultureInfo.InvariantCulture);\n                    }\n\n                    SetToken(JsonToken.Float, d, false);\n\n                    return (double)d;\n                case JsonToken.String:\n                    return ReadDoubleString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading double. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal double? ReadDoubleString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (double.TryParse(s, NumberStyles.Float | NumberStyles.AllowThousands, Culture, out double d))\n            {\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to double: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Boolean\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Boolean\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual bool? ReadAsBoolean()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    bool b;\n#if HAVE_BIG_INTEGER\n                    if (Value is BigInteger integer)\n                    {\n                        b = integer != 0;\n                    }\n                    else\n#endif\n                    {\n                        b = Convert.ToBoolean(Value, CultureInfo.InvariantCulture);\n                    }\n\n                    SetToken(JsonToken.Boolean, b, false);\n                    return b;\n                case JsonToken.String:\n                    return ReadBooleanString((string?)Value);\n                case JsonToken.Boolean:\n                    return (bool)Value!;\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading boolean. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal bool? ReadBooleanString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (bool.TryParse(s, out bool b))\n            {\n                SetToken(JsonToken.Boolean, b, false);\n                return b;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to boolean: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Decimal\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Decimal\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual decimal? ReadAsDecimal()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    \n                    if (v is decimal d)\n                    {\n                        return d;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        d = (decimal)value;\n                    }\n                    else\n#endif\n                    {\n                        try\n                        {\n                            d = Convert.ToDecimal(v, CultureInfo.InvariantCulture);\n                        }\n                        catch (Exception ex)\n                        {\n                            // handle error for large integer overflow exceptions\n                            throw JsonReaderException.Create(this, \"Could not convert to decimal: {0}.\".FormatWith(CultureInfo.InvariantCulture, v), ex);\n                        }\n                    }\n\n                    SetToken(JsonToken.Float, d, false);\n                    return d;\n                case JsonToken.String:\n                    return ReadDecimalString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading decimal. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal decimal? ReadDecimalString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (decimal.TryParse(s, NumberStyles.Number, Culture, out decimal d))\n            {\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else if (ConvertUtils.DecimalTryParse(s.ToCharArray(), 0, s.Length, out d) == ParseResult.Success)\n            {\n                // This is to handle strings like \"96.014e-05\" that are not supported by traditional decimal.TryParse\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to decimal: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"DateTime\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"DateTime\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual DateTime? ReadAsDateTime()\n        {\n            switch (GetContentToken())\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Date:\n#if HAVE_DATE_TIME_OFFSET\n                    if (Value is DateTimeOffset offset)\n                    {\n                        SetToken(JsonToken.Date, offset.DateTime, false);\n                    }\n#endif\n\n                    return (DateTime)Value!;\n                case JsonToken.String:\n                    return ReadDateTimeString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading date. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n        }\n\n        internal DateTime? ReadDateTimeString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (DateTimeUtils.TryParseDateTime(s, DateTimeZoneHandling, _dateFormatString, Culture, out DateTime dt))\n            {\n                dt = DateTimeUtils.EnsureDateTime(dt, DateTimeZoneHandling);\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            if (DateTime.TryParse(s, Culture, DateTimeStyles.RoundtripKind, out dt))\n            {\n                dt = DateTimeUtils.EnsureDateTime(dt, DateTimeZoneHandling);\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            throw JsonReaderException.Create(this, \"Could not convert string to DateTime: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n        }\n\n#if HAVE_DATE_TIME_OFFSET\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"DateTimeOffset\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"DateTimeOffset\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual DateTimeOffset? ReadAsDateTimeOffset()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Date:\n                    if (Value is DateTime time)\n                    {\n                        SetToken(JsonToken.Date, new DateTimeOffset(time), false);\n                    }\n\n                    return (DateTimeOffset)Value!;\n                case JsonToken.String:\n                    string? s = (string?)Value;\n                    return ReadDateTimeOffsetString(s);\n                default:\n                    throw JsonReaderException.Create(this, \"Error reading date. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n            }\n        }\n\n        internal DateTimeOffset? ReadDateTimeOffsetString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (DateTimeUtils.TryParseDateTimeOffset(s, _dateFormatString, Culture, out DateTimeOffset dt))\n            {\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            if (DateTimeOffset.TryParse(s, Culture, DateTimeStyles.RoundtripKind, out dt))\n            {\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            SetToken(JsonToken.String, s, false);\n            throw JsonReaderException.Create(this, \"Could not convert string to DateTimeOffset: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n        }\n#endif\n\n        internal void ReaderReadAndAssert()\n        {\n            if (!Read())\n            {\n                throw CreateUnexpectedEndException();\n            }\n        }\n\n        internal JsonReaderException CreateUnexpectedEndException()\n        {\n            return JsonReaderException.Create(this, \"Unexpected end when reading JSON.\");\n        }\n\n        internal void ReadIntoWrappedTypeObject()\n        {\n            ReaderReadAndAssert();\n            if (Value != null && Value.ToString() == JsonTypeReflector.TypePropertyName)\n            {\n                ReaderReadAndAssert();\n                if (Value != null && Value.ToString().StartsWith(\"System.Byte[]\", StringComparison.Ordinal))\n                {\n                    ReaderReadAndAssert();\n                    if (Value.ToString() == JsonTypeReflector.ValuePropertyName)\n                    {\n                        return;\n                    }\n                }\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, JsonToken.StartObject));\n        }\n\n        /// <summary>\n        /// Skips the children of the current token.\n        /// </summary>\n        public void Skip()\n        {\n            if (TokenType == JsonToken.PropertyName)\n            {\n                Read();\n            }\n\n            if (JsonTokenUtils.IsStartToken(TokenType))\n            {\n                int depth = Depth;\n\n                while (Read() && (depth < Depth))\n                {\n                }\n            }\n        }\n\n        /// <summary>\n        /// Sets the current token.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        protected void SetToken(JsonToken newToken)\n        {\n            SetToken(newToken, null, true);\n        }\n\n        /// <summary>\n        /// Sets the current token and value.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        /// <param name=\"value\">The value.</param>\n        protected void SetToken(JsonToken newToken, object? value)\n        {\n            SetToken(newToken, value, true);\n        }\n\n        /// <summary>\n        /// Sets the current token and value.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        /// <param name=\"value\">The value.</param>\n        /// <param name=\"updateIndex\">A flag indicating whether the position index inside an array should be updated.</param>\n        protected void SetToken(JsonToken newToken, object? value, bool updateIndex)\n        {\n            _tokenType = newToken;\n            _value = value;\n\n            switch (newToken)\n            {\n                case JsonToken.StartObject:\n                    _currentState = State.ObjectStart;\n                    Push(JsonContainerType.Object);\n                    break;\n                case JsonToken.StartArray:\n                    _currentState = State.ArrayStart;\n                    Push(JsonContainerType.Array);\n                    break;\n                case JsonToken.StartConstructor:\n                    _currentState = State.ConstructorStart;\n                    Push(JsonContainerType.Constructor);\n                    break;\n                case JsonToken.EndObject:\n                    ValidateEnd(JsonToken.EndObject);\n                    break;\n                case JsonToken.EndArray:\n                    ValidateEnd(JsonToken.EndArray);\n                    break;\n                case JsonToken.EndConstructor:\n                    ValidateEnd(JsonToken.EndConstructor);\n                    break;\n                case JsonToken.PropertyName:\n                    _currentState = State.Property;\n\n                    _currentPosition.PropertyName = (string)value!;\n                    break;\n                case JsonToken.Undefined:\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                case JsonToken.Boolean:\n                case JsonToken.Null:\n                case JsonToken.Date:\n                case JsonToken.String:\n                case JsonToken.Raw:\n                case JsonToken.Bytes:\n                    SetPostValueState(updateIndex);\n                    break;\n            }\n        }\n\n        internal void SetPostValueState(bool updateIndex)\n        {\n            if (Peek() != JsonContainerType.None || SupportMultipleContent)\n            {\n                _currentState = State.PostValue;\n            }\n            else\n            {\n                SetFinished();\n            }\n\n            if (updateIndex)\n            {\n                UpdateScopeWithFinishedValue();\n            }\n        }\n\n        private void UpdateScopeWithFinishedValue()\n        {\n            if (_currentPosition.HasIndex)\n            {\n                _currentPosition.Position++;\n            }\n        }\n\n        private void ValidateEnd(JsonToken endToken)\n        {\n            JsonContainerType currentObject = Pop();\n\n            if (GetTypeForCloseToken(endToken) != currentObject)\n            {\n                throw JsonReaderException.Create(this, \"JsonToken {0} is not valid for closing JsonType {1}.\".FormatWith(CultureInfo.InvariantCulture, endToken, currentObject));\n            }\n\n            if (Peek() != JsonContainerType.None || SupportMultipleContent)\n            {\n                _currentState = State.PostValue;\n            }\n            else\n            {\n                SetFinished();\n            }\n        }\n\n        /// <summary>\n        /// Sets the state based on current token type.\n        /// </summary>\n        protected void SetStateBasedOnCurrent()\n        {\n            JsonContainerType currentObject = Peek();\n\n            switch (currentObject)\n            {\n                case JsonContainerType.Object:\n                    _currentState = State.Object;\n                    break;\n                case JsonContainerType.Array:\n                    _currentState = State.Array;\n                    break;\n                case JsonContainerType.Constructor:\n                    _currentState = State.Constructor;\n                    break;\n                case JsonContainerType.None:\n                    SetFinished();\n                    break;\n                default:\n                    throw JsonReaderException.Create(this, \"While setting the reader state back to current object an unexpected JsonType was encountered: {0}\".FormatWith(CultureInfo.InvariantCulture, currentObject));\n            }\n        }\n\n        private void SetFinished()\n        {\n            _currentState = SupportMultipleContent ? State.Start : State.Finished;\n        }\n\n        private JsonContainerType GetTypeForCloseToken(JsonToken token)\n        {\n            switch (token)\n            {\n                case JsonToken.EndObject:\n                    return JsonContainerType.Object;\n                case JsonToken.EndArray:\n                    return JsonContainerType.Array;\n                case JsonToken.EndConstructor:\n                    return JsonContainerType.Constructor;\n                default:\n                    throw JsonReaderException.Create(this, \"Not a valid close JsonToken: {0}\".FormatWith(CultureInfo.InvariantCulture, token));\n            }\n        }\n\n        void IDisposable.Dispose()\n        {\n            Dispose(true);\n            GC.SuppressFinalize(this);\n        }\n\n        /// <summary>\n        /// Releases unmanaged and - optionally - managed resources.\n        /// </summary>\n        /// <param name=\"disposing\"><c>true</c> to release both managed and unmanaged resources; <c>false</c> to release only unmanaged resources.</param>\n        protected virtual void Dispose(bool disposing)\n        {\n            if (_currentState != State.Closed && disposing)\n            {\n                Close();\n            }\n        }\n\n        /// <summary>\n        /// Changes the reader's state to <see cref=\"JsonReader.State.Closed\"/>.\n        /// If <see cref=\"JsonReader.CloseInput\"/> is set to <c>true</c>, the source is also closed.\n        /// </summary>\n        public virtual void Close()\n        {\n            _currentState = State.Closed;\n            _tokenType = JsonToken.None;\n            _value = null;\n        }\n\n        internal void ReadAndAssert()\n        {\n            if (!Read())\n            {\n                throw JsonSerializationException.Create(this, \"Unexpected end when reading JSON.\");\n            }\n        }\n\n        internal void ReadForTypeAndAssert(JsonContract? contract, bool hasConverter)\n        {\n            if (!ReadForType(contract, hasConverter))\n            {\n                throw JsonSerializationException.Create(this, \"Unexpected end when reading JSON.\");\n            }\n        }\n\n        internal bool ReadForType(JsonContract? contract, bool hasConverter)\n        {\n            // don't read properties with converters as a specific value\n            // the value might be a string which will then get converted which will error if read as date for example\n            if (hasConverter)\n            {\n                return Read();\n            }\n\n            ReadType t = contract?.InternalReadType ?? ReadType.Read;\n\n            switch (t)\n            {\n                case ReadType.Read:\n                    return ReadAndMoveToContent();\n                case ReadType.ReadAsInt32:\n                    ReadAsInt32();\n                    break;\n                case ReadType.ReadAsInt64:\n                    bool result = ReadAndMoveToContent();\n                    if (TokenType == JsonToken.Undefined)\n                    {\n                        throw JsonReaderException.Create(this, \"An undefined token is not a valid {0}.\".FormatWith(CultureInfo.InvariantCulture, contract?.UnderlyingType ?? typeof(long)));\n                    }\n                    return result;\n                case ReadType.ReadAsDecimal:\n                    ReadAsDecimal();\n                    break;\n                case ReadType.ReadAsDouble:\n                    ReadAsDouble();\n                    break;\n                case ReadType.ReadAsBytes:\n                    ReadAsBytes();\n                    break;\n                case ReadType.ReadAsBoolean:\n                    ReadAsBoolean();\n                    break;\n                case ReadType.ReadAsString:\n                    ReadAsString();\n                    break;\n                case ReadType.ReadAsDateTime:\n                    ReadAsDateTime();\n                    break;\n#if HAVE_DATE_TIME_OFFSET\n                case ReadType.ReadAsDateTimeOffset:\n                    ReadAsDateTimeOffset();\n                    break;\n#endif\n                default:\n                    throw new ArgumentOutOfRangeException();\n            }\n\n            return (TokenType != JsonToken.None);\n        }\n\n        internal bool ReadAndMoveToContent()\n        {\n            return Read() && MoveToContent();\n        }\n\n        internal bool MoveToContent()\n        {\n            JsonToken t = TokenType;\n            while (t == JsonToken.None || t == JsonToken.Comment)\n            {\n                if (!Read())\n                {\n                    return false;\n                }\n\n                t = TokenType;\n            }\n\n            return true;\n        }\n\n        private JsonToken GetContentToken()\n        {\n            JsonToken t;\n            do\n            {\n                if (!Read())\n                {\n                    SetToken(JsonToken.None);\n                    return JsonToken.None;\n                }\n                else\n                {\n                    t = TokenType;\n                }\n            } while (t == JsonToken.Comment);\n\n            return t;\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections;\nusing System.Collections.Generic;\nusing System.Diagnostics;\nusing System.Globalization;\nusing System.IO;\nusing System.Runtime.Serialization.Formatters;\nusing Newtonsoft.Json.Converters;\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Utilities;\nusing System.Runtime.Serialization;\nusing ErrorEventArgs = Newtonsoft.Json.Serialization.ErrorEventArgs;\nusing System.Runtime.CompilerServices;\nusing System.Diagnostics.CodeAnalysis;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Serializes and deserializes objects into and from the JSON format.\n    /// The <see cref=\"JsonSerializer\"/> enables you to control how objects are encoded into JSON.\n    /// </summary>\n    public class JsonSerializer\n    {\n        internal TypeNameHandling _typeNameHandling;\n        internal TypeNameAssemblyFormatHandling _typeNameAssemblyFormatHandling;\n        internal PreserveReferencesHandling _preserveReferencesHandling;\n        internal ReferenceLoopHandling _referenceLoopHandling;\n        internal MissingMemberHandling _missingMemberHandling;\n        internal ObjectCreationHandling _objectCreationHandling;\n        internal NullValueHandling _nullValueHandling;\n        internal DefaultValueHandling _defaultValueHandling;\n        internal ConstructorHandling _constructorHandling;\n        internal MetadataPropertyHandling _metadataPropertyHandling;\n        internal JsonConverterCollection? _converters;\n        internal IContractResolver _contractResolver;\n        internal ITraceWriter? _traceWriter;\n        internal IEqualityComparer? _equalityComparer;\n        internal ISerializationBinder _serializationBinder;\n        internal StreamingContext _context;\n        private IReferenceResolver? _referenceResolver;\n\n        private Formatting? _formatting;\n        private DateFormatHandling? _dateFormatHandling;\n        private DateTimeZoneHandling? _dateTimeZoneHandling;\n        private DateParseHandling? _dateParseHandling;\n        private FloatFormatHandling? _floatFormatHandling;\n        private FloatParseHandling? _floatParseHandling;\n        private StringEscapeHandling? _stringEscapeHandling;\n        private CultureInfo _culture;\n        private int? _maxDepth;\n        private bool _maxDepthSet;\n        private bool? _checkAdditionalContent;\n        private string? _dateFormatString;\n        private bool _dateFormatStringSet;\n\n        /// <summary>\n        /// Occurs when the <see cref=\"JsonSerializer\"/> errors during serialization and deserialization.\n        /// </summary>\n        public virtual event EventHandler<ErrorEventArgs>? Error;\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        public virtual IReferenceResolver? ReferenceResolver\n        {\n            get => GetReferenceResolver();\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Reference resolver cannot be null.\");\n                }\n\n                _referenceResolver = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"SerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        [Obsolete(\"Binder is obsolete. Use SerializationBinder instead.\")]\n        public virtual SerializationBinder Binder\n        {\n            get\n            {\n                if (_serializationBinder is SerializationBinder legacySerializationBinder)\n                {\n                    return legacySerializationBinder;\n                }\n\n                if (_serializationBinder is SerializationBinderAdapter adapter)\n                {\n                    return adapter.SerializationBinder;\n                }\n\n                throw new InvalidOperationException(\"Cannot get SerializationBinder because an ISerializationBinder was previously set.\");\n            }\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Serialization binder cannot be null.\");\n                }\n\n                _serializationBinder = value as ISerializationBinder ?? new SerializationBinderAdapter(value);\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ISerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        public virtual ISerializationBinder SerializationBinder\n        {\n            get => _serializationBinder;\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Serialization binder cannot be null.\");\n                }\n\n                _serializationBinder = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ITraceWriter\"/> used by the serializer when writing trace messages.\n        /// </summary>\n        /// <value>The trace writer.</value>\n        public virtual ITraceWriter? TraceWriter\n        {\n            get => _traceWriter;\n            set => _traceWriter = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the equality comparer used by the serializer when comparing references.\n        /// </summary>\n        /// <value>The equality comparer.</value>\n        public virtual IEqualityComparer? EqualityComparer\n        {\n            get => _equalityComparer;\n            set => _equalityComparer = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how type name writing and reading is handled by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameHandling.None\" />.\n        /// </summary>\n        /// <remarks>\n        /// <see cref=\"JsonSerializer.TypeNameHandling\"/> should be used with caution when your application deserializes JSON from an external source.\n        /// Incoming types should be validated with a custom <see cref=\"JsonSerializer.SerializationBinder\"/>\n        /// when deserializing with a value other than <see cref=\"TypeNameHandling.None\"/>.\n        /// </remarks>\n        public virtual TypeNameHandling TypeNameHandling\n        {\n            get => _typeNameHandling;\n            set\n            {\n                if (value < TypeNameHandling.None || value > TypeNameHandling.Auto)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"FormatterAssemblyStyle.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        [Obsolete(\"TypeNameAssemblyFormat is obsolete. Use TypeNameAssemblyFormatHandling instead.\")]\n        public virtual FormatterAssemblyStyle TypeNameAssemblyFormat\n        {\n            get => (FormatterAssemblyStyle)_typeNameAssemblyFormatHandling;\n            set\n            {\n                if (value < FormatterAssemblyStyle.Simple || value > FormatterAssemblyStyle.Full)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameAssemblyFormatHandling = (TypeNameAssemblyFormatHandling)value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameAssemblyFormatHandling.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        public virtual TypeNameAssemblyFormatHandling TypeNameAssemblyFormatHandling\n        {\n            get => _typeNameAssemblyFormatHandling;\n            set\n            {\n                if (value < TypeNameAssemblyFormatHandling.Simple || value > TypeNameAssemblyFormatHandling.Full)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameAssemblyFormatHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how object references are preserved by the serializer.\n        /// The default value is <see cref=\"Json.PreserveReferencesHandling.None\" />.\n        /// </summary>\n        public virtual PreserveReferencesHandling PreserveReferencesHandling\n        {\n            get => _preserveReferencesHandling;\n            set\n            {\n                if (value < PreserveReferencesHandling.None || value > PreserveReferencesHandling.All)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _preserveReferencesHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how reference loops (e.g. a class referencing itself) is handled.\n        /// The default value is <see cref=\"Json.ReferenceLoopHandling.Error\" />.\n        /// </summary>\n        public virtual ReferenceLoopHandling ReferenceLoopHandling\n        {\n            get => _referenceLoopHandling;\n            set\n            {\n                if (value < ReferenceLoopHandling.Error || value > ReferenceLoopHandling.Serialize)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _referenceLoopHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how missing members (e.g. JSON contains a property that isn't a member on the object) are handled during deserialization.\n        /// The default value is <see cref=\"Json.MissingMemberHandling.Ignore\" />.\n        /// </summary>\n        public virtual MissingMemberHandling MissingMemberHandling\n        {\n            get => _missingMemberHandling;\n            set\n            {\n                if (value < MissingMemberHandling.Ignore || value > MissingMemberHandling.Error)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _missingMemberHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how null values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.NullValueHandling.Include\" />.\n        /// </summary>\n        public virtual NullValueHandling NullValueHandling\n        {\n            get => _nullValueHandling;\n            set\n            {\n                if (value < NullValueHandling.Include || value > NullValueHandling.Ignore)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _nullValueHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how default values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DefaultValueHandling.Include\" />.\n        /// </summary>\n        public virtual DefaultValueHandling DefaultValueHandling\n        {\n            get => _defaultValueHandling;\n            set\n            {\n                if (value < DefaultValueHandling.Include || value > DefaultValueHandling.IgnoreAndPopulate)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _defaultValueHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how objects are created during deserialization.\n        /// The default value is <see cref=\"Json.ObjectCreationHandling.Auto\" />.\n        /// </summary>\n        /// <value>The object creation handling.</value>\n        public virtual ObjectCreationHandling ObjectCreationHandling\n        {\n            get => _objectCreationHandling;\n            set\n            {\n                if (value < ObjectCreationHandling.Auto || value > ObjectCreationHandling.Replace)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _objectCreationHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how constructors are used during deserialization.\n        /// The default value is <see cref=\"Json.ConstructorHandling.Default\" />.\n        /// </summary>\n        /// <value>The constructor handling.</value>\n        public virtual ConstructorHandling ConstructorHandling\n        {\n            get => _constructorHandling;\n            set\n            {\n                if (value < ConstructorHandling.Default || value > ConstructorHandling.AllowNonPublicDefaultConstructor)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _constructorHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how metadata properties are used during deserialization.\n        /// The default value is <see cref=\"Json.MetadataPropertyHandling.Default\" />.\n        /// </summary>\n        /// <value>The metadata properties handling.</value>\n        public virtual MetadataPropertyHandling MetadataPropertyHandling\n        {\n            get => _metadataPropertyHandling;\n            set\n            {\n                if (value < MetadataPropertyHandling.Default || value > MetadataPropertyHandling.Ignore)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _metadataPropertyHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets a collection <see cref=\"JsonConverter\"/> that will be used during serialization.\n        /// </summary>\n        /// <value>Collection <see cref=\"JsonConverter\"/> that will be used during serialization.</value>\n        public virtual JsonConverterCollection Converters\n        {\n            get\n            {\n                if (_converters == null)\n                {\n                    _converters = new JsonConverterCollection();\n                }\n\n                return _converters;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the contract resolver used by the serializer when\n        /// serializing .NET objects to JSON and vice versa.\n        /// </summary>\n        public virtual IContractResolver ContractResolver\n        {\n            get => _contractResolver;\n            set => _contractResolver = value ?? DefaultContractResolver.Instance;\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"StreamingContext\"/> used by the serializer when invoking serialization callback methods.\n        /// </summary>\n        /// <value>The context.</value>\n        public virtual StreamingContext Context\n        {\n            get => _context;\n            set => _context = value;\n        }\n\n        /// <summary>\n        /// Indicates how JSON text output is formatted.\n        /// The default value is <see cref=\"Json.Formatting.None\" />.\n        /// </summary>\n        public virtual Formatting Formatting\n        {\n            get => _formatting ?? JsonSerializerSettings.DefaultFormatting;\n            set => _formatting = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how dates are written to JSON text.\n        /// The default value is <see cref=\"Json.DateFormatHandling.IsoDateFormat\" />.\n        /// </summary>\n        public virtual DateFormatHandling DateFormatHandling\n        {\n            get => _dateFormatHandling ?? JsonSerializerSettings.DefaultDateFormatHandling;\n            set => _dateFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DateTimeZoneHandling.RoundtripKind\" />.\n        /// </summary>\n        public virtual DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling ?? JsonSerializerSettings.DefaultDateTimeZoneHandling;\n            set => _dateTimeZoneHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. <c>\"\\/Date(1198908717056)\\/\"</c> and <c>\"2012-03-21T05:40Z\"</c>, are parsed when reading JSON.\n        /// The default value is <see cref=\"Json.DateParseHandling.DateTime\" />.\n        /// </summary>\n        public virtual DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling ?? JsonSerializerSettings.DefaultDateParseHandling;\n            set => _dateParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// The default value is <see cref=\"Json.FloatParseHandling.Double\" />.\n        /// </summary>\n        public virtual FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling ?? JsonSerializerSettings.DefaultFloatParseHandling;\n            set => _floatParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how special floating point numbers, e.g. <see cref=\"Double.NaN\"/>,\n        /// <see cref=\"Double.PositiveInfinity\"/> and <see cref=\"Double.NegativeInfinity\"/>,\n        /// are written as JSON text.\n        /// The default value is <see cref=\"Json.FloatFormatHandling.String\" />.\n        /// </summary>\n        public virtual FloatFormatHandling FloatFormatHandling\n        {\n            get => _floatFormatHandling ?? JsonSerializerSettings.DefaultFloatFormatHandling;\n            set => _floatFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how strings are escaped when writing JSON text.\n        /// The default value is <see cref=\"Json.StringEscapeHandling.Default\" />.\n        /// </summary>\n        public virtual StringEscapeHandling StringEscapeHandling\n        {\n            get => _stringEscapeHandling ?? JsonSerializerSettings.DefaultStringEscapeHandling;\n            set => _stringEscapeHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> and <see cref=\"DateTimeOffset\"/> values are formatted when writing JSON text,\n        /// and the expected date format when reading JSON text.\n        /// The default value is <c>\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\"</c>.\n        /// </summary>\n        public virtual string DateFormatString\n        {\n            get => _dateFormatString ?? JsonSerializerSettings.DefaultDateFormatString;\n            set\n            {\n                _dateFormatString = value;\n                _dateFormatStringSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON.\n        /// The default value is <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public virtual CultureInfo Culture\n        {\n            get => _culture ?? JsonSerializerSettings.DefaultCulture;\n            set => _culture = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// A null value means there is no maximum.\n        /// The default value is <c>null</c>.\n        /// </summary>\n        public virtual int? MaxDepth\n        {\n            get => _maxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n                _maxDepthSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets a value indicating whether there will be a check for additional JSON content after deserializing an object.\n        /// The default value is <c>false</c>.\n        /// </summary>\n        /// <value>\n        /// \t<c>true</c> if there will be a check for additional JSON content after deserializing an object; otherwise, <c>false</c>.\n        /// </value>\n        public virtual bool CheckAdditionalContent\n        {\n            get => _checkAdditionalContent ?? JsonSerializerSettings.DefaultCheckAdditionalContent;\n            set => _checkAdditionalContent = value;\n        }\n\n        internal bool IsCheckAdditionalContentSet()\n        {\n            return (_checkAdditionalContent != null);\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonSerializer\"/> class.\n        /// </summary>\n        public JsonSerializer()\n        {\n            _referenceLoopHandling = JsonSerializerSettings.DefaultReferenceLoopHandling;\n            _missingMemberHandling = JsonSerializerSettings.DefaultMissingMemberHandling;\n            _nullValueHandling = JsonSerializerSettings.DefaultNullValueHandling;\n            _defaultValueHandling = JsonSerializerSettings.DefaultDefaultValueHandling;\n            _objectCreationHandling = JsonSerializerSettings.DefaultObjectCreationHandling;\n            _preserveReferencesHandling = JsonSerializerSettings.DefaultPreserveReferencesHandling;\n            _constructorHandling = JsonSerializerSettings.DefaultConstructorHandling;\n            _typeNameHandling = JsonSerializerSettings.DefaultTypeNameHandling;\n            _metadataPropertyHandling = JsonSerializerSettings.DefaultMetadataPropertyHandling;\n            _context = JsonSerializerSettings.DefaultContext;\n            _serializationBinder = DefaultSerializationBinder.Instance;\n\n            _culture = JsonSerializerSettings.DefaultCulture;\n            _contractResolver = DefaultContractResolver.Instance;\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer Create()\n        {\n            return new JsonSerializer();\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <param name=\"settings\">The settings to be applied to the <see cref=\"JsonSerializer\"/>.</param>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer Create(JsonSerializerSettings? settings)\n        {\n            JsonSerializer serializer = Create();\n\n            if (settings != null)\n            {\n                ApplySerializerSettings(serializer, settings);\n            }\n\n            return serializer;\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer CreateDefault()\n        {\n            // copy static to local variable to avoid concurrency issues\n            JsonSerializerSettings? defaultSettings = JsonConvert.DefaultSettings?.Invoke();\n\n            return Create(defaultSettings);\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/> as well as the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// </summary>\n        /// <param name=\"settings\">The settings to be applied to the <see cref=\"JsonSerializer\"/>.</param>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/> as well as the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// </returns>\n        public static JsonSerializer CreateDefault(JsonSerializerSettings? settings)\n        {\n            JsonSerializer serializer = CreateDefault();\n            if (settings != null)\n            {\n                ApplySerializerSettings(serializer, settings);\n            }\n\n            return serializer;\n        }\n\n        private static void ApplySerializerSettings(JsonSerializer serializer, JsonSerializerSettings settings)\n        {\n            if (!CollectionUtils.IsNullOrEmpty(settings.Converters))\n            {\n                // insert settings converters at the beginning so they take precedence\n                // if user wants to remove one of the default converters they will have to do it manually\n                for (int i = 0; i < settings.Converters.Count; i++)\n                {\n                    serializer.Converters.Insert(i, settings.Converters[i]);\n                }\n            }\n\n            // serializer specific\n            if (settings._typeNameHandling != null)\n            {\n                serializer.TypeNameHandling = settings.TypeNameHandling;\n            }\n            if (settings._metadataPropertyHandling != null)\n            {\n                serializer.MetadataPropertyHandling = settings.MetadataPropertyHandling;\n            }\n            if (settings._typeNameAssemblyFormatHandling != null)\n            {\n                serializer.TypeNameAssemblyFormatHandling = settings.TypeNameAssemblyFormatHandling;\n            }\n            if (settings._preserveReferencesHandling != null)\n            {\n                serializer.PreserveReferencesHandling = settings.PreserveReferencesHandling;\n            }\n            if (settings._referenceLoopHandling != null)\n            {\n                serializer.ReferenceLoopHandling = settings.ReferenceLoopHandling;\n            }\n            if (settings._missingMemberHandling != null)\n            {\n                serializer.MissingMemberHandling = settings.MissingMemberHandling;\n            }\n            if (settings._objectCreationHandling != null)\n            {\n                serializer.ObjectCreationHandling = settings.ObjectCreationHandling;\n            }\n            if (settings._nullValueHandling != null)\n            {\n                serializer.NullValueHandling = settings.NullValueHandling;\n            }\n            if (settings._defaultValueHandling != null)\n            {\n                serializer.DefaultValueHandling = settings.DefaultValueHandling;\n            }\n            if (settings._constructorHandling != null)\n            {\n                serializer.ConstructorHandling = settings.ConstructorHandling;\n            }\n            if (settings._context != null)\n            {\n                serializer.Context = settings.Context;\n            }\n            if (settings._checkAdditionalContent != null)\n            {\n                serializer._checkAdditionalContent = settings._checkAdditionalContent;\n            }\n\n            if (settings.Error != null)\n            {\n                serializer.Error += settings.Error;\n            }\n\n            if (settings.ContractResolver != null)\n            {\n                serializer.ContractResolver = settings.ContractResolver;\n            }\n            if (settings.ReferenceResolverProvider != null)\n            {\n                serializer.ReferenceResolver = settings.ReferenceResolverProvider();\n            }\n            if (settings.TraceWriter != null)\n            {\n                serializer.TraceWriter = settings.TraceWriter;\n            }\n            if (settings.EqualityComparer != null)\n            {\n                serializer.EqualityComparer = settings.EqualityComparer;\n            }\n            if (settings.SerializationBinder != null)\n            {\n                serializer.SerializationBinder = settings.SerializationBinder;\n            }\n\n            // reader/writer specific\n            // unset values won't override reader/writer set values\n            if (settings._formatting != null)\n            {\n                serializer._formatting = settings._formatting;\n            }\n            if (settings._dateFormatHandling != null)\n            {\n                serializer._dateFormatHandling = settings._dateFormatHandling;\n            }\n            if (settings._dateTimeZoneHandling != null)\n            {\n                serializer._dateTimeZoneHandling = settings._dateTimeZoneHandling;\n            }\n            if (settings._dateParseHandling != null)\n            {\n                serializer._dateParseHandling = settings._dateParseHandling;\n            }\n            if (settings._dateFormatStringSet)\n            {\n                serializer._dateFormatString = settings._dateFormatString;\n                serializer._dateFormatStringSet = settings._dateFormatStringSet;\n            }\n            if (settings._floatFormatHandling != null)\n            {\n                serializer._floatFormatHandling = settings._floatFormatHandling;\n            }\n            if (settings._floatParseHandling != null)\n            {\n                serializer._floatParseHandling = settings._floatParseHandling;\n            }\n            if (settings._stringEscapeHandling != null)\n            {\n                serializer._stringEscapeHandling = settings._stringEscapeHandling;\n            }\n            if (settings._culture != null)\n            {\n                serializer._culture = settings._culture;\n            }\n            if (settings._maxDepthSet)\n            {\n                serializer._maxDepth = settings._maxDepth;\n                serializer._maxDepthSet = settings._maxDepthSet;\n            }\n        }\n\n        /// <summary>\n        /// Populates the JSON values onto the target object.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"TextReader\"/> that contains the JSON structure to read values from.</param>\n        /// <param name=\"target\">The target object to populate values onto.</param>\n        [DebuggerStepThrough]\n        public void Populate(TextReader reader, object target)\n        {\n            Populate(new JsonTextReader(reader), target);\n        }\n\n        /// <summary>\n        /// Populates the JSON values onto the target object.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> that contains the JSON structure to read values from.</param>\n        /// <param name=\"target\">The target object to populate values onto.</param>\n        [DebuggerStepThrough]\n        public void Populate(JsonReader reader, object target)\n        {\n            PopulateInternal(reader, target);\n        }\n\n        internal virtual void PopulateInternal(JsonReader reader, object target)\n        {\n            ValidationUtils.ArgumentNotNull(reader, nameof(reader));\n            ValidationUtils.ArgumentNotNull(target, nameof(target));\n\n            SetupReader(\n                reader,\n                out CultureInfo? previousCulture,\n                out DateTimeZoneHandling? previousDateTimeZoneHandling,\n                out DateParseHandling? previousDateParseHandling,\n                out FloatParseHandling? previousFloatParseHandling,\n                out int? previousMaxDepth,\n                out string? previousDateFormatString);\n\n            TraceJsonReader? traceJsonReader = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? CreateTraceJsonReader(reader)\n                : null;\n\n            JsonSerializerInternalReader serializerReader = new JsonSerializerInternalReader(this);\n            serializerReader.Populate(traceJsonReader ?? reader, target);\n\n            if (traceJsonReader != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonReader.GetDeserializedJsonMessage(), null);\n            }\n\n            ResetReader(reader, previousCulture, previousDateTimeZoneHandling, previousDateParseHandling, previousFloatParseHandling, previousMaxDepth, previousDateFormatString);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> that contains the JSON structure to deserialize.</param>\n        /// <returns>The <see cref=\"Object\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(JsonReader reader)\n        {\n            return Deserialize(reader, null);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"TextReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"TextReader\"/> containing the object.</param>\n        /// <param name=\"objectType\">The <see cref=\"Type\"/> of object being deserialized.</param>\n        /// <returns>The instance of <paramref name=\"objectType\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(TextReader reader, Type objectType)\n        {\n            return Deserialize(new JsonTextReader(reader), objectType);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> containing the object.</param>\n        /// <typeparam name=\"T\">The type of the object to deserialize.</typeparam>\n        /// <returns>The instance of <typeparamref name=\"T\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public T? Deserialize<T>(JsonReader reader)\n        {\n#pragma warning disable CS8601 // Possible null reference assignment.\n            return (T)Deserialize(reader, typeof(T));\n#pragma warning restore CS8601 // Possible null reference assignment.\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> containing the object.</param>\n        /// <param name=\"objectType\">The <see cref=\"Type\"/> of object being deserialized.</param>\n        /// <returns>The instance of <paramref name=\"objectType\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(JsonReader reader, Type? objectType)\n        {\n            return DeserializeInternal(reader, objectType);\n        }\n\n        internal virtual object? DeserializeInternal(JsonReader reader, Type? objectType)\n        {\n            ValidationUtils.ArgumentNotNull(reader, nameof(reader));\n\n            SetupReader(\n                reader,\n                out CultureInfo? previousCulture,\n                out DateTimeZoneHandling? previousDateTimeZoneHandling,\n                out DateParseHandling? previousDateParseHandling,\n                out FloatParseHandling? previousFloatParseHandling,\n                out int? previousMaxDepth,\n                out string? previousDateFormatString);\n\n            TraceJsonReader? traceJsonReader = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? CreateTraceJsonReader(reader)\n                : null;\n\n            JsonSerializerInternalReader serializerReader = new JsonSerializerInternalReader(this);\n            object? value = serializerReader.Deserialize(traceJsonReader ?? reader, objectType, CheckAdditionalContent);\n\n            if (traceJsonReader != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonReader.GetDeserializedJsonMessage(), null);\n            }\n\n            ResetReader(reader, previousCulture, previousDateTimeZoneHandling, previousDateParseHandling, previousFloatParseHandling, previousMaxDepth, previousDateFormatString);\n\n            return value;\n        }\n\n        private void SetupReader(JsonReader reader, out CultureInfo? previousCulture, out DateTimeZoneHandling? previousDateTimeZoneHandling, out DateParseHandling? previousDateParseHandling, out FloatParseHandling? previousFloatParseHandling, out int? previousMaxDepth, out string? previousDateFormatString)\n        {\n            if (_culture != null && !_culture.Equals(reader.Culture))\n            {\n                previousCulture = reader.Culture;\n                reader.Culture = _culture;\n            }\n            else\n            {\n                previousCulture = null;\n            }\n\n            if (_dateTimeZoneHandling != null && reader.DateTimeZoneHandling != _dateTimeZoneHandling)\n            {\n                previousDateTimeZoneHandling = reader.DateTimeZoneHandling;\n                reader.DateTimeZoneHandling = _dateTimeZoneHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousDateTimeZoneHandling = null;\n            }\n\n            if (_dateParseHandling != null && reader.DateParseHandling != _dateParseHandling)\n            {\n                previousDateParseHandling = reader.DateParseHandling;\n                reader.DateParseHandling = _dateParseHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousDateParseHandling = null;\n            }\n\n            if (_floatParseHandling != null && reader.FloatParseHandling != _floatParseHandling)\n            {\n                previousFloatParseHandling = reader.FloatParseHandling;\n                reader.FloatParseHandling = _floatParseHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousFloatParseHandling = null;\n            }\n\n            if (_maxDepthSet && reader.MaxDepth != _maxDepth)\n            {\n                previousMaxDepth = reader.MaxDepth;\n                reader.MaxDepth = _maxDepth;\n            }\n            else\n            {\n                previousMaxDepth = null;\n            }\n\n            if (_dateFormatStringSet && reader.DateFormatString != _dateFormatString)\n            {\n                previousDateFormatString = reader.DateFormatString;\n                reader.DateFormatString = _dateFormatString;\n            }\n            else\n            {\n                previousDateFormatString = null;\n            }\n\n            if (reader is JsonTextReader textReader)\n            {\n                if (textReader.PropertyNameTable == null && _contractResolver is DefaultContractResolver resolver)\n                {\n                    textReader.PropertyNameTable = resolver.GetNameTable();\n                }\n            }\n        }\n\n        private void ResetReader(JsonReader reader, CultureInfo? previousCulture, DateTimeZoneHandling? previousDateTimeZoneHandling, DateParseHandling? previousDateParseHandling, FloatParseHandling? previousFloatParseHandling, int? previousMaxDepth, string? previousDateFormatString)\n        {\n            // reset reader back to previous options\n            if (previousCulture != null)\n            {\n                reader.Culture = previousCulture;\n            }\n            if (previousDateTimeZoneHandling != null)\n            {\n                reader.DateTimeZoneHandling = previousDateTimeZoneHandling.GetValueOrDefault();\n            }\n            if (previousDateParseHandling != null)\n            {\n                reader.DateParseHandling = previousDateParseHandling.GetValueOrDefault();\n            }\n            if (previousFloatParseHandling != null)\n            {\n                reader.FloatParseHandling = previousFloatParseHandling.GetValueOrDefault();\n            }\n            if (_maxDepthSet)\n            {\n                reader.MaxDepth = previousMaxDepth;\n            }\n            if (_dateFormatStringSet)\n            {\n                reader.DateFormatString = previousDateFormatString;\n            }\n\n            if (reader is JsonTextReader textReader && textReader.PropertyNameTable != null &&\n                _contractResolver is DefaultContractResolver resolver && textReader.PropertyNameTable == resolver.GetNameTable())\n            {\n                textReader.PropertyNameTable = null;\n            }\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"TextWriter\"/>.\n        /// </summary>\n        /// <param name=\"textWriter\">The <see cref=\"TextWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        public void Serialize(TextWriter textWriter, object? value)\n        {\n            Serialize(new JsonTextWriter(textWriter), value);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"JsonWriter\"/>.\n        /// </summary>\n        /// <param name=\"jsonWriter\">The <see cref=\"JsonWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        /// <param name=\"objectType\">\n        /// The type of the value being serialized.\n        /// This parameter is used when <see cref=\"JsonSerializer.TypeNameHandling\"/> is <see cref=\"Json.TypeNameHandling.Auto\"/> to write out the type name if the type of the value does not match.\n        /// Specifying the type is optional.\n        /// </param>\n        public void Serialize(JsonWriter jsonWriter, object? value, Type? objectType)\n        {\n            SerializeInternal(jsonWriter, value, objectType);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"TextWriter\"/>.\n        /// </summary>\n        /// <param name=\"textWriter\">The <see cref=\"TextWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        /// <param name=\"objectType\">\n        /// The type of the value being serialized.\n        /// This parameter is used when <see cref=\"TypeNameHandling\"/> is Auto to write out the type name if the type of the value does not match.\n        /// Specifying the type is optional.\n        /// </param>\n        public void Serialize(TextWriter textWriter, object? value, Type objectType)\n        {\n            Serialize(new JsonTextWriter(textWriter), value, objectType);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"JsonWriter\"/>.\n        /// </summary>\n        /// <param name=\"jsonWriter\">The <see cref=\"JsonWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        public void Serialize(JsonWriter jsonWriter, object? value)\n        {\n            SerializeInternal(jsonWriter, value, null);\n        }\n\n        private TraceJsonReader CreateTraceJsonReader(JsonReader reader)\n        {\n            TraceJsonReader traceReader = new TraceJsonReader(reader);\n            if (reader.TokenType != JsonToken.None)\n            {\n                traceReader.WriteCurrentToken();\n            }\n\n            return traceReader;\n        }\n\n        internal virtual void SerializeInternal(JsonWriter jsonWriter, object? value, Type? objectType)\n        {\n            ValidationUtils.ArgumentNotNull(jsonWriter, nameof(jsonWriter));\n\n            // set serialization options onto writer\n            Formatting? previousFormatting = null;\n            if (_formatting != null && jsonWriter.Formatting != _formatting)\n            {\n                previousFormatting = jsonWriter.Formatting;\n                jsonWriter.Formatting = _formatting.GetValueOrDefault();\n            }\n\n            DateFormatHandling? previousDateFormatHandling = null;\n            if (_dateFormatHandling != null && jsonWriter.DateFormatHandling != _dateFormatHandling)\n            {\n                previousDateFormatHandling = jsonWriter.DateFormatHandling;\n                jsonWriter.DateFormatHandling = _dateFormatHandling.GetValueOrDefault();\n            }\n\n            DateTimeZoneHandling? previousDateTimeZoneHandling = null;\n            if (_dateTimeZoneHandling != null && jsonWriter.DateTimeZoneHandling != _dateTimeZoneHandling)\n            {\n                previousDateTimeZoneHandling = jsonWriter.DateTimeZoneHandling;\n                jsonWriter.DateTimeZoneHandling = _dateTimeZoneHandling.GetValueOrDefault();\n            }\n\n            FloatFormatHandling? previousFloatFormatHandling = null;\n            if (_floatFormatHandling != null && jsonWriter.FloatFormatHandling != _floatFormatHandling)\n            {\n                previousFloatFormatHandling = jsonWriter.FloatFormatHandling;\n                jsonWriter.FloatFormatHandling = _floatFormatHandling.GetValueOrDefault();\n            }\n\n            StringEscapeHandling? previousStringEscapeHandling = null;\n            if (_stringEscapeHandling != null && jsonWriter.StringEscapeHandling != _stringEscapeHandling)\n            {\n                previousStringEscapeHandling = jsonWriter.StringEscapeHandling;\n                jsonWriter.StringEscapeHandling = _stringEscapeHandling.GetValueOrDefault();\n            }\n\n            CultureInfo? previousCulture = null;\n            if (_culture != null && !_culture.Equals(jsonWriter.Culture))\n            {\n                previousCulture = jsonWriter.Culture;\n                jsonWriter.Culture = _culture;\n            }\n\n            string? previousDateFormatString = null;\n            if (_dateFormatStringSet && jsonWriter.DateFormatString != _dateFormatString)\n            {\n                previousDateFormatString = jsonWriter.DateFormatString;\n                jsonWriter.DateFormatString = _dateFormatString;\n            }\n\n            TraceJsonWriter? traceJsonWriter = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? new TraceJsonWriter(jsonWriter)\n                : null;\n\n            JsonSerializerInternalWriter serializerWriter = new JsonSerializerInternalWriter(this);\n            serializerWriter.Serialize(traceJsonWriter ?? jsonWriter, value, objectType);\n\n            if (traceJsonWriter != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonWriter.GetSerializedJsonMessage(), null);\n            }\n\n            // reset writer back to previous options\n            if (previousFormatting != null)\n            {\n                jsonWriter.Formatting = previousFormatting.GetValueOrDefault();\n            }\n            if (previousDateFormatHandling != null)\n            {\n                jsonWriter.DateFormatHandling = previousDateFormatHandling.GetValueOrDefault();\n            }\n            if (previousDateTimeZoneHandling != null)\n            {\n                jsonWriter.DateTimeZoneHandling = previousDateTimeZoneHandling.GetValueOrDefault();\n            }\n            if (previousFloatFormatHandling != null)\n            {\n                jsonWriter.FloatFormatHandling = previousFloatFormatHandling.GetValueOrDefault();\n            }\n            if (previousStringEscapeHandling != null)\n            {\n                jsonWriter.StringEscapeHandling = previousStringEscapeHandling.GetValueOrDefault();\n            }\n            if (_dateFormatStringSet)\n            {\n                jsonWriter.DateFormatString = previousDateFormatString;\n            }\n            if (previousCulture != null)\n            {\n                jsonWriter.Culture = previousCulture;\n            }\n        }\n\n        internal IReferenceResolver GetReferenceResolver()\n        {\n            if (_referenceResolver == null)\n            {\n                _referenceResolver = new DefaultReferenceResolver();\n            }\n\n            return _referenceResolver;\n        }\n\n        internal JsonConverter? GetMatchingConverter(Type type)\n        {\n            return GetMatchingConverter(_converters, type);\n        }\n\n        internal static JsonConverter? GetMatchingConverter(IList<JsonConverter>? converters, Type objectType)\n        {\n#if DEBUG\n            ValidationUtils.ArgumentNotNull(objectType, nameof(objectType));\n#endif\n\n            if (converters != null)\n            {\n                for (int i = 0; i < converters.Count; i++)\n                {\n                    JsonConverter converter = converters[i];\n\n                    if (converter.CanConvert(objectType))\n                    {\n                        return converter;\n                    }\n                }\n            }\n\n            return null;\n        }\n\n        internal void OnError(ErrorEventArgs e)\n        {\n            Error?.Invoke(this, e);\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections;\nusing System.Collections.Generic;\nusing System.Globalization;\nusing System.Runtime.Serialization.Formatters;\nusing Newtonsoft.Json.Serialization;\nusing System.Runtime.Serialization;\nusing System.Diagnostics;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Specifies the settings on a <see cref=\"JsonSerializer\"/> object.\n    /// </summary>\n    public class JsonSerializerSettings\n    {\n        internal const ReferenceLoopHandling DefaultReferenceLoopHandling = ReferenceLoopHandling.Error;\n        internal const MissingMemberHandling DefaultMissingMemberHandling = MissingMemberHandling.Ignore;\n        internal const NullValueHandling DefaultNullValueHandling = NullValueHandling.Include;\n        internal const DefaultValueHandling DefaultDefaultValueHandling = DefaultValueHandling.Include;\n        internal const ObjectCreationHandling DefaultObjectCreationHandling = ObjectCreationHandling.Auto;\n        internal const PreserveReferencesHandling DefaultPreserveReferencesHandling = PreserveReferencesHandling.None;\n        internal const ConstructorHandling DefaultConstructorHandling = ConstructorHandling.Default;\n        internal const TypeNameHandling DefaultTypeNameHandling = TypeNameHandling.None;\n        internal const MetadataPropertyHandling DefaultMetadataPropertyHandling = MetadataPropertyHandling.Default;\n        internal static readonly StreamingContext DefaultContext;\n\n        internal const Formatting DefaultFormatting = Formatting.None;\n        internal const DateFormatHandling DefaultDateFormatHandling = DateFormatHandling.IsoDateFormat;\n        internal const DateTimeZoneHandling DefaultDateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind;\n        internal const DateParseHandling DefaultDateParseHandling = DateParseHandling.DateTime;\n        internal const FloatParseHandling DefaultFloatParseHandling = FloatParseHandling.Double;\n        internal const FloatFormatHandling DefaultFloatFormatHandling = FloatFormatHandling.String;\n        internal const StringEscapeHandling DefaultStringEscapeHandling = StringEscapeHandling.Default;\n        internal const TypeNameAssemblyFormatHandling DefaultTypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n        internal static readonly CultureInfo DefaultCulture;\n        internal const bool DefaultCheckAdditionalContent = false;\n        internal const string DefaultDateFormatString = @\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\";\n\n        internal Formatting? _formatting;\n        internal DateFormatHandling? _dateFormatHandling;\n        internal DateTimeZoneHandling? _dateTimeZoneHandling;\n        internal DateParseHandling? _dateParseHandling;\n        internal FloatFormatHandling? _floatFormatHandling;\n        internal FloatParseHandling? _floatParseHandling;\n        internal StringEscapeHandling? _stringEscapeHandling;\n        internal CultureInfo? _culture;\n        internal bool? _checkAdditionalContent;\n        internal int? _maxDepth;\n        internal bool _maxDepthSet;\n        internal string? _dateFormatString;\n        internal bool _dateFormatStringSet;\n        internal TypeNameAssemblyFormatHandling? _typeNameAssemblyFormatHandling;\n        internal DefaultValueHandling? _defaultValueHandling;\n        internal PreserveReferencesHandling? _preserveReferencesHandling;\n        internal NullValueHandling? _nullValueHandling;\n        internal ObjectCreationHandling? _objectCreationHandling;\n        internal MissingMemberHandling? _missingMemberHandling;\n        internal ReferenceLoopHandling? _referenceLoopHandling;\n        internal StreamingContext? _context;\n        internal ConstructorHandling? _constructorHandling;\n        internal TypeNameHandling? _typeNameHandling;\n        internal MetadataPropertyHandling? _metadataPropertyHandling;\n\n        /// <summary>\n        /// Gets or sets how reference loops (e.g. a class referencing itself) are handled.\n        /// The default value is <see cref=\"Json.ReferenceLoopHandling.Error\" />.\n        /// </summary>\n        /// <value>Reference loop handling.</value>\n        public ReferenceLoopHandling ReferenceLoopHandling\n        {\n            get => _referenceLoopHandling ?? DefaultReferenceLoopHandling;\n            set => _referenceLoopHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how missing members (e.g. JSON contains a property that isn't a member on the object) are handled during deserialization.\n        /// The default value is <see cref=\"Json.MissingMemberHandling.Ignore\" />.\n        /// </summary>\n        /// <value>Missing member handling.</value>\n        public MissingMemberHandling MissingMemberHandling\n        {\n            get => _missingMemberHandling ?? DefaultMissingMemberHandling;\n            set => _missingMemberHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how objects are created during deserialization.\n        /// The default value is <see cref=\"Json.ObjectCreationHandling.Auto\" />.\n        /// </summary>\n        /// <value>The object creation handling.</value>\n        public ObjectCreationHandling ObjectCreationHandling\n        {\n            get => _objectCreationHandling ?? DefaultObjectCreationHandling;\n            set => _objectCreationHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how null values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.NullValueHandling.Include\" />.\n        /// </summary>\n        /// <value>Null value handling.</value>\n        public NullValueHandling NullValueHandling\n        {\n            get => _nullValueHandling ?? DefaultNullValueHandling;\n            set => _nullValueHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how default values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DefaultValueHandling.Include\" />.\n        /// </summary>\n        /// <value>The default value handling.</value>\n        public DefaultValueHandling DefaultValueHandling\n        {\n            get => _defaultValueHandling ?? DefaultDefaultValueHandling;\n            set => _defaultValueHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets a <see cref=\"JsonConverter\"/> collection that will be used during serialization.\n        /// </summary>\n        /// <value>The converters.</value>\n        public IList<JsonConverter> Converters { get; set; }\n\n        /// <summary>\n        /// Gets or sets how object references are preserved by the serializer.\n        /// The default value is <see cref=\"Json.PreserveReferencesHandling.None\" />.\n        /// </summary>\n        /// <value>The preserve references handling.</value>\n        public PreserveReferencesHandling PreserveReferencesHandling\n        {\n            get => _preserveReferencesHandling ?? DefaultPreserveReferencesHandling;\n            set => _preserveReferencesHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how type name writing and reading is handled by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameHandling.None\" />.\n        /// </summary>\n        /// <remarks>\n        /// <see cref=\"JsonSerializerSettings.TypeNameHandling\"/> should be used with caution when your application deserializes JSON from an external source.\n        /// Incoming types should be validated with a custom <see cref=\"JsonSerializerSettings.SerializationBinder\"/>\n        /// when deserializing with a value other than <see cref=\"Json.TypeNameHandling.None\"/>.\n        /// </remarks>\n        /// <value>The type name handling.</value>\n        public TypeNameHandling TypeNameHandling\n        {\n            get => _typeNameHandling ?? DefaultTypeNameHandling;\n            set => _typeNameHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how metadata properties are used during deserialization.\n        /// The default value is <see cref=\"Json.MetadataPropertyHandling.Default\" />.\n        /// </summary>\n        /// <value>The metadata properties handling.</value>\n        public MetadataPropertyHandling MetadataPropertyHandling\n        {\n            get => _metadataPropertyHandling ?? DefaultMetadataPropertyHandling;\n            set => _metadataPropertyHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"FormatterAssemblyStyle.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        [Obsolete(\"TypeNameAssemblyFormat is obsolete. Use TypeNameAssemblyFormatHandling instead.\")]\n        public FormatterAssemblyStyle TypeNameAssemblyFormat\n        {\n            get => (FormatterAssemblyStyle)TypeNameAssemblyFormatHandling;\n            set => TypeNameAssemblyFormatHandling = (TypeNameAssemblyFormatHandling)value;\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameAssemblyFormatHandling.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        public TypeNameAssemblyFormatHandling TypeNameAssemblyFormatHandling\n        {\n            get => _typeNameAssemblyFormatHandling ?? DefaultTypeNameAssemblyFormatHandling;\n            set => _typeNameAssemblyFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how constructors are used during deserialization.\n        /// The default value is <see cref=\"Json.ConstructorHandling.Default\" />.\n        /// </summary>\n        /// <value>The constructor handling.</value>\n        public ConstructorHandling ConstructorHandling\n        {\n            get => _constructorHandling ?? DefaultConstructorHandling;\n            set => _constructorHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the contract resolver used by the serializer when\n        /// serializing .NET objects to JSON and vice versa.\n        /// </summary>\n        /// <value>The contract resolver.</value>\n        public IContractResolver? ContractResolver { get; set; }\n\n        /// <summary>\n        /// Gets or sets the equality comparer used by the serializer when comparing references.\n        /// </summary>\n        /// <value>The equality comparer.</value>\n        public IEqualityComparer? EqualityComparer { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        /// <value>The reference resolver.</value>\n        [Obsolete(\"ReferenceResolver property is obsolete. Use the ReferenceResolverProvider property to set the IReferenceResolver: settings.ReferenceResolverProvider = () => resolver\")]\n        public IReferenceResolver? ReferenceResolver\n        {\n            get => ReferenceResolverProvider?.Invoke();\n            set\n            {\n                ReferenceResolverProvider = (value != null)\n                    ? () => value\n                    : (Func<IReferenceResolver?>?)null;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets a function that creates the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        /// <value>A function that creates the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.</value>\n        public Func<IReferenceResolver?>? ReferenceResolverProvider { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ITraceWriter\"/> used by the serializer when writing trace messages.\n        /// </summary>\n        /// <value>The trace writer.</value>\n        public ITraceWriter? TraceWriter { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"SerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        /// <value>The binder.</value>\n        [Obsolete(\"Binder is obsolete. Use SerializationBinder instead.\")]\n        public SerializationBinder? Binder\n        {\n            get\n            {\n                if (SerializationBinder == null)\n                {\n                    return null;\n                }\n\n                if (SerializationBinder is SerializationBinderAdapter adapter)\n                {\n                    return adapter.SerializationBinder;\n                }\n\n                throw new InvalidOperationException(\"Cannot get SerializationBinder because an ISerializationBinder was previously set.\");\n            }\n            set => SerializationBinder = value == null ? null : new SerializationBinderAdapter(value);\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ISerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        /// <value>The binder.</value>\n        public ISerializationBinder? SerializationBinder { get; set; }\n\n        /// <summary>\n        /// Gets or sets the error handler called during serialization and deserialization.\n        /// </summary>\n        /// <value>The error handler called during serialization and deserialization.</value>\n        public EventHandler<ErrorEventArgs>? Error { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"StreamingContext\"/> used by the serializer when invoking serialization callback methods.\n        /// </summary>\n        /// <value>The context.</value>\n        public StreamingContext Context\n        {\n            get => _context ?? DefaultContext;\n            set => _context = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> and <see cref=\"DateTimeOffset\"/> values are formatted when writing JSON text,\n        /// and the expected date format when reading JSON text.\n        /// The default value is <c>\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\"</c>.\n        /// </summary>\n        public string DateFormatString\n        {\n            get => _dateFormatString ?? DefaultDateFormatString;\n            set\n            {\n                _dateFormatString = value;\n                _dateFormatStringSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// A null value means there is no maximum.\n        /// The default value is <c>null</c>.\n        /// </summary>\n        public int? MaxDepth\n        {\n            get => _maxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n                _maxDepthSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Indicates how JSON text output is formatted.\n        /// The default value is <see cref=\"Json.Formatting.None\" />.\n        /// </summary>\n        public Formatting Formatting\n        {\n            get => _formatting ?? DefaultFormatting;\n            set => _formatting = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how dates are written to JSON text.\n        /// The default value is <see cref=\"Json.DateFormatHandling.IsoDateFormat\" />.\n        /// </summary>\n        public DateFormatHandling DateFormatHandling\n        {\n            get => _dateFormatHandling ?? DefaultDateFormatHandling;\n            set => _dateFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DateTimeZoneHandling.RoundtripKind\" />.\n        /// </summary>\n        public DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling ?? DefaultDateTimeZoneHandling;\n            set => _dateTimeZoneHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. <c>\"\\/Date(1198908717056)\\/\"</c> and <c>\"2012-03-21T05:40Z\"</c>, are parsed when reading JSON.\n        /// The default value is <see cref=\"Json.DateParseHandling.DateTime\" />.\n        /// </summary>\n        public DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling ?? DefaultDateParseHandling;\n            set => _dateParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how special floating point numbers, e.g. <see cref=\"Double.NaN\"/>,\n        /// <see cref=\"Double.PositiveInfinity\"/> and <see cref=\"Double.NegativeInfinity\"/>,\n        /// are written as JSON.\n        /// The default value is <see cref=\"Json.FloatFormatHandling.String\" />.\n        /// </summary>\n        public FloatFormatHandling FloatFormatHandling\n        {\n            get => _floatFormatHandling ?? DefaultFloatFormatHandling;\n            set => _floatFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// The default value is <see cref=\"Json.FloatParseHandling.Double\" />.\n        /// </summary>\n        public FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling ?? DefaultFloatParseHandling;\n            set => _floatParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how strings are escaped when writing JSON text.\n        /// The default value is <see cref=\"Json.StringEscapeHandling.Default\" />.\n        /// </summary>\n        public StringEscapeHandling StringEscapeHandling\n        {\n            get => _stringEscapeHandling ?? DefaultStringEscapeHandling;\n            set => _stringEscapeHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON.\n        /// The default value is <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public CultureInfo Culture\n        {\n            get => _culture ?? DefaultCulture;\n            set => _culture = value;\n        }\n\n        /// <summary>\n        /// Gets a value indicating whether there will be a check for additional content after deserializing an object.\n        /// The default value is <c>false</c>.\n        /// </summary>\n        /// <value>\n        /// \t<c>true</c> if there will be a check for additional content after deserializing an object; otherwise, <c>false</c>.\n        /// </value>\n        public bool CheckAdditionalContent\n        {\n            get => _checkAdditionalContent ?? DefaultCheckAdditionalContent;\n            set => _checkAdditionalContent = value;\n        }\n\n        static JsonSerializerSettings()\n        {\n            DefaultContext = new StreamingContext();\n            DefaultCulture = CultureInfo.InvariantCulture;\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonSerializerSettings\"/> class.\n        /// </summary>\n        [DebuggerStepThrough]\n        public JsonSerializerSettings()\n        {\n            Converters = new List<JsonConverter>();\n        }\n    }\n}"], "fixing_code": ["#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.ComponentModel;\n#if !(NET35 || NET20)\nusing System.Collections.Concurrent;\n#endif\nusing System.Collections.Generic;\n#if !(NET20 || NET35 || PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\nusing System.Numerics;\n#endif\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\nusing System.ComponentModel.DataAnnotations;\nusing System.Configuration;\nusing System.Runtime.CompilerServices;\nusing System.Runtime.Serialization.Formatters;\nusing System.Threading;\n#endif\n#if !(NET20 || DNXCORE50)\nusing System.Web.Script.Serialization;\n#endif\nusing System.Text;\nusing System.Text.RegularExpressions;\n#if DNXCORE50\nusing Xunit;\nusing Test = Xunit.FactAttribute;\nusing Assert = Newtonsoft.Json.Tests.XUnitAssert;\n#else\nusing NUnit.Framework;\n#endif\nusing Newtonsoft.Json;\nusing System.IO;\nusing System.Collections;\nusing System.Xml;\nusing System.Xml.Serialization;\nusing System.Collections.ObjectModel;\nusing System.Diagnostics;\nusing Newtonsoft.Json.Bson;\nusing Newtonsoft.Json.Linq;\nusing Newtonsoft.Json.Converters;\n#if !(NET20 || NET35)\nusing System.Runtime.Serialization.Json;\n#endif\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Tests.Linq;\nusing Newtonsoft.Json.Tests.TestObjects;\nusing Newtonsoft.Json.Tests.TestObjects.Events;\nusing Newtonsoft.Json.Tests.TestObjects.GeoCoding;\nusing Newtonsoft.Json.Tests.TestObjects.Organization;\nusing System.Runtime.Serialization;\nusing System.Globalization;\nusing Newtonsoft.Json.Utilities;\nusing System.Reflection;\n#if !NET20\nusing System.Xml.Linq;\nusing System.Collections.Specialized;\nusing System.Linq.Expressions;\n#endif\n#if !(NET35 || NET20)\nusing System.Dynamic;\n#endif\n#if NET20\nusing Newtonsoft.Json.Utilities.LinqBridge;\nusing Action = Newtonsoft.Json.Serialization.Action;\n#else\nusing System.Linq;\n#endif\n#if !(DNXCORE50)\nusing System.Drawing;\n\n#endif\n\nnamespace Newtonsoft.Json.Tests.Serialization\n{\n    [TestFixture]\n    public class JsonSerializerTest : TestFixtureBase\n    {\n        [Test]\n        public void ListSourceSerialize()\n        {\n            ListSourceTest c = new ListSourceTest();\n            c.strprop = \"test\";\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(@\"{\"\"strprop\"\":\"\"test\"\"}\", json);\n\n            ListSourceTest c2 = JsonConvert.DeserializeObject<ListSourceTest>(json);\n\n            Assert.AreEqual(\"test\", c2.strprop);\n        }\n\n        [Test]\n        public void DeserializeImmutableStruct()\n        {\n            var result = JsonConvert.DeserializeObject<ImmutableStruct>(\"{ \\\"Value\\\": \\\"working\\\", \\\"Value2\\\": 2 }\");\n\n            Assert.AreEqual(\"working\", result.Value);\n            Assert.AreEqual(2, result.Value2);\n        }\n\n        public struct AlmostImmutableStruct\n        {\n            public AlmostImmutableStruct(string value, int value2)\n            {\n                Value = value;\n                Value2 = value2;\n            }\n\n            public string Value { get; }\n            public int Value2 { get; set; }\n        }\n\n        [Test]\n        public void DeserializeAlmostImmutableStruct()\n        {\n            var result = JsonConvert.DeserializeObject<AlmostImmutableStruct>(\"{ \\\"Value\\\": \\\"working\\\", \\\"Value2\\\": 2 }\");\n\n            Assert.AreEqual(null, result.Value);\n            Assert.AreEqual(2, result.Value2);\n        }\n\n        [Test]\n        public void DontCloseInputOnDeserializeError()\n        {\n            using (var s = System.IO.File.OpenRead(ResolvePath(\"large.json\")))\n            {\n                try\n                {\n                    using (JsonTextReader reader = new JsonTextReader(new StreamReader(s)))\n                    {\n                        reader.SupportMultipleContent = true;\n                        reader.CloseInput = false;\n\n                        // read into array\n                        reader.Read();\n\n                        var ser = new JsonSerializer();\n                        ser.CheckAdditionalContent = false;\n\n                        ser.Deserialize<IList<ErroringClass>>(reader);\n                    }\n\n                    Assert.Fail();\n                }\n                catch (Exception)\n                {\n                    Assert.IsTrue(s.Position > 0);\n\n                    s.Seek(0, SeekOrigin.Begin);\n\n                    Assert.AreEqual(0, s.Position);\n                }\n            }\n        }\n\n        [Test]\n        public void SerializeInterfaceWithHiddenProperties()\n        {\n            var mySubclass = MyFactory.InstantiateSubclass();\n            var myMainClass = MyFactory.InstantiateManiClass();\n\n            //Class implementing interface with hidden members - flat object. \n            var strJsonSubclass = JsonConvert.SerializeObject(mySubclass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"ID\"\": 123,\n  \"\"Name\"\": \"\"ABC\"\",\n  \"\"P1\"\": true,\n  \"\"P2\"\": 44\n}\", strJsonSubclass);\n\n            //Class implementing interface with hidden members - member of another class. \n            var strJsonMainClass = JsonConvert.SerializeObject(myMainClass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"ID\"\": 567,\n  \"\"Name\"\": \"\"XYZ\"\",\n  \"\"Subclass\"\": {\n    \"\"ID\"\": 123,\n    \"\"Name\"\": \"\"ABC\"\",\n    \"\"P1\"\": true,\n    \"\"P2\"\": 44\n  }\n}\", strJsonMainClass);\n        }\n\n        [Test]\n        public void DeserializeGenericIEnumerableWithImplicitConversion()\n        {\n            string deserialized = @\"{\n  \"\"Enumerable\"\": [ \"\"abc\"\", \"\"def\"\" ] \n}\";\n            var enumerableClass = JsonConvert.DeserializeObject<GenericIEnumerableWithImplicitConversion>(deserialized);\n            var enumerableObject = enumerableClass.Enumerable.ToArray();\n            Assert.AreEqual(2, enumerableObject.Length);\n            Assert.AreEqual(\"abc\", enumerableObject[0].Value);\n            Assert.AreEqual(\"def\", enumerableObject[1].Value);\n        }\n\n#if !(PORTABLE || PORTABLE40 || NET20 || NET35) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void LargeIntegerAsString()\n        {\n            var largeBrokenNumber = JsonConvert.DeserializeObject<Foo64>(\"{\\\"Blah\\\": 43443333222211111117 }\");\n            Assert.AreEqual(\"43443333222211111117\", largeBrokenNumber.Blah);\n\n            var largeOddWorkingNumber = JsonConvert.DeserializeObject<Foo64>(\"{\\\"Blah\\\": 53443333222211111117 }\");\n            Assert.AreEqual(\"53443333222211111117\", largeOddWorkingNumber.Blah);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void DeserializeMSDateTimeOffset()\n        {\n            DateTimeOffset d = JsonConvert.DeserializeObject<DateTimeOffset>(@\"\"\"/Date(1418924498000+0800)/\"\"\");\n            long initialTicks = DateTimeUtils.ConvertDateTimeToJavaScriptTicks(d.DateTime, d.Offset);\n\n            Assert.AreEqual(1418924498000, initialTicks);\n            Assert.AreEqual(8, d.Offset.Hours);\n        }\n#endif\n\n        [Test]\n        public void DeserializeBoolean_Null()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"[null]\"),\n                \"Error converting value {null} to type 'System.Boolean'. Path '[0]', line 1, position 5.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_DateTime()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['2000-12-20T10:55:55Z']\"),\n                \"Could not convert string to boolean: 2000-12-20T10:55:55Z. Path '[0]', line 1, position 23.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_BadString()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['pie']\"),\n                @\"Could not convert string to boolean: pie. Path '[0]', line 1, position 6.\");\n        }\n\n        [Test]\n        public void DeserializeBoolean_EmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<bool>>(@\"['']\"),\n                @\"Error converting value {null} to type 'System.Boolean'. Path '[0]', line 1, position 3.\");\n        }\n\n#if !(PORTABLE || PORTABLE40 || NET35 || NET20) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeBooleans()\n        {\n            IList<bool> l = JsonConvert.DeserializeObject<IList<bool>>(@\"[\n  1,\n  0,\n  1.1,\n  0.0,\n  0.000000000001,\n  9999999999,\n  -9999999999,\n  9999999999999999999999999999999999999999999999999999999999999999999999,\n  -9999999999999999999999999999999999999999999999999999999999999999999999,\n  'true',\n  'TRUE',\n  'false',\n  'FALSE'\n]\");\n\n            int i = 0;\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n        }\n\n        [Test]\n        public void DeserializeNullableBooleans()\n        {\n            IList<bool?> l = JsonConvert.DeserializeObject<IList<bool?>>(@\"[\n  1,\n  0,\n  1.1,\n  0.0,\n  0.000000000001,\n  9999999999,\n  -9999999999,\n  9999999999999999999999999999999999999999999999999999999999999999999999,\n  -9999999999999999999999999999999999999999999999999999999999999999999999,\n  'true',\n  'TRUE',\n  'false',\n  'FALSE',\n  '',\n  null\n]\");\n\n            int i = 0;\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(true, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(false, l[i++]);\n            Assert.AreEqual(null, l[i++]);\n            Assert.AreEqual(null, l[i++]);\n        }\n#endif\n\n        [Test]\n        public void CaseInsensitiveRequiredPropertyConstructorCreation()\n        {\n            FooRequired foo1 = new FooRequired(new[] { \"A\", \"B\", \"C\" });\n            string json = JsonConvert.SerializeObject(foo1);\n\n            StringAssert.AreEqual(@\"{\"\"Bars\"\":[\"\"A\"\",\"\"B\"\",\"\"C\"\"]}\", json);\n\n            FooRequired foo2 = JsonConvert.DeserializeObject<FooRequired>(json);\n            Assert.AreEqual(foo1.Bars.Count, foo2.Bars.Count);\n            Assert.AreEqual(foo1.Bars[0], foo2.Bars[0]);\n            Assert.AreEqual(foo1.Bars[1], foo2.Bars[1]);\n            Assert.AreEqual(foo1.Bars[2], foo2.Bars[2]);\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequired()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Binding>(\"{requiredProperty:''}\"); }, \"Required property 'RequiredProperty' expects a value but got null. Path '', line 1, position 21.\");\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequired_DisallowNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Binding_DisallowNull>(\"{requiredProperty:''}\"); }, \"Required property 'RequiredProperty' expects a non-null value. Path '', line 1, position 21.\");\n        }\n\n        [Test]\n        public void DisallowNull_NoValue()\n        {\n            Binding_DisallowNull o = JsonConvert.DeserializeObject<Binding_DisallowNull>(\"{}\");\n            Assert.IsNull(o.RequiredProperty);\n        }\n\n        [Test]\n        public void CoercedEmptyStringWithRequiredConstructor()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<FooRequired>(\"{Bars:''}\"); }, \"Required property 'Bars' expects a value but got null. Path '', line 1, position 9.\");\n        }\n\n        [Test]\n        public void NoErrorWhenValueDoesNotMatchIgnoredProperty()\n        {\n            IgnoredProperty p = JsonConvert.DeserializeObject<IgnoredProperty>(\"{'StringProp1':[1,2,3],'StringProp2':{}}\");\n            Assert.IsNull(p.StringProp1);\n            Assert.IsNull(p.StringProp2);\n        }\n\n        [Test]\n        public void Serialize_Required_DisallowedNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new Binding_DisallowNull()); }, \"Cannot write a null value for property 'RequiredProperty'. Property requires a non-null value. Path ''.\");\n        }\n\n        [Test]\n        public void Serialize_Required_DisallowedNull_NullValueHandlingIgnore()\n        {\n            string json = JsonConvert.SerializeObject(new Binding_DisallowNull(), new JsonSerializerSettings\n            {\n                NullValueHandling = NullValueHandling.Ignore\n            });\n            Assert.AreEqual(\"{}\", json);\n        }\n\n        [Test]\n        public void Serialize_ItemRequired_DisallowedNull()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new DictionaryWithNoNull()); }, \"Cannot write a null value for property 'Name'. Property requires a non-null value. Path ''.\");\n        }\n\n        [Test]\n        public void DictionaryKeyContractResolverTest()\n        {\n            var person = new\n            {\n                Name = \"James\",\n                Age = 1,\n                RoleNames = new Dictionary<string, bool>\n                {\n                    { \"IsAdmin\", true },\n                    { \"IsModerator\", false }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(person, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = new DictionaryKeyContractResolver()\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"NAME\"\": \"\"James\"\",\n  \"\"AGE\"\": 1,\n  \"\"ROLENAMES\"\": {\n    \"\"IsAdmin\"\": true,\n    \"\"IsModerator\"\": false\n  }\n}\", json);\n        }\n\n        [Test]\n        public void IncompleteContainers()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<object>>(\"[1,\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 3.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<int>>(\"[1,\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 3.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IList<int>>(\"[1\"),\n                \"Unexpected end when deserializing array. Path '[0]', line 1, position 2.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IDictionary<string, int>>(\"{'key':1,\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 9.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IDictionary<string, int>>(\"{'key':1\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 8.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IncompleteTestClass>(\"{'key':1,\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 9.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<IncompleteTestClass>(\"{'key':1\"),\n                \"Unexpected end when deserializing object. Path 'key', line 1, position 8.\");\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeEnumsByName()\n        {\n            var e1 = JsonConvert.DeserializeObject<EnumA>(\"'ValueA'\");\n            Assert.AreEqual(EnumA.ValueA, e1);\n\n            var e2 = JsonConvert.DeserializeObject<EnumA>(\"'value_a'\", new StringEnumConverter());\n            Assert.AreEqual(EnumA.ValueA, e2);\n        }\n#endif\n\n        [Test]\n        public void RequiredPropertyTest()\n        {\n            RequiredPropertyTestClass c1 = new RequiredPropertyTestClass();\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.SerializeObject(c1),\n                \"Cannot write a null value for property 'Name'. Property requires a value. Path ''.\");\n\n            RequiredPropertyTestClass c2 = new RequiredPropertyTestClass\n            {\n                Name = \"Name!\"\n            };\n\n            string json = JsonConvert.SerializeObject(c2);\n\n            Assert.AreEqual(@\"{\"\"Name\"\":\"\"Name!\"\"}\", json);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{}\"),\n                \"Required property 'Name' not found in JSON. Path '', line 1, position 2.\");\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{\"\"Name\"\":null}\"),\n                \"Required property 'Name' expects a value but got null. Path '', line 1, position 13.\");\n\n            RequiredPropertyTestClass c3 = JsonConvert.DeserializeObject<RequiredPropertyTestClass>(@\"{\"\"Name\"\":\"\"Name!\"\"}\");\n\n            Assert.AreEqual(\"Name!\", c3.Name);\n        }\n\n        [Test]\n        public void RequiredPropertyConstructorTest()\n        {\n            RequiredPropertyConstructorTestClass c1 = new RequiredPropertyConstructorTestClass(null);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.SerializeObject(c1),\n                \"Cannot write a null value for property 'Name'. Property requires a value. Path ''.\");\n\n            RequiredPropertyConstructorTestClass c2 = new RequiredPropertyConstructorTestClass(\"Name!\");\n\n            string json = JsonConvert.SerializeObject(c2);\n\n            Assert.AreEqual(@\"{\"\"Name\"\":\"\"Name!\"\"}\", json);\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => JsonConvert.DeserializeObject<RequiredPropertyConstructorTestClass>(@\"{}\"),\n                \"Required property 'Name' not found in JSON. Path '', line 1, position 2.\");\n\n            RequiredPropertyConstructorTestClass c3 = JsonConvert.DeserializeObject<RequiredPropertyConstructorTestClass>(@\"{\"\"Name\"\":\"\"Name!\"\"}\");\n\n            Assert.AreEqual(\"Name!\", c3.Name);\n        }\n\n        [Test]\n        public void NeverResolveIgnoredPropertyTypes()\n        {\n            Version v = new Version(1, 2, 3, 4);\n\n            IgnoredPropertiesTestClass c1 = new IgnoredPropertiesTestClass\n            {\n                IgnoredProperty = v,\n                IgnoredList = new List<Version>\n                {\n                    v\n                },\n                IgnoredDictionary = new Dictionary<string, Version>\n                {\n                    { \"Value\", v }\n                },\n                Name = \"Name!\"\n            };\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = new IgnoredPropertiesContractResolver()\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": \"\"Name!\"\"\n}\", json);\n\n            string deserializeJson = @\"{\n  \"\"IgnoredList\"\": [\n    {\n      \"\"Major\"\": 1,\n      \"\"Minor\"\": 2,\n      \"\"Build\"\": 3,\n      \"\"Revision\"\": 4,\n      \"\"MajorRevision\"\": 0,\n      \"\"MinorRevision\"\": 4\n    }\n  ],\n  \"\"IgnoredDictionary\"\": {\n    \"\"Value\"\": {\n      \"\"Major\"\": 1,\n      \"\"Minor\"\": 2,\n      \"\"Build\"\": 3,\n      \"\"Revision\"\": 4,\n      \"\"MajorRevision\"\": 0,\n      \"\"MinorRevision\"\": 4\n    }\n  },\n  \"\"Name\"\": \"\"Name!\"\"\n}\";\n\n            IgnoredPropertiesTestClass c2 = JsonConvert.DeserializeObject<IgnoredPropertiesTestClass>(deserializeJson, new JsonSerializerSettings\n            {\n                ContractResolver = new IgnoredPropertiesContractResolver()\n            });\n\n            Assert.AreEqual(\"Name!\", c2.Name);\n        }\n\n#if !(NET20 || NET35 || PORTABLE40)\n        [Test]\n        public void SerializeValueTuple()\n        {\n            ValueTuple<int, int, string> t = ValueTuple.Create(1, 2, \"string\");\n\n            string json = JsonConvert.SerializeObject(t, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Item1\"\": 1,\n  \"\"Item2\"\": 2,\n  \"\"Item3\"\": \"\"string\"\"\n}\", json);\n\n            ValueTuple<int, int, string> t2 = JsonConvert.DeserializeObject<ValueTuple<int, int, string>>(json);\n\n            Assert.AreEqual(1, t2.Item1);\n            Assert.AreEqual(2, t2.Item2);\n            Assert.AreEqual(\"string\", t2.Item3);\n        }\n#endif\n\n        [Test]\n        public void DeserializeStructWithConstructorAttribute()\n        {\n            ImmutableStructWithConstructorAttribute result = JsonConvert.DeserializeObject<ImmutableStructWithConstructorAttribute>(\"{ \\\"Value\\\": \\\"working\\\" }\");\n\n            Assert.AreEqual(\"working\", result.Value);\n        }\n\n        public struct ImmutableStructWithConstructorAttribute\n        {\n            [JsonConstructor]\n            public ImmutableStructWithConstructorAttribute(string value)\n            {\n                Value = value;\n            }\n\n            public string Value { get; }\n        }\n\n#if !(DNXCORE50 || NET20)\n        [Test]\n        public void SerializeMetadataType()\n        {\n            CustomerWithMetadataType c = new CustomerWithMetadataType()\n            {\n                UpdatedBy_Id = Guid.NewGuid()\n            };\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(\"{}\", json);\n\n            CustomerWithMetadataType c2 = JsonConvert.DeserializeObject<CustomerWithMetadataType>(\"{'UpdatedBy_Id':'F6E0666D-13C7-4745-B486-800812C8F6DE'}\");\n\n            Assert.AreEqual(Guid.Empty, c2.UpdatedBy_Id);\n        }\n\n        [Test]\n        public void SerializeMetadataType2()\n        {\n            FaqItem c = new FaqItem()\n            {\n                FaqId = 1,\n                Sections =\n                {\n                    new FaqSection()\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"FaqId\"\": 1,\n  \"\"Name\"\": null,\n  \"\"IsDeleted\"\": false,\n  \"\"FullSectionsProp\"\": [\n    {}\n  ]\n}\", json);\n\n            FaqItem c2 = JsonConvert.DeserializeObject<FaqItem>(json);\n\n            Assert.AreEqual(1, c2.FaqId);\n            Assert.AreEqual(1, c2.Sections.Count);\n        }\n\n        [Test]\n        public void SerializeMetadataTypeInheritance()\n        {\n            FaqItemProxy c = new FaqItemProxy();\n            c.FaqId = 1;\n            c.Sections.Add(new FaqSection());\n            c.IsProxy = true;\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"IsProxy\"\": true,\n  \"\"FaqId\"\": 1,\n  \"\"Name\"\": null,\n  \"\"IsDeleted\"\": false,\n  \"\"FullSectionsProp\"\": [\n    {}\n  ]\n}\", json);\n\n            FaqItemProxy c2 = JsonConvert.DeserializeObject<FaqItemProxy>(json);\n\n            Assert.AreEqual(1, c2.FaqId);\n            Assert.AreEqual(1, c2.Sections.Count);\n        }\n#endif\n\n        [Test]\n        public void DeserializeNullToJTokenProperty()\n        {\n            NullTestClass otc = JsonConvert.DeserializeObject<NullTestClass>(@\"{\n    \"\"Value1\"\": null,\n    \"\"Value2\"\": null,\n    \"\"Value3\"\": null,\n    \"\"Value4\"\": null,\n    \"\"Value5\"\": null\n}\");\n            Assert.IsNull(otc.Value1);\n            Assert.AreEqual(JTokenType.Null, otc.Value2.Type);\n            Assert.AreEqual(JTokenType.Raw, otc.Value3.Type);\n            Assert.AreEqual(JTokenType.Null, otc.Value4.Type);\n            Assert.IsNull(otc.Value5);\n        }\n\n#if !(NET20 || NET35 || PORTABLE40 || PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ReadIntegerWithError()\n        {\n            string json = @\"{\n    ParentId: 1,\n    ChildId: 333333333333333333333333333333333333333\n}\";\n\n            Link l = JsonConvert.DeserializeObject<Link>(json, new JsonSerializerSettings\n            {\n                Error = (s, a) => a.ErrorContext.Handled = true\n            });\n\n            Assert.AreEqual(0, l.ChildId);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void DeserializeObservableCollection()\n        {\n            ObservableCollection<string> s = JsonConvert.DeserializeObject<ObservableCollection<string>>(\"['1','2']\");\n            Assert.AreEqual(2, s.Count);\n            Assert.AreEqual(\"1\", s[0]);\n            Assert.AreEqual(\"2\", s[1]);\n        }\n\n        [Test]\n        public void SerializeObservableCollection()\n        {\n            ObservableCollection<string> c1 = new ObservableCollection<string> { \"1\", \"2\" };\n\n            string output = JsonConvert.SerializeObject(c1);\n            Assert.AreEqual(\"[\\\"1\\\",\\\"2\\\"]\", output);\n\n            ObservableCollection<string> c2 = JsonConvert.DeserializeObject<ObservableCollection<string>>(output);\n            Assert.AreEqual(2, c2.Count);\n            Assert.AreEqual(\"1\", c2[0]);\n            Assert.AreEqual(\"2\", c2[1]);\n        }\n#endif\n\n        [Test]\n        public void DeserializeBoolAsStringInDictionary()\n        {\n            Dictionary<string, string> d = JsonConvert.DeserializeObject<Dictionary<string, string>>(\"{\\\"Test1\\\":false}\");\n            Assert.AreEqual(1, d.Count);\n            Assert.AreEqual(\"false\", d[\"Test1\"]);\n        }\n\n#if !NET20\n        [Test]\n        public void PopulateResetSettings()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(@\"[\"\"2000-01-01T01:01:01+00:00\"\"]\"));\n            Assert.AreEqual(DateParseHandling.DateTime, reader.DateParseHandling);\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.DateParseHandling = DateParseHandling.DateTimeOffset;\n\n            IList<object> l = new List<object>();\n            serializer.Populate(reader, l);\n\n            Assert.AreEqual(typeof(DateTimeOffset), l[0].GetType());\n            Assert.AreEqual(new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero), l[0]);\n\n            Assert.AreEqual(DateParseHandling.DateTime, reader.DateParseHandling);\n        }\n#endif\n\n        [Test]\n        public void NewProperty()\n        {\n            Assert.AreEqual(@\"{\"\"IsTransient\"\":true}\", JsonConvert.SerializeObject(new ChildClass { IsTransient = true }));\n\n            var childClass = JsonConvert.DeserializeObject<ChildClass>(@\"{\"\"IsTransient\"\":true}\");\n            Assert.AreEqual(true, childClass.IsTransient);\n        }\n\n        [Test]\n        public void NewPropertyVirtual()\n        {\n            Assert.AreEqual(@\"{\"\"IsTransient\"\":true}\", JsonConvert.SerializeObject(new ChildClassVirtual { IsTransient = true }));\n\n            var childClass = JsonConvert.DeserializeObject<ChildClassVirtual>(@\"{\"\"IsTransient\"\":true}\");\n            Assert.AreEqual(true, childClass.IsTransient);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgument()\n        {\n            var input = new ResponseWithNewGenericProperty<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericProperty<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgumentVirtual()\n        {\n            var input = new ResponseWithNewGenericPropertyVirtual<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericPropertyVirtual<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializeWithBuiltInTypeAsGenericArgumentOverride()\n        {\n            var input = new ResponseWithNewGenericPropertyOverride<int>()\n            {\n                Message = \"Trying out integer as type parameter\",\n                Data = 25,\n                Result = \"This should be fine\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericPropertyOverride<int>>(json);\n\n            Assert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void CanSerializedWithGenericClosedTypeAsArgument()\n        {\n            var input = new ResponseWithNewGenericProperty<List<int>>()\n            {\n                Message = \"More complex case - generic list of int\",\n                Data = Enumerable.Range(50, 70).ToList(),\n                Result = \"This should be fine too\"\n            };\n\n            var json = JsonConvert.SerializeObject(input);\n            var deserialized = JsonConvert.DeserializeObject<ResponseWithNewGenericProperty<List<int>>>(json);\n\n            CollectionAssert.AreEqual(input.Data, deserialized.Data);\n            Assert.AreEqual(input.Message, deserialized.Message);\n            Assert.AreEqual(input.Result, deserialized.Result);\n        }\n\n        [Test]\n        public void DeserializeVersionString()\n        {\n            string json = \"['1.2.3.4']\";\n            List<Version> deserialized = JsonConvert.DeserializeObject<List<Version>>(json);\n\n            Assert.AreEqual(1, deserialized[0].Major);\n            Assert.AreEqual(2, deserialized[0].Minor);\n            Assert.AreEqual(3, deserialized[0].Build);\n            Assert.AreEqual(4, deserialized[0].Revision);\n        }\n\n        [Test]\n        public void DeserializeVersionString_Fail()\n        {\n            string json = \"['1.2.3.4444444444444444444444']\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<List<Version>>(json); }, @\"Error converting value \"\"1.2.3.4444444444444444444444\"\" to type 'System.Version'. Path '[0]', line 1, position 31.\");\n        }\n\n        [Test]\n        public void DeserializeJObjectWithComments()\n        {\n            string json = @\"/* Test */\n            {\n                /*Test*/\"\"A\"\":/* Test */true/* Test */,\n                /* Test */\"\"B\"\":/* Test */false/* Test */,\n                /* Test */\"\"C\"\":/* Test */[\n                    /* Test */\n                    1/* Test */\n                ]/* Test */\n            }\n            /* Test */\";\n            JObject o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(3, o.Count);\n            Assert.AreEqual(true, (bool)o[\"A\"]);\n            Assert.AreEqual(false, (bool)o[\"B\"]);\n            Assert.AreEqual(1, o[\"C\"].Count());\n            Assert.AreEqual(1, (int)o[\"C\"][0]);\n\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n\n            json = @\"{/* Test */}\";\n            o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(0, o.Count);\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n\n            json = @\"{\"\"A\"\": true/* Test */}\";\n            o = (JObject)JsonConvert.DeserializeObject(json);\n            Assert.AreEqual(1, o.Count);\n            Assert.AreEqual(true, (bool)o[\"A\"]);\n            Assert.IsTrue(JToken.DeepEquals(o, JObject.Parse(json)));\n        }\n\n        [Test]\n        public void DeserializeCommentTestObjectWithComments()\n        {\n            CommentTestObject o = JsonConvert.DeserializeObject<CommentTestObject>(@\"{/* Test */}\");\n            Assert.AreEqual(null, o.A);\n\n            o = JsonConvert.DeserializeObject<CommentTestObject>(@\"{\"\"A\"\": true/* Test */}\");\n            Assert.AreEqual(true, o.A);\n        }\n\n        [Test]\n        public void JsonSerializerProperties()\n        {\n            JsonSerializer serializer = new JsonSerializer();\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializer.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            serializer.Binder = customBinder;\n            Assert.AreEqual(customBinder, serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            Assert.IsInstanceOf(typeof(DefaultSerializationBinder), serializer.SerializationBinder);\n\n            serializer.SerializationBinder = customBinder;\n            Assert.AreEqual(customBinder, serializer.SerializationBinder);\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            // can still fetch because DefaultSerializationBinder inherits from SerializationBinder\n            Assert.AreEqual(customBinder, serializer.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            serializer.CheckAdditionalContent = true;\n            Assert.AreEqual(true, serializer.CheckAdditionalContent);\n\n            serializer.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, serializer.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            serializer.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), serializer.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            serializer.ContractResolver = resolver;\n            Assert.AreEqual(resolver, serializer.ContractResolver);\n\n            serializer.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, serializer.Converters.Count);\n\n            serializer.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", serializer.Culture.ToString());\n\n            serializer.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, serializer.EqualityComparer);\n\n            serializer.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, serializer.DateFormatHandling);\n\n            serializer.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", serializer.DateFormatString);\n\n            serializer.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, serializer.DateParseHandling);\n\n            serializer.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, serializer.DateTimeZoneHandling);\n\n            serializer.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, serializer.DefaultValueHandling);\n\n            serializer.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, serializer.FloatFormatHandling);\n\n            serializer.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, serializer.FloatParseHandling);\n\n            serializer.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, serializer.Formatting);\n\n            serializer.MaxDepth = 9001;\n            Assert.AreEqual(9001, serializer.MaxDepth);\n\n            serializer.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, serializer.MissingMemberHandling);\n\n            serializer.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, serializer.NullValueHandling);\n\n            serializer.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, serializer.ObjectCreationHandling);\n\n            serializer.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, serializer.PreserveReferencesHandling);\n\n            serializer.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, serializer.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n            serializer.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, serializer.ReferenceResolver);\n\n            serializer.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, serializer.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializer.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, serializer.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            serializer.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, serializer.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializer.TypeNameAssemblyFormatHandling);\n\n            serializer.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, serializer.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            serializer.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializer.TypeNameAssemblyFormatHandling);\n\n            serializer.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, serializer.TypeNameHandling);\n        }\n\n        [Test]\n        public void JsonSerializerSettingsProperties()\n        {\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNull(settings.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNull(settings.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            settings.Binder = customBinder;\n            Assert.AreEqual(customBinder, settings.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            settings.CheckAdditionalContent = true;\n            Assert.AreEqual(true, settings.CheckAdditionalContent);\n\n            settings.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, settings.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            settings.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), settings.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            settings.ContractResolver = resolver;\n            Assert.AreEqual(resolver, settings.ContractResolver);\n\n            settings.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, settings.Converters.Count);\n\n            settings.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", settings.Culture.ToString());\n\n            settings.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, settings.EqualityComparer);\n\n            settings.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, settings.DateFormatHandling);\n\n            settings.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", settings.DateFormatString);\n\n            settings.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, settings.DateParseHandling);\n\n            settings.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, settings.DateTimeZoneHandling);\n\n            settings.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, settings.DefaultValueHandling);\n\n            settings.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, settings.FloatFormatHandling);\n\n            settings.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, settings.FloatParseHandling);\n\n            settings.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, settings.Formatting);\n\n            settings.MaxDepth = 9001;\n            Assert.AreEqual(9001, settings.MaxDepth);\n\n            settings.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, settings.MissingMemberHandling);\n\n            settings.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, settings.NullValueHandling);\n\n            settings.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, settings.ObjectCreationHandling);\n\n            settings.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, settings.PreserveReferencesHandling);\n\n            settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, settings.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n#pragma warning disable 618\n            settings.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolver);\n#pragma warning restore 618\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolverProvider());\n\n            settings.ReferenceResolverProvider = () => referenceResolver;\n            Assert.AreEqual(referenceResolver, settings.ReferenceResolverProvider());\n\n            settings.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, settings.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            settings.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, settings.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            settings.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, settings.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, settings.TypeNameAssemblyFormatHandling);\n\n            settings.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, settings.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            settings.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, settings.TypeNameAssemblyFormatHandling);\n\n            settings.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, settings.TypeNameHandling);\n        }\n\n        [Test]\n        public void JsonSerializerProxyProperties()\n        {\n            JsonSerializerProxy serializerProxy = new JsonSerializerProxy(new JsonSerializerInternalReader(new JsonSerializer()));\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n            Assert.IsNotNull(serializerProxy.SerializationBinder);\n\n            DefaultSerializationBinder customBinder = new DefaultSerializationBinder();\n#pragma warning disable CS0618 // Type or member is obsolete\n            serializerProxy.Binder = customBinder;\n            Assert.AreEqual(customBinder, serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n            Assert.IsInstanceOf(typeof(DefaultSerializationBinder), serializerProxy.SerializationBinder);\n\n            serializerProxy.SerializationBinder = customBinder;\n            Assert.AreEqual(customBinder, serializerProxy.SerializationBinder);\n\n#pragma warning disable CS0618 // Type or member is obsolete\n            // can still fetch because DefaultSerializationBinder inherits from SerializationBinder\n            Assert.AreEqual(customBinder, serializerProxy.Binder);\n#pragma warning restore CS0618 // Type or member is obsolete\n\n\n            serializerProxy.CheckAdditionalContent = true;\n            Assert.AreEqual(true, serializerProxy.CheckAdditionalContent);\n\n            serializerProxy.ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor;\n            Assert.AreEqual(ConstructorHandling.AllowNonPublicDefaultConstructor, serializerProxy.ConstructorHandling);\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n            serializerProxy.Context = new StreamingContext(StreamingContextStates.Other);\n            Assert.AreEqual(new StreamingContext(StreamingContextStates.Other), serializerProxy.Context);\n#endif\n\n            CamelCasePropertyNamesContractResolver resolver = new CamelCasePropertyNamesContractResolver();\n            serializerProxy.ContractResolver = resolver;\n            Assert.AreEqual(resolver, serializerProxy.ContractResolver);\n\n            serializerProxy.Converters.Add(new StringEnumConverter());\n            Assert.AreEqual(1, serializerProxy.Converters.Count);\n\n            serializerProxy.Culture = new CultureInfo(\"en-nz\");\n            Assert.AreEqual(\"en-NZ\", serializerProxy.Culture.ToString());\n\n            serializerProxy.EqualityComparer = EqualityComparer<object>.Default;\n            Assert.AreEqual(EqualityComparer<object>.Default, serializerProxy.EqualityComparer);\n\n            serializerProxy.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;\n            Assert.AreEqual(DateFormatHandling.MicrosoftDateFormat, serializerProxy.DateFormatHandling);\n\n            serializerProxy.DateFormatString = \"yyyy\";\n            Assert.AreEqual(\"yyyy\", serializerProxy.DateFormatString);\n\n            serializerProxy.DateParseHandling = DateParseHandling.None;\n            Assert.AreEqual(DateParseHandling.None, serializerProxy.DateParseHandling);\n\n            serializerProxy.DateTimeZoneHandling = DateTimeZoneHandling.Utc;\n            Assert.AreEqual(DateTimeZoneHandling.Utc, serializerProxy.DateTimeZoneHandling);\n\n            serializerProxy.DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate;\n            Assert.AreEqual(DefaultValueHandling.IgnoreAndPopulate, serializerProxy.DefaultValueHandling);\n\n            serializerProxy.FloatFormatHandling = FloatFormatHandling.Symbol;\n            Assert.AreEqual(FloatFormatHandling.Symbol, serializerProxy.FloatFormatHandling);\n\n            serializerProxy.FloatParseHandling = FloatParseHandling.Decimal;\n            Assert.AreEqual(FloatParseHandling.Decimal, serializerProxy.FloatParseHandling);\n\n            serializerProxy.Formatting = Formatting.Indented;\n            Assert.AreEqual(Formatting.Indented, serializerProxy.Formatting);\n\n            serializerProxy.MaxDepth = 9001;\n            Assert.AreEqual(9001, serializerProxy.MaxDepth);\n\n            serializerProxy.MissingMemberHandling = MissingMemberHandling.Error;\n            Assert.AreEqual(MissingMemberHandling.Error, serializerProxy.MissingMemberHandling);\n\n            serializerProxy.NullValueHandling = NullValueHandling.Ignore;\n            Assert.AreEqual(NullValueHandling.Ignore, serializerProxy.NullValueHandling);\n\n            serializerProxy.ObjectCreationHandling = ObjectCreationHandling.Replace;\n            Assert.AreEqual(ObjectCreationHandling.Replace, serializerProxy.ObjectCreationHandling);\n\n            serializerProxy.PreserveReferencesHandling = PreserveReferencesHandling.All;\n            Assert.AreEqual(PreserveReferencesHandling.All, serializerProxy.PreserveReferencesHandling);\n\n            serializerProxy.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;\n            Assert.AreEqual(ReferenceLoopHandling.Ignore, serializerProxy.ReferenceLoopHandling);\n\n            IdReferenceResolver referenceResolver = new IdReferenceResolver();\n            serializerProxy.ReferenceResolver = referenceResolver;\n            Assert.AreEqual(referenceResolver, serializerProxy.ReferenceResolver);\n\n            serializerProxy.StringEscapeHandling = StringEscapeHandling.EscapeNonAscii;\n            Assert.AreEqual(StringEscapeHandling.EscapeNonAscii, serializerProxy.StringEscapeHandling);\n\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializerProxy.TraceWriter = traceWriter;\n            Assert.AreEqual(traceWriter, serializerProxy.TraceWriter);\n\n#if !(PORTABLE || PORTABLE40 || NET20 || DNXCORE50) || NETSTANDARD2_0\n#pragma warning disable 618\n            serializerProxy.TypeNameAssemblyFormat = FormatterAssemblyStyle.Full;\n            Assert.AreEqual(FormatterAssemblyStyle.Full, serializerProxy.TypeNameAssemblyFormat);\n#pragma warning restore 618\n\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializerProxy.TypeNameAssemblyFormatHandling);\n\n            serializerProxy.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n#pragma warning disable 618\n            Assert.AreEqual(FormatterAssemblyStyle.Simple, serializerProxy.TypeNameAssemblyFormat);\n#pragma warning restore 618\n#endif\n\n            serializerProxy.TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Full;\n            Assert.AreEqual(TypeNameAssemblyFormatHandling.Full, serializerProxy.TypeNameAssemblyFormatHandling);\n\n            serializerProxy.TypeNameHandling = TypeNameHandling.All;\n            Assert.AreEqual(TypeNameHandling.All, serializerProxy.TypeNameHandling);\n        }\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeISerializableIConvertible()\n        {\n            Ratio ratio = new Ratio(2, 1);\n            string json = JsonConvert.SerializeObject(ratio);\n\n            Assert.AreEqual(@\"{\"\"n\"\":2,\"\"d\"\":1}\", json);\n\n            Ratio ratio2 = JsonConvert.DeserializeObject<Ratio>(json);\n\n            Assert.AreEqual(ratio.Denominator, ratio2.Denominator);\n            Assert.AreEqual(ratio.Numerator, ratio2.Numerator);\n        }\n    \n        [Test]\n        public void PreserveReferencesCallbackTest()\n        {\n            var p1 = new PersonReference\n            {\n                Name = \"John Smith\"\n            };\n            var p2 = new PersonReference\n            {\n                Name = \"Mary Sue\",\n            };\n\n            p1.Spouse = p2;\n            p2.Spouse = p1;\n\n            var obj = new PreserveReferencesCallbackTestObject(\"string!\", 42, p1, p2, p1);\n            obj._parent = obj;\n\n            var settings = new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.All,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(obj, settings);\n\n            StringAssert.AreEqual(json, @\"{\n  \"\"$id\"\": \"\"1\"\",\n  \"\"stringValue\"\": \"\"string!\"\",\n  \"\"intValue\"\": 42,\n  \"\"person1\"\": {\n    \"\"$id\"\": \"\"2\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"3\"\",\n      \"\"Name\"\": \"\"Mary Sue\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"2\"\"\n      }\n    }\n  },\n  \"\"person2\"\": {\n    \"\"$ref\"\": \"\"3\"\"\n  },\n  \"\"person3\"\": {\n    \"\"$ref\"\": \"\"2\"\"\n  },\n  \"\"parent\"\": {\n    \"\"$ref\"\": \"\"1\"\"\n  }\n}\");\n\n            PreserveReferencesCallbackTestObject obj2 = JsonConvert.DeserializeObject<PreserveReferencesCallbackTestObject>(json);\n\n            Assert.AreEqual(obj._stringValue, obj2._stringValue);\n            Assert.AreEqual(obj._intValue, obj2._intValue);\n            Assert.AreEqual(obj._person1.Name, obj2._person1.Name);\n            Assert.AreEqual(obj._person2.Name, obj2._person2.Name);\n            Assert.AreEqual(obj._person3.Name, obj2._person3.Name);\n            Assert.AreEqual(obj2._person1, obj2._person3);\n            Assert.AreEqual(obj2._person1.Spouse, obj2._person2);\n            Assert.AreEqual(obj2._person2.Spouse, obj2._person1);\n            Assert.AreEqual(obj2._parent, obj2);\n        }\n#endif\n\n        [Test]\n        public void DeserializeLargeFloat()\n        {\n            object o = JsonConvert.DeserializeObject(\"100000000000000000000000000000000000000.0\");\n\n            CustomAssert.IsInstanceOfType(typeof(double), o);\n\n            Assert.IsTrue(MathUtils.ApproxEquals(1E+38, (double)o));\n        }\n\n        [Test]\n        public void SerializeDeserializeRegex()\n        {\n            Regex regex = new Regex(\"(hi)\", RegexOptions.CultureInvariant);\n\n            string json = JsonConvert.SerializeObject(regex, Formatting.Indented);\n\n            Regex r2 = JsonConvert.DeserializeObject<Regex>(json);\n\n            Assert.AreEqual(\"(hi)\", r2.ToString());\n            Assert.AreEqual(RegexOptions.CultureInvariant, r2.Options);\n        }\n\n        [Test]\n        public void EmbedJValueStringInNewJObject()\n        {\n            string s = null;\n            var v = new JValue(s);\n            var o = JObject.FromObject(new { title = v });\n\n            JObject oo = new JObject\n            {\n                { \"title\", v }\n            };\n\n            string output = o.ToString();\n\n            Assert.AreEqual(null, v.Value);\n            Assert.AreEqual(JTokenType.String, v.Type);\n\n            StringAssert.AreEqual(@\"{\n  \"\"title\"\": null\n}\", output);\n        }\n\n        // bug: the generic member (T) that hides the base member will not\n        // be used when serializing and deserializing the object,\n        // resulting in unexpected behavior during serialization and deserialization.\n\n        [Test]\n        public void BaseClassSerializesAsExpected()\n        {\n            var original = new Foo1 { foo = \"value\" };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":\"\"value\"\"}\";\n            Assert.AreEqual(expectedJson, json); // passes\n        }\n\n        [Test]\n        public void BaseClassDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":\"\"value\"\"}\";\n            var deserialized = JsonConvert.DeserializeObject<Foo1>(json);\n            Assert.AreEqual(\"value\", deserialized.foo); // passes\n        }\n\n        [Test]\n        public void DerivedClassHidingBasePropertySerializesAsExpected()\n        {\n            var original = new FooBar1 { foo = new Bar1 { bar = \"value\" } };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"}}\";\n            Assert.AreEqual(expectedJson, json); // passes\n        }\n\n        [Test]\n        public void DerivedClassHidingBasePropertyDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"}}\";\n            var deserialized = JsonConvert.DeserializeObject<FooBar1>(json);\n            Assert.IsNotNull(deserialized.foo); // passes\n            Assert.AreEqual(\"value\", deserialized.foo.bar); // passes\n        }\n\n        [Test]\n        public void DerivedGenericClassHidingBasePropertySerializesAsExpected()\n        {\n            var original = new Foo1<Bar1> { foo = new Bar1 { bar = \"value\" }, foo2 = new Bar1 { bar = \"value2\" } };\n            var json = JsonConvert.SerializeObject(original);\n            var expectedJson = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"},\"\"foo2\"\":{\"\"bar\"\":\"\"value2\"\"}}\";\n            Assert.AreEqual(expectedJson, json);\n        }\n\n        [Test]\n        public void DerivedGenericClassHidingBasePropertyDeserializesAsExpected()\n        {\n            var json = @\"{\"\"foo\"\":{\"\"bar\"\":\"\"value\"\"},\"\"foo2\"\":{\"\"bar\"\":\"\"value2\"\"}}\";\n            var deserialized = JsonConvert.DeserializeObject<Foo1<Bar1>>(json);\n            Assert.IsNotNull(deserialized.foo2); // passes (bug only occurs for generics that /hide/ another property)\n            Assert.AreEqual(\"value2\", deserialized.foo2.bar); // also passes, with no issue\n            Assert.IsNotNull(deserialized.foo);\n            Assert.AreEqual(\"value\", deserialized.foo.bar);\n        }\n\n        [Test]\n        public void ConversionOperator()\n        {\n            // Creating a simple dictionary that has a non-string key\n            var dictStore = new Dictionary<DictionaryKeyCast, int>();\n            for (var i = 0; i < 800; i++)\n            {\n                dictStore.Add(new DictionaryKeyCast(i.ToString(CultureInfo.InvariantCulture), i), i);\n            }\n            var settings = new JsonSerializerSettings { Formatting = Formatting.Indented };\n            var jsonSerializer = JsonSerializer.Create(settings);\n            var ms = new MemoryStream();\n\n            var streamWriter = new StreamWriter(ms);\n            jsonSerializer.Serialize(streamWriter, dictStore);\n            streamWriter.Flush();\n\n            ms.Seek(0, SeekOrigin.Begin);\n\n            var stopWatch = Stopwatch.StartNew();\n            var deserialize = jsonSerializer.Deserialize(new StreamReader(ms), typeof(Dictionary<DictionaryKeyCast, int>));\n            stopWatch.Stop();\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void ChildDataContractTestWithHidden()\n        {\n            var cc = new ChildDataContractWithHidden\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\",\n                NewMember = \"NewMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"NewMember\"\":\"\"NewMember!\"\",\"\"virtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void SubWithoutContractNewPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithoutContractNewProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"WithDataMemberSub\"\": \"\"WithDataMember!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithoutContractVirtualPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithoutContractVirtualProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = JsonConvert.SerializeObject(baseWith, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualSub\"\": \"\"Virtual2!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithContractNewPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithContractNewProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"JustAProperty2\"\": \"\"JustAProperty!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"Virtual2\"\": \"\"Virtual!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\",\n  \"\"WithDataMemberSub\"\": \"\"WithDataMember!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SubWithContractVirtualPropertiesTest()\n        {\n            BaseWithContract baseWith = new SubWithContractVirtualProperties\n            {\n                JustAProperty = \"JustAProperty!\",\n                Virtual = \"Virtual!\",\n                VirtualWithDataMember = \"VirtualWithDataMember!\",\n                WithDataMember = \"WithDataMember!\"\n            };\n\n            baseWith.JustAProperty = \"JustAProperty2!\";\n            baseWith.Virtual = \"Virtual2!\";\n            baseWith.VirtualWithDataMember = \"VirtualWithDataMember2!\";\n            baseWith.WithDataMember = \"WithDataMember2!\";\n\n            string json = AssertSerializeDeserializeEqual(baseWith);\n\n            StringAssert.AreEqual(@\"{\n  \"\"JustAProperty\"\": \"\"JustAProperty2!\"\",\n  \"\"Virtual\"\": \"\"Virtual2!\"\",\n  \"\"VirtualWithDataMemberBase\"\": \"\"VirtualWithDataMember2!\"\",\n  \"\"VirtualWithDataMemberSub\"\": \"\"VirtualWithDataMember!\"\",\n  \"\"WithDataMemberBase\"\": \"\"WithDataMember2!\"\"\n}\", json);\n        }\n\n        private string AssertSerializeDeserializeEqual(object o)\n        {\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer s = new DataContractJsonSerializer(o.GetType());\n            s.WriteObject(ms, o);\n\n            var data = ms.ToArray();\n            JObject dataContractJson = JObject.Parse(Encoding.UTF8.GetString(data, 0, data.Length));\n            dataContractJson = new JObject(dataContractJson.Properties().OrderBy(p => p.Name));\n\n            JObject jsonNetJson = JObject.Parse(JsonConvert.SerializeObject(o));\n            jsonNetJson = new JObject(jsonNetJson.Properties().OrderBy(p => p.Name));\n\n            //Console.WriteLine(\"Results for \" + o.GetType().Name);\n            //Console.WriteLine(\"DataContractJsonSerializer: \" + dataContractJson);\n            //Console.WriteLine(\"JsonDotNetSerializer      : \" + jsonNetJson);\n\n            Assert.AreEqual(dataContractJson.Count, jsonNetJson.Count);\n            foreach (KeyValuePair<string, JToken> property in dataContractJson)\n            {\n                Assert.IsTrue(JToken.DeepEquals(jsonNetJson[property.Key], property.Value), \"Property not equal: \" + property.Key);\n            }\n\n            return jsonNetJson.ToString();\n        }\n#endif\n\n        [Test]\n        public void PersonTypedObjectDeserialization()\n        {\n            Store store = new Store();\n\n            string jsonText = JsonConvert.SerializeObject(store);\n\n            Store deserializedStore = (Store)JsonConvert.DeserializeObject(jsonText, typeof(Store));\n\n            Assert.AreEqual(store.Establised, deserializedStore.Establised);\n            Assert.AreEqual(store.product.Count, deserializedStore.product.Count);\n\n            Console.WriteLine(jsonText);\n        }\n\n        [Test]\n        public void TypedObjectDeserialization()\n        {\n            Product product = new Product();\n\n            product.Name = \"Apple\";\n            product.ExpiryDate = new DateTime(2008, 12, 28);\n            product.Price = 3.99M;\n            product.Sizes = new string[] { \"Small\", \"Medium\", \"Large\" };\n\n            string output = JsonConvert.SerializeObject(product);\n            //{\n            //  \"Name\": \"Apple\",\n            //  \"ExpiryDate\": \"\\/Date(1230375600000+1300)\\/\",\n            //  \"Price\": 3.99,\n            //  \"Sizes\": [\n            //    \"Small\",\n            //    \"Medium\",\n            //    \"Large\"\n            //  ]\n            //}\n\n            Product deserializedProduct = (Product)JsonConvert.DeserializeObject(output, typeof(Product));\n\n            Assert.AreEqual(\"Apple\", deserializedProduct.Name);\n            Assert.AreEqual(new DateTime(2008, 12, 28), deserializedProduct.ExpiryDate);\n            Assert.AreEqual(3.99m, deserializedProduct.Price);\n            Assert.AreEqual(\"Small\", deserializedProduct.Sizes[0]);\n            Assert.AreEqual(\"Medium\", deserializedProduct.Sizes[1]);\n            Assert.AreEqual(\"Large\", deserializedProduct.Sizes[2]);\n        }\n\n        //[Test]\n        //public void Advanced()\n        //{\n        //  Product product = new Product();\n        //  product.ExpiryDate = new DateTime(2008, 12, 28);\n\n        //  JsonSerializer serializer = new JsonSerializer();\n        //  serializer.Converters.Add(new JavaScriptDateTimeConverter());\n        //  serializer.NullValueHandling = NullValueHandling.Ignore;\n\n        //  using (StreamWriter sw = new StreamWriter(@\"c:\\json.txt\"))\n        //  using (JsonWriter writer = new JsonTextWriter(sw))\n        //  {\n        //    serializer.Serialize(writer, product);\n        //    // {\"ExpiryDate\":new Date(1230375600000),\"Price\":0}\n        //  }\n        //}\n\n        [Test]\n        public void JsonConvertSerializer()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Price\"\":3.99, \"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\"}\";\n\n            Product p = JsonConvert.DeserializeObject(value, typeof(Product)) as Product;\n\n            Assert.AreEqual(\"Orange\", p.Name);\n            Assert.AreEqual(new DateTime(2010, 1, 24, 12, 0, 0), p.ExpiryDate);\n            Assert.AreEqual(3.99m, p.Price);\n        }\n\n        [Test]\n        public void DeserializeJavaScriptDate()\n        {\n            DateTime dateValue = new DateTime(2010, 3, 30);\n            Dictionary<string, object> testDictionary = new Dictionary<string, object>();\n            testDictionary[\"date\"] = dateValue;\n\n            string jsonText = JsonConvert.SerializeObject(testDictionary);\n\n#if !(NET20 || NET35)\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(Dictionary<string, object>));\n            serializer.WriteObject(ms, testDictionary);\n\n            byte[] data = ms.ToArray();\n            string output = Encoding.UTF8.GetString(data, 0, data.Length);\n#endif\n\n            Dictionary<string, object> deserializedDictionary = (Dictionary<string, object>)JsonConvert.DeserializeObject(jsonText, typeof(Dictionary<string, object>));\n            DateTime deserializedDate = (DateTime)deserializedDictionary[\"date\"];\n\n            Assert.AreEqual(dateValue, deserializedDate);\n        }\n\n        [Test]\n        public void TestMethodExecutorObject()\n        {\n            MethodExecutorObject executorObject = new MethodExecutorObject();\n            executorObject.serverClassName = \"BanSubs\";\n            executorObject.serverMethodParams = new object[] { \"21321546\", \"101\", \"1236\", \"D:\\\\1.txt\" };\n            executorObject.clientGetResultFunction = \"ClientBanSubsCB\";\n\n            string output = JsonConvert.SerializeObject(executorObject);\n\n            MethodExecutorObject executorObject2 = JsonConvert.DeserializeObject(output, typeof(MethodExecutorObject)) as MethodExecutorObject;\n\n            Assert.AreNotSame(executorObject, executorObject2);\n            Assert.AreEqual(executorObject2.serverClassName, \"BanSubs\");\n            Assert.AreEqual(executorObject2.serverMethodParams.Length, 4);\n            CustomAssert.Contains(executorObject2.serverMethodParams, \"101\");\n            Assert.AreEqual(executorObject2.clientGetResultFunction, \"ClientBanSubsCB\");\n        }\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void HashtableDeserialization()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Price\"\":3.99, \"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\"}\";\n\n            Hashtable p = JsonConvert.DeserializeObject(value, typeof(Hashtable)) as Hashtable;\n\n            Assert.AreEqual(\"Orange\", p[\"Name\"].ToString());\n        }\n\n        [Test]\n        public void TypedHashtableDeserialization()\n        {\n            string value = @\"{\"\"Name\"\":\"\"Orange\"\", \"\"Hash\"\":{\"\"ExpiryDate\"\":\"\"01/24/2010 12:00:00\"\",\"\"UntypedArray\"\":[\"\"01/24/2010 12:00:00\"\"]}}\";\n\n            TypedSubHashtable p = JsonConvert.DeserializeObject(value, typeof(TypedSubHashtable)) as TypedSubHashtable;\n\n            Assert.AreEqual(\"01/24/2010 12:00:00\", p.Hash[\"ExpiryDate\"].ToString());\n            StringAssert.AreEqual(@\"[\n  \"\"01/24/2010 12:00:00\"\"\n]\", p.Hash[\"UntypedArray\"].ToString());\n        }\n#endif\n\n        [Test]\n        public void SerializeDeserializeGetOnlyProperty()\n        {\n            string value = JsonConvert.SerializeObject(new GetOnlyPropertyClass());\n\n            GetOnlyPropertyClass c = JsonConvert.DeserializeObject<GetOnlyPropertyClass>(value);\n\n            Assert.AreEqual(c.Field, \"Field\");\n            Assert.AreEqual(c.GetOnlyProperty, \"GetOnlyProperty\");\n        }\n\n        [Test]\n        public void SerializeDeserializeSetOnlyProperty()\n        {\n            string value = JsonConvert.SerializeObject(new SetOnlyPropertyClass());\n\n            SetOnlyPropertyClass c = JsonConvert.DeserializeObject<SetOnlyPropertyClass>(value);\n\n            Assert.AreEqual(c.Field, \"Field\");\n        }\n\n        [Test]\n        public void JsonIgnoreAttributeTest()\n        {\n            string json = JsonConvert.SerializeObject(new JsonIgnoreAttributeTestClass());\n\n            Assert.AreEqual(@\"{\"\"Field\"\":0,\"\"Property\"\":21}\", json);\n\n            JsonIgnoreAttributeTestClass c = JsonConvert.DeserializeObject<JsonIgnoreAttributeTestClass>(@\"{\"\"Field\"\":99,\"\"Property\"\":-1,\"\"IgnoredField\"\":-1,\"\"IgnoredObject\"\":[1,2,3,4,5]}\");\n\n            Assert.AreEqual(0, c.IgnoredField);\n            Assert.AreEqual(99, c.Field);\n        }\n\n        [Test]\n        public void GoogleSearchAPI()\n        {\n            string json = @\"{\n    results:\n        [\n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://www.google.com/\"\",\n                url : \"\"http://www.google.com/\"\",\n                visibleUrl : \"\"www.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:zhool8dxBV4J:www.google.com\"\",\n                title : \"\"Google\"\",\n                titleNoFormatting : \"\"Google\"\",\n                content : \"\"Enables users to search the Web, Usenet, and \nimages. Features include PageRank,   caching and translation of \nresults, and an option to find similar pages.\"\"\n            },\n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://news.google.com/\"\",\n                url : \"\"http://news.google.com/\"\",\n                visibleUrl : \"\"news.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:Va_XShOz_twJ:news.google.com\"\",\n                title : \"\"Google News\"\",\n                titleNoFormatting : \"\"Google News\"\",\n                content : \"\"Aggregated headlines and a search engine of many of the world's news sources.\"\"\n            },\n            \n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://groups.google.com/\"\",\n                url : \"\"http://groups.google.com/\"\",\n                visibleUrl : \"\"groups.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:x2uPD3hfkn0J:groups.google.com\"\",\n                title : \"\"Google Groups\"\",\n                titleNoFormatting : \"\"Google Groups\"\",\n                content : \"\"Enables users to search and browse the Usenet \narchives which consist of over 700   million messages, and post new \ncomments.\"\"\n            },\n            \n            {\n                GsearchResultClass:\"\"GwebSearch\"\",\n                unescapedUrl : \"\"http://maps.google.com/\"\",\n                url : \"\"http://maps.google.com/\"\",\n                visibleUrl : \"\"maps.google.com\"\",\n                cacheUrl : \n\"\"http://www.google.com/search?q=cache:dkf5u2twBXIJ:maps.google.com\"\",\n                title : \"\"Google Maps\"\",\n                titleNoFormatting : \"\"Google Maps\"\",\n                content : \"\"Provides directions, interactive maps, and \nsatellite/aerial imagery of the United   States. Can also search by \nkeyword such as type of business.\"\"\n            }\n        ],\n        \n    adResults:\n        [\n            {\n                GsearchResultClass:\"\"GwebSearch.ad\"\",\n                title : \"\"Gartner Symposium/ITxpo\"\",\n                content1 : \"\"Meet brilliant Gartner IT analysts\"\",\n                content2 : \"\"20-23 May 2007- Barcelona, Spain\"\",\n                url : \n\"\"http://www.google.com/url?sa=L&ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB&num=1&q=http://www.gartner.com/it/sym/2007/spr8/spr8.jsp%3Fsrc%3D_spain_07_%26WT.srch%3D1&usg=__CxRH06E4Xvm9Muq13S4MgMtnziY=\"\", \n\n                impressionUrl : \n\"\"http://www.google.com/uds/css/ad-indicator-on.gif?ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB\"\", \n\n                unescapedUrl : \n\"\"http://www.google.com/url?sa=L&ai=BVualExYGRo3hD5ianAPJvejjD8-s6ye7kdTwArbI4gTAlrECEAEYASDXtMMFOAFQubWAjvr_____AWDXw_4EiAEBmAEAyAEBgAIB&num=1&q=http://www.gartner.com/it/sym/2007/spr8/spr8.jsp%3Fsrc%3D_spain_07_%26WT.srch%3D1&usg=__CxRH06E4Xvm9Muq13S4MgMtnziY=\"\", \n\n                visibleUrl : \"\"www.gartner.com\"\"\n            }\n        ]\n}\n\";\n            object o = JsonConvert.DeserializeObject(json);\n            string s = string.Empty;\n            s += s;\n        }\n\n        [Test]\n        public void TorrentDeserializeTest()\n        {\n            string jsonText = @\"{\n\"\"\"\":\"\"\"\",\n\"\"label\"\": [\n       [\"\"SomeName\"\",6]\n],\n\"\"torrents\"\": [\n       [\"\"192D99A5C943555CB7F00A852821CF6D6DB3008A\"\",201,\"\"filename.avi\"\",178311826,1000,178311826,72815250,408,1603,7,121430,\"\"NameOfLabelPrevioslyDefined\"\",3,6,0,8,128954,-1,0],\n],\n\"\"torrentc\"\": \"\"1816000723\"\"\n}\";\n\n            JObject o = (JObject)JsonConvert.DeserializeObject(jsonText);\n            Assert.AreEqual(4, o.Children().Count());\n\n            JToken torrentsArray = (JToken)o[\"torrents\"];\n            JToken nestedTorrentsArray = (JToken)torrentsArray[0];\n            Assert.AreEqual(nestedTorrentsArray.Children().Count(), 19);\n        }\n\n        [Test]\n        public void JsonPropertyClassSerialize()\n        {\n            JsonPropertyClass test = new JsonPropertyClass();\n            test.Pie = \"Delicious\";\n            test.SweetCakesCount = int.MaxValue;\n\n            string jsonText = JsonConvert.SerializeObject(test);\n\n            Assert.AreEqual(@\"{\"\"pie\"\":\"\"Delicious\"\",\"\"pie1\"\":\"\"PieChart!\"\",\"\"sweet_cakes_count\"\":2147483647}\", jsonText);\n\n            JsonPropertyClass test2 = JsonConvert.DeserializeObject<JsonPropertyClass>(jsonText);\n\n            Assert.AreEqual(test.Pie, test2.Pie);\n            Assert.AreEqual(test.SweetCakesCount, test2.SweetCakesCount);\n        }\n\n        [Test]\n        public void BadJsonPropertyClassSerialize()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.SerializeObject(new BadJsonPropertyClass()); }, @\"A member with the name 'pie' already exists on 'Newtonsoft.Json.Tests.TestObjects.BadJsonPropertyClass'. Use the JsonPropertyAttribute to specify another name.\");\n        }\n\n        [Test]\n        public void InvalidBackslash()\n        {\n            string json = @\"[\"\"vvv\\jvvv\"\"]\";\n\n            ExceptionAssert.Throws<JsonReaderException>(() => { JsonConvert.DeserializeObject<List<string>>(json); }, @\"Bad JSON escape sequence: \\j. Path '', line 1, position 7.\");\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void Unicode()\n        {\n            string json = @\"[\"\"PRE\\u003cPOST\"\"]\";\n\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<string>));\n            List<string> dataContractResult = (List<string>)s.ReadObject(new MemoryStream(Encoding.UTF8.GetBytes(json)));\n\n            List<string> jsonNetResult = JsonConvert.DeserializeObject<List<string>>(json);\n\n            Assert.AreEqual(1, jsonNetResult.Count);\n            Assert.AreEqual(dataContractResult[0], jsonNetResult[0]);\n        }\n\n        [Test]\n        public void BackslashEqivilence()\n        {\n            string json = @\"[\"\"vvv\\/vvv\\tvvv\\\"\"vvv\\bvvv\\nvvv\\rvvv\\\\vvv\\fvvv\"\"]\";\n\n#if !(DNXCORE50)\n            JavaScriptSerializer javaScriptSerializer = new JavaScriptSerializer();\n            List<string> javaScriptSerializerResult = javaScriptSerializer.Deserialize<List<string>>(json);\n#endif\n\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<string>));\n            List<string> dataContractResult = (List<string>)s.ReadObject(new MemoryStream(Encoding.UTF8.GetBytes(json)));\n\n            List<string> jsonNetResult = JsonConvert.DeserializeObject<List<string>>(json);\n\n            Assert.AreEqual(1, jsonNetResult.Count);\n            Assert.AreEqual(dataContractResult[0], jsonNetResult[0]);\n#if !(DNXCORE50)\n            Assert.AreEqual(javaScriptSerializerResult[0], jsonNetResult[0]);\n#endif\n        }\n\n        [Test]\n        public void DateTimeTest()\n        {\n            List<DateTime> testDates = new List<DateTime>\n            {\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Local),\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Unspecified),\n                new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Local),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Unspecified),\n                new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc),\n            };\n\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(List<DateTime>));\n            s.WriteObject(ms, testDates);\n            ms.Seek(0, SeekOrigin.Begin);\n            StreamReader sr = new StreamReader(ms);\n\n            string expected = sr.ReadToEnd();\n\n            string result = JsonConvert.SerializeObject(testDates, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n            Assert.AreEqual(expected, result);\n        }\n\n        [Test]\n        public void DateTimeOffsetIso()\n        {\n            List<DateTimeOffset> testDates = new List<DateTimeOffset>\n            {\n                new DateTimeOffset(new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(13)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(-3.5)),\n            };\n\n            string result = JsonConvert.SerializeObject(testDates);\n            Assert.AreEqual(@\"[\"\"0100-01-01T01:01:01+00:00\"\",\"\"2000-01-01T01:01:01+00:00\"\",\"\"2000-01-01T01:01:01+13:00\"\",\"\"2000-01-01T01:01:01-03:30\"\"]\", result);\n        }\n\n        [Test]\n        public void DateTimeOffsetMsAjax()\n        {\n            List<DateTimeOffset> testDates = new List<DateTimeOffset>\n            {\n                new DateTimeOffset(new DateTime(100, 1, 1, 1, 1, 1, DateTimeKind.Utc)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.Zero),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(13)),\n                new DateTimeOffset(2000, 1, 1, 1, 1, 1, TimeSpan.FromHours(-3.5)),\n            };\n\n            string result = JsonConvert.SerializeObject(testDates, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n            Assert.AreEqual(@\"[\"\"\\/Date(-59011455539000+0000)\\/\"\",\"\"\\/Date(946688461000+0000)\\/\"\",\"\"\\/Date(946641661000+1300)\\/\"\",\"\"\\/Date(946701061000-0330)\\/\"\"]\", result);\n        }\n#endif\n\n        [Test]\n        public void NonStringKeyDictionary()\n        {\n            Dictionary<int, int> values = new Dictionary<int, int>();\n            values.Add(-5, 6);\n            values.Add(int.MinValue, int.MaxValue);\n\n            string json = JsonConvert.SerializeObject(values);\n\n            Assert.AreEqual(@\"{\"\"-5\"\":6,\"\"-2147483648\"\":2147483647}\", json);\n\n            Dictionary<int, int> newValues = JsonConvert.DeserializeObject<Dictionary<int, int>>(json);\n\n            CollectionAssert.AreEqual(values, newValues);\n        }\n\n        [Test]\n        public void AnonymousObjectSerialization()\n        {\n            var anonymous =\n                new\n                {\n                    StringValue = \"I am a string\",\n                    IntValue = int.MaxValue,\n                    NestedAnonymous = new { NestedValue = byte.MaxValue },\n                    NestedArray = new[] { 1, 2 },\n                    Product = new Product() { Name = \"TestProduct\" }\n                };\n\n            string json = JsonConvert.SerializeObject(anonymous);\n            Assert.AreEqual(@\"{\"\"StringValue\"\":\"\"I am a string\"\",\"\"IntValue\"\":2147483647,\"\"NestedAnonymous\"\":{\"\"NestedValue\"\":255},\"\"NestedArray\"\":[1,2],\"\"Product\"\":{\"\"Name\"\":\"\"TestProduct\"\",\"\"ExpiryDate\"\":\"\"2000-01-01T00:00:00Z\"\",\"\"Price\"\":0.0,\"\"Sizes\"\":null}}\", json);\n\n            anonymous = JsonConvert.DeserializeAnonymousType(json, anonymous);\n            Assert.AreEqual(\"I am a string\", anonymous.StringValue);\n            Assert.AreEqual(int.MaxValue, anonymous.IntValue);\n            Assert.AreEqual(255, anonymous.NestedAnonymous.NestedValue);\n            Assert.AreEqual(2, anonymous.NestedArray.Length);\n            Assert.AreEqual(1, anonymous.NestedArray[0]);\n            Assert.AreEqual(2, anonymous.NestedArray[1]);\n            Assert.AreEqual(\"TestProduct\", anonymous.Product.Name);\n        }\n\n        [Test]\n        public void AnonymousObjectSerializationWithSetting()\n        {\n            DateTime d = new DateTime(2000, 1, 1);\n\n            var anonymous =\n                new\n                {\n                    DateValue = d\n                };\n\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n            settings.Converters.Add(new IsoDateTimeConverter\n            {\n                DateTimeFormat = \"yyyy\"\n            });\n\n            string json = JsonConvert.SerializeObject(anonymous, settings);\n            Assert.AreEqual(@\"{\"\"DateValue\"\":\"\"2000\"\"}\", json);\n\n            anonymous = JsonConvert.DeserializeAnonymousType(json, anonymous, settings);\n            Assert.AreEqual(d, anonymous.DateValue);\n        }\n\n        [Test]\n        public void SerializeObject()\n        {\n            string json = JsonConvert.SerializeObject(new object());\n            Assert.AreEqual(\"{}\", json);\n        }\n\n        [Test]\n        public void SerializeNull()\n        {\n            string json = JsonConvert.SerializeObject(null);\n            Assert.AreEqual(\"null\", json);\n        }\n\n        [Test]\n        public void CanDeserializeIntArrayWhenNotFirstPropertyInJson()\n        {\n            string json = \"{foo:'hello',bar:[1,2,3]}\";\n            ClassWithArray wibble = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(4, wibble.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibble.Bar[0]);\n            Assert.AreEqual(1, wibble.Bar[1]);\n            Assert.AreEqual(2, wibble.Bar[2]);\n            Assert.AreEqual(3, wibble.Bar[3]);\n        }\n\n        [Test]\n        public void CanDeserializeIntArray_WhenArrayIsFirstPropertyInJson()\n        {\n            string json = \"{bar:[1,2,3], foo:'hello'}\";\n            ClassWithArray wibble = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(4, wibble.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibble.Bar[0]);\n            Assert.AreEqual(1, wibble.Bar[1]);\n            Assert.AreEqual(2, wibble.Bar[2]);\n            Assert.AreEqual(3, wibble.Bar[3]);\n        }\n\n        [Test]\n        public void ObjectCreationHandlingReplace()\n        {\n            string json = \"{bar:[1,2,3], foo:'hello'}\";\n\n            JsonSerializer s = new JsonSerializer();\n            s.ObjectCreationHandling = ObjectCreationHandling.Replace;\n\n            ClassWithArray wibble = (ClassWithArray)s.Deserialize(new StringReader(json), typeof(ClassWithArray));\n\n            Assert.AreEqual(\"hello\", wibble.Foo);\n\n            Assert.AreEqual(1, wibble.Bar.Count);\n        }\n\n        [Test]\n        public void CanDeserializeSerializedJson()\n        {\n            ClassWithArray wibble = new ClassWithArray();\n            wibble.Foo = \"hello\";\n            wibble.Bar.Add(1);\n            wibble.Bar.Add(2);\n            wibble.Bar.Add(3);\n            string json = JsonConvert.SerializeObject(wibble);\n\n            ClassWithArray wibbleOut = JsonConvert.DeserializeObject<ClassWithArray>(json);\n            Assert.AreEqual(\"hello\", wibbleOut.Foo);\n\n            Assert.AreEqual(5, wibbleOut.Bar.Count);\n            Assert.AreEqual(int.MaxValue, wibbleOut.Bar[0]);\n            Assert.AreEqual(int.MaxValue, wibbleOut.Bar[1]);\n            Assert.AreEqual(1, wibbleOut.Bar[2]);\n            Assert.AreEqual(2, wibbleOut.Bar[3]);\n            Assert.AreEqual(3, wibbleOut.Bar[4]);\n        }\n\n        [Test]\n        public void SerializeConverableObjects()\n        {\n            string json = JsonConvert.SerializeObject(new ConverableMembers(), Formatting.Indented);\n\n            string expected = null;\n#if (NETSTANDARD2_0)\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.4028235E+38,\n  \"\"DBNull\"\": null,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#elif NETSTANDARD1_3\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.4028235E+38,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#elif !(PORTABLE || DNXCORE50) || NETSTANDARD1_3\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.40282347E+38,\n  \"\"DBNull\"\": null,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#else\n            expected = @\"{\n  \"\"String\"\": \"\"string\"\",\n  \"\"Int32\"\": 2147483647,\n  \"\"UInt32\"\": 4294967295,\n  \"\"Byte\"\": 255,\n  \"\"SByte\"\": 127,\n  \"\"Short\"\": 32767,\n  \"\"UShort\"\": 65535,\n  \"\"Long\"\": 9223372036854775807,\n  \"\"ULong\"\": 9223372036854775807,\n  \"\"Double\"\": 1.7976931348623157E+308,\n  \"\"Float\"\": 3.40282347E+38,\n  \"\"Bool\"\": true,\n  \"\"Char\"\": \"\"\\u0000\"\"\n}\";\n#endif\n\n            StringAssert.AreEqual(expected, json);\n\n            ConverableMembers c = JsonConvert.DeserializeObject<ConverableMembers>(json);\n            Assert.AreEqual(\"string\", c.String);\n            Assert.AreEqual(double.MaxValue, c.Double);\n#if !(PORTABLE || DNXCORE50 || PORTABLE40)\n            Assert.AreEqual(DBNull.Value, c.DBNull);\n#endif\n        }\n\n        [Test]\n        public void SerializeStack()\n        {\n            Stack<object> s = new Stack<object>();\n            s.Push(1);\n            s.Push(2);\n            s.Push(3);\n\n            string json = JsonConvert.SerializeObject(s);\n            Assert.AreEqual(\"[3,2,1]\", json);\n        }\n\n        [Test]\n        public void FormattingOverride()\n        {\n            var obj = new { Formatting = \"test\" };\n\n            JsonSerializerSettings settings = new JsonSerializerSettings { Formatting = Formatting.Indented };\n            string indented = JsonConvert.SerializeObject(obj, settings);\n\n            string none = JsonConvert.SerializeObject(obj, Formatting.None, settings);\n            Assert.AreNotEqual(indented, none);\n        }\n\n        [Test]\n        public void DateTimeTimeZone()\n        {\n            var date = new DateTime(2001, 4, 4, 0, 0, 0, DateTimeKind.Utc);\n\n            string json = JsonConvert.SerializeObject(date);\n            Assert.AreEqual(@\"\"\"2001-04-04T00:00:00Z\"\"\", json);\n        }\n\n        [Test]\n        public void GuidTest()\n        {\n            Guid guid = new Guid(\"BED7F4EA-1A96-11d2-8F08-00A0C9A6186D\");\n\n            string json = JsonConvert.SerializeObject(new ClassWithGuid { GuidField = guid });\n            Assert.AreEqual(@\"{\"\"GuidField\"\":\"\"bed7f4ea-1a96-11d2-8f08-00a0c9a6186d\"\"}\", json);\n\n            ClassWithGuid c = JsonConvert.DeserializeObject<ClassWithGuid>(json);\n            Assert.AreEqual(guid, c.GuidField);\n        }\n\n        [Test]\n        public void EnumTest()\n        {\n            string json = JsonConvert.SerializeObject(StringComparison.CurrentCultureIgnoreCase);\n            Assert.AreEqual(@\"1\", json);\n\n            StringComparison s = JsonConvert.DeserializeObject<StringComparison>(json);\n            Assert.AreEqual(StringComparison.CurrentCultureIgnoreCase, s);\n        }\n\n        [Test]\n        public void TimeSpanTest()\n        {\n            TimeSpan ts = new TimeSpan(00, 23, 59, 1);\n\n            string json = JsonConvert.SerializeObject(new ClassWithTimeSpan { TimeSpanField = ts }, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"TimeSpanField\"\": \"\"23:59:01\"\"\n}\", json);\n\n            ClassWithTimeSpan c = JsonConvert.DeserializeObject<ClassWithTimeSpan>(json);\n            Assert.AreEqual(ts, c.TimeSpanField);\n        }\n\n        [Test]\n        public void JsonIgnoreAttributeOnClassTest()\n        {\n            string json = JsonConvert.SerializeObject(new JsonIgnoreAttributeOnClassTestClass());\n\n            Assert.AreEqual(@\"{\"\"TheField\"\":0,\"\"Property\"\":21}\", json);\n\n            JsonIgnoreAttributeOnClassTestClass c = JsonConvert.DeserializeObject<JsonIgnoreAttributeOnClassTestClass>(@\"{\"\"TheField\"\":99,\"\"Property\"\":-1,\"\"IgnoredField\"\":-1}\");\n\n            Assert.AreEqual(0, c.IgnoredField);\n            Assert.AreEqual(99, c.Field);\n        }\n\n        [Test]\n        public void ConstructorCaseSensitivity()\n        {\n            ConstructorCaseSensitivityClass c = new ConstructorCaseSensitivityClass(\"param1\", \"Param1\", \"Param2\");\n\n            string json = JsonConvert.SerializeObject(c);\n\n            ConstructorCaseSensitivityClass deserialized = JsonConvert.DeserializeObject<ConstructorCaseSensitivityClass>(json);\n\n            Assert.AreEqual(\"param1\", deserialized.param1);\n            Assert.AreEqual(\"Param1\", deserialized.Param1);\n            Assert.AreEqual(\"Param2\", deserialized.Param2);\n        }\n\n        [Test]\n        public void SerializerShouldUseClassConverter()\n        {\n            ConverterPrecedenceClass c1 = new ConverterPrecedenceClass(\"!Test!\");\n\n            string json = JsonConvert.SerializeObject(c1);\n            Assert.AreEqual(@\"[\"\"Class\"\",\"\"!Test!\"\"]\", json);\n\n            ConverterPrecedenceClass c2 = JsonConvert.DeserializeObject<ConverterPrecedenceClass>(json);\n\n            Assert.AreEqual(\"!Test!\", c2.TestValue);\n        }\n\n        [Test]\n        public void SerializerShouldUseClassConverterOverArgumentConverter()\n        {\n            ConverterPrecedenceClass c1 = new ConverterPrecedenceClass(\"!Test!\");\n\n            string json = JsonConvert.SerializeObject(c1, new ArgumentConverterPrecedenceClassConverter());\n            Assert.AreEqual(@\"[\"\"Class\"\",\"\"!Test!\"\"]\", json);\n\n            ConverterPrecedenceClass c2 = JsonConvert.DeserializeObject<ConverterPrecedenceClass>(json, new ArgumentConverterPrecedenceClassConverter());\n\n            Assert.AreEqual(\"!Test!\", c2.TestValue);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_IsoDate()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1);\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"1970-01-01T00:00:00Z\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_MsDate()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"\\/Date(0)\\/\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_MsDate_DateParseNone()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat,\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"\\/Date(0)\\/\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            var m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.None\n            });\n\n            Assert.AreEqual(new DateTime(1970, 1, 1), m2.DefaultConverter);\n            Assert.AreEqual(new DateTime(1970, 1, 1), m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverter_IsoDate_DateParseNone()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.IsoDateFormat,\n            });\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":\"\"1970-01-01T00:00:00Z\"\",\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json);\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverterOverArgumentConverter()\n        {\n            DateTime testDate = new DateTime(DateTimeUtils.InitialJavaScriptDateTicks, DateTimeKind.Utc);\n            MemberConverterClass m1 = new MemberConverterClass { DefaultConverter = testDate, MemberConverter = testDate };\n\n            string json = JsonConvert.SerializeObject(m1, new JavaScriptDateTimeConverter());\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":new Date(0),\"\"MemberConverter\"\":\"\"1970-01-01T00:00:00Z\"\"}\", json);\n\n            MemberConverterClass m2 = JsonConvert.DeserializeObject<MemberConverterClass>(json, new JavaScriptDateTimeConverter());\n\n            Assert.AreEqual(testDate, m2.DefaultConverter);\n            Assert.AreEqual(testDate, m2.MemberConverter);\n        }\n\n        [Test]\n        public void ConverterAttributeExample()\n        {\n            DateTime date = Convert.ToDateTime(\"1970-01-01T00:00:00Z\").ToUniversalTime();\n\n            MemberConverterClass c = new MemberConverterClass\n            {\n                DefaultConverter = date,\n                MemberConverter = date\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultConverter\"\": \"\"1970-01-01T00:00:00Z\"\",\n  \"\"MemberConverter\"\": \"\"1970-01-01T00:00:00Z\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SerializerShouldUseMemberConverterOverClassAndArgumentConverter()\n        {\n            ClassAndMemberConverterClass c1 = new ClassAndMemberConverterClass();\n            c1.DefaultConverter = new ConverterPrecedenceClass(\"DefaultConverterValue\");\n            c1.MemberConverter = new ConverterPrecedenceClass(\"MemberConverterValue\");\n\n            string json = JsonConvert.SerializeObject(c1, new ArgumentConverterPrecedenceClassConverter());\n            Assert.AreEqual(@\"{\"\"DefaultConverter\"\":[\"\"Class\"\",\"\"DefaultConverterValue\"\"],\"\"MemberConverter\"\":[\"\"Member\"\",\"\"MemberConverterValue\"\"]}\", json);\n\n            ClassAndMemberConverterClass c2 = JsonConvert.DeserializeObject<ClassAndMemberConverterClass>(json, new ArgumentConverterPrecedenceClassConverter());\n\n            Assert.AreEqual(\"DefaultConverterValue\", c2.DefaultConverter.TestValue);\n            Assert.AreEqual(\"MemberConverterValue\", c2.MemberConverter.TestValue);\n        }\n\n        [Test]\n        public void IncompatibleJsonAttributeShouldThrow()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                IncompatibleJsonAttributeClass c = new IncompatibleJsonAttributeClass();\n                JsonConvert.SerializeObject(c);\n            }, \"Unexpected value when converting date. Expected DateTime or DateTimeOffset, got Newtonsoft.Json.Tests.TestObjects.IncompatibleJsonAttributeClass.\");\n        }\n\n        [Test]\n        public void GenericAbstractProperty()\n        {\n            string json = JsonConvert.SerializeObject(new GenericImpl());\n            Assert.AreEqual(@\"{\"\"Id\"\":0}\", json);\n        }\n\n        [Test]\n        public void DeserializeNullable()\n        {\n            string json;\n\n            json = JsonConvert.SerializeObject((int?)null);\n            Assert.AreEqual(\"null\", json);\n\n            json = JsonConvert.SerializeObject((int?)1);\n            Assert.AreEqual(\"1\", json);\n        }\n\n        [Test]\n        public void SerializeJsonRaw()\n        {\n            PersonRaw personRaw = new PersonRaw\n            {\n                FirstName = \"FirstNameValue\",\n                RawContent = new JRaw(\"[1,2,3,4,5]\"),\n                LastName = \"LastNameValue\"\n            };\n\n            string json;\n\n            json = JsonConvert.SerializeObject(personRaw);\n            Assert.AreEqual(@\"{\"\"first_name\"\":\"\"FirstNameValue\"\",\"\"RawContent\"\":[1,2,3,4,5],\"\"last_name\"\":\"\"LastNameValue\"\"}\", json);\n        }\n\n        [Test]\n        public void DeserializeJsonRaw()\n        {\n            string json = @\"{\"\"first_name\"\":\"\"FirstNameValue\"\",\"\"RawContent\"\":[1,2,3,4,5],\"\"last_name\"\":\"\"LastNameValue\"\"}\";\n\n            PersonRaw personRaw = JsonConvert.DeserializeObject<PersonRaw>(json);\n\n            Assert.AreEqual(\"FirstNameValue\", personRaw.FirstName);\n            Assert.AreEqual(\"[1,2,3,4,5]\", personRaw.RawContent.ToString());\n            Assert.AreEqual(\"LastNameValue\", personRaw.LastName);\n        }\n\n        [Test]\n        public void DeserializeNullableMember()\n        {\n            UserNullable userNullablle = new UserNullable\n            {\n                Id = new Guid(\"AD6205E8-0DF4-465d-AEA6-8BA18E93A7E7\"),\n                FName = \"FirstValue\",\n                LName = \"LastValue\",\n                RoleId = 5,\n                NullableRoleId = 6,\n                NullRoleId = null,\n                Active = true\n            };\n\n            string json = JsonConvert.SerializeObject(userNullablle);\n\n            Assert.AreEqual(@\"{\"\"Id\"\":\"\"ad6205e8-0df4-465d-aea6-8ba18e93a7e7\"\",\"\"FName\"\":\"\"FirstValue\"\",\"\"LName\"\":\"\"LastValue\"\",\"\"RoleId\"\":5,\"\"NullableRoleId\"\":6,\"\"NullRoleId\"\":null,\"\"Active\"\":true}\", json);\n\n            UserNullable userNullablleDeserialized = JsonConvert.DeserializeObject<UserNullable>(json);\n\n            Assert.AreEqual(new Guid(\"AD6205E8-0DF4-465d-AEA6-8BA18E93A7E7\"), userNullablleDeserialized.Id);\n            Assert.AreEqual(\"FirstValue\", userNullablleDeserialized.FName);\n            Assert.AreEqual(\"LastValue\", userNullablleDeserialized.LName);\n            Assert.AreEqual(5, userNullablleDeserialized.RoleId);\n            Assert.AreEqual(6, userNullablleDeserialized.NullableRoleId);\n            Assert.AreEqual(null, userNullablleDeserialized.NullRoleId);\n            Assert.AreEqual(true, userNullablleDeserialized.Active);\n        }\n\n        [Test]\n        public void DeserializeInt64ToNullableDouble()\n        {\n            string json = @\"{\"\"Height\"\":1}\";\n\n            DoubleClass c = JsonConvert.DeserializeObject<DoubleClass>(json);\n            Assert.AreEqual(1, c.Height);\n        }\n\n        [Test]\n        public void SerializeTypeProperty()\n        {\n            string boolRef = typeof(bool).AssemblyQualifiedName;\n            TypeClass typeClass = new TypeClass { TypeProperty = typeof(bool) };\n\n            string json = JsonConvert.SerializeObject(typeClass);\n            Assert.AreEqual(@\"{\"\"TypeProperty\"\":\"\"\" + boolRef + @\"\"\"}\", json);\n\n            TypeClass typeClass2 = JsonConvert.DeserializeObject<TypeClass>(json);\n            Assert.AreEqual(typeof(bool), typeClass2.TypeProperty);\n\n            string jsonSerializerTestRef = typeof(JsonSerializerTest).AssemblyQualifiedName;\n            typeClass = new TypeClass { TypeProperty = typeof(JsonSerializerTest) };\n\n            json = JsonConvert.SerializeObject(typeClass);\n            Assert.AreEqual(@\"{\"\"TypeProperty\"\":\"\"\" + jsonSerializerTestRef + @\"\"\"}\", json);\n\n            typeClass2 = JsonConvert.DeserializeObject<TypeClass>(json);\n            Assert.AreEqual(typeof(JsonSerializerTest), typeClass2.TypeProperty);\n        }\n\n        [Test]\n        public void RequiredMembersClass()\n        {\n            RequiredMembersClass c = new RequiredMembersClass()\n            {\n                BirthDate = new DateTime(2000, 12, 20, 10, 55, 55, DateTimeKind.Utc),\n                FirstName = \"Bob\",\n                LastName = \"Smith\",\n                MiddleName = \"Cosmo\"\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"FirstName\"\": \"\"Bob\"\",\n  \"\"MiddleName\"\": \"\"Cosmo\"\",\n  \"\"LastName\"\": \"\"Smith\"\",\n  \"\"BirthDate\"\": \"\"2000-12-20T10:55:55Z\"\"\n}\", json);\n\n            RequiredMembersClass c2 = JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n\n            Assert.AreEqual(\"Bob\", c2.FirstName);\n            Assert.AreEqual(new DateTime(2000, 12, 20, 10, 55, 55, DateTimeKind.Utc), c2.BirthDate);\n        }\n\n        [Test]\n        public void DeserializeRequiredMembersClassWithNullValues()\n        {\n            string json = @\"{\n  \"\"FirstName\"\": \"\"I can't be null bro!\"\",\n  \"\"MiddleName\"\": null,\n  \"\"LastName\"\": null,\n  \"\"BirthDate\"\": \"\"\\/Date(977309755000)\\/\"\"\n}\";\n\n            RequiredMembersClass c = JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n\n            Assert.AreEqual(\"I can't be null bro!\", c.FirstName);\n            Assert.AreEqual(null, c.MiddleName);\n            Assert.AreEqual(null, c.LastName);\n        }\n\n        [Test]\n        public void DeserializeRequiredMembersClassNullRequiredValueProperty()\n        {\n            try\n            {\n                string json = @\"{\n  \"\"FirstName\"\": null,\n  \"\"MiddleName\"\": null,\n  \"\"LastName\"\": null,\n  \"\"BirthDate\"\": \"\"\\/Date(977309755000)\\/\"\"\n}\";\n\n                JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'FirstName' expects a value but got null. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void SerializeRequiredMembersClassNullRequiredValueProperty()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                RequiredMembersClass requiredMembersClass = new RequiredMembersClass\n                {\n                    FirstName = null,\n                    BirthDate = new DateTime(2000, 10, 10, 10, 10, 10, DateTimeKind.Utc),\n                    LastName = null,\n                    MiddleName = null\n                };\n\n                string json = JsonConvert.SerializeObject(requiredMembersClass);\n            }, \"Cannot write a null value for property 'FirstName'. Property requires a value. Path ''.\");\n        }\n\n        [Test]\n        public void RequiredMembersClassMissingRequiredProperty()\n        {\n            try\n            {\n                string json = @\"{\n  \"\"FirstName\"\": \"\"Bob\"\"\n}\";\n\n                JsonConvert.DeserializeObject<RequiredMembersClass>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'LastName' not found in JSON. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void SerializeJaggedArray()\n        {\n            JaggedArray aa = new JaggedArray();\n            aa.Before = \"Before!\";\n            aa.After = \"After!\";\n            aa.Coordinates = new[] { new[] { 1, 1 }, new[] { 1, 2 }, new[] { 2, 1 }, new[] { 2, 2 } };\n\n            string json = JsonConvert.SerializeObject(aa);\n\n            Assert.AreEqual(@\"{\"\"Before\"\":\"\"Before!\"\",\"\"Coordinates\"\":[[1,1],[1,2],[2,1],[2,2]],\"\"After\"\":\"\"After!\"\"}\", json);\n        }\n\n        [Test]\n        public void DeserializeJaggedArray()\n        {\n            string json = @\"{\"\"Before\"\":\"\"Before!\"\",\"\"Coordinates\"\":[[1,1],[1,2],[2,1],[2,2]],\"\"After\"\":\"\"After!\"\"}\";\n\n            JaggedArray aa = JsonConvert.DeserializeObject<JaggedArray>(json);\n\n            Assert.AreEqual(\"Before!\", aa.Before);\n            Assert.AreEqual(\"After!\", aa.After);\n            Assert.AreEqual(4, aa.Coordinates.Length);\n            Assert.AreEqual(2, aa.Coordinates[0].Length);\n            Assert.AreEqual(1, aa.Coordinates[0][0]);\n            Assert.AreEqual(2, aa.Coordinates[1][1]);\n\n            string after = JsonConvert.SerializeObject(aa);\n\n            Assert.AreEqual(json, after);\n        }\n\n        [Test]\n        public void DeserializeGoogleGeoCode()\n        {\n            string json = @\"{\n  \"\"name\"\": \"\"1600 Amphitheatre Parkway, Mountain View, CA, USA\"\",\n  \"\"Status\"\": {\n    \"\"code\"\": 200,\n    \"\"request\"\": \"\"geocode\"\"\n  },\n  \"\"Placemark\"\": [\n    {\n      \"\"address\"\": \"\"1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA\"\",\n      \"\"AddressDetails\"\": {\n        \"\"Country\"\": {\n          \"\"CountryNameCode\"\": \"\"US\"\",\n          \"\"AdministrativeArea\"\": {\n            \"\"AdministrativeAreaName\"\": \"\"CA\"\",\n            \"\"SubAdministrativeArea\"\": {\n              \"\"SubAdministrativeAreaName\"\": \"\"Santa Clara\"\",\n              \"\"Locality\"\": {\n                \"\"LocalityName\"\": \"\"Mountain View\"\",\n                \"\"Thoroughfare\"\": {\n                  \"\"ThoroughfareName\"\": \"\"1600 Amphitheatre Pkwy\"\"\n                },\n                \"\"PostalCode\"\": {\n                  \"\"PostalCodeNumber\"\": \"\"94043\"\"\n                }\n              }\n            }\n          }\n        },\n        \"\"Accuracy\"\": 8\n      },\n      \"\"Point\"\": {\n        \"\"coordinates\"\": [-122.083739, 37.423021, 0]\n      }\n    }\n  ]\n}\";\n\n            GoogleMapGeocoderStructure jsonGoogleMapGeocoder = JsonConvert.DeserializeObject<GoogleMapGeocoderStructure>(json);\n        }\n\n        [Test]\n        public void DeserializeInterfaceProperty()\n        {\n            InterfacePropertyTestClass testClass = new InterfacePropertyTestClass();\n            testClass.co = new Co();\n            String strFromTest = JsonConvert.SerializeObject(testClass);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                InterfacePropertyTestClass testFromDe = (InterfacePropertyTestClass)JsonConvert.DeserializeObject(strFromTest, typeof(InterfacePropertyTestClass));\n            }, @\"Could not create an instance of type Newtonsoft.Json.Tests.TestObjects.ICo. Type is an interface or abstract class and cannot be instantiated. Path 'co.Name', line 1, position 14.\");\n        }\n\n        private Person GetPerson()\n        {\n            Person person = new Person\n            {\n                Name = \"Mike Manager\",\n                BirthDate = new DateTime(1983, 8, 3, 0, 0, 0, DateTimeKind.Utc),\n                Department = \"IT\",\n                LastModified = new DateTime(2009, 2, 15, 0, 0, 0, DateTimeKind.Utc)\n            };\n            return person;\n        }\n\n        [Test]\n        public void WriteJsonDates()\n        {\n            LogEntry entry = new LogEntry\n            {\n                LogDate = new DateTime(2009, 2, 15, 0, 0, 0, DateTimeKind.Utc),\n                Details = \"Application started.\"\n            };\n\n            string defaultJson = JsonConvert.SerializeObject(entry);\n            // {\"Details\":\"Application started.\",\"LogDate\":\"\\/Date(1234656000000)\\/\"}\n\n            string isoJson = JsonConvert.SerializeObject(entry, new IsoDateTimeConverter());\n            // {\"Details\":\"Application started.\",\"LogDate\":\"2009-02-15T00:00:00.0000000Z\"}\n\n            string javascriptJson = JsonConvert.SerializeObject(entry, new JavaScriptDateTimeConverter());\n            // {\"Details\":\"Application started.\",\"LogDate\":new Date(1234656000000)}\n\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":\"\"2009-02-15T00:00:00Z\"\"}\", defaultJson);\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":\"\"2009-02-15T00:00:00Z\"\"}\", isoJson);\n            Assert.AreEqual(@\"{\"\"Details\"\":\"\"Application started.\"\",\"\"LogDate\"\":new Date(1234656000000)}\", javascriptJson);\n        }\n\n        [Test]\n        public void GenericListAndDictionaryInterfaceProperties()\n        {\n            GenericListAndDictionaryInterfaceProperties o = new GenericListAndDictionaryInterfaceProperties();\n            o.IDictionaryProperty = new Dictionary<string, int>\n            {\n                { \"one\", 1 },\n                { \"two\", 2 },\n                { \"three\", 3 }\n            };\n            o.IListProperty = new List<int>\n            {\n                1, 2, 3\n            };\n            o.IEnumerableProperty = new List<int>\n            {\n                4, 5, 6\n            };\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"IEnumerableProperty\"\": [\n    4,\n    5,\n    6\n  ],\n  \"\"IListProperty\"\": [\n    1,\n    2,\n    3\n  ],\n  \"\"IDictionaryProperty\"\": {\n    \"\"one\"\": 1,\n    \"\"two\"\": 2,\n    \"\"three\"\": 3\n  }\n}\", json);\n\n            GenericListAndDictionaryInterfaceProperties deserializedObject = JsonConvert.DeserializeObject<GenericListAndDictionaryInterfaceProperties>(json);\n            Assert.IsNotNull(deserializedObject);\n\n            CollectionAssert.AreEqual(o.IListProperty.ToArray(), deserializedObject.IListProperty.ToArray());\n            CollectionAssert.AreEqual(o.IEnumerableProperty.ToArray(), deserializedObject.IEnumerableProperty.ToArray());\n            CollectionAssert.AreEqual(o.IDictionaryProperty.ToArray(), deserializedObject.IDictionaryProperty.ToArray());\n        }\n\n        [Test]\n        public void DeserializeBestMatchPropertyCase()\n        {\n            string json = @\"{\n  \"\"firstName\"\": \"\"firstName\"\",\n  \"\"FirstName\"\": \"\"FirstName\"\",\n  \"\"LastName\"\": \"\"LastName\"\",\n  \"\"lastName\"\": \"\"lastName\"\",\n}\";\n\n            PropertyCase o = JsonConvert.DeserializeObject<PropertyCase>(json);\n            Assert.IsNotNull(o);\n\n            Assert.AreEqual(\"firstName\", o.firstName);\n            Assert.AreEqual(\"FirstName\", o.FirstName);\n            Assert.AreEqual(\"LastName\", o.LastName);\n            Assert.AreEqual(\"lastName\", o.lastName);\n        }\n\n        [Test]\n        public void PopulateDefaultValueWhenUsingConstructor()\n        {\n            string json = \"{ 'testProperty1': 'value' }\";\n\n            ConstructorAndDefaultValueAttributeTestClass c = JsonConvert.DeserializeObject<ConstructorAndDefaultValueAttributeTestClass>(json, new JsonSerializerSettings\n            {\n                DefaultValueHandling = DefaultValueHandling.Populate\n            });\n            Assert.AreEqual(\"value\", c.TestProperty1);\n            Assert.AreEqual(21, c.TestProperty2);\n\n            c = JsonConvert.DeserializeObject<ConstructorAndDefaultValueAttributeTestClass>(json, new JsonSerializerSettings\n            {\n                DefaultValueHandling = DefaultValueHandling.IgnoreAndPopulate\n            });\n            Assert.AreEqual(\"value\", c.TestProperty1);\n            Assert.AreEqual(21, c.TestProperty2);\n        }\n\n        [Test]\n        public void RequiredWhenUsingConstructor()\n        {\n            try\n            {\n                string json = \"{ 'testProperty1': 'value' }\";\n                JsonConvert.DeserializeObject<ConstructorAndRequiredTestClass>(json);\n\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Required property 'TestProperty2' not found in JSON. Path ''\"));\n            }\n        }\n\n        [Test]\n        public void DeserializePropertiesOnToNonDefaultConstructor()\n        {\n            SubKlass i = new SubKlass(\"my subprop\");\n            i.SuperProp = \"overrided superprop\";\n\n            string json = JsonConvert.SerializeObject(i);\n            Assert.AreEqual(@\"{\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", json);\n\n            SubKlass ii = JsonConvert.DeserializeObject<SubKlass>(json);\n\n            string newJson = JsonConvert.SerializeObject(ii);\n            Assert.AreEqual(@\"{\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", newJson);\n        }\n\n        [Test]\n        public void DeserializePropertiesOnToNonDefaultConstructorWithReferenceTracking()\n        {\n            SubKlass i = new SubKlass(\"my subprop\");\n            i.SuperProp = \"overrided superprop\";\n\n            string json = JsonConvert.SerializeObject(i, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n\n            Assert.AreEqual(@\"{\"\"$id\"\":\"\"1\"\",\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", json);\n\n            SubKlass ii = JsonConvert.DeserializeObject<SubKlass>(json, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n\n            string newJson = JsonConvert.SerializeObject(ii, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects\n            });\n            Assert.AreEqual(@\"{\"\"$id\"\":\"\"1\"\",\"\"SubProp\"\":\"\"my subprop\"\",\"\"SuperProp\"\":\"\"overrided superprop\"\"}\", newJson);\n        }\n\n        [Test]\n        public void SerializeJsonPropertyWithHandlingValues()\n        {\n            JsonPropertyWithHandlingValues o = new JsonPropertyWithHandlingValues();\n            o.DefaultValueHandlingIgnoreProperty = \"Default!\";\n            o.DefaultValueHandlingIncludeProperty = \"Default!\";\n            o.DefaultValueHandlingPopulateProperty = \"Default!\";\n            o.DefaultValueHandlingIgnoreAndPopulateProperty = \"Default!\";\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultValueHandlingIncludeProperty\"\": \"\"Default!\"\",\n  \"\"DefaultValueHandlingPopulateProperty\"\": \"\"Default!\"\",\n  \"\"NullValueHandlingIncludeProperty\"\": null,\n  \"\"ReferenceLoopHandlingErrorProperty\"\": null,\n  \"\"ReferenceLoopHandlingIgnoreProperty\"\": null,\n  \"\"ReferenceLoopHandlingSerializeProperty\"\": null\n}\", json);\n\n            json = JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings { NullValueHandling = NullValueHandling.Ignore });\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultValueHandlingIncludeProperty\"\": \"\"Default!\"\",\n  \"\"DefaultValueHandlingPopulateProperty\"\": \"\"Default!\"\",\n  \"\"NullValueHandlingIncludeProperty\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeJsonPropertyWithHandlingValues()\n        {\n            string json = \"{}\";\n\n            JsonPropertyWithHandlingValues o = JsonConvert.DeserializeObject<JsonPropertyWithHandlingValues>(json);\n            Assert.AreEqual(\"Default!\", o.DefaultValueHandlingIgnoreAndPopulateProperty);\n            Assert.AreEqual(\"Default!\", o.DefaultValueHandlingPopulateProperty);\n            Assert.AreEqual(null, o.DefaultValueHandlingIgnoreProperty);\n            Assert.AreEqual(null, o.DefaultValueHandlingIncludeProperty);\n        }\n\n        [Test]\n        public void JsonPropertyWithHandlingValues_ReferenceLoopError()\n        {\n            string classRef = typeof(JsonPropertyWithHandlingValues).FullName;\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonPropertyWithHandlingValues o = new JsonPropertyWithHandlingValues();\n                o.ReferenceLoopHandlingErrorProperty = o;\n\n                JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings { ReferenceLoopHandling = ReferenceLoopHandling.Ignore });\n            }, \"Self referencing loop detected for property 'ReferenceLoopHandlingErrorProperty' with type '\" + classRef + \"'. Path ''.\");\n        }\n\n        [Test]\n        public void PartialClassDeserialize()\n        {\n            string json = @\"{\n    \"\"request\"\": \"\"ux.settings.update\"\",\n    \"\"sid\"\": \"\"14c561bd-32a8-457e-b4e5-4bba0832897f\"\",\n    \"\"uid\"\": \"\"30c39065-0f31-de11-9442-001e3786a8ec\"\",\n    \"\"fidOrder\"\": [\n        \"\"id\"\",\n        \"\"andytest_name\"\",\n        \"\"andytest_age\"\",\n        \"\"andytest_address\"\",\n        \"\"andytest_phone\"\",\n        \"\"date\"\",\n        \"\"title\"\",\n        \"\"titleId\"\"\n    ],\n    \"\"entityName\"\": \"\"Andy Test\"\",\n    \"\"setting\"\": \"\"entity.field.order\"\"\n}\";\n\n            RequestOnly r = JsonConvert.DeserializeObject<RequestOnly>(json);\n            Assert.AreEqual(\"ux.settings.update\", r.Request);\n\n            NonRequest n = JsonConvert.DeserializeObject<NonRequest>(json);\n            Assert.AreEqual(new Guid(\"14c561bd-32a8-457e-b4e5-4bba0832897f\"), n.Sid);\n            Assert.AreEqual(new Guid(\"30c39065-0f31-de11-9442-001e3786a8ec\"), n.Uid);\n            Assert.AreEqual(8, n.FidOrder.Count);\n            Assert.AreEqual(\"id\", n.FidOrder[0]);\n            Assert.AreEqual(\"titleId\", n.FidOrder[n.FidOrder.Count - 1]);\n        }\n\n#if !(NET20 || DNXCORE50)\n        [Test]\n        public void OptInClassMetadataSerialization()\n        {\n            OptInClass optInClass = new OptInClass();\n            optInClass.Age = 26;\n            optInClass.Name = \"James NK\";\n            optInClass.NotIncluded = \"Poor me :(\";\n\n            string json = JsonConvert.SerializeObject(optInClass, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": \"\"James NK\"\",\n  \"\"Age\"\": 26\n}\", json);\n\n            OptInClass newOptInClass = JsonConvert.DeserializeObject<OptInClass>(@\"{\n  \"\"Name\"\": \"\"James NK\"\",\n  \"\"NotIncluded\"\": \"\"Ignore me!\"\",\n  \"\"Age\"\": 26\n}\");\n            Assert.AreEqual(26, newOptInClass.Age);\n            Assert.AreEqual(\"James NK\", newOptInClass.Name);\n            Assert.AreEqual(null, newOptInClass.NotIncluded);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void SerializeDataContractPrivateMembers()\n        {\n            DataContractPrivateMembers c = new DataContractPrivateMembers(\"Jeff\", 26, 10, \"Dr\");\n            c.NotIncluded = \"Hi\";\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"_name\"\": \"\"Jeff\"\",\n  \"\"_age\"\": 26,\n  \"\"Rank\"\": 10,\n  \"\"JsonTitle\"\": \"\"Dr\"\"\n}\", json);\n\n            DataContractPrivateMembers cc = JsonConvert.DeserializeObject<DataContractPrivateMembers>(json);\n            Assert.AreEqual(\"_name: Jeff, _age: 26, Rank: 10, JsonTitle: Dr\", cc.ToString());\n        }\n#endif\n\n        [Test]\n        public void DeserializeDictionaryInterface()\n        {\n            string json = @\"{\n  \"\"Name\"\": \"\"Name!\"\",\n  \"\"Dictionary\"\": {\n    \"\"Item\"\": 11\n  }\n}\";\n\n            DictionaryInterfaceClass c = JsonConvert.DeserializeObject<DictionaryInterfaceClass>(\n                json,\n                new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Replace });\n\n            Assert.AreEqual(\"Name!\", c.Name);\n            Assert.AreEqual(1, c.Dictionary.Count);\n            Assert.AreEqual(11, c.Dictionary[\"Item\"]);\n        }\n\n        [Test]\n        public void DeserializeDictionaryInterfaceWithExistingValues()\n        {\n            string json = @\"{\n  \"\"Random\"\": {\n    \"\"blah\"\": 1\n  },\n  \"\"Name\"\": \"\"Name!\"\",\n  \"\"Dictionary\"\": {\n    \"\"Item\"\": 11,\n    \"\"Item1\"\": 12\n  },\n  \"\"Collection\"\": [\n    999\n  ],\n  \"\"Employee\"\": {\n    \"\"Manager\"\": {\n      \"\"Name\"\": \"\"ManagerName!\"\"\n    }\n  }\n}\";\n\n            DictionaryInterfaceClass c = JsonConvert.DeserializeObject<DictionaryInterfaceClass>(json,\n                new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Reuse });\n\n            Assert.AreEqual(\"Name!\", c.Name);\n            Assert.AreEqual(3, c.Dictionary.Count);\n            Assert.AreEqual(11, c.Dictionary[\"Item\"]);\n            Assert.AreEqual(1, c.Dictionary[\"existing\"]);\n            Assert.AreEqual(4, c.Collection.Count);\n            Assert.AreEqual(1, c.Collection.ElementAt(0));\n            Assert.AreEqual(999, c.Collection.ElementAt(3));\n            Assert.AreEqual(\"EmployeeName!\", c.Employee.Name);\n            Assert.AreEqual(\"ManagerName!\", c.Employee.Manager.Name);\n            Assert.IsNotNull(c.Random);\n        }\n\n        [Test]\n        public void TypedObjectDeserializationWithComments()\n        {\n            string json = @\"/*comment1*/ { /*comment2*/\n        \"\"Name\"\": /*comment3*/ \"\"Apple\"\" /*comment4*/, /*comment5*/\n        \"\"ExpiryDate\"\": \"\"\\/Date(1230422400000)\\/\"\",\n        \"\"Price\"\": 3.99,\n        \"\"Sizes\"\": /*comment6*/ [ /*comment7*/\n          \"\"Small\"\", /*comment8*/\n          \"\"Medium\"\" /*comment9*/,\n          /*comment10*/ \"\"Large\"\"\n        /*comment11*/ ] /*comment12*/\n      } /*comment13*/\";\n\n            Product deserializedProduct = (Product)JsonConvert.DeserializeObject(json, typeof(Product));\n\n            Assert.AreEqual(\"Apple\", deserializedProduct.Name);\n            Assert.AreEqual(new DateTime(2008, 12, 28, 0, 0, 0, DateTimeKind.Utc), deserializedProduct.ExpiryDate);\n            Assert.AreEqual(3.99m, deserializedProduct.Price);\n            Assert.AreEqual(\"Small\", deserializedProduct.Sizes[0]);\n            Assert.AreEqual(\"Medium\", deserializedProduct.Sizes[1]);\n            Assert.AreEqual(\"Large\", deserializedProduct.Sizes[2]);\n        }\n\n        [Test]\n        public void NestedInsideOuterObject()\n        {\n            string json = @\"{\n  \"\"short\"\": {\n    \"\"original\"\": \"\"http://www.contrast.ie/blog/online&#45;marketing&#45;2009/\"\",\n    \"\"short\"\": \"\"m2sqc6\"\",\n    \"\"shortened\"\": \"\"http://short.ie/m2sqc6\"\",\n    \"\"error\"\": {\n      \"\"code\"\": 0,\n      \"\"msg\"\": \"\"No action taken\"\"\n    }\n  }\n}\";\n\n            JObject o = JObject.Parse(json);\n\n            Shortie s = JsonConvert.DeserializeObject<Shortie>(o[\"short\"].ToString());\n            Assert.IsNotNull(s);\n\n            Assert.AreEqual(s.Original, \"http://www.contrast.ie/blog/online&#45;marketing&#45;2009/\");\n            Assert.AreEqual(s.Short, \"m2sqc6\");\n            Assert.AreEqual(s.Shortened, \"http://short.ie/m2sqc6\");\n        }\n\n        [Test]\n        public void UriSerialization()\n        {\n            Uri uri = new Uri(\"http://codeplex.com\");\n            string json = JsonConvert.SerializeObject(uri);\n\n            Assert.AreEqual(\"http://codeplex.com/\", uri.ToString());\n\n            Uri newUri = JsonConvert.DeserializeObject<Uri>(json);\n            Assert.AreEqual(uri, newUri);\n        }\n\n        [Test]\n        public void AnonymousPlusLinqToSql()\n        {\n            var value = new\n            {\n                bar = new JObject(new JProperty(\"baz\", 13))\n            };\n\n            string json = JsonConvert.SerializeObject(value);\n\n            Assert.AreEqual(@\"{\"\"bar\"\":{\"\"baz\"\":13}}\", json);\n        }\n\n        [Test]\n        public void SerializeEnumerableAsObject()\n        {\n            Content content = new Content\n            {\n                Text = \"Blah, blah, blah\",\n                Children = new List<Content>\n                {\n                    new Content { Text = \"First\" },\n                    new Content { Text = \"Second\" }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(content, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Children\"\": [\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"First\"\"\n    },\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"Second\"\"\n    }\n  ],\n  \"\"Text\"\": \"\"Blah, blah, blah\"\"\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeEnumerableAsObject()\n        {\n            string json = @\"{\n  \"\"Children\"\": [\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"First\"\"\n    },\n    {\n      \"\"Children\"\": null,\n      \"\"Text\"\": \"\"Second\"\"\n    }\n  ],\n  \"\"Text\"\": \"\"Blah, blah, blah\"\"\n}\";\n\n            Content content = JsonConvert.DeserializeObject<Content>(json);\n\n            Assert.AreEqual(\"Blah, blah, blah\", content.Text);\n            Assert.AreEqual(2, content.Children.Count);\n            Assert.AreEqual(\"First\", content.Children[0].Text);\n            Assert.AreEqual(\"Second\", content.Children[1].Text);\n        }\n\n        [Test]\n        public void RoleTransferTest()\n        {\n            string json = @\"{\"\"Operation\"\":\"\"1\"\",\"\"RoleName\"\":\"\"Admin\"\",\"\"Direction\"\":\"\"0\"\"}\";\n\n            RoleTransfer r = JsonConvert.DeserializeObject<RoleTransfer>(json);\n\n            Assert.AreEqual(RoleTransferOperation.Second, r.Operation);\n            Assert.AreEqual(\"Admin\", r.RoleName);\n            Assert.AreEqual(RoleTransferDirection.First, r.Direction);\n        }\n\n        [Test]\n        public void DeserializeGenericDictionary()\n        {\n            string json = @\"{\"\"key1\"\":\"\"value1\"\",\"\"key2\"\":\"\"value2\"\"}\";\n\n            Dictionary<string, string> values = JsonConvert.DeserializeObject<Dictionary<string, string>>(json);\n\n            Assert.AreEqual(2, values.Count);\n            Assert.AreEqual(\"value1\", values[\"key1\"]);\n            Assert.AreEqual(\"value2\", values[\"key2\"]);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeEmptyStringToNullableDateTime()\n        {\n            string json = @\"{\"\"DateTimeField\"\":\"\"\"\"}\";\n\n            NullableDateTimeTestClass c = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(json);\n            Assert.AreEqual(null, c.DateTimeField);\n        }\n#endif\n\n        [Test]\n        public void FailWhenClassWithNoDefaultConstructorHasMultipleConstructorsWithArguments()\n        {\n            string json = @\"{\"\"sublocation\"\":\"\"AlertEmailSender.Program.Main\"\",\"\"userId\"\":0,\"\"type\"\":0,\"\"summary\"\":\"\"Loading settings variables\"\",\"\"details\"\":null,\"\"stackTrace\"\":\"\"   at System.Environment.GetStackTrace(Exception e, Boolean needFileInfo)\\r\\n   at System.Environment.get_StackTrace()\\r\\n   at mr.Logging.Event..ctor(String summary) in C:\\\\Projects\\\\MRUtils\\\\Logging\\\\Event.vb:line 71\\r\\n   at AlertEmailSender.Program.Main(String[] args) in C:\\\\Projects\\\\AlertEmailSender\\\\AlertEmailSender\\\\Program.cs:line 25\"\",\"\"tag\"\":null,\"\"time\"\":\"\"\\/Date(1249591032026-0400)\\/\"\"}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Event>(json); }, @\"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.Events.Event. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'sublocation', line 1, position 15.\");\n        }\n\n        [Test]\n        public void DeserializeObjectSetOnlyProperty()\n        {\n            string json = @\"{'SetOnlyProperty':[1,2,3,4,5]}\";\n\n            SetOnlyPropertyClass2 setOnly = JsonConvert.DeserializeObject<SetOnlyPropertyClass2>(json);\n            JArray a = (JArray)setOnly.GetValue();\n            Assert.AreEqual(5, a.Count);\n            Assert.AreEqual(1, (int)a[0]);\n            Assert.AreEqual(5, (int)a[a.Count - 1]);\n        }\n\n        [Test]\n        public void DeserializeOptInClasses()\n        {\n            string json = @\"{id: \"\"12\"\", name: \"\"test\"\", items: [{id: \"\"112\"\", name: \"\"testing\"\"}]}\";\n\n            ListTestClass l = JsonConvert.DeserializeObject<ListTestClass>(json);\n        }\n\n        [Test]\n        public void DeserializeNullableListWithNulls()\n        {\n            List<decimal?> l = JsonConvert.DeserializeObject<List<decimal?>>(\"[ 3.3, null, 1.1 ] \");\n            Assert.AreEqual(3, l.Count);\n\n            Assert.AreEqual(3.3m, l[0]);\n            Assert.AreEqual(null, l[1]);\n            Assert.AreEqual(1.1m, l[2]);\n        }\n\n        [Test]\n        public void CannotDeserializeArrayIntoObject()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Person>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n\n        [Test]\n        public void CannotDeserializeArrayIntoDictionary()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Dictionary<string, string>>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'System.Collections.Generic.Dictionary`2[System.String,System.String]' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n\n#if !(PORTABLE || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void CannotDeserializeArrayIntoSerializable()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Exception>(json); }, @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'System.Exception' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n#endif\n\n        [Test]\n        public void CannotDeserializeArrayIntoDouble()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => { JsonConvert.DeserializeObject<double>(json); },\n                @\"Unexpected character encountered while parsing value: [. Path '', line 1, position 1.\");\n        }\n\n#if !(NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void CannotDeserializeArrayIntoDynamic()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(\n                () => { JsonConvert.DeserializeObject<DynamicDictionary>(json); },\n                @\"Cannot deserialize the current JSON array (e.g. [1,2,3]) into type 'Newtonsoft.Json.Tests.Linq.DynamicDictionary' because the type requires a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) to deserialize correctly.\nTo fix this error either change the JSON to a JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) or change the deserialized type to an array or a type that implements a collection interface (e.g. ICollection, IList) like List<T> that can be deserialized from a JSON array. JsonArrayAttribute can also be added to the type to force it to deserialize from a JSON array.\nPath '', line 1, position 1.\");\n        }\n#endif\n\n        [Test]\n        public void CannotDeserializeArrayIntoLinqToJson()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<InvalidCastException>(\n                () => { JsonConvert.DeserializeObject<JObject>(json); },\n                new[]\n                {\n                    \"Unable to cast object of type 'Newtonsoft.Json.Linq.JArray' to type 'Newtonsoft.Json.Linq.JObject'.\",\n                    \"Cannot cast from source type to destination type.\" // mono\n                });\n        }\n\n        [Test]\n        public void CannotDeserializeConstructorIntoObject()\n        {\n            string json = @\"new Constructor(123)\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Person>(json); }, @\"Error converting value \"\"Constructor\"\" to type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '', line 1, position 16.\");\n        }\n\n        [Test]\n        public void CannotDeserializeConstructorIntoObjectNested()\n        {\n            string json = @\"[new Constructor(123)]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<List<Person>>(json); }, @\"Error converting value \"\"Constructor\"\" to type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '[0]', line 1, position 17.\");\n        }\n\n        [Test]\n        public void CannotDeserializeObjectIntoArray()\n        {\n            string json = @\"{}\";\n\n            try\n            {\n                JsonConvert.DeserializeObject<List<Person>>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(@\"Cannot deserialize the current JSON object (e.g. {\"\"name\"\":\"\"value\"\"}) into type 'System.Collections.Generic.List`1[Newtonsoft.Json.Tests.TestObjects.Organization.Person]' because the type requires a JSON array (e.g. [1,2,3]) to deserialize correctly.\" + Environment.NewLine +\n                                                    @\"To fix this error either change the JSON to a JSON array (e.g. [1,2,3]) or change the deserialized type so that it is a normal .NET type (e.g. not a primitive type like integer, not a collection type like an array or List<T>) that can be deserialized from a JSON object. JsonObjectAttribute can also be added to the type to force it to deserialize from a JSON object.\" + Environment.NewLine +\n                                                    @\"Path ''\"));\n            }\n        }\n\n        [Test]\n        public void CannotPopulateArrayIntoObject()\n        {\n            string json = @\"[]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.PopulateObject(json, new Person()); }, @\"Cannot populate JSON array onto type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Path '', line 1, position 1.\");\n        }\n\n        [Test]\n        public void CannotPopulateObjectIntoArray()\n        {\n            string json = @\"{}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.PopulateObject(json, new List<Person>()); }, @\"Cannot populate JSON object onto type 'System.Collections.Generic.List`1[Newtonsoft.Json.Tests.TestObjects.Organization.Person]'. Path '', line 1, position 2.\");\n        }\n\n        [Test]\n        public void DeserializeEmptyString()\n        {\n            string json = @\"{\"\"Name\"\":\"\"\"\"}\";\n\n            Person p = JsonConvert.DeserializeObject<Person>(json);\n            Assert.AreEqual(\"\", p.Name);\n        }\n\n        [Test]\n        public void SerializePropertyGetError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.SerializeObject(new MemoryStream(), new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error getting value from 'ReadTimeout' on 'System.IO.MemoryStream'.\");\n        }\n\n        [Test]\n        public void DeserializePropertySetError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:0}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error setting value to 'ReadTimeout' on 'System.IO.MemoryStream'.\");\n        }\n\n        [Test]\n        public void DeserializeEnsureTypeEmptyStringToIntError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:''}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error converting value {null} to type 'System.Int32'. Path 'ReadTimeout', line 1, position 15.\");\n        }\n\n        [Test]\n        public void DeserializeEnsureTypeNullToIntError()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                JsonConvert.DeserializeObject<MemoryStream>(\"{ReadTimeout:null}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n                        IgnoreSerializableAttribute = true\n#endif\n                    }\n                });\n            }, @\"Error converting value {null} to type 'System.Int32'. Path 'ReadTimeout', line 1, position 17.\");\n        }\n\n        [Test]\n        public void SerializeGenericListOfStrings()\n        {\n            List<String> strings = new List<String>();\n\n            strings.Add(\"str_1\");\n            strings.Add(\"str_2\");\n            strings.Add(\"str_3\");\n\n            string json = JsonConvert.SerializeObject(strings);\n            Assert.AreEqual(@\"[\"\"str_1\"\",\"\"str_2\"\",\"\"str_3\"\"]\", json);\n        }\n\n        [Test]\n        public void ConstructorReadonlyFieldsTest()\n        {\n            ConstructorReadonlyFields c1 = new ConstructorReadonlyFields(\"String!\", int.MaxValue);\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"A\"\": \"\"String!\"\",\n  \"\"B\"\": 2147483647\n}\", json);\n\n            ConstructorReadonlyFields c2 = JsonConvert.DeserializeObject<ConstructorReadonlyFields>(json);\n            Assert.AreEqual(\"String!\", c2.A);\n            Assert.AreEqual(int.MaxValue, c2.B);\n        }\n\n        [Test]\n        public void SerializeStruct()\n        {\n            StructTest structTest = new StructTest\n            {\n                StringProperty = \"StringProperty!\",\n                StringField = \"StringField\",\n                IntProperty = 5,\n                IntField = 10\n            };\n\n            string json = JsonConvert.SerializeObject(structTest, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"StringField\"\": \"\"StringField\"\",\n  \"\"IntField\"\": 10,\n  \"\"StringProperty\"\": \"\"StringProperty!\"\",\n  \"\"IntProperty\"\": 5\n}\", json);\n\n            StructTest deserialized = JsonConvert.DeserializeObject<StructTest>(json);\n            Assert.AreEqual(structTest.StringProperty, deserialized.StringProperty);\n            Assert.AreEqual(structTest.StringField, deserialized.StringField);\n            Assert.AreEqual(structTest.IntProperty, deserialized.IntProperty);\n            Assert.AreEqual(structTest.IntField, deserialized.IntField);\n        }\n\n        [Test]\n        public void SerializeListWithJsonConverter()\n        {\n            Foo f = new Foo();\n            f.Bars.Add(new Bar { Id = 0 });\n            f.Bars.Add(new Bar { Id = 1 });\n            f.Bars.Add(new Bar { Id = 2 });\n\n            string json = JsonConvert.SerializeObject(f, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Bars\"\": [\n    0,\n    1,\n    2\n  ]\n}\", json);\n\n            Foo newFoo = JsonConvert.DeserializeObject<Foo>(json);\n            Assert.AreEqual(3, newFoo.Bars.Count);\n            Assert.AreEqual(0, newFoo.Bars[0].Id);\n            Assert.AreEqual(1, newFoo.Bars[1].Id);\n            Assert.AreEqual(2, newFoo.Bars[2].Id);\n        }\n\n        [Test]\n        public void SerializeGuidKeyedDictionary()\n        {\n            Dictionary<Guid, int> dictionary = new Dictionary<Guid, int>();\n            dictionary.Add(new Guid(\"F60EAEE0-AE47-488E-B330-59527B742D77\"), 1);\n            dictionary.Add(new Guid(\"C2594C02-EBA1-426A-AA87-8DD8871350B0\"), 2);\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"f60eaee0-ae47-488e-b330-59527b742d77\"\": 1,\n  \"\"c2594c02-eba1-426a-aa87-8dd8871350b0\"\": 2\n}\", json);\n        }\n\n        [Test]\n        public void SerializePersonKeyedDictionary()\n        {\n            Dictionary<Person, int> dictionary = new Dictionary<Person, int>();\n            dictionary.Add(new Person { Name = \"p1\" }, 1);\n            dictionary.Add(new Person { Name = \"p2\" }, 2);\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 1,\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 2\n}\", json);\n        }\n\n        [Test]\n        public void DeserializePersonKeyedDictionary()\n        {\n            try\n            {\n                string json =\n                    @\"{\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 1,\n  \"\"Newtonsoft.Json.Tests.TestObjects.Organization.Person\"\": 2\n}\";\n\n                JsonConvert.DeserializeObject<Dictionary<Person, int>>(json);\n                Assert.Fail();\n            }\n            catch (JsonSerializationException ex)\n            {\n                Assert.IsTrue(ex.Message.StartsWith(\"Could not convert string 'Newtonsoft.Json.Tests.TestObjects.Organization.Person' to dictionary key type 'Newtonsoft.Json.Tests.TestObjects.Organization.Person'. Create a TypeConverter to convert from the string to the key type object. Path '['Newtonsoft.Json.Tests.TestObjects.Organization.Person']'\"));\n            }\n        }\n\n        [Test]\n        public void SerializeFragment()\n        {\n            string googleSearchText = @\"{\n        \"\"responseData\"\": {\n          \"\"results\"\": [\n            {\n              \"\"GsearchResultClass\"\": \"\"GwebSearch\"\",\n              \"\"unescapedUrl\"\": \"\"http://en.wikipedia.org/wiki/Paris_Hilton\"\",\n              \"\"url\"\": \"\"http://en.wikipedia.org/wiki/Paris_Hilton\"\",\n              \"\"visibleUrl\"\": \"\"en.wikipedia.org\"\",\n              \"\"cacheUrl\"\": \"\"http://www.google.com/search?q=cache:TwrPfhd22hYJ:en.wikipedia.org\"\",\n              \"\"title\"\": \"\"<b>Paris Hilton</b> - Wikipedia, the free encyclopedia\"\",\n              \"\"titleNoFormatting\"\": \"\"Paris Hilton - Wikipedia, the free encyclopedia\"\",\n              \"\"content\"\": \"\"[1] In 2006, she released her debut album...\"\"\n            },\n            {\n              \"\"GsearchResultClass\"\": \"\"GwebSearch\"\",\n              \"\"unescapedUrl\"\": \"\"http://www.imdb.com/name/nm0385296/\"\",\n              \"\"url\"\": \"\"http://www.imdb.com/name/nm0385296/\"\",\n              \"\"visibleUrl\"\": \"\"www.imdb.com\"\",\n              \"\"cacheUrl\"\": \"\"http://www.google.com/search?q=cache:1i34KkqnsooJ:www.imdb.com\"\",\n              \"\"title\"\": \"\"<b>Paris Hilton</b>\"\",\n              \"\"titleNoFormatting\"\": \"\"Paris Hilton\"\",\n              \"\"content\"\": \"\"Self: Zoolander. Socialite <b>Paris Hilton</b>...\"\"\n            }\n          ],\n          \"\"cursor\"\": {\n            \"\"pages\"\": [\n              {\n                \"\"start\"\": \"\"0\"\",\n                \"\"label\"\": 1\n              },\n              {\n                \"\"start\"\": \"\"4\"\",\n                \"\"label\"\": 2\n              },\n              {\n                \"\"start\"\": \"\"8\"\",\n                \"\"label\"\": 3\n              },\n              {\n                \"\"start\"\": \"\"12\"\",\n                \"\"label\"\": 4\n              }\n            ],\n            \"\"estimatedResultCount\"\": \"\"59600000\"\",\n            \"\"currentPageIndex\"\": 0,\n            \"\"moreResultsUrl\"\": \"\"http://www.google.com/search?oe=utf8&ie=utf8...\"\"\n          }\n        },\n        \"\"responseDetails\"\": null,\n        \"\"responseStatus\"\": 200\n      }\";\n\n            JObject googleSearch = JObject.Parse(googleSearchText);\n\n            // get JSON result objects into a list\n            IList<JToken> results = googleSearch[\"responseData\"][\"results\"].Children().ToList();\n\n            // serialize JSON results into .NET objects\n            IList<SearchResult> searchResults = new List<SearchResult>();\n            foreach (JToken result in results)\n            {\n                SearchResult searchResult = JsonConvert.DeserializeObject<SearchResult>(result.ToString());\n                searchResults.Add(searchResult);\n            }\n\n            // Title = <b>Paris Hilton</b> - Wikipedia, the free encyclopedia\n            // Content = [1] In 2006, she released her debut album...\n            // Url = http://en.wikipedia.org/wiki/Paris_Hilton\n\n            // Title = <b>Paris Hilton</b>\n            // Content = Self: Zoolander. Socialite <b>Paris Hilton</b>...\n            // Url = http://www.imdb.com/name/nm0385296/\n\n            Assert.AreEqual(2, searchResults.Count);\n            Assert.AreEqual(\"<b>Paris Hilton</b> - Wikipedia, the free encyclopedia\", searchResults[0].Title);\n            Assert.AreEqual(\"<b>Paris Hilton</b>\", searchResults[1].Title);\n        }\n\n        [Test]\n        public void DeserializeBaseReferenceWithDerivedValue()\n        {\n            PersonPropertyClass personPropertyClass = new PersonPropertyClass();\n            WagePerson wagePerson = (WagePerson)personPropertyClass.Person;\n\n            wagePerson.BirthDate = new DateTime(2000, 11, 29, 23, 59, 59, DateTimeKind.Utc);\n            wagePerson.Department = \"McDees\";\n            wagePerson.HourlyWage = 12.50m;\n            wagePerson.LastModified = new DateTime(2000, 11, 29, 23, 59, 59, DateTimeKind.Utc);\n            wagePerson.Name = \"Jim Bob\";\n\n            string json = JsonConvert.SerializeObject(personPropertyClass, Formatting.Indented);\n            StringAssert.AreEqual(\n                @\"{\n  \"\"Person\"\": {\n    \"\"HourlyWage\"\": 12.50,\n    \"\"Name\"\": \"\"Jim Bob\"\",\n    \"\"BirthDate\"\": \"\"2000-11-29T23:59:59Z\"\",\n    \"\"LastModified\"\": \"\"2000-11-29T23:59:59Z\"\"\n  }\n}\",\n                json);\n\n            PersonPropertyClass newPersonPropertyClass = JsonConvert.DeserializeObject<PersonPropertyClass>(json);\n            Assert.AreEqual(wagePerson.HourlyWage, ((WagePerson)newPersonPropertyClass.Person).HourlyWage);\n        }\n\n        [Test]\n        public void DeserializePopulateDictionaryAndList()\n        {\n            ExistingValueClass d = JsonConvert.DeserializeObject<ExistingValueClass>(@\"{'Dictionary':{appended:'appended',existing:'new'}}\");\n\n            Assert.IsNotNull(d);\n            Assert.IsNotNull(d.Dictionary);\n            Assert.AreEqual(typeof(Dictionary<string, string>), d.Dictionary.GetType());\n            Assert.AreEqual(typeof(List<string>), d.List.GetType());\n            Assert.AreEqual(2, d.Dictionary.Count);\n            Assert.AreEqual(\"new\", d.Dictionary[\"existing\"]);\n            Assert.AreEqual(\"appended\", d.Dictionary[\"appended\"]);\n            Assert.AreEqual(1, d.List.Count);\n            Assert.AreEqual(\"existing\", d.List[0]);\n        }\n\n        [Test]\n        public void IgnoreIndexedProperties()\n        {\n            ThisGenericTest<KeyValueId> g = new ThisGenericTest<KeyValueId>();\n\n            g.Add(new KeyValueId { Id = 1, Key = \"key1\", Value = \"value1\" });\n            g.Add(new KeyValueId { Id = 2, Key = \"key2\", Value = \"value2\" });\n\n            g.MyProperty = \"some value\";\n\n            string json = g.ToJson();\n\n            StringAssert.AreEqual(@\"{\n  \"\"MyProperty\"\": \"\"some value\"\",\n  \"\"TheItems\"\": [\n    {\n      \"\"Id\"\": 1,\n      \"\"Key\"\": \"\"key1\"\",\n      \"\"Value\"\": \"\"value1\"\"\n    },\n    {\n      \"\"Id\"\": 2,\n      \"\"Key\"\": \"\"key2\"\",\n      \"\"Value\"\": \"\"value2\"\"\n    }\n  ]\n}\", json);\n\n            ThisGenericTest<KeyValueId> gen = JsonConvert.DeserializeObject<ThisGenericTest<KeyValueId>>(json);\n            Assert.AreEqual(\"some value\", gen.MyProperty);\n        }\n\n        [Test]\n        public void JRawValue()\n        {\n            JRawValueTestObject deserialized = JsonConvert.DeserializeObject<JRawValueTestObject>(\"{value:3}\");\n            Assert.AreEqual(\"3\", deserialized.Value.ToString());\n\n            deserialized = JsonConvert.DeserializeObject<JRawValueTestObject>(\"{value:'3'}\");\n            Assert.AreEqual(@\"\"\"3\"\"\", deserialized.Value.ToString());\n        }\n\n        [Test]\n        public void DeserializeDictionaryWithNoDefaultConstructor()\n        {\n            string json = \"{key1:'value1',key2:'value2',key3:'value3'}\";\n\n            var dic = JsonConvert.DeserializeObject<DictionaryWithNoDefaultConstructor>(json);\n\n            Assert.AreEqual(3, dic.Count);\n            Assert.AreEqual(\"value1\", dic[\"key1\"]);\n            Assert.AreEqual(\"value2\", dic[\"key2\"]);\n            Assert.AreEqual(\"value3\", dic[\"key3\"]);\n        }\n\n        [Test]\n        public void DeserializeDictionaryWithNoDefaultConstructor_PreserveReferences()\n        {\n            string json = \"{'$id':'1',key1:'value1',key2:'value2',key3:'value3'}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<DictionaryWithNoDefaultConstructor>(json, new JsonSerializerSettings\n            {\n                PreserveReferencesHandling = PreserveReferencesHandling.All,\n                MetadataPropertyHandling = MetadataPropertyHandling.Default\n            }), \"Cannot preserve reference to readonly dictionary, or dictionary created from a non-default constructor: Newtonsoft.Json.Tests.TestObjects.DictionaryWithNoDefaultConstructor. Path 'key1', line 1, position 16.\");\n        }\n\n        [Test]\n        public void SerializeNonPublicBaseJsonProperties()\n        {\n            B value = new B();\n            string json = JsonConvert.SerializeObject(value, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"B2\"\": null,\n  \"\"A1\"\": null,\n  \"\"B3\"\": null,\n  \"\"A2\"\": null\n}\", json);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeDateTimeOffsetAndDateTime()\n        {\n            string jsonIsoText =\n                @\"{\"\"DateTimeOffsetValue\"\":\"\"2012-02-25T19:55:50.6095676+00:00\"\", \"\"DateTimeValue\"\":\"\"2012-02-25T19:55:50.6095676+00:00\"\"}\";\n\n            DateTimeOffsetWrapper cISO = JsonConvert.DeserializeObject<DateTimeOffsetWrapper>(jsonIsoText, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.DateTimeOffset,\n                Converters =\n                {\n                    new IsoDateTimeConverter()\n                }\n            });\n            DateTimeOffsetWrapper c = JsonConvert.DeserializeObject<DateTimeOffsetWrapper>(jsonIsoText, new JsonSerializerSettings\n            {\n                DateParseHandling = DateParseHandling.DateTimeOffset\n            });\n\n            Assert.AreEqual(c.DateTimeOffsetValue, cISO.DateTimeOffsetValue);\n        }\n#endif\n\n        [Test]\n        public void CircularConstructorDeserialize()\n        {\n            CircularConstructor1 c1 = new CircularConstructor1(null)\n            {\n                StringProperty = \"Value!\"\n            };\n\n            CircularConstructor2 c2 = new CircularConstructor2(null)\n            {\n                IntProperty = 1\n            };\n\n            c1.C2 = c2;\n            c2.C1 = c1;\n\n            string json = JsonConvert.SerializeObject(c1, new JsonSerializerSettings\n            {\n                ReferenceLoopHandling = ReferenceLoopHandling.Ignore,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"C2\"\": {\n    \"\"IntProperty\"\": 1\n  },\n  \"\"StringProperty\"\": \"\"Value!\"\"\n}\", json);\n\n            CircularConstructor1 newC1 = JsonConvert.DeserializeObject<CircularConstructor1>(@\"{\n  \"\"C2\"\": {\n    \"\"IntProperty\"\": 1,\n    \"\"C1\"\": {}\n  },\n  \"\"StringProperty\"\": \"\"Value!\"\"\n}\");\n\n            Assert.AreEqual(\"Value!\", newC1.StringProperty);\n            Assert.AreEqual(1, newC1.C2.IntProperty);\n            Assert.AreEqual(null, newC1.C2.C1.StringProperty);\n            Assert.AreEqual(null, newC1.C2.C1.C2);\n        }\n\n        [Test]\n        public void DeserializeToObjectProperty()\n        {\n            var json = \"{ Key: 'abc', Value: 123 }\";\n            var item = JsonConvert.DeserializeObject<KeyValueTestClass>(json);\n\n            Assert.AreEqual(123L, item.Value);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void DataContractJsonSerializerTest()\n        {\n            DataContractJsonSerializerTestClass c = new DataContractJsonSerializerTestClass()\n            {\n                TimeSpanProperty = new TimeSpan(200, 20, 59, 30, 900),\n                GuidProperty = new Guid(\"66143115-BE2A-4a59-AF0A-348E1EA15B1E\"),\n                AnimalProperty = new Human() { Ethnicity = \"European\" }\n            };\n            MemoryStream ms = new MemoryStream();\n            DataContractJsonSerializer serializer = new DataContractJsonSerializer(\n                typeof(DataContractJsonSerializerTestClass),\n                new Type[] { typeof(Human) });\n            serializer.WriteObject(ms, c);\n\n            byte[] jsonBytes = ms.ToArray();\n            string json = Encoding.UTF8.GetString(jsonBytes, 0, jsonBytes.Length);\n\n            //Console.WriteLine(JObject.Parse(json).ToString());\n            //Console.WriteLine();\n\n            //Console.WriteLine(JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            //  {\n            //    //               TypeNameHandling = TypeNameHandling.Objects\n            //  }));\n        }\n#endif\n\n        [Test]\n        public void SerializeNonIDictionary()\n        {\n            ModelStateDictionary<string> modelStateDictionary = new ModelStateDictionary<string>();\n            modelStateDictionary.Add(\"key\", \"value\");\n\n            string json = JsonConvert.SerializeObject(modelStateDictionary);\n\n            Assert.AreEqual(@\"{\"\"key\"\":\"\"value\"\"}\", json);\n\n            ModelStateDictionary<string> newModelStateDictionary = JsonConvert.DeserializeObject<ModelStateDictionary<string>>(json);\n            Assert.AreEqual(1, newModelStateDictionary.Count);\n            Assert.AreEqual(\"value\", newModelStateDictionary[\"key\"]);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n#if DEBUG\n        [Test]\n        public void SerializeISerializableInPartialTrustWithIgnoreInterface()\n        {\n            try\n            {\n                JsonTypeReflector.SetFullyTrusted(false);\n                ISerializableTestObject value = new ISerializableTestObject(\"string!\", 0, default(DateTimeOffset), null);\n\n                string json = JsonConvert.SerializeObject(value, new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableInterface = true\n                    }\n                });\n\n                Assert.AreEqual(\"{}\", json);\n\n                value = JsonConvert.DeserializeObject<ISerializableTestObject>(\"{booleanValue:true}\", new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableInterface = true\n                    }\n                });\n\n                Assert.IsNotNull(value);\n                Assert.AreEqual(false, value._booleanValue);\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n\n        [Test]\n        public void SerializeISerializableInPartialTrust()\n        {\n            try\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonTypeReflector.SetFullyTrusted(false);\n\n                    JsonConvert.DeserializeObject<ISerializableTestObject>(\"{booleanValue:true}\");\n                }, @\"Type 'Newtonsoft.Json.Tests.TestObjects.ISerializableTestObject' implements ISerializable but cannot be deserialized using the ISerializable interface because the current application is not fully trusted and ISerializable can expose secure data.\" + Environment.NewLine +\n                   @\"To fix this error either change the environment to be fully trusted, change the application to not deserialize the type, add JsonObjectAttribute to the type or change the JsonSerializer setting ContractResolver to use a new DefaultContractResolver with IgnoreSerializableInterface set to true.\" + Environment.NewLine +\n                   @\"Path 'booleanValue', line 1, position 14.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n\n        [Test]\n        public void DeserializeISerializableInPartialTrust()\n        {\n            try\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonTypeReflector.SetFullyTrusted(false);\n                    ISerializableTestObject value = new ISerializableTestObject(\"string!\", 0, default(DateTimeOffset), null);\n\n                    JsonConvert.SerializeObject(value);\n                }, @\"Type 'Newtonsoft.Json.Tests.TestObjects.ISerializableTestObject' implements ISerializable but cannot be serialized using the ISerializable interface because the current application is not fully trusted and ISerializable can expose secure data.\" + Environment.NewLine +\n                   @\"To fix this error either change the environment to be fully trusted, change the application to not deserialize the type, add JsonObjectAttribute to the type or change the JsonSerializer setting ContractResolver to use a new DefaultContractResolver with IgnoreSerializableInterface set to true.\" + Environment.NewLine +\n                   @\"Path ''.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(null);\n            }\n        }\n#endif\n\n        [Test]\n        public void SerializeISerializableTestObject_IsoDate()\n        {\n            Person person = new Person();\n            person.BirthDate = new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc);\n            person.LastModified = person.BirthDate;\n            person.Department = \"Department!\";\n            person.Name = \"Name!\";\n\n            DateTimeOffset dateTimeOffset = new DateTimeOffset(2000, 12, 20, 22, 59, 59, TimeSpan.FromHours(2));\n            string dateTimeOffsetText;\n#if !NET20\n            dateTimeOffsetText = @\"2000-12-20T22:59:59+02:00\";\n#else\n            dateTimeOffsetText = @\"12/20/2000 22:59:59 +02:00\";\n#endif\n\n            ISerializableTestObject o = new ISerializableTestObject(\"String!\", int.MinValue, dateTimeOffset, person);\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"stringValue\"\": \"\"String!\"\",\n  \"\"intValue\"\": -2147483648,\n  \"\"dateTimeOffsetValue\"\": \"\"\" + dateTimeOffsetText + @\"\"\",\n  \"\"personValue\"\": {\n    \"\"Name\"\": \"\"Name!\"\",\n    \"\"BirthDate\"\": \"\"2000-01-01T01:01:01Z\"\",\n    \"\"LastModified\"\": \"\"2000-01-01T01:01:01Z\"\"\n  },\n  \"\"nullPersonValue\"\": null,\n  \"\"nullableInt\"\": null,\n  \"\"booleanValue\"\": false,\n  \"\"byteValue\"\": 0,\n  \"\"charValue\"\": \"\"\\u0000\"\",\n  \"\"dateTimeValue\"\": \"\"0001-01-01T00:00:00Z\"\",\n  \"\"decimalValue\"\": 0.0,\n  \"\"shortValue\"\": 0,\n  \"\"longValue\"\": 0,\n  \"\"sbyteValue\"\": 0,\n  \"\"floatValue\"\": 0.0,\n  \"\"ushortValue\"\": 0,\n  \"\"uintValue\"\": 0,\n  \"\"ulongValue\"\": 0\n}\", json);\n\n            ISerializableTestObject o2 = JsonConvert.DeserializeObject<ISerializableTestObject>(json);\n            Assert.AreEqual(\"String!\", o2._stringValue);\n            Assert.AreEqual(int.MinValue, o2._intValue);\n            Assert.AreEqual(dateTimeOffset, o2._dateTimeOffsetValue);\n            Assert.AreEqual(\"Name!\", o2._personValue.Name);\n            Assert.AreEqual(null, o2._nullPersonValue);\n            Assert.AreEqual(null, o2._nullableInt);\n        }\n\n        [Test]\n        public void SerializeISerializableTestObject_MsAjax()\n        {\n            Person person = new Person();\n            person.BirthDate = new DateTime(2000, 1, 1, 1, 1, 1, DateTimeKind.Utc);\n            person.LastModified = person.BirthDate;\n            person.Department = \"Department!\";\n            person.Name = \"Name!\";\n\n            DateTimeOffset dateTimeOffset = new DateTimeOffset(2000, 12, 20, 22, 59, 59, TimeSpan.FromHours(2));\n            string dateTimeOffsetText;\n#if !NET20\n            dateTimeOffsetText = @\"\\/Date(977345999000+0200)\\/\";\n#else\n            dateTimeOffsetText = @\"12/20/2000 22:59:59 +02:00\";\n#endif\n\n            ISerializableTestObject o = new ISerializableTestObject(\"String!\", int.MinValue, dateTimeOffset, person);\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n            StringAssert.AreEqual(@\"{\n  \"\"stringValue\"\": \"\"String!\"\",\n  \"\"intValue\"\": -2147483648,\n  \"\"dateTimeOffsetValue\"\": \"\"\" + dateTimeOffsetText + @\"\"\",\n  \"\"personValue\"\": {\n    \"\"Name\"\": \"\"Name!\"\",\n    \"\"BirthDate\"\": \"\"\\/Date(946688461000)\\/\"\",\n    \"\"LastModified\"\": \"\"\\/Date(946688461000)\\/\"\"\n  },\n  \"\"nullPersonValue\"\": null,\n  \"\"nullableInt\"\": null,\n  \"\"booleanValue\"\": false,\n  \"\"byteValue\"\": 0,\n  \"\"charValue\"\": \"\"\\u0000\"\",\n  \"\"dateTimeValue\"\": \"\"\\/Date(-62135596800000)\\/\"\",\n  \"\"decimalValue\"\": 0.0,\n  \"\"shortValue\"\": 0,\n  \"\"longValue\"\": 0,\n  \"\"sbyteValue\"\": 0,\n  \"\"floatValue\"\": 0.0,\n  \"\"ushortValue\"\": 0,\n  \"\"uintValue\"\": 0,\n  \"\"ulongValue\"\": 0\n}\", json);\n\n            ISerializableTestObject o2 = JsonConvert.DeserializeObject<ISerializableTestObject>(json);\n            Assert.AreEqual(\"String!\", o2._stringValue);\n            Assert.AreEqual(int.MinValue, o2._intValue);\n            Assert.AreEqual(dateTimeOffset, o2._dateTimeOffsetValue);\n            Assert.AreEqual(\"Name!\", o2._personValue.Name);\n            Assert.AreEqual(null, o2._nullPersonValue);\n            Assert.AreEqual(null, o2._nullableInt);\n        }\n#endif\n\n        [Test]\n        public void DeserializeUsingNonDefaultConstructorWithLeftOverValues()\n        {\n            List<KVPair<string, string>> kvPairs =\n                JsonConvert.DeserializeObject<List<KVPair<string, string>>>(\n                    \"[{\\\"Key\\\":\\\"Two\\\",\\\"Value\\\":\\\"2\\\"},{\\\"Key\\\":\\\"One\\\",\\\"Value\\\":\\\"1\\\"}]\");\n\n            Assert.AreEqual(2, kvPairs.Count);\n            Assert.AreEqual(\"Two\", kvPairs[0].Key);\n            Assert.AreEqual(\"2\", kvPairs[0].Value);\n            Assert.AreEqual(\"One\", kvPairs[1].Key);\n            Assert.AreEqual(\"1\", kvPairs[1].Value);\n        }\n\n        [Test]\n        public void SerializeClassWithInheritedProtectedMember()\n        {\n            AATestClass myA = new AATestClass(2);\n            string json = JsonConvert.SerializeObject(myA, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"AA_field1\"\": 2,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2\n}\", json);\n\n            BBTestClass myB = new BBTestClass(3, 4);\n            json = JsonConvert.SerializeObject(myB, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"BB_field1\"\": 4,\n  \"\"BB_field2\"\": 4,\n  \"\"AA_field1\"\": 3,\n  \"\"BB_property1\"\": 4,\n  \"\"BB_property2\"\": 4,\n  \"\"BB_property3\"\": 4,\n  \"\"BB_property4\"\": 4,\n  \"\"BB_property5\"\": 4,\n  \"\"BB_property7\"\": 4,\n  \"\"AA_property1\"\": 3,\n  \"\"AA_property2\"\": 3,\n  \"\"AA_property3\"\": 3,\n  \"\"AA_property4\"\": 3\n}\", json);\n        }\n\n#if !(PORTABLE) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeClassWithInheritedProtectedMember()\n        {\n            AATestClass myA = JsonConvert.DeserializeObject<AATestClass>(\n                @\"{\n  \"\"AA_field1\"\": 2,\n  \"\"AA_field2\"\": 2,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2,\n  \"\"AA_property5\"\": 2,\n  \"\"AA_property6\"\": 2\n}\");\n\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field1\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field2\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property1\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property2\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property3\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property5\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property6\", BindingFlags.Instance | BindingFlags.NonPublic), myA));\n\n            BBTestClass myB = JsonConvert.DeserializeObject<BBTestClass>(\n                @\"{\n  \"\"BB_field1\"\": 4,\n  \"\"BB_field2\"\": 4,\n  \"\"AA_field1\"\": 3,\n  \"\"AA_field2\"\": 3,\n  \"\"AA_property1\"\": 2,\n  \"\"AA_property2\"\": 2,\n  \"\"AA_property3\"\": 2,\n  \"\"AA_property4\"\": 2,\n  \"\"AA_property5\"\": 2,\n  \"\"AA_property6\"\": 2,\n  \"\"BB_property1\"\": 3,\n  \"\"BB_property2\"\": 3,\n  \"\"BB_property3\"\": 3,\n  \"\"BB_property4\"\": 3,\n  \"\"BB_property5\"\": 3,\n  \"\"BB_property6\"\": 3,\n  \"\"BB_property7\"\": 3,\n  \"\"BB_property8\"\": 3\n}\");\n\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field1\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetField(\"AA_field2\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property1\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property2\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property3\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(2, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property5\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, ReflectionUtils.GetMemberValue(typeof(AATestClass).GetProperty(\"AA_property6\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n\n            Assert.AreEqual(4, myB.BB_field1);\n            Assert.AreEqual(4, myB.BB_field2);\n            Assert.AreEqual(3, myB.BB_property1);\n            Assert.AreEqual(3, myB.BB_property2);\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property3\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property4\", BindingFlags.Instance | BindingFlags.NonPublic), myB));\n            Assert.AreEqual(0, myB.BB_property5);\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property6\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property7\", BindingFlags.Instance | BindingFlags.Public), myB));\n            Assert.AreEqual(3, ReflectionUtils.GetMemberValue(typeof(BBTestClass).GetProperty(\"BB_property8\", BindingFlags.Instance | BindingFlags.Public), myB));\n        }\n#endif\n\n#if !(NET20 || PORTABLE40)\n        [Test]\n        public void SerializeDeserializeXNodeProperties()\n        {\n            XNodeTestObject testObject = new XNodeTestObject();\n            testObject.Document = XDocument.Parse(\"<root>hehe, root</root>\");\n            testObject.Element = XElement.Parse(@\"<fifth xmlns:json=\"\"http://json.org\"\" json:Awesome=\"\"true\"\">element</fifth>\");\n\n            string json = JsonConvert.SerializeObject(testObject, Formatting.Indented);\n            string expected = @\"{\n  \"\"Document\"\": {\n    \"\"root\"\": \"\"hehe, root\"\"\n  },\n  \"\"Element\"\": {\n    \"\"fifth\"\": {\n      \"\"@xmlns:json\"\": \"\"http://json.org\"\",\n      \"\"@json:Awesome\"\": \"\"true\"\",\n      \"\"#text\"\": \"\"element\"\"\n    }\n  }\n}\";\n            StringAssert.AreEqual(expected, json);\n\n            XNodeTestObject newTestObject = JsonConvert.DeserializeObject<XNodeTestObject>(json);\n            Assert.AreEqual(testObject.Document.ToString(), newTestObject.Document.ToString());\n            Assert.AreEqual(testObject.Element.ToString(), newTestObject.Element.ToString());\n\n            Assert.IsNull(newTestObject.Element.Parent);\n        }\n#endif\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeDeserializeXmlNodeProperties()\n        {\n            XmlNodeTestObject testObject = new XmlNodeTestObject();\n            XmlDocument document = new XmlDocument();\n            document.LoadXml(\"<root>hehe, root</root>\");\n            testObject.Document = document;\n\n            string json = JsonConvert.SerializeObject(testObject, Formatting.Indented);\n            string expected = @\"{\n  \"\"Document\"\": {\n    \"\"root\"\": \"\"hehe, root\"\"\n  }\n}\";\n            StringAssert.AreEqual(expected, json);\n\n            XmlNodeTestObject newTestObject = JsonConvert.DeserializeObject<XmlNodeTestObject>(json);\n            Assert.AreEqual(testObject.Document.InnerXml, newTestObject.Document.InnerXml);\n        }\n#endif\n\n        [Test]\n        public void FullClientMapSerialization()\n        {\n            ClientMap source = new ClientMap()\n            {\n                position = new Pos() { X = 100, Y = 200 },\n                center = new PosDouble() { X = 251.6, Y = 361.3 }\n            };\n\n            string json = JsonConvert.SerializeObject(source, new PosConverter(), new PosDoubleConverter());\n            Assert.AreEqual(\"{\\\"position\\\":new Pos(100,200),\\\"center\\\":new PosD(251.6,361.3)}\", json);\n        }\n\n        [Test]\n        public void SerializeRefAdditionalContent()\n        {\n            //Additional text found in JSON string after finishing deserializing object.\n            //Test 1\n            var reference = new Dictionary<string, object>();\n            reference.Add(\"$ref\", \"Persons\");\n            reference.Add(\"$id\", 1);\n\n            var child = new Dictionary<string, object>();\n            child.Add(\"_id\", 2);\n            child.Add(\"Name\", \"Isabell\");\n            child.Add(\"Father\", reference);\n\n            var json = JsonConvert.SerializeObject(child, Formatting.Indented);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<Dictionary<string, object>>(json); }, \"Additional content found in JSON reference object. A JSON reference object should only have a $ref property. Path 'Father.$id', line 6, position 10.\");\n        }\n\n        [Test]\n        public void SerializeRefBadType()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                //Additional text found in JSON string after finishing deserializing object.\n                //Test 1\n                var reference = new Dictionary<string, object>();\n                reference.Add(\"$ref\", 1);\n                reference.Add(\"$id\", 1);\n\n                var child = new Dictionary<string, object>();\n                child.Add(\"_id\", 2);\n                child.Add(\"Name\", \"Isabell\");\n                child.Add(\"Father\", reference);\n\n                var json = JsonConvert.SerializeObject(child, Formatting.Indented);\n                JsonConvert.DeserializeObject<Dictionary<string, object>>(json);\n            }, \"JSON reference $ref property must have a string or null value. Path 'Father.$ref', line 5, position 13.\");\n        }\n\n        [Test]\n        public void SerializeRefNull()\n        {\n            var reference = new Dictionary<string, object>();\n            reference.Add(\"$ref\", null);\n            reference.Add(\"$id\", null);\n            reference.Add(\"blah\", \"blah!\");\n\n            var child = new Dictionary<string, object>();\n            child.Add(\"_id\", 2);\n            child.Add(\"Name\", \"Isabell\");\n            child.Add(\"Father\", reference);\n\n            string json = JsonConvert.SerializeObject(child);\n\n            Assert.AreEqual(@\"{\"\"_id\"\":2,\"\"Name\"\":\"\"Isabell\"\",\"\"Father\"\":{\"\"$ref\"\":null,\"\"$id\"\":null,\"\"blah\"\":\"\"blah!\"\"}}\", json);\n\n            Dictionary<string, object> result = JsonConvert.DeserializeObject<Dictionary<string, object>>(json);\n\n            Assert.AreEqual(3, result.Count);\n            Assert.AreEqual(1, ((JObject)result[\"Father\"]).Count);\n            Assert.AreEqual(\"blah!\", (string)((JObject)result[\"Father\"])[\"blah\"]);\n        }\n\n        [Test]\n        public void DeserializeIgnoredPropertyInConstructor()\n        {\n            string json = @\"{\"\"First\"\":\"\"First\"\",\"\"Second\"\":2,\"\"Ignored\"\":{\"\"Name\"\":\"\"James\"\"},\"\"AdditionalContent\"\":{\"\"LOL\"\":true}}\";\n\n            var cc = JsonConvert.DeserializeObject<ConstructorCompexIgnoredProperty>(json);\n            Assert.AreEqual(\"First\", cc.First);\n            Assert.AreEqual(2, cc.Second);\n            Assert.AreEqual(null, cc.Ignored);\n        }\n        \n        [Test]\n        public void DeserializeIgnoredPropertyInConstructorWithoutThrowingMissingMemberError()\n        {\n            string json = @\"{\"\"First\"\":\"\"First\"\",\"\"Second\"\":2,\"\"Ignored\"\":{\"\"Name\"\":\"\"James\"\"}}\";\n\n            var cc = JsonConvert.DeserializeObject<ConstructorCompexIgnoredProperty>(\n                json, new JsonSerializerSettings\n                {\n                    MissingMemberHandling = MissingMemberHandling.Error\n                });\n            Assert.AreEqual(\"First\", cc.First);\n            Assert.AreEqual(2, cc.Second);\n            Assert.AreEqual(null, cc.Ignored);\n        }\n\n        [Test]\n        public void DeserializeFloatAsDecimal()\n        {\n            string json = @\"{'value':9.9}\";\n\n            var dic = JsonConvert.DeserializeObject<IDictionary<string, object>>(\n                json, new JsonSerializerSettings\n                {\n                    FloatParseHandling = FloatParseHandling.Decimal\n                });\n\n            Assert.AreEqual(typeof(decimal), dic[\"value\"].GetType());\n            Assert.AreEqual(9.9m, dic[\"value\"]);\n        }\n\n        [Test]\n        public void SerializeDeserializeDictionaryKey()\n        {\n            Dictionary<DictionaryKey, string> dictionary = new Dictionary<DictionaryKey, string>();\n\n            dictionary.Add(new DictionaryKey() { Value = \"First!\" }, \"First\");\n            dictionary.Add(new DictionaryKey() { Value = \"Second!\" }, \"Second\");\n\n            string json = JsonConvert.SerializeObject(dictionary, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"First!\"\": \"\"First\"\",\n  \"\"Second!\"\": \"\"Second\"\"\n}\", json);\n\n            Dictionary<DictionaryKey, string> newDictionary =\n                JsonConvert.DeserializeObject<Dictionary<DictionaryKey, string>>(json);\n\n            Assert.AreEqual(2, newDictionary.Count);\n        }\n\n        [Test]\n        public void SerializeNullableArray()\n        {\n            string jsonText = JsonConvert.SerializeObject(new double?[] { 2.4, 4.3, null }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  2.4,\n  4.3,\n  null\n]\", jsonText);\n        }\n\n        [Test]\n        public void DeserializeNullableArray()\n        {\n            double?[] d = (double?[])JsonConvert.DeserializeObject(@\"[\n  2.4,\n  4.3,\n  null\n]\", typeof(double?[]));\n\n            Assert.AreEqual(3, d.Length);\n            Assert.AreEqual(2.4, d[0]);\n            Assert.AreEqual(4.3, d[1]);\n            Assert.AreEqual(null, d[2]);\n        }\n\n#if !NET20\n        [Test]\n        public void SerializeHashSet()\n        {\n            string jsonText = JsonConvert.SerializeObject(new HashSet<string>()\n            {\n                \"One\",\n                \"2\",\n                \"III\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  \"\"One\"\",\n  \"\"2\"\",\n  \"\"III\"\"\n]\", jsonText);\n\n            HashSet<string> d = JsonConvert.DeserializeObject<HashSet<string>>(jsonText);\n\n            Assert.AreEqual(3, d.Count);\n            Assert.IsTrue(d.Contains(\"One\"));\n            Assert.IsTrue(d.Contains(\"2\"));\n            Assert.IsTrue(d.Contains(\"III\"));\n        }\n#endif\n\n        [Test]\n        public void DeserializeByteArray()\n        {\n            JsonSerializer serializer1 = new JsonSerializer();\n            serializer1.Converters.Add(new IsoDateTimeConverter());\n            serializer1.NullValueHandling = NullValueHandling.Ignore;\n\n            string json = @\"[{\"\"Prop1\"\":\"\"\"\"},{\"\"Prop1\"\":\"\"\"\"}]\";\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n\n            ByteArrayTestClass[] z = (ByteArrayTestClass[])serializer1.Deserialize(reader, typeof(ByteArrayTestClass[]));\n            Assert.AreEqual(2, z.Length);\n            Assert.AreEqual(0, z[0].Prop1.Length);\n            Assert.AreEqual(0, z[1].Prop1.Length);\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void StringDictionaryTest()\n        {\n            string classRef = typeof(StringDictionary).FullName;\n\n            StringDictionaryTestClass s1 = new StringDictionaryTestClass()\n            {\n                StringDictionaryProperty = new StringDictionary()\n                {\n                    { \"1\", \"One\" },\n                    { \"2\", \"II\" },\n                    { \"3\", \"3\" }\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(s1, Formatting.Indented);\n\n            // .NET 4.5.3 added IDictionary<string, string> to StringDictionary\n            if (s1.StringDictionaryProperty is IDictionary<string, string>)\n            {\n                StringDictionaryTestClass d = JsonConvert.DeserializeObject<StringDictionaryTestClass>(json);\n\n                Assert.AreEqual(3, d.StringDictionaryProperty.Count);\n                Assert.AreEqual(\"One\", d.StringDictionaryProperty[\"1\"]);\n                Assert.AreEqual(\"II\", d.StringDictionaryProperty[\"2\"]);\n                Assert.AreEqual(\"3\", d.StringDictionaryProperty[\"3\"]);\n            }\n            else\n            {\n                ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<StringDictionaryTestClass>(json); }, \"Cannot create and populate list type \" + classRef + \". Path 'StringDictionaryProperty', line 2, position 31.\");\n            }\n        }\n#endif\n\n        [Test]\n        public void SerializeStructWithJsonObjectAttribute()\n        {\n            StructWithAttribute testStruct = new StructWithAttribute\n            {\n                MyInt = int.MaxValue\n            };\n\n            string json = JsonConvert.SerializeObject(testStruct, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"MyInt\"\": 2147483647\n}\", json);\n\n            StructWithAttribute newStruct = JsonConvert.DeserializeObject<StructWithAttribute>(json);\n\n            Assert.AreEqual(int.MaxValue, newStruct.MyInt);\n        }\n\n#if !NET20\n        [Test]\n        public void ReadWriteTimeZoneOffsetIso()\n        {\n            var serializeObject = JsonConvert.SerializeObject(new TimeZoneOffsetObject\n            {\n                Offset = new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6))\n            });\n\n            Assert.AreEqual(\"{\\\"Offset\\\":\\\"2000-01-01T00:00:00+06:00\\\"}\", serializeObject);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(serializeObject))\n            {\n                DateParseHandling = DateParseHandling.None\n            };\n            JsonSerializer serializer = new JsonSerializer();\n\n            var deserializeObject = serializer.Deserialize<TimeZoneOffsetObject>(reader);\n\n            Assert.AreEqual(TimeSpan.FromHours(6), deserializeObject.Offset.Offset);\n            Assert.AreEqual(new DateTime(2000, 1, 1), deserializeObject.Offset.Date);\n        }\n\n        [Test]\n        public void DeserializePropertyNullableDateTimeOffsetExactIso()\n        {\n            NullableDateTimeTestClass d = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\"{\\\"DateTimeOffsetField\\\":\\\"2000-01-01T00:00:00+06:00\\\"}\");\n            Assert.AreEqual(new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6)), d.DateTimeOffsetField);\n        }\n\n        [Test]\n        public void ReadWriteTimeZoneOffsetMsAjax()\n        {\n            var serializeObject = JsonConvert.SerializeObject(new TimeZoneOffsetObject\n            {\n                Offset = new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6))\n            }, Formatting.None, new JsonSerializerSettings { DateFormatHandling = DateFormatHandling.MicrosoftDateFormat });\n\n            Assert.AreEqual(\"{\\\"Offset\\\":\\\"\\\\/Date(946663200000+0600)\\\\/\\\"}\", serializeObject);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(serializeObject));\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.DateParseHandling = DateParseHandling.None;\n\n            var deserializeObject = serializer.Deserialize<TimeZoneOffsetObject>(reader);\n\n            Assert.AreEqual(TimeSpan.FromHours(6), deserializeObject.Offset.Offset);\n            Assert.AreEqual(new DateTime(2000, 1, 1), deserializeObject.Offset.Date);\n        }\n\n        [Test]\n        public void DeserializePropertyNullableDateTimeOffsetExactMsAjax()\n        {\n            NullableDateTimeTestClass d = JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\"{\\\"DateTimeOffsetField\\\":\\\"\\\\/Date(946663200000+0600)\\\\/\\\"}\");\n            Assert.AreEqual(new DateTimeOffset(new DateTime(2000, 1, 1), TimeSpan.FromHours(6)), d.DateTimeOffsetField);\n        }\n#endif\n\n        [Test]\n        public void OverridenPropertyMembers()\n        {\n            string json = JsonConvert.SerializeObject(new DerivedEvent(), Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"event\"\": \"\"derived\"\"\n}\", json);\n        }\n\n#if !(NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void SerializeExpandoObject()\n        {\n            dynamic expando = new ExpandoObject();\n            expando.Int = 1;\n            expando.Decimal = 99.9d;\n            expando.Complex = new ExpandoObject();\n            expando.Complex.String = \"I am a string\";\n            expando.Complex.DateTime = new DateTime(2000, 12, 20, 18, 55, 0, DateTimeKind.Utc);\n\n            string json = JsonConvert.SerializeObject(expando, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Int\"\": 1,\n  \"\"Decimal\"\": 99.9,\n  \"\"Complex\"\": {\n    \"\"String\"\": \"\"I am a string\"\",\n    \"\"DateTime\"\": \"\"2000-12-20T18:55:00Z\"\"\n  }\n}\", json);\n\n            IDictionary<string, object> newExpando = JsonConvert.DeserializeObject<ExpandoObject>(json);\n\n            CustomAssert.IsInstanceOfType(typeof(long), newExpando[\"Int\"]);\n            Assert.AreEqual((long)expando.Int, newExpando[\"Int\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(double), newExpando[\"Decimal\"]);\n            Assert.AreEqual(expando.Decimal, newExpando[\"Decimal\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(ExpandoObject), newExpando[\"Complex\"]);\n            IDictionary<string, object> o = (ExpandoObject)newExpando[\"Complex\"];\n\n            CustomAssert.IsInstanceOfType(typeof(string), o[\"String\"]);\n            Assert.AreEqual(expando.Complex.String, o[\"String\"]);\n\n            CustomAssert.IsInstanceOfType(typeof(DateTime), o[\"DateTime\"]);\n            Assert.AreEqual(expando.Complex.DateTime, o[\"DateTime\"]);\n        }\n#endif\n\n        [Test]\n        public void DeserializeDecimalExact()\n        {\n            decimal d = JsonConvert.DeserializeObject<decimal>(\"123456789876543.21\");\n            Assert.AreEqual(123456789876543.21m, d);\n        }\n\n        [Test]\n        public void DeserializeNullableDecimalExact()\n        {\n            decimal? d = JsonConvert.DeserializeObject<decimal?>(\"123456789876543.21\");\n            Assert.AreEqual(123456789876543.21m, d);\n        }\n\n        [Test]\n        public void DeserializeDecimalPropertyExact()\n        {\n            string json = \"{Amount:123456789876543.21}\";\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n            reader.FloatParseHandling = FloatParseHandling.Decimal;\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            Invoice i = serializer.Deserialize<Invoice>(reader);\n            Assert.AreEqual(123456789876543.21m, i.Amount);\n        }\n\n        [Test]\n        public void DeserializeDecimalArrayExact()\n        {\n            string json = \"[123456789876543.21]\";\n            IList<decimal> a = JsonConvert.DeserializeObject<IList<decimal>>(json);\n            Assert.AreEqual(123456789876543.21m, a[0]);\n        }\n\n        [Test]\n        public void DeserializeDecimalDictionaryExact()\n        {\n            string json = \"{'Value':123456789876543.21}\";\n            JsonTextReader reader = new JsonTextReader(new StringReader(json));\n            reader.FloatParseHandling = FloatParseHandling.Decimal;\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            IDictionary<string, decimal> d = serializer.Deserialize<IDictionary<string, decimal>>(reader);\n            Assert.AreEqual(123456789876543.21m, d[\"Value\"]);\n        }\n\n        [Test]\n        public void DeserializeStructProperty()\n        {\n            VectorParent obj = new VectorParent();\n            obj.Position = new TestObjects.Vector { X = 1, Y = 2, Z = 3 };\n\n            string str = JsonConvert.SerializeObject(obj);\n\n            obj = JsonConvert.DeserializeObject<VectorParent>(str);\n\n            Assert.AreEqual(1, obj.Position.X);\n            Assert.AreEqual(2, obj.Position.Y);\n            Assert.AreEqual(3, obj.Position.Z);\n        }\n\n        [Test]\n        public void PrivateSetterOnBaseClassProperty()\n        {\n            var derived = new PrivateSetterDerived(\"meh\", \"woo\");\n\n            var settings = new JsonSerializerSettings\n            {\n                TypeNameHandling = TypeNameHandling.Objects,\n                ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor\n            };\n\n            string json = JsonConvert.SerializeObject(derived, Formatting.Indented, settings);\n\n            var meh = JsonConvert.DeserializeObject<PrivateSetterBase>(json, settings);\n\n            Assert.AreEqual(((PrivateSetterDerived)meh).IDoWork, \"woo\");\n            Assert.AreEqual(meh.IDontWork, \"meh\");\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeNullableStruct()\n        {\n            NullableStructPropertyClass nullableStructPropertyClass = new NullableStructPropertyClass()\n            {\n                Foo1 = new StructISerializable() { Name = \"foo 1\" },\n                Foo2 = new StructISerializable() { Name = \"foo 2\" }\n            };\n            NullableStructPropertyClass barWithNull = new NullableStructPropertyClass()\n            {\n                Foo1 = new StructISerializable() { Name = \"foo 1\" },\n                Foo2 = null\n            };\n\n            //throws error on deserialization because bar1.Foo2 is of type Foo?\n            string s = JsonConvert.SerializeObject(nullableStructPropertyClass);\n            NullableStructPropertyClass deserialized = deserialize(s);\n            Assert.AreEqual(deserialized.Foo1.Name, \"foo 1\");\n            Assert.AreEqual(deserialized.Foo2.Value.Name, \"foo 2\");\n\n            //no error Foo2 is null\n            s = JsonConvert.SerializeObject(barWithNull);\n            deserialized = deserialize(s);\n            Assert.AreEqual(deserialized.Foo1.Name, \"foo 1\");\n            Assert.AreEqual(deserialized.Foo2, null);\n        }\n\n        private static NullableStructPropertyClass deserialize(string serStr)\n        {\n            return JsonConvert.DeserializeObject<NullableStructPropertyClass>(\n                serStr,\n                new JsonSerializerSettings\n                {\n                    NullValueHandling = NullValueHandling.Ignore,\n                    MissingMemberHandling = MissingMemberHandling.Ignore\n                });\n        }\n#endif\n\n        [Test]\n        public void DeserializeJToken()\n        {\n            JTokenTestClass c = new JTokenTestClass\n            {\n                Name = \"Success\",\n                Data = new JObject(new JProperty(\"First\", \"Value1\"), new JProperty(\"Second\", \"Value2\"))\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            JTokenTestClass deserializedResponse = JsonConvert.DeserializeObject<JTokenTestClass>(json);\n\n            Assert.AreEqual(\"Success\", deserializedResponse.Name);\n            Assert.IsTrue(deserializedResponse.Data.DeepEquals(c.Data));\n        }\n\n        [Test]\n        public void DeserializeMinValueDecimal()\n        {\n            var data = new DecimalTest(decimal.MinValue);\n            var json = JsonConvert.SerializeObject(data);\n            var obj = JsonConvert.DeserializeObject<DecimalTest>(json, new JsonSerializerSettings { MetadataPropertyHandling = MetadataPropertyHandling.Default });\n\n            Assert.AreEqual(decimal.MinValue, obj.Value);\n        }\n\n        [Test]\n        public void NonPublicConstructorWithJsonConstructorTest()\n        {\n            NonPublicConstructorWithJsonConstructor c = JsonConvert.DeserializeObject<NonPublicConstructorWithJsonConstructor>(\"{}\");\n            Assert.AreEqual(\"NonPublic\", c.Constructor);\n        }\n\n        [Test]\n        public void PublicConstructorOverridenByJsonConstructorTest()\n        {\n            PublicConstructorOverridenByJsonConstructor c = JsonConvert.DeserializeObject<PublicConstructorOverridenByJsonConstructor>(\"{Value:'value!'}\");\n            Assert.AreEqual(\"Public Parameterized\", c.Constructor);\n            Assert.AreEqual(\"value!\", c.Value);\n        }\n\n        [Test]\n        public void MultipleParametrizedConstructorsJsonConstructorTest()\n        {\n            MultipleParametrizedConstructorsJsonConstructor c = JsonConvert.DeserializeObject<MultipleParametrizedConstructorsJsonConstructor>(\"{Value:'value!', Age:1}\");\n            Assert.AreEqual(\"Public Parameterized 2\", c.Constructor);\n            Assert.AreEqual(\"value!\", c.Value);\n            Assert.AreEqual(1, c.Age);\n        }\n\n        [Test]\n        public void DeserializeEnumerable()\n        {\n            EnumerableClass c = new EnumerableClass\n            {\n                Enumerable = new List<string> { \"One\", \"Two\", \"Three\" }\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Enumerable\"\": [\n    \"\"One\"\",\n    \"\"Two\"\",\n    \"\"Three\"\"\n  ]\n}\", json);\n\n            EnumerableClass c2 = JsonConvert.DeserializeObject<EnumerableClass>(json);\n\n            Assert.AreEqual(\"One\", c2.Enumerable.ElementAt(0));\n            Assert.AreEqual(\"Two\", c2.Enumerable.ElementAt(1));\n            Assert.AreEqual(\"Three\", c2.Enumerable.ElementAt(2));\n        }\n\n        [Test]\n        public void SerializeAttributesOnBase()\n        {\n            ComplexItem i = new ComplexItem();\n\n            string json = JsonConvert.SerializeObject(i, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Name\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeStringEnglish()\n        {\n            string json = @\"{\n  'Name': 'James Hughes',\n  'Age': '40',\n  'Height': '44.4',\n  'Price': '4'\n}\";\n\n            DeserializeStringConvert p = JsonConvert.DeserializeObject<DeserializeStringConvert>(json);\n            Assert.AreEqual(40, p.Age);\n            Assert.AreEqual(44.4, p.Height);\n            Assert.AreEqual(4m, p.Price);\n        }\n\n        [Test]\n        public void DeserializeNullDateTimeValueTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject(\"null\", typeof(DateTime)); }, \"Error converting value {null} to type 'System.DateTime'. Path '', line 1, position 4.\");\n        }\n\n        [Test]\n        public void DeserializeNullNullableDateTimeValueTest()\n        {\n            object dateTime = JsonConvert.DeserializeObject(\"null\", typeof(DateTime?));\n\n            Assert.IsNull(dateTime);\n        }\n\n        [Test]\n        public void MultiIndexSuperTest()\n        {\n            MultiIndexSuper e = new MultiIndexSuper();\n\n            string json = JsonConvert.SerializeObject(e, Formatting.Indented);\n\n            Assert.AreEqual(@\"{}\", json);\n        }\n\n        [Test]\n        public void CommentTestClassTest()\n        {\n            string json = @\"{\"\"indexed\"\":true, \"\"startYear\"\":1939, \"\"values\"\":\n                            [  3000,  /* 1940-1949 */\n                               3000,   3600,   3600,   3600,   3600,   4200,   4200,   4200,   4200,   4800,  /* 1950-1959 */\n                               4800,   4800,   4800,   4800,   4800,   4800,   6600,   6600,   7800,   7800,  /* 1960-1969 */\n                               7800,   7800,   9000,  10800,  13200,  14100,  15300,  16500,  17700,  22900,  /* 1970-1979 */\n                              25900,  29700,  32400,  35700,  37800,  39600,  42000,  43800,  45000,  48000,  /* 1980-1989 */\n                              51300,  53400,  55500,  57600,  60600,  61200,  62700,  65400,  68400,  72600,  /* 1990-1999 */\n                              76200,  80400,  84900,  87000,  87900,  90000,  94200,  97500, 102000, 106800,  /* 2000-2009 */\n                             106800, 106800]  /* 2010-2011 */\n                                }\";\n\n            CommentTestClass commentTestClass = JsonConvert.DeserializeObject<CommentTestClass>(json);\n\n            Assert.AreEqual(true, commentTestClass.Indexed);\n            Assert.AreEqual(1939, commentTestClass.StartYear);\n            Assert.AreEqual(63, commentTestClass.Values.Count);\n        }\n\n        [Test]\n        public void PopulationBehaviourForOmittedPropertiesIsTheSameForParameterisedConstructorAsForDefaultConstructor()\n        {\n            string json = @\"{A:\"\"Test\"\"}\";\n\n            var withoutParameterisedConstructor = JsonConvert.DeserializeObject<DTOWithoutParameterisedConstructor>(json);\n            var withParameterisedConstructor = JsonConvert.DeserializeObject<DTOWithParameterisedConstructor>(json);\n            Assert.AreEqual(withoutParameterisedConstructor.B, withParameterisedConstructor.B);\n        }\n\n        [Test]\n        public void SkipPopulatingArrayPropertyClass()\n        {\n            string json = JsonConvert.SerializeObject(new EnumerableArrayPropertyClass());\n            JsonConvert.DeserializeObject<EnumerableArrayPropertyClass>(json);\n        }\n\n#if !(NET20)\n        [Test]\n        public void ChildDataContractTest()\n        {\n            ChildDataContract cc = new ChildDataContract\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc, Formatting.Indented);\n            //      Assert.AreEqual(@\"{\n            //  \"\"VirtualMember\"\": \"\"VirtualMember!\"\",\n            //  \"\"NewMember\"\": null,\n            //  \"\"nonVirtualMember\"\": \"\"NonVirtualMember!\"\"\n            //}\", result);\n\n            StringAssert.AreEqual(@\"{\n  \"\"virtualMember\"\": \"\"VirtualMember!\"\",\n  \"\"nonVirtualMember\"\": \"\"NonVirtualMember!\"\"\n}\", result);\n        }\n\n        [Test]\n        public void ChildDataContractTestWithDataContractSerializer()\n        {\n            ChildDataContract cc = new ChildDataContract\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            DataContractSerializer serializer = new DataContractSerializer(typeof(ChildDataContract));\n\n            MemoryStream ms = new MemoryStream();\n            serializer.WriteObject(ms, cc);\n\n            string xml = Encoding.UTF8.GetString(ms.ToArray(), 0, Convert.ToInt32(ms.Length));\n\n            Assert.AreEqual(@\"<ChildDataContract xmlns=\"\"http://schemas.datacontract.org/2004/07/Newtonsoft.Json.Tests.TestObjects\"\" xmlns:i=\"\"http://www.w3.org/2001/XMLSchema-instance\"\"><nonVirtualMember>NonVirtualMember!</nonVirtualMember><virtualMember>VirtualMember!</virtualMember><NewMember i:nil=\"\"true\"\"/></ChildDataContract>\", xml);\n        }\n#endif\n\n        [Test]\n        public void ChildObjectTest()\n        {\n            VirtualOverrideNewChildObject cc = new VirtualOverrideNewChildObject\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"virtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void ChildWithDifferentOverrideObjectTest()\n        {\n            VirtualOverrideNewChildWithDifferentOverrideObject cc = new VirtualOverrideNewChildWithDifferentOverrideObject\n            {\n                VirtualMember = \"VirtualMember!\",\n                NonVirtualMember = \"NonVirtualMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc);\n            Assert.AreEqual(@\"{\"\"differentVirtualMember\"\":\"\"VirtualMember!\"\",\"\"nonVirtualMember\"\":\"\"NonVirtualMember!\"\"}\", result);\n        }\n\n        [Test]\n        public void ImplementInterfaceObjectTest()\n        {\n            ImplementInterfaceObject cc = new ImplementInterfaceObject\n            {\n                InterfaceMember = new DateTime(2010, 12, 31, 0, 0, 0, DateTimeKind.Utc),\n                NewMember = \"NewMember!\"\n            };\n\n            string result = JsonConvert.SerializeObject(cc, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"virtualMember\"\": \"\"2010-12-31T00:00:00Z\"\",\n  \"\"newMemberWithProperty\"\": null\n}\", result);\n        }\n\n        [Test]\n        public void NonDefaultConstructorWithReadOnlyCollectionPropertyTest()\n        {\n            NonDefaultConstructorWithReadOnlyCollectionProperty c1 = new NonDefaultConstructorWithReadOnlyCollectionProperty(\"blah\");\n            c1.Categories.Add(\"one\");\n            c1.Categories.Add(\"two\");\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Title\"\": \"\"blah\"\",\n  \"\"Categories\"\": [\n    \"\"one\"\",\n    \"\"two\"\"\n  ]\n}\", json);\n\n            NonDefaultConstructorWithReadOnlyCollectionProperty c2 = JsonConvert.DeserializeObject<NonDefaultConstructorWithReadOnlyCollectionProperty>(json);\n            Assert.AreEqual(c1.Title, c2.Title);\n            Assert.AreEqual(c1.Categories.Count, c2.Categories.Count);\n            Assert.AreEqual(\"one\", c2.Categories[0]);\n            Assert.AreEqual(\"two\", c2.Categories[1]);\n        }\n\n        [Test]\n        public void NonDefaultConstructorWithReadOnlyDictionaryPropertyTest()\n        {\n            NonDefaultConstructorWithReadOnlyDictionaryProperty c1 = new NonDefaultConstructorWithReadOnlyDictionaryProperty(\"blah\");\n            c1.Categories.Add(\"one\", 1);\n            c1.Categories.Add(\"two\", 2);\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Title\"\": \"\"blah\"\",\n  \"\"Categories\"\": {\n    \"\"one\"\": 1,\n    \"\"two\"\": 2\n  }\n}\", json);\n\n            NonDefaultConstructorWithReadOnlyDictionaryProperty c2 = JsonConvert.DeserializeObject<NonDefaultConstructorWithReadOnlyDictionaryProperty>(json);\n            Assert.AreEqual(c1.Title, c2.Title);\n            Assert.AreEqual(c1.Categories.Count, c2.Categories.Count);\n            Assert.AreEqual(1, c2.Categories[\"one\"]);\n            Assert.AreEqual(2, c2.Categories[\"two\"]);\n        }\n\n        [Test]\n        public void ClassAttributesInheritance()\n        {\n            string json = JsonConvert.SerializeObject(new ClassAttributeDerived\n            {\n                BaseClassValue = \"BaseClassValue!\",\n                DerivedClassValue = \"DerivedClassValue!\",\n                NonSerialized = \"NonSerialized!\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"DerivedClassValue\"\": \"\"DerivedClassValue!\"\",\n  \"\"BaseClassValue\"\": \"\"BaseClassValue!\"\"\n}\", json);\n\n            json = JsonConvert.SerializeObject(new CollectionClassAttributeDerived\n            {\n                BaseClassValue = \"BaseClassValue!\",\n                CollectionDerivedClassValue = \"CollectionDerivedClassValue!\"\n            }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"CollectionDerivedClassValue\"\": \"\"CollectionDerivedClassValue!\"\",\n  \"\"BaseClassValue\"\": \"\"BaseClassValue!\"\"\n}\", json);\n        }\n\n        [Test]\n        public void PrivateMembersClassWithAttributesTest()\n        {\n            PrivateMembersClassWithAttributes c1 = new PrivateMembersClassWithAttributes(\"privateString!\", \"internalString!\", \"readonlyString!\");\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"_privateString\"\": \"\"privateString!\"\",\n  \"\"_readonlyString\"\": \"\"readonlyString!\"\",\n  \"\"_internalString\"\": \"\"internalString!\"\"\n}\", json);\n\n            PrivateMembersClassWithAttributes c2 = JsonConvert.DeserializeObject<PrivateMembersClassWithAttributes>(json);\n            Assert.AreEqual(\"readonlyString!\", c2.UseValue());\n        }\n\n        [Test]\n        public void DeserializeGenericEnumerableProperty()\n        {\n            BusRun r = JsonConvert.DeserializeObject<BusRun>(\"{\\\"Departures\\\":[\\\"\\\\/Date(1309874148734-0400)\\\\/\\\",\\\"\\\\/Date(1309874148739-0400)\\\\/\\\",null],\\\"WheelchairAccessible\\\":true}\");\n\n            Assert.AreEqual(typeof(List<DateTime?>), r.Departures.GetType());\n            Assert.AreEqual(3, r.Departures.Count());\n            Assert.IsNotNull(r.Departures.ElementAt(0));\n            Assert.IsNotNull(r.Departures.ElementAt(1));\n            Assert.IsNull(r.Departures.ElementAt(2));\n        }\n\n#if !(NET20)\n        [Test]\n        public void JsonPropertyDataMemberOrder()\n        {\n            DerivedType d = new DerivedType();\n            string json = JsonConvert.SerializeObject(d, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"dinosaur\"\": null,\n  \"\"dog\"\": null,\n  \"\"cat\"\": null,\n  \"\"zebra\"\": null,\n  \"\"bird\"\": null,\n  \"\"parrot\"\": null,\n  \"\"albatross\"\": null,\n  \"\"antelope\"\": null\n}\", json);\n        }\n#endif\n\n        public class CustomClass\n        {\n#if !(NET20 || PORTABLE)\n            [Required]\n#endif\n            public System.Guid? clientId { get; set; }\n        }\n\n        [Test]\n        public void DeserializeStringIntoNullableGuid()\n        {\n            string json = @\"{ 'clientId': 'bb2f3da7-bf79-4d14-9d54-0a1f7ff5f902' }\";\n\n            CustomClass c = JsonConvert.DeserializeObject<CustomClass>(json);\n\n            Assert.AreEqual(new Guid(\"bb2f3da7-bf79-4d14-9d54-0a1f7ff5f902\"), c.clientId);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD2_0\n        [Test]\n        public void SerializeException1()\n        {\n            ClassWithException classWithException = new ClassWithException();\n            try\n            {\n                throw new Exception(\"Test Exception\");\n            }\n            catch (Exception ex)\n            {\n                classWithException.Exceptions.Add(ex);\n            }\n            string sex = JsonConvert.SerializeObject(classWithException);\n            ClassWithException dex = JsonConvert.DeserializeObject<ClassWithException>(sex);\n            Assert.AreEqual(dex.Exceptions[0].ToString(), dex.Exceptions[0].ToString());\n\n            sex = JsonConvert.SerializeObject(classWithException, Formatting.Indented);\n\n            dex = JsonConvert.DeserializeObject<ClassWithException>(sex); // this fails!\n            Assert.AreEqual(dex.Exceptions[0].ToString(), dex.Exceptions[0].ToString());\n        }\n#endif\n\n        [Test]\n        public void UriGuidTimeSpanTestClassEmptyTest()\n        {\n            UriGuidTimeSpanTestClass c1 = new UriGuidTimeSpanTestClass();\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Guid\"\": \"\"00000000-0000-0000-0000-000000000000\"\",\n  \"\"NullableGuid\"\": null,\n  \"\"TimeSpan\"\": \"\"00:00:00\"\",\n  \"\"NullableTimeSpan\"\": null,\n  \"\"Uri\"\": null\n}\", json);\n\n            UriGuidTimeSpanTestClass c2 = JsonConvert.DeserializeObject<UriGuidTimeSpanTestClass>(json);\n            Assert.AreEqual(c1.Guid, c2.Guid);\n            Assert.AreEqual(c1.NullableGuid, c2.NullableGuid);\n            Assert.AreEqual(c1.TimeSpan, c2.TimeSpan);\n            Assert.AreEqual(c1.NullableTimeSpan, c2.NullableTimeSpan);\n            Assert.AreEqual(c1.Uri, c2.Uri);\n        }\n\n        [Test]\n        public void UriGuidTimeSpanTestClassValuesTest()\n        {\n            UriGuidTimeSpanTestClass c1 = new UriGuidTimeSpanTestClass\n            {\n                Guid = new Guid(\"1924129C-F7E0-40F3-9607-9939C531395A\"),\n                NullableGuid = new Guid(\"9E9F3ADF-E017-4F72-91E0-617EBE85967D\"),\n                TimeSpan = TimeSpan.FromDays(1),\n                NullableTimeSpan = TimeSpan.FromHours(1),\n                Uri = new Uri(\"http://testuri.com\")\n            };\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Guid\"\": \"\"1924129c-f7e0-40f3-9607-9939c531395a\"\",\n  \"\"NullableGuid\"\": \"\"9e9f3adf-e017-4f72-91e0-617ebe85967d\"\",\n  \"\"TimeSpan\"\": \"\"1.00:00:00\"\",\n  \"\"NullableTimeSpan\"\": \"\"01:00:00\"\",\n  \"\"Uri\"\": \"\"http://testuri.com\"\"\n}\", json);\n\n            UriGuidTimeSpanTestClass c2 = JsonConvert.DeserializeObject<UriGuidTimeSpanTestClass>(json);\n            Assert.AreEqual(c1.Guid, c2.Guid);\n            Assert.AreEqual(c1.NullableGuid, c2.NullableGuid);\n            Assert.AreEqual(c1.TimeSpan, c2.TimeSpan);\n            Assert.AreEqual(c1.NullableTimeSpan, c2.NullableTimeSpan);\n            Assert.AreEqual(c1.Uri, c2.Uri);\n        }\n\n        [Test]\n        public void UsingJsonTextWriter()\n        {\n            // The property of the object has to be a number for the cast exception to occure\n            object o = new { p = 1 };\n\n            var json = JObject.FromObject(o);\n\n            using (var sw = new StringWriter())\n            using (var jw = new JsonTextWriter(sw))\n            {\n                jw.WriteToken(json.CreateReader());\n                jw.Flush();\n\n                string result = sw.ToString();\n                Assert.AreEqual(@\"{\"\"p\"\":1}\", result);\n            }\n        }\n\n        [Test]\n        public void SerializeUriWithQuotes()\n        {\n            string input = \"http://test.com/%22foo+bar%22\";\n            Uri uri = new Uri(input);\n            string json = JsonConvert.SerializeObject(uri);\n            Uri output = JsonConvert.DeserializeObject<Uri>(json);\n\n            Assert.AreEqual(uri, output);\n        }\n\n        [Test]\n        public void SerializeUriWithSlashes()\n        {\n            string input = @\"http://tes/?a=b\\\\c&d=e\\\";\n            Uri uri = new Uri(input);\n            string json = JsonConvert.SerializeObject(uri);\n            Uri output = JsonConvert.DeserializeObject<Uri>(json);\n\n            Assert.AreEqual(uri, output);\n        }\n\n        [Test]\n        public void DeserializeByteArrayWithTypeNameHandling()\n        {\n            TestObject test = new TestObject(\"Test\", new byte[] { 72, 63, 62, 71, 92, 55 });\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.TypeNameHandling = TypeNameHandling.All;\n\n            byte[] objectBytes;\n            using (MemoryStream stream = new MemoryStream())\n            using (JsonWriter jsonWriter = new JsonTextWriter(new StreamWriter(stream)))\n            {\n                serializer.Serialize(jsonWriter, test);\n                jsonWriter.Flush();\n\n                objectBytes = stream.ToArray();\n            }\n\n            using (MemoryStream stream = new MemoryStream(objectBytes))\n            using (JsonReader jsonReader = new JsonTextReader(new StreamReader(stream)))\n            {\n                // Get exception here\n                TestObject newObject = (TestObject)serializer.Deserialize(jsonReader);\n\n                Assert.AreEqual(\"Test\", newObject.Name);\n                CollectionAssert.AreEquivalent(new byte[] { 72, 63, 62, 71, 92, 55 }, newObject.Data);\n            }\n        }\n\n        [Test]\n        public void SerializeStaticDefault()\n        {\n            DefaultContractResolver contractResolver = new DefaultContractResolver();\n\n            StaticTestClass c = new StaticTestClass\n            {\n                x = int.MaxValue\n            };\n            StaticTestClass.y = 2;\n            StaticTestClass.z = 3;\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"x\"\": 2147483647,\n  \"\"y\"\": 2,\n  \"\"z\"\": 3\n}\", json);\n\n            StaticTestClass c2 = JsonConvert.DeserializeObject<StaticTestClass>(@\"{\n  \"\"x\"\": -1,\n  \"\"y\"\": -2,\n  \"\"z\"\": -3\n}\",\n                new JsonSerializerSettings\n                {\n                    ContractResolver = contractResolver\n                });\n\n            Assert.AreEqual(-1, c2.x);\n            Assert.AreEqual(-2, StaticTestClass.y);\n            Assert.AreEqual(-3, StaticTestClass.z);\n        }\n\n        [Test]\n        public void SerializeStaticReflection()\n        {\n            ReflectionContractResolver contractResolver = new ReflectionContractResolver();\n\n            StaticTestClass c = new StaticTestClass\n            {\n                x = int.MaxValue\n            };\n            StaticTestClass.y = 2;\n            StaticTestClass.z = 3;\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"x\"\": 2147483647,\n  \"\"y\"\": 2,\n  \"\"z\"\": 3\n}\", json);\n\n            StaticTestClass c2 = JsonConvert.DeserializeObject<StaticTestClass>(@\"{\n  \"\"x\"\": -1,\n  \"\"y\"\": -2,\n  \"\"z\"\": -3\n}\",\n                new JsonSerializerSettings\n                {\n                    ContractResolver = contractResolver\n                });\n\n            Assert.AreEqual(-1, c2.x);\n            Assert.AreEqual(-2, StaticTestClass.y);\n            Assert.AreEqual(-3, StaticTestClass.z);\n        }\n\n#if !(NET20 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void DeserializeDecimalsWithCulture()\n        {\n            CultureInfo initialCulture = Thread.CurrentThread.CurrentCulture;\n\n            try\n            {\n                CultureInfo testCulture = CultureInfo.CreateSpecificCulture(\"nb-NO\");\n\n                Thread.CurrentThread.CurrentCulture = testCulture;\n                Thread.CurrentThread.CurrentUICulture = testCulture;\n\n                string json = @\"{ 'Quantity': '1.5', 'OptionalQuantity': '2.2' }\";\n\n                DecimalTestClass c = JsonConvert.DeserializeObject<DecimalTestClass>(json);\n\n                Assert.AreEqual(1.5m, c.Quantity);\n                Assert.AreEqual(2.2d, c.OptionalQuantity);\n            }\n            finally\n            {\n                Thread.CurrentThread.CurrentCulture = initialCulture;\n                Thread.CurrentThread.CurrentUICulture = initialCulture;\n            }\n        }\n#endif\n\n        [Test]\n        public void ReadForTypeHackFixDecimal()\n        {\n            IList<decimal> d1 = new List<decimal> { 1.1m };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<decimal> d2 = JsonConvert.DeserializeObject<IList<decimal>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void ReadForTypeHackFixDateTimeOffset()\n        {\n            IList<DateTimeOffset?> d1 = new List<DateTimeOffset?> { null };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<DateTimeOffset?> d2 = JsonConvert.DeserializeObject<IList<DateTimeOffset?>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void ReadForTypeHackFixByteArray()\n        {\n            IList<byte[]> d1 = new List<byte[]> { null };\n\n            string json = JsonConvert.SerializeObject(d1);\n\n            IList<byte[]> d2 = JsonConvert.DeserializeObject<IList<byte[]>>(json);\n\n            Assert.AreEqual(d1.Count, d2.Count);\n            Assert.AreEqual(d1[0], d2[0]);\n        }\n\n        [Test]\n        public void SerializeInheritanceHierarchyWithDuplicateProperty()\n        {\n            Bb b = new Bb();\n            b.no = true;\n            Aa a = b;\n            a.no = int.MaxValue;\n\n            string json = JsonConvert.SerializeObject(b);\n\n            Assert.AreEqual(@\"{\"\"no\"\":true}\", json);\n\n            Bb b2 = JsonConvert.DeserializeObject<Bb>(json);\n\n            Assert.AreEqual(true, b2.no);\n        }\n\n        [Test]\n        public void DeserializeNullInt()\n        {\n            string json = @\"[\n  1,\n  2,\n  3,\n  null\n]\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n            {\n                List<int> numbers = JsonConvert.DeserializeObject<List<int>>(json);\n            }, \"Error converting value {null} to type 'System.Int32'. Path '[3]', line 5, position 6.\");\n        }\n\n#if !(PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeIConvertible()\n        {\n            ConvertableIntTestClass c = new ConvertableIntTestClass\n            {\n                Integer = new ConvertibleInt(1),\n                NullableInteger1 = new ConvertibleInt(2),\n                NullableInteger2 = null\n            };\n\n            string json = JsonConvert.SerializeObject(c, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"Integer\"\": 1,\n  \"\"NullableInteger1\"\": 2,\n  \"\"NullableInteger2\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DeserializeIConvertible()\n        {\n            string json = @\"{\n  \"\"Integer\"\": 1,\n  \"\"NullableInteger1\"\": 2,\n  \"\"NullableInteger2\"\": null\n}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<ConvertableIntTestClass>(json), \"Error converting value 1 to type 'Newtonsoft.Json.Tests.TestObjects.ConvertibleInt'. Path 'Integer', line 2, position 14.\");\n        }\n#endif\n\n        [Test]\n        public void SerializeNullableWidgetStruct()\n        {\n            Widget widget = new Widget { Id = new WidgetId { Value = \"id\" } };\n\n            string json = JsonConvert.SerializeObject(widget);\n\n            Assert.AreEqual(@\"{\"\"Id\"\":{\"\"Value\"\":\"\"id\"\"}}\", json);\n        }\n\n        [Test]\n        public void DeserializeNullableWidgetStruct()\n        {\n            string json = @\"{\"\"Id\"\":{\"\"Value\"\":\"\"id\"\"}}\";\n\n            Widget w = JsonConvert.DeserializeObject<Widget>(json);\n\n            Assert.AreEqual(new WidgetId { Value = \"id\" }, w.Id);\n            Assert.AreEqual(new WidgetId { Value = \"id\" }, w.Id.Value);\n            Assert.AreEqual(\"id\", w.Id.Value.Value);\n        }\n\n        [Test]\n        public void DeserializeBoolInt()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(() =>\n            {\n                string json = @\"{\n  \"\"PreProperty\"\": true,\n  \"\"PostProperty\"\": \"\"-1\"\"\n}\";\n\n                JsonConvert.DeserializeObject<TestObjects.MyClass>(json);\n            }, \"Unexpected character encountered while parsing value: t. Path 'PreProperty', line 2, position 18.\");\n        }\n\n        [Test]\n        public void DeserializeUnexpectedEndInt()\n        {\n            ExceptionAssert.Throws<JsonException>(() =>\n            {\n                string json = @\"{\n  \"\"PreProperty\"\": \";\n\n                JsonConvert.DeserializeObject<TestObjects.MyClass>(json);\n            });\n        }\n\n        [Test]\n        public void DeserializeNullableGuid()\n        {\n            string json = @\"{\"\"Id\"\":null}\";\n            var c = JsonConvert.DeserializeObject<NullableGuid>(json);\n\n            Assert.AreEqual(null, c.Id);\n\n            json = @\"{\"\"Id\"\":\"\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"\"}\";\n            c = JsonConvert.DeserializeObject<NullableGuid>(json);\n\n            Assert.AreEqual(new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"), c.Id);\n        }\n\n        [Test]\n        public void SerializeNullableGuidCustomWriterOverridesNullableGuid()\n        {\n            NullableGuid ng = new NullableGuid {Id = Guid.Empty};\n            NullableGuidCountingJsonTextWriter writer = new NullableGuidCountingJsonTextWriter(new StreamWriter(Stream.Null));\n            JsonSerializer serializer = JsonSerializer.Create();\n            serializer.Serialize(writer, ng);\n            Assert.AreEqual(1, writer.NullableGuidCount);\n            MemoryTraceWriter traceWriter = new MemoryTraceWriter();\n            serializer.TraceWriter = traceWriter;\n            serializer.Serialize(writer, ng);\n            Assert.AreEqual(2, writer.NullableGuidCount);\n        }\n\n        [Test]\n        public void DeserializeGuid()\n        {\n            Item expected = new Item()\n            {\n                SourceTypeID = new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"),\n                BrokerID = new Guid(\"951663c4-924e-4c86-a57a-7ed737501dbd\"),\n                Latitude = 33.657145,\n                Longitude = -117.766684,\n                TimeStamp = new DateTime(2000, 3, 1, 23, 59, 59, DateTimeKind.Utc),\n                Payload = new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }\n            };\n\n            string jsonString = JsonConvert.SerializeObject(expected, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"SourceTypeID\"\": \"\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"\",\n  \"\"BrokerID\"\": \"\"951663c4-924e-4c86-a57a-7ed737501dbd\"\",\n  \"\"Latitude\"\": 33.657145,\n  \"\"Longitude\"\": -117.766684,\n  \"\"TimeStamp\"\": \"\"2000-03-01T23:59:59Z\"\",\n  \"\"Payload\"\": {\n    \"\"$type\"\": \"\"\" + ReflectionUtils.GetTypeName(typeof(byte[]), 0, DefaultSerializationBinder.Instance) + @\"\"\",\n    \"\"$value\"\": \"\"AAECAwQFBgcICQ==\"\"\n  }\n}\", jsonString);\n\n            Item actual = JsonConvert.DeserializeObject<Item>(jsonString);\n\n            Assert.AreEqual(new Guid(\"d8220a4b-75b1-4b7a-8112-b7bdae956a45\"), actual.SourceTypeID);\n            Assert.AreEqual(new Guid(\"951663c4-924e-4c86-a57a-7ed737501dbd\"), actual.BrokerID);\n            byte[] bytes = (byte[])actual.Payload;\n            CollectionAssert.AreEquivalent((new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }).ToList(), bytes.ToList());\n        }\n\n        [Test]\n        public void DeserializeObjectDictionary()\n        {\n            var serializer = JsonSerializer.Create(new JsonSerializerSettings());\n            var dict = serializer.Deserialize<Dictionary<string, string>>(new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\")));\n\n            Assert.AreEqual(\"\", dict[\"k1\"]);\n            Assert.AreEqual(\"v2\", dict[\"k2\"]);\n        }\n\n        [Test]\n        public void DeserializeNullableEnum()\n        {\n            string json = JsonConvert.SerializeObject(new WithEnums\n            {\n                Id = 7,\n                NullableEnum = null\n            });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":7,\"\"NullableEnum\"\":null}\", json);\n\n            WithEnums e = JsonConvert.DeserializeObject<WithEnums>(json);\n\n            Assert.AreEqual(null, e.NullableEnum);\n\n            json = JsonConvert.SerializeObject(new WithEnums\n            {\n                Id = 7,\n                NullableEnum = MyEnum.Value2\n            });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":7,\"\"NullableEnum\"\":1}\", json);\n\n            e = JsonConvert.DeserializeObject<WithEnums>(json);\n\n            Assert.AreEqual(MyEnum.Value2, e.NullableEnum);\n        }\n\n        [Test]\n        public void NullableStructWithConverter()\n        {\n            string json = JsonConvert.SerializeObject(new Widget1 { Id = new WidgetId1 { Value = 1234 } });\n\n            Assert.AreEqual(@\"{\"\"Id\"\":\"\"1234\"\"}\", json);\n\n            Widget1 w = JsonConvert.DeserializeObject<Widget1>(@\"{\"\"Id\"\":\"\"1234\"\"}\");\n\n            Assert.AreEqual(new WidgetId1 { Value = 1234 }, w.Id);\n        }\n\n        [Test]\n        public void SerializeDictionaryStringStringAndStringObject()\n        {\n            var serializer = JsonSerializer.Create(new JsonSerializerSettings());\n            var dict = serializer.Deserialize<Dictionary<string, string>>(new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\")));\n\n            var reader = new JsonTextReader(new StringReader(\"{'k1':'','k2':'v2'}\"));\n            var dict2 = serializer.Deserialize<Dictionary<string, object>>(reader);\n\n            Assert.AreEqual(dict[\"k1\"], dict2[\"k1\"]);\n        }\n\n        [Test]\n        public void DeserializeEmptyStrings()\n        {\n            object v = JsonConvert.DeserializeObject<double?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<char?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<int?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<decimal?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<DateTime?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<DateTimeOffset?>(\"\");\n            Assert.IsNull(v);\n\n            v = JsonConvert.DeserializeObject<byte[]>(\"\");\n            Assert.IsNull(v);\n        }\n\n        [Test]\n        public void DeserializeDoubleFromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<double>(\"\"); }, \"No JSON content found and type 'System.Double' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeEnumFromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<StringComparison>(\"\"); }, \"No JSON content found and type 'System.StringComparison' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeInt32FromEmptyString()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => { JsonConvert.DeserializeObject<int>(\"\"); }, \"No JSON content found and type 'System.Int32' is not nullable. Path '', line 0, position 0.\");\n        }\n\n        [Test]\n        public void DeserializeByteArrayFromEmptyString()\n        {\n            byte[] b = JsonConvert.DeserializeObject<byte[]>(\"\");\n            Assert.IsNull(b);\n        }\n\n        [Test]\n        public void DeserializeDoubleFromNullString()\n        {\n            ExceptionAssert.Throws<ArgumentNullException>(\n                () => { JsonConvert.DeserializeObject<double>(null); },\n                new[]\n                {\n                    \"Value cannot be null.\" + Environment.NewLine + \"Parameter name: value\",\n                    \"Argument cannot be null.\" + Environment.NewLine + \"Parameter name: value\", // mono\n                    \"Value cannot be null. (Parameter 'value')\"\n                });\n        }\n\n        [Test]\n        public void DeserializeFromNullString()\n        {\n            ExceptionAssert.Throws<ArgumentNullException>(\n                () => { JsonConvert.DeserializeObject(null); },\n                new[]\n                {\n                    \"Value cannot be null.\" + Environment.NewLine + \"Parameter name: value\",\n                    \"Argument cannot be null.\" + Environment.NewLine + \"Parameter name: value\", // mono\n                    \"Value cannot be null. (Parameter 'value')\"\n                });\n        }\n\n        [Test]\n        public void DeserializeIsoDatesWithIsoConverter()\n        {\n            string jsonIsoText =\n                @\"{\"\"Value\"\":\"\"2012-02-25T19:55:50.6095676+13:00\"\"}\";\n\n            DateTimeWrapper c = JsonConvert.DeserializeObject<DateTimeWrapper>(jsonIsoText, new IsoDateTimeConverter());\n            Assert.AreEqual(DateTimeKind.Local, c.Value.Kind);\n        }\n\n#if !NET20\n        [Test]\n        public void DeserializeUTC()\n        {\n            DateTimeTestClass c =\n                JsonConvert.DeserializeObject<DateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 12, 12, 12, 12, 12, 0, DateTimeKind.Utc).ToLocalTime(), c.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 12, 12, 12, 12, 12, 0, TimeSpan.Zero), c.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c.PreField);\n            Assert.AreEqual(\"Post\", c.PostField);\n\n            DateTimeTestClass c2 =\n                JsonConvert.DeserializeObject<DateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-01-01T01:01:01Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-01-01T01:01:01Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 1, 1, 1, 1, 1, 0, DateTimeKind.Utc).ToLocalTime(), c2.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 1, 1, 1, 1, 1, 0, TimeSpan.Zero), c2.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c2.PreField);\n            Assert.AreEqual(\"Post\", c2.PostField);\n        }\n\n        [Test]\n        public void NullableDeserializeUTC()\n        {\n            NullableDateTimeTestClass c =\n                JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"DateTimeOffsetField\"\":\"\"2008-12-12T12:12:12Z\"\",\"\"PostField\"\":\"\"Post\"\"}\",\n                    new JsonSerializerSettings\n                    {\n                        DateTimeZoneHandling = DateTimeZoneHandling.Local\n                    });\n\n            Assert.AreEqual(new DateTime(2008, 12, 12, 12, 12, 12, 0, DateTimeKind.Utc).ToLocalTime(), c.DateTimeField);\n            Assert.AreEqual(new DateTimeOffset(2008, 12, 12, 12, 12, 12, 0, TimeSpan.Zero), c.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c.PreField);\n            Assert.AreEqual(\"Post\", c.PostField);\n\n            NullableDateTimeTestClass c2 =\n                JsonConvert.DeserializeObject<NullableDateTimeTestClass>(\n                    @\"{\"\"PreField\"\":\"\"Pre\"\",\"\"DateTimeField\"\":null,\"\"DateTimeOffsetField\"\":null,\"\"PostField\"\":\"\"Post\"\"}\");\n\n            Assert.AreEqual(null, c2.DateTimeField);\n            Assert.AreEqual(null, c2.DateTimeOffsetField);\n            Assert.AreEqual(\"Pre\", c2.PreField);\n            Assert.AreEqual(\"Post\", c2.PostField);\n        }\n\n        [Test]\n        public void PrivateConstructor()\n        {\n            var person = PersonWithPrivateConstructor.CreatePerson();\n            person.Name = \"John Doe\";\n            person.Age = 25;\n\n            var serializedPerson = JsonConvert.SerializeObject(person);\n            var roundtrippedPerson = JsonConvert.DeserializeObject<PersonWithPrivateConstructor>(serializedPerson);\n\n            Assert.AreEqual(person.Name, roundtrippedPerson.Name);\n        }\n#endif\n\n#if !(DNXCORE50)\n        [Test]\n        public void MetroBlogPost()\n        {\n            Product product = new Product()\n            {\n                Name = \"Apple\",\n                ExpiryDate = new DateTime(2012, 4, 1),\n                Price = 3.99M,\n                Sizes = new[] { \"Small\", \"Medium\", \"Large\" }\n            };\n\n            string json = JsonConvert.SerializeObject(product);\n            //{\n            //  \"Name\": \"Apple\",\n            //  \"ExpiryDate\": \"2012-04-01T00:00:00\",\n            //  \"Price\": 3.99,\n            //  \"Sizes\": [ \"Small\", \"Medium\", \"Large\" ]\n            //}\n\n            string metroJson = JsonConvert.SerializeObject(product, new JsonSerializerSettings\n            {\n                ContractResolver = new MetroPropertyNameResolver(),\n                Converters = { new MetroStringConverter() },\n                Formatting = Formatting.Indented\n            });\n            StringAssert.AreEqual(@\"{\n  \"\":::NAME:::\"\": \"\":::APPLE:::\"\",\n  \"\":::EXPIRYDATE:::\"\": \"\"2012-04-01T00:00:00\"\",\n  \"\":::PRICE:::\"\": 3.99,\n  \"\":::SIZES:::\"\": [\n    \"\":::SMALL:::\"\",\n    \"\":::MEDIUM:::\"\",\n    \"\":::LARGE:::\"\"\n  ]\n}\", metroJson);\n            //{\n            //  \":::NAME:::\": \":::APPLE:::\",\n            //  \":::EXPIRYDATE:::\": \"2012-04-01T00:00:00\",\n            //  \":::PRICE:::\": 3.99,\n            //  \":::SIZES:::\": [ \":::SMALL:::\", \":::MEDIUM:::\", \":::LARGE:::\" ]\n            //}\n\n            Color[] colors = new[] { Color.Blue, Color.Red, Color.Yellow, Color.Green, Color.Black, Color.Brown };\n\n            string json2 = JsonConvert.SerializeObject(colors, new JsonSerializerSettings\n            {\n                ContractResolver = new MetroPropertyNameResolver(),\n                Converters = { new MetroStringConverter(), new MetroColorConverter() },\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::GRAY:::\"\",\n  \"\":::BLACK:::\"\",\n  \"\":::GRAY:::\"\"\n]\", json2);\n        }\n#endif\n\n        [Test]\n        public void MultipleItems()\n        {\n            IList<MultipleItemsClass> values = new List<MultipleItemsClass>();\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(@\"{ \"\"name\"\": \"\"bar\"\" }{ \"\"name\"\": \"\"baz\"\" }\"));\n            reader.SupportMultipleContent = true;\n\n            while (true)\n            {\n                if (!reader.Read())\n                {\n                    break;\n                }\n\n                JsonSerializer serializer = new JsonSerializer();\n                MultipleItemsClass foo = serializer.Deserialize<MultipleItemsClass>(reader);\n\n                values.Add(foo);\n            }\n\n            Assert.AreEqual(2, values.Count);\n            Assert.AreEqual(\"bar\", values[0].Name);\n            Assert.AreEqual(\"baz\", values[1].Name);\n        }\n\n#pragma warning disable 618\n        [Test]\n        public void TokenFromBson()\n        {\n            MemoryStream ms = new MemoryStream();\n            BsonWriter writer = new BsonWriter(ms);\n            writer.WriteStartArray();\n            writer.WriteValue(\"2000-01-02T03:04:05+06:00\");\n            writer.WriteEndArray();\n\n            byte[] data = ms.ToArray();\n            BsonReader reader = new BsonReader(new MemoryStream(data))\n            {\n                ReadRootValueAsArray = true\n            };\n\n            JArray a = (JArray)JArray.ReadFrom(reader);\n            JValue v = (JValue)a[0];\n\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            StringAssert.AreEqual(@\"[\n  \"\"2000-01-02T03:04:05+06:00\"\"\n]\", a.ToString());\n        }\n#pragma warning restore 618\n\n        [Test]\n        public void ObjectRequiredDeserializeMissing()\n        {\n            string json = \"{}\";\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            var o = JsonConvert.DeserializeObject<RequiredObject>(json, new JsonSerializerSettings\n            {\n                Error = error\n            });\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(4, errors.Count);\n            Assert.IsTrue(errors[0].StartsWith(\"Required property 'NonAttributeProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[1].StartsWith(\"Required property 'UnsetProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[2].StartsWith(\"Required property 'AllowNullProperty' not found in JSON. Path ''\"));\n            Assert.IsTrue(errors[3].StartsWith(\"Required property 'AlwaysProperty' not found in JSON. Path ''\"));\n        }\n\n        [Test]\n        public void ObjectRequiredDeserializeNull()\n        {\n            string json = \"{'NonAttributeProperty':null,'UnsetProperty':null,'AllowNullProperty':null,'AlwaysProperty':null}\";\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            var o = JsonConvert.DeserializeObject<RequiredObject>(json, new JsonSerializerSettings\n            {\n                Error = error\n            });\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(3, errors.Count);\n            Assert.IsTrue(errors[0].StartsWith(\"Required property 'NonAttributeProperty' expects a value but got null. Path ''\"));\n            Assert.IsTrue(errors[1].StartsWith(\"Required property 'UnsetProperty' expects a value but got null. Path ''\"));\n            Assert.IsTrue(errors[2].StartsWith(\"Required property 'AlwaysProperty' expects a value but got null. Path ''\"));\n        }\n\n        [Test]\n        public void ObjectRequiredSerialize()\n        {\n            IList<string> errors = new List<string>();\n\n            EventHandler<Newtonsoft.Json.Serialization.ErrorEventArgs> error = (s, e) =>\n            {\n                errors.Add(e.ErrorContext.Error.Message);\n                e.ErrorContext.Handled = true;\n            };\n\n            string json = JsonConvert.SerializeObject(new RequiredObject(), new JsonSerializerSettings\n            {\n                Error = error,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"DefaultProperty\"\": null,\n  \"\"AllowNullProperty\"\": null\n}\", json);\n\n            Assert.AreEqual(3, errors.Count);\n            Assert.AreEqual(\"Cannot write a null value for property 'NonAttributeProperty'. Property requires a value. Path ''.\", errors[0]);\n            Assert.AreEqual(\"Cannot write a null value for property 'UnsetProperty'. Property requires a value. Path ''.\", errors[1]);\n            Assert.AreEqual(\"Cannot write a null value for property 'AlwaysProperty'. Property requires a value. Path ''.\", errors[2]);\n        }\n\n        [Test]\n        public void DeserializeCollectionItemConverter()\n        {\n            PropertyItemConverter c = new PropertyItemConverter\n            {\n                Data =\n                    new[]\n                    {\n                        \"one\",\n                        \"two\",\n                        \"three\"\n                    }\n            };\n\n            var c2 = JsonConvert.DeserializeObject<PropertyItemConverter>(\"{'Data':['::ONE::','::TWO::']}\");\n\n            Assert.IsNotNull(c2);\n            Assert.AreEqual(2, c2.Data.Count);\n            Assert.AreEqual(\"one\", c2.Data[0]);\n            Assert.AreEqual(\"two\", c2.Data[1]);\n        }\n\n        [Test]\n        public void SerializeCollectionItemConverter()\n        {\n            PropertyItemConverter c = new PropertyItemConverter\n            {\n                Data = new[]\n                {\n                    \"one\",\n                    \"two\",\n                    \"three\"\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(c);\n\n            Assert.AreEqual(@\"{\"\"Data\"\":[\"\":::ONE:::\"\",\"\":::TWO:::\"\",\"\":::THREE:::\"\"]}\", json);\n        }\n\n#if !NET20\n        [Test]\n        public void DateTimeDictionaryKey_DateTimeOffset_Iso()\n        {\n            IDictionary<DateTimeOffset, int> dic1 = new Dictionary<DateTimeOffset, int>\n            {\n                { new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero), 1 },\n                { new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-12-12T12:12:12+00:00\"\": 1,\n  \"\"2013-12-12T12:12:12+00:00\"\": 2\n}\", json);\n\n            IDictionary<DateTimeOffset, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTimeOffset, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n            Assert.AreEqual(2, dic2[new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTimeOffset_MS()\n        {\n            IDictionary<DateTimeOffset?, int> dic1 = new Dictionary<DateTimeOffset?, int>\n            {\n                { new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero), 1 },\n                { new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"\\/Date(976623132000+0000)\\/\"\": 1,\n  \"\"\\/Date(1386850332000+0000)\\/\"\": 2\n}\", json);\n\n            IDictionary<DateTimeOffset?, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTimeOffset?, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n            Assert.AreEqual(2, dic2[new DateTimeOffset(2013, 12, 12, 12, 12, 12, TimeSpan.Zero)]);\n        }\n#endif\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_Iso()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-12-12T12:12:12Z\"\": 1,\n  \"\"2013-12-12T12:12:12Z\"\": 2\n}\", json);\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_Iso_Local()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2020, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2023, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateTimeZoneHandling = DateTimeZoneHandling.Local\n            });\n\n            JObject o = JObject.Parse(json);\n            Assert.IsFalse(o.Properties().ElementAt(0).Name.Contains(\"Z\"));\n            Assert.IsFalse(o.Properties().ElementAt(1).Name.Contains(\"Z\"));\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json, new JsonSerializerSettings\n            {\n                DateTimeZoneHandling = DateTimeZoneHandling.Utc\n            });\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2020, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2023, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DateTimeDictionaryKey_DateTime_MS()\n        {\n            IDictionary<DateTime, int> dic1 = new Dictionary<DateTime, int>\n            {\n                { new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc), 1 },\n                { new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc), 2 }\n            };\n\n            string json = JsonConvert.SerializeObject(dic1, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatHandling = DateFormatHandling.MicrosoftDateFormat\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"\\/Date(976623132000)\\/\"\": 1,\n  \"\"\\/Date(1386850332000)\\/\"\": 2\n}\", json);\n\n            IDictionary<DateTime, int> dic2 = JsonConvert.DeserializeObject<IDictionary<DateTime, int>>(json);\n\n            Assert.AreEqual(2, dic2.Count);\n            Assert.AreEqual(1, dic2[new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n            Assert.AreEqual(2, dic2[new DateTime(2013, 12, 12, 12, 12, 12, DateTimeKind.Utc)]);\n        }\n\n        [Test]\n        public void DeserializeEmptyJsonString()\n        {\n            string s = (string)new JsonSerializer().Deserialize(new JsonTextReader(new StringReader(\"''\")));\n            Assert.AreEqual(\"\", s);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeAndDeserializeWithAttributes()\n        {\n            var testObj = new PersonSerializable() { Name = \"John Doe\", Age = 28 };\n\n            var json = Serialize(testObj);\n            var objDeserialized = Deserialize<PersonSerializable>(json);\n\n            Assert.AreEqual(testObj.Name, objDeserialized.Name);\n            Assert.AreEqual(0, objDeserialized.Age);\n        }\n\n        private string Serialize<T>(T obj)\n            where T : class\n        {\n            var stringWriter = new StringWriter();\n            var serializer = new JsonSerializer();\n            serializer.ContractResolver = new DefaultContractResolver\n            {\n                IgnoreSerializableAttribute = false\n            };\n            serializer.Serialize(stringWriter, obj);\n\n            return stringWriter.ToString();\n        }\n\n        private T Deserialize<T>(string json)\n            where T : class\n        {\n            var jsonReader = new JsonTextReader(new StringReader(json));\n            var serializer = new JsonSerializer();\n            serializer.ContractResolver = new DefaultContractResolver\n            {\n                IgnoreSerializableAttribute = false\n            };\n\n            return serializer.Deserialize(jsonReader, typeof(T)) as T;\n        }\n#endif\n\n        [Test]\n        public void PropertyItemConverter()\n        {\n            Event1 e = new Event1\n            {\n                EventName = \"Blackadder III\",\n                Venue = \"Gryphon Theatre\",\n                Performances = new List<DateTime>\n                {\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336458600000),\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336545000000),\n                    DateTimeUtils.ConvertJavaScriptTicksToDateTime(1336636800000)\n                }\n            };\n\n            string json = JsonConvert.SerializeObject(e, Formatting.Indented);\n            //{\n            //  \"EventName\": \"Blackadder III\",\n            //  \"Venue\": \"Gryphon Theatre\",\n            //  \"Performances\": [\n            //    new Date(1336458600000),\n            //    new Date(1336545000000),\n            //    new Date(1336636800000)\n            //  ]\n            //}\n\n            StringAssert.AreEqual(@\"{\n  \"\"EventName\"\": \"\"Blackadder III\"\",\n  \"\"Venue\"\": \"\"Gryphon Theatre\"\",\n  \"\"Performances\"\": [\n    new Date(\n      1336458600000\n    ),\n    new Date(\n      1336545000000\n    ),\n    new Date(\n      1336636800000\n    )\n  ]\n}\", json);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void IgnoreDataMemberTest()\n        {\n            string json = JsonConvert.SerializeObject(new IgnoreDataMemberTestClass() { Ignored = int.MaxValue }, Formatting.Indented);\n            Assert.AreEqual(@\"{}\", json);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void SerializeDataContractSerializationAttributes()\n        {\n            DataContractSerializationAttributesClass dataContract = new DataContractSerializationAttributesClass\n            {\n                NoAttribute = \"Value!\",\n                IgnoreDataMemberAttribute = \"Value!\",\n                DataMemberAttribute = \"Value!\",\n                IgnoreDataMemberAndDataMemberAttribute = \"Value!\"\n            };\n\n            //MemoryStream ms = new MemoryStream();\n            //DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(DataContractSerializationAttributesClass));\n            //serializer.WriteObject(ms, dataContract);\n\n            //Console.WriteLine(Encoding.UTF8.GetString(ms.ToArray()));\n\n            string json = JsonConvert.SerializeObject(dataContract, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"DataMemberAttribute\"\": \"\"Value!\"\",\n  \"\"IgnoreDataMemberAndDataMemberAttribute\"\": \"\"Value!\"\"\n}\", json);\n\n            PocoDataContractSerializationAttributesClass poco = new PocoDataContractSerializationAttributesClass\n            {\n                NoAttribute = \"Value!\",\n                IgnoreDataMemberAttribute = \"Value!\",\n                DataMemberAttribute = \"Value!\",\n                IgnoreDataMemberAndDataMemberAttribute = \"Value!\"\n            };\n\n            json = JsonConvert.SerializeObject(poco, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"NoAttribute\"\": \"\"Value!\"\",\n  \"\"DataMemberAttribute\"\": \"\"Value!\"\"\n}\", json);\n        }\n#endif\n\n        [Test]\n        public void CheckAdditionalContent()\n        {\n            string json = \"{one:1}{}\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n\n            settings.CheckAdditionalContent = true;\n            s = JsonSerializer.Create(settings);\n            ExceptionAssert.Throws<JsonReaderException>(() => { s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json))); }, \"Additional text encountered after finished reading JSON content: {. Path '', line 1, position 7.\");\n        }\n\n        [Test]\n        public void CheckAdditionalContentJustComment()\n        {\n            string json = \"{one:1} // This is just a comment\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings {CheckAdditionalContent = true};\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n        }\n\n        [Test]\n        public void CheckAdditionalContentJustMultipleComments()\n        {\n            string json = @\"{one:1} // This is just a comment\n/* This is just a comment\nover multiple\nlines.*/\n\n// This is just another comment.\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings {CheckAdditionalContent = true};\n            JsonSerializer s = JsonSerializer.Create(settings);\n            IDictionary<string, int> o = s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json)));\n\n            Assert.IsNotNull(o);\n            Assert.AreEqual(1, o[\"one\"]);\n        }\n\n        [Test]\n        public void CheckAdditionalContentCommentsThenAnotherObject()\n        {\n            string json = @\"{one:1} // This is just a comment\n/* This is just a comment\nover multiple\nlines.*/\n\n// This is just another comment. But here comes an empty object.\n{}\";\n\n            JsonSerializerSettings settings = new JsonSerializerSettings { CheckAdditionalContent = true };\n            JsonSerializer s = JsonSerializer.Create(settings);\n            ExceptionAssert.Throws<JsonReaderException>(() => { s.Deserialize<Dictionary<string, int>>(new JsonTextReader(new StringReader(json))); }, \"Additional text encountered after finished reading JSON content: {. Path '', line 7, position 0.\");\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40)\n        [Test]\n        public void DeserializeException()\n        {\n            string json = @\"{ \"\"ClassName\"\" : \"\"System.InvalidOperationException\"\",\n  \"\"Data\"\" : null,\n  \"\"ExceptionMethod\"\" : \"\"8\\nLogin\\nAppBiz, Version=4.0.0.0, Culture=neutral, PublicKeyToken=null\\nMyApp.LoginBiz\\nMyApp.User Login()\"\",\n  \"\"HResult\"\" : -2146233079,\n  \"\"HelpURL\"\" : null,\n  \"\"InnerException\"\" : { \"\"ClassName\"\" : \"\"System.Exception\"\",\n      \"\"Data\"\" : null,\n      \"\"ExceptionMethod\"\" : null,\n      \"\"HResult\"\" : -2146233088,\n      \"\"HelpURL\"\" : null,\n      \"\"InnerException\"\" : null,\n      \"\"Message\"\" : \"\"Inner exception...\"\",\n      \"\"RemoteStackIndex\"\" : 0,\n      \"\"RemoteStackTraceString\"\" : null,\n      \"\"Source\"\" : null,\n      \"\"StackTraceString\"\" : null,\n      \"\"WatsonBuckets\"\" : null\n    },\n  \"\"Message\"\" : \"\"Outter exception...\"\",\n  \"\"RemoteStackIndex\"\" : 0,\n  \"\"RemoteStackTraceString\"\" : null,\n  \"\"Source\"\" : \"\"AppBiz\"\",\n  \"\"StackTraceString\"\" : \"\" at MyApp.LoginBiz.Login() in C:\\\\MyApp\\\\LoginBiz.cs:line 44\\r\\n at MyApp.LoginSvc.Login() in C:\\\\MyApp\\\\LoginSvc.cs:line 71\\r\\n at SyncInvokeLogin(Object , Object[] , Object[] )\\r\\n at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]& outputs)\\r\\n at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc& rpc)\\r\\n at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)\"\",\n  \"\"WatsonBuckets\"\" : null\n}\";\n\n            InvalidOperationException exception = JsonConvert.DeserializeObject<InvalidOperationException>(json);\n            Assert.IsNotNull(exception);\n            CustomAssert.IsInstanceOfType(typeof(InvalidOperationException), exception);\n\n            Assert.AreEqual(\"Outter exception...\", exception.Message);\n        }\n#endif\n\n        [Test]\n        public void AdditionalContentAfterFinish()\n        {\n            ExceptionAssert.Throws<JsonException>(() =>\n            {\n                string json = \"[{},1]\";\n\n                JsonSerializer serializer = new JsonSerializer();\n                serializer.CheckAdditionalContent = true;\n\n                var reader = new JsonTextReader(new StringReader(json));\n                reader.Read();\n                reader.Read();\n\n                serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            }, \"Additional text found in JSON string after finishing deserializing object. Path '[1]', line 1, position 5.\");\n        }\n\n        [Test]\n        public void AdditionalContentAfterFinishCheckNotRequested()\n        {\n            string json = @\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} A bunch of junk at the end of the json\";\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            var reader = new JsonTextReader(new StringReader(json));\n\n            ItemConverterTestClass mt = (ItemConverterTestClass)serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            Assert.AreEqual(1, mt.MyProperty.Count);\n        }\n\n        [Test]\n        public void AdditionalContentAfterCommentsCheckNotRequested()\n        {\n            string json = @\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} /*this is a comment */\n// this is also a comment\nThis is just junk, though.\";\n\n            JsonSerializer serializer = new JsonSerializer();\n\n            var reader = new JsonTextReader(new StringReader(json));\n\n            ItemConverterTestClass mt = (ItemConverterTestClass)serializer.Deserialize(reader, typeof(ItemConverterTestClass));\n            Assert.AreEqual(1, mt.MyProperty.Count);\n        }\n\n        [Test]\n        public void AdditionalContentAfterComments()\n        {\n            string json = @\"[{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Value\"\"}} /*this is a comment */\n// this is also a comment\n,{}\";\n\n            JsonSerializer serializer = new JsonSerializer();\n            serializer.CheckAdditionalContent = true;\n            var reader = new JsonTextReader(new StringReader(json));\n            reader.Read();\n            reader.Read();\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => serializer.Deserialize(reader, typeof(ItemConverterTestClass)),\n                \"Additional text found in JSON string after finishing deserializing object. Path '[1]', line 3, position 2.\");\n        }\n\n        [Test]\n        public void DeserializeRelativeUri()\n        {\n            IList<Uri> uris = JsonConvert.DeserializeObject<IList<Uri>>(@\"[\"\"http://localhost/path?query#hash\"\"]\");\n            Assert.AreEqual(1, uris.Count);\n            Assert.AreEqual(new Uri(\"http://localhost/path?query#hash\"), uris[0]);\n\n            Uri uri = JsonConvert.DeserializeObject<Uri>(@\"\"\"http://localhost/path?query#hash\"\"\");\n            Assert.IsNotNull(uri);\n\n            Uri i1 = new Uri(\"http://localhost/path?query#hash\", UriKind.RelativeOrAbsolute);\n            Uri i2 = new Uri(\"http://localhost/path?query#hash\");\n            Assert.AreEqual(i1, i2);\n\n            uri = JsonConvert.DeserializeObject<Uri>(@\"\"\"/path?query#hash\"\"\");\n            Assert.IsNotNull(uri);\n            Assert.AreEqual(new Uri(\"/path?query#hash\", UriKind.RelativeOrAbsolute), uri);\n        }\n\n        [Test]\n        public void DeserializeDictionaryItemConverter()\n        {\n            var actual = JsonConvert.DeserializeObject<ItemConverterTestClass>(@\"{ \"\"MyProperty\"\":{\"\"Key\"\":\"\"Y\"\"}}\");\n            Assert.AreEqual(\"X\", actual.MyProperty[\"Key\"]);\n        }\n\n        [Test]\n        public void DeserializeCaseInsensitiveKeyValuePairConverter()\n        {\n            KeyValuePair<int, string> result =\n                JsonConvert.DeserializeObject<KeyValuePair<int, string>>(\n                    \"{key: 123, \\\"VALUE\\\": \\\"test value\\\"}\"\n                );\n\n            Assert.AreEqual(123, result.Key);\n            Assert.AreEqual(\"test value\", result.Value);\n        }\n\n        [Test]\n        public void SerializeKeyValuePairConverterWithCamelCase()\n        {\n            string json =\n                JsonConvert.SerializeObject(new KeyValuePair<int, string>(123, \"test value\"), Formatting.Indented, new JsonSerializerSettings\n                {\n                    ContractResolver = new CamelCasePropertyNamesContractResolver()\n                });\n\n            StringAssert.AreEqual(@\"{\n  \"\"key\"\": 123,\n  \"\"value\"\": \"\"test value\"\"\n}\", json);\n        }\n\n        [Test]\n        public void SerializeFloatingPointHandling()\n        {\n            string json;\n            IList<double> d = new List<double> { 1.1, double.NaN, double.PositiveInfinity };\n\n            json = JsonConvert.SerializeObject(d);\n            // [1.1,\"NaN\",\"Infinity\"]\n\n            json = JsonConvert.SerializeObject(d, new JsonSerializerSettings { FloatFormatHandling = FloatFormatHandling.Symbol });\n            // [1.1,NaN,Infinity]\n\n            json = JsonConvert.SerializeObject(d, new JsonSerializerSettings { FloatFormatHandling = FloatFormatHandling.DefaultValue });\n            // [1.1,0.0,0.0]\n\n            Assert.AreEqual(\"[1.1,0.0,0.0]\", json);\n        }\n\n#if !(NET20 || NET35 || NET40 || PORTABLE40)\n#if !PORTABLE || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeReadOnlyListWithBigInteger()\n        {\n            string json = @\"[\n        9000000000000000000000000000000000000000000000000\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<BigInteger>>(json);\n\n            BigInteger nineQuindecillion = l[0];\n            // 9000000000000000000000000000000000000000000000000\n\n            Assert.AreEqual(BigInteger.Parse(\"9000000000000000000000000000000000000000000000000\"), nineQuindecillion);\n        }\n#endif\n\n        [Test]\n        public void DeserializeReadOnlyListWithInt()\n        {\n            string json = @\"[\n        900\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<int>>(json);\n\n            int i = l[0];\n            // 900\n\n            Assert.AreEqual(900, i);\n        }\n\n        [Test]\n        public void DeserializeReadOnlyListWithNullableType()\n        {\n            string json = @\"[\n        1,\n        null\n      ]\";\n\n            var l = JsonConvert.DeserializeObject<IReadOnlyList<int?>>(json);\n\n            Assert.AreEqual(1, l[0]);\n            Assert.AreEqual(null, l[1]);\n        }\n#endif\n\n        [Test]\n        public void SerializeCustomTupleWithSerializableAttribute()\n        {\n            var tuple = new MyTuple<int>(500);\n            var json = JsonConvert.SerializeObject(tuple);\n            Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n            MyTuple<int> obj = null;\n\n            Action doStuff = () => { obj = JsonConvert.DeserializeObject<MyTuple<int>>(json); };\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD2_0\n            doStuff();\n            Assert.AreEqual(500, obj.Item1);\n#else\n            ExceptionAssert.Throws<JsonSerializationException>(\n                doStuff,\n                \"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.MyTuple`1[System.Int32]. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'm_Item1', line 1, position 11.\");\n#endif\n        }\n\n#if DEBUG\n        [Test]\n        public void SerializeCustomTupleWithSerializableAttributeInPartialTrust()\n        {\n            try\n            {\n                JsonTypeReflector.SetFullyTrusted(false);\n\n                var tuple = new MyTuplePartial<int>(500);\n                var json = JsonConvert.SerializeObject(tuple);\n                Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n                ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<MyTuplePartial<int>>(json), \"Unable to find a constructor to use for type Newtonsoft.Json.Tests.TestObjects.MyTuplePartial`1[System.Int32]. A class should either have a default constructor, one constructor with arguments or a constructor marked with the JsonConstructor attribute. Path 'm_Item1', line 1, position 11.\");\n            }\n            finally\n            {\n                JsonTypeReflector.SetFullyTrusted(true);\n            }\n        }\n#endif\n\n#if !(PORTABLE || NET35 || NET20 || PORTABLE40 || DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void SerializeTupleWithSerializableAttribute()\n        {\n            var tuple = Tuple.Create(500);\n\n            SerializableContractResolver contractResolver = new SerializableContractResolver();\n\n            var json = JsonConvert.SerializeObject(tuple, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n            Assert.AreEqual(@\"{\"\"m_Item1\"\":500}\", json);\n\n            var obj = JsonConvert.DeserializeObject<Tuple<int>>(json, new JsonSerializerSettings\n            {\n                ContractResolver = contractResolver\n            });\n            Assert.AreEqual(500, obj.Item1);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void RoundtripOfDateTimeOffset()\n        {\n            var content = @\"{\"\"startDateTime\"\":\"\"2012-07-19T14:30:00+09:30\"\"}\";\n\n            var jsonSerializerSettings = new JsonSerializerSettings() { DateFormatHandling = DateFormatHandling.IsoDateFormat, DateParseHandling = DateParseHandling.DateTimeOffset, DateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind };\n\n            var obj = (JObject)JsonConvert.DeserializeObject(content, jsonSerializerSettings);\n\n            var dateTimeOffset = (DateTimeOffset)((JValue)obj[\"startDateTime\"]).Value;\n\n            Assert.AreEqual(TimeSpan.FromHours(9.5), dateTimeOffset.Offset);\n            Assert.AreEqual(\"07/19/2012 14:30:00 +09:30\", dateTimeOffset.ToString(CultureInfo.InvariantCulture));\n        }\n\n        [Test]\n        public void NullableFloatingPoint()\n        {\n            NullableFloats floats = new NullableFloats\n            {\n                Object = double.NaN,\n                ObjectNull = null,\n                Float = float.NaN,\n                NullableDouble = double.NaN,\n                NullableFloat = null\n            };\n\n            string json = JsonConvert.SerializeObject(floats, Formatting.Indented, new JsonSerializerSettings\n            {\n                FloatFormatHandling = FloatFormatHandling.DefaultValue\n            });\n\n            StringAssert.AreEqual(@\"{\n  \"\"Object\"\": 0.0,\n  \"\"Float\"\": 0.0,\n  \"\"Double\"\": 0.0,\n  \"\"NullableFloat\"\": null,\n  \"\"NullableDouble\"\": null,\n  \"\"ObjectNull\"\": null\n}\", json);\n        }\n\n        [Test]\n        public void DateFormatString()\n        {\n            CultureInfo culture = new CultureInfo(\"en-NZ\");\n            culture.DateTimeFormat.AMDesignator = \"a.m.\";\n            culture.DateTimeFormat.PMDesignator = \"p.m.\";\n\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            string json = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = \"yyyy tt\",\n                Culture = culture\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000 p.m.\"\",\n  \"\"2000 p.m.\"\"\n]\", json);\n        }\n\n        [Test]\n        public void DateFormatStringForInternetExplorer()\n        {\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            string json = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = @\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.fffK\"\n            });\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000-12-12T12:12:12.000Z\"\",\n  \"\"2000-12-12T12:12:12.000+01:00\"\"\n]\", json);\n        }\n\n        [Test]\n        public void JsonSerializerDateFormatString()\n        {\n            CultureInfo culture = new CultureInfo(\"en-NZ\");\n            culture.DateTimeFormat.AMDesignator = \"a.m.\";\n            culture.DateTimeFormat.PMDesignator = \"p.m.\";\n\n            IList<object> dates = new List<object>\n            {\n                new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc),\n                new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1))\n            };\n\n            StringWriter sw = new StringWriter();\n            JsonTextWriter jsonWriter = new JsonTextWriter(sw);\n\n            JsonSerializer serializer = JsonSerializer.Create(new JsonSerializerSettings\n            {\n                DateFormatString = \"yyyy tt\",\n                Culture = culture,\n                Formatting = Formatting.Indented\n            });\n            serializer.Serialize(jsonWriter, dates);\n\n            Assert.IsNull(jsonWriter.DateFormatString);\n            Assert.AreEqual(CultureInfo.InvariantCulture, jsonWriter.Culture);\n            Assert.AreEqual(Formatting.None, jsonWriter.Formatting);\n\n            string json = sw.ToString();\n\n            StringAssert.AreEqual(@\"[\n  \"\"2000 p.m.\"\",\n  \"\"2000 p.m.\"\"\n]\", json);\n        }\n\n#if !(NET20 || NET35)\n        [Test]\n        public void SerializeDeserializeTuple()\n        {\n            Tuple<int, int> tuple = Tuple.Create(500, 20);\n            string json = JsonConvert.SerializeObject(tuple);\n            Assert.AreEqual(@\"{\"\"Item1\"\":500,\"\"Item2\"\":20}\", json);\n\n            Tuple<int, int> tuple2 = JsonConvert.DeserializeObject<Tuple<int, int>>(json);\n            Assert.AreEqual(500, tuple2.Item1);\n            Assert.AreEqual(20, tuple2.Item2);\n        }\n#endif\n\n        [Test]\n        public void JsonSerializerStringEscapeHandling()\n        {\n            StringWriter sw = new StringWriter();\n            JsonTextWriter jsonWriter = new JsonTextWriter(sw);\n\n            JsonSerializer serializer = JsonSerializer.Create(new JsonSerializerSettings\n            {\n                StringEscapeHandling = StringEscapeHandling.EscapeHtml,\n                Formatting = Formatting.Indented\n            });\n            serializer.Serialize(jsonWriter, new { html = \"<html></html>\" });\n\n            Assert.AreEqual(StringEscapeHandling.Default, jsonWriter.StringEscapeHandling);\n\n            string json = sw.ToString();\n\n            StringAssert.AreEqual(@\"{\n  \"\"html\"\": \"\"\\u003chtml\\u003e\\u003c/html\\u003e\"\"\n}\", json);\n        }\n\n        [Test]\n        public void NoConstructorReadOnlyCollectionTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<NoConstructorReadOnlyCollection<int>>(\"[1]\"), \"Cannot deserialize readonly or fixed size list: Newtonsoft.Json.Tests.TestObjects.NoConstructorReadOnlyCollection`1[System.Int32]. Path '', line 1, position 1.\");\n        }\n\n#if !(NET40 || NET35 || NET20 || PORTABLE40)\n        [Test]\n        public void NoConstructorReadOnlyDictionaryTest()\n        {\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<NoConstructorReadOnlyDictionary<int, int>>(\"{'1':1}\"), \"Cannot deserialize readonly or fixed size dictionary: Newtonsoft.Json.Tests.TestObjects.NoConstructorReadOnlyDictionary`2[System.Int32,System.Int32]. Path '1', line 1, position 5.\");\n        }\n#endif\n\n#if !(PORTABLE || NET35 || NET20 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ReadTooLargeInteger()\n        {\n            string json = @\"[999999999999999999999999999999999999999999999999]\";\n\n            IList<BigInteger> l = JsonConvert.DeserializeObject<IList<BigInteger>>(json);\n\n            Assert.AreEqual(BigInteger.Parse(\"999999999999999999999999999999999999999999999999\"), l[0]);\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<IList<long>>(json), \"Error converting value 999999999999999999999999999999999999999999999999 to type 'System.Int64'. Path '[0]', line 1, position 49.\");\n        }\n#endif\n\n        [Test]\n        public void SerializeStructWithSerializableAndDataContract()\n        {\n            Pair<string, int> p = new Pair<string, int>(\"One\", 2);\n\n            string json = JsonConvert.SerializeObject(p);\n\n            Assert.AreEqual(@\"{\"\"First\"\":\"\"One\"\",\"\"Second\"\":2}\", json);\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n            DefaultContractResolver r = new DefaultContractResolver();\n            r.IgnoreSerializableAttribute = false;\n\n            json = JsonConvert.SerializeObject(p, new JsonSerializerSettings\n            {\n                ContractResolver = r\n            });\n\n            Assert.AreEqual(@\"{\"\"First\"\":\"\"One\"\",\"\"Second\"\":2}\", json);\n#endif\n        }\n\n        [Test]\n        public void ReadStringFloatingPointSymbols()\n        {\n            string json = @\"[\n  \"\"NaN\"\",\n  \"\"Infinity\"\",\n  \"\"-Infinity\"\"\n]\";\n\n            IList<float> floats = JsonConvert.DeserializeObject<IList<float>>(json);\n            Assert.AreEqual(float.NaN, floats[0]);\n            Assert.AreEqual(float.PositiveInfinity, floats[1]);\n            Assert.AreEqual(float.NegativeInfinity, floats[2]);\n\n            IList<double> doubles = JsonConvert.DeserializeObject<IList<double>>(json);\n            Assert.AreEqual(float.NaN, doubles[0]);\n            Assert.AreEqual(float.PositiveInfinity, doubles[1]);\n            Assert.AreEqual(float.NegativeInfinity, doubles[2]);\n        }\n\n        [Test]\n        public void DefaultDateStringFormatVsUnsetDateStringFormat()\n        {\n            IDictionary<string, object> dates = new Dictionary<string, object>\n            {\n                { \"DateTime-Unspecified\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Unspecified) },\n                { \"DateTime-Utc\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Utc) },\n                { \"DateTime-Local\", new DateTime(2000, 12, 12, 12, 12, 12, DateTimeKind.Local) },\n                { \"DateTimeOffset-Zero\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.Zero) },\n                { \"DateTimeOffset-Plus1\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1)) },\n                { \"DateTimeOffset-Plus15\", new DateTimeOffset(2000, 12, 12, 12, 12, 12, TimeSpan.FromHours(1.5)) }\n            };\n\n            string expected = JsonConvert.SerializeObject(dates, Formatting.Indented);\n\n            string actual = JsonConvert.SerializeObject(dates, Formatting.Indented, new JsonSerializerSettings\n            {\n                DateFormatString = JsonSerializerSettings.DefaultDateFormatString\n            });\n\n            Assert.AreEqual(expected, actual);\n        }\n#endif\n\n#if !NET20\n        [Test]\n        public void TestStringToNullableDeserialization()\n        {\n            string json = @\"{\n  \"\"MyNullableBool\"\": \"\"\"\",\n  \"\"MyNullableInteger\"\": \"\"\"\",\n  \"\"MyNullableDateTime\"\": \"\"\"\",\n  \"\"MyNullableDateTimeOffset\"\": \"\"\"\",\n  \"\"MyNullableDecimal\"\": \"\"\"\"\n}\";\n\n            NullableTestClass c2 = JsonConvert.DeserializeObject<NullableTestClass>(json);\n            Assert.IsNull(c2.MyNullableBool);\n            Assert.IsNull(c2.MyNullableInteger);\n            Assert.IsNull(c2.MyNullableDateTime);\n            Assert.IsNull(c2.MyNullableDateTimeOffset);\n            Assert.IsNull(c2.MyNullableDecimal);\n        }\n#endif\n\n#if !(NET20 || NET35)\n        [Test]\n        public void HashSetInterface()\n        {\n            ISet<string> s1 = new HashSet<string>(new[] { \"1\", \"two\", \"III\" });\n\n            string json = JsonConvert.SerializeObject(s1);\n\n            ISet<string> s2 = JsonConvert.DeserializeObject<ISet<string>>(json);\n\n            Assert.AreEqual(s1.Count, s2.Count);\n            foreach (string s in s1)\n            {\n                Assert.IsTrue(s2.Contains(s));\n            }\n        }\n#endif\n\n        [Test]\n        public void DeserializeDecimal()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(\"1234567890.123456\"));\n            var settings = new JsonSerializerSettings();\n            var serialiser = JsonSerializer.Create(settings);\n            decimal? d = serialiser.Deserialize<decimal?>(reader);\n\n            Assert.AreEqual(1234567890.123456m, d);\n        }\n\n#if !(PORTABLE || DNXCORE50 || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DontSerializeStaticFields()\n        {\n            string json =\n                JsonConvert.SerializeObject(new AnswerFilterModel(), Formatting.Indented, new JsonSerializerSettings\n                {\n                    ContractResolver = new DefaultContractResolver\n                    {\n                        IgnoreSerializableAttribute = false\n                    }\n                });\n\n            StringAssert.AreEqual(@\"{\n  \"\"<Active>k__BackingField\"\": false,\n  \"\"<Ja>k__BackingField\"\": false,\n  \"\"<Handlungsbedarf>k__BackingField\"\": false,\n  \"\"<Beratungsbedarf>k__BackingField\"\": false,\n  \"\"<Unzutreffend>k__BackingField\"\": false,\n  \"\"<Unbeantwortet>k__BackingField\"\": false\n}\", json);\n        }\n#endif\n\n#if !(NET20 || NET35 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeBigInteger()\n        {\n            BigInteger i = BigInteger.Parse(\"123456789999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999990\");\n\n            string json = JsonConvert.SerializeObject(new[] { i }, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"[\n  123456789999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999990\n]\", json);\n        }\n#endif\n\n        [Test]\n        public void DeserializeWithConstructor()\n        {\n            const string json = @\"{\"\"something_else\"\":\"\"my value\"\"}\";\n            var foo = JsonConvert.DeserializeObject<FooConstructor>(json);\n            Assert.AreEqual(\"my value\", foo.Bar);\n        }\n\n        [Test]\n        public void SerializeCustomReferenceResolver()\n        {\n            PersonReference john = new PersonReference\n            {\n                Id = new Guid(\"0B64FFDF-D155-44AD-9689-58D9ADB137F3\"),\n                Name = \"John Smith\"\n            };\n\n            PersonReference jane = new PersonReference\n            {\n                Id = new Guid(\"AE3C399C-058D-431D-91B0-A36C266441B9\"),\n                Name = \"Jane Smith\"\n            };\n\n            john.Spouse = jane;\n            jane.Spouse = john;\n\n            IList<PersonReference> people = new List<PersonReference>\n            {\n                john,\n                jane\n            };\n\n            string json = JsonConvert.SerializeObject(people, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = new IdReferenceResolver(),\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\", json);\n        }\n\n        [Test]\n        public void NullReferenceResolver()\n        {\n            PersonReference john = new PersonReference\n            {\n                Id = new Guid(\"0B64FFDF-D155-44AD-9689-58D9ADB137F3\"),\n                Name = \"John Smith\"\n            };\n\n            PersonReference jane = new PersonReference\n            {\n                Id = new Guid(\"AE3C399C-058D-431D-91B0-A36C266441B9\"),\n                Name = \"Jane Smith\"\n            };\n\n            john.Spouse = jane;\n            jane.Spouse = john;\n\n            IList<PersonReference> people = new List<PersonReference>\n            {\n                john,\n                jane\n            };\n\n            string json = JsonConvert.SerializeObject(people, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = null,\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            StringAssert.AreEqual(@\"[\n  {\n    \"\"$id\"\": \"\"1\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"2\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"1\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"2\"\"\n  }\n]\", json);\n        }\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50)\n        [Test]\n        public void SerializeDictionaryWithStructKey()\n        {\n            string json = JsonConvert.SerializeObject(\n                new Dictionary<Size, Size> { { new Size(1, 2), new Size(3, 4) } }\n            );\n\n            Assert.AreEqual(@\"{\"\"1, 2\"\":\"\"3, 4\"\"}\", json);\n\n            Dictionary<Size, Size> d = JsonConvert.DeserializeObject<Dictionary<Size, Size>>(json);\n\n            Assert.AreEqual(new Size(1, 2), d.Keys.First());\n            Assert.AreEqual(new Size(3, 4), d.Values.First());\n        }\n#endif\n\n#if !(PORTABLE || PORTABLE40 || DNXCORE50) || NETSTANDARD1_0 || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void SerializeDictionaryWithStructKey_Custom()\n        {\n            string json = JsonConvert.SerializeObject(\n                new Dictionary<TypeConverterSize, TypeConverterSize> { { new TypeConverterSize(1, 2), new TypeConverterSize(3, 4) } }\n            );\n\n            Assert.AreEqual(@\"{\"\"1, 2\"\":\"\"3, 4\"\"}\", json);\n\n            Dictionary<TypeConverterSize, TypeConverterSize> d = JsonConvert.DeserializeObject<Dictionary<TypeConverterSize, TypeConverterSize>>(json);\n\n            Assert.AreEqual(new TypeConverterSize(1, 2), d.Keys.First());\n            Assert.AreEqual(new TypeConverterSize(3, 4), d.Values.First());\n        }\n#endif\n\n        [Test]\n        public void DeserializeCustomReferenceResolver()\n        {\n            string json = @\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\";\n\n            IList<PersonReference> people = JsonConvert.DeserializeObject<IList<PersonReference>>(json, new JsonSerializerSettings\n            {\n#pragma warning disable 618\n                ReferenceResolver = new IdReferenceResolver(),\n#pragma warning restore 618\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            Assert.AreEqual(2, people.Count);\n\n            PersonReference john = people[0];\n            PersonReference jane = people[1];\n\n            Assert.AreEqual(john, jane.Spouse);\n            Assert.AreEqual(jane, john.Spouse);\n        }\n\n        [Test]\n        public void DeserializeCustomReferenceResolver_ViaProvider()\n        {\n            string json = @\"[\n  {\n    \"\"$id\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\",\n    \"\"Name\"\": \"\"John Smith\"\",\n    \"\"Spouse\"\": {\n      \"\"$id\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\",\n      \"\"Name\"\": \"\"Jane Smith\"\",\n      \"\"Spouse\"\": {\n        \"\"$ref\"\": \"\"0b64ffdf-d155-44ad-9689-58d9adb137f3\"\"\n      }\n    }\n  },\n  {\n    \"\"$ref\"\": \"\"ae3c399c-058d-431d-91b0-a36c266441b9\"\"\n  }\n]\";\n\n            IList<PersonReference> people = JsonConvert.DeserializeObject<IList<PersonReference>>(json, new JsonSerializerSettings\n            {\n                ReferenceResolverProvider = () => new IdReferenceResolver(),\n                PreserveReferencesHandling = PreserveReferencesHandling.Objects,\n                Formatting = Formatting.Indented\n            });\n\n            Assert.AreEqual(2, people.Count);\n\n            PersonReference john = people[0];\n            PersonReference jane = people[1];\n\n            Assert.AreEqual(john, jane.Spouse);\n            Assert.AreEqual(jane, john.Spouse);\n        }\n\n#if !(NET35 || NET20 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void TypeConverterOnInterface()\n        {\n            var consoleWriter = new ConsoleWriter();\n\n            // If dynamic type handling is enabled, case 1 and 3 work fine\n            var options = new JsonSerializerSettings\n            {\n                Converters = new JsonConverterCollection { new TypeConverterJsonConverter() },\n                //TypeNameHandling = TypeNameHandling.All\n            };\n\n            //\n            // Case 1: Serialize the concrete value and restore it from the interface\n            // Therefore we need dynamic handling of type information if the type is not serialized with the type converter directly\n            //\n            var text1 = JsonConvert.SerializeObject(consoleWriter, Formatting.Indented, options);\n            Assert.AreEqual(@\"\"\"Console Writer\"\"\", text1);\n\n            var restoredWriter = JsonConvert.DeserializeObject<IMyInterface>(text1, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredWriter.PrintTest());\n\n            //\n            // Case 2: Serialize a dictionary where the interface is the key\n            // The key is always serialized with its ToString() method and therefore needs a mechanism to be restored from that (using the type converter)\n            //\n            var dict2 = new Dictionary<IMyInterface, string>();\n            dict2.Add(consoleWriter, \"Console\");\n\n            var text2 = JsonConvert.SerializeObject(dict2, Formatting.Indented, options);\n            StringAssert.AreEqual(@\"{\n  \"\"Console Writer\"\": \"\"Console\"\"\n}\", text2);\n\n            var restoredObject = JsonConvert.DeserializeObject<Dictionary<IMyInterface, string>>(text2, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredObject.First().Key.PrintTest());\n\n            //\n            // Case 3 Serialize a dictionary where the interface is the value\n            // The key is always serialized with its ToString() method and therefore needs a mechanism to be restored from that (using the type converter)\n            //\n            var dict3 = new Dictionary<string, IMyInterface>();\n            dict3.Add(\"Console\", consoleWriter);\n\n            var text3 = JsonConvert.SerializeObject(dict3, Formatting.Indented, options);\n            StringAssert.AreEqual(@\"{\n  \"\"Console\"\": \"\"Console Writer\"\"\n}\", text3);\n\n            var restoredDict2 = JsonConvert.DeserializeObject<Dictionary<string, IMyInterface>>(text3, options);\n            Assert.AreEqual(\"ConsoleWriter\", restoredDict2.First().Value.PrintTest());\n        }\n#endif\n\n        [Test]\n        public void Main()\n        {\n            ParticipantEntity product = new ParticipantEntity();\n            product.Properties = new Dictionary<string, string> { { \"s\", \"d\" } };\n            string json = JsonConvert.SerializeObject(product);\n\n            Assert.AreEqual(@\"{\"\"pa_info\"\":{\"\"s\"\":\"\"d\"\"}}\", json);\n            ParticipantEntity deserializedProduct = JsonConvert.DeserializeObject<ParticipantEntity>(json);\n        }\n\n#if !(PORTABLE) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void ConvertibleIdTest()\n        {\n            var c = new TestClassConvertable { Id = new ConvertibleId { Value = 1 }, X = 2 };\n            var s = JsonConvert.SerializeObject(c, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"Id\"\": \"\"1\"\",\n  \"\"X\"\": 2\n}\", s);\n        }\n#endif\n\n        [Test]\n        public void DuplicatePropertiesInNestedObject()\n        {\n            string content = @\"{\"\"result\"\":{\"\"time\"\":1408188592,\"\"time\"\":1408188593},\"\"error\"\":null,\"\"id\"\":\"\"1\"\"}\";\n            JObject o = JsonConvert.DeserializeObject<JObject>(content);\n            int time = (int)o[\"result\"][\"time\"];\n\n            Assert.AreEqual(1408188593, time);\n        }\n\n        [Test]\n        public void RoundtripUriOriginalString()\n        {\n            string originalUri = \"https://test.com?m=a%2bb\";\n\n            Uri uriWithPlus = new Uri(originalUri);\n\n            string jsonWithPlus = JsonConvert.SerializeObject(uriWithPlus);\n\n            Uri uriWithPlus2 = JsonConvert.DeserializeObject<Uri>(jsonWithPlus);\n\n            Assert.AreEqual(originalUri, uriWithPlus2.OriginalString);\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTime()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Dec-Friday-22\"\"\", json);\n\n            DateTime dt1 = JsonConvert.DeserializeObject<DateTime>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTime), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTime)v.Value);\n\n            reader = new JsonTextReader(new StringReader(@\"\"\"abc\"\"\"))\n            {\n                DateFormatString = dateFormatString\n            };\n            v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.String, v.Type);\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            Assert.AreEqual(\"abc\", v.Value);\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTimeAndCulture()\n        {\n            CultureInfo culture = new CultureInfo(\"tr-TR\");\n\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Ara-Cuma-22\"\"\", json);\n\n            DateTime dt1 = JsonConvert.DeserializeObject<DateTime>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTime), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTime)v.Value);\n\n            reader = new JsonTextReader(new StringReader(@\"\"\"2000-pie-Dec-Friday-22\"\"\"))\n            {\n                DateFormatString = dateFormatString,\n                Culture = culture\n            };\n            v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.String, v.Type);\n            Assert.AreEqual(typeof(string), v.Value.GetType());\n            Assert.AreEqual(\"2000-pie-Dec-Friday-22\", v.Value);\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTime()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTime, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTime, string> d = JsonConvert.DeserializeObject<Dictionary<DateTime, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTime_ReadAhead()\n        {\n            DateTime dt = new DateTime(2000, 12, 22);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                MetadataPropertyHandling = MetadataPropertyHandling.ReadAhead,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTime, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTime, string> d = JsonConvert.DeserializeObject<Dictionary<DateTime, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n#if !NET20\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTimeOffset()\n        {\n            DateTimeOffset dt = new DateTimeOffset(2000, 12, 22, 0, 0, 0, TimeSpan.Zero);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd'!'K\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTimeOffset, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22!+00:00\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTimeOffset, string> d = JsonConvert.DeserializeObject<Dictionary<DateTimeOffset, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDictionaryKey_DateTimeOffset_ReadAhead()\n        {\n            DateTimeOffset dt = new DateTimeOffset(2000, 12, 22, 0, 0, 0, TimeSpan.Zero);\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd'!'K\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString,\n                MetadataPropertyHandling = MetadataPropertyHandling.ReadAhead,\n                Formatting = Formatting.Indented\n            };\n\n            string json = JsonConvert.SerializeObject(new Dictionary<DateTimeOffset, string>\n            {\n                { dt, \"123\" }\n            }, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"2000-pie-Dec-Friday-22!+00:00\"\": \"\"123\"\"\n}\", json);\n\n            Dictionary<DateTimeOffset, string> d = JsonConvert.DeserializeObject<Dictionary<DateTimeOffset, string>>(json, settings);\n\n            Assert.AreEqual(dt, d.Keys.ElementAt(0));\n        }\n\n        [Test]\n        public void DateFormatStringWithDateTimeOffset()\n        {\n            DateTimeOffset dt = new DateTimeOffset(new DateTime(2000, 12, 22));\n            string dateFormatString = \"yyyy'-pie-'MMM'-'dddd'-'dd\";\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                DateFormatString = dateFormatString\n            };\n\n            string json = JsonConvert.SerializeObject(dt, settings);\n\n            Assert.AreEqual(@\"\"\"2000-pie-Dec-Friday-22\"\"\", json);\n\n            DateTimeOffset dt1 = JsonConvert.DeserializeObject<DateTimeOffset>(json, settings);\n\n            Assert.AreEqual(dt, dt1);\n\n            JsonTextReader reader = new JsonTextReader(new StringReader(json))\n            {\n                DateFormatString = dateFormatString,\n                DateParseHandling = DateParseHandling.DateTimeOffset\n            };\n            JValue v = (JValue)JToken.ReadFrom(reader);\n\n            Assert.AreEqual(JTokenType.Date, v.Type);\n            Assert.AreEqual(typeof(DateTimeOffset), v.Value.GetType());\n            Assert.AreEqual(dt, (DateTimeOffset)v.Value);\n        }\n\n        [Test]\n        public void DeserializeConstantProperty()\n        {\n            ConstantTestClass c1 = new ConstantTestClass();\n\n            string json = JsonConvert.SerializeObject(c1, Formatting.Indented);\n\n            StringAssert.AreEqual(@\"{\n  \"\"MY_CONSTANT\"\": \"\".\"\"\n}\", json);\n\n            JsonConvert.DeserializeObject<ConstantTestClass>(json);\n        }\n#endif\n\n        [Test]\n        public void SerializeObjectWithEvent()\n        {\n            MyObservableObject o = new MyObservableObject\n            {\n                TestString = \"Test string\"\n            };\n\n            string json = JsonConvert.SerializeObject(o, Formatting.Indented);\n            StringAssert.AreEqual(@\"{\n  \"\"PropertyChanged\"\": null,\n  \"\"TestString\"\": \"\"Test string\"\"\n}\", json);\n\n            MyObservableObject o2 = JsonConvert.DeserializeObject<MyObservableObject>(json);\n            Assert.AreEqual(\"Test string\", o2.TestString);\n        }\n\n        [Test]\n        public void ParameterizedConstructorWithBasePrivateProperties()\n        {\n            var original = new DerivedConstructorType(\"Base\", \"Derived\");\n\n            var serializerSettings = new JsonSerializerSettings();\n            var jsonCopy = JsonConvert.SerializeObject(original, serializerSettings);\n\n            var clonedObject = JsonConvert.DeserializeObject<DerivedConstructorType>(jsonCopy, serializerSettings);\n\n            Assert.AreEqual(\"Base\", clonedObject.BaseProperty);\n            Assert.AreEqual(\"Derived\", clonedObject.DerivedProperty);\n        }\n\n        [Test]\n        public void ErrorCreatingJsonConverter()\n        {\n            ExceptionAssert.Throws<JsonException>(() => JsonConvert.SerializeObject(new ErroringTestClass()), \"Error creating 'Newtonsoft.Json.Tests.TestObjects.ErroringJsonConverter'.\");\n        }\n\n        [Test]\n        public void DeserializeInvalidOctalRootError()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(() => JsonConvert.DeserializeObject<string>(\"020474068\"), \"Input string '020474068' is not a valid number. Path '', line 1, position 9.\");\n        }\n\n        [Test]\n        public void DeserializedDerivedWithPrivate()\n        {\n            string json = @\"{\n  \"\"DerivedProperty\"\": \"\"derived\"\",\n  \"\"BaseProperty\"\": \"\"base\"\"\n}\";\n\n            var d = JsonConvert.DeserializeObject<DerivedWithPrivate>(json);\n\n            Assert.AreEqual(\"base\", d.BaseProperty);\n            Assert.AreEqual(\"derived\", d.DerivedProperty);\n        }\n\n#if !(NET20 || NET35 || PORTABLE || PORTABLE40) || NETSTANDARD1_3 || NETSTANDARD2_0\n        [Test]\n        public void DeserializeNullableUnsignedLong()\n        {\n            NullableLongTestClass instance = new NullableLongTestClass\n            {\n                Value = ulong.MaxValue\n            };\n            string output = JsonConvert.SerializeObject(instance);\n            NullableLongTestClass result = JsonConvert.DeserializeObject<NullableLongTestClass>(output);\n\n            Assert.AreEqual(ulong.MaxValue, result.Value);\n        }\n#endif\n\n#if !(DNXCORE50) || NETSTANDARD2_0\n        [Test]\n        public void MailMessageConverterTest()\n        {\n            const string JsonMessage = @\"{\n  \"\"From\"\": {\n    \"\"Address\"\": \"\"askywalker@theEmpire.gov\"\",\n    \"\"DisplayName\"\": \"\"Darth Vader\"\"\n  },\n  \"\"Sender\"\": null,\n  \"\"ReplyTo\"\": null,\n  \"\"ReplyToList\"\": [],\n  \"\"To\"\": [\n    {\n      \"\"Address\"\": \"\"lskywalker@theRebellion.org\"\",\n      \"\"DisplayName\"\": \"\"Luke Skywalker\"\"\n    }\n  ],\n  \"\"Bcc\"\": [],\n  \"\"CC\"\": [\n    {\n      \"\"Address\"\": \"\"lorgana@alderaan.gov\"\",\n      \"\"DisplayName\"\": \"\"Princess Leia\"\"\n    }\n  ],\n  \"\"Priority\"\": 0,\n  \"\"DeliveryNotificationOptions\"\": 0,\n  \"\"Subject\"\": \"\"Family tree\"\",\n  \"\"SubjectEncoding\"\": null,\n  \"\"Headers\"\": [],\n  \"\"HeadersEncoding\"\": null,\n  \"\"Body\"\": \"\"<strong>I am your father!</strong>\"\",\n  \"\"BodyEncoding\"\": \"\"US-ASCII\"\",\n  \"\"BodyTransferEncoding\"\": -1,\n  \"\"IsBodyHtml\"\": true,\n  \"\"Attachments\"\": [\n    {\n      \"\"FileName\"\": \"\"skywalker family tree.jpg\"\",\n      \"\"ContentBase64\"\": \"\"AQIDBAU=\"\"\n    }\n  ],\n  \"\"AlternateViews\"\": []\n}\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() =>\n                {\n                    JsonConvert.DeserializeObject<System.Net.Mail.MailMessage>(\n                        JsonMessage,\n                        new MailAddressReadConverter(),\n                        new AttachmentReadConverter(),\n                        new EncodingReadConverter());\n                },\n                \"Cannot populate list type System.Net.Mime.HeaderCollection. Path 'Headers', line 26, position 14.\");\n        }\n#endif\n\n        [Test]\n        public void ParametrizedConstructor_IncompleteJson()\n        {\n            string s = @\"{\"\"text\"\":\"\"s\"\",\"\"cursorPosition\"\":189,\"\"dataSource\"\":\"\"json_northwind\"\",\";\n\n            ExceptionAssert.Throws<JsonSerializationException>(() => JsonConvert.DeserializeObject<CompletionDataRequest>(s), \"Unexpected end when deserializing object. Path 'dataSource', line 1, position 63.\");\n        }\n\n        [Test]\n        public void ChildClassWithProtectedOverridePlusJsonProperty_Serialize()\n        {\n            JsonObjectContract c = (JsonObjectContract)DefaultContractResolver.Instance.ResolveContract(typeof(ChildClassWithProtectedOverridePlusJsonProperty));\n            Assert.AreEqual(1, c.Properties.Count);\n\n            var propertyValue = \"test\";\n            var testJson = @\"{ 'MyProperty' : '\" + propertyValue + \"' }\";\n\n            var testObject = JsonConvert.DeserializeObject<ChildClassWithProtectedOverridePlusJsonProperty>(testJson);\n\n            Assert.AreEqual(propertyValue, testObject.GetPropertyValue(), \"MyProperty should be populated\");\n        }\n\n        [Test]\n        public void JsonPropertyConverter()\n        {\n            DateTime dt = new DateTime(2000, 12, 20, 0, 0, 0, DateTimeKind.Utc);\n\n            JsonSerializerSettings settings = new JsonSerializerSettings\n            {\n                ContractResolver = new JsonPropertyConverterContractResolver(),\n                Formatting = Formatting.Indented\n            };\n\n            JsonPropertyConverterTestClass c1 = new JsonPropertyConverterTestClass\n            {\n                NormalDate = dt,\n                JavaScriptDate = dt\n            };\n\n            string json = JsonConvert.SerializeObject(c1, settings);\n\n            StringAssert.AreEqual(@\"{\n  \"\"NormalDate\"\": \"\"2000-12-20T00:00:00Z\"\",\n  \"\"JavaScriptDate\"\": new Date(\n    977270400000\n  )\n}\", json);\n\n            JsonPropertyConverterTestClass c2 = JsonConvert.DeserializeObject<JsonPropertyConverterTestClass>(json, settings);\n\n            Assert.AreEqual(dt, c2.NormalDate);\n            Assert.AreEqual(dt, c2.JavaScriptDate);\n        }\n\n        [Test]\n        public void StringEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: , B: 1, C: 123, D: 1.23, E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'A', line 1, position 6.\");\n        }\n\n        [Test]\n        public void NullableIntEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: , C: 123, D: 1.23, E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'B', line 1, position 13.\");\n        }\n\n        [Test]\n        public void NullableLongEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: , D: 1.23, E: 3.45, F: null }\"),\n                \"An undefined token is not a valid System.Nullable`1[System.Int64]. Path 'C', line 1, position 18.\");\n        }\n\n        [Test]\n        public void NullableDecimalEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: 123, D: , E: 3.45, F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'D', line 1, position 27.\");\n        }\n\n        [Test]\n        public void NullableDoubleEmptyValue()\n        {\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>(\"{ A: \\\"\\\", B: 1, C: 123, D: 1.23, E: , F: null }\"),\n                \"Unexpected character encountered while parsing value: ,. Path 'E', line 1, position 36.\");\n        }\n\n        [Test]\n        public void SetMaxDepth_DepthExceeded()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(\"[[['text']]]\"));\n            Assert.AreEqual(128, reader.MaxDepth);\n\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n            Assert.AreEqual(128, settings.MaxDepth);\n            Assert.AreEqual(false, settings._maxDepthSet);\n\n            // Default should be the same\n            Assert.AreEqual(reader.MaxDepth, settings.MaxDepth);\n\n            settings.MaxDepth = 2;\n            Assert.AreEqual(2, settings.MaxDepth);\n            Assert.AreEqual(true, settings._maxDepthSet);\n\n            JsonSerializer serializer = JsonSerializer.Create(settings);\n            Assert.AreEqual(2, serializer.MaxDepth);\n\n            ExceptionAssert.Throws<JsonReaderException>(\n                () => serializer.Deserialize(reader),\n                \"The reader's MaxDepth of 2 has been exceeded. Path '[0][0]', line 1, position 3.\");\n        }\n\n        [Test]\n        public void SetMaxDepth_DepthNotExceeded()\n        {\n            JsonTextReader reader = new JsonTextReader(new StringReader(\"['text']\"));\n            JsonSerializerSettings settings = new JsonSerializerSettings();\n\n            settings.MaxDepth = 2;\n\n            JsonSerializer serializer = JsonSerializer.Create(settings);\n            Assert.AreEqual(2, serializer.MaxDepth);\n\n            serializer.Deserialize(reader);\n\n            Assert.AreEqual(128, reader.MaxDepth);\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Globalization;\n#if HAVE_BIG_INTEGER\nusing System.Numerics;\n#endif\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Utilities;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Represents a reader that provides fast, non-cached, forward-only access to serialized JSON data.\n    /// </summary>\n    public abstract partial class JsonReader : IDisposable\n    {\n        /// <summary>\n        /// Specifies the state of the reader.\n        /// </summary>\n        protected internal enum State\n        {\n            /// <summary>\n            /// A <see cref=\"JsonReader\"/> read method has not been called.\n            /// </summary>\n            Start,\n\n            /// <summary>\n            /// The end of the file has been reached successfully.\n            /// </summary>\n            Complete,\n\n            /// <summary>\n            /// Reader is at a property.\n            /// </summary>\n            Property,\n\n            /// <summary>\n            /// Reader is at the start of an object.\n            /// </summary>\n            ObjectStart,\n\n            /// <summary>\n            /// Reader is in an object.\n            /// </summary>\n            Object,\n\n            /// <summary>\n            /// Reader is at the start of an array.\n            /// </summary>\n            ArrayStart,\n\n            /// <summary>\n            /// Reader is in an array.\n            /// </summary>\n            Array,\n\n            /// <summary>\n            /// The <see cref=\"JsonReader.Close()\"/> method has been called.\n            /// </summary>\n            Closed,\n\n            /// <summary>\n            /// Reader has just read a value.\n            /// </summary>\n            PostValue,\n\n            /// <summary>\n            /// Reader is at the start of a constructor.\n            /// </summary>\n            ConstructorStart,\n\n            /// <summary>\n            /// Reader is in a constructor.\n            /// </summary>\n            Constructor,\n\n            /// <summary>\n            /// An error occurred that prevents the read operation from continuing.\n            /// </summary>\n            Error,\n\n            /// <summary>\n            /// The end of the file has been reached successfully.\n            /// </summary>\n            Finished\n        }\n\n        // current Token data\n        private JsonToken _tokenType;\n        private object? _value;\n        internal char _quoteChar;\n        internal State _currentState;\n        private JsonPosition _currentPosition;\n        private CultureInfo? _culture;\n        private DateTimeZoneHandling _dateTimeZoneHandling;\n        private int? _maxDepth;\n        private bool _hasExceededMaxDepth;\n        internal DateParseHandling _dateParseHandling;\n        internal FloatParseHandling _floatParseHandling;\n        private string? _dateFormatString;\n        private List<JsonPosition>? _stack;\n\n        /// <summary>\n        /// Gets the current reader state.\n        /// </summary>\n        /// <value>The current reader state.</value>\n        protected State CurrentState => _currentState;\n\n        /// <summary>\n        /// Gets or sets a value indicating whether the source should be closed when this reader is closed.\n        /// </summary>\n        /// <value>\n        /// <c>true</c> to close the source when this reader is closed; otherwise <c>false</c>. The default is <c>true</c>.\n        /// </value>\n        public bool CloseInput { get; set; }\n\n        /// <summary>\n        /// Gets or sets a value indicating whether multiple pieces of JSON content can\n        /// be read from a continuous stream without erroring.\n        /// </summary>\n        /// <value>\n        /// <c>true</c> to support reading multiple pieces of JSON content; otherwise <c>false</c>.\n        /// The default is <c>false</c>.\n        /// </value>\n        public bool SupportMultipleContent { get; set; }\n\n        /// <summary>\n        /// Gets the quotation mark character used to enclose the value of a string.\n        /// </summary>\n        public virtual char QuoteChar\n        {\n            get => _quoteChar;\n            protected internal set => _quoteChar = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled when reading JSON.\n        /// </summary>\n        public DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling;\n            set\n            {\n                if (value < DateTimeZoneHandling.Local || value > DateTimeZoneHandling.RoundtripKind)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _dateTimeZoneHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. \"\\/Date(1198908717056)\\/\" and \"2012-03-21T05:40Z\", are parsed when reading JSON.\n        /// </summary>\n        public DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling;\n            set\n            {\n                if (value < DateParseHandling.None ||\n#if HAVE_DATE_TIME_OFFSET\n                    value > DateParseHandling.DateTimeOffset\n#else\n                    value > DateParseHandling.DateTime\n#endif\n                    )\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _dateParseHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// </summary>\n        public FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling;\n            set\n            {\n                if (value < FloatParseHandling.Double || value > FloatParseHandling.Decimal)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _floatParseHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how custom date formatted strings are parsed when reading JSON.\n        /// </summary>\n        public string? DateFormatString\n        {\n            get => _dateFormatString;\n            set => _dateFormatString = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// A null value means there is no maximum. \n        /// The default value is <c>128</c>.\n        /// </summary>\n        public int? MaxDepth\n        {\n            get => _maxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets the type of the current JSON token. \n        /// </summary>\n        public virtual JsonToken TokenType => _tokenType;\n\n        /// <summary>\n        /// Gets the text value of the current JSON token.\n        /// </summary>\n        public virtual object? Value => _value;\n\n        /// <summary>\n        /// Gets the .NET type for the current JSON token.\n        /// </summary>\n        public virtual Type? ValueType => _value?.GetType();\n\n        /// <summary>\n        /// Gets the depth of the current token in the JSON document.\n        /// </summary>\n        /// <value>The depth of the current token in the JSON document.</value>\n        public virtual int Depth\n        {\n            get\n            {\n                int depth = _stack?.Count ?? 0;\n                if (JsonTokenUtils.IsStartToken(TokenType) || _currentPosition.Type == JsonContainerType.None)\n                {\n                    return depth;\n                }\n                else\n                {\n                    return depth + 1;\n                }\n            }\n        }\n\n        /// <summary>\n        /// Gets the path of the current JSON token. \n        /// </summary>\n        public virtual string Path\n        {\n            get\n            {\n                if (_currentPosition.Type == JsonContainerType.None)\n                {\n                    return string.Empty;\n                }\n\n                bool insideContainer = (_currentState != State.ArrayStart\n                                        && _currentState != State.ConstructorStart\n                                        && _currentState != State.ObjectStart);\n\n                JsonPosition? current = insideContainer ? (JsonPosition?)_currentPosition : null;\n\n                return JsonPosition.BuildPath(_stack!, current);\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON. Defaults to <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public CultureInfo Culture\n        {\n            get => _culture ?? CultureInfo.InvariantCulture;\n            set => _culture = value;\n        }\n\n        internal JsonPosition GetPosition(int depth)\n        {\n            if (_stack != null && depth < _stack.Count)\n            {\n                return _stack[depth];\n            }\n\n            return _currentPosition;\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonReader\"/> class.\n        /// </summary>\n        protected JsonReader()\n        {\n            _currentState = State.Start;\n            _dateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind;\n            _dateParseHandling = DateParseHandling.DateTime;\n            _floatParseHandling = FloatParseHandling.Double;\n            _maxDepth = 128;\n\n            CloseInput = true;\n        }\n\n        private void Push(JsonContainerType value)\n        {\n            UpdateScopeWithFinishedValue();\n\n            if (_currentPosition.Type == JsonContainerType.None)\n            {\n                _currentPosition = new JsonPosition(value);\n            }\n            else\n            {\n                if (_stack == null)\n                {\n                    _stack = new List<JsonPosition>();\n                }\n\n                _stack.Add(_currentPosition);\n                _currentPosition = new JsonPosition(value);\n\n                // this is a little hacky because Depth increases when first property/value is written but only testing here is faster/simpler\n                if (_maxDepth != null && Depth + 1 > _maxDepth && !_hasExceededMaxDepth)\n                {\n                    _hasExceededMaxDepth = true;\n                    throw JsonReaderException.Create(this, \"The reader's MaxDepth of {0} has been exceeded.\".FormatWith(CultureInfo.InvariantCulture, _maxDepth));\n                }\n            }\n        }\n\n        private JsonContainerType Pop()\n        {\n            JsonPosition oldPosition;\n            if (_stack != null && _stack.Count > 0)\n            {\n                oldPosition = _currentPosition;\n                _currentPosition = _stack[_stack.Count - 1];\n                _stack.RemoveAt(_stack.Count - 1);\n            }\n            else\n            {\n                oldPosition = _currentPosition;\n                _currentPosition = new JsonPosition();\n            }\n\n            if (_maxDepth != null && Depth <= _maxDepth)\n            {\n                _hasExceededMaxDepth = false;\n            }\n\n            return oldPosition.Type;\n        }\n\n        private JsonContainerType Peek()\n        {\n            return _currentPosition.Type;\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source.\n        /// </summary>\n        /// <returns><c>true</c> if the next token was read successfully; <c>false</c> if there are no more tokens to read.</returns>\n        public abstract bool Read();\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Int32\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Int32\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual int? ReadAsInt32()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    if (v is int i)\n                    {\n                        return i;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        i = (int)value;\n                    }\n                    else\n#endif\n                    {\n                        try\n                        {\n                            i = Convert.ToInt32(v, CultureInfo.InvariantCulture);\n                        }\n                        catch (Exception ex)\n                        {\n                            // handle error for large integer overflow exceptions\n                            throw JsonReaderException.Create(this, \"Could not convert to integer: {0}.\".FormatWith(CultureInfo.InvariantCulture, v), ex);\n                        }\n                    }\n\n                    SetToken(JsonToken.Integer, i, false);\n                    return i;\n                case JsonToken.String:\n                    string? s = (string?)Value;\n                    return ReadInt32String(s);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading integer. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal int? ReadInt32String(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (int.TryParse(s, NumberStyles.Integer, Culture, out int i))\n            {\n                SetToken(JsonToken.Integer, i, false);\n                return i;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to integer: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"String\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"String\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual string? ReadAsString()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.String:\n                    return (string?)Value;\n            }\n\n            if (JsonTokenUtils.IsPrimitiveToken(t))\n            {\n                object? v = Value;\n                if (v != null)\n                {\n                    string s;\n                    if (v is IFormattable formattable)\n                    {\n                        s = formattable.ToString(null, Culture);\n                    }\n                    else\n                    {\n                        s = v is Uri uri ? uri.OriginalString : v.ToString();\n                    }\n\n                    SetToken(JsonToken.String, s, false);\n                    return s;\n                }\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading string. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Byte\"/>[].\n        /// </summary>\n        /// <returns>A <see cref=\"Byte\"/>[] or <c>null</c> if the next JSON token is null. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual byte[]? ReadAsBytes()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.StartObject:\n                {\n                    ReadIntoWrappedTypeObject();\n\n                    byte[]? data = ReadAsBytes();\n                    ReaderReadAndAssert();\n\n                    if (TokenType != JsonToken.EndObject)\n                    {\n                        throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n                    }\n\n                    SetToken(JsonToken.Bytes, data, false);\n                    return data;\n                }\n                case JsonToken.String:\n                {\n                    // attempt to convert possible base 64 or GUID string to bytes\n                    // GUID has to have format 00000000-0000-0000-0000-000000000000\n                    string s = (string)Value!;\n\n                    byte[] data;\n\n                    if (s.Length == 0)\n                    {\n                        data = CollectionUtils.ArrayEmpty<byte>();\n                    }\n                    else if (ConvertUtils.TryConvertGuid(s, out Guid g1))\n                    {\n                        data = g1.ToByteArray();\n                    }\n                    else\n                    {\n                        data = Convert.FromBase64String(s);\n                    }\n\n                    SetToken(JsonToken.Bytes, data, false);\n                    return data;\n                }\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Bytes:\n                    if (Value is Guid g2)\n                    {\n                        byte[] data = g2.ToByteArray();\n                        SetToken(JsonToken.Bytes, data, false);\n                        return data;\n                    }\n\n                    return (byte[]?)Value;\n                case JsonToken.StartArray:\n                    return ReadArrayIntoByteArray();\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal byte[] ReadArrayIntoByteArray()\n        {\n            List<byte> buffer = new List<byte>();\n\n            while (true)\n            {\n                if (!Read())\n                {\n                    SetToken(JsonToken.None);\n                }\n\n                if (ReadArrayElementIntoByteArrayReportDone(buffer))\n                {\n                    byte[] d = buffer.ToArray();\n                    SetToken(JsonToken.Bytes, d, false);\n                    return d;\n                }\n            }\n        }\n\n        private bool ReadArrayElementIntoByteArrayReportDone(List<byte> buffer)\n        {\n            switch (TokenType)\n            {\n                case JsonToken.None:\n                    throw JsonReaderException.Create(this, \"Unexpected end when reading bytes.\");\n                case JsonToken.Integer:\n                    buffer.Add(Convert.ToByte(Value, CultureInfo.InvariantCulture));\n                    return false;\n                case JsonToken.EndArray:\n                    return true;\n                case JsonToken.Comment:\n                    return false;\n                default:\n                    throw JsonReaderException.Create(this, \"Unexpected token when reading bytes: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Double\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Double\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual double? ReadAsDouble()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    if (v is double d)\n                    {\n                        return d;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        d = (double)value;\n                    }\n                    else\n#endif\n                    {\n                        d = Convert.ToDouble(v, CultureInfo.InvariantCulture);\n                    }\n\n                    SetToken(JsonToken.Float, d, false);\n\n                    return (double)d;\n                case JsonToken.String:\n                    return ReadDoubleString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading double. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal double? ReadDoubleString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (double.TryParse(s, NumberStyles.Float | NumberStyles.AllowThousands, Culture, out double d))\n            {\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to double: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Boolean\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Boolean\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual bool? ReadAsBoolean()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    bool b;\n#if HAVE_BIG_INTEGER\n                    if (Value is BigInteger integer)\n                    {\n                        b = integer != 0;\n                    }\n                    else\n#endif\n                    {\n                        b = Convert.ToBoolean(Value, CultureInfo.InvariantCulture);\n                    }\n\n                    SetToken(JsonToken.Boolean, b, false);\n                    return b;\n                case JsonToken.String:\n                    return ReadBooleanString((string?)Value);\n                case JsonToken.Boolean:\n                    return (bool)Value!;\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading boolean. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal bool? ReadBooleanString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (bool.TryParse(s, out bool b))\n            {\n                SetToken(JsonToken.Boolean, b, false);\n                return b;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to boolean: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"Decimal\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"Decimal\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual decimal? ReadAsDecimal()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                    object v = Value!;\n                    \n                    if (v is decimal d)\n                    {\n                        return d;\n                    }\n\n#if HAVE_BIG_INTEGER\n                    if (v is BigInteger value)\n                    {\n                        d = (decimal)value;\n                    }\n                    else\n#endif\n                    {\n                        try\n                        {\n                            d = Convert.ToDecimal(v, CultureInfo.InvariantCulture);\n                        }\n                        catch (Exception ex)\n                        {\n                            // handle error for large integer overflow exceptions\n                            throw JsonReaderException.Create(this, \"Could not convert to decimal: {0}.\".FormatWith(CultureInfo.InvariantCulture, v), ex);\n                        }\n                    }\n\n                    SetToken(JsonToken.Float, d, false);\n                    return d;\n                case JsonToken.String:\n                    return ReadDecimalString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading decimal. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n        }\n\n        internal decimal? ReadDecimalString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (decimal.TryParse(s, NumberStyles.Number, Culture, out decimal d))\n            {\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else if (ConvertUtils.DecimalTryParse(s.ToCharArray(), 0, s.Length, out d) == ParseResult.Success)\n            {\n                // This is to handle strings like \"96.014e-05\" that are not supported by traditional decimal.TryParse\n                SetToken(JsonToken.Float, d, false);\n                return d;\n            }\n            else\n            {\n                SetToken(JsonToken.String, s, false);\n                throw JsonReaderException.Create(this, \"Could not convert string to decimal: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n            }\n        }\n\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"DateTime\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"DateTime\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual DateTime? ReadAsDateTime()\n        {\n            switch (GetContentToken())\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Date:\n#if HAVE_DATE_TIME_OFFSET\n                    if (Value is DateTimeOffset offset)\n                    {\n                        SetToken(JsonToken.Date, offset.DateTime, false);\n                    }\n#endif\n\n                    return (DateTime)Value!;\n                case JsonToken.String:\n                    return ReadDateTimeString((string?)Value);\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading date. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, TokenType));\n        }\n\n        internal DateTime? ReadDateTimeString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (DateTimeUtils.TryParseDateTime(s, DateTimeZoneHandling, _dateFormatString, Culture, out DateTime dt))\n            {\n                dt = DateTimeUtils.EnsureDateTime(dt, DateTimeZoneHandling);\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            if (DateTime.TryParse(s, Culture, DateTimeStyles.RoundtripKind, out dt))\n            {\n                dt = DateTimeUtils.EnsureDateTime(dt, DateTimeZoneHandling);\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            throw JsonReaderException.Create(this, \"Could not convert string to DateTime: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n        }\n\n#if HAVE_DATE_TIME_OFFSET\n        /// <summary>\n        /// Reads the next JSON token from the source as a <see cref=\"Nullable{T}\"/> of <see cref=\"DateTimeOffset\"/>.\n        /// </summary>\n        /// <returns>A <see cref=\"Nullable{T}\"/> of <see cref=\"DateTimeOffset\"/>. This method will return <c>null</c> at the end of an array.</returns>\n        public virtual DateTimeOffset? ReadAsDateTimeOffset()\n        {\n            JsonToken t = GetContentToken();\n\n            switch (t)\n            {\n                case JsonToken.None:\n                case JsonToken.Null:\n                case JsonToken.EndArray:\n                    return null;\n                case JsonToken.Date:\n                    if (Value is DateTime time)\n                    {\n                        SetToken(JsonToken.Date, new DateTimeOffset(time), false);\n                    }\n\n                    return (DateTimeOffset)Value!;\n                case JsonToken.String:\n                    string? s = (string?)Value;\n                    return ReadDateTimeOffsetString(s);\n                default:\n                    throw JsonReaderException.Create(this, \"Error reading date. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, t));\n            }\n        }\n\n        internal DateTimeOffset? ReadDateTimeOffsetString(string? s)\n        {\n            if (StringUtils.IsNullOrEmpty(s))\n            {\n                SetToken(JsonToken.Null, null, false);\n                return null;\n            }\n\n            if (DateTimeUtils.TryParseDateTimeOffset(s, _dateFormatString, Culture, out DateTimeOffset dt))\n            {\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            if (DateTimeOffset.TryParse(s, Culture, DateTimeStyles.RoundtripKind, out dt))\n            {\n                SetToken(JsonToken.Date, dt, false);\n                return dt;\n            }\n\n            SetToken(JsonToken.String, s, false);\n            throw JsonReaderException.Create(this, \"Could not convert string to DateTimeOffset: {0}.\".FormatWith(CultureInfo.InvariantCulture, s));\n        }\n#endif\n\n        internal void ReaderReadAndAssert()\n        {\n            if (!Read())\n            {\n                throw CreateUnexpectedEndException();\n            }\n        }\n\n        internal JsonReaderException CreateUnexpectedEndException()\n        {\n            return JsonReaderException.Create(this, \"Unexpected end when reading JSON.\");\n        }\n\n        internal void ReadIntoWrappedTypeObject()\n        {\n            ReaderReadAndAssert();\n            if (Value != null && Value.ToString() == JsonTypeReflector.TypePropertyName)\n            {\n                ReaderReadAndAssert();\n                if (Value != null && Value.ToString().StartsWith(\"System.Byte[]\", StringComparison.Ordinal))\n                {\n                    ReaderReadAndAssert();\n                    if (Value.ToString() == JsonTypeReflector.ValuePropertyName)\n                    {\n                        return;\n                    }\n                }\n            }\n\n            throw JsonReaderException.Create(this, \"Error reading bytes. Unexpected token: {0}.\".FormatWith(CultureInfo.InvariantCulture, JsonToken.StartObject));\n        }\n\n        /// <summary>\n        /// Skips the children of the current token.\n        /// </summary>\n        public void Skip()\n        {\n            if (TokenType == JsonToken.PropertyName)\n            {\n                Read();\n            }\n\n            if (JsonTokenUtils.IsStartToken(TokenType))\n            {\n                int depth = Depth;\n\n                while (Read() && (depth < Depth))\n                {\n                }\n            }\n        }\n\n        /// <summary>\n        /// Sets the current token.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        protected void SetToken(JsonToken newToken)\n        {\n            SetToken(newToken, null, true);\n        }\n\n        /// <summary>\n        /// Sets the current token and value.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        /// <param name=\"value\">The value.</param>\n        protected void SetToken(JsonToken newToken, object? value)\n        {\n            SetToken(newToken, value, true);\n        }\n\n        /// <summary>\n        /// Sets the current token and value.\n        /// </summary>\n        /// <param name=\"newToken\">The new token.</param>\n        /// <param name=\"value\">The value.</param>\n        /// <param name=\"updateIndex\">A flag indicating whether the position index inside an array should be updated.</param>\n        protected void SetToken(JsonToken newToken, object? value, bool updateIndex)\n        {\n            _tokenType = newToken;\n            _value = value;\n\n            switch (newToken)\n            {\n                case JsonToken.StartObject:\n                    _currentState = State.ObjectStart;\n                    Push(JsonContainerType.Object);\n                    break;\n                case JsonToken.StartArray:\n                    _currentState = State.ArrayStart;\n                    Push(JsonContainerType.Array);\n                    break;\n                case JsonToken.StartConstructor:\n                    _currentState = State.ConstructorStart;\n                    Push(JsonContainerType.Constructor);\n                    break;\n                case JsonToken.EndObject:\n                    ValidateEnd(JsonToken.EndObject);\n                    break;\n                case JsonToken.EndArray:\n                    ValidateEnd(JsonToken.EndArray);\n                    break;\n                case JsonToken.EndConstructor:\n                    ValidateEnd(JsonToken.EndConstructor);\n                    break;\n                case JsonToken.PropertyName:\n                    _currentState = State.Property;\n\n                    _currentPosition.PropertyName = (string)value!;\n                    break;\n                case JsonToken.Undefined:\n                case JsonToken.Integer:\n                case JsonToken.Float:\n                case JsonToken.Boolean:\n                case JsonToken.Null:\n                case JsonToken.Date:\n                case JsonToken.String:\n                case JsonToken.Raw:\n                case JsonToken.Bytes:\n                    SetPostValueState(updateIndex);\n                    break;\n            }\n        }\n\n        internal void SetPostValueState(bool updateIndex)\n        {\n            if (Peek() != JsonContainerType.None || SupportMultipleContent)\n            {\n                _currentState = State.PostValue;\n            }\n            else\n            {\n                SetFinished();\n            }\n\n            if (updateIndex)\n            {\n                UpdateScopeWithFinishedValue();\n            }\n        }\n\n        private void UpdateScopeWithFinishedValue()\n        {\n            if (_currentPosition.HasIndex)\n            {\n                _currentPosition.Position++;\n            }\n        }\n\n        private void ValidateEnd(JsonToken endToken)\n        {\n            JsonContainerType currentObject = Pop();\n\n            if (GetTypeForCloseToken(endToken) != currentObject)\n            {\n                throw JsonReaderException.Create(this, \"JsonToken {0} is not valid for closing JsonType {1}.\".FormatWith(CultureInfo.InvariantCulture, endToken, currentObject));\n            }\n\n            if (Peek() != JsonContainerType.None || SupportMultipleContent)\n            {\n                _currentState = State.PostValue;\n            }\n            else\n            {\n                SetFinished();\n            }\n        }\n\n        /// <summary>\n        /// Sets the state based on current token type.\n        /// </summary>\n        protected void SetStateBasedOnCurrent()\n        {\n            JsonContainerType currentObject = Peek();\n\n            switch (currentObject)\n            {\n                case JsonContainerType.Object:\n                    _currentState = State.Object;\n                    break;\n                case JsonContainerType.Array:\n                    _currentState = State.Array;\n                    break;\n                case JsonContainerType.Constructor:\n                    _currentState = State.Constructor;\n                    break;\n                case JsonContainerType.None:\n                    SetFinished();\n                    break;\n                default:\n                    throw JsonReaderException.Create(this, \"While setting the reader state back to current object an unexpected JsonType was encountered: {0}\".FormatWith(CultureInfo.InvariantCulture, currentObject));\n            }\n        }\n\n        private void SetFinished()\n        {\n            _currentState = SupportMultipleContent ? State.Start : State.Finished;\n        }\n\n        private JsonContainerType GetTypeForCloseToken(JsonToken token)\n        {\n            switch (token)\n            {\n                case JsonToken.EndObject:\n                    return JsonContainerType.Object;\n                case JsonToken.EndArray:\n                    return JsonContainerType.Array;\n                case JsonToken.EndConstructor:\n                    return JsonContainerType.Constructor;\n                default:\n                    throw JsonReaderException.Create(this, \"Not a valid close JsonToken: {0}\".FormatWith(CultureInfo.InvariantCulture, token));\n            }\n        }\n\n        void IDisposable.Dispose()\n        {\n            Dispose(true);\n            GC.SuppressFinalize(this);\n        }\n\n        /// <summary>\n        /// Releases unmanaged and - optionally - managed resources.\n        /// </summary>\n        /// <param name=\"disposing\"><c>true</c> to release both managed and unmanaged resources; <c>false</c> to release only unmanaged resources.</param>\n        protected virtual void Dispose(bool disposing)\n        {\n            if (_currentState != State.Closed && disposing)\n            {\n                Close();\n            }\n        }\n\n        /// <summary>\n        /// Changes the reader's state to <see cref=\"JsonReader.State.Closed\"/>.\n        /// If <see cref=\"JsonReader.CloseInput\"/> is set to <c>true</c>, the source is also closed.\n        /// </summary>\n        public virtual void Close()\n        {\n            _currentState = State.Closed;\n            _tokenType = JsonToken.None;\n            _value = null;\n        }\n\n        internal void ReadAndAssert()\n        {\n            if (!Read())\n            {\n                throw JsonSerializationException.Create(this, \"Unexpected end when reading JSON.\");\n            }\n        }\n\n        internal void ReadForTypeAndAssert(JsonContract? contract, bool hasConverter)\n        {\n            if (!ReadForType(contract, hasConverter))\n            {\n                throw JsonSerializationException.Create(this, \"Unexpected end when reading JSON.\");\n            }\n        }\n\n        internal bool ReadForType(JsonContract? contract, bool hasConverter)\n        {\n            // don't read properties with converters as a specific value\n            // the value might be a string which will then get converted which will error if read as date for example\n            if (hasConverter)\n            {\n                return Read();\n            }\n\n            ReadType t = contract?.InternalReadType ?? ReadType.Read;\n\n            switch (t)\n            {\n                case ReadType.Read:\n                    return ReadAndMoveToContent();\n                case ReadType.ReadAsInt32:\n                    ReadAsInt32();\n                    break;\n                case ReadType.ReadAsInt64:\n                    bool result = ReadAndMoveToContent();\n                    if (TokenType == JsonToken.Undefined)\n                    {\n                        throw JsonReaderException.Create(this, \"An undefined token is not a valid {0}.\".FormatWith(CultureInfo.InvariantCulture, contract?.UnderlyingType ?? typeof(long)));\n                    }\n                    return result;\n                case ReadType.ReadAsDecimal:\n                    ReadAsDecimal();\n                    break;\n                case ReadType.ReadAsDouble:\n                    ReadAsDouble();\n                    break;\n                case ReadType.ReadAsBytes:\n                    ReadAsBytes();\n                    break;\n                case ReadType.ReadAsBoolean:\n                    ReadAsBoolean();\n                    break;\n                case ReadType.ReadAsString:\n                    ReadAsString();\n                    break;\n                case ReadType.ReadAsDateTime:\n                    ReadAsDateTime();\n                    break;\n#if HAVE_DATE_TIME_OFFSET\n                case ReadType.ReadAsDateTimeOffset:\n                    ReadAsDateTimeOffset();\n                    break;\n#endif\n                default:\n                    throw new ArgumentOutOfRangeException();\n            }\n\n            return (TokenType != JsonToken.None);\n        }\n\n        internal bool ReadAndMoveToContent()\n        {\n            return Read() && MoveToContent();\n        }\n\n        internal bool MoveToContent()\n        {\n            JsonToken t = TokenType;\n            while (t == JsonToken.None || t == JsonToken.Comment)\n            {\n                if (!Read())\n                {\n                    return false;\n                }\n\n                t = TokenType;\n            }\n\n            return true;\n        }\n\n        private JsonToken GetContentToken()\n        {\n            JsonToken t;\n            do\n            {\n                if (!Read())\n                {\n                    SetToken(JsonToken.None);\n                    return JsonToken.None;\n                }\n                else\n                {\n                    t = TokenType;\n                }\n            } while (t == JsonToken.Comment);\n\n            return t;\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections;\nusing System.Collections.Generic;\nusing System.Diagnostics;\nusing System.Globalization;\nusing System.IO;\nusing System.Runtime.Serialization.Formatters;\nusing Newtonsoft.Json.Converters;\nusing Newtonsoft.Json.Serialization;\nusing Newtonsoft.Json.Utilities;\nusing System.Runtime.Serialization;\nusing ErrorEventArgs = Newtonsoft.Json.Serialization.ErrorEventArgs;\nusing System.Runtime.CompilerServices;\nusing System.Diagnostics.CodeAnalysis;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Serializes and deserializes objects into and from the JSON format.\n    /// The <see cref=\"JsonSerializer\"/> enables you to control how objects are encoded into JSON.\n    /// </summary>\n    public class JsonSerializer\n    {\n        internal TypeNameHandling _typeNameHandling;\n        internal TypeNameAssemblyFormatHandling _typeNameAssemblyFormatHandling;\n        internal PreserveReferencesHandling _preserveReferencesHandling;\n        internal ReferenceLoopHandling _referenceLoopHandling;\n        internal MissingMemberHandling _missingMemberHandling;\n        internal ObjectCreationHandling _objectCreationHandling;\n        internal NullValueHandling _nullValueHandling;\n        internal DefaultValueHandling _defaultValueHandling;\n        internal ConstructorHandling _constructorHandling;\n        internal MetadataPropertyHandling _metadataPropertyHandling;\n        internal JsonConverterCollection? _converters;\n        internal IContractResolver _contractResolver;\n        internal ITraceWriter? _traceWriter;\n        internal IEqualityComparer? _equalityComparer;\n        internal ISerializationBinder _serializationBinder;\n        internal StreamingContext _context;\n        private IReferenceResolver? _referenceResolver;\n\n        private Formatting? _formatting;\n        private DateFormatHandling? _dateFormatHandling;\n        private DateTimeZoneHandling? _dateTimeZoneHandling;\n        private DateParseHandling? _dateParseHandling;\n        private FloatFormatHandling? _floatFormatHandling;\n        private FloatParseHandling? _floatParseHandling;\n        private StringEscapeHandling? _stringEscapeHandling;\n        private CultureInfo _culture;\n        private int? _maxDepth;\n        private bool _maxDepthSet;\n        private bool? _checkAdditionalContent;\n        private string? _dateFormatString;\n        private bool _dateFormatStringSet;\n\n        /// <summary>\n        /// Occurs when the <see cref=\"JsonSerializer\"/> errors during serialization and deserialization.\n        /// </summary>\n        public virtual event EventHandler<ErrorEventArgs>? Error;\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        public virtual IReferenceResolver? ReferenceResolver\n        {\n            get => GetReferenceResolver();\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Reference resolver cannot be null.\");\n                }\n\n                _referenceResolver = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"SerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        [Obsolete(\"Binder is obsolete. Use SerializationBinder instead.\")]\n        public virtual SerializationBinder Binder\n        {\n            get\n            {\n                if (_serializationBinder is SerializationBinder legacySerializationBinder)\n                {\n                    return legacySerializationBinder;\n                }\n\n                if (_serializationBinder is SerializationBinderAdapter adapter)\n                {\n                    return adapter.SerializationBinder;\n                }\n\n                throw new InvalidOperationException(\"Cannot get SerializationBinder because an ISerializationBinder was previously set.\");\n            }\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Serialization binder cannot be null.\");\n                }\n\n                _serializationBinder = value as ISerializationBinder ?? new SerializationBinderAdapter(value);\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ISerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        public virtual ISerializationBinder SerializationBinder\n        {\n            get => _serializationBinder;\n            set\n            {\n                if (value == null)\n                {\n                    throw new ArgumentNullException(nameof(value), \"Serialization binder cannot be null.\");\n                }\n\n                _serializationBinder = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ITraceWriter\"/> used by the serializer when writing trace messages.\n        /// </summary>\n        /// <value>The trace writer.</value>\n        public virtual ITraceWriter? TraceWriter\n        {\n            get => _traceWriter;\n            set => _traceWriter = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the equality comparer used by the serializer when comparing references.\n        /// </summary>\n        /// <value>The equality comparer.</value>\n        public virtual IEqualityComparer? EqualityComparer\n        {\n            get => _equalityComparer;\n            set => _equalityComparer = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how type name writing and reading is handled by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameHandling.None\" />.\n        /// </summary>\n        /// <remarks>\n        /// <see cref=\"JsonSerializer.TypeNameHandling\"/> should be used with caution when your application deserializes JSON from an external source.\n        /// Incoming types should be validated with a custom <see cref=\"JsonSerializer.SerializationBinder\"/>\n        /// when deserializing with a value other than <see cref=\"TypeNameHandling.None\"/>.\n        /// </remarks>\n        public virtual TypeNameHandling TypeNameHandling\n        {\n            get => _typeNameHandling;\n            set\n            {\n                if (value < TypeNameHandling.None || value > TypeNameHandling.Auto)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"FormatterAssemblyStyle.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        [Obsolete(\"TypeNameAssemblyFormat is obsolete. Use TypeNameAssemblyFormatHandling instead.\")]\n        public virtual FormatterAssemblyStyle TypeNameAssemblyFormat\n        {\n            get => (FormatterAssemblyStyle)_typeNameAssemblyFormatHandling;\n            set\n            {\n                if (value < FormatterAssemblyStyle.Simple || value > FormatterAssemblyStyle.Full)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameAssemblyFormatHandling = (TypeNameAssemblyFormatHandling)value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameAssemblyFormatHandling.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        public virtual TypeNameAssemblyFormatHandling TypeNameAssemblyFormatHandling\n        {\n            get => _typeNameAssemblyFormatHandling;\n            set\n            {\n                if (value < TypeNameAssemblyFormatHandling.Simple || value > TypeNameAssemblyFormatHandling.Full)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _typeNameAssemblyFormatHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how object references are preserved by the serializer.\n        /// The default value is <see cref=\"Json.PreserveReferencesHandling.None\" />.\n        /// </summary>\n        public virtual PreserveReferencesHandling PreserveReferencesHandling\n        {\n            get => _preserveReferencesHandling;\n            set\n            {\n                if (value < PreserveReferencesHandling.None || value > PreserveReferencesHandling.All)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _preserveReferencesHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how reference loops (e.g. a class referencing itself) is handled.\n        /// The default value is <see cref=\"Json.ReferenceLoopHandling.Error\" />.\n        /// </summary>\n        public virtual ReferenceLoopHandling ReferenceLoopHandling\n        {\n            get => _referenceLoopHandling;\n            set\n            {\n                if (value < ReferenceLoopHandling.Error || value > ReferenceLoopHandling.Serialize)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _referenceLoopHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how missing members (e.g. JSON contains a property that isn't a member on the object) are handled during deserialization.\n        /// The default value is <see cref=\"Json.MissingMemberHandling.Ignore\" />.\n        /// </summary>\n        public virtual MissingMemberHandling MissingMemberHandling\n        {\n            get => _missingMemberHandling;\n            set\n            {\n                if (value < MissingMemberHandling.Ignore || value > MissingMemberHandling.Error)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _missingMemberHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how null values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.NullValueHandling.Include\" />.\n        /// </summary>\n        public virtual NullValueHandling NullValueHandling\n        {\n            get => _nullValueHandling;\n            set\n            {\n                if (value < NullValueHandling.Include || value > NullValueHandling.Ignore)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _nullValueHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how default values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DefaultValueHandling.Include\" />.\n        /// </summary>\n        public virtual DefaultValueHandling DefaultValueHandling\n        {\n            get => _defaultValueHandling;\n            set\n            {\n                if (value < DefaultValueHandling.Include || value > DefaultValueHandling.IgnoreAndPopulate)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _defaultValueHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how objects are created during deserialization.\n        /// The default value is <see cref=\"Json.ObjectCreationHandling.Auto\" />.\n        /// </summary>\n        /// <value>The object creation handling.</value>\n        public virtual ObjectCreationHandling ObjectCreationHandling\n        {\n            get => _objectCreationHandling;\n            set\n            {\n                if (value < ObjectCreationHandling.Auto || value > ObjectCreationHandling.Replace)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _objectCreationHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how constructors are used during deserialization.\n        /// The default value is <see cref=\"Json.ConstructorHandling.Default\" />.\n        /// </summary>\n        /// <value>The constructor handling.</value>\n        public virtual ConstructorHandling ConstructorHandling\n        {\n            get => _constructorHandling;\n            set\n            {\n                if (value < ConstructorHandling.Default || value > ConstructorHandling.AllowNonPublicDefaultConstructor)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _constructorHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets how metadata properties are used during deserialization.\n        /// The default value is <see cref=\"Json.MetadataPropertyHandling.Default\" />.\n        /// </summary>\n        /// <value>The metadata properties handling.</value>\n        public virtual MetadataPropertyHandling MetadataPropertyHandling\n        {\n            get => _metadataPropertyHandling;\n            set\n            {\n                if (value < MetadataPropertyHandling.Default || value > MetadataPropertyHandling.Ignore)\n                {\n                    throw new ArgumentOutOfRangeException(nameof(value));\n                }\n\n                _metadataPropertyHandling = value;\n            }\n        }\n\n        /// <summary>\n        /// Gets a collection <see cref=\"JsonConverter\"/> that will be used during serialization.\n        /// </summary>\n        /// <value>Collection <see cref=\"JsonConverter\"/> that will be used during serialization.</value>\n        public virtual JsonConverterCollection Converters\n        {\n            get\n            {\n                if (_converters == null)\n                {\n                    _converters = new JsonConverterCollection();\n                }\n\n                return _converters;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the contract resolver used by the serializer when\n        /// serializing .NET objects to JSON and vice versa.\n        /// </summary>\n        public virtual IContractResolver ContractResolver\n        {\n            get => _contractResolver;\n            set => _contractResolver = value ?? DefaultContractResolver.Instance;\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"StreamingContext\"/> used by the serializer when invoking serialization callback methods.\n        /// </summary>\n        /// <value>The context.</value>\n        public virtual StreamingContext Context\n        {\n            get => _context;\n            set => _context = value;\n        }\n\n        /// <summary>\n        /// Indicates how JSON text output is formatted.\n        /// The default value is <see cref=\"Json.Formatting.None\" />.\n        /// </summary>\n        public virtual Formatting Formatting\n        {\n            get => _formatting ?? JsonSerializerSettings.DefaultFormatting;\n            set => _formatting = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how dates are written to JSON text.\n        /// The default value is <see cref=\"Json.DateFormatHandling.IsoDateFormat\" />.\n        /// </summary>\n        public virtual DateFormatHandling DateFormatHandling\n        {\n            get => _dateFormatHandling ?? JsonSerializerSettings.DefaultDateFormatHandling;\n            set => _dateFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DateTimeZoneHandling.RoundtripKind\" />.\n        /// </summary>\n        public virtual DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling ?? JsonSerializerSettings.DefaultDateTimeZoneHandling;\n            set => _dateTimeZoneHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. <c>\"\\/Date(1198908717056)\\/\"</c> and <c>\"2012-03-21T05:40Z\"</c>, are parsed when reading JSON.\n        /// The default value is <see cref=\"Json.DateParseHandling.DateTime\" />.\n        /// </summary>\n        public virtual DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling ?? JsonSerializerSettings.DefaultDateParseHandling;\n            set => _dateParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// The default value is <see cref=\"Json.FloatParseHandling.Double\" />.\n        /// </summary>\n        public virtual FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling ?? JsonSerializerSettings.DefaultFloatParseHandling;\n            set => _floatParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how special floating point numbers, e.g. <see cref=\"Double.NaN\"/>,\n        /// <see cref=\"Double.PositiveInfinity\"/> and <see cref=\"Double.NegativeInfinity\"/>,\n        /// are written as JSON text.\n        /// The default value is <see cref=\"Json.FloatFormatHandling.String\" />.\n        /// </summary>\n        public virtual FloatFormatHandling FloatFormatHandling\n        {\n            get => _floatFormatHandling ?? JsonSerializerSettings.DefaultFloatFormatHandling;\n            set => _floatFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how strings are escaped when writing JSON text.\n        /// The default value is <see cref=\"Json.StringEscapeHandling.Default\" />.\n        /// </summary>\n        public virtual StringEscapeHandling StringEscapeHandling\n        {\n            get => _stringEscapeHandling ?? JsonSerializerSettings.DefaultStringEscapeHandling;\n            set => _stringEscapeHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> and <see cref=\"DateTimeOffset\"/> values are formatted when writing JSON text,\n        /// and the expected date format when reading JSON text.\n        /// The default value is <c>\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\"</c>.\n        /// </summary>\n        public virtual string DateFormatString\n        {\n            get => _dateFormatString ?? JsonSerializerSettings.DefaultDateFormatString;\n            set\n            {\n                _dateFormatString = value;\n                _dateFormatStringSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON.\n        /// The default value is <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public virtual CultureInfo Culture\n        {\n            get => _culture ?? JsonSerializerSettings.DefaultCulture;\n            set => _culture = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// A null value means there is no maximum.\n        /// The default value is <c>128</c>.\n        /// </summary>\n        public virtual int? MaxDepth\n        {\n            get => _maxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n                _maxDepthSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets a value indicating whether there will be a check for additional JSON content after deserializing an object.\n        /// The default value is <c>false</c>.\n        /// </summary>\n        /// <value>\n        /// \t<c>true</c> if there will be a check for additional JSON content after deserializing an object; otherwise, <c>false</c>.\n        /// </value>\n        public virtual bool CheckAdditionalContent\n        {\n            get => _checkAdditionalContent ?? JsonSerializerSettings.DefaultCheckAdditionalContent;\n            set => _checkAdditionalContent = value;\n        }\n\n        internal bool IsCheckAdditionalContentSet()\n        {\n            return (_checkAdditionalContent != null);\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonSerializer\"/> class.\n        /// </summary>\n        public JsonSerializer()\n        {\n            _referenceLoopHandling = JsonSerializerSettings.DefaultReferenceLoopHandling;\n            _missingMemberHandling = JsonSerializerSettings.DefaultMissingMemberHandling;\n            _nullValueHandling = JsonSerializerSettings.DefaultNullValueHandling;\n            _defaultValueHandling = JsonSerializerSettings.DefaultDefaultValueHandling;\n            _objectCreationHandling = JsonSerializerSettings.DefaultObjectCreationHandling;\n            _preserveReferencesHandling = JsonSerializerSettings.DefaultPreserveReferencesHandling;\n            _constructorHandling = JsonSerializerSettings.DefaultConstructorHandling;\n            _typeNameHandling = JsonSerializerSettings.DefaultTypeNameHandling;\n            _metadataPropertyHandling = JsonSerializerSettings.DefaultMetadataPropertyHandling;\n            _context = JsonSerializerSettings.DefaultContext;\n            _serializationBinder = DefaultSerializationBinder.Instance;\n\n            _culture = JsonSerializerSettings.DefaultCulture;\n            _contractResolver = DefaultContractResolver.Instance;\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer Create()\n        {\n            return new JsonSerializer();\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <param name=\"settings\">The settings to be applied to the <see cref=\"JsonSerializer\"/>.</param>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will not use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer Create(JsonSerializerSettings? settings)\n        {\n            JsonSerializer serializer = Create();\n\n            if (settings != null)\n            {\n                ApplySerializerSettings(serializer, settings);\n            }\n\n            return serializer;\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </summary>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/>.\n        /// </returns>\n        public static JsonSerializer CreateDefault()\n        {\n            // copy static to local variable to avoid concurrency issues\n            JsonSerializerSettings? defaultSettings = JsonConvert.DefaultSettings?.Invoke();\n\n            return Create(defaultSettings);\n        }\n\n        /// <summary>\n        /// Creates a new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/> as well as the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// </summary>\n        /// <param name=\"settings\">The settings to be applied to the <see cref=\"JsonSerializer\"/>.</param>\n        /// <returns>\n        /// A new <see cref=\"JsonSerializer\"/> instance using the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// The <see cref=\"JsonSerializer\"/> will use default settings \n        /// from <see cref=\"JsonConvert.DefaultSettings\"/> as well as the specified <see cref=\"JsonSerializerSettings\"/>.\n        /// </returns>\n        public static JsonSerializer CreateDefault(JsonSerializerSettings? settings)\n        {\n            JsonSerializer serializer = CreateDefault();\n            if (settings != null)\n            {\n                ApplySerializerSettings(serializer, settings);\n            }\n\n            return serializer;\n        }\n\n        private static void ApplySerializerSettings(JsonSerializer serializer, JsonSerializerSettings settings)\n        {\n            if (!CollectionUtils.IsNullOrEmpty(settings.Converters))\n            {\n                // insert settings converters at the beginning so they take precedence\n                // if user wants to remove one of the default converters they will have to do it manually\n                for (int i = 0; i < settings.Converters.Count; i++)\n                {\n                    serializer.Converters.Insert(i, settings.Converters[i]);\n                }\n            }\n\n            // serializer specific\n            if (settings._typeNameHandling != null)\n            {\n                serializer.TypeNameHandling = settings.TypeNameHandling;\n            }\n            if (settings._metadataPropertyHandling != null)\n            {\n                serializer.MetadataPropertyHandling = settings.MetadataPropertyHandling;\n            }\n            if (settings._typeNameAssemblyFormatHandling != null)\n            {\n                serializer.TypeNameAssemblyFormatHandling = settings.TypeNameAssemblyFormatHandling;\n            }\n            if (settings._preserveReferencesHandling != null)\n            {\n                serializer.PreserveReferencesHandling = settings.PreserveReferencesHandling;\n            }\n            if (settings._referenceLoopHandling != null)\n            {\n                serializer.ReferenceLoopHandling = settings.ReferenceLoopHandling;\n            }\n            if (settings._missingMemberHandling != null)\n            {\n                serializer.MissingMemberHandling = settings.MissingMemberHandling;\n            }\n            if (settings._objectCreationHandling != null)\n            {\n                serializer.ObjectCreationHandling = settings.ObjectCreationHandling;\n            }\n            if (settings._nullValueHandling != null)\n            {\n                serializer.NullValueHandling = settings.NullValueHandling;\n            }\n            if (settings._defaultValueHandling != null)\n            {\n                serializer.DefaultValueHandling = settings.DefaultValueHandling;\n            }\n            if (settings._constructorHandling != null)\n            {\n                serializer.ConstructorHandling = settings.ConstructorHandling;\n            }\n            if (settings._context != null)\n            {\n                serializer.Context = settings.Context;\n            }\n            if (settings._checkAdditionalContent != null)\n            {\n                serializer._checkAdditionalContent = settings._checkAdditionalContent;\n            }\n\n            if (settings.Error != null)\n            {\n                serializer.Error += settings.Error;\n            }\n\n            if (settings.ContractResolver != null)\n            {\n                serializer.ContractResolver = settings.ContractResolver;\n            }\n            if (settings.ReferenceResolverProvider != null)\n            {\n                serializer.ReferenceResolver = settings.ReferenceResolverProvider();\n            }\n            if (settings.TraceWriter != null)\n            {\n                serializer.TraceWriter = settings.TraceWriter;\n            }\n            if (settings.EqualityComparer != null)\n            {\n                serializer.EqualityComparer = settings.EqualityComparer;\n            }\n            if (settings.SerializationBinder != null)\n            {\n                serializer.SerializationBinder = settings.SerializationBinder;\n            }\n\n            // reader/writer specific\n            // unset values won't override reader/writer set values\n            if (settings._formatting != null)\n            {\n                serializer._formatting = settings._formatting;\n            }\n            if (settings._dateFormatHandling != null)\n            {\n                serializer._dateFormatHandling = settings._dateFormatHandling;\n            }\n            if (settings._dateTimeZoneHandling != null)\n            {\n                serializer._dateTimeZoneHandling = settings._dateTimeZoneHandling;\n            }\n            if (settings._dateParseHandling != null)\n            {\n                serializer._dateParseHandling = settings._dateParseHandling;\n            }\n            if (settings._dateFormatStringSet)\n            {\n                serializer._dateFormatString = settings._dateFormatString;\n                serializer._dateFormatStringSet = settings._dateFormatStringSet;\n            }\n            if (settings._floatFormatHandling != null)\n            {\n                serializer._floatFormatHandling = settings._floatFormatHandling;\n            }\n            if (settings._floatParseHandling != null)\n            {\n                serializer._floatParseHandling = settings._floatParseHandling;\n            }\n            if (settings._stringEscapeHandling != null)\n            {\n                serializer._stringEscapeHandling = settings._stringEscapeHandling;\n            }\n            if (settings._culture != null)\n            {\n                serializer._culture = settings._culture;\n            }\n            if (settings._maxDepthSet)\n            {\n                serializer._maxDepth = settings._maxDepth;\n                serializer._maxDepthSet = settings._maxDepthSet;\n            }\n        }\n\n        /// <summary>\n        /// Populates the JSON values onto the target object.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"TextReader\"/> that contains the JSON structure to read values from.</param>\n        /// <param name=\"target\">The target object to populate values onto.</param>\n        [DebuggerStepThrough]\n        public void Populate(TextReader reader, object target)\n        {\n            Populate(new JsonTextReader(reader), target);\n        }\n\n        /// <summary>\n        /// Populates the JSON values onto the target object.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> that contains the JSON structure to read values from.</param>\n        /// <param name=\"target\">The target object to populate values onto.</param>\n        [DebuggerStepThrough]\n        public void Populate(JsonReader reader, object target)\n        {\n            PopulateInternal(reader, target);\n        }\n\n        internal virtual void PopulateInternal(JsonReader reader, object target)\n        {\n            ValidationUtils.ArgumentNotNull(reader, nameof(reader));\n            ValidationUtils.ArgumentNotNull(target, nameof(target));\n\n            SetupReader(\n                reader,\n                out CultureInfo? previousCulture,\n                out DateTimeZoneHandling? previousDateTimeZoneHandling,\n                out DateParseHandling? previousDateParseHandling,\n                out FloatParseHandling? previousFloatParseHandling,\n                out int? previousMaxDepth,\n                out string? previousDateFormatString);\n\n            TraceJsonReader? traceJsonReader = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? CreateTraceJsonReader(reader)\n                : null;\n\n            JsonSerializerInternalReader serializerReader = new JsonSerializerInternalReader(this);\n            serializerReader.Populate(traceJsonReader ?? reader, target);\n\n            if (traceJsonReader != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonReader.GetDeserializedJsonMessage(), null);\n            }\n\n            ResetReader(reader, previousCulture, previousDateTimeZoneHandling, previousDateParseHandling, previousFloatParseHandling, previousMaxDepth, previousDateFormatString);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> that contains the JSON structure to deserialize.</param>\n        /// <returns>The <see cref=\"Object\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(JsonReader reader)\n        {\n            return Deserialize(reader, null);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"TextReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"TextReader\"/> containing the object.</param>\n        /// <param name=\"objectType\">The <see cref=\"Type\"/> of object being deserialized.</param>\n        /// <returns>The instance of <paramref name=\"objectType\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(TextReader reader, Type objectType)\n        {\n            return Deserialize(new JsonTextReader(reader), objectType);\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> containing the object.</param>\n        /// <typeparam name=\"T\">The type of the object to deserialize.</typeparam>\n        /// <returns>The instance of <typeparamref name=\"T\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public T? Deserialize<T>(JsonReader reader)\n        {\n#pragma warning disable CS8601 // Possible null reference assignment.\n            return (T)Deserialize(reader, typeof(T));\n#pragma warning restore CS8601 // Possible null reference assignment.\n        }\n\n        /// <summary>\n        /// Deserializes the JSON structure contained by the specified <see cref=\"JsonReader\"/>\n        /// into an instance of the specified type.\n        /// </summary>\n        /// <param name=\"reader\">The <see cref=\"JsonReader\"/> containing the object.</param>\n        /// <param name=\"objectType\">The <see cref=\"Type\"/> of object being deserialized.</param>\n        /// <returns>The instance of <paramref name=\"objectType\"/> being deserialized.</returns>\n        [DebuggerStepThrough]\n        public object? Deserialize(JsonReader reader, Type? objectType)\n        {\n            return DeserializeInternal(reader, objectType);\n        }\n\n        internal virtual object? DeserializeInternal(JsonReader reader, Type? objectType)\n        {\n            ValidationUtils.ArgumentNotNull(reader, nameof(reader));\n\n            SetupReader(\n                reader,\n                out CultureInfo? previousCulture,\n                out DateTimeZoneHandling? previousDateTimeZoneHandling,\n                out DateParseHandling? previousDateParseHandling,\n                out FloatParseHandling? previousFloatParseHandling,\n                out int? previousMaxDepth,\n                out string? previousDateFormatString);\n\n            TraceJsonReader? traceJsonReader = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? CreateTraceJsonReader(reader)\n                : null;\n\n            JsonSerializerInternalReader serializerReader = new JsonSerializerInternalReader(this);\n            object? value = serializerReader.Deserialize(traceJsonReader ?? reader, objectType, CheckAdditionalContent);\n\n            if (traceJsonReader != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonReader.GetDeserializedJsonMessage(), null);\n            }\n\n            ResetReader(reader, previousCulture, previousDateTimeZoneHandling, previousDateParseHandling, previousFloatParseHandling, previousMaxDepth, previousDateFormatString);\n\n            return value;\n        }\n\n        private void SetupReader(JsonReader reader, out CultureInfo? previousCulture, out DateTimeZoneHandling? previousDateTimeZoneHandling, out DateParseHandling? previousDateParseHandling, out FloatParseHandling? previousFloatParseHandling, out int? previousMaxDepth, out string? previousDateFormatString)\n        {\n            if (_culture != null && !_culture.Equals(reader.Culture))\n            {\n                previousCulture = reader.Culture;\n                reader.Culture = _culture;\n            }\n            else\n            {\n                previousCulture = null;\n            }\n\n            if (_dateTimeZoneHandling != null && reader.DateTimeZoneHandling != _dateTimeZoneHandling)\n            {\n                previousDateTimeZoneHandling = reader.DateTimeZoneHandling;\n                reader.DateTimeZoneHandling = _dateTimeZoneHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousDateTimeZoneHandling = null;\n            }\n\n            if (_dateParseHandling != null && reader.DateParseHandling != _dateParseHandling)\n            {\n                previousDateParseHandling = reader.DateParseHandling;\n                reader.DateParseHandling = _dateParseHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousDateParseHandling = null;\n            }\n\n            if (_floatParseHandling != null && reader.FloatParseHandling != _floatParseHandling)\n            {\n                previousFloatParseHandling = reader.FloatParseHandling;\n                reader.FloatParseHandling = _floatParseHandling.GetValueOrDefault();\n            }\n            else\n            {\n                previousFloatParseHandling = null;\n            }\n\n            if (_maxDepthSet && reader.MaxDepth != _maxDepth)\n            {\n                previousMaxDepth = reader.MaxDepth;\n                reader.MaxDepth = _maxDepth;\n            }\n            else\n            {\n                previousMaxDepth = null;\n            }\n\n            if (_dateFormatStringSet && reader.DateFormatString != _dateFormatString)\n            {\n                previousDateFormatString = reader.DateFormatString;\n                reader.DateFormatString = _dateFormatString;\n            }\n            else\n            {\n                previousDateFormatString = null;\n            }\n\n            if (reader is JsonTextReader textReader)\n            {\n                if (textReader.PropertyNameTable == null && _contractResolver is DefaultContractResolver resolver)\n                {\n                    textReader.PropertyNameTable = resolver.GetNameTable();\n                }\n            }\n        }\n\n        private void ResetReader(JsonReader reader, CultureInfo? previousCulture, DateTimeZoneHandling? previousDateTimeZoneHandling, DateParseHandling? previousDateParseHandling, FloatParseHandling? previousFloatParseHandling, int? previousMaxDepth, string? previousDateFormatString)\n        {\n            // reset reader back to previous options\n            if (previousCulture != null)\n            {\n                reader.Culture = previousCulture;\n            }\n            if (previousDateTimeZoneHandling != null)\n            {\n                reader.DateTimeZoneHandling = previousDateTimeZoneHandling.GetValueOrDefault();\n            }\n            if (previousDateParseHandling != null)\n            {\n                reader.DateParseHandling = previousDateParseHandling.GetValueOrDefault();\n            }\n            if (previousFloatParseHandling != null)\n            {\n                reader.FloatParseHandling = previousFloatParseHandling.GetValueOrDefault();\n            }\n            if (_maxDepthSet)\n            {\n                reader.MaxDepth = previousMaxDepth;\n            }\n            if (_dateFormatStringSet)\n            {\n                reader.DateFormatString = previousDateFormatString;\n            }\n\n            if (reader is JsonTextReader textReader && textReader.PropertyNameTable != null &&\n                _contractResolver is DefaultContractResolver resolver && textReader.PropertyNameTable == resolver.GetNameTable())\n            {\n                textReader.PropertyNameTable = null;\n            }\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"TextWriter\"/>.\n        /// </summary>\n        /// <param name=\"textWriter\">The <see cref=\"TextWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        public void Serialize(TextWriter textWriter, object? value)\n        {\n            Serialize(new JsonTextWriter(textWriter), value);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"JsonWriter\"/>.\n        /// </summary>\n        /// <param name=\"jsonWriter\">The <see cref=\"JsonWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        /// <param name=\"objectType\">\n        /// The type of the value being serialized.\n        /// This parameter is used when <see cref=\"JsonSerializer.TypeNameHandling\"/> is <see cref=\"Json.TypeNameHandling.Auto\"/> to write out the type name if the type of the value does not match.\n        /// Specifying the type is optional.\n        /// </param>\n        public void Serialize(JsonWriter jsonWriter, object? value, Type? objectType)\n        {\n            SerializeInternal(jsonWriter, value, objectType);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"TextWriter\"/>.\n        /// </summary>\n        /// <param name=\"textWriter\">The <see cref=\"TextWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        /// <param name=\"objectType\">\n        /// The type of the value being serialized.\n        /// This parameter is used when <see cref=\"TypeNameHandling\"/> is Auto to write out the type name if the type of the value does not match.\n        /// Specifying the type is optional.\n        /// </param>\n        public void Serialize(TextWriter textWriter, object? value, Type objectType)\n        {\n            Serialize(new JsonTextWriter(textWriter), value, objectType);\n        }\n\n        /// <summary>\n        /// Serializes the specified <see cref=\"Object\"/> and writes the JSON structure\n        /// using the specified <see cref=\"JsonWriter\"/>.\n        /// </summary>\n        /// <param name=\"jsonWriter\">The <see cref=\"JsonWriter\"/> used to write the JSON structure.</param>\n        /// <param name=\"value\">The <see cref=\"Object\"/> to serialize.</param>\n        public void Serialize(JsonWriter jsonWriter, object? value)\n        {\n            SerializeInternal(jsonWriter, value, null);\n        }\n\n        private TraceJsonReader CreateTraceJsonReader(JsonReader reader)\n        {\n            TraceJsonReader traceReader = new TraceJsonReader(reader);\n            if (reader.TokenType != JsonToken.None)\n            {\n                traceReader.WriteCurrentToken();\n            }\n\n            return traceReader;\n        }\n\n        internal virtual void SerializeInternal(JsonWriter jsonWriter, object? value, Type? objectType)\n        {\n            ValidationUtils.ArgumentNotNull(jsonWriter, nameof(jsonWriter));\n\n            // set serialization options onto writer\n            Formatting? previousFormatting = null;\n            if (_formatting != null && jsonWriter.Formatting != _formatting)\n            {\n                previousFormatting = jsonWriter.Formatting;\n                jsonWriter.Formatting = _formatting.GetValueOrDefault();\n            }\n\n            DateFormatHandling? previousDateFormatHandling = null;\n            if (_dateFormatHandling != null && jsonWriter.DateFormatHandling != _dateFormatHandling)\n            {\n                previousDateFormatHandling = jsonWriter.DateFormatHandling;\n                jsonWriter.DateFormatHandling = _dateFormatHandling.GetValueOrDefault();\n            }\n\n            DateTimeZoneHandling? previousDateTimeZoneHandling = null;\n            if (_dateTimeZoneHandling != null && jsonWriter.DateTimeZoneHandling != _dateTimeZoneHandling)\n            {\n                previousDateTimeZoneHandling = jsonWriter.DateTimeZoneHandling;\n                jsonWriter.DateTimeZoneHandling = _dateTimeZoneHandling.GetValueOrDefault();\n            }\n\n            FloatFormatHandling? previousFloatFormatHandling = null;\n            if (_floatFormatHandling != null && jsonWriter.FloatFormatHandling != _floatFormatHandling)\n            {\n                previousFloatFormatHandling = jsonWriter.FloatFormatHandling;\n                jsonWriter.FloatFormatHandling = _floatFormatHandling.GetValueOrDefault();\n            }\n\n            StringEscapeHandling? previousStringEscapeHandling = null;\n            if (_stringEscapeHandling != null && jsonWriter.StringEscapeHandling != _stringEscapeHandling)\n            {\n                previousStringEscapeHandling = jsonWriter.StringEscapeHandling;\n                jsonWriter.StringEscapeHandling = _stringEscapeHandling.GetValueOrDefault();\n            }\n\n            CultureInfo? previousCulture = null;\n            if (_culture != null && !_culture.Equals(jsonWriter.Culture))\n            {\n                previousCulture = jsonWriter.Culture;\n                jsonWriter.Culture = _culture;\n            }\n\n            string? previousDateFormatString = null;\n            if (_dateFormatStringSet && jsonWriter.DateFormatString != _dateFormatString)\n            {\n                previousDateFormatString = jsonWriter.DateFormatString;\n                jsonWriter.DateFormatString = _dateFormatString;\n            }\n\n            TraceJsonWriter? traceJsonWriter = (TraceWriter != null && TraceWriter.LevelFilter >= TraceLevel.Verbose)\n                ? new TraceJsonWriter(jsonWriter)\n                : null;\n\n            JsonSerializerInternalWriter serializerWriter = new JsonSerializerInternalWriter(this);\n            serializerWriter.Serialize(traceJsonWriter ?? jsonWriter, value, objectType);\n\n            if (traceJsonWriter != null)\n            {\n                TraceWriter!.Trace(TraceLevel.Verbose, traceJsonWriter.GetSerializedJsonMessage(), null);\n            }\n\n            // reset writer back to previous options\n            if (previousFormatting != null)\n            {\n                jsonWriter.Formatting = previousFormatting.GetValueOrDefault();\n            }\n            if (previousDateFormatHandling != null)\n            {\n                jsonWriter.DateFormatHandling = previousDateFormatHandling.GetValueOrDefault();\n            }\n            if (previousDateTimeZoneHandling != null)\n            {\n                jsonWriter.DateTimeZoneHandling = previousDateTimeZoneHandling.GetValueOrDefault();\n            }\n            if (previousFloatFormatHandling != null)\n            {\n                jsonWriter.FloatFormatHandling = previousFloatFormatHandling.GetValueOrDefault();\n            }\n            if (previousStringEscapeHandling != null)\n            {\n                jsonWriter.StringEscapeHandling = previousStringEscapeHandling.GetValueOrDefault();\n            }\n            if (_dateFormatStringSet)\n            {\n                jsonWriter.DateFormatString = previousDateFormatString;\n            }\n            if (previousCulture != null)\n            {\n                jsonWriter.Culture = previousCulture;\n            }\n        }\n\n        internal IReferenceResolver GetReferenceResolver()\n        {\n            if (_referenceResolver == null)\n            {\n                _referenceResolver = new DefaultReferenceResolver();\n            }\n\n            return _referenceResolver;\n        }\n\n        internal JsonConverter? GetMatchingConverter(Type type)\n        {\n            return GetMatchingConverter(_converters, type);\n        }\n\n        internal static JsonConverter? GetMatchingConverter(IList<JsonConverter>? converters, Type objectType)\n        {\n#if DEBUG\n            ValidationUtils.ArgumentNotNull(objectType, nameof(objectType));\n#endif\n\n            if (converters != null)\n            {\n                for (int i = 0; i < converters.Count; i++)\n                {\n                    JsonConverter converter = converters[i];\n\n                    if (converter.CanConvert(objectType))\n                    {\n                        return converter;\n                    }\n                }\n            }\n\n            return null;\n        }\n\n        internal void OnError(ErrorEventArgs e)\n        {\n            Error?.Invoke(this, e);\n        }\n    }\n}\n", "#region License\n// Copyright (c) 2007 James Newton-King\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections;\nusing System.Collections.Generic;\nusing System.Globalization;\nusing System.Runtime.Serialization.Formatters;\nusing Newtonsoft.Json.Serialization;\nusing System.Runtime.Serialization;\nusing System.Diagnostics;\n\nnamespace Newtonsoft.Json\n{\n    /// <summary>\n    /// Specifies the settings on a <see cref=\"JsonSerializer\"/> object.\n    /// </summary>\n    public class JsonSerializerSettings\n    {\n        internal const ReferenceLoopHandling DefaultReferenceLoopHandling = ReferenceLoopHandling.Error;\n        internal const MissingMemberHandling DefaultMissingMemberHandling = MissingMemberHandling.Ignore;\n        internal const NullValueHandling DefaultNullValueHandling = NullValueHandling.Include;\n        internal const DefaultValueHandling DefaultDefaultValueHandling = DefaultValueHandling.Include;\n        internal const ObjectCreationHandling DefaultObjectCreationHandling = ObjectCreationHandling.Auto;\n        internal const PreserveReferencesHandling DefaultPreserveReferencesHandling = PreserveReferencesHandling.None;\n        internal const ConstructorHandling DefaultConstructorHandling = ConstructorHandling.Default;\n        internal const TypeNameHandling DefaultTypeNameHandling = TypeNameHandling.None;\n        internal const MetadataPropertyHandling DefaultMetadataPropertyHandling = MetadataPropertyHandling.Default;\n        internal static readonly StreamingContext DefaultContext;\n\n        internal const Formatting DefaultFormatting = Formatting.None;\n        internal const DateFormatHandling DefaultDateFormatHandling = DateFormatHandling.IsoDateFormat;\n        internal const DateTimeZoneHandling DefaultDateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind;\n        internal const DateParseHandling DefaultDateParseHandling = DateParseHandling.DateTime;\n        internal const FloatParseHandling DefaultFloatParseHandling = FloatParseHandling.Double;\n        internal const FloatFormatHandling DefaultFloatFormatHandling = FloatFormatHandling.String;\n        internal const StringEscapeHandling DefaultStringEscapeHandling = StringEscapeHandling.Default;\n        internal const TypeNameAssemblyFormatHandling DefaultTypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple;\n        internal static readonly CultureInfo DefaultCulture;\n        internal const bool DefaultCheckAdditionalContent = false;\n        internal const string DefaultDateFormatString = @\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\";\n        internal const int DefaultMaxDepth = 128;\n\n        internal Formatting? _formatting;\n        internal DateFormatHandling? _dateFormatHandling;\n        internal DateTimeZoneHandling? _dateTimeZoneHandling;\n        internal DateParseHandling? _dateParseHandling;\n        internal FloatFormatHandling? _floatFormatHandling;\n        internal FloatParseHandling? _floatParseHandling;\n        internal StringEscapeHandling? _stringEscapeHandling;\n        internal CultureInfo? _culture;\n        internal bool? _checkAdditionalContent;\n        internal int? _maxDepth;\n        internal bool _maxDepthSet;\n        internal string? _dateFormatString;\n        internal bool _dateFormatStringSet;\n        internal TypeNameAssemblyFormatHandling? _typeNameAssemblyFormatHandling;\n        internal DefaultValueHandling? _defaultValueHandling;\n        internal PreserveReferencesHandling? _preserveReferencesHandling;\n        internal NullValueHandling? _nullValueHandling;\n        internal ObjectCreationHandling? _objectCreationHandling;\n        internal MissingMemberHandling? _missingMemberHandling;\n        internal ReferenceLoopHandling? _referenceLoopHandling;\n        internal StreamingContext? _context;\n        internal ConstructorHandling? _constructorHandling;\n        internal TypeNameHandling? _typeNameHandling;\n        internal MetadataPropertyHandling? _metadataPropertyHandling;\n\n        /// <summary>\n        /// Gets or sets how reference loops (e.g. a class referencing itself) are handled.\n        /// The default value is <see cref=\"Json.ReferenceLoopHandling.Error\" />.\n        /// </summary>\n        /// <value>Reference loop handling.</value>\n        public ReferenceLoopHandling ReferenceLoopHandling\n        {\n            get => _referenceLoopHandling ?? DefaultReferenceLoopHandling;\n            set => _referenceLoopHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how missing members (e.g. JSON contains a property that isn't a member on the object) are handled during deserialization.\n        /// The default value is <see cref=\"Json.MissingMemberHandling.Ignore\" />.\n        /// </summary>\n        /// <value>Missing member handling.</value>\n        public MissingMemberHandling MissingMemberHandling\n        {\n            get => _missingMemberHandling ?? DefaultMissingMemberHandling;\n            set => _missingMemberHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how objects are created during deserialization.\n        /// The default value is <see cref=\"Json.ObjectCreationHandling.Auto\" />.\n        /// </summary>\n        /// <value>The object creation handling.</value>\n        public ObjectCreationHandling ObjectCreationHandling\n        {\n            get => _objectCreationHandling ?? DefaultObjectCreationHandling;\n            set => _objectCreationHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how null values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.NullValueHandling.Include\" />.\n        /// </summary>\n        /// <value>Null value handling.</value>\n        public NullValueHandling NullValueHandling\n        {\n            get => _nullValueHandling ?? DefaultNullValueHandling;\n            set => _nullValueHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how default values are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DefaultValueHandling.Include\" />.\n        /// </summary>\n        /// <value>The default value handling.</value>\n        public DefaultValueHandling DefaultValueHandling\n        {\n            get => _defaultValueHandling ?? DefaultDefaultValueHandling;\n            set => _defaultValueHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets a <see cref=\"JsonConverter\"/> collection that will be used during serialization.\n        /// </summary>\n        /// <value>The converters.</value>\n        public IList<JsonConverter> Converters { get; set; }\n\n        /// <summary>\n        /// Gets or sets how object references are preserved by the serializer.\n        /// The default value is <see cref=\"Json.PreserveReferencesHandling.None\" />.\n        /// </summary>\n        /// <value>The preserve references handling.</value>\n        public PreserveReferencesHandling PreserveReferencesHandling\n        {\n            get => _preserveReferencesHandling ?? DefaultPreserveReferencesHandling;\n            set => _preserveReferencesHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how type name writing and reading is handled by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameHandling.None\" />.\n        /// </summary>\n        /// <remarks>\n        /// <see cref=\"JsonSerializerSettings.TypeNameHandling\"/> should be used with caution when your application deserializes JSON from an external source.\n        /// Incoming types should be validated with a custom <see cref=\"JsonSerializerSettings.SerializationBinder\"/>\n        /// when deserializing with a value other than <see cref=\"Json.TypeNameHandling.None\"/>.\n        /// </remarks>\n        /// <value>The type name handling.</value>\n        public TypeNameHandling TypeNameHandling\n        {\n            get => _typeNameHandling ?? DefaultTypeNameHandling;\n            set => _typeNameHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how metadata properties are used during deserialization.\n        /// The default value is <see cref=\"Json.MetadataPropertyHandling.Default\" />.\n        /// </summary>\n        /// <value>The metadata properties handling.</value>\n        public MetadataPropertyHandling MetadataPropertyHandling\n        {\n            get => _metadataPropertyHandling ?? DefaultMetadataPropertyHandling;\n            set => _metadataPropertyHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"FormatterAssemblyStyle.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        [Obsolete(\"TypeNameAssemblyFormat is obsolete. Use TypeNameAssemblyFormatHandling instead.\")]\n        public FormatterAssemblyStyle TypeNameAssemblyFormat\n        {\n            get => (FormatterAssemblyStyle)TypeNameAssemblyFormatHandling;\n            set => TypeNameAssemblyFormatHandling = (TypeNameAssemblyFormatHandling)value;\n        }\n\n        /// <summary>\n        /// Gets or sets how a type name assembly is written and resolved by the serializer.\n        /// The default value is <see cref=\"Json.TypeNameAssemblyFormatHandling.Simple\" />.\n        /// </summary>\n        /// <value>The type name assembly format.</value>\n        public TypeNameAssemblyFormatHandling TypeNameAssemblyFormatHandling\n        {\n            get => _typeNameAssemblyFormatHandling ?? DefaultTypeNameAssemblyFormatHandling;\n            set => _typeNameAssemblyFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how constructors are used during deserialization.\n        /// The default value is <see cref=\"Json.ConstructorHandling.Default\" />.\n        /// </summary>\n        /// <value>The constructor handling.</value>\n        public ConstructorHandling ConstructorHandling\n        {\n            get => _constructorHandling ?? DefaultConstructorHandling;\n            set => _constructorHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the contract resolver used by the serializer when\n        /// serializing .NET objects to JSON and vice versa.\n        /// </summary>\n        /// <value>The contract resolver.</value>\n        public IContractResolver? ContractResolver { get; set; }\n\n        /// <summary>\n        /// Gets or sets the equality comparer used by the serializer when comparing references.\n        /// </summary>\n        /// <value>The equality comparer.</value>\n        public IEqualityComparer? EqualityComparer { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        /// <value>The reference resolver.</value>\n        [Obsolete(\"ReferenceResolver property is obsolete. Use the ReferenceResolverProvider property to set the IReferenceResolver: settings.ReferenceResolverProvider = () => resolver\")]\n        public IReferenceResolver? ReferenceResolver\n        {\n            get => ReferenceResolverProvider?.Invoke();\n            set\n            {\n                ReferenceResolverProvider = (value != null)\n                    ? () => value\n                    : (Func<IReferenceResolver?>?)null;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets a function that creates the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.\n        /// </summary>\n        /// <value>A function that creates the <see cref=\"IReferenceResolver\"/> used by the serializer when resolving references.</value>\n        public Func<IReferenceResolver?>? ReferenceResolverProvider { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ITraceWriter\"/> used by the serializer when writing trace messages.\n        /// </summary>\n        /// <value>The trace writer.</value>\n        public ITraceWriter? TraceWriter { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"SerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        /// <value>The binder.</value>\n        [Obsolete(\"Binder is obsolete. Use SerializationBinder instead.\")]\n        public SerializationBinder? Binder\n        {\n            get\n            {\n                if (SerializationBinder == null)\n                {\n                    return null;\n                }\n\n                if (SerializationBinder is SerializationBinderAdapter adapter)\n                {\n                    return adapter.SerializationBinder;\n                }\n\n                throw new InvalidOperationException(\"Cannot get SerializationBinder because an ISerializationBinder was previously set.\");\n            }\n            set => SerializationBinder = value == null ? null : new SerializationBinderAdapter(value);\n        }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"ISerializationBinder\"/> used by the serializer when resolving type names.\n        /// </summary>\n        /// <value>The binder.</value>\n        public ISerializationBinder? SerializationBinder { get; set; }\n\n        /// <summary>\n        /// Gets or sets the error handler called during serialization and deserialization.\n        /// </summary>\n        /// <value>The error handler called during serialization and deserialization.</value>\n        public EventHandler<ErrorEventArgs>? Error { get; set; }\n\n        /// <summary>\n        /// Gets or sets the <see cref=\"StreamingContext\"/> used by the serializer when invoking serialization callback methods.\n        /// </summary>\n        /// <value>The context.</value>\n        public StreamingContext Context\n        {\n            get => _context ?? DefaultContext;\n            set => _context = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> and <see cref=\"DateTimeOffset\"/> values are formatted when writing JSON text,\n        /// and the expected date format when reading JSON text.\n        /// The default value is <c>\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK\"</c>.\n        /// </summary>\n        public string DateFormatString\n        {\n            get => _dateFormatString ?? DefaultDateFormatString;\n            set\n            {\n                _dateFormatString = value;\n                _dateFormatStringSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref=\"JsonReaderException\"/>.\n        /// A null value means there is no maximum.\n        /// The default value is <c>128</c>.\n        /// </summary>\n        public int? MaxDepth\n        {\n            get => _maxDepthSet ? _maxDepth : DefaultMaxDepth;\n            set\n            {\n                if (value <= 0)\n                {\n                    throw new ArgumentException(\"Value must be positive.\", nameof(value));\n                }\n\n                _maxDepth = value;\n                _maxDepthSet = true;\n            }\n        }\n\n        /// <summary>\n        /// Indicates how JSON text output is formatted.\n        /// The default value is <see cref=\"Json.Formatting.None\" />.\n        /// </summary>\n        public Formatting Formatting\n        {\n            get => _formatting ?? DefaultFormatting;\n            set => _formatting = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how dates are written to JSON text.\n        /// The default value is <see cref=\"Json.DateFormatHandling.IsoDateFormat\" />.\n        /// </summary>\n        public DateFormatHandling DateFormatHandling\n        {\n            get => _dateFormatHandling ?? DefaultDateFormatHandling;\n            set => _dateFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how <see cref=\"DateTime\"/> time zones are handled during serialization and deserialization.\n        /// The default value is <see cref=\"Json.DateTimeZoneHandling.RoundtripKind\" />.\n        /// </summary>\n        public DateTimeZoneHandling DateTimeZoneHandling\n        {\n            get => _dateTimeZoneHandling ?? DefaultDateTimeZoneHandling;\n            set => _dateTimeZoneHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how date formatted strings, e.g. <c>\"\\/Date(1198908717056)\\/\"</c> and <c>\"2012-03-21T05:40Z\"</c>, are parsed when reading JSON.\n        /// The default value is <see cref=\"Json.DateParseHandling.DateTime\" />.\n        /// </summary>\n        public DateParseHandling DateParseHandling\n        {\n            get => _dateParseHandling ?? DefaultDateParseHandling;\n            set => _dateParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how special floating point numbers, e.g. <see cref=\"Double.NaN\"/>,\n        /// <see cref=\"Double.PositiveInfinity\"/> and <see cref=\"Double.NegativeInfinity\"/>,\n        /// are written as JSON.\n        /// The default value is <see cref=\"Json.FloatFormatHandling.String\" />.\n        /// </summary>\n        public FloatFormatHandling FloatFormatHandling\n        {\n            get => _floatFormatHandling ?? DefaultFloatFormatHandling;\n            set => _floatFormatHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how floating point numbers, e.g. 1.0 and 9.9, are parsed when reading JSON text.\n        /// The default value is <see cref=\"Json.FloatParseHandling.Double\" />.\n        /// </summary>\n        public FloatParseHandling FloatParseHandling\n        {\n            get => _floatParseHandling ?? DefaultFloatParseHandling;\n            set => _floatParseHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets how strings are escaped when writing JSON text.\n        /// The default value is <see cref=\"Json.StringEscapeHandling.Default\" />.\n        /// </summary>\n        public StringEscapeHandling StringEscapeHandling\n        {\n            get => _stringEscapeHandling ?? DefaultStringEscapeHandling;\n            set => _stringEscapeHandling = value;\n        }\n\n        /// <summary>\n        /// Gets or sets the culture used when reading JSON.\n        /// The default value is <see cref=\"CultureInfo.InvariantCulture\"/>.\n        /// </summary>\n        public CultureInfo Culture\n        {\n            get => _culture ?? DefaultCulture;\n            set => _culture = value;\n        }\n\n        /// <summary>\n        /// Gets a value indicating whether there will be a check for additional content after deserializing an object.\n        /// The default value is <c>false</c>.\n        /// </summary>\n        /// <value>\n        /// \t<c>true</c> if there will be a check for additional content after deserializing an object; otherwise, <c>false</c>.\n        /// </value>\n        public bool CheckAdditionalContent\n        {\n            get => _checkAdditionalContent ?? DefaultCheckAdditionalContent;\n            set => _checkAdditionalContent = value;\n        }\n\n        static JsonSerializerSettings()\n        {\n            DefaultContext = new StreamingContext();\n            DefaultCulture = CultureInfo.InvariantCulture;\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref=\"JsonSerializerSettings\"/> class.\n        /// </summary>\n        [DebuggerStepThrough]\n        public JsonSerializerSettings()\n        {\n            Converters = new List<JsonConverter>();\n        }\n    }\n}"], "filenames": ["Src/Newtonsoft.Json.Tests/Serialization/JsonSerializerTest.cs", "Src/Newtonsoft.Json/JsonReader.cs", "Src/Newtonsoft.Json/JsonSerializer.cs", "Src/Newtonsoft.Json/JsonSerializerSettings.cs"], "buggy_code_start_loc": [7997, 229, 517, 63], "buggy_code_end_loc": [7997, 329, 518, 333], "fixing_code_start_loc": [7998, 230, 517, 64], "fixing_code_end_loc": [8039, 333, 518, 334], "type": "CWE-755", "message": "Newtonsoft.Json before version 13.0.1 is affected by a mishandling of exceptional conditions vulnerability. Crafted data that is passed to the JsonConvert.DeserializeObject method may trigger a StackOverflow exception resulting in denial of service. Depending on the usage of the library, an unauthenticated and remote attacker may be able to cause the denial of service condition.\n", "other": {"cve": {"id": "CVE-2024-21907", "sourceIdentifier": "disclosure@vulncheck.com", "published": "2024-01-03T16:15:08.793", "lastModified": "2024-01-17T15:24:07.360", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Newtonsoft.Json before version 13.0.1 is affected by a mishandling of exceptional conditions vulnerability. Crafted data that is passed to the JsonConvert.DeserializeObject method may trigger a StackOverflow exception resulting in denial of service. Depending on the usage of the library, an unauthenticated and remote attacker may be able to cause the denial of service condition.\n"}, {"lang": "es", "value": "Newtonsoft.Json anterior a la versi\u00f3n 13.0.1 se ve afectado por una vulnerabilidad de manejo incorrecto de condiciones excepcionales. Los datos elaborados que se pasan al m\u00e9todo JsonConvert.DeserializeObject pueden desencadenar una excepci\u00f3n de StackOverflow que provoque una denegaci\u00f3n de servicio. Dependiendo del uso de la librer\u00eda, un atacante remoto y no autenticado puede provocar la condici\u00f3n de denegaci\u00f3n de servicio."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-755"}]}, {"source": "disclosure@vulncheck.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-755"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:newtonsoft:json.net:*:*:*:*:*:*:*:*", "versionEndExcluding": "13.0.1", "matchCriteriaId": "F7713CE4-2B29-46C2-8416-75B9F3C258F6"}]}]}], "references": [{"url": "https://alephsecurity.com/2018/10/22/StackOverflowException/", "source": "disclosure@vulncheck.com", "tags": ["Exploit"]}, {"url": "https://alephsecurity.com/vulns/aleph-2018004", "source": "disclosure@vulncheck.com", "tags": ["Exploit"]}, {"url": "https://github.com/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66", "source": "disclosure@vulncheck.com", "tags": ["Patch"]}, {"url": "https://github.com/JamesNK/Newtonsoft.Json/issues/2457", "source": "disclosure@vulncheck.com", "tags": ["Exploit", "Issue Tracking", "Third Party Advisory"]}, {"url": "https://github.com/JamesNK/Newtonsoft.Json/pull/2462", "source": "disclosure@vulncheck.com", "tags": ["Patch"]}, {"url": "https://github.com/advisories/GHSA-5crp-9r3c-p9vr", "source": "disclosure@vulncheck.com", "tags": ["Third Party Advisory"]}, {"url": "https://security.snyk.io/vuln/SNYK-DOTNET-NEWTONSOFTJSON-2774678", "source": "disclosure@vulncheck.com", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://vulncheck.com/advisories/vc-advisory-GHSA-5crp-9r3c-p9vr", "source": "disclosure@vulncheck.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66"}}