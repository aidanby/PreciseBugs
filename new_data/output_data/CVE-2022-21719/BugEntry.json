{"buggy_code": ["<?php\n/**\n * ---------------------------------------------------------------------\n * GLPI - Gestionnaire Libre de Parc Informatique\n * Copyright (C) 2015-2022 Teclib' and contributors.\n *\n * http://glpi-project.org\n *\n * based on GLPI - Gestionnaire Libre de Parc Informatique\n * Copyright (C) 2003-2014 by the INDEPNET Development Team.\n *\n * ---------------------------------------------------------------------\n *\n * LICENSE\n *\n * This file is part of GLPI.\n *\n * GLPI is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * GLPI is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with GLPI. If not, see <http://www.gnu.org/licenses/>.\n * ---------------------------------------------------------------------\n */\n\ninclude ('../inc/includes.php');\n\nif (isset($_GET['full_page_tab'])) {\n   Html::header('Only tab for debug', $_SERVER['PHP_SELF']);\n} else {\n   header(\"Content-Type: text/html; charset=UTF-8\");\n   Html::header_nocache();\n}\n\n// Not possible to check right for anonymous FAQ\n//Session::checkLoginUser();\n\nif (!isset($_GET['_glpi_tab'])) {\n   exit();\n}\n\nif (!isset($_GET['_itemtype']) || empty($_GET['_itemtype'])) {\n   exit();\n}\n\nif (!isset($_GET[\"sort\"])) {\n   $_GET[\"sort\"] = \"\";\n}\n\nif (!isset($_GET[\"order\"])) {\n   $_GET[\"order\"] = \"\";\n}\n\nif (!isset($_GET[\"withtemplate\"])) {\n   $_GET[\"withtemplate\"] = \"\";\n}\n\nif (isset($_GET['id']) && !empty($_GET['id'])) {\n   $_GET['id'] = (int)$_GET['id'];\n}\n\nif ($item = getItemForItemtype($_UGET['_itemtype'])) {\n   if ($item->get_item_to_display_tab) {\n      // No id if ruleCollection but check right\n      if ($item instanceof RuleCollection) {\n         if (!$item->canList()) {\n            exit();\n         }\n      } else if (!isset($_GET[\"id\"])|| $item->isNewID($_GET[\"id\"])) {\n         if (!$item->can(-1, CREATE, $_GET)) {\n            exit();\n         }\n      } else if (!$item->can($_GET[\"id\"], READ)) {\n         exit();\n      }\n   }\n}\n\nif (isset($_GET['_target'])) {\n   $_GET['_target'] = Toolbox::cleanTarget($_GET['_target']);\n}\n\n$tabs = Toolbox::getAvailablesTabs($_UGET['_itemtype'], $_GET['id'] ?? null);\nif (isset($tabs[$_GET['_glpi_tab']])) {\n   Session::setActiveTab($_UGET['_itemtype'], $_GET['_glpi_tab']);\n}\n\n$notvalidoptions = ['_glpi_tab', '_itemtype', 'sort', 'order', 'withtemplate', 'formoptions'];\n$options         = $_GET;\nforeach ($notvalidoptions as $key) {\n   if (isset($options[$key])) {\n      unset($options[$key]);\n   }\n}\nif (isset($options['locked'])) {\n   ObjectLock::setReadOnlyProfile();\n}\n\nCommonGLPI::displayStandardTab($item, $_UGET['_glpi_tab'], $_GET[\"withtemplate\"], $options);\n\n\nif (isset($_GET['full_page_tab'])) {\n   echo \"<div class='center' id='debugajax'>\";\n   echo \"<a href='\".htmlentities($_SERVER['REQUEST_URI']).\"' class='vsubmit'>Reload</a>\";\n   echo \"</div>\";\n\n   // I think that we should display this warning, because tabs are not prepare\n   // for being used full space ...\n   if (!isset($_SESSION['glpi_warned_about_full_page_tab'])) {\n      // Debug string : not really need translation.\n      $msg  = 'WARNING: full page tabs are only for debug/validation purpose !\\n';\n      $msg .= 'Actions on this page may have undefined result.';\n      echo \"<script type='text/javascript' >\\n\";\n      echo \"alert('$msg')\";\n      echo \"</script>\";\n      $_SESSION['glpi_warned_about_full_page_tab'] = true;\n   }\n\n   Html::footer();\n\n\n} else {\n   Html::ajaxFooter();\n}\n"], "fixing_code": ["<?php\n/**\n * ---------------------------------------------------------------------\n * GLPI - Gestionnaire Libre de Parc Informatique\n * Copyright (C) 2015-2022 Teclib' and contributors.\n *\n * http://glpi-project.org\n *\n * based on GLPI - Gestionnaire Libre de Parc Informatique\n * Copyright (C) 2003-2014 by the INDEPNET Development Team.\n *\n * ---------------------------------------------------------------------\n *\n * LICENSE\n *\n * This file is part of GLPI.\n *\n * GLPI is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * GLPI is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with GLPI. If not, see <http://www.gnu.org/licenses/>.\n * ---------------------------------------------------------------------\n */\n\ninclude ('../inc/includes.php');\n\nif (isset($_GET['full_page_tab'])) {\n   Html::header('Only tab for debug', $_SERVER['PHP_SELF']);\n} else {\n   header(\"Content-Type: text/html; charset=UTF-8\");\n   Html::header_nocache();\n}\n\n// Not possible to check right for anonymous FAQ\n//Session::checkLoginUser();\n\nif (!isset($_GET['_glpi_tab'])) {\n   exit();\n}\n\nif (!isset($_GET['_itemtype']) || empty($_GET['_itemtype'])) {\n   exit();\n}\n\nif (!isset($_GET[\"sort\"])) {\n   $_GET[\"sort\"] = \"\";\n}\n\nif (!isset($_GET[\"order\"])) {\n   $_GET[\"order\"] = \"\";\n}\n\nif (!isset($_GET[\"withtemplate\"])) {\n   $_GET[\"withtemplate\"] = \"\";\n}\n\nif (isset($_GET['id']) && !empty($_GET['id'])) {\n   $_GET['id'] = (int)$_GET['id'];\n}\n\nif ($item = getItemForItemtype($_UGET['_itemtype'])) {\n   if ($item->get_item_to_display_tab) {\n      // No id if ruleCollection but check right\n      if ($item instanceof RuleCollection) {\n         if (!$item->canList()) {\n            exit();\n         }\n      } else if (!isset($_GET[\"id\"])|| $item->isNewID($_GET[\"id\"])) {\n         if (!$item->can(-1, CREATE, $_GET)) {\n            exit();\n         }\n      } else if (!$item->can($_GET[\"id\"], READ)) {\n         exit();\n      }\n   }\n}\n\nif (isset($_GET['_target'])) {\n   $_GET['_target'] = Toolbox::cleanTarget($_GET['_target']);\n}\n\n$tabs = Toolbox::getAvailablesTabs($_UGET['_itemtype'], $_GET['id'] ?? null);\nif (isset($tabs[$_GET['_glpi_tab']])) {\n   Session::setActiveTab($_UGET['_itemtype'], $_GET['_glpi_tab']);\n}\n\n$notvalidoptions = ['_glpi_tab', '_itemtype', 'sort', 'order', 'withtemplate', 'formoptions'];\n$options         = $_GET;\nforeach ($notvalidoptions as $key) {\n   if (isset($options[$key])) {\n      unset($options[$key]);\n   }\n}\nif (isset($options['locked'])) {\n   ObjectLock::setReadOnlyProfile();\n}\n\nCommonGLPI::displayStandardTab($item, $_UGET['_glpi_tab'], $_GET[\"withtemplate\"], $options);\n\n\nif (isset($_GET['full_page_tab'])) {\n   // I think that we should display this warning, because tabs are not prepare\n   // for being used full space ...\n   if (!isset($_SESSION['glpi_warned_about_full_page_tab'])) {\n      // Debug string : not really need translation.\n      $msg  = 'WARNING: full page tabs are only for debug/validation purpose !\\n';\n      $msg .= 'Actions on this page may have undefined result.';\n      echo \"<script type='text/javascript' >\\n\";\n      echo \"alert('$msg')\";\n      echo \"</script>\";\n      $_SESSION['glpi_warned_about_full_page_tab'] = true;\n   }\n\n   Html::footer();\n\n\n} else {\n   Html::ajaxFooter();\n}\n"], "filenames": ["ajax/common.tabs.php"], "buggy_code_start_loc": [110], "buggy_code_end_loc": [114], "fixing_code_start_loc": [109], "fixing_code_end_loc": [109], "type": "CWE-79", "message": "GLPI is a free asset and IT management software package. All GLPI versions prior to 9.5.7 are vulnerable to reflected cross-site scripting. Version 9.5.7 contains a patch for this issue. There are no known workarounds.", "other": {"cve": {"id": "CVE-2022-21719", "sourceIdentifier": "security-advisories@github.com", "published": "2022-01-28T10:15:07.930", "lastModified": "2022-02-02T17:43:05.880", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "GLPI is a free asset and IT management software package. All GLPI versions prior to 9.5.7 are vulnerable to reflected cross-site scripting. Version 9.5.7 contains a patch for this issue. There are no known workarounds."}, {"lang": "es", "value": "GLPI es un paquete de software gratuito de administraci\u00f3n de activos y TI. Todas las versiones de GLPI anteriores a 9.5.7, son vulnerables a un ataque de tipo cross-site scripting reflejado. La versi\u00f3n 9.5.7 contiene un parche para este problema. No se presentan medidas de mitigaci\u00f3n conocidas"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:glpi-project:glpi:*:*:*:*:*:*:*:*", "versionEndExcluding": "9.5.7", "matchCriteriaId": "BAE5DB6A-EBA6-4A45-B874-9B1C7F0ABAC4"}]}]}], "references": [{"url": "https://github.com/glpi-project/glpi/commit/e9b16bc8e9b61ebb2d35b96b9c71cd25c5af9e48", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/glpi-project/glpi/releases/tag/9.5.7", "source": "security-advisories@github.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://github.com/glpi-project/glpi/security/advisories/GHSA-6cj4-g839-gj5j", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/glpi-project/glpi/commit/e9b16bc8e9b61ebb2d35b96b9c71cd25c5af9e48"}}