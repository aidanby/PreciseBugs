{"buggy_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Timeline event class for file attachment operations.\n * @copyright Copyright 2018 MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n * @package MantisBT\n */\n\nuse Mantis\\Exceptions\\ServiceException;\n\n/**\n * Timeline event class for file attachment operations.\n *\n * @package MantisBT\n * @subpackage classes\n */\nclass IssueAttachmentTimelineEvent extends TimelineEvent {\n\tprivate $issue_id;\n\tprivate $filename;\n\tprivate $type;\n\n\t/**\n\t * @param integer $p_timestamp Timestamp representing the time the event occurred.\n\t * @param integer $p_user_id   An user identifier.\n\t * @param integer $p_issue_id  A issue identifier.\n\t * @param string  $p_filename  Attachment's file name.\n\t * @param integer $p_type      Event type (FILE_ADDED, FILE_DELETED)\n\t */\n\tpublic function __construct( $p_timestamp, $p_user_id, $p_issue_id, $p_filename, $p_type ) {\n\t\tparent::__construct( $p_timestamp, $p_user_id );\n\n\t\t$this->issue_id = $p_issue_id;\n\t\t$this->filename = $p_filename;\n\t\t$this->type = $p_type;\n\t}\n\n\t/**\n\t * Returns html string to display\n\t * @return string\n\t * @throws Mantis\\Exceptions\\ServiceException\n\t */\n\tpublic function html() {\n\t\tswitch( $this->type ) {\n\t\t\tcase FILE_ADDED:\n\t\t\t\t$t_string = 'timeline_issue_file_added';\n\t\t\t\tbreak;\n\t\t\tcase FILE_DELETED:\n\t\t\t\t$t_string = 'timeline_issue_file_deleted';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ServiceException( 'Unknown Event Type', ERROR_GENERIC );\n\t\t}\n\n\t\t$t_bug_link = string_get_bug_view_link( $this->issue_id );\n\n\t\t$t_html = $this->html_start( 'fa-file-o' );\n\t\t$t_html .= '<div class=\"action\">'\n\t\t\t. sprintf( lang_get( $t_string ),\n\t\t\t\tprepare_user_name( $this->user_id ),\n\t\t\t\t$t_bug_link,\n\t\t\t\t$this->filename\n\t\t\t)\n\t\t\t. '</div>';\n\t\t$t_html .= $this->html_end();\n\n\t\treturn $t_html;\n\t}\n}\n"], "fixing_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Timeline event class for file attachment operations.\n * @copyright Copyright 2018 MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n * @package MantisBT\n */\n\nuse Mantis\\Exceptions\\ServiceException;\n\n/**\n * Timeline event class for file attachment operations.\n *\n * @package MantisBT\n * @subpackage classes\n */\nclass IssueAttachmentTimelineEvent extends TimelineEvent {\n\tprivate $issue_id;\n\tprivate $filename;\n\tprivate $type;\n\n\t/**\n\t * @param integer $p_timestamp Timestamp representing the time the event occurred.\n\t * @param integer $p_user_id   An user identifier.\n\t * @param integer $p_issue_id  A issue identifier.\n\t * @param string  $p_filename  Attachment's file name.\n\t * @param integer $p_type      Event type (FILE_ADDED, FILE_DELETED)\n\t */\n\tpublic function __construct( $p_timestamp, $p_user_id, $p_issue_id, $p_filename, $p_type ) {\n\t\tparent::__construct( $p_timestamp, $p_user_id );\n\n\t\t$this->issue_id = $p_issue_id;\n\t\t$this->filename = $p_filename;\n\t\t$this->type = $p_type;\n\t}\n\n\t/**\n\t * Returns html string to display\n\t * @return string\n\t * @throws Mantis\\Exceptions\\ServiceException\n\t */\n\tpublic function html() {\n\t\tswitch( $this->type ) {\n\t\t\tcase FILE_ADDED:\n\t\t\t\t$t_string = 'timeline_issue_file_added';\n\t\t\t\tbreak;\n\t\t\tcase FILE_DELETED:\n\t\t\t\t$t_string = 'timeline_issue_file_deleted';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new ServiceException( 'Unknown Event Type', ERROR_GENERIC );\n\t\t}\n\n\t\t$t_bug_link = string_get_bug_view_link( $this->issue_id );\n\n\t\t$t_html = $this->html_start( 'fa-file-o' );\n\t\t$t_html .= '<div class=\"action\">'\n\t\t\t. sprintf( lang_get( $t_string ),\n\t\t\t\tprepare_user_name( $this->user_id ),\n\t\t\t\t$t_bug_link,\n\t\t\t\tstring_html_specialchars( $this->filename )\n\t\t\t)\n\t\t\t. '</div>';\n\t\t$t_html .= $this->html_end();\n\n\t\treturn $t_html;\n\t}\n}\n"], "filenames": ["core/classes/IssueAttachmentTimelineEvent.class.php"], "buggy_code_start_loc": [76], "buggy_code_end_loc": [77], "fixing_code_start_loc": [76], "fixing_code_end_loc": [77], "type": "CWE-79", "message": "The Timeline feature in my_view_page.php in MantisBT through 2.21.1 has a stored cross-site scripting (XSS) vulnerability, allowing execution of arbitrary code (if CSP settings permit it) after uploading an attachment with a crafted filename. The code is executed for any user having visibility to the issue, whenever My View Page is displayed.", "other": {"cve": {"id": "CVE-2019-15074", "sourceIdentifier": "cve@mitre.org", "published": "2019-08-21T19:15:13.920", "lastModified": "2019-09-04T13:24:51.907", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The Timeline feature in my_view_page.php in MantisBT through 2.21.1 has a stored cross-site scripting (XSS) vulnerability, allowing execution of arbitrary code (if CSP settings permit it) after uploading an attachment with a crafted filename. The code is executed for any user having visibility to the issue, whenever My View Page is displayed."}, {"lang": "es", "value": "La funci\u00f3n de l\u00ednea de tiempo en my_view_page.php en MantisBT a trav\u00e9s de la versi\u00f3n 2.21.1 tiene una vulnerabilidad de cross-site scripting (XSS) almacenada, lo que permite la ejecuci\u00f3n de c\u00f3digo arbitrario (si la configuraci\u00f3n de CSP lo permite) despu\u00e9s de cargar un archivo adjunto con un nombre de archivo creado. El c\u00f3digo se ejecuta para cualquier usuario que tenga visibilidad del problema, siempre que se muestre Mi p\u00e1gina de vista."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mantisbt:mantisbt:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.13.0", "versionEndIncluding": "2.21.1", "matchCriteriaId": "EB23C4D0-8FC1-4852-8810-F6DE17109BF5"}]}]}], "references": [{"url": "https://github.com/mantisbt/mantisbt/commit/9cee1971c498bbe0a72bca1c773fae50171d8c27", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://mantisbt.org/bugs/view.php?id=25995", "source": "cve@mitre.org", "tags": ["Exploit", "Issue Tracking", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/mantisbt/mantisbt/commit/9cee1971c498bbe0a72bca1c773fae50171d8c27"}}