{"buggy_code": ["<?php\n\n/**\n * Pimcore\n *\n * This source file is available under two different licenses:\n * - GNU General Public License version 3 (GPLv3)\n * - Pimcore Commercial License (PCL)\n * Full copyright and license information is available in\n * LICENSE.md which is distributed with this source code.\n *\n *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)\n *  @license    http://www.pimcore.org/license     GPLv3 and PCL\n */\n\nnamespace CustomerManagementFrameworkBundle\\Controller\\Admin;\n\nuse CustomerManagementFrameworkBundle\\GDPR\\DataProvider\\Customers;\nuse Pimcore\\Controller\\Traits\\JsonHelperTrait;\nuse Pimcore\\Controller\\UserAwareController;\nuse Pimcore\\Model\\DataObject\\AbstractObject;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\n\n/**\n * Class DataObjectController\n *\n * @Route(\"/gdpr-data\")\n */\nclass GDPRDataController extends UserAwareController\n{\n    use JsonHelperTrait;\n\n    /**\n     * @Route(\"/search-data-objects\", name=\"_pimcore_customermanagementframework_gdprdata_searchdataobjects\", methods={\"GET\"})\n     */\n    public function searchDataObjectsAction(Request $request, Customers $service): JsonResponse\n    {\n        $allParams = array_merge($request->request->all(), $request->query->all());\n\n        $result = $service->searchData(\n            intval($allParams['id']),\n            strip_tags($allParams['firstname']),\n            strip_tags($allParams['lastname']),\n            strip_tags($allParams['email']),\n            intval($allParams['start']),\n            intval($allParams['limit']),\n            $allParams['sort'] ?? null\n        );\n\n        return $this->jsonResponse($result);\n    }\n\n    /**\n     * @Route(\"/export\", name=\"_pimcore_customermanagementframework_gdprdata_export\", methods={\"GET\"})\n     */\n    public function exportDataObjectAction(Request $request, Customers $service): JsonResponse\n    {\n        $object = AbstractObject::getById($request->query->getInt('id'));\n        $exportResult = $service->doExportData($object);\n        $jsonResponse = $this->jsonResponse($exportResult);\n        $jsonResponse->headers->set('Content-Disposition', 'attachment; filename=\"export-data-object-' . $object->getId() . '.json\"');\n\n        return $jsonResponse;\n    }\n}\n"], "fixing_code": ["<?php\n\n/**\n * Pimcore\n *\n * This source file is available under two different licenses:\n * - GNU General Public License version 3 (GPLv3)\n * - Pimcore Commercial License (PCL)\n * Full copyright and license information is available in\n * LICENSE.md which is distributed with this source code.\n *\n *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)\n *  @license    http://www.pimcore.org/license     GPLv3 and PCL\n */\n\nnamespace CustomerManagementFrameworkBundle\\Controller\\Admin;\n\nuse CustomerManagementFrameworkBundle\\GDPR\\DataProvider\\Customers;\nuse Pimcore\\Controller\\KernelControllerEventInterface;\nuse Pimcore\\Controller\\Traits\\JsonHelperTrait;\nuse Pimcore\\Controller\\UserAwareController;\nuse Pimcore\\Model\\DataObject\\AbstractObject;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpKernel\\Event\\ControllerEvent;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\n\n/**\n * Class DataObjectController\n *\n * @Route(\"/gdpr-data\")\n */\nclass GDPRDataController extends UserAwareController implements KernelControllerEventInterface\n{\n    use JsonHelperTrait;\n\n    public function onKernelControllerEvent(ControllerEvent $event): void\n    {\n        $this->checkPermission('gdpr_data_extractor');\n    }\n\n    /**\n     * @Route(\"/search-data-objects\", name=\"_pimcore_customermanagementframework_gdprdata_searchdataobjects\", methods={\"GET\"})\n     */\n    public function searchDataObjectsAction(Request $request, Customers $service): JsonResponse\n    {\n        $allParams = array_merge($request->request->all(), $request->query->all());\n\n        $result = $service->searchData(\n            intval($allParams['id']),\n            strip_tags($allParams['firstname']),\n            strip_tags($allParams['lastname']),\n            strip_tags($allParams['email']),\n            intval($allParams['start']),\n            intval($allParams['limit']),\n            $allParams['sort'] ?? null\n        );\n\n        return $this->jsonResponse($result);\n    }\n\n    /**\n     * @Route(\"/export\", name=\"_pimcore_customermanagementframework_gdprdata_export\", methods={\"GET\"})\n     */\n    public function exportDataObjectAction(Request $request, Customers $service): JsonResponse\n    {\n        $object = AbstractObject::getById($request->query->getInt('id'));\n        $exportResult = $service->doExportData($object);\n        $jsonResponse = $this->jsonResponse($exportResult);\n        $jsonResponse->headers->set('Content-Disposition', 'attachment; filename=\"export-data-object-' . $object->getId() . '.json\"');\n\n        return $jsonResponse;\n    }\n}\n"], "filenames": ["src/Controller/Admin/GDPRDataController.php"], "buggy_code_start_loc": [18], "buggy_code_end_loc": [33], "fixing_code_start_loc": [19], "fixing_code_end_loc": [41], "type": "CWE-284", "message": "pimcore/customer-data-framework is the Customer Management Framework for management of customer data within Pimcore. An authenticated and unauthorized user can access the GDPR data extraction feature and query over the information returned, leading to customer data exposure. Permissions are not enforced when reaching the `/admin/customermanagementframework/gdpr-data/search-data-objects` endpoint allowing an authenticated user without the permissions to access the endpoint and query the data available there. An unauthorized user can access PII data from customers. This vulnerability has been patched in version 4.0.6.\n", "other": {"cve": {"id": "CVE-2024-21667", "sourceIdentifier": "security-advisories@github.com", "published": "2024-01-11T01:15:45.810", "lastModified": "2024-01-18T13:12:45.593", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "pimcore/customer-data-framework is the Customer Management Framework for management of customer data within Pimcore. An authenticated and unauthorized user can access the GDPR data extraction feature and query over the information returned, leading to customer data exposure. Permissions are not enforced when reaching the `/admin/customermanagementframework/gdpr-data/search-data-objects` endpoint allowing an authenticated user without the permissions to access the endpoint and query the data available there. An unauthorized user can access PII data from customers. This vulnerability has been patched in version 4.0.6.\n"}, {"lang": "es", "value": "pimcore/customer-data-framework es el Customer Management Framework para la gesti\u00f3n de datos de clientes dentro de Pimcore. Un usuario autenticado y no autorizado puede acceder a la funci\u00f3n de extracci\u00f3n de datos del RGPD y consultar la informaci\u00f3n devuelta, lo que lleva a la exposici\u00f3n de los datos del cliente. Los permisos no se aplican al llegar al endpoint `/admin/customermanagementframework/gdpr-data/search-data-objects`, lo que permite a un usuario autenticado sin permisos acceder al endpoint y consultar los datos disponibles all\u00ed. Un usuario no autorizado puede acceder a los datos PII de los clientes. Esta vulnerabilidad ha sido parcheada en la versi\u00f3n 4.0.6."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-284"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pimcore:customer_management_framework:*:*:*:*:*:pimcore:*:*", "versionEndExcluding": "4.0.6", "matchCriteriaId": "09473711-86C6-485C-B865-015EEF9172BE"}]}]}], "references": [{"url": "https://github.com/pimcore/customer-data-framework/blob/b4af625ef327c58d05ef7cdf145fa749d2d4195e/src/Controller/Admin/GDPRDataController.php#L38", "source": "security-advisories@github.com", "tags": ["Issue Tracking"]}, {"url": "https://github.com/pimcore/customer-data-framework/commit/6c34515be2ba39dceee7da07a1abf246309ccd77", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/pimcore/customer-data-framework/security/advisories/GHSA-g273-wppx-82w4", "source": "security-advisories@github.com", "tags": ["Exploit", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/pimcore/customer-data-framework/commit/6c34515be2ba39dceee7da07a1abf246309ccd77"}}