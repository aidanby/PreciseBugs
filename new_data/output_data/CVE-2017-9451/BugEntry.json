{"buggy_code": ["<?php\n\n//prohibit unauthorized access\nrequire 'core/access.php';\n\necho '<h3>System</h3>';\n\necho '<div class=\"row\">';\n\necho '<div class=\"col-md-4\">';\necho '<h5>Config</h5>';\necho '<dl class=\"dl-horizontal\">';\necho '<dt>Server:</dt><dd>' . $_SERVER['SERVER_NAME'] . ' (PHP '.phpversion().')</dd>';\nif($prefs_mailer_adr != '') {\n\techo '<dt>System E-Mails:</dt><dd>' . $prefs_mailer_adr . '</dd>';\n} else {\n\techo '<dt>System E-Mails:</dt><dd><span class=\"text-danger\">'.$lang['missing_value'].'</span></dd>';\n}\nif($prefs_mailer_name != '') {\n\techo '<dt>E-Mail Name:</dt><dd>' . $prefs_mailer_name . '</dd>';\n} else {\n\techo '<dt>E-Mail Name:</dt><dd><span class=\"text-danger\">'.$lang['missing_value'].'</span></dd>';\n}\necho '</dl>';\n\n\necho '<hr>';\n\necho '<h4>' . $lang['f_user_drm'] . '</h4>';\n\n\necho\"<p><span class='glyphicon glyphicon-user'></span> $_SESSION[user_firstname] $_SESSION[user_lastname] ($_SESSION[user_nick])</p>\";\n\n$list_str = '<ul class=\"list-unstyled\" style=\"padding-left:16px;\">';\n\nif($_SESSION['acp_pages'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_pages]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_pages]</li>\";\n}\n\nif($_SESSION['acp_editpages'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_editpages]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_editpages]</li>\";\n}\n\nif($_SESSION['acp_editownpages'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_editownpages]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_editownpages]</li>\";\n}\n\nif($_SESSION['acp_files'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_files]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_files]</li>\";\n}\n\nif($_SESSION['acp_user'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_user]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_files]</li>\";\n}\n\nif($_SESSION['acp_system'] == \"allowed\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_system]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_files]</li>\";\n}\n\nif($_SESSION['drm_can_publish'] == \"true\") {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-ok-circle'></span> $lang[drm_user_can_publish]</li>\";\n} else {\n\t$list_str .= \"<li><span class='glyphicon glyphicon-remove-circle'></span> $lang[drm_user_can_publish]</li>\";\n}\n\n\n$list_str .= \"</ul>\";\n\necho $list_str;\n\n\necho '</div>';\n\n\necho '<div class=\"col-md-8\">';\n\necho '<ul class=\"nav nav-tabs\" id=\"bsTabs\">';\necho '<li class=\"active\"><a href=\"#chat\" data-toggle=\"tab\"><span class=\"glyphicon glyphicon-comment\"></span> CHAT</a></li>';\necho '<li><a href=\"#log\" data-toggle=\"tab\"><span class=\"glyphicon glyphicon-list-alt\"></span> PROTOKOLL</a></li>';\necho '</ul>';\n\necho '<div class=\"tab-content\">';\n\necho'<div class=\"tab-pane fade in active\" id=\"chat\">';\n\n$chat_form = file_get_contents('templates/comment-form.tpl');\n\n$e_comment_text = '';\n$e_comment_id = '';\n\nif(isset($_GET['dcid'])) {\n\t$delete_comment_id = (int) $_GET['dcid'];\n\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$query = \"DELETE FROM fc_comments WHERE comment_id = :comment_id\";\n\t$sth = $dbh -> prepare($query);\n\t$sth -> bindParam(':comment_id', $delete_comment_id, PDO::PARAM_STR);\n\t$sth->execute();\n\t$dbh = null;\n\t\n}\n\nif(isset($_GET['cid'])) {\n\t$get_comment = fc_get_comment($_GET['cid']);\n\t$e_comment_text = $get_comment['comment_text'];\n\t$e_comment_id = $get_comment['comment_id'];\n\tif($_SESSION['user_nick'] != $get_comment['comment_author']) {\n\t\t//you can't edit others entries\n\t\tunset($e_comment_text,$e_comment_id);\n\t}\n}\n\n\n\n$chat_form = str_replace('{form_action}', \"acp.php?tn=dashboard\", $chat_form);\n$chat_form = str_replace('{value_textarea}', \"$e_comment_text\", $chat_form);\n$chat_form = str_replace('{value_send_btn}', $lang['save'], $chat_form);\n$chat_form = str_replace('{value_hidden_id}', \"$e_comment_id\", $chat_form);\n$chat_form = str_replace('{token}', $_SESSION['token'], $chat_form);\n$chat_form = str_replace('{form_legend}', $lang['label_comment'], $chat_form);\n\n$comment_entry_tpl = file_get_contents('templates/comment-entry.tpl');\n\necho '<div class=\"scroll-conatiner\" id=\"inlineComments\">';\n\necho $chat_form;\n\nif(isset($_POST['comment'])) {\n\tif(is_numeric($_POST['id'])) {\n\t\tfc_write_comment($_SESSION['user_nick'], $_POST['comment'], \"c\", $_POST['id']);\n\t} else {\n\t\tfc_write_comment($_SESSION['user_nick'], $_POST['comment'], \"c\");\n\t}\n}\n\n$comments = fc_get_comments('c');\n$cnt_comment = count($comments);\n\nfor($i=0;$i<$cnt_comment;$i++) {\n\n\t$comment_time = date(\"d.m.Y H:i:s\", $comments[$i]['comment_time']);\n\t$comment_author = $comments[$i]['comment_author'];\n\t$comment_text = nl2br($comments[$i]['comment_text']);\n\t$comment_id = $comments[$i]['comment_id'];\n\t\n\t$author_avatar_path = '../'. FC_CONTENT_DIR . '/avatars/' . md5($comment_author) . '.png';\n\t$author_avatar = '<img src=\"images/avatar.png\" class=\"img-circle avatar\" width=\"64\" height=\"64\">';\n\tif(is_file(\"$author_avatar_path\")) {\n\t\t$author_avatar = '<img src=\"'.$author_avatar_path.'\" class=\"img-circle avatar\" width=\"64\" height=\"64\">';\n\t}\n\t\n\tunset($show_entry);\n\t\n\tif($_SESSION['user_nick'] == $comment_author) {\n\t\t$show_entry = str_replace('{entry_edit_btn}', '<a class=\"btn btn-primary btn-xs\" href=\"acp.php?tn=dashboard&cid='.$comment_id.'\">'.$lang['edit'].'</a>', $comment_entry_tpl);\n\t\t$show_entry = str_replace('{entry_delete_btn}', '<a class=\"btn btn-danger btn-xs\" href=\"acp.php?tn=dashboard&dcid='.$comment_id.'\"><span class=\"glyphicon glyphicon-trash\"></span></a>', $show_entry);\n\t} else {\n\t\t$show_entry = str_replace('{entry_edit_btn}', '', $comment_entry_tpl);\n\t\t$show_entry = str_replace('{entry_delete_btn}', '', $show_entry);\n\t}\n\t$show_entry = str_replace('{comment_avatar}', $author_avatar, $show_entry);\n\t$show_entry = str_replace('{comment_author}', $comment_author, $show_entry);\n\t$show_entry = str_replace('{comment_time}', $comment_time, $show_entry);\n\t$show_entry = str_replace('{comment_text}', $comment_text, $show_entry);\n\t\n\techo $show_entry;\n}\n\necho'</div>';\n\necho'</div>'; // #chat\necho'<div class=\"tab-pane fade\" id=\"log\">';\n\necho '<div class=\"scroll-container\">';\nshow_log(10);\necho'</div>';\necho'</div>'; // #log\n\necho'</div>'; // .tab-content\n\necho'</div>';\n\n\necho'</div>';\n\n\n\n\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire 'core/access.php';\n\n\nif(isset($_POST['saveDesign'])) {\n\n\t// all incoming data -> strip_tags\n\tforeach($_POST as $key => $val) {\n\t\t$$key = @strip_tags($val); \n\t}\n\t\n\t// template\n\t$select_template = explode(\"<|-|>\", $_POST['select_template']);\n\t$prefs_template = $select_template[0];\n\t$prefs_template_layout = $select_template[1];\n\t\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t\n\t$pdo_fields = array(\n\t\t'prefs_template' => 'STR',\n\t\t'prefs_template_layout' => 'STR'\n\t);\n\n\t$sql = generate_sql_update_str($pdo_fields,\"fc_preferences\",\"WHERE prefs_id = 1\");\n\t$sth = $dbh->prepare($sql);\n\n\tgenerate_bindParam_str($pdo_fields,$sth);\n\t$sth->bindParam(':prefs_template', $prefs_template, PDO::PARAM_STR);\n\t$sth->bindParam(':prefs_template_layout', $prefs_template_layout, PDO::PARAM_STR);\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$sys_message = \"{OKAY} $lang[db_changed]\";\n\t\trecord_log($_SESSION['user_nick'],\"edit system design <b>$prefs_template</b>\",\"6\");\n\t} else {\n\t\t$sys_message = \"{ERROR} $lang[db_not_changed]\";\n\t\trecord_log($_SESSION['user_nick'],\"error on saving system design\",\"11\");\n\t}\n\n}\n\nif($sys_message != \"\"){\n\tprint_sysmsg(\"$sys_message\");\n}\n\necho '<form action=\"'.$_SERVER['PHP_SELF'].'?tn=moduls&sub=t\" method=\"POST\" class=\"form-horizontal\">';\necho '<fieldset>';\necho '<legend>'.$lang['f_prefs_layout'].'</legend>';\n\n\n$arr_Styles = get_all_templates();\n\n$select_prefs_template = '<select name=\"select_template\" class=\"form-control\">';\n\n\n/* templates list */\nforeach($arr_Styles as $template) {\n\n\t$arr_layout_tpl = glob(\"../styles/$template/templates/layout*.tpl\");\n\t\n\t$select_prefs_template .= \"<optgroup label='$template'>\";\n\t\n\tforeach($arr_layout_tpl as $layout_tpl) {\n\t\t$layout_tpl = basename($layout_tpl);\n\t\t\n\t\t$selected = \"\";\n\t\tif($template == \"$prefs_template\" && $layout_tpl == \"$prefs_template_layout\") {\n\t\t\t$selected = \"selected\";\n\t\t}\n\t\t$select_prefs_template .= \"<option $selected value='$template<|-|>$layout_tpl'>$template \u00bb $layout_tpl</option>\";\n\t}\n\t$select_prefs_template .= '</optgroup>';\n\n}\n\n$select_prefs_template .= '</select>';\n\necho tpl_form_control_group('',$lang['f_prefs_active_template'],$select_prefs_template);\n\n\necho '<div class=\"formfooter\">';\necho '<input type=\"submit\" class=\"btn btn-success\" name=\"saveDesign\" value=\"'.$lang['save'].'\">';\necho '</div>';\n\necho '<input type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\n\necho '</fieldset>';\necho '</form>';\n\n\n/**\n * theme options\n */\n\necho '<fieldset>';\necho '<legend>'.$prefs_template.'</legend>';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-9\">';\n\nif(is_file(\"../styles/$prefs_template/php/options.php\")) {\n\tinclude(\"../styles/$prefs_template/php/options.php\");\n}\n\necho '</div>';\necho '<div class=\"col-md-3\">';\n\nif(is_file(\"../styles/$prefs_template/images/preview.png\")) {\n\techo '<img src=\"../styles/'.$prefs_template.'/images/preview.png\" class=\"img-responsive img-rounded\">';\n}\n\necho '<table class=\"table table-condensed\">';\nif(is_file('../styles/'.$prefs_template.'/info.xml')) {\n\t$theme_xml = simplexml_load_file('../styles/'.$prefs_template.'/info.xml');\n\t//print_r($info_xml);\n\t\n\techo '<tr>';\n\techo '<td>Theme:</td>';\n\techo '<td>' . $theme_xml->name . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>Version:</td>';\n\techo '<td>' . $theme_xml->version . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>License:</td>';\n\techo '<td>' . $theme_xml->license . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>Author:</td>';\n\techo '<td>' . $theme_xml->author . '</td>';\n\techo '</tr>';\n\tif($theme_xml->author_url != '') {\n\t\techo '<tr>';\n\t\techo '<td>URL:</td>';\n\t\techo '<td><a href=\"'.$theme_xml->author_url.'\">' . $theme_xml->author_url . '</a></td>';\n\t\techo '</tr>';\t\t\n\t}\n\techo '<tr>';\n\techo '<td>Requires</td>';\n\techo '<td>';\n\tforeach ($theme_xml->requires -> core as $requires) {\n\t    switch((string) $requires['type']) {\n\t    case 'min':\n\t        echo 'min: ' . $requires . '<br>';\n\t        break;\n\t    case 'max':\n\t        echo 'max: ' . ($requires > 0 ? $requires : 'unknown');\n\t        break;\n\t    }\n\t}\n\techo '</td>';\n\techo '<tr>';\n}\necho '</table>';\n\necho '</div>';\necho '</div>';\n\n\necho '</fieldset>';\n\n\n?>", "<?php\n//prohibit unauthorized access\nrequire 'core/access.php';\n\n\necho\"\\n <form id='editpage' action='$_SERVER[PHP_SELF]?tn=pages&sub=edit&editpage=$editpage' class='form-horizontal' method='POST'>\\n\";\n\n$custom_fields = get_custom_fields();\nsort($custom_fields);\n$cnt_custom_fields = count($custom_fields);\necho '<div class=\"row\" style=\"margin-right:0;\">';\necho '<div class=\"col-lg-9 col-md-8 col-sm-12\">';\n\necho '<ul class=\"nav nav-tabs\" id=\"bsTabs\">';\necho '<li class=\"active\"><a href=\"#info\" data-toggle=\"tab\">'.$lang['tab_info'].'</a></li>';\necho '<li><a href=\"#content\" data-toggle=\"tab\">'.$lang['tab_content'].'</a></li>';\necho '<li><a href=\"#extracontent\" data-toggle=\"tab\">'.$lang['tab_extracontent'].'</a></li>';\necho '<li><a href=\"#meta\" data-toggle=\"tab\">'.$lang['tab_meta'].'</a></li>';\necho '<li><a href=\"#head\" data-toggle=\"tab\">'.$lang['tab_head'].'</a></li>';\nif($cnt_custom_fields > 0) {\n\techo '<li><a href=\"#custom\" data-toggle=\"tab\">'.$lang['legend_custom_fields'].'</a></li>';\n}\necho '</ul>';\n\n\necho '<div class=\"tab-content\">';\n\n/* tab_info */\necho'<div class=\"tab-pane fade in active\" id=\"info\">';\n\n$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n$sql = \"SELECT page_linkname, page_sort, page_title, page_language FROM fc_pages\n\t\t    WHERE page_sort != 'portal'\n\t\t    ORDER BY page_language ASC, page_sort ASC\t\";\n$all_pages = $dbh->query($sql)->fetchAll();\n\n$dbh = null;\n\n$all_pages = fc_array_multisort($all_pages, 'page_language', SORT_ASC, 'page_sort', SORT_ASC, SORT_NATURAL);\n\n\n$select_page_position  = '<select name=\"page_position\" class=\"form-control\">';\n$select_page_position .= '<option value=\"null\">' . $lang['legend_unstructured_pages'] . '</option>';\n\n\nif($page_sort == \"portal\") {\n\t$select_page_position .= '<option value=\"portal\" selected>' . $lang['f_homepage'] . '</option>';\n} else {\n\t$select_page_position .= '<option value=\"portal\">' . $lang['f_homepage'] . '</option>';\n}\n\nif(ctype_digit($page_sort)) {\n\t$select_page_position .= '<option value=\"mainpage\" selected>'.$lang['f_mainpage'].'</option>';\n} else {\n\t$select_page_position .= '<option value=\"mainpage\">'.$lang['f_mainpage'].'</option>';\n}\n\n$select_page_position .= '<optgroup label=\"'.$lang['f_subpage'].'\">';\nfor($i=0;$i<count($all_pages);$i++) {\n\n\tif($all_pages[$i]['page_sort'] == $page_sort) {\n\t\tcontinue;\n\t}\n\t\n\tif($all_pages[$i]['page_sort'] == \"\") {\n\t\tcontinue;\n\t}\n\t\n\tif($pos = strripos($page_sort,\".\")) {\n\t\t$string = substr($page_sort,0,$pos);\n\t}\n\t\t \n\t\t $parent_string = $all_pages[$i]['page_sort'];\n\t\t \n\t\t unset($selected);\n\t\t if($parent_string != \"\" && $parent_string == \"$string\") {\n\t\t \t$selected = \"selected\";\n\t\t }\n\t\t \n\t$short_title = first_words($all_pages[$i]['page_title'], 6);\n\t$indent = str_repeat(\"-\",substr_count($parent_string,'.'));\n\t$select_page_position .= \"<option value='$parent_string' $selected> $indent \" . $all_pages[$i]['page_sort'] . ' - ' .$all_pages[$i]['page_linkname'] . ' - ' . $short_title .\"</option>\";\n\t\n}\n$select_page_position .= '</optgroup>';\n$select_page_position .= '</select>';\n\necho tpl_form_control_group('',$lang['f_page_position'],$select_page_position);\n\nif($page_sort != \"portal\") {\n\n\t$page_order = substr (strrchr ($page_sort, \".\"), 1);\n\tif(ctype_digit($page_sort)) {\n\t\t$page_order = $page_sort;\n\t}\n\t\n\techo tpl_form_control_group('',$lang['f_page_order'],\"<input class='form-control' type='text' name='page_order' value='$page_order'>\");\n\t\n\n}\n\necho '<hr>';\necho tpl_form_control_group('',$lang['f_page_linkname'],'<input class=\"form-control\" type=\"text\" name=\"page_linkname\" value=\"'.$page_linkname.'\">');\necho tpl_form_control_group('',$lang['f_page_permalink'],\"<input class='form-control' type='text' name='page_permalink' value='$page_permalink'>\");\n\nif(empty($page_permalink_short_cnt)) {\n\t$page_permalink_short_cnt = 0;\n}\n\necho '<div class=\"form-group\">';\necho '<label class=\"control-label control-label-normal col-md-2\">'.$lang['f_page_permalink_short'].'</label>';\necho '<div class=\"col-sm-10\">';\necho '<div class=\"input-group\">';\necho '<input class=\"form-control\" type=\"text\" name=\"page_permalink_short\" value=\"'.$page_permalink_short.'\">';\necho '<span class=\"input-group-addon\">'.$page_permalink_short_cnt.'</span>';\necho '</div>';\necho '</div>';\necho '</div>';\n\necho tpl_form_control_group('',$lang['f_page_hash'],\"<input class='form-control' type='text' name='page_hash' value='$page_hash'>\");\n\n$select_page_redirect_code  = '<select name=\"page_redirect_code\" class=\"form-control\">';\nif($page_redirect_code == '') {\n\t$page_redirect_code = 301;\n}\nfor($i=0;$i<10;$i++) {\n\t$redirect_code = 300+$i;\n\tunset($sel_page_redirect_code);\n\tif($page_redirect_code == $redirect_code) {\n\t\t$sel_page_redirect_code = 'selected';\n\t}\n\t$select_page_redirect_code .= '<option value=\"'.$redirect_code.'\" '.$sel_page_redirect_code.'>'.$redirect_code.'</option>';\n}\n$select_page_redirect_code .= '</select>';\n\necho tpl_form_control_group('',$lang['f_page_redirect'],'<div class=\"row\"><div class=\"col-md-3\">'.$select_page_redirect_code.'</div><div class=\"col-md-9\"><input class=\"form-control\" type=\"text\" name=\"page_redirect\" value=\"'.$page_redirect.'\"></div></div>');\n\necho'</div>'; /* EOL tab_info */\n\n\n/* tab_content */\necho'<div class=\"tab-pane fade\" id=\"content\">';\n\necho '<textarea name=\"page_content\" class=\"form-control mceEditor textEditor switchEditor\" id=\"textEditor\">'.$page_content.'</textarea>';\n\necho\"</div>\";\n/* EOL tab_content */\n\n\n/* tab_extracontent */\n\necho'<div class=\"tab-pane fade\" id=\"extracontent\">';\n\necho '<textarea name=\"page_extracontent\" class=\"form-control mceEditor textEditor switchEditor\" id=\"textEditor2\">'.$page_extracontent.'</textarea>';\n\necho\"</div>\"; /* EOL tab_extracontent */\n\n\n\n/* tab_meta */\necho'<div class=\"tab-pane fade\" id=\"meta\">';\n\necho tpl_form_control_group('',$lang['f_page_title'],'<input class=\"form-control\" type=\"text\" name=\"page_title\" value=\"'.$page_title.'\">');\n\nif($page_meta_author == \"\") {\n\t$page_meta_author = $_SESSION['user_firstname'] .' '. $_SESSION['user_lastname'];\n}\n\necho tpl_form_control_group('',$lang['f_meta_author'],'<input class=\"form-control\" type=\"text\" name=\"page_meta_author\" value=\"'.$page_meta_author.'\">');\necho tpl_form_control_group('',$lang['f_meta_keywords'],'<input class=\"form-control\" type=\"text\" name=\"page_meta_keywords\" value=\"'.$page_meta_keywords.'\" data-role=\"tagsinput\">');\necho tpl_form_control_group('',$lang['f_meta_description'],\"<textarea name='page_meta_description' class='form-control cntValues' rows='5'>$page_meta_description</textarea>\");\n\n\necho\"<div class='form-group'>\n\t\t<label class='control-label control-label-normal col-sm-2'>$lang[page_thumbnail]</label>\n\t\t<div class='col-sm-10'>\";\n\t\t\necho '<div class=\"scroll-container\">';\necho '<select name=\"page_thumbnail\" class=\"form-control image-picker\">';\necho \"<option value=''>$lang[page_thumbnail]</option>\";\n$arr_Images = get_all_images();\n\tforeach($arr_Images as $page_thumbnails) {\n\t\t$selected = \"\";\n\t\tif($page_thumbnail == \"$page_thumbnails\") {\n\t\t\t$selected = \"selected\";\n\t\t}\n\t\techo '<option '.$selected.' data-img-src=\"/content/images/'.$page_thumbnails.'\" class=\"masonry-item\" value=\"'.$page_thumbnails.'\">'.$page_thumbnails.'</option>';\n}\necho\"</select>\";\necho '</div>';\necho\"</div>\n\t </div>\";\n\necho\"</fieldset>\";\n\n\nforeach($arr_Images as $page_thumbnails) {\n\t\t$selected = \"\";\n\t\tif($page_thumbnail == \"$page_thumbnails\") {\n\t\t\t$selected = \"selected\";\n\t\t}\n\t\techo \"<option $selected data-img-src='/content/iamages/$page_thumbnails' value='$page_thumbnails'>$page_thumbnails</option>\";\n}\n\n\n\t\t\n$select_page_meta_robots  = '<select name=\"page_meta_robots\" class=\"form-control\">';\n$select_page_meta_robots .= '<option value=\"all\" '.($page_meta_robots == \"all\" ? 'selected=\"selected\"' :'').'>all</option>';\n$select_page_meta_robots .= '<option value=\"noindex\" '.($page_meta_robots == \"noindex\" ? 'selected=\"selected\"' :'').'>noindex</option>';\n$select_page_meta_robots .= '<option value=\"nofollow\" '.($page_meta_robots == \"nofollow\" ? 'selected=\"selected\"' :'').'>nofollow</option>';\n$select_page_meta_robots .= '<option value=\"noodp\" '.($page_meta_robots == \"noodp\" ? 'selected=\"selected\"' :'').'>noodp</option>';\n$select_page_meta_robots .= '<option value=\"noydir\" '.($page_meta_robots == \"noydir\" ? 'selected=\"selected\"' :'').'>noydir</option>';\n$select_page_meta_robots .= '</select>';\necho tpl_form_control_group('',$lang['f_meta_robots'],$select_page_meta_robots);\n\n\n\necho'</div>'; /* EOL tab_meta */\n\n\n\n/* tab_head */\necho'<div class=\"tab-pane fade\" id=\"head\">';\n\necho $lang['f_head_styles'];\necho '<span class=\"silent\"> &lt;style type=&quot;text/css&quot;&gt;</span> ... <span class=\"silent\">&lt;/styles&gt;</span>';\necho \"<textarea name='page_head_styles' class='form-control aceEditor_css' rows='12'>$page_head_styles</textarea>\";\necho '<div id=\"CSSeditor\"></div>';\n\necho '<hr>';\n\necho $lang['f_head_enhanced'];\necho '<span class=\"silent\"> &lt;head&gt;</span> ... <span class=\"silent\">&lt;/head&gt;</span>';\necho \"<textarea name='page_head_enhanced' class='form-control aceEditor_html' rows='12'>$page_head_enhanced</textarea>\";\necho '<div id=\"HTMLeditor\"></div>';\n\necho'</div>'; /* EOL tab_head */\n\n\n\nif($cnt_custom_fields > 0) {\n\n/* tab custom fields */\necho'<div class=\"tab-pane fade\" id=\"custom\">';\n\n\tfor($i=0;$i<$cnt_custom_fields;$i++) {\n\t\t\n\t\t$custom_field_value = '';\n\t\t$custom_field_value = ${$custom_fields[$i]};\n\t\tif(substr($custom_fields[$i],0,10) == \"custom_one\") {\n\t\t\t$label = substr($custom_fields[$i],11);\n\t\t\techo tpl_form_control_group('',$label,'<input type=\"text\" class=\"form-control\" name=\"'.$custom_fields[$i].'\" value=\"'.$custom_field_value.'\">');\n\t\t}\telseif(substr($custom_fields[$i],0,11) == \"custom_text\") {\n\t\t\t$label = substr($custom_fields[$i],12);\n\t\t\techo tpl_form_control_group('',$label,\"<textarea class='form-control' rows='6' name='$custom_fields[$i]'>\" .$custom_field_value. \"</textarea>\");\n\t\t}\telseif(substr($custom_fields[$i],0,14) == \"custom_wysiwyg\") {\n\t\t\t$label = substr($custom_fields[$i],15);\n\t\t\techo tpl_form_control_group('',$label,\"<textarea class='mceEditor_small' name='$custom_fields[$i]'>\" .$custom_field_value. \"</textarea>\");\n\t\t}\t\t\n\t}\n\necho'</div>'; /* EOL tab custom fields */\n\n}\n\necho\"</div>\"; // EOL fancytabs\n\necho '</div>';\necho '<div class=\"col-lg-3 col-md-4 col-sm-12\">';\n\n\necho '<div class=\"panel panel-default\">';\necho '<div class=\"panel-heading\">'.$lang['tab_page_preferences'].'</div>';\necho '<div class=\"panel-body\" style=\"padding-left:30px;padding-right:30px;\">';\n\n\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE1\"> WYSIWYG</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE2\"> Text</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE3\"> Code</label>';\necho '</div>';\necho '</div>';\n\n\n/* Select Language */\n$arr_lang = get_all_languages();\n\n$select_page_language  = '<select name=\"page_language\" class=\"form-control\">';\nfor($i=0;$i<count($arr_lang);$i++) {\n\n\t$lang_sign = $arr_lang[$i]['lang_sign'];\n\t$lang_desc = $arr_lang[$i]['lang_desc'];\n\t$lang_folder = $arr_lang[$i]['lang_folder'];\n\t$select_page_language .= \"<option value='$lang_folder'\".($page_language == \"$lang_folder\" ? 'selected=\"selected\"' :'').\">$lang_sign ($lang_desc)</option>\";\t\n\n} // eo $i\n\n$select_page_language .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_language'].'</label>';\necho $select_page_language;\necho '</div>';\n\n\n/* Select Template */\n\n$arr_Styles = get_all_templates();\n\n$select_select_template = '<select id=\"select_template\" name=\"select_template\"  class=\"form-control\">';\n\nif($page_template == '') {\n\t$selected_standard = 'selected';\n}\n\n$select_select_template .= \"<option value='use_standard<|-|>use_standard' $selected_standard>$lang[use_standard]</option>\";\n\n/* templates list */\nforeach($arr_Styles as $template) {\n\n\t$arr_layout_tpl = glob(\"../styles/$template/templates/layout*.tpl\");\n\t\n\t$select_select_template .= \"<optgroup label='$template'>\";\n\t\n\tforeach($arr_layout_tpl as $layout_tpl) {\n\t\t$layout_tpl = basename($layout_tpl);\n\t\n\t\t$selected = '';\n\t\tif($template == \"$page_template\" && $layout_tpl == \"$page_template_layout\") {\n\t\t\t$selected = 'selected';\n\t\t}\n\t\t\n\t\t$select_select_template .=  \"<option $selected value='$template<|-|>$layout_tpl'>$template \u00bb $layout_tpl</option>\";\n\t}\n\t\n\t$select_select_template .= '</optgroup>';\n\n}\n\n$select_select_template .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_template'].'</label>';\necho $select_select_template;\necho '</div>';\n\n/* Select Modul */\n\n$arr_iMods = get_all_moduls();\n\n$select_page_modul = '<select name=\"page_modul\"  class=\"form-control\">';\n\n$select_page_modul .= '<option value=\"\">Kein Modul</option>';\n\nfor($i=0;$i<count($arr_iMods);$i++) {\n\n\t$selected = \"\";\n\t$mod_name = $arr_iMods[$i]['name'];\n\t$mod_folder = $arr_iMods[$i]['folder'];\n\n\tif($mod_folder == \"$page_modul\") {\n\t\t$selected = \"selected\";\n\t}\n\n\t$select_page_modul .= \"<option value='$mod_folder' $selected>$mod_name</option>\";\n\n}\n\n\n$select_page_modul .= '</select>';\n\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_modul'].'</label>';\necho $select_page_modul;\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_modul_query'].'</label>';\necho \"<input class='form-control' type='text' name='page_modul_query' value='$page_modul_query'>\";\necho '</div>';\n\n\n/* Select  Status */\n\nunset($checked_status);\n\nif($page_status == \"\") {\n\t$page_status = \"public\";\n}\n\n\n$select_page_status = '<div class=\"text-center\">';\n$select_page_status .= '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-public '.($page_status == \"public\" ? 'active' :'').' \">';\n$select_page_status .= \"<input type='radio' name='page_status' value='public'\".($page_status == \"public\" ? 'checked' :'').\"> $lang[f_page_status_puplic]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-ghost '.($page_status == \"ghost\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='ghost'\".($page_status == \"ghost\" ? 'checked' :'').\"> $lang[f_page_status_ghost]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-private '.($page_status == \"private\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='private'\".($page_status == \"private\" ? 'checked' :'').\"> $lang[f_page_status_private]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-draft '.($page_status == \"draft\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='draft'\".($page_status == \"draft\" ? 'checked' :'').\"> $lang[f_page_status_draft]\";\t\n$select_page_status .= '</label>';\n\n$select_page_status .= '</div>';\n$select_page_status .= '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_status'].'</label>';\necho '<div>';\necho $select_page_status;\necho '</div>';\necho '</div>';\n\n\n/* Select Usergroups */\n\n$arr_groups = get_all_groups();\n$arr_checked_groups = explode(\",\",$page_usergroup);\n\nfor($i=0;$i<count($arr_groups);$i++) {\n\n\t$group_id = $arr_groups[$i]['group_id'];\n\t$group_name = $arr_groups[$i]['group_name'];\n\n\tif(in_array(\"$group_name\", $arr_checked_groups)) {\n\t\t$checked = \"checked\";\n\t} else {\n\t\t$checked = \"\";\n\t}\n\t\n\t$checkbox_usergroup .= '<div class=\"checkbox\"><label>';\n\t$checkbox_usergroup .= \"<input type='checkbox' $checked name='set_usergroup[]' value='$group_name'> $group_name\";\n\t$checkbox_usergroup .= '</label></div>';\n}\n\necho '<div class=\"form-group\">';\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#usergroups\">'.$lang['choose_usergroup'].'</a>';\necho '<div id=\"usergroups\" class=\"collapse\">';\necho $checkbox_usergroup;\necho '</div>';\necho '</div>';\n\n\n/* Select Rights Management */\n\n$arr_admins = get_all_admins();\n$arr_checked_admins = explode(\",\", $page_authorized_users);\n$cnt_admins = count($arr_admins);\n\nfor($i=0;$i<$cnt_admins;$i++) {\n\n\t$user_nick = $arr_admins[$i]['user_nick'];\n\n  if(in_array(\"$user_nick\", $arr_checked_admins)) {\n\t\t$checked_user = \"checked\";\n\t} else {\n\t\t$checked_user = \"\";\n\t}\n\t\t\n\t$checkbox_set_authorized_admins .= '<div class=\"checkbox\"><label>';\n \t$checkbox_set_authorized_admins .= \"<input type='checkbox' $checked_user name='set_authorized_admins[]' value='$user_nick'> $user_nick\";\n \t$checkbox_set_authorized_admins .= '</label></div>';\n}\n\n\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#admins\">'.$lang['f_page_authorized_admins'].'</a>';\necho '<div id=\"admins\" class=\"collapse\">';\necho $checkbox_set_authorized_admins;\necho '</div>';\necho '</div>';\n\n\n\n/* select labels */\n\n\n$cnt_labels = count($fc_labels);\n$arr_checked_labels = explode(\",\", $page_labels);\n\nfor($i=0;$i<$cnt_labels;$i++) {\n\t$label_title = $fc_labels[$i]['label_title'];\n\t$label_id = $fc_labels[$i]['label_id'];\n\t$label_color = $fc_labels[$i]['label_color'];\n\t\n  if(in_array(\"$label_id\", $arr_checked_labels)) {\n\t\t$checked_label = \"checked\";\n\t} else {\n\t\t$checked_label = \"\";\n\t}\n\t\n\t$checkbox_set_labels .= '<div class=\"checkbox\"><label>';\n \t$checkbox_set_labels .= \"<input type='checkbox' $checked_label name='set_page_labels[]' value='$label_id'> $label_title\";\n \t$checkbox_set_labels .= '</label></div>';\n\t\n}\n\n\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#labels\">'.$lang['labels'].'</a>';\necho '<div id=\"labels\" class=\"collapse\">';\necho $checkbox_set_labels;\necho '</div>';\necho '</div>';\n\necho '</div>'; // form-group\n\n\n\necho '<input type=\"hidden\" name=\"page_version\" value=\"'.$page_version.'\">';\necho '<input type=\"hidden\" name=\"modus\" value=\"'.$modus.'\">';\n\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\">';\necho '<div class=\"btn-group\">'.$submit_button.'</div><div class=\"btn-group\">'.$previev_button.'</div>';\necho '</div>';\necho $delete_button;\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\n\necho '</div>'; // panel-body\necho '</div>'; // panel\n\necho '</div>'; // col\necho '</div>'; // row\n\n\n//submit form to save data\n\n\n\necho '</form>';\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n$system_snippets = array('footer_text', 'extra_content_text', 'agreement_text', 'account_confirm', 'account_confirm_mail', 'no_access');\n$modus = 'new';\n\n\nif(isset($_REQUEST['suggest_name'])) {\n\t$textlib_name = clean_filename($_REQUEST['suggest_name']);\n}\n\n/**\n * delete snippet\n */\n\nif(isset($_POST['delete_snippet'])) {\n\n\t$delete_snip_id = (int) $_POST['snip_id'];\n\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$sql = \"DELETE FROM fc_textlib WHERE textlib_id = $delete_snip_id\";\n  $cnt_changes = $dbh->exec($sql);\n\n\tif($cnt_changes > 0){\n\t\t$sys_message = '{OKAY} '. $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"deleted snippet id: $delete_snip_id\",\"10\");\n\t\t$modus = 'new';\n\t} else {\n\t\t$sys_message = '{ERROR} ' . $lang['db_not_changed'];\n\t}\n\t\n\tprint_sysmsg(\"$sys_message\");\n\n}\n\n\n/* Save Textsnippet */\nif(isset($_POST['save_snippet'])) {\n\n\t// connect to database\n\t$db = new PDO(\"sqlite:\".CONTENT_DB);\n\t\n\t$snippet_name = clean_filename($_POST['snippet_name']);\n\t\n\tif($snippet_name == '') {\n\t\t$snippet_name = date(\"Y_m_d_h_i\",time());\n\t}\n\t\n\tif($_POST['snip_id'] != '') {\n\t\t\n\t\t$snip_id = (int) $_POST['snip_id'];\n\t\n\t\t$sql = \"UPDATE fc_textlib\n\t\t\t\t\t\tSET textlib_content = :textlib_content, textlib_notes = :textlib_notes, textlib_groups = :textlib_groups,\n\t\t\t\t\t\t\t\ttextlib_name = :textlib_name, textlib_title = :textlib_title, textlib_keywords = :textlib_keywords,\n\t\t\t\t\t\t\t\ttextlib_lang = :textlib_lang\n\t\t\t\t\t\tWHERE textlib_id = $snip_id\";\n\t\n\t} else {\n\t\t\n\t\t$sql = \"INSERT INTO fc_textlib (\n\t\t\t\t\t\t\ttextlib_content, textlib_notes, textlib_groups, textlib_name, textlib_title, textlib_keywords, textlib_lang\n\t\t\t\t\t\t) VALUES (\n\t\t\t\t\t\t\t:textlib_content, :textlib_notes, :textlib_groups, :textlib_name, :textlib_title, :textlib_keywords, :textlib_lang\n\t\t\t\t\t\t)\";\t\t\n\t}\n\t\n\t$sth = $db->prepare($sql);\n\t$sth->bindParam(':textlib_content', $_POST['textlib_content'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_name', $snippet_name, PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_lang', $_POST['sel_language'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_notes', $_POST['textlib_notes'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_keywords', $_POST['snippet_keywords'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_title', $_POST['snippet_title'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_groups', $_POST['snippet_groups'], PDO::PARAM_STR);\n\t$cnt_changes = $sth->execute();\n\t\n\t$db = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$sys_message = \"{OKAY} $lang[db_changed]\";\n\t\trecord_log(\"$_SESSION[user_nick]\",\"edit textlib <b>$snippet_title</b>\",\"2\");\n\t} else {\n\t\t$sys_message = \"{ERROR} $lang[db_not_changed]\";\n\t}\n\t\n\tprint_sysmsg(\"$sys_message\");\n\n} // eol save text\n\n\n\n/**\n * get all saved snippets\n */\n\n$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\n$sql = \"SELECT * FROM fc_textlib ORDER BY textlib_name ASC\";\n\nforeach($system_snippets as $snippet) {\n\t$snippet_exception[] = \" textlib_name != '$snippet' \";\n}\n\nforeach ($dbh->query($sql) as $row) {\n\t$snippets_list[] = $row;\n}\n\n$dbh = null;\n\n$cnt_snippets = count($snippets_list);\n\n\n/**\n * open snippet\n */\n\nif(((isset($_REQUEST['snip_id'])) OR ($modus == 'update')) AND (!isset($delete_snip_id)))  {\n\n\tif(!isset($snip_id)) {\n\t\t$snip_id = (int) $_REQUEST['snip_id'];\n  }\n    \n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$sql = \"SELECT * FROM fc_textlib WHERE textlib_id = $snip_id \";\n\n\t$result = $dbh->query($sql);\n\t$result = $result->fetch(PDO::FETCH_ASSOC);\n\n\t$dbh = null;\n\n\tif(is_array($result)) {\n\t\tforeach($result as $k => $v) {\n \t\t\t\t$$k = htmlspecialchars(stripslashes($v));\n\t\t}\n\t}\n\t$modus = 'update';\n}\n\necho '<div class=\"app-container\">';\necho '<h3>' . $lang['snippets'] . '</h3>';\necho '<div class=\"row\">';\necho '<div class=\"col-md-3\">';\n\necho '<div class=\"max-height-container\">';\necho '<div class=\"scroll-box\">';\necho '<div class=\"list-group\">';\n\nfor($i=0;$i<$cnt_snippets;$i++) {\n\t$active_class = '';\n\t$get_snip_id = $snippets_list[$i]['textlib_id'];\n\t$get_snip_name = $snippets_list[$i]['textlib_name'];\n\t$get_snip_lang = $snippets_list[$i]['textlib_lang'];\n\t\n\tif(in_array($get_snip_name, $system_snippets)) {\n\t\t$show_snip_name = '<span class=\"glyphicon glyphicon-cog\"></span> ' . $get_snip_name;\n\t} else {\n\t\t$show_snip_name = $get_snip_name;\n\t}\n\t\t\n\tunset($sel);\n\tif($snip_id == $get_snip_id) {\n\t\t$sel = \"selected\";\n\t\t$get_snip_name_editor = '[snippet]'.$get_snip_name.'[/snippet]';\n\t\t$get_snip_name_smarty = '{$fc_snippet_'.$get_snip_name.'}';\n\t\t$get_snip_name_smarty = str_replace('-', '_', $get_snip_name_smarty);\n\t}\n\t\n\tif($_REQUEST['snip_id'] == $get_snip_id) {\n\t\t$active_class = 'active';\n\t}\n\t\n\techo '<a class=\"list-group-item '.$active_class.'\" href=\"acp.php?tn=pages&sub=snippets&snip_id='.$get_snip_id.'\">'.$show_snip_name.' <span class=\"badge\">'.$get_snip_lang.'</span></a>';\n}\n\necho '</div>';\necho '</div>';\necho '</div>';\n\necho '</div>';\necho '<div class=\"col-md-9\">';\n\necho \"<form action='$_SERVER[PHP_SELF]?tn=pages&sub=snippets' method='POST'>\";\n\n\n\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-9\">';\n\necho '<textarea class=\"form-control mceEditor switchEditor\" id=\"textEditor\" name=\"textlib_content\">'.$textlib_content.'</textarea>';\necho '<input type=\"hidden\" name=\"text\" value=\"'.$text.'\">';\n\nif($get_snip_name_editor != '') {\n\techo '<hr><div class=\"form-group\">';\n\techo '<label>Snippet</label>';\n\techo '<input type=\"text\" class=\"form-control\" placeholder=\"[snippet]...[/snippet]\" value=\"'.$get_snip_name_editor.'\" readonly>';\n\techo '</div>';\n}\n\necho '</div>';\necho '<div class=\"col-md-3\">';\n/* info col */\necho '<div class=\"well well-sm\">';\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE1\"> WYSIWYG</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE2\"> Text</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE3\"> Code</label>';\necho '</div>';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['filename'].' <small>(a-z,0-9)</small></label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_name\" value=\"'.$textlib_name.'\">';\necho '</div>';\n\n\n$select_textlib_language  = '<select name=\"sel_language\" class=\"form-control\">';\nfor($i=0;$i<count($arr_lang);$i++) {\n\t$lang_sign = $arr_lang[$i]['lang_sign'];\n\t$lang_desc = $arr_lang[$i]['lang_desc'];\n\t$lang_folder = $arr_lang[$i]['lang_folder'];\n\t$select_textlib_language .= \"<option value='$lang_folder'\".($textlib_lang == \"$lang_folder\" ? 'selected=\"selected\"' :'').\">$lang_sign</option>\";\t\n}\n$select_textlib_language .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_language'].'</label>';\necho $select_textlib_language;\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_title'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_title\" value=\"'.$textlib_title.'\">';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_keywords'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_keywords\" value=\"'.$textlib_keywords.'\" data-role=\"tagsinput\" />';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_groups'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_groups\" value=\"'.$textlib_groups.'\" />';\necho '</div>';\n\necho '<div class=\"alert alert-info\" style=\"padding:2px 3px;\">';\necho '<strong>'.$lang['label_notes'].':</strong>';\necho '<textarea class=\"masked-textarea\" name=\"textlib_notes\" rows=\"5\">'.$textlib_notes.'</textarea>';\necho '</div>';\n\necho '<div class=\"formfooter\">';\nif($modus == 'new') {\n\techo '<input type=\"submit\" name=\"save_snippet\" class=\"btn btn-success btn-block\" value=\"'.$lang['save'].'\">';\n} else {\n\techo '<input type=\"hidden\" name=\"snip_id\" value=\"'.$snip_id.'\">';\n\techo '<input type=\"submit\" name=\"save_snippet\" class=\"btn btn-success btn-block\" value=\"'.$lang['update'].'\"> ';\n\techo '<a class=\"btn btn-default btn-block\" href=\"acp.php?tn=pages&sub=snippets\">'.$lang['discard_changes'].'</a>';\n\techo '<input type=\"submit\" name=\"delete_snippet\" class=\"btn btn-danger btn-sm btn-block\" value=\"'.$lang['delete'].'\" onclick=\"return confirm(\\''.$lang['confirm_delete_data'].'\\')\">';\n}\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\n\n\necho '</div>';\n/* end info col */\necho '</div>';\necho '</div>';\n\n\necho '</form>';\n\n\necho '</div>';\necho '</div>';\necho '</div>'; // .app-container\n\n?>", "<?php\n\n$time_s = microtime(true);\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n\n// defaults\n\n$entries_per_page = 200;\n\nif($_SESSION['start'] == \"\") {\n\t$_SESSION['start'] = 0;\n}\n\nif($_REQUEST['start'] != \"\") {\n\t$_SESSION['start'] = (int) ($_REQUEST['start']*$entries_per_page);\n}\n\nif($_SESSION['filename'] == \"\") {\n\t//default: today's logfile\n\t$_SESSION['filename'] = \"logfile\" . date('Y') . date('m') . \".sqlite3\";\n}\n\nif($_POST['select_logfile']) {\n\t$_SESSION['filename'] = strip_tags($_POST['select_logfile']);\n\t$_SESSION['start'] = 0; // reset pagination\n}\n\n\n\n\n$start = $_SESSION['start'];\n$filename = $_SESSION['filename'];\n\n\n\n\n\n/* scan FC_CONTENT_DIR and return all logfiles */\n\n$log_dir = \"../\" . FC_CONTENT_DIR . \"/SQLite\";\n$logfiles = glob(\"$log_dir/logfile*\");\n\necho\"<fieldset>\";\necho\"<legend>$lang[select_logfile]</legend>\";\necho\"<form action='$_SERVER[PHP_SELF]?tn=system&sub=stats' method='POST' class='form-inline'>\";\necho '<div class=\"form-group\">';\necho\"<select name='select_logfile' class='form-control'>\";\n\nforeach($logfiles as $fn) {\n\t\n\t$fn = basename($fn);\n\t$get_month = 'm' . substr(\"$fn\", 11, 2);\n\t$month = $lang[$get_month];\n\t$get_year = substr(\"$fn\", 7, 4);\n\n\tunset($selected);\n\tif($filename == $fn) { $selected = \"selected\"; }\n   \t\techo\"<option $selected value='$fn'>$month $get_year</option>\";\n}\n\necho\"</select> \";\necho '</div> ';\necho\"<input type='submit' class='btn btn-default' name='select_log' value='$lang[choose]'>\";\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho\"</form>\";\necho\"</fieldset>\";\n\n\n\n$logfile_path = \"../\" . FC_CONTENT_DIR . \"/SQLite/$filename\";\n\n\nif(is_file(\"$logfile_path\")) {\n\n\n// connect to database\n$dbh = new PDO(\"sqlite:$logfile_path\");\n\n\n$sql_stat = \"\nSELECT count(*) AS 'All',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%safari%' ) AS 'Safari', \n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%firefox%' ) AS 'Firefox',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%msie%' ) AS 'Internet Explorer',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%chrome%' ) AS 'Google Chrome',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%netscape%' ) AS 'Netscape',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%opera%' ) AS 'Opera',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%camino%' ) AS 'Camino',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%konqueror%' ) AS 'Konqueror',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%icab%' ) AS 'iCab',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%ipad%' ) AS 'iPad',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%iphone%' or log_ua LIKE '%ipod%' ) AS 'iPhone/iPod',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%bot%' or log_ua LIKE '%java%' or log_ua LIKE '%spider%' ) AS 'Bots'\nFROM fc_logfile\n\";\n\n$stat_result = $dbh->query(\"$sql_stat\")->fetch(PDO::FETCH_ASSOC);\n\n\n\n$cnt_entries = $stat_result['All'];\n\n\n$sql = \"SELECT * FROM fc_logfile\n\t\t\t\tORDER BY log_time DESC\n\t\t\t\tLIMIT $start, $entries_per_page\";\n\nunset($result);\nforeach ($dbh->query($sql) as $row) {\n\t$result[] = $row;\n}\n   \n$cnt_result = count($result);\n$dbh = null;\n\n\n\n\n\n$filesize = round((filesize(\"$logfile_path\") / 1024), 2);\n\n$get_month = 'm' . substr(\"$filename\", 11, 2);\n$month = $lang[$get_month];\n$get_year = substr(\"$filename\", 7, 4);\n\n\necho\"<p style='background:#ddd;padding:4px;'><b>$month $get_year</b> \u00bb $cnt_entries $lang[logfile_hits] \u00bb $filesize kb</p>\";\n\necho\"<div style='float:left;width:200px;padding:8px;'>\";\n\n\necho\"<table class='table table-condensed'>\";\n\narsort($stat_result);\n\nforeach ($stat_result as $k => $v) {\n\tif($v > 0){\n    \techo \"\t<tr>\n    \t\t\t\t\t\t<td>$k:</td>\n    \t\t\t\t\t\t<td align='right'>$v</td>\n    \t\t  \t\t</tr> \";\n    }\n}\n\n\necho\"</table>\";\n\necho\"</div>\"; // eo float\n\n\n\n/* listing */\n\necho\"<div style='margin-left:220px;padding:8px;'>\";\n\necho\"<div style='height:350px;overflow:auto;margin:0;padding:10px;background-color:#ddd;'>\";\n\n\nfor($i=0;$i<$cnt_result;$i++) {\n\n\t$log_time = date(\"d.m.Y H:i:s\",$result[$i]['log_time']);\n\t$log_ip = $result[$i]['log_ip'];\n\t$log_ref = $result[$i]['log_ref'];\n\t$log_ua = $result[$i]['log_ua'];\n\t$log_query = $result[$i]['log_query'];\n\t$log_id = $result[$i]['log_id'];\n\n\n\tif( $i%2 == \"0\" ) {\n\t\t$bg_color = \"#fff\";\n\t} else {\n\t\t$bg_color = \"#f1f1f1\";\n\t}\n\n\n\techo\"<dl class='dl-horizontal' style='background-color:$bg_color;margin:0;'>\";\n\n\techo\"<dt>Zeit:</dt> <dd>$log_time</dd>\";\n\techo\"<dt>IP:</dt> <dd>$log_ip</dd>\";\n\n\tif($log_query != \"\") {\n\t\techo\"<dt>query:</dt> <dd>$log_query</dd>\";\n\t}\n\tif($log_ref != \"\") {\n\t\techo\"<dt>Referer:</dt> <dd><span style='color:#390;'>$log_ref</span></dd>\";\n\t}\n\tif($log_ua != \"\") {\n\t\techo\"<dt>User Agent:</dt> <dd>$log_ua</dd>\";\n\t}\n\techo\"</dl>\";\n\n} // eol $i\n\n\n\necho\"</div>\";\n\n\n\n/* pagination */\n$pages = ceil($cnt_entries/$entries_per_page);\necho\"<div id='pagina'><p>\";\n\tfor($i=0;$i<$pages;$i++) {\n\t$nbr = $i+1;\n\t$pag_class = \"buttonLink\";\n\tif(($i*$entries_per_page) == \"$start\") { $pag_class = \"buttonLink_sel\"; }\n\t\techo\"<a class='$pag_class' href='$_SERVER[PHP_SELF]?tn=system&sub=stats&start=$i'>$nbr</a> \";\n\t}\n\necho\"</p></div>\";\n/* pagination */\n\n\n\n\necho\"</div>\"; // eo float div\n\n} else {\n\necho\"<div id='sys_message_error'>No logfile</div>\";\n\n}\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n$array_group_user = array();\n\n$submit_button = '<input type=\"submit\" class=\"btn btn-success\" name=\"saveGroup\" value=\"'.$lang['save'].'\">';\n$delete_button = '';\n\n\n/**\n * Update existing group\n */\n\nif($_POST['updateGroup']) {\n\n\t\n\t$arr_update_incUser = $_POST['incUser'];\n\t@sort($arr_update_incUser);\n\t$update_incUser = implode(\" \", $arr_update_incUser);\n\t\n\t$group_name = filter_var($_POST['group_name'], FILTER_SANITIZE_STRING);\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t\n\t$sql = \"UPDATE fc_groups\n\t\t\tSET group_name = :update_group_name,\n\t\t\t\tgroup_description = :update_group_description,\n\t\t\t\tgroup_user = :update_incUser\n\t\t\tWHERE group_id = :editgroup \";\n\t\t\t\n\t$sth = $dbh->prepare($sql);\n\t\n\t$sth->bindParam(':update_group_name', $group_name, PDO::PARAM_STR);\n\t$sth->bindParam(':update_group_description', $_POST['group_description'], PDO::PARAM_STR);\n\t$sth->bindParam(':update_incUser', $update_incUser, PDO::PARAM_STR);\n\t$sth->bindParam(':editgroup', $_POST['editgroup'], PDO::PARAM_INT);\n\t\t\t\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"updated usergroup: $group_name\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n\n}\n\n\n/**\n * save new group\n */\n\nif($_POST['saveGroup']) {\n\n\t\n\t$arr_new_incUser = $_POST['incUser'];\n\t\n\tif(is_array($arr_new_incUser)) {\n\t\tsort($arr_new_incUser);\n\t\t$new_incUser = implode(\" \", $arr_new_incUser);\n\t} else {\n\t\t$new_incUser = \"\";\n\t}\n\t\n\t$group_name = filter_var($_POST['group_name'], FILTER_SANITIZE_STRING);\n\t\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t\n\t$sql = \"INSERT INTO fc_groups (\n\t\t\t\tgroup_id , group_name , group_description , group_user\n\t\t\t) VALUES (\n\t\t\t\tNULL, :new_group_name, :new_group_description, :new_incUser ) \";\n\t\t\t\t\n\t$sth = $dbh->prepare($sql);\n\t\n\t$sth->bindParam(':new_group_name', $group_name, PDO::PARAM_STR);\n\t$sth->bindParam(':new_group_description', $_POST['group_description'], PDO::PARAM_STR);\n\t$sth->bindParam(':new_incUser', $new_incUser, PDO::PARAM_STR);\t\n\t\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"created usergroup: $group_name\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n}\n\n\n\n/**\n * delete the selected group\n */\n\n\nif($_POST['deleteGroup']) {\n\n\t$editgroup = (int) $_POST['editgroup'];\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t$sql = \"DELETE FROM fc_groups WHERE group_id = $editgroup\";\n\t$cnt_changes = $dbh->exec($sql);\n\t\n\t$show_data = false;\n\t\n\tif($cnt_changes > 0) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"deleted usergroup id: $editgroup\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n}\n\n\n\n\n\n\n//print message\n\nif($success_message != \"\"){\n\techo '<div class=\"alert alert-success\"><p>'.$success_message.'</p></div>';\n}\n\nif($error_message != \"\"){\n\techo '<div class=\"alert alert-error\"><p>'.$error_message.'</p></div>';\n}\n\n\n\n\n\n\n/**\n * choose the group\n * <select>\n */\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n$sql = \"SELECT * FROM fc_groups ORDER BY group_id ASC\";\n\n$result = $dbh->query($sql);\n$result= $result->fetchAll(PDO::FETCH_ASSOC);\n\n\n$editgroup = (int) $_POST['editgroup'];\n\n\necho '<fieldset>';\necho '<legend>'.$lang['legend_choose_group'].'</legend>';\necho '<form action=\"'.$_SERVER['PHP_SELF'].'?tn=user&sub=groups\" method=\"POST\">';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-5\">';\n\necho '<div class=\"form-group\">';\necho '<select name=\"editgroup\" class=\"form-control\">';\n\nfor($i=0;$i<count($result);$i++) {\n\n\t$group_id = $result[$i]['group_id'];\n\t$group_name = $result[$i]['group_name'];\n\t\n\tif($editgroup == $group_id) { $sel[$i] = \"selected\"; }\n\t\n\techo \"<option $sel[$i] value='$group_id'>$group_name</option>\";\n\n}\n\necho '</select>';\necho '</div>';\necho '</div>';\necho '<div class=\"col-md-3\">';\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '<input type=\"submit\" class=\"btn btn-default btn-block\" name=\"select_group\" value=\"'.$lang['edit'].'\">';\necho '</div>';\necho '</div>';\necho '</form>';\necho '</fieldset>';\n\n\n/**\n * show data of the selected group\n */\n\nif(($editgroup) && ($show_data !== false)) {\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql =  \"SELECT * FROM fc_groups WHERE group_id = $editgroup \";\n\n$result = $dbh->query($sql);\n$result= $result->fetch(PDO::FETCH_ASSOC);\n\nforeach($result as $k => $v) {\n   $$k = stripslashes($v);\n}\n\n$array_group_user = explode(\" \", $group_user);\n\n$submit_button = '<input type=\"submit\" class=\"btn btn-success\" name=\"updateGroup\" value=\"'.$lang['update'].'\">';\n$delete_button = '<input type=\"submit\" class=\"btn btn-danger\" name=\"deleteGroup\" value=\"'.$lang['delete'].'\" onclick=\"return confirm(\\''.$lang['confirm_delete_file'].'\\')\">';\n$hidden_field = '<input type=\"hidden\" name=\"editgroup\" value=\"'.$editgroup.'\">';\n\n} else {\n// no group is selected\nunset($group_name,$group_description,$hidden_field);\n}\n\n\n\n\n/**\n * FORM // EDIT GROUPS\n */\n\necho '<fieldset>';\necho '<legend>'.$lang['legend_groups_data'].'</legend>';\n\necho '<form action=\"'.$_SERVER[PHP_SELF].'?tn=user&sub=groups\" method=\"POST\">';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-8\">';\n\necho '<label class=\"\">'.$lang['label_group_name'].'</label>';\necho '<input type=\"text\" class=\"form-control\" name=\"group_name\" value=\"'.$group_name.'\">';\n\necho '<label>'.$lang['label_group_description'].'</label>';\necho '<textarea class=\"mceEditor_small\" rows=\"4\" name=\"group_description\">'.$group_description.'</textarea>';\n\necho '</div>';\necho '<div class=\"col-md-4\">';\n\necho '<label>'.$lang['label_group_add_user'].'</label>';\n\necho '<div id=\"userlist\">';\necho '<div class=\"scroll-container\">';\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql = \"SELECT * FROM fc_user ORDER BY user_nick ASC\";\n\nunset($result);\n   foreach ($dbh->query($sql) as $row) {\n     $result[] = $row;\n   }\n\n\necho '<table class=\"table table-hover table-condensed\">';\n\nfor($i=0;$i<count($result);$i++) {\n\n\tif($result[$i]['user_class'] == \"deleted\") {\n\t\tcontinue;\n\t}\n\t\n\t$user_id = $result[$i]['user_id'];\n\t$user_nick = $result[$i]['user_nick'];\n\t$user_firstname = $result[$i]['user_firstname'];\n\t$user_lastname = $result[$i]['user_lastname'];\n\t\t\n\tif (in_array(\"$user_id\", $array_group_user)) {\n\t   $checked = \"checked\";\n\t} else {\n\t\t$checked = \"\";\n\t}\n\t\n\t\n\techo '<tr>';\n\techo '<td><label><input type=\"checkbox\" '.$checked.' name=\"incUser[]\" value=\"'.$user_id.'\"> '.$user_nick.' </label></td>\n\t\t\t<td>'.$user_firstname.' '.$user_lastname.'</td>';\n\techo '</tr>';\n} //eol $i\n\necho '</table>';\n\necho '</div>';\necho '</div>';\necho '</div>';\necho '</div>';\n\necho '<div class=\"formfooter clear\">';\necho \"$hidden_field $delete_button $submit_button\";\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\necho '</form>';\n\necho '</fieldset>';\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n\n// sort by reference\nswitch ($_GET['sort']) {\ncase \"1\":\n    $order_by = \"user_nick\";\n    break;\ncase \"2\":\n    $order_by = \"user_registerdate\";\n    break;\ncase \"3\":\n    $order_by = \"user_lastname\";\n    break;\ncase \"4\":\n    $order_by = \"user_mail\";\n    break;\ncase \"5\":\n    $order_by = \"user_verified\";\n    break;\ndefault:\n\t$order_by = \"user_id\";\n}\n\n/* sort up or down */\n\nif($_GET['way'] == \"up\"){\n\t$way = \"ASC\";\n\t$set_way = \"down\";\n} else {\n\t$way = \"DESC\";\n\t$set_way = \"up\";\n}\n\n/* switch user status */\n\nif(isset($_GET['switch'])) {\n\t$_SESSION['set_user_status'] = true;\n}\n\nif($_SESSION['checked_verified'] == '' AND $_SESSION['checked_waiting'] == '' AND $_SESSION['checked_paused'] == '' AND $_SESSION['set_user_status'] == false) {\n\t$_SESSION['checked_verified'] = 'checked';\n}\n\n\nif($_GET['switch'] == 'statusWaiting' AND $_SESSION['checked_waiting'] == '') {\n\t$_SESSION['checked_waiting'] = \"checked\";\n} elseif($_GET['switch'] == 'statusWaiting' AND $_SESSION['checked_waiting'] == 'checked') {\n\t$_SESSION['checked_waiting'] = \"\";\n}\n\nif($_GET['switch'] == 'statusPaused' && $_SESSION['checked_paused'] == 'checked') {\n\t$_SESSION['checked_paused'] = \"\";\n} elseif($_GET['switch'] == 'statusPaused' && $_SESSION['checked_paused'] == '') {\n\t$_SESSION['checked_paused'] = \"checked\";\n}\n\nif($_GET['switch'] == 'statusVerified' && $_SESSION['checked_verified'] == 'checked') {\n\t$_SESSION['checked_verified'] = \"\";\n} elseif($_GET['switch'] == 'statusVerified' && $_SESSION['checked_verified'] == '') {\n\t$_SESSION['checked_verified'] = \"checked\";\n}\n\nif($_GET['switch'] == 'statusDeleted' && $_SESSION['checked_deleted'] == 'checked') {\n\t$_SESSION['checked_deleted'] = \"\";\n} elseif($_GET['switch'] == 'statusDeleted' && $_SESSION['checked_deleted'] == '') {\n\t$_SESSION['checked_deleted'] = \"checked\";\n}\n\n$set_status_filter = \"user_verified = 'foobar' \";\n\nif($_SESSION['checked_waiting'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'waiting' \";\n\t$btn_status_waiting = 'active';\n}\n\nif($_SESSION['checked_paused'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'paused' \";\n\t$btn_status_paused = 'active';\n}\n\nif($_SESSION['checked_verified'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'verified' \";\n\t$btn_status_verified = 'active';\n}\n\nif($_SESSION['checked_deleted'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = '' \";\n\t$btn_status_deleted = 'active';\n}\n\n\n\n$status_btn_group  = '<div class=\"btn-group\">';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusVerified\" class=\"btn btn-fc btn-sm '.$btn_status_verified.'\"><span class=\"glyphicon glyphicon-ok\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusWaiting\" class=\"btn btn-fc btn-sm '.$btn_status_waiting.'\"><span class=\"glyphicon glyphicon-time\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusPaused\" class=\"btn btn-fc btn-sm '.$btn_status_paused.'\"><span class=\"glyphicon glyphicon-warning-sign\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusDeleted\" class=\"btn btn-fc btn-sm '.$btn_status_deleted.'\"><span class=\"glyphicon glyphicon-ban-circle\"></span></a>';\n$status_btn_group .= '</div>';\n\n\n$whereString = \"WHERE user_nick != '' \";\n\nif(!empty($_POST['findUser'])) {\n\t$findUser = strip_tags($_POST['findUser']);\n\t$search_user = \"user_nick LIKE '%$findUser%' \";\n}\n\n\n\nif($set_status_filter != \"\") {\n\t$whereString .= \" AND ($set_status_filter) \";\n}\n\nif($search_user != \"\") {\n\t$whereString .= \" AND ($search_user) \";\n}\n\nunset($result);\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql = \"SELECT user_id, user_nick, user_class, user_firstname, user_lastname, user_registerdate, user_verified, user_mail\n    \t\tFROM fc_user\n    \t\t$whereString\n    \t\tORDER BY $order_by $way\";\n\nforeach ($dbh->query($sql) as $row) {\n\t$result[] = $row;\n}\n\n$cnt_result = count($result);\n\n$dbh = null;\n\n// number to show\n$loop = 20;\n\n\n$start = 0;\nif(isset($_GET['start'])) {\n\t$start = (int) $_GET['start'];\n}\n\n$cnt_pages = ceil($cnt_result/$loop);\n\nif($start<0) {\n\t$start = 0;\n}\n\n$end = $start+$loop;\n\nif($end > $cnt_result) {\n\t$end = $cnt_result;\n}\n\n\n//next step\n$next_start = $end;\n$prev_start = $start-$loop;\n\n\n\nif($start>($cnt_result-$loop)) {\n\t$next_start = $start;\n}\n\nif($prev_start <= 0){\n\t$prev_start = 0;\n}\n\n\n$pag_backlink = \"<a class='btn btn-primary' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$prev_start&sort=$_GET[sort]'>$lang[pagination_backward]</a>\";\n\n\nfor($x=0;$x<$cnt_pages;$x++) {\n\n\t$page_start = $x*$loop;\n\t$page_nbr = $x+1;\n\n\tif($page_start == $start) {\n\t\t$aclass = \"btn btn-primary active\";\n\t} else {\n\t\t$aclass = \"btn btn-primary\";\n\t}\n\n\t$pag_string .= \"<a class='$aclass' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$page_start'>$page_nbr</a> \";\n} //eol for $x\n\n\n$pag_forwardlink = \"<a class='btn btn-primary' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$next_start&sort=$_GET[sort]'>$lang[pagination_forward]</a>\";\n\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-5\">';\necho \"<form action='$_SERVER[PHP_SELF]?tn=user' class='form-inline' method='POST'>\";\n\necho '<div class=\"input-group\">';\necho '<span class=\"input-group-addon\"><span class=\"glyphicon glyphicon-filter\"></span></span>';\necho '<input type=\"text\" name=\"findUser\" class=\"form-control\" placeholder=\"Filter\">';\necho '</div>';\necho \"</form>\";\n\necho '</div>';\necho '<div class=\"col-md-7\">';\necho '<div style=\"float:right;\">';\necho $status_btn_group;\necho '</div>';\necho '<div class=\"clearfix\"></div>';\necho '</div>';\necho '</div><br>';\n\n\n\n//print the list\n\necho\"<table class='table table-condensed table-hover table-list' border='0' cellpadding='0' cellspacing='0'>\";\n\necho\"<thead><tr>\n<th class='head' style='text-align:right;'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=0&way=$set_way'>ID</a></th>\n<th class='head'></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=1&way=$set_way'>$lang[h_username]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=2&way=$set_way'>$lang[h_registerdate]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=3&way=$set_way'>$lang[h_realname]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=4&way=$set_way'>$lang[h_email]</a></th>\n<th class='head'>$lang[h_action]</th>\n</tr></thead>\";\n\nfor($i=$start;$i<$end;$i++) {\n\n\t$user_id = $result[$i]['user_id'];\n\t$user_nick = $result[$i]['user_nick'];\n\t$user_avatar_path = '../'. FC_CONTENT_DIR . '/avatars/' . md5($user_nick) . '.png';\n\t$user_class = $result[$i]['user_class'];\n\t$user_mail = $result[$i]['user_mail'];\n\t$user_registerdate = $result[$i]['user_registerdate'];\n\t$user_firstname = $result[$i]['user_firstname'];\n\t$user_lastname = $result[$i]['user_lastname'];\n\t$user_verified = $result[$i]['user_verified'];\n\t$user_groups = $result[$i]['user_groups'];\n\t$show_registerdate = @date(\"d.m.Y\",$user_registerdate);\n\t\n\t$user_avatar = '<img src=\"images/avatar.png\" class=\"img-circle avatar\" width=\"50\" height=\"50\">';\n\tif(is_file(\"$user_avatar_path\")) {\n\t\t$user_avatar = '<img src=\"'.$user_avatar_path.'\" class=\"img-circle avatar\" width=\"50\" height=\"50\">';\n\t}\n\n\t//show me in bold\n\tunset($td_class);\n\tif($user_nick == $_SESSION['user_nick']){\n\t\t$td_class = \"bold\";\n\t}\n\n\t//marking admins\n\tif($user_class == \"administrator\"){\n\t\t$admin_img = '<span style=\"color:#36a;\"><span class=\"glyphicon glyphicon-user\"></span></span>';\n\t} else {\n\t\t$admin_img = '<span class=\"glyphicon glyphicon-user\"></span>';\n\t}\n\n\t//deleted user\n\tif($user_class == \"deleted\"){\n\t\t$user_nick = \"<strike>$user_nick</strike>\";\n\t}\n\n\n\t//status image\n\tswitch ($user_verified) {\n\t\tcase \"waiting\":\n\t\t\t$statusLabel = \"label label-info center\";\n\t\t\t$tr_class = 'info';\n\t\t\tbreak;\n\t\tcase \"paused\":\n\t\t\t$statusLabel = \"label label-warning center\";\n\t\t\t$tr_class = 'warning';\n\t\t\tbreak;\n\t\tcase \"verified\":\n\t\t\t$statusLabel = \"alert alert-success center\";\n\t\t\t$tr_class = 'success';\n\t\t\tbreak;\n\t\tcase \"\":\n\t\t\t$tr_class = 'danger';\n\t\t\t$statusLabel = \"label label-default center\";\n\t\t\tbreak;\n\t}\n\t\n\techo\"\n\t<tr class='$tr_class'>\n\t\t<td class='$td_class' style='text-align:right;'>$user_id</td>\n\t\t<td>$user_avatar</td>\n\t\t<td class='$td_class'>$admin_img $user_nick</td>\n\t\t<td class='$td_class'>$show_registerdate</td>\n\t\t<td class='$td_class'>$user_firstname $user_lastname</td>\n\t\t<td class='$td_class'>$user_mail</td>\n\t\t<td class='$td_class'><a class='btn btn-default btn-sm' href='$_SERVER[PHP_SELF]?tn=user&sub=edit&edituser=$user_id'>$lang[edit]</a></td>\n\t</tr>\";\n\n\n\n} // eol for $i\n\necho\"</table>\";\n\n\necho '<div id=\"well well-sm\"><p class=\"text-center\">';\necho \"$pag_backlink $pag_string $pag_forwardlink\";\necho '</p></div>';\n\n\n?>"], "fixing_code": ["<?php\n\n//prohibit unauthorized access\nrequire 'core/access.php';\n\n\necho '<hr class=\"shadow\" style=\"margin-top:0;\">';\n\necho '<div class=\"row\">';\n\necho '<div class=\"col-md-4\">';\n\necho '<div class=\"panel panel-default\">';\n\necho '<div class=\"panel-heading\">Config</div>';\necho '<table class=\"table table-condensed\">';\necho '<tr><td>Server:</td><td>' . $_SERVER['SERVER_NAME'] . ' (PHP '.phpversion().')</td></tr>';\nif($prefs_mailer_adr != '') {\n\techo '<tr><td>System E-Mails:</td><td>' . $prefs_mailer_adr . '</td></tr>';\n} else {\n\techo '<tr><td>System E-Mails:</td><td><span class=\"text-danger\">'.$lang['missing_value'].'</span></td></tr>';\n}\nif($prefs_mailer_name != '') {\n\techo '<tr><td>E-Mail Name:</td><td>' . $prefs_mailer_name . '</td></tr>';\n} else {\n\techo '<tr><td>E-Mail Name:</td><td><span class=\"text-danger\">'.$lang['missing_value'].'</span></td></tr>';\n}\necho '</table>';\n\necho '</div>';\n\n\necho '<div class=\"panel panel-default\">';\necho '<div class=\"panel-heading\">' . $lang['f_user_drm'] . '</div>';\necho '<div class=\"panel-body\">';\n\necho\"<p><span class='glyphicon glyphicon-user'></span> $_SESSION[user_firstname] $_SESSION[user_lastname] ($_SESSION[user_nick])</p>\";\n\n$list_str = '<ul class=\"list-unstyled\" style=\"padding-left:16px;\">';\n\nif($_SESSION['acp_pages'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_pages'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_pages'].'</li>';\n}\n\nif($_SESSION['acp_editpages'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_editpages'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_editpages'].'</li>';\n}\n\nif($_SESSION['acp_editownpages'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_editownpages'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_editownpages'].'</li>';\n}\n\nif($_SESSION['acp_files'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_files'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_files'].'</li>';\n}\n\nif($_SESSION['acp_user'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_user'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_user'].'</li>';\n}\n\nif($_SESSION['acp_system'] == \"allowed\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_system'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_files'].'</li>';\n}\n\nif($_SESSION['drm_can_publish'] == \"true\") {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-ok-circle text-success\"></span> '. $lang['drm_user_can_publish'].'</li>';\n} else {\n\t$list_str .= '<li><span class=\"glyphicon glyphicon-remove-circle text-danger\"></span> '. $lang['drm_user_can_publish'].'</li>';\n}\n\n\n$list_str .= \"</ul>\";\n\necho $list_str;\n\necho '</div>';\n\necho '</div>';\necho '</div>';\n\n\necho '<div class=\"col-md-8\">';\n\necho '<ul class=\"nav nav-tabs\" id=\"bsTabs\">';\necho '<li class=\"active\"><a href=\"#chat\" data-toggle=\"tab\"><span class=\"glyphicon glyphicon-comment\"></span> CHAT</a></li>';\necho '<li><a href=\"#log\" data-toggle=\"tab\"><span class=\"glyphicon glyphicon-list-alt\"></span> PROTOKOLL</a></li>';\necho '</ul>';\n\necho '<div class=\"tab-content\">';\n\necho'<div class=\"tab-pane fade in active\" id=\"chat\">';\n\n$chat_form = file_get_contents('templates/comment-form.tpl');\n\n$e_comment_text = '';\n$e_comment_id = '';\n\nif(isset($_GET['dcid'])) {\n\t$delete_comment_id = (int) $_GET['dcid'];\n\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$query = \"DELETE FROM fc_comments WHERE comment_id = :comment_id\";\n\t$sth = $dbh -> prepare($query);\n\t$sth -> bindParam(':comment_id', $delete_comment_id, PDO::PARAM_STR);\n\t$sth->execute();\n\t$dbh = null;\n\t\n}\n\nif(isset($_GET['cid'])) {\n\t$get_comment = fc_get_comment($_GET['cid']);\n\t$e_comment_text = $get_comment['comment_text'];\n\t$e_comment_id = $get_comment['comment_id'];\n\tif($_SESSION['user_nick'] != $get_comment['comment_author']) {\n\t\t//you can't edit others entries\n\t\tunset($e_comment_text,$e_comment_id);\n\t}\n}\n\n\n\n$chat_form = str_replace('{form_action}', \"acp.php?tn=dashboard\", $chat_form);\n$chat_form = str_replace('{value_textarea}', \"$e_comment_text\", $chat_form);\n$chat_form = str_replace('{value_send_btn}', $lang['save'], $chat_form);\n$chat_form = str_replace('{value_hidden_id}', \"$e_comment_id\", $chat_form);\n$chat_form = str_replace('{token}', $_SESSION['token'], $chat_form);\n$chat_form = str_replace('{form_legend}', $lang['label_comment'], $chat_form);\n\n$comment_entry_tpl = file_get_contents('templates/comment-entry.tpl');\n\necho '<div class=\"scroll-conatiner\" id=\"inlineComments\">';\n\necho $chat_form;\n\nif(isset($_POST['comment'])) {\n\tif(is_numeric($_POST['id'])) {\n\t\tfc_write_comment($_SESSION['user_nick'], $_POST['comment'], \"c\", $_POST['id']);\n\t} else {\n\t\tfc_write_comment($_SESSION['user_nick'], $_POST['comment'], \"c\");\n\t}\n}\n\n$comments = fc_get_comments('c');\n$cnt_comment = count($comments);\n\nfor($i=0;$i<$cnt_comment;$i++) {\n\n\t$comment_time = date(\"d.m.Y H:i:s\", $comments[$i]['comment_time']);\n\t$comment_author = $comments[$i]['comment_author'];\n\t$comment_text = nl2br($comments[$i]['comment_text']);\n\t$comment_id = $comments[$i]['comment_id'];\n\t\n\t$author_avatar_path = '../'. FC_CONTENT_DIR . '/avatars/' . md5($comment_author) . '.png';\n\t$author_avatar = '<img src=\"images/avatar.png\" class=\"img-circle avatar\" width=\"64\" height=\"64\">';\n\tif(is_file(\"$author_avatar_path\")) {\n\t\t$author_avatar = '<img src=\"'.$author_avatar_path.'\" class=\"img-circle avatar\" width=\"64\" height=\"64\">';\n\t}\n\t\n\tunset($show_entry);\n\t\n\tif($_SESSION['user_nick'] == $comment_author) {\n\t\t$show_entry = str_replace('{entry_edit_btn}', '<a class=\"btn btn-primary btn-xs\" href=\"acp.php?tn=dashboard&cid='.$comment_id.'\">'.$lang['edit'].'</a>', $comment_entry_tpl);\n\t\t$show_entry = str_replace('{entry_delete_btn}', '<a class=\"btn btn-danger btn-xs\" href=\"acp.php?tn=dashboard&dcid='.$comment_id.'\"><span class=\"glyphicon glyphicon-trash\"></span></a>', $show_entry);\n\t} else {\n\t\t$show_entry = str_replace('{entry_edit_btn}', '', $comment_entry_tpl);\n\t\t$show_entry = str_replace('{entry_delete_btn}', '', $show_entry);\n\t}\n\t$show_entry = str_replace('{comment_avatar}', $author_avatar, $show_entry);\n\t$show_entry = str_replace('{comment_author}', $comment_author, $show_entry);\n\t$show_entry = str_replace('{comment_time}', $comment_time, $show_entry);\n\t$show_entry = str_replace('{comment_text}', $comment_text, $show_entry);\n\t\n\techo $show_entry;\n}\n\necho'</div>';\n\necho'</div>'; // #chat\necho'<div class=\"tab-pane fade\" id=\"log\">';\n\necho '<div class=\"scroll-container\">';\nshow_log(10);\necho'</div>';\necho'</div>'; // #log\n\necho'</div>'; // .tab-content\n\necho'</div>';\n\n\necho'</div>';\n\n\n\n\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire 'core/access.php';\n\n\nif(isset($_POST['saveDesign'])) {\n\n\t// all incoming data -> strip_tags\n\tforeach($_POST as $key => $val) {\n\t\t$$key = @strip_tags($val); \n\t}\n\t\n\t// template\n\t$select_template = explode(\"<|-|>\", $_POST['select_template']);\n\t$prefs_template = $select_template[0];\n\t$prefs_template_layout = $select_template[1];\n\t\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t\n\t$pdo_fields = array(\n\t\t'prefs_template' => 'STR',\n\t\t'prefs_template_layout' => 'STR'\n\t);\n\n\t$sql = generate_sql_update_str($pdo_fields,\"fc_preferences\",\"WHERE prefs_id = 1\");\n\t$sth = $dbh->prepare($sql);\n\n\tgenerate_bindParam_str($pdo_fields,$sth);\n\t$sth->bindParam(':prefs_template', $prefs_template, PDO::PARAM_STR);\n\t$sth->bindParam(':prefs_template_layout', $prefs_template_layout, PDO::PARAM_STR);\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$sys_message = \"{OKAY} $lang[db_changed]\";\n\t\trecord_log($_SESSION['user_nick'],\"edit system design <b>$prefs_template</b>\",\"6\");\n\t} else {\n\t\t$sys_message = \"{ERROR} $lang[db_not_changed]\";\n\t\trecord_log($_SESSION['user_nick'],\"error on saving system design\",\"11\");\n\t}\n\n}\n\nif($sys_message != \"\"){\n\tprint_sysmsg(\"$sys_message\");\n}\n\necho '<form action=\"acp.php?tn=moduls&sub=t\" method=\"POST\" class=\"form-horizontal\">';\necho '<fieldset>';\necho '<legend>'.$lang['f_prefs_layout'].'</legend>';\n\n\n$arr_Styles = get_all_templates();\n\n$select_prefs_template = '<select name=\"select_template\" class=\"form-control\">';\n\n\n/* templates list */\nforeach($arr_Styles as $template) {\n\n\t$arr_layout_tpl = glob(\"../styles/$template/templates/layout*.tpl\");\n\t\n\t$select_prefs_template .= \"<optgroup label='$template'>\";\n\t\n\tforeach($arr_layout_tpl as $layout_tpl) {\n\t\t$layout_tpl = basename($layout_tpl);\n\t\t\n\t\t$selected = \"\";\n\t\tif($template == \"$prefs_template\" && $layout_tpl == \"$prefs_template_layout\") {\n\t\t\t$selected = \"selected\";\n\t\t}\n\t\t$select_prefs_template .= \"<option $selected value='$template<|-|>$layout_tpl'>$template \u00bb $layout_tpl</option>\";\n\t}\n\t$select_prefs_template .= '</optgroup>';\n\n}\n\n$select_prefs_template .= '</select>';\n\necho tpl_form_control_group('',$lang['f_prefs_active_template'],$select_prefs_template);\n\n\necho '<div class=\"formfooter\">';\necho '<input type=\"submit\" class=\"btn btn-success\" name=\"saveDesign\" value=\"'.$lang['save'].'\">';\necho '</div>';\n\necho '<input type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\n\necho '</fieldset>';\necho '</form>';\n\n\n/**\n * theme options\n */\n\necho '<fieldset>';\necho '<legend>'.$prefs_template.'</legend>';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-9\">';\n\nif(is_file(\"../styles/$prefs_template/php/options.php\")) {\n\tinclude(\"../styles/$prefs_template/php/options.php\");\n}\n\necho '</div>';\necho '<div class=\"col-md-3\">';\n\nif(is_file(\"../styles/$prefs_template/images/preview.png\")) {\n\techo '<img src=\"../styles/'.$prefs_template.'/images/preview.png\" class=\"img-responsive img-rounded\">';\n}\n\necho '<table class=\"table table-condensed\">';\nif(is_file('../styles/'.$prefs_template.'/info.xml')) {\n\t$theme_xml = simplexml_load_file('../styles/'.$prefs_template.'/info.xml');\n\t//print_r($info_xml);\n\t\n\techo '<tr>';\n\techo '<td>Theme:</td>';\n\techo '<td>' . $theme_xml->name . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>Version:</td>';\n\techo '<td>' . $theme_xml->version . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>License:</td>';\n\techo '<td>' . $theme_xml->license . '</td>';\n\techo '</tr>';\n\techo '<tr>';\n\techo '<td>Author:</td>';\n\techo '<td>' . $theme_xml->author . '</td>';\n\techo '</tr>';\n\tif($theme_xml->author_url != '') {\n\t\techo '<tr>';\n\t\techo '<td>URL:</td>';\n\t\techo '<td><a href=\"'.$theme_xml->author_url.'\">' . $theme_xml->author_url . '</a></td>';\n\t\techo '</tr>';\t\t\n\t}\n\techo '<tr>';\n\techo '<td>Requires</td>';\n\techo '<td>';\n\tforeach ($theme_xml->requires -> core as $requires) {\n\t    switch((string) $requires['type']) {\n\t    case 'min':\n\t        echo 'min: ' . $requires . '<br>';\n\t        break;\n\t    case 'max':\n\t        echo 'max: ' . ($requires > 0 ? $requires : 'unknown');\n\t        break;\n\t    }\n\t}\n\techo '</td>';\n\techo '<tr>';\n}\necho '</table>';\n\necho '</div>';\necho '</div>';\n\n\necho '</fieldset>';\n\n\n?>", "<?php\n//prohibit unauthorized access\nrequire 'core/access.php';\n\n\necho '<form id=\"editpage\" action=\"acp.php?tn=pages&sub=edit&editpage='.$editpage.'\" class=\"form-horizontal\" method=\"POST\">';\n\n$custom_fields = get_custom_fields();\nsort($custom_fields);\n$cnt_custom_fields = count($custom_fields);\necho '<div class=\"row\" style=\"margin-right:0;\">';\necho '<div class=\"col-lg-9 col-md-8 col-sm-12\">';\n\necho '<ul class=\"nav nav-tabs\" id=\"bsTabs\">';\necho '<li class=\"active\"><a href=\"#info\" data-toggle=\"tab\">'.$lang['tab_info'].'</a></li>';\necho '<li><a href=\"#content\" data-toggle=\"tab\">'.$lang['tab_content'].'</a></li>';\necho '<li><a href=\"#extracontent\" data-toggle=\"tab\">'.$lang['tab_extracontent'].'</a></li>';\necho '<li><a href=\"#meta\" data-toggle=\"tab\">'.$lang['tab_meta'].'</a></li>';\necho '<li><a href=\"#head\" data-toggle=\"tab\">'.$lang['tab_head'].'</a></li>';\nif($cnt_custom_fields > 0) {\n\techo '<li><a href=\"#custom\" data-toggle=\"tab\">'.$lang['legend_custom_fields'].'</a></li>';\n}\necho '</ul>';\n\n\necho '<div class=\"tab-content\">';\n\n/* tab_info */\necho'<div class=\"tab-pane fade in active\" id=\"info\">';\n\n$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n$sql = \"SELECT page_linkname, page_sort, page_title, page_language FROM fc_pages\n\t\t    WHERE page_sort != 'portal'\n\t\t    ORDER BY page_language ASC, page_sort ASC\t\";\n$all_pages = $dbh->query($sql)->fetchAll();\n\n$dbh = null;\n\n$all_pages = fc_array_multisort($all_pages, 'page_language', SORT_ASC, 'page_sort', SORT_ASC, SORT_NATURAL);\n\n\n$select_page_position  = '<select name=\"page_position\" class=\"form-control\">';\n$select_page_position .= '<option value=\"null\">' . $lang['legend_unstructured_pages'] . '</option>';\n\n\nif($page_sort == \"portal\") {\n\t$select_page_position .= '<option value=\"portal\" selected>' . $lang['f_homepage'] . '</option>';\n} else {\n\t$select_page_position .= '<option value=\"portal\">' . $lang['f_homepage'] . '</option>';\n}\n\nif(ctype_digit($page_sort)) {\n\t$select_page_position .= '<option value=\"mainpage\" selected>'.$lang['f_mainpage'].'</option>';\n} else {\n\t$select_page_position .= '<option value=\"mainpage\">'.$lang['f_mainpage'].'</option>';\n}\n\n$select_page_position .= '<optgroup label=\"'.$lang['f_subpage'].'\">';\nfor($i=0;$i<count($all_pages);$i++) {\n\n\tif($all_pages[$i]['page_sort'] == $page_sort) {\n\t\tcontinue;\n\t}\n\t\n\tif($all_pages[$i]['page_sort'] == \"\") {\n\t\tcontinue;\n\t}\n\t\n\tif($pos = strripos($page_sort,\".\")) {\n\t\t$string = substr($page_sort,0,$pos);\n\t}\n\t\t \n\t\t $parent_string = $all_pages[$i]['page_sort'];\n\t\t \n\t\t unset($selected);\n\t\t if($parent_string != \"\" && $parent_string == \"$string\") {\n\t\t \t$selected = \"selected\";\n\t\t }\n\t\t \n\t$short_title = first_words($all_pages[$i]['page_title'], 6);\n\t$indent = str_repeat(\"-\",substr_count($parent_string,'.'));\n\t$select_page_position .= \"<option value='$parent_string' $selected> $indent \" . $all_pages[$i]['page_sort'] . ' - ' .$all_pages[$i]['page_linkname'] . ' - ' . $short_title .\"</option>\";\n\t\n}\n$select_page_position .= '</optgroup>';\n$select_page_position .= '</select>';\n\necho tpl_form_control_group('',$lang['f_page_position'],$select_page_position);\n\nif($page_sort != \"portal\") {\n\n\t$page_order = substr (strrchr ($page_sort, \".\"), 1);\n\tif(ctype_digit($page_sort)) {\n\t\t$page_order = $page_sort;\n\t}\n\t\n\techo tpl_form_control_group('',$lang['f_page_order'],\"<input class='form-control' type='text' name='page_order' value='$page_order'>\");\n\t\n\n}\n\necho '<hr>';\necho tpl_form_control_group('',$lang['f_page_linkname'],'<input class=\"form-control\" type=\"text\" name=\"page_linkname\" value=\"'.$page_linkname.'\">');\necho tpl_form_control_group('',$lang['f_page_permalink'],\"<input class='form-control' type='text' name='page_permalink' value='$page_permalink'>\");\n\nif(empty($page_permalink_short_cnt)) {\n\t$page_permalink_short_cnt = 0;\n}\n\necho '<div class=\"form-group\">';\necho '<label class=\"control-label control-label-normal col-md-2\">'.$lang['f_page_permalink_short'].'</label>';\necho '<div class=\"col-sm-10\">';\necho '<div class=\"input-group\">';\necho '<input class=\"form-control\" type=\"text\" name=\"page_permalink_short\" value=\"'.$page_permalink_short.'\">';\necho '<span class=\"input-group-addon\">'.$page_permalink_short_cnt.'</span>';\necho '</div>';\necho '</div>';\necho '</div>';\n\necho tpl_form_control_group('',$lang['f_page_hash'],\"<input class='form-control' type='text' name='page_hash' value='$page_hash'>\");\n\n$select_page_redirect_code  = '<select name=\"page_redirect_code\" class=\"form-control\">';\nif($page_redirect_code == '') {\n\t$page_redirect_code = 301;\n}\nfor($i=0;$i<10;$i++) {\n\t$redirect_code = 300+$i;\n\tunset($sel_page_redirect_code);\n\tif($page_redirect_code == $redirect_code) {\n\t\t$sel_page_redirect_code = 'selected';\n\t}\n\t$select_page_redirect_code .= '<option value=\"'.$redirect_code.'\" '.$sel_page_redirect_code.'>'.$redirect_code.'</option>';\n}\n$select_page_redirect_code .= '</select>';\n\necho tpl_form_control_group('',$lang['f_page_redirect'],'<div class=\"row\"><div class=\"col-md-3\">'.$select_page_redirect_code.'</div><div class=\"col-md-9\"><input class=\"form-control\" type=\"text\" name=\"page_redirect\" value=\"'.$page_redirect.'\"></div></div>');\n\necho '</div>'; /* EOL tab_info */\n\n\n/* tab_content */\necho '<div class=\"tab-pane fade\" id=\"content\">';\n\necho '<textarea name=\"page_content\" class=\"form-control mceEditor textEditor switchEditor\" id=\"textEditor\">'.$page_content.'</textarea>';\n\necho\"</div>\";\n/* EOL tab_content */\n\n\n/* tab_extracontent */\n\necho '<div class=\"tab-pane fade\" id=\"extracontent\">';\n\necho '<textarea name=\"page_extracontent\" class=\"form-control mceEditor textEditor switchEditor\" id=\"textEditor2\">'.$page_extracontent.'</textarea>';\n\necho '</div>'; /* EOL tab_extracontent */\n\n\n\n/* tab_meta */\necho '<div class=\"tab-pane fade\" id=\"meta\">';\n\necho tpl_form_control_group('',$lang['f_page_title'],'<input class=\"form-control\" type=\"text\" name=\"page_title\" value=\"'.$page_title.'\">');\n\nif($page_meta_author == \"\") {\n\t$page_meta_author = $_SESSION['user_firstname'] .' '. $_SESSION['user_lastname'];\n}\n\necho tpl_form_control_group('',$lang['f_meta_author'],'<input class=\"form-control\" type=\"text\" name=\"page_meta_author\" value=\"'.$page_meta_author.'\">');\necho tpl_form_control_group('',$lang['f_meta_keywords'],'<input class=\"form-control\" type=\"text\" name=\"page_meta_keywords\" value=\"'.$page_meta_keywords.'\" data-role=\"tagsinput\">');\necho tpl_form_control_group('',$lang['f_meta_description'],\"<textarea name='page_meta_description' class='form-control cntValues' rows='5'>$page_meta_description</textarea>\");\n\n\necho '<div class=\"form-group\">';\necho '<label class=\"control-label control-label-normal col-sm-2\">'.$lang['page_thumbnail'].'</label>';\necho '<div class=\"col-sm-10\">';\n\t\t\necho '<div class=\"scroll-container\">';\necho '<select name=\"page_thumbnail\" class=\"form-control image-picker\">';\necho '<option value=\"\">'.$lang['page_thumbnail'].'</option>';\n$arr_Images = get_all_images();\n\tforeach($arr_Images as $page_thumbnails) {\n\t\t$selected = \"\";\n\t\tif($page_thumbnail == \"$page_thumbnails\") {\n\t\t\t$selected = \"selected\";\n\t\t}\n\t\techo '<option '.$selected.' data-img-src=\"/content/images/'.$page_thumbnails.'\" class=\"masonry-item\" value=\"'.$page_thumbnails.'\">'.$page_thumbnails.'</option>';\n}\necho '</select>';\necho '</div>';\necho '</div>';\necho '</div>';\n\necho '</fieldset>';\n\n\n$select_page_meta_robots  = '<select name=\"page_meta_robots\" class=\"form-control\">';\n$select_page_meta_robots .= '<option value=\"all\" '.($page_meta_robots == \"all\" ? 'selected=\"selected\"' :'').'>all</option>';\n$select_page_meta_robots .= '<option value=\"noindex\" '.($page_meta_robots == \"noindex\" ? 'selected=\"selected\"' :'').'>noindex</option>';\n$select_page_meta_robots .= '<option value=\"nofollow\" '.($page_meta_robots == \"nofollow\" ? 'selected=\"selected\"' :'').'>nofollow</option>';\n$select_page_meta_robots .= '<option value=\"noodp\" '.($page_meta_robots == \"noodp\" ? 'selected=\"selected\"' :'').'>noodp</option>';\n$select_page_meta_robots .= '<option value=\"noydir\" '.($page_meta_robots == \"noydir\" ? 'selected=\"selected\"' :'').'>noydir</option>';\n$select_page_meta_robots .= '</select>';\necho tpl_form_control_group('',$lang['f_meta_robots'],$select_page_meta_robots);\n\n\n\necho '</div>'; /* EOL tab_meta */\n\n\n\n/* tab_head */\necho '<div class=\"tab-pane fade\" id=\"head\">';\n\necho $lang['f_head_styles'];\necho '<span class=\"silent\"> &lt;style type=&quot;text/css&quot;&gt;</span> ... <span class=\"silent\">&lt;/styles&gt;</span>';\necho '<textarea name=\"page_head_styles\" class=\"form-control aceEditor_css\" rows=\"12\">'.$page_head_styles.'</textarea>';\necho '<div id=\"CSSeditor\"></div>';\n\necho '<hr>';\n\necho $lang['f_head_enhanced'];\necho '<span class=\"silent\"> &lt;head&gt;</span> ... <span class=\"silent\">&lt;/head&gt;</span>';\necho '<textarea name=\"page_head_enhanced\" class=\"form-control aceEditor_html\" rows=\"12\">'.$page_head_enhanced.'</textarea>';\necho '<div id=\"HTMLeditor\"></div>';\n\necho '</div>'; /* EOL tab_head */\n\n\n\nif($cnt_custom_fields > 0) {\n\n/* tab custom fields */\necho '<div class=\"tab-pane fade\" id=\"custom\">';\n\n\tfor($i=0;$i<$cnt_custom_fields;$i++) {\n\t\t\n\t\t$custom_field_value = '';\n\t\t$custom_field_value = ${$custom_fields[$i]};\n\t\tif(substr($custom_fields[$i],0,10) == \"custom_one\") {\n\t\t\t$label = substr($custom_fields[$i],11);\n\t\t\techo tpl_form_control_group('',$label,'<input type=\"text\" class=\"form-control\" name=\"'.$custom_fields[$i].'\" value=\"'.$custom_field_value.'\">');\n\t\t}\telseif(substr($custom_fields[$i],0,11) == \"custom_text\") {\n\t\t\t$label = substr($custom_fields[$i],12);\n\t\t\techo tpl_form_control_group('',$label,\"<textarea class='form-control' rows='6' name='$custom_fields[$i]'>\" .$custom_field_value. \"</textarea>\");\n\t\t}\telseif(substr($custom_fields[$i],0,14) == \"custom_wysiwyg\") {\n\t\t\t$label = substr($custom_fields[$i],15);\n\t\t\techo tpl_form_control_group('',$label,\"<textarea class='mceEditor_small' name='$custom_fields[$i]'>\" .$custom_field_value. \"</textarea>\");\n\t\t}\t\t\n\t}\n\necho '</div>'; /* EOL tab custom fields */\n\n}\n\necho '</div>'; // EOL fancytabs\n\necho '</div>';\necho '<div class=\"col-lg-3 col-md-4 col-sm-12\">';\n\n\necho '<div class=\"panel panel-default\">';\necho '<div class=\"panel-heading\">'.$lang['tab_page_preferences'].'</div>';\necho '<div class=\"panel-body\" style=\"padding-left:30px;padding-right:30px;\">';\n\n\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE1\"> WYSIWYG</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE2\"> Text</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE3\"> Code</label>';\necho '</div>';\necho '</div>';\n\n\n/* Select Language */\n$arr_lang = get_all_languages();\n\n$select_page_language  = '<select name=\"page_language\" class=\"form-control\">';\nfor($i=0;$i<count($arr_lang);$i++) {\n\n\t$lang_sign = $arr_lang[$i]['lang_sign'];\n\t$lang_desc = $arr_lang[$i]['lang_desc'];\n\t$lang_folder = $arr_lang[$i]['lang_folder'];\n\t$select_page_language .= \"<option value='$lang_folder'\".($page_language == \"$lang_folder\" ? 'selected=\"selected\"' :'').\">$lang_sign ($lang_desc)</option>\";\t\n\n} // eo $i\n\n$select_page_language .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_language'].'</label>';\necho $select_page_language;\necho '</div>';\n\n\n/* Select Template */\n\n$arr_Styles = get_all_templates();\n\n$select_select_template = '<select id=\"select_template\" name=\"select_template\"  class=\"form-control\">';\n\nif($page_template == '') {\n\t$selected_standard = 'selected';\n}\n\n$select_select_template .= \"<option value='use_standard<|-|>use_standard' $selected_standard>$lang[use_standard]</option>\";\n\n/* templates list */\nforeach($arr_Styles as $template) {\n\n\t$arr_layout_tpl = glob(\"../styles/$template/templates/layout*.tpl\");\n\t\n\t$select_select_template .= \"<optgroup label='$template'>\";\n\t\n\tforeach($arr_layout_tpl as $layout_tpl) {\n\t\t$layout_tpl = basename($layout_tpl);\n\t\n\t\t$selected = '';\n\t\tif($template == \"$page_template\" && $layout_tpl == \"$page_template_layout\") {\n\t\t\t$selected = 'selected';\n\t\t}\n\t\t\n\t\t$select_select_template .=  \"<option $selected value='$template<|-|>$layout_tpl'>$template \u00bb $layout_tpl</option>\";\n\t}\n\t\n\t$select_select_template .= '</optgroup>';\n\n}\n\n$select_select_template .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_template'].'</label>';\necho $select_select_template;\necho '</div>';\n\n/* Select Modul */\n\n$arr_iMods = get_all_moduls();\n\n$select_page_modul = '<select name=\"page_modul\"  class=\"form-control\">';\n\n$select_page_modul .= '<option value=\"\">Kein Modul</option>';\n\nfor($i=0;$i<count($arr_iMods);$i++) {\n\n\t$selected = \"\";\n\t$mod_name = $arr_iMods[$i]['name'];\n\t$mod_folder = $arr_iMods[$i]['folder'];\n\n\tif($mod_folder == \"$page_modul\") {\n\t\t$selected = \"selected\";\n\t}\n\n\t$select_page_modul .= \"<option value='$mod_folder' $selected>$mod_name</option>\";\n\n}\n\n\n$select_page_modul .= '</select>';\n\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_modul'].'</label>';\necho $select_page_modul;\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_modul_query'].'</label>';\necho \"<input class='form-control' type='text' name='page_modul_query' value='$page_modul_query'>\";\necho '</div>';\n\n\n/* Select  Status */\n\nunset($checked_status);\n\nif($page_status == \"\") {\n\t$page_status = \"public\";\n}\n\n\n$select_page_status = '<div class=\"text-center\">';\n$select_page_status .= '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-public '.($page_status == \"public\" ? 'active' :'').' \">';\n$select_page_status .= \"<input type='radio' name='page_status' value='public'\".($page_status == \"public\" ? 'checked' :'').\"> $lang[f_page_status_puplic]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-ghost '.($page_status == \"ghost\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='ghost'\".($page_status == \"ghost\" ? 'checked' :'').\"> $lang[f_page_status_ghost]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-private '.($page_status == \"private\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='private'\".($page_status == \"private\" ? 'checked' :'').\"> $lang[f_page_status_private]\";\n$select_page_status .= '</label>';\n\n$select_page_status .= '<label class=\"btn btn-xs btn-default btn-draft '.($page_status == \"draft\" ? 'active' :'').'\">';\n$select_page_status .= \"<input type='radio' name='page_status' value='draft'\".($page_status == \"draft\" ? 'checked' :'').\"> $lang[f_page_status_draft]\";\t\n$select_page_status .= '</label>';\n\n$select_page_status .= '</div>';\n$select_page_status .= '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_status'].'</label>';\necho '<div>';\necho $select_page_status;\necho '</div>';\necho '</div>';\n\n\n/* Select Usergroups */\n\n$arr_groups = get_all_groups();\n$arr_checked_groups = explode(\",\",$page_usergroup);\n\nfor($i=0;$i<count($arr_groups);$i++) {\n\n\t$group_id = $arr_groups[$i]['group_id'];\n\t$group_name = $arr_groups[$i]['group_name'];\n\n\tif(in_array(\"$group_name\", $arr_checked_groups)) {\n\t\t$checked = \"checked\";\n\t} else {\n\t\t$checked = \"\";\n\t}\n\t\n\t$checkbox_usergroup .= '<div class=\"checkbox\"><label>';\n\t$checkbox_usergroup .= \"<input type='checkbox' $checked name='set_usergroup[]' value='$group_name'> $group_name\";\n\t$checkbox_usergroup .= '</label></div>';\n}\n\necho '<div class=\"form-group\">';\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#usergroups\">'.$lang['choose_usergroup'].'</a>';\necho '<div id=\"usergroups\" class=\"collapse\">';\necho $checkbox_usergroup;\necho '</div>';\necho '</div>';\n\n\n/* Select Rights Management */\n\n$arr_admins = get_all_admins();\n$arr_checked_admins = explode(\",\", $page_authorized_users);\n$cnt_admins = count($arr_admins);\n\nfor($i=0;$i<$cnt_admins;$i++) {\n\n\t$user_nick = $arr_admins[$i]['user_nick'];\n\n  if(in_array(\"$user_nick\", $arr_checked_admins)) {\n\t\t$checked_user = \"checked\";\n\t} else {\n\t\t$checked_user = \"\";\n\t}\n\t\t\n\t$checkbox_set_authorized_admins .= '<div class=\"checkbox\"><label>';\n \t$checkbox_set_authorized_admins .= \"<input type='checkbox' $checked_user name='set_authorized_admins[]' value='$user_nick'> $user_nick\";\n \t$checkbox_set_authorized_admins .= '</label></div>';\n}\n\n\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#admins\">'.$lang['f_page_authorized_admins'].'</a>';\necho '<div id=\"admins\" class=\"collapse\">';\necho $checkbox_set_authorized_admins;\necho '</div>';\necho '</div>';\n\n\n\n/* select labels */\n\n\n$cnt_labels = count($fc_labels);\n$arr_checked_labels = explode(\",\", $page_labels);\n\nfor($i=0;$i<$cnt_labels;$i++) {\n\t$label_title = $fc_labels[$i]['label_title'];\n\t$label_id = $fc_labels[$i]['label_id'];\n\t$label_color = $fc_labels[$i]['label_color'];\n\t\n  if(in_array(\"$label_id\", $arr_checked_labels)) {\n\t\t$checked_label = \"checked\";\n\t} else {\n\t\t$checked_label = \"\";\n\t}\n\t\n\t$checkbox_set_labels .= '<div class=\"checkbox\"><label>';\n \t$checkbox_set_labels .= \"<input type='checkbox' $checked_label name='set_page_labels[]' value='$label_id'> $label_title\";\n \t$checkbox_set_labels .= '</label></div>';\n\t\n}\n\n\necho '<div class=\"well well-sm\">';\necho '<a href=\"#\" data-toggle=\"collapse\" data-target=\"#labels\">'.$lang['labels'].'</a>';\necho '<div id=\"labels\" class=\"collapse\">';\necho $checkbox_set_labels;\necho '</div>';\necho '</div>';\n\necho '</div>'; // form-group\n\n\n\necho '<input type=\"hidden\" name=\"page_version\" value=\"'.$page_version.'\">';\necho '<input type=\"hidden\" name=\"modus\" value=\"'.$modus.'\">';\n\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\">';\necho '<div class=\"btn-group\">'.$submit_button.'</div><div class=\"btn-group\">'.$previev_button.'</div>';\necho '</div>';\necho $delete_button;\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\n\necho '</div>'; // panel-body\necho '</div>'; // panel\n\necho '</div>'; // col\necho '</div>'; // row\n\n\n//submit form to save data\n\n\n\necho '</form>';\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n$system_snippets = array('footer_text', 'extra_content_text', 'agreement_text', 'account_confirm', 'account_confirm_mail', 'no_access');\n$modus = 'new';\n\n\nif(isset($_REQUEST['suggest_name'])) {\n\t$textlib_name = clean_filename($_REQUEST['suggest_name']);\n}\n\n/**\n * delete snippet\n */\n\nif(isset($_POST['delete_snippet'])) {\n\n\t$delete_snip_id = (int) $_POST['snip_id'];\n\n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$sql = \"DELETE FROM fc_textlib WHERE textlib_id = $delete_snip_id\";\n  $cnt_changes = $dbh->exec($sql);\n\n\tif($cnt_changes > 0){\n\t\t$sys_message = '{OKAY} '. $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"deleted snippet id: $delete_snip_id\",\"10\");\n\t\t$modus = 'new';\n\t} else {\n\t\t$sys_message = '{ERROR} ' . $lang['db_not_changed'];\n\t}\n\t\n\tprint_sysmsg(\"$sys_message\");\n\n}\n\n\n/* Save Textsnippet */\nif(isset($_POST['save_snippet'])) {\n\n\t// connect to database\n\t$db = new PDO(\"sqlite:\".CONTENT_DB);\n\t\n\t$snippet_name = clean_filename($_POST['snippet_name']);\n\t\n\tif($snippet_name == '') {\n\t\t$snippet_name = date(\"Y_m_d_h_i\",time());\n\t}\n\t\n\tif($_POST['snip_id'] != '') {\n\t\t\n\t\t$snip_id = (int) $_POST['snip_id'];\n\t\n\t\t$sql = \"UPDATE fc_textlib\n\t\t\t\t\t\tSET textlib_content = :textlib_content, textlib_notes = :textlib_notes, textlib_groups = :textlib_groups,\n\t\t\t\t\t\t\t\ttextlib_name = :textlib_name, textlib_title = :textlib_title, textlib_keywords = :textlib_keywords,\n\t\t\t\t\t\t\t\ttextlib_lang = :textlib_lang\n\t\t\t\t\t\tWHERE textlib_id = $snip_id\";\n\t\n\t} else {\n\t\t\n\t\t$sql = \"INSERT INTO fc_textlib (\n\t\t\t\t\t\t\ttextlib_content, textlib_notes, textlib_groups, textlib_name, textlib_title, textlib_keywords, textlib_lang\n\t\t\t\t\t\t) VALUES (\n\t\t\t\t\t\t\t:textlib_content, :textlib_notes, :textlib_groups, :textlib_name, :textlib_title, :textlib_keywords, :textlib_lang\n\t\t\t\t\t\t)\";\t\t\n\t}\n\t\n\t$sth = $db->prepare($sql);\n\t$sth->bindParam(':textlib_content', $_POST['textlib_content'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_name', $snippet_name, PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_lang', $_POST['sel_language'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_notes', $_POST['textlib_notes'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_keywords', $_POST['snippet_keywords'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_title', $_POST['snippet_title'], PDO::PARAM_STR);\n\t$sth->bindParam(':textlib_groups', $_POST['snippet_groups'], PDO::PARAM_STR);\n\t$cnt_changes = $sth->execute();\n\t\n\t$db = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$sys_message = \"{OKAY} $lang[db_changed]\";\n\t\trecord_log(\"$_SESSION[user_nick]\",\"edit textlib <b>$snippet_title</b>\",\"2\");\n\t} else {\n\t\t$sys_message = \"{ERROR} $lang[db_not_changed]\";\n\t}\n\t\n\tprint_sysmsg(\"$sys_message\");\n\n} // eol save text\n\n\n\n/**\n * get all saved snippets\n */\n\n$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\n$sql = \"SELECT * FROM fc_textlib ORDER BY textlib_name ASC\";\n\nforeach($system_snippets as $snippet) {\n\t$snippet_exception[] = \" textlib_name != '$snippet' \";\n}\n\nforeach ($dbh->query($sql) as $row) {\n\t$snippets_list[] = $row;\n}\n\n$dbh = null;\n\n$cnt_snippets = count($snippets_list);\n\n\n/**\n * open snippet\n */\n\nif(((isset($_REQUEST['snip_id'])) OR ($modus == 'update')) AND (!isset($delete_snip_id)))  {\n\n\tif(!isset($snip_id)) {\n\t\t$snip_id = (int) $_REQUEST['snip_id'];\n  }\n    \n\t$dbh = new PDO(\"sqlite:\".CONTENT_DB);\n\t$sql = \"SELECT * FROM fc_textlib WHERE textlib_id = $snip_id \";\n\n\t$result = $dbh->query($sql);\n\t$result = $result->fetch(PDO::FETCH_ASSOC);\n\n\t$dbh = null;\n\n\tif(is_array($result)) {\n\t\tforeach($result as $k => $v) {\n \t\t\t\t$$k = htmlspecialchars(stripslashes($v));\n\t\t}\n\t}\n\t$modus = 'update';\n}\n\necho '<div class=\"app-container\">';\necho '<h3>' . $lang['snippets'] . '</h3>';\necho '<div class=\"row\">';\necho '<div class=\"col-md-3\">';\n\necho '<div class=\"max-height-container\">';\necho '<div class=\"scroll-box\">';\necho '<div class=\"list-group\">';\n\nfor($i=0;$i<$cnt_snippets;$i++) {\n\t$active_class = '';\n\t$get_snip_id = $snippets_list[$i]['textlib_id'];\n\t$get_snip_name = $snippets_list[$i]['textlib_name'];\n\t$get_snip_lang = $snippets_list[$i]['textlib_lang'];\n\t\n\tif(in_array($get_snip_name, $system_snippets)) {\n\t\t$show_snip_name = '<span class=\"glyphicon glyphicon-cog\"></span> ' . $get_snip_name;\n\t} else {\n\t\t$show_snip_name = $get_snip_name;\n\t}\n\t\t\n\tunset($sel);\n\tif($snip_id == $get_snip_id) {\n\t\t$sel = \"selected\";\n\t\t$get_snip_name_editor = '[snippet]'.$get_snip_name.'[/snippet]';\n\t\t$get_snip_name_smarty = '{$fc_snippet_'.$get_snip_name.'}';\n\t\t$get_snip_name_smarty = str_replace('-', '_', $get_snip_name_smarty);\n\t}\n\t\n\tif($_REQUEST['snip_id'] == $get_snip_id) {\n\t\t$active_class = 'active';\n\t}\n\t\n\techo '<a class=\"list-group-item '.$active_class.'\" href=\"acp.php?tn=pages&sub=snippets&snip_id='.$get_snip_id.'\">'.$show_snip_name.' <span class=\"badge\">'.$get_snip_lang.'</span></a>';\n}\n\necho '</div>';\necho '</div>';\necho '</div>';\n\necho '</div>';\necho '<div class=\"col-md-9\">';\n\necho \"<form action='acp.php?tn=pages&sub=snippets' method='POST'>\";\n\n\n\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-9\">';\n\necho '<textarea class=\"form-control mceEditor switchEditor\" id=\"textEditor\" name=\"textlib_content\">'.$textlib_content.'</textarea>';\necho '<input type=\"hidden\" name=\"text\" value=\"'.$text.'\">';\n\nif($get_snip_name_editor != '') {\n\techo '<hr><div class=\"form-group\">';\n\techo '<label>Snippet</label>';\n\techo '<input type=\"text\" class=\"form-control\" placeholder=\"[snippet]...[/snippet]\" value=\"'.$get_snip_name_editor.'\" readonly>';\n\techo '</div>';\n}\n\necho '</div>';\necho '<div class=\"col-md-3\">';\n/* info col */\necho '<div class=\"well well-sm\">';\necho '<div class=\"form-group\">';\necho '<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE1\"> WYSIWYG</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE2\"> Text</label>';\necho '<label class=\"btn btn-sm btn-default\"><input type=\"radio\" name=\"optEditor\" value=\"optE3\"> Code</label>';\necho '</div>';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['filename'].' <small>(a-z,0-9)</small></label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_name\" value=\"'.$textlib_name.'\">';\necho '</div>';\n\n\n$select_textlib_language  = '<select name=\"sel_language\" class=\"form-control\">';\nfor($i=0;$i<count($arr_lang);$i++) {\n\t$lang_sign = $arr_lang[$i]['lang_sign'];\n\t$lang_desc = $arr_lang[$i]['lang_desc'];\n\t$lang_folder = $arr_lang[$i]['lang_folder'];\n\t$select_textlib_language .= \"<option value='$lang_folder'\".($textlib_lang == \"$lang_folder\" ? 'selected=\"selected\"' :'').\">$lang_sign</option>\";\t\n}\n$select_textlib_language .= '</select>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['f_page_language'].'</label>';\necho $select_textlib_language;\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_title'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_title\" value=\"'.$textlib_title.'\">';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_keywords'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_keywords\" value=\"'.$textlib_keywords.'\" data-role=\"tagsinput\" />';\necho '</div>';\n\necho '<div class=\"form-group\">';\necho '<label>'.$lang['label_groups'].'</label>';\necho '<input class=\"form-control\" type=\"text\" name=\"snippet_groups\" value=\"'.$textlib_groups.'\" />';\necho '</div>';\n\necho '<div class=\"alert alert-info\" style=\"padding:2px 3px;\">';\necho '<strong>'.$lang['label_notes'].':</strong>';\necho '<textarea class=\"masked-textarea\" name=\"textlib_notes\" rows=\"5\">'.$textlib_notes.'</textarea>';\necho '</div>';\n\necho '<div class=\"formfooter\">';\nif($modus == 'new') {\n\techo '<input type=\"submit\" name=\"save_snippet\" class=\"btn btn-success btn-block\" value=\"'.$lang['save'].'\">';\n} else {\n\techo '<input type=\"hidden\" name=\"snip_id\" value=\"'.$snip_id.'\">';\n\techo '<input type=\"submit\" name=\"save_snippet\" class=\"btn btn-success btn-block\" value=\"'.$lang['update'].'\"> ';\n\techo '<a class=\"btn btn-default btn-block\" href=\"acp.php?tn=pages&sub=snippets\">'.$lang['discard_changes'].'</a>';\n\techo '<input type=\"submit\" name=\"delete_snippet\" class=\"btn btn-danger btn-sm btn-block\" value=\"'.$lang['delete'].'\" onclick=\"return confirm(\\''.$lang['confirm_delete_data'].'\\')\">';\n}\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\n\n\necho '</div>';\n/* end info col */\necho '</div>';\necho '</div>';\n\n\necho '</form>';\n\n\necho '</div>';\necho '</div>';\necho '</div>'; // .app-container\n\n?>", "<?php\n\n$time_s = microtime(true);\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n\n// defaults\n\n$entries_per_page = 200;\n\nif($_SESSION['start'] == \"\") {\n\t$_SESSION['start'] = 0;\n}\n\nif($_REQUEST['start'] != \"\") {\n\t$_SESSION['start'] = (int) ($_REQUEST['start']*$entries_per_page);\n}\n\nif($_SESSION['filename'] == \"\") {\n\t//default: today's logfile\n\t$_SESSION['filename'] = \"logfile\" . date('Y') . date('m') . \".sqlite3\";\n}\n\nif($_POST['select_logfile']) {\n\t$_SESSION['filename'] = strip_tags($_POST['select_logfile']);\n\t$_SESSION['start'] = 0; // reset pagination\n}\n\n\n\n\n$start = $_SESSION['start'];\n$filename = $_SESSION['filename'];\n\n\n\n\n\n/* scan FC_CONTENT_DIR and return all logfiles */\n\n$log_dir = \"../\" . FC_CONTENT_DIR . \"/SQLite\";\n$logfiles = glob(\"$log_dir/logfile*\");\n\necho\"<fieldset>\";\necho\"<legend>$lang[select_logfile]</legend>\";\necho\"<form action='acp.php?tn=system&sub=stats' method='POST' class='form-inline'>\";\necho '<div class=\"form-group\">';\necho\"<select name='select_logfile' class='form-control'>\";\n\nforeach($logfiles as $fn) {\n\t\n\t$fn = basename($fn);\n\t$get_month = 'm' . substr(\"$fn\", 11, 2);\n\t$month = $lang[$get_month];\n\t$get_year = substr(\"$fn\", 7, 4);\n\n\tunset($selected);\n\tif($filename == $fn) { $selected = \"selected\"; }\n   \t\techo\"<option $selected value='$fn'>$month $get_year</option>\";\n}\n\necho\"</select> \";\necho '</div> ';\necho\"<input type='submit' class='btn btn-default' name='select_log' value='$lang[choose]'>\";\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho\"</form>\";\necho\"</fieldset>\";\n\n\n\n$logfile_path = \"../\" . FC_CONTENT_DIR . \"/SQLite/$filename\";\n\n\nif(is_file(\"$logfile_path\")) {\n\n\n// connect to database\n$dbh = new PDO(\"sqlite:$logfile_path\");\n\n\n$sql_stat = \"\nSELECT count(*) AS 'All',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%safari%' ) AS 'Safari', \n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%firefox%' ) AS 'Firefox',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%msie%' ) AS 'Internet Explorer',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%chrome%' ) AS 'Google Chrome',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%netscape%' ) AS 'Netscape',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%opera%' ) AS 'Opera',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%camino%' ) AS 'Camino',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%konqueror%' ) AS 'Konqueror',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%icab%' ) AS 'iCab',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%ipad%' ) AS 'iPad',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%iphone%' or log_ua LIKE '%ipod%' ) AS 'iPhone/iPod',\n(SELECT count(*) FROM fc_logfile WHERE log_ua LIKE '%bot%' or log_ua LIKE '%java%' or log_ua LIKE '%spider%' ) AS 'Bots'\nFROM fc_logfile\n\";\n\n$stat_result = $dbh->query(\"$sql_stat\")->fetch(PDO::FETCH_ASSOC);\n\n\n\n$cnt_entries = $stat_result['All'];\n\n\n$sql = \"SELECT * FROM fc_logfile\n\t\t\t\tORDER BY log_time DESC\n\t\t\t\tLIMIT $start, $entries_per_page\";\n\nunset($result);\nforeach ($dbh->query($sql) as $row) {\n\t$result[] = $row;\n}\n   \n$cnt_result = count($result);\n$dbh = null;\n\n\n\n\n\n$filesize = round((filesize(\"$logfile_path\") / 1024), 2);\n\n$get_month = 'm' . substr(\"$filename\", 11, 2);\n$month = $lang[$get_month];\n$get_year = substr(\"$filename\", 7, 4);\n\n\necho\"<p style='background:#ddd;padding:4px;'><b>$month $get_year</b> \u00bb $cnt_entries $lang[logfile_hits] \u00bb $filesize kb</p>\";\n\necho\"<div style='float:left;width:200px;padding:8px;'>\";\n\n\necho\"<table class='table table-condensed'>\";\n\narsort($stat_result);\n\nforeach ($stat_result as $k => $v) {\n\tif($v > 0){\n    \techo \"\t<tr>\n    \t\t\t\t\t\t<td>$k:</td>\n    \t\t\t\t\t\t<td align='right'>$v</td>\n    \t\t  \t\t</tr> \";\n    }\n}\n\n\necho\"</table>\";\n\necho\"</div>\"; // eo float\n\n\n\n/* listing */\n\necho\"<div style='margin-left:220px;padding:8px;'>\";\n\necho\"<div style='height:350px;overflow:auto;margin:0;padding:10px;background-color:#ddd;'>\";\n\n\nfor($i=0;$i<$cnt_result;$i++) {\n\n\t$log_time = date(\"d.m.Y H:i:s\",$result[$i]['log_time']);\n\t$log_ip = $result[$i]['log_ip'];\n\t$log_ref = $result[$i]['log_ref'];\n\t$log_ua = $result[$i]['log_ua'];\n\t$log_query = $result[$i]['log_query'];\n\t$log_id = $result[$i]['log_id'];\n\n\n\tif( $i%2 == \"0\" ) {\n\t\t$bg_color = \"#fff\";\n\t} else {\n\t\t$bg_color = \"#f1f1f1\";\n\t}\n\n\n\techo\"<dl class='dl-horizontal' style='background-color:$bg_color;margin:0;'>\";\n\n\techo\"<dt>Zeit:</dt> <dd>$log_time</dd>\";\n\techo\"<dt>IP:</dt> <dd>$log_ip</dd>\";\n\n\tif($log_query != \"\") {\n\t\techo\"<dt>query:</dt> <dd>$log_query</dd>\";\n\t}\n\tif($log_ref != \"\") {\n\t\techo\"<dt>Referer:</dt> <dd><span style='color:#390;'>$log_ref</span></dd>\";\n\t}\n\tif($log_ua != \"\") {\n\t\techo\"<dt>User Agent:</dt> <dd>$log_ua</dd>\";\n\t}\n\techo\"</dl>\";\n\n} // eol $i\n\n\n\necho\"</div>\";\n\n\n\n/* pagination */\n$pages = ceil($cnt_entries/$entries_per_page);\necho\"<div id='pagina'><p>\";\n\tfor($i=0;$i<$pages;$i++) {\n\t$nbr = $i+1;\n\t$pag_class = \"buttonLink\";\n\tif(($i*$entries_per_page) == \"$start\") { $pag_class = \"buttonLink_sel\"; }\n\t\techo\"<a class='$pag_class' href='$_SERVER[PHP_SELF]?tn=system&sub=stats&start=$i'>$nbr</a> \";\n\t}\n\necho\"</p></div>\";\n/* pagination */\n\n\n\n\necho\"</div>\"; // eo float div\n\n} else {\n\necho\"<div id='sys_message_error'>No logfile</div>\";\n\n}\n\n\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n$array_group_user = array();\n\n$submit_button = '<input type=\"submit\" class=\"btn btn-success\" name=\"saveGroup\" value=\"'.$lang['save'].'\">';\n$delete_button = '';\n\n\n/**\n * Update existing group\n */\n\nif($_POST['updateGroup']) {\n\n\t\n\t$arr_update_incUser = $_POST['incUser'];\n\t@sort($arr_update_incUser);\n\t$update_incUser = implode(\" \", $arr_update_incUser);\n\t\n\t$group_name = filter_var($_POST['group_name'], FILTER_SANITIZE_STRING);\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t\n\t$sql = \"UPDATE fc_groups\n\t\t\tSET group_name = :update_group_name,\n\t\t\t\tgroup_description = :update_group_description,\n\t\t\t\tgroup_user = :update_incUser\n\t\t\tWHERE group_id = :editgroup \";\n\t\t\t\n\t$sth = $dbh->prepare($sql);\n\t\n\t$sth->bindParam(':update_group_name', $group_name, PDO::PARAM_STR);\n\t$sth->bindParam(':update_group_description', $_POST['group_description'], PDO::PARAM_STR);\n\t$sth->bindParam(':update_incUser', $update_incUser, PDO::PARAM_STR);\n\t$sth->bindParam(':editgroup', $_POST['editgroup'], PDO::PARAM_INT);\n\t\t\t\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"updated usergroup: $group_name\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n\n}\n\n\n/**\n * save new group\n */\n\nif($_POST['saveGroup']) {\n\n\t\n\t$arr_new_incUser = $_POST['incUser'];\n\t\n\tif(is_array($arr_new_incUser)) {\n\t\tsort($arr_new_incUser);\n\t\t$new_incUser = implode(\" \", $arr_new_incUser);\n\t} else {\n\t\t$new_incUser = \"\";\n\t}\n\t\n\t$group_name = filter_var($_POST['group_name'], FILTER_SANITIZE_STRING);\n\t\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t\n\t$sql = \"INSERT INTO fc_groups (\n\t\t\t\tgroup_id , group_name , group_description , group_user\n\t\t\t) VALUES (\n\t\t\t\tNULL, :new_group_name, :new_group_description, :new_incUser ) \";\n\t\t\t\t\n\t$sth = $dbh->prepare($sql);\n\t\n\t$sth->bindParam(':new_group_name', $group_name, PDO::PARAM_STR);\n\t$sth->bindParam(':new_group_description', $_POST['group_description'], PDO::PARAM_STR);\n\t$sth->bindParam(':new_incUser', $new_incUser, PDO::PARAM_STR);\t\n\t\n\t$cnt_changes = $sth->execute();\n\t\n\t$dbh = null;\n\t\n\tif($cnt_changes == TRUE) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"created usergroup: $group_name\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n}\n\n\n\n/**\n * delete the selected group\n */\n\n\nif($_POST['deleteGroup']) {\n\n\t$editgroup = (int) $_POST['editgroup'];\n\t\n\t$dbh = new PDO(\"sqlite:\".USER_DB);\n\t$sql = \"DELETE FROM fc_groups WHERE group_id = $editgroup\";\n\t$cnt_changes = $dbh->exec($sql);\n\t\n\t$show_data = false;\n\t\n\tif($cnt_changes > 0) {\n\t\t$success_message = $lang['db_changed'];\n\t\trecord_log($_SESSION['user_nick'],\"deleted usergroup id: $editgroup\",\"10\");\n\t} else {\n\t\t$error_message = $lang['db_not_changed'];\n\t}\n\n}\n\n\n\n\n\n\n//print message\n\nif($success_message != \"\"){\n\techo '<div class=\"alert alert-success\"><p>'.$success_message.'</p></div>';\n}\n\nif($error_message != \"\"){\n\techo '<div class=\"alert alert-error\"><p>'.$error_message.'</p></div>';\n}\n\n\n\n\n\n\n/**\n * choose the group\n * <select>\n */\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n$sql = \"SELECT * FROM fc_groups ORDER BY group_id ASC\";\n\n$result = $dbh->query($sql);\n$result= $result->fetchAll(PDO::FETCH_ASSOC);\n\n\n$editgroup = (int) $_POST['editgroup'];\n\n\necho '<fieldset>';\necho '<legend>'.$lang['legend_choose_group'].'</legend>';\necho '<form action=\"acp.php?tn=user&sub=groups\" method=\"POST\">';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-5\">';\n\necho '<div class=\"form-group\">';\necho '<select name=\"editgroup\" class=\"form-control\">';\n\nfor($i=0;$i<count($result);$i++) {\n\n\t$group_id = $result[$i]['group_id'];\n\t$group_name = $result[$i]['group_name'];\n\t\n\tif($editgroup == $group_id) { $sel[$i] = \"selected\"; }\n\t\n\techo \"<option $sel[$i] value='$group_id'>$group_name</option>\";\n\n}\n\necho '</select>';\necho '</div>';\necho '</div>';\necho '<div class=\"col-md-3\">';\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '<input type=\"submit\" class=\"btn btn-default btn-block\" name=\"select_group\" value=\"'.$lang['edit'].'\">';\necho '</div>';\necho '</div>';\necho '</form>';\necho '</fieldset>';\n\n\n/**\n * show data of the selected group\n */\n\nif(($editgroup) && ($show_data !== false)) {\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql =  \"SELECT * FROM fc_groups WHERE group_id = $editgroup \";\n\n$result = $dbh->query($sql);\n$result= $result->fetch(PDO::FETCH_ASSOC);\n\nforeach($result as $k => $v) {\n   $$k = stripslashes($v);\n}\n\n$array_group_user = explode(\" \", $group_user);\n\n$submit_button = '<input type=\"submit\" class=\"btn btn-success\" name=\"updateGroup\" value=\"'.$lang['update'].'\">';\n$delete_button = '<input type=\"submit\" class=\"btn btn-danger\" name=\"deleteGroup\" value=\"'.$lang['delete'].'\" onclick=\"return confirm(\\''.$lang['confirm_delete_file'].'\\')\">';\n$hidden_field = '<input type=\"hidden\" name=\"editgroup\" value=\"'.$editgroup.'\">';\n\n} else {\n// no group is selected\nunset($group_name,$group_description,$hidden_field);\n}\n\n\n\n\n/**\n * FORM // EDIT GROUPS\n */\n\necho '<fieldset>';\necho '<legend>'.$lang['legend_groups_data'].'</legend>';\n\necho '<form action=\"acp.php?tn=user&sub=groups\" method=\"POST\">';\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-8\">';\n\necho '<label class=\"\">'.$lang['label_group_name'].'</label>';\necho '<input type=\"text\" class=\"form-control\" name=\"group_name\" value=\"'.$group_name.'\">';\n\necho '<label>'.$lang['label_group_description'].'</label>';\necho '<textarea class=\"mceEditor_small\" rows=\"4\" name=\"group_description\">'.$group_description.'</textarea>';\n\necho '</div>';\necho '<div class=\"col-md-4\">';\n\necho '<label>'.$lang['label_group_add_user'].'</label>';\n\necho '<div id=\"userlist\">';\necho '<div class=\"scroll-container\">';\n\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql = \"SELECT * FROM fc_user ORDER BY user_nick ASC\";\n\nunset($result);\n   foreach ($dbh->query($sql) as $row) {\n     $result[] = $row;\n   }\n\n\necho '<table class=\"table table-hover table-condensed\">';\n\nfor($i=0;$i<count($result);$i++) {\n\n\tif($result[$i]['user_class'] == \"deleted\") {\n\t\tcontinue;\n\t}\n\t\n\t$user_id = $result[$i]['user_id'];\n\t$user_nick = $result[$i]['user_nick'];\n\t$user_firstname = $result[$i]['user_firstname'];\n\t$user_lastname = $result[$i]['user_lastname'];\n\t\t\n\tif (in_array(\"$user_id\", $array_group_user)) {\n\t   $checked = \"checked\";\n\t} else {\n\t\t$checked = \"\";\n\t}\n\t\n\t\n\techo '<tr>';\n\techo '<td><label><input type=\"checkbox\" '.$checked.' name=\"incUser[]\" value=\"'.$user_id.'\"> '.$user_nick.' </label></td>\n\t\t\t<td>'.$user_firstname.' '.$user_lastname.'</td>';\n\techo '</tr>';\n} //eol $i\n\necho '</table>';\n\necho '</div>';\necho '</div>';\necho '</div>';\necho '</div>';\n\necho '<div class=\"formfooter clear\">';\necho \"$hidden_field $delete_button $submit_button\";\necho '<input  type=\"hidden\" name=\"csrf_token\" value=\"'.$_SESSION['token'].'\">';\necho '</div>';\necho '</form>';\n\necho '</fieldset>';\n\n?>", "<?php\n\n//prohibit unauthorized access\nrequire(\"core/access.php\");\n\n\n// sort by reference\nswitch ($_GET['sort']) {\ncase \"1\":\n    $order_by = \"user_nick\";\n    break;\ncase \"2\":\n    $order_by = \"user_registerdate\";\n    break;\ncase \"3\":\n    $order_by = \"user_lastname\";\n    break;\ncase \"4\":\n    $order_by = \"user_mail\";\n    break;\ncase \"5\":\n    $order_by = \"user_verified\";\n    break;\ndefault:\n\t$order_by = \"user_id\";\n}\n\n/* sort up or down */\n\nif($_GET['way'] == \"up\"){\n\t$way = \"ASC\";\n\t$set_way = \"down\";\n} else {\n\t$way = \"DESC\";\n\t$set_way = \"up\";\n}\n\n/* switch user status */\n\nif(isset($_GET['switch'])) {\n\t$_SESSION['set_user_status'] = true;\n}\n\nif($_SESSION['checked_verified'] == '' AND $_SESSION['checked_waiting'] == '' AND $_SESSION['checked_paused'] == '' AND $_SESSION['set_user_status'] == false) {\n\t$_SESSION['checked_verified'] = 'checked';\n}\n\n\nif($_GET['switch'] == 'statusWaiting' AND $_SESSION['checked_waiting'] == '') {\n\t$_SESSION['checked_waiting'] = \"checked\";\n} elseif($_GET['switch'] == 'statusWaiting' AND $_SESSION['checked_waiting'] == 'checked') {\n\t$_SESSION['checked_waiting'] = \"\";\n}\n\nif($_GET['switch'] == 'statusPaused' && $_SESSION['checked_paused'] == 'checked') {\n\t$_SESSION['checked_paused'] = \"\";\n} elseif($_GET['switch'] == 'statusPaused' && $_SESSION['checked_paused'] == '') {\n\t$_SESSION['checked_paused'] = \"checked\";\n}\n\nif($_GET['switch'] == 'statusVerified' && $_SESSION['checked_verified'] == 'checked') {\n\t$_SESSION['checked_verified'] = \"\";\n} elseif($_GET['switch'] == 'statusVerified' && $_SESSION['checked_verified'] == '') {\n\t$_SESSION['checked_verified'] = \"checked\";\n}\n\nif($_GET['switch'] == 'statusDeleted' && $_SESSION['checked_deleted'] == 'checked') {\n\t$_SESSION['checked_deleted'] = \"\";\n} elseif($_GET['switch'] == 'statusDeleted' && $_SESSION['checked_deleted'] == '') {\n\t$_SESSION['checked_deleted'] = \"checked\";\n}\n\n$set_status_filter = \"user_verified = 'foobar' \";\n\nif($_SESSION['checked_waiting'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'waiting' \";\n\t$btn_status_waiting = 'active';\n}\n\nif($_SESSION['checked_paused'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'paused' \";\n\t$btn_status_paused = 'active';\n}\n\nif($_SESSION['checked_verified'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = 'verified' \";\n\t$btn_status_verified = 'active';\n}\n\nif($_SESSION['checked_deleted'] == \"checked\") {\n\t$set_status_filter .= \"OR user_verified = '' \";\n\t$btn_status_deleted = 'active';\n}\n\n\n\n$status_btn_group  = '<div class=\"btn-group\">';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusVerified\" class=\"btn btn-fc btn-sm '.$btn_status_verified.'\"><span class=\"glyphicon glyphicon-ok\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusWaiting\" class=\"btn btn-fc btn-sm '.$btn_status_waiting.'\"><span class=\"glyphicon glyphicon-time\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusPaused\" class=\"btn btn-fc btn-sm '.$btn_status_paused.'\"><span class=\"glyphicon glyphicon-warning-sign\"></span></a>';\n$status_btn_group .= '<a href=\"acp.php?tn=user&sub=list&switch=statusDeleted\" class=\"btn btn-fc btn-sm '.$btn_status_deleted.'\"><span class=\"glyphicon glyphicon-ban-circle\"></span></a>';\n$status_btn_group .= '</div>';\n\n\n$whereString = \"WHERE user_nick != '' \";\n\nif(!empty($_POST['findUser'])) {\n\t$findUser = strip_tags($_POST['findUser']);\n\t$search_user = \"user_nick LIKE '%$findUser%' \";\n}\n\n\n\nif($set_status_filter != \"\") {\n\t$whereString .= \" AND ($set_status_filter) \";\n}\n\nif($search_user != \"\") {\n\t$whereString .= \" AND ($search_user) \";\n}\n\nunset($result);\n\n$dbh = new PDO(\"sqlite:\".USER_DB);\n\n$sql = \"SELECT user_id, user_nick, user_class, user_firstname, user_lastname, user_registerdate, user_verified, user_mail\n    \t\tFROM fc_user\n    \t\t$whereString\n    \t\tORDER BY $order_by $way\";\n\nforeach ($dbh->query($sql) as $row) {\n\t$result[] = $row;\n}\n\n$cnt_result = count($result);\n\n$dbh = null;\n\n// number to show\n$loop = 20;\n\n\n$start = 0;\nif(isset($_GET['start'])) {\n\t$start = (int) $_GET['start'];\n}\n\n$cnt_pages = ceil($cnt_result/$loop);\n\nif($start<0) {\n\t$start = 0;\n}\n\n$end = $start+$loop;\n\nif($end > $cnt_result) {\n\t$end = $cnt_result;\n}\n\n\n//next step\n$next_start = $end;\n$prev_start = $start-$loop;\n\n\n\nif($start>($cnt_result-$loop)) {\n\t$next_start = $start;\n}\n\nif($prev_start <= 0){\n\t$prev_start = 0;\n}\n\n\n$pag_backlink = \"<a class='btn btn-primary' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$prev_start&sort=$_GET[sort]'>$lang[pagination_backward]</a>\";\n\n\nfor($x=0;$x<$cnt_pages;$x++) {\n\n\t$page_start = $x*$loop;\n\t$page_nbr = $x+1;\n\n\tif($page_start == $start) {\n\t\t$aclass = \"btn btn-primary active\";\n\t} else {\n\t\t$aclass = \"btn btn-primary\";\n\t}\n\n\t$pag_string .= \"<a class='$aclass' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$page_start'>$page_nbr</a> \";\n} //eol for $x\n\n\n$pag_forwardlink = \"<a class='btn btn-primary' href='$_SERVER[PHP_SELF]?tn=user&sub=list&start=$next_start&sort=$_GET[sort]'>$lang[pagination_forward]</a>\";\n\n\necho '<div class=\"row\">';\necho '<div class=\"col-md-5\">';\necho \"<form action='acp.php?tn=user' class='form-inline' method='POST'>\";\n\necho '<div class=\"input-group\">';\necho '<span class=\"input-group-addon\"><span class=\"glyphicon glyphicon-filter\"></span></span>';\necho '<input type=\"text\" name=\"findUser\" class=\"form-control\" placeholder=\"Filter\">';\necho '</div>';\necho \"</form>\";\n\necho '</div>';\necho '<div class=\"col-md-7\">';\necho '<div style=\"float:right;\">';\necho $status_btn_group;\necho '</div>';\necho '<div class=\"clearfix\"></div>';\necho '</div>';\necho '</div><br>';\n\n\n\n//print the list\n\necho\"<table class='table table-condensed table-hover table-list' border='0' cellpadding='0' cellspacing='0'>\";\n\necho\"<thead><tr>\n<th class='head' style='text-align:right;'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=0&way=$set_way'>ID</a></th>\n<th class='head'></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=1&way=$set_way'>$lang[h_username]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=2&way=$set_way'>$lang[h_registerdate]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=3&way=$set_way'>$lang[h_realname]</a></th>\n<th class='head'><a class='darklink' href='$_SERVER[PHP_SELF]?tn=user&sub=list&sort=4&way=$set_way'>$lang[h_email]</a></th>\n<th class='head'>$lang[h_action]</th>\n</tr></thead>\";\n\nfor($i=$start;$i<$end;$i++) {\n\n\t$user_id = $result[$i]['user_id'];\n\t$user_nick = $result[$i]['user_nick'];\n\t$user_avatar_path = '../'. FC_CONTENT_DIR . '/avatars/' . md5($user_nick) . '.png';\n\t$user_class = $result[$i]['user_class'];\n\t$user_mail = $result[$i]['user_mail'];\n\t$user_registerdate = $result[$i]['user_registerdate'];\n\t$user_firstname = $result[$i]['user_firstname'];\n\t$user_lastname = $result[$i]['user_lastname'];\n\t$user_verified = $result[$i]['user_verified'];\n\t$user_groups = $result[$i]['user_groups'];\n\t$show_registerdate = @date(\"d.m.Y\",$user_registerdate);\n\t\n\t$user_avatar = '<img src=\"images/avatar.png\" class=\"img-circle avatar\" width=\"50\" height=\"50\">';\n\tif(is_file(\"$user_avatar_path\")) {\n\t\t$user_avatar = '<img src=\"'.$user_avatar_path.'\" class=\"img-circle avatar\" width=\"50\" height=\"50\">';\n\t}\n\n\t//show me in bold\n\tunset($td_class);\n\tif($user_nick == $_SESSION['user_nick']){\n\t\t$td_class = \"bold\";\n\t}\n\n\t//marking admins\n\tif($user_class == \"administrator\"){\n\t\t$admin_img = '<span style=\"color:#36a;\"><span class=\"glyphicon glyphicon-user\"></span></span>';\n\t} else {\n\t\t$admin_img = '<span class=\"glyphicon glyphicon-user\"></span>';\n\t}\n\n\t//deleted user\n\tif($user_class == \"deleted\"){\n\t\t$user_nick = \"<strike>$user_nick</strike>\";\n\t}\n\n\n\t//status image\n\tswitch ($user_verified) {\n\t\tcase \"waiting\":\n\t\t\t$statusLabel = \"label label-info center\";\n\t\t\t$tr_class = 'info';\n\t\t\tbreak;\n\t\tcase \"paused\":\n\t\t\t$statusLabel = \"label label-warning center\";\n\t\t\t$tr_class = 'warning';\n\t\t\tbreak;\n\t\tcase \"verified\":\n\t\t\t$statusLabel = \"alert alert-success center\";\n\t\t\t$tr_class = 'success';\n\t\t\tbreak;\n\t\tcase \"\":\n\t\t\t$tr_class = 'danger';\n\t\t\t$statusLabel = \"label label-default center\";\n\t\t\tbreak;\n\t}\n\t\n\techo\"\n\t<tr class='$tr_class'>\n\t\t<td class='$td_class' style='text-align:right;'>$user_id</td>\n\t\t<td>$user_avatar</td>\n\t\t<td class='$td_class'>$admin_img $user_nick</td>\n\t\t<td class='$td_class'>$show_registerdate</td>\n\t\t<td class='$td_class'>$user_firstname $user_lastname</td>\n\t\t<td class='$td_class'>$user_mail</td>\n\t\t<td class='$td_class'><a class='btn btn-default btn-sm' href='$_SERVER[PHP_SELF]?tn=user&sub=edit&edituser=$user_id'>$lang[edit]</a></td>\n\t</tr>\";\n\n\n\n} // eol for $i\n\necho\"</table>\";\n\n\necho '<div id=\"well well-sm\"><p class=\"text-center\">';\necho \"$pag_backlink $pag_string $pag_forwardlink\";\necho '</p></div>';\n\n\n?>"], "filenames": ["acp/core/dashboard.system.php", "acp/core/list.themes.php", "acp/core/pages.edit_form.php", "acp/core/pages.snippets.php", "acp/core/system.stats.php", "acp/core/user.groups.php", "acp/core/user.list.php"], "buggy_code_start_loc": [6, 50, 6, 185, 48, 164, 199], "buggy_code_end_loc": [84, 51, 267, 186, 49, 235, 200], "fixing_code_start_loc": [6, 50, 6, 185, 48, 164, 199], "fixing_code_end_loc": [91, 51, 257, 186, 49, 235, 200], "type": "CWE-79", "message": "Cross site scripting (XSS) vulnerability in pages.edit_form.php in flatCore 1.4.6 allows remote attackers to inject arbitrary JavaScript via the PATH_INFO in an acp.php URL, due to use of unsanitized $_SERVER['PHP_SELF'] to generate URLs.", "other": {"cve": {"id": "CVE-2017-9451", "sourceIdentifier": "cve@mitre.org", "published": "2017-06-06T16:29:00.267", "lastModified": "2017-06-13T17:14:07.613", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross site scripting (XSS) vulnerability in pages.edit_form.php in flatCore 1.4.6 allows remote attackers to inject arbitrary JavaScript via the PATH_INFO in an acp.php URL, due to use of unsanitized $_SERVER['PHP_SELF'] to generate URLs."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross site scripting (XSS) en el archivo pages.edit_form.php en flatCore versi\u00f3n 1.4.6, permite a los atacantes remotos inyectar JavaScript arbitrario por medio de PATH_INFO en una URL acp.php, debido al uso de $_SERVER['PHP_SELF']  no saneado para generar URLs."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:flatcore:flatcore:1.4.6:*:*:*:*:*:*:*", "matchCriteriaId": "20198BCE-94EB-46E7-9065-D518D7E25911"}]}]}], "references": [{"url": "https://github.com/flatCore/flatCore-CMS/commit/f1b42b338693a9c240182e76ef2131057f2c2a87", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/flatCore/flatCore-CMS/issues/34", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/flatCore/flatCore-CMS/commit/f1b42b338693a9c240182e76ef2131057f2c2a87"}}