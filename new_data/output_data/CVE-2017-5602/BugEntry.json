{"buggy_code": ["Jappix Changelog\n================\n\nHere's the log of what has changed over the Jappix releases.\n\n\nPrimo, v1.1.7 (Development)\n---------------------------\n\n * (...)\n\n\nPrimo, v1.1.6 (August 2015)\n---------------------------\n\n * Security fix on paths check  @valeriansaliou\n\n\nPrimo, v1.1.5 (August 2015)\n---------------------------\n\n * Critical file upload security fix  @valeriansaliou, @mathiasertl\n\n\nPrimo, v1.1.4 (April 2015)\n---------------------------\n\n * Fix various issues           @valeriansaliou\n * Fix XSS attack on dataforms  @V1RTUOZ\n\n\nPrimo, v1.1.3 (January 2015)\n----------------------------\n\n * Better default priorities        @beanow, @valeriansaliou\n * Fix IE11+ browser compatibility  @valeriansaliou\n\n\nPrimo, v1.1.2 (October 2014)\n----------------------------\n\n * XEP-0353: Jingle Message Initiation  @valeriansaliou\n * Fixes Jingle calls in Chrome 38+     @valeriansaliou\n\n\nPrimo, v1.1.1 (September 2014)\n------------------------------\n\n * Ignore empty XHTML-IM messages  @eijebong, @valeriansaliou\n * Fix a bug with message markers  @valeriansaliou\n\n\nPrimo, v1.1.0 (June 2014)\n-------------------------\n\n * XEP-0272: Multiparty Jingle (Muji)      @valeriansaliou\n * Prevent client crash on huge messages   @valeriansaliou\n * Beautified client code (JavaScript)     @valeriansaliou\n * Fix unavailable MUC rooms               @emamirazavi\n\n\nOne, v1.0.7 (May 2014)\n----------------------\n\n * Fix BackLinks design                         @valeriansaliou\n * Sort Jappix Mobile contacts alphabetically   @valeriansaliou\n * Display offline contacts in Jappix Mini      @valeriansaliou\n\n\nOne, v1.0.6 (May 2014)\n----------------------\n\n * XEP-0308: Last Message Correction               @valeriansaliou\n * XEP-0333: Chat Markers                          @valeriansaliou\n * XEP-0319: Last User Interaction into Presence   @valeriansaliou\n * XEP-0224: Attention                             @valeriansaliou\n * XEP-0152: Reachability Addresses                @valeriansaliou\n * XEP-0334: Message Processing Hints              @valeriansaliou\n * Fix gateway contacts management                 @valeriansaliou\n * Fix sounds in Jappix Mini                       @aryo, @valeriansaliou\n\n\nOne, v1.0.5 (May 2014)\n----------------------\n\n * Fix MUC bookmark shortcut button                         @valeriansaliou\n * Fix HTML5 notifications in Firefox 22+                   @valeriansaliou\n * Fix server commands tool                                 @valeriansaliou\n * New translations added (Uzbek), and a few ones updated   @nurkamol, @valeriansaliou\n\n\nOne, v1.0.4 (May 2014)\n----------------------\n\n * Fix update tool (on some environments)               @valeriansaliou\n * Fix MUC room join                                    @maranda, @valeriansaliou\n * Fix special chars in JIDs for Jappix Mini            @dunger, @valeriansaliou\n * Fix WebSocket session termination in JSJaC           @sstrigler\n * Enhance backend security (verify SSL certificates)   @valeriansaliou\n * Add assets client cache option                       @valeriansaliou\n * Add SSO support to Jappix Mobile                     @valeriansaliou\n\n\nOne, v1.0.3 (March 2014)\n------------------------\n\n * Fix JSJaC packet register   @valeriansaliou, @sstrigler\n\n\nOne, v1.0.2 (March 2014)\n------------------------\n\n * Fix IQ spoofing security issue   @valeriansaliou, @sstrigler\n * Better autocompletion            @Nabellaleen\n * Various bugfixes                 @Nabellaleen, @valeriansaliou\n\n\nOne, v1.0.1 (January 2014)\n--------------------------\n\n * Change MAM namespace to a temporary one           @maranda\n * Fix broken Jappix Mini CSS loader in some cases   @valeriansaliou\n * Libs update                                       @valeriansaliou\n\n\nOne, v1.0.0 (January 2014)\n--------------------------\n\n * XEP-0166: Jingle                                 @valeriansaliou\n * XEP-0292: vCard4 Over XMPP                       @valeriansaliou\n * XEP-0280: Message Carbons                        @valeriansaliou\n * IE9, IE10, IE11 support                          @valeriansaliou\n * Libs update                                      @valeriansaliou\n * Client code rewrite                              @valeriansaliou\n * Directory tree re-organization                   @valeriansaliou\n * Tested code (pass CSSLint, JSHint and PHPLint)   @valeriansaliou\n\n\nNemesis Alpha 9, v0.9.9 (August 2013)\n-------------------------------------\n\n * XEP-0313: Message Archive Management                                                                  @valeriansaliou\n * Drop support for Message Archiving (XEP-0136), outpaced by MAM (XEP-0313)                             @valeriansaliou\n * Jappix Desktop performances improved (noticeable with big rosters)                                    @valeriansaliou\n * Fix Jappix Desktop avatar system, unable to cache avatars (thus increasing network load and delays)   @valeriansaliou\n * New translations added (Mongolian), and a few ones updated                                            @valeriansaliou\n\n\nNemesis Alpha 8, v0.9.8 (May 2013)\n----------------------------------\n\n * RTL (Right-To-Left Languages) support   @valeriansaliou\n * Various bufixes                         @valeriansaliou\n\n\nNemesis Alpha 7, v0.9.7 (April 2013)\n------------------------------------\n\n * Fix overflow events in Mini                     @valeriansaliou\n * Fix user info display bug with formatted text   @valeriansaliou\n * Jappix Me notification system                   @valeriansaliou\n * Update JSJaC                                    @valeriansaliou\n * Update jQuery (v1.10.1)                         @valeriansaliou\n\n\nNemesis Alpha 6, v0.9.6 (April 2013)\n------------------------------------\n\n * Fix login with accented usernames               @valeriansaliou\n * WOFF Get API headers fixed                      @valeriansaliou\n * Better Get API URL generator                    @valeriansaliou\n * Fix broken Jappix Mini extraction script        @valeriansaliou\n * Show when user joins/exits MUC in Jappix Mini   @valeriansaliou\n\n\nNemesis Alpha 5, v0.9.5 (March 2013)\n------------------------------------\n\n * Jappix Mini enhancements                                    @valeriansaliou\n * Fix Jappix over non-standard ports                          @valeriansaliou\n * Locale detector improved                                    @valeriansaliou\n * Load more items on social channel scroll                    @valeriansaliou\n * Fix a lot of English base language typos                    @valeriansaliou\n * Support for XHTML microblog entries (Movim compatibility)   @valeriansaliou\n * Show Jappix Desktop on tablets (not mobile anymore)         @valeriansaliou\n * Option to disable Jappix Mini on mobile phones              @valeriansaliou\n * Fix broken MUC bookmarks retrieval                          @valeriansaliou\n\n\nNemesis Alpha 4, v0.9.4 (March 2013)\n------------------------------------\n\n * [SECURITY] Fix insafe HTML escaping                 @valeriansaliou\n * PHP 5.4 compatibility                               @valeriansaliou\n * Auto-populate microblog on connect                  @valeriansaliou\n * Register API support for Metronome XMPPd            @valeriansaliou\n * Non-blocking PHP sessions                           @valeriansaliou\n * Permissive geoloc selector in microblog             @valeriansaliou\n * Select priority more easily                         @valeriansaliou\n * Compliancy with Atom specification (social inbox)   @valeriansaliou\n * Added project mirrors                               @valeriansaliou\n\n\nNemesis Alpha 3, v0.9.3 (February 2013)\n---------------------------------------\n\n * [SECURITY] More randomness in CAPTCHA                                            @valeriansaliou\n * Fix buggy roster filter with groups                                              @valeriansaliou\n * Add Piwik tracking feature (configurable in manager)                             @valeriansaliou\n * Easy popup close by clicking away                                                @valeriansaliou\n * Fix cropped uploaded pictures                                                    @valeriansaliou\n * Revert to old File Share API (which is far better)                               @valeriansaliou\n * Fixes broken translations (strange UTF-8 chars due to bugged Gettext compiler)   @valeriansaliou\n\n\nNemesis Alpha 2, v0.9.2 (January 2013)\n--------------------------------------\n\n * [SECURITY] Introduce the Register API (prevents register flood by spam bots)   @valeriansaliou\n * Reworked Storage API                                                           @valeriansaliou\n * Jappix Mini code beautify                                                      @valeriansaliou\n * Lighter and Web-safe font files                                                @valeriansaliou\n * Better error logging                                                           @valeriansaliou\n * Fix Openfire ping request                                                      @valeriansaliou\n * Typing notification in Jappix Mini                                             @valeriansaliou\n * Support for WebKit notifications                                               @valeriansaliou\n * Jappix Mini groupchat suggest                                                  @valeriansaliou\n * Enhanced Download API                                                          @valeriansaliou\n * Mini animated chat icon, much sexier                                           @valeriansaliou\n * IE custom font compatibility                                                   @valeriansaliou\n * Legal changes                                                                  @valeriansaliou\n * Update licensing with real names                                               @valeriansaliou\n\n\nNemesis Alpha 1, v0.9.1 (2012)\n------------------------------\n\n * Show an 'add to home' button on iOS devices                   @camaran\n * Ability to suspend statistics                                 @valeriansaliou\n * Fix IE9 issue with clustering                                 @valeriansaliou\n * Show profile button in user search results                    @valeriansaliou\n * Ability to change message font, font size and color           @valeriansaliou\n * Fix choppy Jappix Mini status picker                          @valeriansaliou\n * Sounds for Safari & IE9                                       @valeriansaliou\n * Enhance new file storage functions                            @valeriansaliou\n * No resize for textareas                                       @valeriansaliou\n * Add a configurable legal disclaimer                           @valeriansaliou\n * Fix a loop bug on presence if no support for sessionStorage   @valeriansaliou\n * Universal fonts                                               @valeriansaliou\n * Add ability to configure the node owner name & website        @valeriansaliou\n * HTTP authentication for LDAP                                  @valeriansaliou\n * Better notification + comments management                     @valeriansaliou\n\n\nSpaco, v0.9 (2011)\n------------------\n\n * [SECURITY] Fix when sending files to a contact   @valeriansaliou\n * Better Jappix Mini performances                  @valeriansaliou\n * Fix Jappix Mini display issues                   @valeriansaliou\n * Connection issue fixed with BOSH API             @valeriansaliou\n * Open XMPP links when Jappix is ready             @valeriansaliou\n\n\nSuno, v0.8 (2011)\n---------------------\n\n * XEP-0066: Out of Band Data                                 @valeriansaliou\n * Switch from OpenStreetMap to Google Maps for geolocation   @valeriansaliou\n\n\nStelo, v0.7 (2011)\n------------------\n\n * Lighter Jappix Mini                                           @valeriansaliou\n * Welcome popup                                                 @valeriansaliou\n * Support for /me command in Jappix Mini                        @valeriansaliou\n * Fixes in social channel                                       @valeriansaliou\n * Bigger BOSH poll interval (avoids some overactivity errors)   @valeriansaliou\n * Compression disabled by default in Get API                    @valeriansaliou\n * Send chatstates in MUC                                        @valeriansaliou\n * Social notification inbox                                     @valeriansaliou\n\n\nLumo, v0.6 (2011)\n-----------------\n\n * Smoother Mini animation                                               @valeriansaliou\n * Show avatars in social channel comments                               @valeriansaliou\n * Legacy mode for microblog comments                                    @valeriansaliou\n * Microblog updated to comply with a new version of XEP-0277            @valeriansaliou\n * Fix DNS SRV issue because of a 'route' attribute on BOSH initiation   @valeriansaliou\n\n\nRibelo, v0.5 (2011)\n-------------------\n\n * Add support for comments in microblog   @valeriansaliou\n * Jappix Mini fixes and improvements      @valeriansaliou\n\n\nLupo, v0.4 (2011)\n-----------------\n\n * Full IE5.5 compatibility for Jappix Mini                            @valeriansaliou\n * BOSH without cURL (if cURL unavailable)                             @valeriansaliou\n * Handle multiple microblog attached files                            @valeriansaliou\n * Microblog attached files thumbnails                                 @valeriansaliou\n * BOM (Byte Order Mark) filtering for Get API                         @valeriansaliou\n * Autoplay for new YouTube HTML5 player                               @valeriansaliou\n * Support for privacy lists pushs                                     @valeriansaliou\n * Roster-side privacy lists (make contact blocking/unblocking easy)   @valeriansaliou\n * Better update checker                                               @valeriansaliou\n * XEP-0144: Roster Item Exchange                                      @valeriansaliou\n * Cross domain support for Internet Explorer and legacy browsers      @valeriansaliou\n * Update jQuery (v1.4.4)                                              @valeriansaliou\n * TZO fix (for negative timezones, e.g.: UTC-5)                       @valeriansaliou\n * Better language detection                                           @valeriansaliou\n * Use HTML5 or Flash for YouTube embedded videos                      @valeriansaliou\n\n\nPrism, v0.3 (2011)\n------------------\n\n * [SECURITY] Fix JS escape bug for quotes                @valeriansaliou\n * [SECURITY] HTML-encode notification username           @valeriansaliou\n * Introduction of Jappix Mini                            @valeriansaliou\n * Introduction of Jappix Manager                         @valeriansaliou\n * Introduction of Jappix Install                         @valeriansaliou\n * XEP-0050: Ad-Hoc Commands                              @valeriansaliou\n * XEP-0136: Message Archiving                            @valeriansaliou\n * Update Jappix logo                                     @valeriansaliou\n * Declare application language to XMPP server            @valeriansaliou\n * Add a buddy search tool                                @valeriansaliou\n * Support for old/legacy vCard server implementations    @valeriansaliou\n * Inbox messages sorted by date                          @valeriansaliou\n * Better music search                                    @valeriansaliou\n * Human-readable geolocation                             @valeriansaliou\n * Gateway show/hide                                      @valeriansaliou\n * HTML5 forms                                            @valeriansaliou\n * Better notification management                         @valeriansaliou\n * Unified chat design                                    @valeriansaliou\n * Dynamic DOM load (better performances)                 @valeriansaliou\n * Jappix logo shown when connected (improves branding)   @valeriansaliou\n\n\nLidar, v0.2 (2010)\n------------------\n\n * Introduction of Jappix Mobile               @valeriansaliou\n * UI redesign (from grey to black and blue)   @valeriansaliou\n * Social channel introduced (microblog)       @valeriansaliou\n\n\nGenesis, v0.1 (2010)\n--------------------\n\n * Initial version, released after private beta         @valeriansaliou\n * Introduction of Jappix Desktop                       @valeriansaliou\n * Basic chat, groupchat, roster and profile features   @valeriansaliou\n * Basic UI                                             @valeriansaliou\n\n\n**For more information about what changed through time, check the changes made to our source code on GitHub: https://github.com/jappix/jappix/commits/master**\n", "Primo [1.1.7~dev]\n", "/*\n\nJappix - An open social platform\nThese are the Message Carbons JS script for Jappix\n\n-------------------------------------------------\n\nLicense: AGPL\nAuthor: Val\u00e9rian Saliou\n\n*/\n\n// Bundle\nvar Carbons = (function () {\n\n    /**\n     * Alias of this\n     * @private\n     */\n    var self = {};\n\n\n    /**\n     * Configures Message Carbons options\n     * @private\n     * @param {string} type\n     * @return {undefined}\n     */\n    self._configure = function(type) {\n\n        try {\n            if(!(type in {'enable': 1, 'disable': 1})) {\n                Console.error('Carbons._configure', 'Invalid type (must be either \"enable\" or \"disable\")'); return;\n            }\n\n            var iq = new JSJaCIQ();\n            iq.setType('set');\n\n            iq.appendNode(type, {'xmlns': NS_URN_CARBONS});\n\n            con.send(iq, function(iq) {\n                self._handleConfigure(iq, type);\n            });\n        } catch(e) {\n            Console.error('Carbons._configure', e);\n        }\n\n    };\n\n\n    /**\n     * Configures Message Carbons options\n     * @private\n     * @param {object} iq\n     * @param {string} type\n     * @return {undefined}\n     */\n    self._handleConfigure = function(iq, type) {\n\n        try {\n            if(iq.getType() === 'result') {\n                Console.log('Message Carbons successfully configured (type: ' + type + ')');\n            } else {\n                Console.error('Message Carbons could not be configured (type: ' + type + ')');\n            }\n        } catch(e) {\n            Console.error('Carbons._handleConfigure', e);\n        }\n\n    };\n\n\n    /**\n     * Enables Message Carbons for this session\n     * @public\n     * @return {undefined}\n     */\n    self.enable = function() {\n\n        try {\n            self._configure('enable');\n        } catch(e) {\n            Console.error('Carbons.enable', e);\n        }\n\n    };\n\n\n    /**\n     * Disables Message Carbons for this session\n     * @public\n     * @return {undefined}\n     */\n    self.disable = function() {\n\n        try {\n            self._configure('disable');\n        } catch(e) {\n            Console.error('Carbons.disable', e);\n        }\n\n    };\n\n\n    /**\n     * Returns whether the server has Carbons support or not\n     * @public\n     * @return {boolean}\n     */\n    self.has = function() {\n\n        try {\n            return Features.enabledCarbons();\n        } catch(e) {\n            Console.error('Carbons.has', e);\n        }\n\n    };\n\n\n    /**\n     * Returns the forwarded message stanza\n     * @public\n     * @param {object} message\n     * @return {object}\n     */\n    self._getForwarded = function(message) {\n\n        try {\n            var forwarded_message = $(message.getNode()).find('forwarded[xmlns=\"' + NS_URN_FORWARD + '\"]:first message:first');\n\n            if(forwarded_message[0]) {\n                return JSJaCPacket.wrapNode(forwarded_message[0]);\n            }\n\n            return null;\n        } catch(e) {\n            Console.error('Carbons._getForwarded', e);\n        }\n\n    };\n\n\n    /**\n     * Handles a forwarded sent message\n     * @public\n     * @param {object} message\n     * @return {undefined}\n     */\n    self.handleSent = function(message) {\n\n        try {\n            var forwarded_message = self._getForwarded(message);\n\n            if(forwarded_message !== null) {\n                var to = Common.bareXID(forwarded_message.getTo());\n                var hash = hex_md5(to);\n                var type = forwarded_message.getType();\n\n                // Display sent message\n                if(type === 'chat' || !type) {\n                    // Chat opened? (no need to display sent messages if chat does not exist there...)\n                    if(Chat.exists(hash)) {\n                        // Get more data\n                        var id = forwarded_message.getID();\n                        var body = $.trim(forwarded_message.getBody());\n                        var my_xid = Common.getXID();\n\n                        // Generate the message body\n                        var html_escape = (Message.generate(forwarded_message, body, hash) !== 'XHTML');\n                        if(!html_escape) {\n                            body = Filter.xhtml(forwarded_message.getNode());\n                        }\n\n                        if(body) {\n                            // Display the message (finally!)\n                            Message.display(\n                                'chat',\n                                my_xid,\n                                hash,\n                                Name.getBuddy(my_xid).htmlEnc(),\n                                body,\n                                DateUtils.getCompleteTime(),\n                                DateUtils.getTimeStamp(),\n                                'user-message',\n                                html_escape,\n                                '',\n                                'me',\n                                id\n                            );\n\n                            Console.debug('Got a sent message from another resource to: ' + (to || 'none'));\n                        } else {\n                            Console.debug('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because body empty');\n                        }\n\n                        // Handle chat markers change\n                        Markers.handleCarbonChange(forwarded_message);\n                    } else {\n                        Console.debug('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because chat not open');\n                    }\n                } else {\n                    Console.warning('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because of type: ' + type);\n                }\n            }\n        } catch(e) {\n            Console.error('Carbons.handleSent', e);\n        }\n\n    };\n\n\n    /**\n     * Handles a forwarded received message\n     * @public\n     * @param {object} message\n     * @return {undefined}\n     */\n    self.handleReceived = function(message) {\n\n        try {\n            var forwarded_message = self._getForwarded(message);\n\n            if(forwarded_message !== null) {\n                Console.debug('Got a received message from another resource from: ' + (forwarded_message.getFrom() || 'none'));\n\n                Message.handle(forwarded_message);\n            }\n        } catch(e) {\n            Console.error('Carbons.handleReceived', e);\n        }\n\n    };\n\n\n    /**\n     * Return class scope\n     */\n    return self;\n\n})();"], "fixing_code": ["Jappix Changelog\n================\n\nHere's the log of what has changed over the Jappix releases.\n\n\nPrimo, v1.1.7 (January 2017)\n----------------------------\n\n * Improve Carbons  @valeriansaliou\n\n\nPrimo, v1.1.6 (August 2015)\n---------------------------\n\n * Security fix on paths check  @valeriansaliou\n\n\nPrimo, v1.1.5 (August 2015)\n---------------------------\n\n * Critical file upload security fix  @valeriansaliou, @mathiasertl\n\n\nPrimo, v1.1.4 (April 2015)\n---------------------------\n\n * Fix various issues           @valeriansaliou\n * Fix XSS attack on dataforms  @V1RTUOZ\n\n\nPrimo, v1.1.3 (January 2015)\n----------------------------\n\n * Better default priorities        @beanow, @valeriansaliou\n * Fix IE11+ browser compatibility  @valeriansaliou\n\n\nPrimo, v1.1.2 (October 2014)\n----------------------------\n\n * XEP-0353: Jingle Message Initiation  @valeriansaliou\n * Fixes Jingle calls in Chrome 38+     @valeriansaliou\n\n\nPrimo, v1.1.1 (September 2014)\n------------------------------\n\n * Ignore empty XHTML-IM messages  @eijebong, @valeriansaliou\n * Fix a bug with message markers  @valeriansaliou\n\n\nPrimo, v1.1.0 (June 2014)\n-------------------------\n\n * XEP-0272: Multiparty Jingle (Muji)      @valeriansaliou\n * Prevent client crash on huge messages   @valeriansaliou\n * Beautified client code (JavaScript)     @valeriansaliou\n * Fix unavailable MUC rooms               @emamirazavi\n\n\nOne, v1.0.7 (May 2014)\n----------------------\n\n * Fix BackLinks design                         @valeriansaliou\n * Sort Jappix Mobile contacts alphabetically   @valeriansaliou\n * Display offline contacts in Jappix Mini      @valeriansaliou\n\n\nOne, v1.0.6 (May 2014)\n----------------------\n\n * XEP-0308: Last Message Correction               @valeriansaliou\n * XEP-0333: Chat Markers                          @valeriansaliou\n * XEP-0319: Last User Interaction into Presence   @valeriansaliou\n * XEP-0224: Attention                             @valeriansaliou\n * XEP-0152: Reachability Addresses                @valeriansaliou\n * XEP-0334: Message Processing Hints              @valeriansaliou\n * Fix gateway contacts management                 @valeriansaliou\n * Fix sounds in Jappix Mini                       @aryo, @valeriansaliou\n\n\nOne, v1.0.5 (May 2014)\n----------------------\n\n * Fix MUC bookmark shortcut button                         @valeriansaliou\n * Fix HTML5 notifications in Firefox 22+                   @valeriansaliou\n * Fix server commands tool                                 @valeriansaliou\n * New translations added (Uzbek), and a few ones updated   @nurkamol, @valeriansaliou\n\n\nOne, v1.0.4 (May 2014)\n----------------------\n\n * Fix update tool (on some environments)               @valeriansaliou\n * Fix MUC room join                                    @maranda, @valeriansaliou\n * Fix special chars in JIDs for Jappix Mini            @dunger, @valeriansaliou\n * Fix WebSocket session termination in JSJaC           @sstrigler\n * Enhance backend security (verify SSL certificates)   @valeriansaliou\n * Add assets client cache option                       @valeriansaliou\n * Add SSO support to Jappix Mobile                     @valeriansaliou\n\n\nOne, v1.0.3 (March 2014)\n------------------------\n\n * Fix JSJaC packet register   @valeriansaliou, @sstrigler\n\n\nOne, v1.0.2 (March 2014)\n------------------------\n\n * Fix IQ spoofing security issue   @valeriansaliou, @sstrigler\n * Better autocompletion            @Nabellaleen\n * Various bugfixes                 @Nabellaleen, @valeriansaliou\n\n\nOne, v1.0.1 (January 2014)\n--------------------------\n\n * Change MAM namespace to a temporary one           @maranda\n * Fix broken Jappix Mini CSS loader in some cases   @valeriansaliou\n * Libs update                                       @valeriansaliou\n\n\nOne, v1.0.0 (January 2014)\n--------------------------\n\n * XEP-0166: Jingle                                 @valeriansaliou\n * XEP-0292: vCard4 Over XMPP                       @valeriansaliou\n * XEP-0280: Message Carbons                        @valeriansaliou\n * IE9, IE10, IE11 support                          @valeriansaliou\n * Libs update                                      @valeriansaliou\n * Client code rewrite                              @valeriansaliou\n * Directory tree re-organization                   @valeriansaliou\n * Tested code (pass CSSLint, JSHint and PHPLint)   @valeriansaliou\n\n\nNemesis Alpha 9, v0.9.9 (August 2013)\n-------------------------------------\n\n * XEP-0313: Message Archive Management                                                                  @valeriansaliou\n * Drop support for Message Archiving (XEP-0136), outpaced by MAM (XEP-0313)                             @valeriansaliou\n * Jappix Desktop performances improved (noticeable with big rosters)                                    @valeriansaliou\n * Fix Jappix Desktop avatar system, unable to cache avatars (thus increasing network load and delays)   @valeriansaliou\n * New translations added (Mongolian), and a few ones updated                                            @valeriansaliou\n\n\nNemesis Alpha 8, v0.9.8 (May 2013)\n----------------------------------\n\n * RTL (Right-To-Left Languages) support   @valeriansaliou\n * Various bufixes                         @valeriansaliou\n\n\nNemesis Alpha 7, v0.9.7 (April 2013)\n------------------------------------\n\n * Fix overflow events in Mini                     @valeriansaliou\n * Fix user info display bug with formatted text   @valeriansaliou\n * Jappix Me notification system                   @valeriansaliou\n * Update JSJaC                                    @valeriansaliou\n * Update jQuery (v1.10.1)                         @valeriansaliou\n\n\nNemesis Alpha 6, v0.9.6 (April 2013)\n------------------------------------\n\n * Fix login with accented usernames               @valeriansaliou\n * WOFF Get API headers fixed                      @valeriansaliou\n * Better Get API URL generator                    @valeriansaliou\n * Fix broken Jappix Mini extraction script        @valeriansaliou\n * Show when user joins/exits MUC in Jappix Mini   @valeriansaliou\n\n\nNemesis Alpha 5, v0.9.5 (March 2013)\n------------------------------------\n\n * Jappix Mini enhancements                                    @valeriansaliou\n * Fix Jappix over non-standard ports                          @valeriansaliou\n * Locale detector improved                                    @valeriansaliou\n * Load more items on social channel scroll                    @valeriansaliou\n * Fix a lot of English base language typos                    @valeriansaliou\n * Support for XHTML microblog entries (Movim compatibility)   @valeriansaliou\n * Show Jappix Desktop on tablets (not mobile anymore)         @valeriansaliou\n * Option to disable Jappix Mini on mobile phones              @valeriansaliou\n * Fix broken MUC bookmarks retrieval                          @valeriansaliou\n\n\nNemesis Alpha 4, v0.9.4 (March 2013)\n------------------------------------\n\n * [SECURITY] Fix insafe HTML escaping                 @valeriansaliou\n * PHP 5.4 compatibility                               @valeriansaliou\n * Auto-populate microblog on connect                  @valeriansaliou\n * Register API support for Metronome XMPPd            @valeriansaliou\n * Non-blocking PHP sessions                           @valeriansaliou\n * Permissive geoloc selector in microblog             @valeriansaliou\n * Select priority more easily                         @valeriansaliou\n * Compliancy with Atom specification (social inbox)   @valeriansaliou\n * Added project mirrors                               @valeriansaliou\n\n\nNemesis Alpha 3, v0.9.3 (February 2013)\n---------------------------------------\n\n * [SECURITY] More randomness in CAPTCHA                                            @valeriansaliou\n * Fix buggy roster filter with groups                                              @valeriansaliou\n * Add Piwik tracking feature (configurable in manager)                             @valeriansaliou\n * Easy popup close by clicking away                                                @valeriansaliou\n * Fix cropped uploaded pictures                                                    @valeriansaliou\n * Revert to old File Share API (which is far better)                               @valeriansaliou\n * Fixes broken translations (strange UTF-8 chars due to bugged Gettext compiler)   @valeriansaliou\n\n\nNemesis Alpha 2, v0.9.2 (January 2013)\n--------------------------------------\n\n * [SECURITY] Introduce the Register API (prevents register flood by spam bots)   @valeriansaliou\n * Reworked Storage API                                                           @valeriansaliou\n * Jappix Mini code beautify                                                      @valeriansaliou\n * Lighter and Web-safe font files                                                @valeriansaliou\n * Better error logging                                                           @valeriansaliou\n * Fix Openfire ping request                                                      @valeriansaliou\n * Typing notification in Jappix Mini                                             @valeriansaliou\n * Support for WebKit notifications                                               @valeriansaliou\n * Jappix Mini groupchat suggest                                                  @valeriansaliou\n * Enhanced Download API                                                          @valeriansaliou\n * Mini animated chat icon, much sexier                                           @valeriansaliou\n * IE custom font compatibility                                                   @valeriansaliou\n * Legal changes                                                                  @valeriansaliou\n * Update licensing with real names                                               @valeriansaliou\n\n\nNemesis Alpha 1, v0.9.1 (2012)\n------------------------------\n\n * Show an 'add to home' button on iOS devices                   @camaran\n * Ability to suspend statistics                                 @valeriansaliou\n * Fix IE9 issue with clustering                                 @valeriansaliou\n * Show profile button in user search results                    @valeriansaliou\n * Ability to change message font, font size and color           @valeriansaliou\n * Fix choppy Jappix Mini status picker                          @valeriansaliou\n * Sounds for Safari & IE9                                       @valeriansaliou\n * Enhance new file storage functions                            @valeriansaliou\n * No resize for textareas                                       @valeriansaliou\n * Add a configurable legal disclaimer                           @valeriansaliou\n * Fix a loop bug on presence if no support for sessionStorage   @valeriansaliou\n * Universal fonts                                               @valeriansaliou\n * Add ability to configure the node owner name & website        @valeriansaliou\n * HTTP authentication for LDAP                                  @valeriansaliou\n * Better notification + comments management                     @valeriansaliou\n\n\nSpaco, v0.9 (2011)\n------------------\n\n * [SECURITY] Fix when sending files to a contact   @valeriansaliou\n * Better Jappix Mini performances                  @valeriansaliou\n * Fix Jappix Mini display issues                   @valeriansaliou\n * Connection issue fixed with BOSH API             @valeriansaliou\n * Open XMPP links when Jappix is ready             @valeriansaliou\n\n\nSuno, v0.8 (2011)\n---------------------\n\n * XEP-0066: Out of Band Data                                 @valeriansaliou\n * Switch from OpenStreetMap to Google Maps for geolocation   @valeriansaliou\n\n\nStelo, v0.7 (2011)\n------------------\n\n * Lighter Jappix Mini                                           @valeriansaliou\n * Welcome popup                                                 @valeriansaliou\n * Support for /me command in Jappix Mini                        @valeriansaliou\n * Fixes in social channel                                       @valeriansaliou\n * Bigger BOSH poll interval (avoids some overactivity errors)   @valeriansaliou\n * Compression disabled by default in Get API                    @valeriansaliou\n * Send chatstates in MUC                                        @valeriansaliou\n * Social notification inbox                                     @valeriansaliou\n\n\nLumo, v0.6 (2011)\n-----------------\n\n * Smoother Mini animation                                               @valeriansaliou\n * Show avatars in social channel comments                               @valeriansaliou\n * Legacy mode for microblog comments                                    @valeriansaliou\n * Microblog updated to comply with a new version of XEP-0277            @valeriansaliou\n * Fix DNS SRV issue because of a 'route' attribute on BOSH initiation   @valeriansaliou\n\n\nRibelo, v0.5 (2011)\n-------------------\n\n * Add support for comments in microblog   @valeriansaliou\n * Jappix Mini fixes and improvements      @valeriansaliou\n\n\nLupo, v0.4 (2011)\n-----------------\n\n * Full IE5.5 compatibility for Jappix Mini                            @valeriansaliou\n * BOSH without cURL (if cURL unavailable)                             @valeriansaliou\n * Handle multiple microblog attached files                            @valeriansaliou\n * Microblog attached files thumbnails                                 @valeriansaliou\n * BOM (Byte Order Mark) filtering for Get API                         @valeriansaliou\n * Autoplay for new YouTube HTML5 player                               @valeriansaliou\n * Support for privacy lists pushs                                     @valeriansaliou\n * Roster-side privacy lists (make contact blocking/unblocking easy)   @valeriansaliou\n * Better update checker                                               @valeriansaliou\n * XEP-0144: Roster Item Exchange                                      @valeriansaliou\n * Cross domain support for Internet Explorer and legacy browsers      @valeriansaliou\n * Update jQuery (v1.4.4)                                              @valeriansaliou\n * TZO fix (for negative timezones, e.g.: UTC-5)                       @valeriansaliou\n * Better language detection                                           @valeriansaliou\n * Use HTML5 or Flash for YouTube embedded videos                      @valeriansaliou\n\n\nPrism, v0.3 (2011)\n------------------\n\n * [SECURITY] Fix JS escape bug for quotes                @valeriansaliou\n * [SECURITY] HTML-encode notification username           @valeriansaliou\n * Introduction of Jappix Mini                            @valeriansaliou\n * Introduction of Jappix Manager                         @valeriansaliou\n * Introduction of Jappix Install                         @valeriansaliou\n * XEP-0050: Ad-Hoc Commands                              @valeriansaliou\n * XEP-0136: Message Archiving                            @valeriansaliou\n * Update Jappix logo                                     @valeriansaliou\n * Declare application language to XMPP server            @valeriansaliou\n * Add a buddy search tool                                @valeriansaliou\n * Support for old/legacy vCard server implementations    @valeriansaliou\n * Inbox messages sorted by date                          @valeriansaliou\n * Better music search                                    @valeriansaliou\n * Human-readable geolocation                             @valeriansaliou\n * Gateway show/hide                                      @valeriansaliou\n * HTML5 forms                                            @valeriansaliou\n * Better notification management                         @valeriansaliou\n * Unified chat design                                    @valeriansaliou\n * Dynamic DOM load (better performances)                 @valeriansaliou\n * Jappix logo shown when connected (improves branding)   @valeriansaliou\n\n\nLidar, v0.2 (2010)\n------------------\n\n * Introduction of Jappix Mobile               @valeriansaliou\n * UI redesign (from grey to black and blue)   @valeriansaliou\n * Social channel introduced (microblog)       @valeriansaliou\n\n\nGenesis, v0.1 (2010)\n--------------------\n\n * Initial version, released after private beta         @valeriansaliou\n * Introduction of Jappix Desktop                       @valeriansaliou\n * Basic chat, groupchat, roster and profile features   @valeriansaliou\n * Basic UI                                             @valeriansaliou\n\n\n**For more information about what changed through time, check the changes made to our source code on GitHub: https://github.com/jappix/jappix/commits/master**\n", "Primo [1.1.7]\n", "/*\n\nJappix - An open social platform\nThese are the Message Carbons JS script for Jappix\n\n-------------------------------------------------\n\nLicense: AGPL\nAuthor: Val\u00e9rian Saliou\n\n*/\n\n// Bundle\nvar Carbons = (function () {\n\n    /**\n     * Alias of this\n     * @private\n     */\n    var self = {};\n\n\n    /**\n     * Configures Message Carbons options\n     * @private\n     * @param {string} type\n     * @return {undefined}\n     */\n    self._configure = function(type) {\n\n        try {\n            if(!(type in {'enable': 1, 'disable': 1})) {\n                Console.error('Carbons._configure', 'Invalid type (must be either \"enable\" or \"disable\")'); return;\n            }\n\n            var iq = new JSJaCIQ();\n            iq.setType('set');\n\n            iq.appendNode(type, {'xmlns': NS_URN_CARBONS});\n\n            con.send(iq, function(iq) {\n                self._handleConfigure(iq, type);\n            });\n        } catch(e) {\n            Console.error('Carbons._configure', e);\n        }\n\n    };\n\n\n    /**\n     * Configures Message Carbons options\n     * @private\n     * @param {object} iq\n     * @param {string} type\n     * @return {undefined}\n     */\n    self._handleConfigure = function(iq, type) {\n\n        try {\n            if(iq.getType() === 'result') {\n                Console.log('Message Carbons successfully configured (type: ' + type + ')');\n            } else {\n                Console.error('Message Carbons could not be configured (type: ' + type + ')');\n            }\n        } catch(e) {\n            Console.error('Carbons._handleConfigure', e);\n        }\n\n    };\n\n\n    /**\n     * Enables Message Carbons for this session\n     * @public\n     * @return {undefined}\n     */\n    self.enable = function() {\n\n        try {\n            self._configure('enable');\n        } catch(e) {\n            Console.error('Carbons.enable', e);\n        }\n\n    };\n\n\n    /**\n     * Disables Message Carbons for this session\n     * @public\n     * @return {undefined}\n     */\n    self.disable = function() {\n\n        try {\n            self._configure('disable');\n        } catch(e) {\n            Console.error('Carbons.disable', e);\n        }\n\n    };\n\n\n    /**\n     * Returns whether the server has Carbons support or not\n     * @public\n     * @return {boolean}\n     */\n    self.has = function() {\n\n        try {\n            return Features.enabledCarbons();\n        } catch(e) {\n            Console.error('Carbons.has', e);\n        }\n\n    };\n\n\n    /**\n     * Returns the forwarded message stanza\n     * @public\n     * @param {object} message\n     * @return {object}\n     */\n    self._getForwarded = function(message) {\n\n        try {\n            // Check message is forwarded from our local user\n            if(Common.bareXID(Common.getStanzaFrom(message)) == Common.getXID()) {\n                var forwarded_message = $(message.getNode()).find('forwarded[xmlns=\"' + NS_URN_FORWARD + '\"]:first message:first');\n\n                if(forwarded_message[0]) {\n                    return JSJaCPacket.wrapNode(forwarded_message[0]);\n                }\n            }\n\n            return null;\n        } catch(e) {\n            Console.error('Carbons._getForwarded', e);\n        }\n\n    };\n\n\n    /**\n     * Handles a forwarded sent message\n     * @public\n     * @param {object} message\n     * @return {undefined}\n     */\n    self.handleSent = function(message) {\n\n        try {\n            var forwarded_message = self._getForwarded(message);\n\n            if(forwarded_message !== null) {\n                var to = Common.bareXID(forwarded_message.getTo());\n                var hash = hex_md5(to);\n                var type = forwarded_message.getType();\n\n                // Display sent message\n                if(type === 'chat' || !type) {\n                    // Chat opened? (no need to display sent messages if chat does not exist there...)\n                    if(Chat.exists(hash)) {\n                        // Get more data\n                        var id = forwarded_message.getID();\n                        var body = $.trim(forwarded_message.getBody());\n                        var my_xid = Common.getXID();\n\n                        // Generate the message body\n                        var html_escape = (Message.generate(forwarded_message, body, hash) !== 'XHTML');\n                        if(!html_escape) {\n                            body = Filter.xhtml(forwarded_message.getNode());\n                        }\n\n                        if(body) {\n                            // Display the message (finally!)\n                            Message.display(\n                                'chat',\n                                my_xid,\n                                hash,\n                                Name.getBuddy(my_xid).htmlEnc(),\n                                body,\n                                DateUtils.getCompleteTime(),\n                                DateUtils.getTimeStamp(),\n                                'user-message',\n                                html_escape,\n                                '',\n                                'me',\n                                id\n                            );\n\n                            Console.debug('Got a sent message from another resource to: ' + (to || 'none'));\n                        } else {\n                            Console.debug('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because body empty');\n                        }\n\n                        // Handle chat markers change\n                        Markers.handleCarbonChange(forwarded_message);\n                    } else {\n                        Console.debug('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because chat not open');\n                    }\n                } else {\n                    Console.warning('Got a sent message from another resource to: ' + (to || 'none') + ', was ignored because of type: ' + type);\n                }\n            }\n        } catch(e) {\n            Console.error('Carbons.handleSent', e);\n        }\n\n    };\n\n\n    /**\n     * Handles a forwarded received message\n     * @public\n     * @param {object} message\n     * @return {undefined}\n     */\n    self.handleReceived = function(message) {\n\n        try {\n            var forwarded_message = self._getForwarded(message);\n\n            if(forwarded_message !== null) {\n                Console.debug('Got a received message from another resource from: ' + (forwarded_message.getFrom() || 'none'));\n\n                Message.handle(forwarded_message);\n            }\n        } catch(e) {\n            Console.error('Carbons.handleReceived', e);\n        }\n\n    };\n\n\n    /**\n     * Return class scope\n     */\n    return self;\n\n})();\n"], "filenames": ["CHANGELOG.md", "VERSION", "app/javascripts/carbons.js"], "buggy_code_start_loc": [7, 1, 130], "buggy_code_end_loc": [11, 2, 242], "fixing_code_start_loc": [7, 1, 130], "fixing_code_end_loc": [11, 2, 245], "type": "CWE-20", "message": "An incorrect implementation of \"XEP-0280: Message Carbons\" in multiple XMPP clients allows a remote attacker to impersonate any user, including contacts, in the vulnerable application's display. This allows for various kinds of social engineering attacks. This CVE is for jappix 1.0.0 to 1.1.6.", "other": {"cve": {"id": "CVE-2017-5602", "sourceIdentifier": "cve@mitre.org", "published": "2017-02-09T20:59:00.373", "lastModified": "2017-03-01T02:59:05.747", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "An incorrect implementation of \"XEP-0280: Message Carbons\" in multiple XMPP clients allows a remote attacker to impersonate any user, including contacts, in the vulnerable application's display. This allows for various kinds of social engineering attacks. This CVE is for jappix 1.0.0 to 1.1.6."}, {"lang": "es", "value": "Una implementaci\u00f3n incorrecta de \"XEP-0280: Message Carbons\" en m\u00faltiples clientes XMPP permite a un atacante remoto personificar cualquier usuario, incluidos los contactos, en la pantalla de la aplicaci\u00f3n vulnerable. Esto permite varios tipos de ataques de ingenier\u00eda social. Esta CVE es para jappix 1.0.0 to 1.1.6."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 5.9, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.2, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-20"}, {"lang": "en", "value": "CWE-346"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.0:*:*:*:*:*:*:*", "matchCriteriaId": "5F9E65AE-5D32-465B-B629-F3639306BE81"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.1:*:*:*:*:*:*:*", "matchCriteriaId": "61B578FA-28F7-484E-945C-45B271BDB1F0"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.2:*:*:*:*:*:*:*", "matchCriteriaId": "B9C68990-0DDB-4D89-AB76-DBECFA7350A3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.3:*:*:*:*:*:*:*", "matchCriteriaId": "DD1E2A71-147A-45C6-8886-FC4051AD9083"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.4:*:*:*:*:*:*:*", "matchCriteriaId": "126ACD34-E4FA-4A31-9B62-B66C3A1ABB48"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.5:*:*:*:*:*:*:*", "matchCriteriaId": "17D06FF3-DD54-4D7A-B731-14071458382F"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.6:*:*:*:*:*:*:*", "matchCriteriaId": "29576A29-0835-4BFA-A0D9-7E48EB24E1AA"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.0.7:*:*:*:*:*:*:*", "matchCriteriaId": "F116DCC5-6D42-4EFF-B710-FD83A2E53B5B"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.0:*:*:*:*:*:*:*", "matchCriteriaId": "4ACB74B1-195E-44B6-9F71-CFA58E223EFD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.1:*:*:*:*:*:*:*", "matchCriteriaId": "2130786E-DBB4-4B89-AD13-5B53499A5539"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.2:*:*:*:*:*:*:*", "matchCriteriaId": "8F3658FF-8F5F-440B-9824-6974A6D0A88B"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.3:*:*:*:*:*:*:*", "matchCriteriaId": "E4CB32B5-4234-4204-9D57-92A348354E7E"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.4:*:*:*:*:*:*:*", "matchCriteriaId": "8E638252-1EAC-41AD-B38A-CD2DEE90AA47"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.5:*:*:*:*:*:*:*", "matchCriteriaId": "9C9B3968-131D-4CBF-A76D-1CE2D91D8FC6"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jappix_project:jappix:1.1.6:*:*:*:*:*:*:*", "matchCriteriaId": "7C82A3CE-1FB3-48DF-A05F-43A79148C886"}]}]}], "references": [{"url": "http://openwall.com/lists/oss-security/2017/02/09/29", "source": "cve@mitre.org", "tags": ["Exploit", "Mailing List", "Third Party Advisory"]}, {"url": "http://www.securityfocus.com/bid/96176", "source": "cve@mitre.org"}, {"url": "https://github.com/jappix/jappix/commit/ea6de7c65b80880bdf85df47c1a8a5d3d68491af", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://rt-solutions.de/en/2017/02/CVE-2017-5589_xmpp_carbons/", "source": "cve@mitre.org", "tags": ["Exploit", "Technical Description", "Third Party Advisory"]}, {"url": "https://rt-solutions.de/wp-content/uploads/2017/02/CVE-2017-5589_xmpp_carbons.pdf", "source": "cve@mitre.org", "tags": ["Exploit", "Technical Description", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/jappix/jappix/commit/ea6de7c65b80880bdf85df47c1a8a5d3d68491af"}}