{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"PanelsCode.ApplicationsPanelConfigurationSheet\" locale=\"\">\n  <web>PanelsCode</web>\n  <name>ApplicationsPanelConfigurationSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Panels.ApplicationsPanel</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>#if($doc.documentReference.name == 'ApplicationsPanelConfigurationSheet')ApplicationsPanelConfiguration Sheet#{else}$services.display.title($doc, {'displayerHint': 'default'})#end</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n##########################\n## JAVASCRIPT/CSS\n##########################\n#set($discard = $xwiki.jsx.use('PanelsCode.ApplicationsPanelConfigurationSheet'))\n#set($discard = $xwiki.ssx.use('PanelsCode.ApplicationsPanelConfigurationSheet'))\n##########################\n## First, we split the applications in 2 categories (white listed/black listed)\n##########################\n#set($displayedApps = [])\n#set($blacklistedApps = [])\n#if($doc.fullName == 'XWiki.XWikiPreferences')\n  #set($configDoc = $xwiki.getDocument($services.model.createDocumentReference('', 'PanelsCode', 'ApplicationsPanelConfiguration')))\n#else\n  #set($configDoc = $doc)\n#end\n#foreach($uix in $services.uix.getExtensions('org.xwiki.platform.panels.Applications', {'sortByParameter' : 'label'}))\n  #if(\"$!configDoc.getObject('PanelsCode.ApplicationsPanelBlackListClass', 'applicationId', $uix.id)\" != '')\n    #set($discard = $blacklistedApps.add({'uix': $uix}))\n  #else\n    #set ($app = {'uix': $uix})\n    #set ($orderObj = $configDoc.getObject('PanelsCode.ApplicationsPanelOrderClass', 'applicationId', $uix.id))\n    #if ($orderObj)\n      #set ($discard = $app.put('order', $orderObj.getValue('order')))\n    #else\n      ## if order is not set, set MAX_INTEGER\n      #set ($discard = $app.put('order', 2147483647))\n    #end\n    #set ($discard = $displayedApps.add($app))\n  #end\n#end\n## Sort the displayedApp\n#set ($displayedApps = $collectiontool.sort($displayedApps, 'order'))\n##########################\n## Macro to display an application panel\n##########################\n#macro(showAppPanel $id $title $class $apps)\n\n  {{html}}\n    &lt;div class=\"col-xs-12 col-md-6\"&gt;\n      &lt;div class=\"panel-width-Small panel $!class appsPanel\" id=\"$id\"&gt;\n        &lt;div class=\"panel-heading\"&gt;\n          &lt;h2&gt;$title&lt;/h2&gt;\n        &lt;/div&gt;\n        &lt;div class=\"panel-body\"&gt;\n          &lt;ul class=\"nav nav-pills applicationsPanel\"&gt;\n            #foreach($app in $apps)\n              #set($params = $app.uix.getParameters())\n              #if(\"$!params.icon\" != '' &amp;&amp; \"$!params.label\" != '' &amp;&amp; \"$!params.target\" != '' &amp;&amp; $xwiki.hasAccessLevel('view', $xcontext.user, $params.target))\n                #if ($params.icon.startsWith('icon:'))\n                  #set($icon = $services.icon.renderHTML($params.icon.substring(5)))\n                #else\n                  #set($icon = $services.rendering.render($services.rendering.parse(\"image:${params.icon}\", 'xwiki/2.1'), 'xhtml/1.0'))\n                #end\n                &lt;li class=\"draggableApp\" id=\"$app.uix.id\"&gt;\n                  &lt;a&gt;&lt;span class=\"application-img\"&gt;$icon &lt;/span&gt; &lt;span class=\"application-label\"&gt;$params.label&lt;/a&gt;\n                &lt;/li&gt;\n              #end\n            #end\n          &lt;/ul&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  {{/html}}\n#end\n##########################\n## Display the information message\n##########################\n(% class=\"noitems\" %)\n{{translation key=\"platform.panels.applications.helper\" /}}\n##########################\n## Display the 2 panels\n##########################\n(% class=\"row appLists\" %)\n(((\n  #showAppPanel('displayedPanels', $services.localization.render('platform.panels.applications.displayedapps'), 'panel-primary', $displayedApps)\n  #showAppPanel('blacklistedPanels', $services.localization.render('platform.panels.applications.blacklistedapps'), 'panel-info', $blacklistedApps)\n)))\n##########################\n## Display the buttons\n##########################\n{{html}}\n&lt;button class=\"btn btn-primary\" id=\"bt-save\"&gt;$services.localization.render('platform.panels.applications.save')&lt;/button&gt; &lt;button class=\"btn btn-default\" id=\"bt-revert\"&gt;$services.localization.render('platform.panels.applications.revert')&lt;/button&gt;\n{{/html}}\n{{/velocity}}\n</content>\n  <object>\n    <name>PanelsCode.ApplicationsPanelConfigurationSheet</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>3bd008ad-ec26-4593-899c-729733fd5e37</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('xwiki-panels-applications-config-messages', {\n  prefix: 'platform.panels.applications.ajax.',\n  keys: ['success', 'csrf', 'noright', 'error']\n});\n\n/************************************\n * Script that enable the drag &amp; drop of applications\n ************************************/\nrequire([\n  'jquery',\n  'xwiki-meta',\n  'xwiki-l10n!xwiki-panels-applications-config-messages',\n  'jquery-ui',\n  'jquery-ui-touch-punch'\n], function($, xm, l10n) {\n\n  /**\n   * Save the black list and the order configuration\n   */\n  var save = function() {\n    // Generate the array that contains all the applications to have in the blacklist\n    var blacklistElems = $('#blacklistedPanels li.draggableApp');\n    var blacklist = [];\n    for (var i = 0; i &lt; blacklistElems.length; ++i) {\n      blacklist.push(blacklistElems[i].id);\n    }\n    // Generate the JSON array that contains the order of the displayed applications\n    var displaylistElems = $('#displayedPanels li.draggableApp');\n    var displaylistOrder = [];\n    for (var i = 0; i &lt;displaylistElems.length; ++i) {\n      displaylistOrder.push(displaylistElems[i].id);\n    }\n    $.post(new XWiki.Document('ApplicationsPanelConfigurationAjax', 'PanelsCode').getURL('get'), {\n      outputSyntax: 'plain',\n      form_token: xm.form_token,\n      blacklist: JSON.stringify(blacklist),\n      orderlist: JSON.stringify(displaylistOrder)\n    }).then(data =&gt; {\n      if (data === 'SUCCESS') {\n        new XWiki.widgets.Notification(l10n['success'], 'done');\n      } else if (data === 'BAD CSRF') {\n        new XWiki.widgets.Notification(l10n['csrf'], 'error');\n      } else if (data === 'NO RIGHT') {\n        new XWiki.widgets.Notification(l10n['noright'], 'error');\n      } else {\n        new XWiki.widgets.Notification(l10n['error'], 'error');\n      }\n    }).catch(() =&gt; {\n      new XWiki.widgets.Notification(l10n['error'], 'error');\n    });\n  };\n\n  /**\n   * Initialization\n   */\n  $(function() {\n    // Define the selector for the elements on which we will use the jquery-ui sortable plugin, which allows to sort\n    // inner elements with drag &amp;amp; drop.\n    var sortableSelector = '.appsPanel &gt; div &gt; ul';\n\n    // Enable the sortable plugin.\n    // The 'connectWith' option allows the drag &amp; drop from a sortable list (e.g. the displayed panels) to an other\n    // sortable list (e.g. the blacklisted panels).\n    // Here we create 2 sortable lists, because the selector match those 2.\n    $(sortableSelector).sortable({connectWith: sortableSelector});\n\n    // Allow reverting the changes\n    $('#bt-revert').on('click', function() {\n      // Refresh the page\n      window.location.reload();\n    });\n\n    // Redefine the save action\n    $('#bt-save').on('click', save);\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>Drag &amp; Drop</name>\n    </property>\n    <property>\n      <parse>0</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>PanelsCode.ApplicationsPanelConfigurationSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>e6d34b0f-3b57-4cdf-b263-ad878e949af3</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.draggableApp {\n  cursor: grab;\n  width: 100px;\n}\n\n.appsPanel .applicationsPanel {\n  min-height: 100px;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>CSS</name>\n    </property>\n    <property>\n      <parse>0</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"PanelsCode.ApplicationsPanelConfigurationSheet\" locale=\"\">\n  <web>PanelsCode</web>\n  <name>ApplicationsPanelConfigurationSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Panels.ApplicationsPanel</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>#if($doc.documentReference.name == 'ApplicationsPanelConfigurationSheet')ApplicationsPanelConfiguration Sheet#{else}$services.display.title($doc, {'displayerHint': 'default'})#end</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n##########################\n## JAVASCRIPT/CSS\n##########################\n#set($discard = $xwiki.jsx.use('PanelsCode.ApplicationsPanelConfigurationSheet'))\n#set($discard = $xwiki.ssx.use('PanelsCode.ApplicationsPanelConfigurationSheet'))\n##########################\n## First, we split the applications in 2 categories (white listed/black listed)\n##########################\n#set($displayedApps = [])\n#set($blacklistedApps = [])\n#if($doc.fullName == 'XWiki.XWikiPreferences')\n  #set($configDoc = $xwiki.getDocument($services.model.createDocumentReference('', 'PanelsCode', 'ApplicationsPanelConfiguration')))\n#else\n  #set($configDoc = $doc)\n#end\n#foreach($uix in $services.uix.getExtensions('org.xwiki.platform.panels.Applications', {'sortByParameter' : 'label'}))\n  #if(\"$!configDoc.getObject('PanelsCode.ApplicationsPanelBlackListClass', 'applicationId', $uix.id)\" != '')\n    #set($discard = $blacklistedApps.add({'uix': $uix}))\n  #else\n    #set ($app = {'uix': $uix})\n    #set ($orderObj = $configDoc.getObject('PanelsCode.ApplicationsPanelOrderClass', 'applicationId', $uix.id))\n    #if ($orderObj)\n      #set ($discard = $app.put('order', $orderObj.getValue('order')))\n    #else\n      ## if order is not set, set MAX_INTEGER\n      #set ($discard = $app.put('order', 2147483647))\n    #end\n    #set ($discard = $displayedApps.add($app))\n  #end\n#end\n## Sort the displayedApp\n#set ($displayedApps = $collectiontool.sort($displayedApps, 'order'))\n##########################\n## Macro to display an application panel\n##########################\n#macro(showAppPanel $id $title $class $apps)\n\n  {{html}}\n    &lt;div class=\"col-xs-12 col-md-6\"&gt;\n      &lt;div class=\"panel-width-Small panel $!class appsPanel\" id=\"$id\"&gt;\n        &lt;div class=\"panel-heading\"&gt;\n          &lt;h2&gt;$title&lt;/h2&gt;\n        &lt;/div&gt;\n        &lt;div class=\"panel-body\"&gt;\n          &lt;ul class=\"nav nav-pills applicationsPanel\"&gt;\n            #foreach($app in $apps)\n              #set($params = $app.uix.getParameters())\n              #set($normalizedIcon = $stringtool.substringBefore($!params.icon, ' '))\n              #if(\"$!normalizedIcon\" != '' &amp;&amp; \"$!params.label\" != '' &amp;&amp; \"$!params.target\" != '' &amp;&amp; $xwiki.hasAccessLevel('view', $xcontext.user, $params.target))\n                #if ($normalizedIcon.startsWith('icon:'))\n                  #set($icon = $services.icon.renderHTML($normalizedIcon.substring(5)))\n                #else\n                  #set($icon = $services.rendering.render($services.rendering.parse(\"image:${normalizedIcon}\", 'xwiki/2.1'), 'xhtml/1.0'))\n                #end\n                &lt;li class=\"draggableApp\" id=\"$escapetool.xml($app.uix.id)\"&gt;\n                  &lt;a&gt;&lt;span class=\"application-img\"&gt;$icon &lt;/span&gt; &lt;span class=\"application-label\"&gt;$escapetool.xml($params.label)&lt;/a&gt;\n                &lt;/li&gt;\n              #end\n            #end\n          &lt;/ul&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  {{/html}}\n#end\n##########################\n## Display the information message\n##########################\n(% class=\"noitems\" %)\n{{translation key=\"platform.panels.applications.helper\" /}}\n##########################\n## Display the 2 panels\n##########################\n(% class=\"row appLists\" %)\n(((\n  #showAppPanel('displayedPanels', $services.localization.render('platform.panels.applications.displayedapps'), 'panel-primary', $displayedApps)\n  #showAppPanel('blacklistedPanels', $services.localization.render('platform.panels.applications.blacklistedapps'), 'panel-info', $blacklistedApps)\n)))\n##########################\n## Display the buttons\n##########################\n{{html}}\n&lt;button class=\"btn btn-primary\" id=\"bt-save\"&gt;$services.localization.render('platform.panels.applications.save')&lt;/button&gt; &lt;button class=\"btn btn-default\" id=\"bt-revert\"&gt;$services.localization.render('platform.panels.applications.revert')&lt;/button&gt;\n{{/html}}\n{{/velocity}}\n</content>\n  <object>\n    <name>PanelsCode.ApplicationsPanelConfigurationSheet</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>3bd008ad-ec26-4593-899c-729733fd5e37</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('xwiki-panels-applications-config-messages', {\n  prefix: 'platform.panels.applications.ajax.',\n  keys: ['success', 'csrf', 'noright', 'error']\n});\n\n/************************************\n * Script that enable the drag &amp; drop of applications\n ************************************/\nrequire([\n  'jquery',\n  'xwiki-meta',\n  'xwiki-l10n!xwiki-panels-applications-config-messages',\n  'jquery-ui',\n  'jquery-ui-touch-punch'\n], function($, xm, l10n) {\n\n  /**\n   * Save the black list and the order configuration\n   */\n  var save = function() {\n    // Generate the array that contains all the applications to have in the blacklist\n    var blacklistElems = $('#blacklistedPanels li.draggableApp');\n    var blacklist = [];\n    for (var i = 0; i &lt; blacklistElems.length; ++i) {\n      blacklist.push(blacklistElems[i].id);\n    }\n    // Generate the JSON array that contains the order of the displayed applications\n    var displaylistElems = $('#displayedPanels li.draggableApp');\n    var displaylistOrder = [];\n    for (var i = 0; i &lt;displaylistElems.length; ++i) {\n      displaylistOrder.push(displaylistElems[i].id);\n    }\n    $.post(new XWiki.Document('ApplicationsPanelConfigurationAjax', 'PanelsCode').getURL('get'), {\n      outputSyntax: 'plain',\n      form_token: xm.form_token,\n      blacklist: JSON.stringify(blacklist),\n      orderlist: JSON.stringify(displaylistOrder)\n    }).then(data =&gt; {\n      if (data === 'SUCCESS') {\n        new XWiki.widgets.Notification(l10n['success'], 'done');\n      } else if (data === 'BAD CSRF') {\n        new XWiki.widgets.Notification(l10n['csrf'], 'error');\n      } else if (data === 'NO RIGHT') {\n        new XWiki.widgets.Notification(l10n['noright'], 'error');\n      } else {\n        new XWiki.widgets.Notification(l10n['error'], 'error');\n      }\n    }).catch(() =&gt; {\n      new XWiki.widgets.Notification(l10n['error'], 'error');\n    });\n  };\n\n  /**\n   * Initialization\n   */\n  $(function() {\n    // Define the selector for the elements on which we will use the jquery-ui sortable plugin, which allows to sort\n    // inner elements with drag &amp;amp; drop.\n    var sortableSelector = '.appsPanel &gt; div &gt; ul';\n\n    // Enable the sortable plugin.\n    // The 'connectWith' option allows the drag &amp; drop from a sortable list (e.g. the displayed panels) to an other\n    // sortable list (e.g. the blacklisted panels).\n    // Here we create 2 sortable lists, because the selector match those 2.\n    $(sortableSelector).sortable({connectWith: sortableSelector});\n\n    // Allow reverting the changes\n    $('#bt-revert').on('click', function() {\n      // Refresh the page\n      window.location.reload();\n    });\n\n    // Redefine the save action\n    $('#bt-save').on('click', save);\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>Drag &amp; Drop</name>\n    </property>\n    <property>\n      <parse>0</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n  <object>\n    <name>PanelsCode.ApplicationsPanelConfigurationSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>e6d34b0f-3b57-4cdf-b263-ad878e949af3</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.draggableApp {\n  cursor: grab;\n  width: 100px;\n}\n\n.appsPanel .applicationsPanel {\n  min-height: 100px;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>CSS</name>\n    </property>\n    <property>\n      <parse>0</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-panels/xwiki-platform-panels-ui/src/main/resources/PanelsCode/ApplicationsPanelConfigurationSheet.xml"], "buggy_code_start_loc": [87], "buggy_code_end_loc": [95], "fixing_code_start_loc": [87], "fixing_code_end_loc": [96], "type": "CWE-74", "message": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In affected versions any user with view rights can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of UIX parameters. A proof of concept exploit is to log in, add an `XWiki.UIExtensionClass` xobject to the user profile page, with an Extension Parameters content containing `label={{/html}} {{async async=\"true\" cached=\"false\" context=\"doc.reference\"}}{{groovy}}println(\"Hello \" + \"from groovy!\"){{/groovy}}{{/async}}`. Then, navigating to `PanelsCode.ApplicationsPanelConfigurationSheet` (i.e., `<xwiki-host>/xwiki/bin/view/PanelsCode/ApplicationsPanelConfigurationSheet` where `<xwiki-host>` is the URL of your XWiki installation) should not execute the Groovy script. If it does, you will see `Hello from groovy!` displayed on the screen. This vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10-rc-1. Users are advised to upgrade. For users unable to upgrade the issue can be fixed by editing the `PanelsCode.ApplicationsPanelConfigurationSheet` wiki page and making the same modifications as shown in commit `6de5442f3c`.", "other": {"cve": {"id": "CVE-2023-27479", "sourceIdentifier": "security-advisories@github.com", "published": "2023-03-07T19:15:12.577", "lastModified": "2023-03-14T17:02:14.973", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In affected versions any user with view rights can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of UIX parameters. A proof of concept exploit is to log in, add an `XWiki.UIExtensionClass` xobject to the user profile page, with an Extension Parameters content containing `label={{/html}} {{async async=\"true\" cached=\"false\" context=\"doc.reference\"}}{{groovy}}println(\"Hello \" + \"from groovy!\"){{/groovy}}{{/async}}`. Then, navigating to `PanelsCode.ApplicationsPanelConfigurationSheet` (i.e., `<xwiki-host>/xwiki/bin/view/PanelsCode/ApplicationsPanelConfigurationSheet` where `<xwiki-host>` is the URL of your XWiki installation) should not execute the Groovy script. If it does, you will see `Hello from groovy!` displayed on the screen. This vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10-rc-1. Users are advised to upgrade. For users unable to upgrade the issue can be fixed by editing the `PanelsCode.ApplicationsPanelConfigurationSheet` wiki page and making the same modifications as shown in commit `6de5442f3c`."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-74"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartExcluding": "6.3", "versionEndExcluding": "13.10.11", "matchCriteriaId": "DD6E852A-AEF3-4202-94F3-35D01894F6F8"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.4.7", "matchCriteriaId": "FA3A5151-58FB-48CF-BFFB-5688608200C8"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.5", "versionEndExcluding": "14.10", "matchCriteriaId": "569EE28C-5C86-467F-A153-DD4B9BF0053D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.3:-:*:*:*:*:*:*", "matchCriteriaId": "939A1216-3065-4637-B747-CE8A5E194EEE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.3:milestone1:*:*:*:*:*:*", "matchCriteriaId": "66AA1260-807B-4ED6-99D0-28C869A49D75"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.3:milestone2:*:*:*:*:*:*", "matchCriteriaId": "6387A0C9-03A5-43B5-81CB-034A745FF4A0"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/6de5442f3c91c3634a66c7b458d5b142e1c2a2dc", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-qxjg-jhgw-qhrv", "source": "security-advisories@github.com", "tags": ["Exploit", "Patch", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20294", "source": "security-advisories@github.com", "tags": ["Exploit", "Issue Tracking", "Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/6de5442f3c91c3634a66c7b458d5b142e1c2a2dc"}}