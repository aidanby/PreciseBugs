{"buggy_code": ["<template lang=\"pug\">\n  .search-results(v-if='searchIsFocused || (search && search.length > 1)')\n    .search-results-container\n      .search-results-help(v-if='!search || (search && search.length < 2)')\n        img(src='/_assets/svg/icon-search-alt.svg')\n        .mt-4 {{$t('common:header.searchHint')}}\n      .search-results-loader(v-else-if='searchIsLoading && (!results || results.length < 1)')\n        orbit-spinner(\n          :animation-duration='1000'\n          :size='100'\n          color='#FFF'\n        )\n        .headline.mt-5 {{$t('common:header.searchLoading')}}\n      .search-results-none(v-else-if='!searchIsLoading && (!results || results.length < 1)')\n        img(src='/_assets/svg/icon-no-results.svg', alt='No Results')\n        .subheading {{$t('common:header.searchNoResult')}}\n      template(v-if='results && results.length > 0')\n        v-subheader.white--text {{$t('common:header.searchResultsCount', { total: response.totalHits })}}\n        v-list.search-results-items.radius-7.py-0(two-line, dense)\n          template(v-for='(item, idx) of results')\n            v-list-item(@click='goToPage(item)', :key='item.id', :class='idx === cursor ? `highlighted` : ``')\n              v-list-item-avatar(tile)\n                img(src='/_assets/svg/icon-selective-highlighting.svg')\n              v-list-item-content\n                v-list-item-title(v-html='item.title')\n                v-list-item-subtitle.caption(v-html='item.description')\n                .caption.grey--text(v-html='item.path')\n              v-list-item-action\n                v-chip(label, outlined) {{item.locale.toUpperCase()}}\n            v-divider(v-if='idx < results.length - 1')\n        v-pagination.mt-3(\n          v-if='paginationLength > 1'\n          dark\n          v-model='pagination'\n          :length='paginationLength'\n          circle\n        )\n      template(v-if='suggestions && suggestions.length > 0')\n        v-subheader.white--text.mt-3 {{$t('common:header.searchDidYouMean')}}\n        v-list.search-results-suggestions.radius-7(dense, dark)\n          template(v-for='(term, idx) of suggestions')\n            v-list-item(:key='term', @click='setSearchTerm(term)', :class='idx + results.length === cursor ? `highlighted` : ``')\n              v-list-item-avatar\n                v-icon mdi-magnify\n              v-list-item-content\n                v-list-item-title(v-html='term')\n            v-divider(v-if='idx < suggestions.length - 1')\n      .text-xs-center.pt-5(v-if='search && search.length > 1')\n        //- v-btn.mx-2(outlined, color='orange', @click='search = ``', v-if='results.length > 0')\n        //-   v-icon(left) mdi-content-save\n        //-   span {{$t('common:header.searchCopyLink')}}\n        v-btn.mx-2(outlined, color='pink', @click='search = ``')\n          v-icon(left) mdi-close\n          span {{$t('common:header.searchClose')}}\n</template>\n\n<script>\nimport _ from 'lodash'\nimport { sync } from 'vuex-pathify'\nimport { OrbitSpinner } from 'epic-spinners'\n\nimport searchPagesQuery from 'gql/common/common-pages-query-search.gql'\n\nexport default {\n  components: {\n    OrbitSpinner\n  },\n  data() {\n    return {\n      cursor: 0,\n      pagination: 1,\n      perPage: 10,\n      response: {\n        results: [],\n        suggestions: [],\n        totalHits: 0\n      }\n    }\n  },\n  computed: {\n    search: sync('site/search'),\n    searchIsFocused: sync('site/searchIsFocused'),\n    searchIsLoading: sync('site/searchIsLoading'),\n    searchRestrictLocale: sync('site/searchRestrictLocale'),\n    searchRestrictPath: sync('site/searchRestrictPath'),\n    results() {\n      const currentIndex = (this.pagination - 1) * this.perPage\n      return this.response.results ? _.slice(this.response.results, currentIndex, currentIndex + this.perPage) : []\n    },\n    hits() {\n      return this.response.totalHits ? this.response.totalHits : 0\n    },\n    suggestions() {\n      return this.response.suggestions ? this.response.suggestions : []\n    },\n    paginationLength() {\n      return (this.response.totalHits > 0) ? Math.ceil(this.response.totalHits / this.perPage) : 0\n    }\n  },\n  watch: {\n    search(newValue, oldValue) {\n      this.cursor = 0\n      if (!newValue || (newValue && newValue.length < 2)) {\n        this.response.results = []\n        this.response.suggestions = []\n        this.searchIsLoading = false\n      } else {\n        this.searchIsLoading = true\n      }\n    }\n  },\n  mounted() {\n    this.$root.$on('searchMove', (dir) => {\n      this.cursor += ((dir === 'up') ? -1 : 1)\n      if (this.cursor < -1) {\n        this.cursor = -1\n      } else if (this.cursor > this.results.length + this.suggestions.length - 1) {\n        this.cursor = this.results.length + this.suggestions.length - 1\n      }\n    })\n    this.$root.$on('searchEnter', () => {\n      if (!this.results) {\n        return\n      }\n\n      if (this.cursor >= 0 && this.cursor < this.results.length) {\n        this.goToPage(_.nth(this.results, this.cursor))\n      } else if (this.cursor >= 0) {\n        this.setSearchTerm(_.nth(this.suggestions, this.cursor - this.results.length))\n      }\n    })\n  },\n  methods: {\n    setSearchTerm(term) {\n      this.search = term\n    },\n    goToPage(item) {\n      window.location.assign(`/${item.locale}/${item.path}`)\n    }\n  },\n  apollo: {\n    response: {\n      query: searchPagesQuery,\n      variables() {\n        return {\n          query: this.search\n        }\n      },\n      fetchPolicy: 'network-only',\n      debounce: 300,\n      throttle: 1000,\n      skip() {\n        return !this.search || this.search.length < 2\n      },\n      update: (data) => _.get(data, 'pages.search', {}),\n      watchLoading (isLoading) {\n        this.searchIsLoading = isLoading\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.search-results {\n  position: fixed;\n  top: 64px;\n  left: 0;\n  overflow-y: auto;\n  width: 100%;\n  height: calc(100% - 64px);\n  background-color: rgba(0,0,0,.9);\n  z-index: 100;\n  text-align: center;\n  animation: searchResultsReveal .6s ease;\n\n  @media #{map-get($display-breakpoints, 'sm-and-down')} {\n    top: 112px;\n  }\n\n  &-container {\n    margin: 12px auto;\n    width: 90vw;\n    max-width: 1024px;\n  }\n\n  &-help {\n    text-align: center;\n    padding: 32px 0;\n    font-size: 18px;\n    font-weight: 300;\n    color: #FFF;\n\n    img {\n      width: 104px;\n    }\n  }\n\n  &-loader {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    padding: 32px 0;\n    color: #FFF;\n  }\n\n  &-none {\n    color: #FFF;\n\n    img {\n      width: 200px;\n    }\n  }\n\n  &-items {\n    text-align: left;\n\n    .highlighted {\n      background: #FFF linear-gradient(to bottom, #FFF, mc('orange', '100'));\n\n      @at-root .theme--dark & {\n        background: mc('grey', '900') linear-gradient(to bottom, mc('orange', '900'), darken(mc('orange', '900'), 15%));\n      }\n    }\n  }\n\n  &-suggestions {\n    .highlighted {\n      background: transparent linear-gradient(to bottom, mc('blue', '500'), mc('blue', '700'));\n    }\n  }\n}\n\n@keyframes searchResultsReveal {\n  0% {\n    background-color: rgba(0,0,0,0);\n    padding-top: 32px;\n  }\n  100% {\n    background-color: rgba(0,0,0,.9);\n    padding-top: 0;\n  }\n}\n</style>\n"], "fixing_code": ["<template lang=\"pug\">\n  .search-results(v-if='searchIsFocused || (search && search.length > 1)')\n    .search-results-container\n      .search-results-help(v-if='!search || (search && search.length < 2)')\n        img(src='/_assets/svg/icon-search-alt.svg')\n        .mt-4 {{$t('common:header.searchHint')}}\n      .search-results-loader(v-else-if='searchIsLoading && (!results || results.length < 1)')\n        orbit-spinner(\n          :animation-duration='1000'\n          :size='100'\n          color='#FFF'\n        )\n        .headline.mt-5 {{$t('common:header.searchLoading')}}\n      .search-results-none(v-else-if='!searchIsLoading && (!results || results.length < 1)')\n        img(src='/_assets/svg/icon-no-results.svg', alt='No Results')\n        .subheading {{$t('common:header.searchNoResult')}}\n      template(v-if='results && results.length > 0')\n        v-subheader.white--text {{$t('common:header.searchResultsCount', { total: response.totalHits })}}\n        v-list.search-results-items.radius-7.py-0(two-line, dense)\n          template(v-for='(item, idx) of results')\n            v-list-item(@click='goToPage(item)', :key='item.id', :class='idx === cursor ? `highlighted` : ``')\n              v-list-item-avatar(tile)\n                img(src='/_assets/svg/icon-selective-highlighting.svg')\n              v-list-item-content\n                v-list-item-title(v-text='item.title')\n                v-list-item-subtitle.caption(v-text='item.description')\n                .caption.grey--text(v-text='item.path')\n              v-list-item-action\n                v-chip(label, outlined) {{item.locale.toUpperCase()}}\n            v-divider(v-if='idx < results.length - 1')\n        v-pagination.mt-3(\n          v-if='paginationLength > 1'\n          dark\n          v-model='pagination'\n          :length='paginationLength'\n          circle\n        )\n      template(v-if='suggestions && suggestions.length > 0')\n        v-subheader.white--text.mt-3 {{$t('common:header.searchDidYouMean')}}\n        v-list.search-results-suggestions.radius-7(dense, dark)\n          template(v-for='(term, idx) of suggestions')\n            v-list-item(:key='term', @click='setSearchTerm(term)', :class='idx + results.length === cursor ? `highlighted` : ``')\n              v-list-item-avatar\n                v-icon mdi-magnify\n              v-list-item-content\n                v-list-item-title(v-text='term')\n            v-divider(v-if='idx < suggestions.length - 1')\n      .text-xs-center.pt-5(v-if='search && search.length > 1')\n        //- v-btn.mx-2(outlined, color='orange', @click='search = ``', v-if='results.length > 0')\n        //-   v-icon(left) mdi-content-save\n        //-   span {{$t('common:header.searchCopyLink')}}\n        v-btn.mx-2(outlined, color='pink', @click='search = ``')\n          v-icon(left) mdi-close\n          span {{$t('common:header.searchClose')}}\n</template>\n\n<script>\nimport _ from 'lodash'\nimport { sync } from 'vuex-pathify'\nimport { OrbitSpinner } from 'epic-spinners'\n\nimport searchPagesQuery from 'gql/common/common-pages-query-search.gql'\n\nexport default {\n  components: {\n    OrbitSpinner\n  },\n  data() {\n    return {\n      cursor: 0,\n      pagination: 1,\n      perPage: 10,\n      response: {\n        results: [],\n        suggestions: [],\n        totalHits: 0\n      }\n    }\n  },\n  computed: {\n    search: sync('site/search'),\n    searchIsFocused: sync('site/searchIsFocused'),\n    searchIsLoading: sync('site/searchIsLoading'),\n    searchRestrictLocale: sync('site/searchRestrictLocale'),\n    searchRestrictPath: sync('site/searchRestrictPath'),\n    results() {\n      const currentIndex = (this.pagination - 1) * this.perPage\n      return this.response.results ? _.slice(this.response.results, currentIndex, currentIndex + this.perPage) : []\n    },\n    hits() {\n      return this.response.totalHits ? this.response.totalHits : 0\n    },\n    suggestions() {\n      return this.response.suggestions ? this.response.suggestions : []\n    },\n    paginationLength() {\n      return (this.response.totalHits > 0) ? Math.ceil(this.response.totalHits / this.perPage) : 0\n    }\n  },\n  watch: {\n    search(newValue, oldValue) {\n      this.cursor = 0\n      if (!newValue || (newValue && newValue.length < 2)) {\n        this.response.results = []\n        this.response.suggestions = []\n        this.searchIsLoading = false\n      } else {\n        this.searchIsLoading = true\n      }\n    }\n  },\n  mounted() {\n    this.$root.$on('searchMove', (dir) => {\n      this.cursor += ((dir === 'up') ? -1 : 1)\n      if (this.cursor < -1) {\n        this.cursor = -1\n      } else if (this.cursor > this.results.length + this.suggestions.length - 1) {\n        this.cursor = this.results.length + this.suggestions.length - 1\n      }\n    })\n    this.$root.$on('searchEnter', () => {\n      if (!this.results) {\n        return\n      }\n\n      if (this.cursor >= 0 && this.cursor < this.results.length) {\n        this.goToPage(_.nth(this.results, this.cursor))\n      } else if (this.cursor >= 0) {\n        this.setSearchTerm(_.nth(this.suggestions, this.cursor - this.results.length))\n      }\n    })\n  },\n  methods: {\n    setSearchTerm(term) {\n      this.search = term\n    },\n    goToPage(item) {\n      window.location.assign(`/${item.locale}/${item.path}`)\n    }\n  },\n  apollo: {\n    response: {\n      query: searchPagesQuery,\n      variables() {\n        return {\n          query: this.search\n        }\n      },\n      fetchPolicy: 'network-only',\n      debounce: 300,\n      throttle: 1000,\n      skip() {\n        return !this.search || this.search.length < 2\n      },\n      update: (data) => _.get(data, 'pages.search', {}),\n      watchLoading (isLoading) {\n        this.searchIsLoading = isLoading\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.search-results {\n  position: fixed;\n  top: 64px;\n  left: 0;\n  overflow-y: auto;\n  width: 100%;\n  height: calc(100% - 64px);\n  background-color: rgba(0,0,0,.9);\n  z-index: 100;\n  text-align: center;\n  animation: searchResultsReveal .6s ease;\n\n  @media #{map-get($display-breakpoints, 'sm-and-down')} {\n    top: 112px;\n  }\n\n  &-container {\n    margin: 12px auto;\n    width: 90vw;\n    max-width: 1024px;\n  }\n\n  &-help {\n    text-align: center;\n    padding: 32px 0;\n    font-size: 18px;\n    font-weight: 300;\n    color: #FFF;\n\n    img {\n      width: 104px;\n    }\n  }\n\n  &-loader {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    padding: 32px 0;\n    color: #FFF;\n  }\n\n  &-none {\n    color: #FFF;\n\n    img {\n      width: 200px;\n    }\n  }\n\n  &-items {\n    text-align: left;\n\n    .highlighted {\n      background: #FFF linear-gradient(to bottom, #FFF, mc('orange', '100'));\n\n      @at-root .theme--dark & {\n        background: mc('grey', '900') linear-gradient(to bottom, mc('orange', '900'), darken(mc('orange', '900'), 15%));\n      }\n    }\n  }\n\n  &-suggestions {\n    .highlighted {\n      background: transparent linear-gradient(to bottom, mc('blue', '500'), mc('blue', '700'));\n    }\n  }\n}\n\n@keyframes searchResultsReveal {\n  0% {\n    background-color: rgba(0,0,0,0);\n    padding-top: 32px;\n  }\n  100% {\n    background-color: rgba(0,0,0,.9);\n    padding-top: 0;\n  }\n}\n</style>\n"], "filenames": ["client/components/common/search-results.vue"], "buggy_code_start_loc": [25], "buggy_code_end_loc": [47], "fixing_code_start_loc": [25], "fixing_code_end_loc": [47], "type": "CWE-79", "message": "In Wiki.js before version 2.5.162, an XSS payload can be injected in a page title and executed via the search results. While the title is properly escaped in both the navigation links and the actual page title, it is not the case in the search results. Commit a57d9af34c15adbf460dde6553d964efddf433de fixes this vulnerability (version 2.5.162) by properly escaping the text content displayed in the search results.", "other": {"cve": {"id": "CVE-2020-15274", "sourceIdentifier": "security-advisories@github.com", "published": "2020-10-26T19:15:12.863", "lastModified": "2020-10-30T17:55:55.917", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In Wiki.js before version 2.5.162, an XSS payload can be injected in a page title and executed via the search results. While the title is properly escaped in both the navigation links and the actual page title, it is not the case in the search results. Commit a57d9af34c15adbf460dde6553d964efddf433de fixes this vulnerability (version 2.5.162) by properly escaping the text content displayed in the search results."}, {"lang": "es", "value": "En Wiki.js versiones anteriores a 2.5.162, una carga \u00fatil de tipo XSS puede ser inyectada en un t\u00edtulo de p\u00e1gina y ejecutada por medio de los resultados de b\u00fasqueda.&#xa0;Si bien el t\u00edtulo se escapa apropiadamente tanto en los enlaces de navegaci\u00f3n como en el t\u00edtulo de la p\u00e1gina real, no es el caso en los resultados de b\u00fasqueda.&#xa0;El commit a57d9af34c15adbf460dde6553d964efddf433de corrige esta vulnerabilidad (versi\u00f3n 2.5.162) al escapar apropiadamente el contenido de texto mostrado en los resultados de b\u00fasqueda"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.3, "impactScore": 4.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:requarks:wiki.js:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.5.162", "matchCriteriaId": "A5184AE8-018D-4B51-9320-9F02BD92134F"}]}]}], "references": [{"url": "https://docs.requarks.io/releases", "source": "security-advisories@github.com", "tags": ["Release Notes", "Vendor Advisory"]}, {"url": "https://github.com/Requarks/wiki/commit/a57d9af34c15adbf460dde6553d964efddf433de", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/Requarks/wiki/security/advisories/GHSA-pgjv-84m7-62q7", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Requarks/wiki/commit/a57d9af34c15adbf460dde6553d964efddf433de"}}