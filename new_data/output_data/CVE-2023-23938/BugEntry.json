{"buggy_code": ["<?php\n/**\n * Copyright (c) Enalean, 2012 - Present. All Rights Reserved.\n * Copyright (c) Xerox Corporation, Codendi Team, 2001-2009. All rights reserved\n *\n * This file is a part of Tuleap.\n *\n * Tuleap is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * Tuleap is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Tuleap. If not, see <http://www.gnu.org/licenses/>.\n */\n\n// phpcs:ignore PSR1.Classes.ClassDeclaration.MissingNamespace,Squiz.Classes.ValidClassName.NotCamelCaps\nclass Tracker_FormElement_Field_List_Bind_StaticValue extends Tracker_FormElement_Field_List_BindValue\n{\n    /**\n     *\n     * @var string\n     */\n    protected $label;\n\n    /**\n     *\n     * @var string\n     */\n    protected $description;\n\n    /**\n     *\n     * @var int\n     */\n    protected $rank;\n\n    public function __construct($id, $label, $description, $rank, $is_hidden)\n    {\n        parent::__construct($id, $is_hidden);\n        $this->label       = $label;\n        $this->description = $description;\n        $this->rank        = $rank;\n    }\n\n    public function __toString(): string\n    {\n        return $this->label ? $this->label : '';\n    }\n\n    /**\n     *\n     * @return int\n     *\n     * @psalm-mutation-free\n     */\n    public function getId()\n    {\n        return $this->id;\n    }\n\n    /**\n     *\n     * @param int $id\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setId($id)\n    {\n        $this->id = (int) $id;\n        return $this;\n    }\n\n    /**\n     *\n     * @return string\n     */\n    public function getLabel()\n    {\n        return $this->label;\n    }\n\n    /**\n     *\n     * @param string $label\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setLabel($label)\n    {\n        $this->label = (string) $label;\n        return $this;\n    }\n\n    /**\n     *\n     * @return string\n     */\n    public function getDescription()\n    {\n        return $this->description;\n    }\n\n    /**\n     *\n     * @param string $description\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setDescription($description)\n    {\n        $this->description = $description;\n        return $this;\n    }\n\n    /**\n     *\n     * @return int\n     */\n    public function getRank()\n    {\n        return $this->rank;\n    }\n\n    /**\n     *\n     * @param int $rank\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setRank($rank)\n    {\n        $this->rank = (int) $rank;\n        return $this;\n    }\n\n    public function getDataset(Tracker_FormElement_Field_List $field): array\n    {\n        $decorators = $field->getDecorators();\n        $id         = $this->getId();\n\n        if (! empty($decorators) && isset($decorators[$id])) {\n            $purifier = Codendi_HTTPPurifier::instance();\n            return [\n                \"data-color-value\" => $purifier->purify($decorators[$id]->getCurrentColor()),\n            ];\n        }\n\n        return [];\n    }\n\n    public function getFullRESTValue(Tracker_FormElement_Field $field)\n    {\n        $color          = null;\n        $tlp_color_name = null;\n        /** @var Tracker_FormElement_Field_List_BindDecorator[] $decorators */\n        $decorators = $field->getDecorators();\n\n        if (! empty($decorators) && isset($decorators[$this->getId()])) {\n            $decorator = $decorators[$this->getId()];\n            if ($decorator->isUsingOldPalette()) {\n                $color = [\n                    'r' => (int) $decorator->r,\n                    'g' => (int) $decorator->g,\n                    'b' => (int) $decorator->b,\n                ];\n            } else {\n                $tlp_color_name = $decorator->tlp_color_name;\n            }\n        }\n\n        return [\n            'id'        => $this->getId(),\n            'label'     => $this->getLabel(),\n            'color'     => $color,\n            'tlp_color' => $tlp_color_name,\n        ];\n    }\n}\n"], "fixing_code": ["<?php\n/**\n * Copyright (c) Enalean, 2012 - Present. All Rights Reserved.\n * Copyright (c) Xerox Corporation, Codendi Team, 2001-2009. All rights reserved\n *\n * This file is a part of Tuleap.\n *\n * Tuleap is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * Tuleap is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Tuleap. If not, see <http://www.gnu.org/licenses/>.\n */\n\n// phpcs:ignore PSR1.Classes.ClassDeclaration.MissingNamespace,Squiz.Classes.ValidClassName.NotCamelCaps\nclass Tracker_FormElement_Field_List_Bind_StaticValue extends Tracker_FormElement_Field_List_BindValue\n{\n    /**\n     *\n     * @var string\n     */\n    protected $label;\n\n    /**\n     *\n     * @var string\n     */\n    protected $description;\n\n    /**\n     *\n     * @var int\n     */\n    protected $rank;\n\n    public function __construct($id, $label, $description, $rank, $is_hidden)\n    {\n        parent::__construct($id, $is_hidden);\n        $this->label       = $label;\n        $this->description = $description;\n        $this->rank        = $rank;\n    }\n\n    public function __toString(): string\n    {\n        return $this->label ? $this->label : '';\n    }\n\n    /**\n     *\n     * @return int\n     *\n     * @psalm-mutation-free\n     */\n    public function getId()\n    {\n        return $this->id;\n    }\n\n    /**\n     *\n     * @param int $id\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setId($id)\n    {\n        $this->id = (int) $id;\n        return $this;\n    }\n\n    /**\n     *\n     * @return string\n     */\n    public function getLabel()\n    {\n        return $this->label;\n    }\n\n    /**\n     *\n     * @param string $label\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setLabel($label)\n    {\n        $this->label = (string) $label;\n        return $this;\n    }\n\n    /**\n     *\n     * @return string\n     */\n    public function getDescription()\n    {\n        return $this->description;\n    }\n\n    /**\n     *\n     * @param string $description\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setDescription($description)\n    {\n        $this->description = $description;\n        return $this;\n    }\n\n    /**\n     *\n     * @return int\n     */\n    public function getRank()\n    {\n        return $this->rank;\n    }\n\n    /**\n     *\n     * @param int $rank\n     * @return \\Tracker_FormElement_Field_List_Bind_StaticValue\n     */\n    public function setRank($rank)\n    {\n        $this->rank = (int) $rank;\n        return $this;\n    }\n\n    public function getDataset(Tracker_FormElement_Field_List $field): array\n    {\n        $decorators = $field->getDecorators();\n        $id         = $this->getId();\n\n        if (! empty($decorators) && isset($decorators[$id])) {\n            $purifier = Codendi_HTMLPurifier::instance();\n            return [\n                \"data-color-value\" => $purifier->purify($decorators[$id]->getCurrentColor()),\n            ];\n        }\n\n        return [];\n    }\n\n    public function getFullRESTValue(Tracker_FormElement_Field $field)\n    {\n        $color          = null;\n        $tlp_color_name = null;\n        /** @var Tracker_FormElement_Field_List_BindDecorator[] $decorators */\n        $decorators = $field->getDecorators();\n\n        if (! empty($decorators) && isset($decorators[$this->getId()])) {\n            $decorator = $decorators[$this->getId()];\n            if ($decorator->isUsingOldPalette()) {\n                $color = [\n                    'r' => (int) $decorator->r,\n                    'g' => (int) $decorator->g,\n                    'b' => (int) $decorator->b,\n                ];\n            } else {\n                $tlp_color_name = $decorator->tlp_color_name;\n            }\n        }\n\n        return [\n            'id'        => $this->getId(),\n            'label'     => $this->getLabel(),\n            'color'     => $color,\n            'tlp_color' => $tlp_color_name,\n        ];\n    }\n}\n"], "filenames": ["plugins/tracker/include/Tracker/FormElement/Tracker_FormElement_Field_List_Bind_StaticValue.php"], "buggy_code_start_loc": [144], "buggy_code_end_loc": [145], "fixing_code_start_loc": [144], "fixing_code_end_loc": [145], "type": "CWE-79", "message": "Tuleap is a Free & Source tool for end to end traceability of application and system developments. Affected versions are subject to a cross site scripting attack which can be injected in the name of a color of select box values of a tracker and then reflected in the tracker administration. Administrative privilege is required, but an attacker with tracker administration rights could use this vulnerability to force a victim to execute uncontrolled code in the context of their browser. This issue has been addressed in Tuleap Community Edition version 14.5.99.4. Users are advised to upgrade. There are no known workarounds for this issue.", "other": {"cve": {"id": "CVE-2023-23938", "sourceIdentifier": "security-advisories@github.com", "published": "2023-04-20T17:15:07.120", "lastModified": "2023-05-02T17:29:19.817", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Tuleap is a Free & Source tool for end to end traceability of application and system developments. Affected versions are subject to a cross site scripting attack which can be injected in the name of a color of select box values of a tracker and then reflected in the tracker administration. Administrative privilege is required, but an attacker with tracker administration rights could use this vulnerability to force a victim to execute uncontrolled code in the context of their browser. This issue has been addressed in Tuleap Community Edition version 14.5.99.4. Users are advised to upgrade. There are no known workarounds for this issue."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.9, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 3.7}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:enalean:tuleap:*:*:*:*:enterprise:*:*:*", "versionEndExcluding": "14.4-7", "matchCriteriaId": "1092E5D2-592F-45AE-AAD7-055F42EEBA67"}, {"vulnerable": true, "criteria": "cpe:2.3:a:enalean:tuleap:*:*:*:*:community:*:*:*", "versionStartIncluding": "13.8.99.49", "versionEndExcluding": "14.5.99.4", "matchCriteriaId": "F4555DF2-D6B6-4CE1-901B-4E886DA794E2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:enalean:tuleap:*:*:*:*:enterprise:*:*:*", "versionStartIncluding": "14.5", "versionEndExcluding": "14.5-2", "matchCriteriaId": "5E58AAFA-7D70-4AF5-9916-1F43B5286072"}]}]}], "references": [{"url": "https://github.com/Enalean/tuleap/commit/aacd5e798301f24f218298ec8236ec7bef0f5d52", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-mqjm-c6rm-9h87", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://tuleap.net/plugins/tracker/?aid=30734", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/Enalean/tuleap/commit/aacd5e798301f24f218298ec8236ec7bef0f5d52"}}