{"buggy_code": ["# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-haproxy-devel\nPORTVERSION=\t0.59\nPORTREVISION=\t16\nCATEGORIES=\tnet\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package haproxy-devel\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\thaproxy>0:net/haproxy\n\nCONFLICTS=\tpfSense-pkg-haproxy-[0-9]*\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/include\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/shortcuts\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/haproxy\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/haproxy.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socket.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_sync.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_gui.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socketinfo.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_xmlrpcsyncclient.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_htmllist.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_utils.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/pkg_haproxy_tabs.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_upgrade_config.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_global.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_files.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pools.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pool_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_stats.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_templates.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/include/widget-haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/include\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/widgets/haproxy.widget.php \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/www/shortcuts/pkg_haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/shortcuts\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/haproxy.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * haproxy_listeners.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2008 Remco Hoef <remcoverhoef@pfsense.com>\n * Copyright (c) 2009 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 PiBa-NL\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n$shortcut_section = \"haproxy\";\nrequire_once(\"guiconfig.inc\");\nrequire_once(\"certs.inc\");\nrequire_once(\"haproxy/haproxy.inc\");\nrequire_once(\"haproxy/haproxy_gui.inc\");\nrequire_once(\"haproxy/haproxy_utils.inc\");\nrequire_once(\"haproxy/pkg_haproxy_tabs.inc\");\n\n$changedesc = \"Services: HAProxy: Frontends\";\n\nhaproxy_config_init();\n\n$a_frontend = &getarraybyref($config, 'installedpackages', 'haproxy', 'ha_backends', 'item');\n\nfunction array_moveitemsbefore(&$items, $before, $selected) {\n\t// generic function to move array items before the set item by their numeric indexes.\n\n\t$a_new = array();\n\t/* copy all entries < $before and not selected */\n\tfor ($i = 0; $i < $before; $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy all selected entries */\n\tfor ($i = 0; $i < count($items); $i++) {\n\t\tif ($i == $before) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy $before entry */\n\tif ($before < count($items)) {\n\t\t$a_new[] = $items[$before];\n\t}\n\t/* copy all entries > $before and not selected */\n\tfor ($i = $before+1; $i < count($items); $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\tif (count($a_new) > 0) {\n\t\t$items = $a_new;\n\t}\n}\n\nif($_GET['action'] == \"toggle\") {\n\t$id = $_GET['id'];\n\techo \"$id|\";\n\tif (isset($a_frontend[get_frontend_id($id)])) {\n\t\t$frontent = &$a_frontend[get_frontend_id($id)];\n\t\tif ($frontent['status'] != \"disabled\"){\n\t\t\t$frontent['status'] = 'disabled';\n\t\t\techo \"0|\";\n\t\t}else{\n\t\t\t$frontent['status'] = 'active';\n\t\t\techo \"1|\";\n\t\t}\n\t\t$changedesc .= \" set frontend '$id' status to: {$frontent['status']}\";\n\n\t\ttouch($d_haproxyconfdirty_path);\n\t\twrite_config($changedesc);\n\t}\n\techo \"ok|\";\n\texit;\n}\n\nif ($_POST) {\n\t$pconfig = $_POST;\n\n\tif ($_POST['apply']) {\n\t\t$result = haproxy_check_and_run($savemsg, true);\n\t\tif ($result) {\n\t\t\tunlink_if_exists($d_haproxyconfdirty_path);\n\t\t}\n\t} elseif ($_POST['del_x']) {\n\t\t/* delete selected rules */\n\t\t$deleted = false;\n\t\tif (is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tforeach ($selected as $itemnr) {\n\t\t\t\tunset($a_frontend[$itemnr]);\n\t\t\t\t$deleted = true;\n\t\t\t}\n\t\t\tif ($deleted) {\n\t\t\t\tif (write_config(\"HAProxy, deleting frontend(s)\")) {\n\t\t\t\t\t//mark_subsystem_dirty('filter');\n\t\t\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\t\t}\n\t\t\t}\n\t\t\theader(\"Location: haproxy_listeners.php\");\n\t\t\texit;\n\t\t}\n\t} else {\n\n\t\t// from '\\src\\usr\\local\\www\\vpn_ipsec.php'\n\t\t/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */\n\t\t// TODO: this. is. nasty.\n\t\tunset($delbtn, $delbtnp2, $movebtn, $movebtnp2, $togglebtn, $togglebtnp2);\n\t\tforeach ($_POST as $pn => $pd) {\n\t\t\t// if name contains a dot its replaced in $POST key value by a underscore while $pd can be an array for some values..\n\t\t\tif (preg_match(\"/move_(.+)/\", $pn, $matches)) {\n\t\t\t\t$movebtn = substr($pd, 5);\n\t\t\t}\n\t\t}\n\t\t//\n\n\t\t/* move selected p1 entries before this */\n\t\tif (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$moveto = get_frontend_id($movebtn);\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tarray_moveitemsbefore($a_frontend, $moveto, $selected);\n\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\twrite_config($changedesc);\n\t\t}\n\t}\n} else {\n\t$result = haproxy_check_config($retval);\n\tif ($result) {\n\t\t$savemsg = gettext($result);\n\t}\n}\n\nif ($_GET['act'] == \"del\") {\n\t$id = $_GET['id'];\n\t$id = get_frontend_id($id);\n\tif (isset($a_frontend[$id])) {\n\t\tif (!$input_errors) {\n\t\t\tunset($a_frontend[$id]);\n\t\t\t$changedesc .= \" Frontend delete\";\n\t\t\twrite_config($changedesc);\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t}\n\t\theader(\"Location: haproxy_listeners.php\");\n\t\texit;\n\t}\n}\n\nfunction haproxy_userlist_backend_servers($backendname) {\n\t//used for hint title text when hovering mouse over a backend name\n\tglobal $a_servermodes;\n\t$backend_servers = \"\";\n\t$backend = get_backend($backendname);\n\tif ($backend){\n\t\t$servers = getarraybyref($backend, 'ha_servers', 'item');\n\t\tif (count($servers) == 0) {\n\t\t\t$backend_servers = sprintf(gettext(\"There are no servers in \\\"%s\\\" pool\"), $backendname);\n\t\t} else {\n\t\t\t$backend_servers = sprintf(gettext(\"Servers in \\\"%s\\\" pool:\"), $backendname);\n\t\t\tforeach($servers as $server){\n\t\t\t\t$srvstatus = $server['status'];\n\t\t\t\t$status = $a_servermodes[$srvstatus]['sign'];\n\t\t\t\tif (isset($server['forwardto']) && $server['forwardto'] != \"\") {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}[{$server['forwardto']}]\";\n\t\t\t\t} else {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}{$server['address']}:{$server['port']}\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn $backend_servers;\n}\n\n$pgtitle = array(\"Services\", \"HAProxy\", \"Frontend\");\ninclude(\"head.inc\");\nif ($input_errors) {\n\tprint_input_errors($input_errors);\n}\nif ($savemsg) {\n\tprint_info_box($savemsg);\n}\n\n$display_apply = file_exists($d_haproxyconfdirty_path) ? \"\" : \"none\";\necho \"<div id='showapplysettings' style='display: {$display_apply};'>\";\nprint_apply_box(sprintf(gettext(\"The haproxy configuration has been changed.%sYou must apply the changes in order for them to take effect.\"), \"<br/>\"));\necho \"</div>\";\n\nhaproxy_display_top_tabs_active($haproxy_tab_array['haproxy'], \"frontend\");\n\n?>\n<form action=\"haproxy_listeners.php\" method=\"post\">\n<script type=\"text/javascript\">\nfunction set_content(elementid, image) {\n\tvar item = document.getElementById(elementid);\n\titem.innerHTML = image;\n}\nfunction toggleFrontend(frontendname) {\n\t$.ajax({\n\t\turl: \"\",\n\t\tdata: {id: frontendname, action:\"toggle\"},\n\t\tsuccess: function(data){\n\t\t\tjs_callback(data);\n\t\t}\n\t})\n}\nfunction js_callback(req) {\n\tshowapplysettings.style.display = 'block';\n\n\tif(req !== '') {\n\t\tvar itemsplit = req.split(\"|\");\n\t\tbuttonid = itemsplit[0];\n\t\tenabled = itemsplit[1];\n\t\tif (enabled === \"1\"){\n\t\t\timg = \"<?=haproxyicon(\"enabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t} else {\n\t\t\timg = \"<?=haproxyicon(\"disabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t}\n\t\tset_content('btn_'+buttonid, img);\n\t}\n}\n</script>\n<?php\n\n\tfunction sort_sharedfrontends(&$a, &$b) {\n\t\t// make sure the 'primary frontend' is the first in the array, after that sort by name.\n\t\tif ($a['secondary'] != $b['secondary']) {\n\t\t\treturn $a['secondary'] > $b['secondary'] ? 1 : -1;\n\t\t}\n\t\tif ($a['name'] != $b['name']) {\n\t\t\treturn $a['name'] > $b['name'] ? 1 : -1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t$a_frontend_grouped = array();\n\tforeach($a_frontend as &$frontend2) {\n\t\tgetarraybyref($frontend2);// makes it a valid array in case the item was completely empty.\n\t\t$mainfrontend = get_primaryfrontend($frontend2);\n\t\t$mainname = $mainfrontend['name'];\n\t\t$ipport = get_frontend_ipport($frontend2, true);\n\t\t$frontend2['ipport'] = $ipport;\n\t\t$frontend2['type'] = $mainfrontend['type'];\n\t\t$a_frontend_grouped[$mainname][] = $frontend2;\n\t}\n?>\n\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h2 class=\"panel-title\">Frontends</h2>\n\t\t</div>\n\t\t<div id=\"mainarea\" class=\"table-responsive panel-body\">\n\t\t\t<table class=\"table table-hover table-striped table-condensed\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Primary</th>\n\t\t\t\t\t\t<th>Shared</th>\n\t\t\t\t\t\t<th>On</th>\n\t\t\t\t\t\t<th>Advanced</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t\t<th>Address</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Backend</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody class=\"user-entries\">\n<?php\n\t\t$textgray = \"\";\n\t\t$first = true;\n\t\t$last_frontend_shared = false;\n\t\t$i = 0;\n\t\tforeach ($a_frontend_grouped as $a_frontend) {\n\t\t\t//usort($a_frontend, 'sort_sharedfrontends');\n\t\t\tif ((count($a_frontend) > 1 || $last_frontend_shared) && !$first) {\n\t\t\t\t?> <tr class=\"<?=$textgray?>\"><td colspan=\"10\">&nbsp;</td></tr> <?\n\t\t\t}\n\t\t\t$first = false;\n\t\t\t$last_frontend_shared = count($a_frontend) > 1;\n\t\t\tforeach ($a_frontend as $frontend) {\n\t\t\t\t$frontendname = $frontend['name'];\n\t\t\t\t$disabled = $frontend['status'] != 'active';\n\t\t\t\t?>\n\t\t\t\t\t<tr id=\"fr<?=$frontendname;?>\" <?=$display?> onClick=\"fr_toggle('<?=$frontendname;?>')\" ondblclick=\"document.location='haproxy_listeners_edit.php?id=<?=$frontendname;?>';\" <?=($disabled ? ' class=\"disabled\"' : '')?>>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t<?if($frontend['secondary'] != 'yes'):?>\n\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t\t\t<?endif?>\n\t\t\t\t\t\t</td>\n\t\t\t\t  <td>\n\t\t\t\t  <?if($frontend['secondary'] == 'yes'):?>\n\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t  <?endif?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t\tif ($frontend['status']=='disabled'){\n\t\t\t\t\t\t\t$iconfn = \"disabled\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$iconfn = \"enabled\";\n\t\t\t\t\t\t}?>\n\t\t\t\t\t<a id=\"btn_<?=$frontendname;?>\" href='javascript:toggleFrontend(\"<?=$frontendname;?>\");'>\n\t\t\t\t\t\t<?=haproxyicon($iconfn, gettext(\"click to toggle enable/disable this frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$acls = get_frontend_acls($frontend);\n\t\t\t\t\t$isaclset = \"\";\n\t\t\t\t\tforeach ($acls as $acl) {\n\t\t\t\t\t\t$isaclset .= \"\\n\" . htmlspecialchars($acl['descr']);\n\t\t\t\t\t}\n\t\t\t\t\tif ($isaclset) {\n\t\t\t\t\t\techo haproxyicon(\"acl\", gettext(\"acl's used\") . \": {$isaclset}\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get_frontend_uses_ssl($frontend)) {\n\t\t\t\t\t\t$cert = lookup_cert($frontend['ssloffloadcert']);\n\t\t\t\t\t\t$descr = htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t$certs = getarraybyref($frontend, 'ha_certificates', 'item');\n\t\t\t\t\t\tif (count($certs) > 0){\n\t\t\t\t\t\t\tforeach($certs as $certitem){\n\t\t\t\t\t\t\t\t$cert = lookup_cert($certitem['ssl_certificate']);\n\t\t\t\t\t\t\t\t$descr .= \"\\n\".htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading cert: {$descr}\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$isadvset = \"\";\n\t\t\t\t\tif ($frontend['advanced_bind']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced bind: \".htmlspecialchars($frontend['advanced_bind']).\"\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($frontend['advanced']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced pass thru setting used\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($isadvset) {\n\t\t\t\t\t\techo haproxyicon(\"advanced\", gettext(\"Advanced settings set\") . \": {$isadvset}\");\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['name'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['desc'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t    <?php\n\t\t\t\t\t\t$first = true;\n\t\t\t\t\t\tforeach($frontend['ipport'] as $addr) {\n\t\t\t\t\t\t\t//if (!$first)\n\t\t\t\t\t\t\t//\tprint \"<br/>\";\n\t\t\t\t\t\t\tprint \"<div style='white-space:nowrap;'>\";\n\t\t\t\t\t\t\tprint \"{$addr['addr']}:{$addr['port']}\";\n\t\t\t\t\t\t\tif ($addr['ssl'] == 'yes') {\n\t\t\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprint \"</div>\";\n\t\t\t\t\t\t\t$first = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t  <?php\n\t\t\t\t\tif ($frontend['type'] == 'http') {\n\t\t\t\t\t\t$mainfrontend = get_primaryfrontend($frontend);\n\t\t\t\t\t\t$sslused = get_frontend_uses_ssl($mainfrontend);\n\t\t\t\t\t\t$httpused = !get_frontend_uses_ssl_only($frontend);\n\t\t\t\t\t\tif ($httpused) {\n\t\t\t\t\t\t\techo \"http\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($sslused) {\n\t\t\t\t\t\t\techo ($httpused ? \"/\" : \"\") . \"https\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\techo $a_frontendmode[$frontend['type']]['shortname'];\n\t\t\t\t\t}\n\t\t\t\t  ?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$a_actionitems = getarraybyref($frontend, 'a_actionitems', 'item');\n\t\t\t\t\tforeach ($a_actionitems as $actionitem) {\n\t\t\t\t\t\tif ($actionitem['action'] == \"use_backend\") {\n\t\t\t\t\t\t\t$backend = $actionitem['use_backendbackend'];\n\t\t\t\t\t\t\t$hint = haproxy_userlist_backend_servers($backend);\n\t\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a>\";\n\t\t\t\t\t\t\tif (!empty($actionitem['acl'])) {\n\t\t\t\t\t\t\t\techo \"&nbsp;if({$actionitem['acl']})\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$hint = haproxy_userlist_backend_servers($frontend['backend_serverpool']);\n\t\t\t\t\t$backend = $frontend['backend_serverpool'];\n\t\t\t\t\tif (!empty($backend)) {\n\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a> (default)\";\n\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td class=\"action-buttons\">\n\t\t\t\t\t<button style=\"display: none;\" class=\"btn btn-default btn-xs\" type=\"submit\" id=\"move_<?=$frontendname?>\" name=\"move_<?=$frontendname?>\" value=\"move_<?=$frontendname?>\"></button>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"edit\", gettext(\"edit frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners.php?act=del&amp;id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"delete\", gettext(\"delete frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?dup=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"clone\", gettext(\"clone frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t</tr><?php\n\t\t\t}\n\t\t}\n?>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<nav class=\"action-buttons\">\n\t\t<a href=\"haproxy_listeners_edit.php\" role=\"button\" class=\"btn btn-sm btn-success\" title=\"<?=gettext('Add frontend to the end of the list')?>\">\n\t\t\t<i class=\"fa fa-level-down icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Add\");?>\n\t\t</a>\n\t\t<button name=\"del_x\" type=\"submit\" class=\"btn btn-danger btn-sm no-confirm\" value=\"<?=gettext(\"Delete selected frontends\"); ?>\" title=\"<?=gettext('Delete selected frontends')?>\">\n\t\t\t<i class=\"fa fa-trash icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Delete\"); ?>\n\t\t</button>\n\t\t<button type=\"submit\" id=\"order-store\" name=\"order-store\" class=\"btn btn-sm btn-primary no-confirm\" value=\"store changes\" disabled title=\"<?=gettext('Save backend order')?>\">\n\t\t\t<i class=\"fa fa-save icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Save\")?>\n\t\t</button>\n\t</nav>\n</form>\n\n<script type=\"text/javascript\">\n//<![CDATA[\nevents.push(function() {\n\t$('[id^=Xmove_]').click(function (event) {\n\t\t$('[id=\"'+event.target.id.slice(1)+'\"]').click();\n\t\treturn false;\n\t});\n\t$('[id^=Xmove_]').css('cursor', 'pointer');\n\n\t// Check all of the rule checkboxes so that their values are posted\n\t$('#order-store').click(function () {\n\t   $('[id^=frc]').prop('checked', true);\n\t});\n});\n//]]>\n</script>\n<?php include(\"foot.inc\");\n", "# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-haproxy\nPORTVERSION=\t0.59\nPORTREVISION=\t15\nCATEGORIES=\tnet\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package haproxy\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\thaproxy17>0:net/haproxy17\n\nCONFLICTS=\tpfSense-pkg-haproxy-devel-[0-9]*\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/include\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/shortcuts\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/haproxy\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/haproxy.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socket.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_sync.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_gui.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socketinfo.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_xmlrpcsyncclient.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_htmllist.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_utils.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/pkg_haproxy_tabs.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_upgrade_config.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_global.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_files.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pools.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pool_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_stats.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_templates.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/include/widget-haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/include\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/widgets/haproxy.widget.php \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/www/shortcuts/pkg_haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/shortcuts\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/haproxy.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * haproxy_listeners.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2008 Remco Hoef <remcoverhoef@pfsense.com>\n * Copyright (c) 2009 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 PiBa-NL\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n$shortcut_section = \"haproxy\";\nrequire_once(\"guiconfig.inc\");\nrequire_once(\"certs.inc\");\nrequire_once(\"haproxy/haproxy.inc\");\nrequire_once(\"haproxy/haproxy_gui.inc\");\nrequire_once(\"haproxy/haproxy_utils.inc\");\nrequire_once(\"haproxy/pkg_haproxy_tabs.inc\");\n\n$changedesc = \"Services: HAProxy: Frontends\";\n\nhaproxy_config_init();\n\n$a_frontend = &getarraybyref($config, 'installedpackages', 'haproxy', 'ha_backends', 'item');\n\nfunction array_moveitemsbefore(&$items, $before, $selected) {\n\t// generic function to move array items before the set item by their numeric indexes.\n\n\t$a_new = array();\n\t/* copy all entries < $before and not selected */\n\tfor ($i = 0; $i < $before; $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy all selected entries */\n\tfor ($i = 0; $i < count($items); $i++) {\n\t\tif ($i == $before) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy $before entry */\n\tif ($before < count($items)) {\n\t\t$a_new[] = $items[$before];\n\t}\n\t/* copy all entries > $before and not selected */\n\tfor ($i = $before+1; $i < count($items); $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\tif (count($a_new) > 0) {\n\t\t$items = $a_new;\n\t}\n}\n\nif($_GET['action'] == \"toggle\") {\n\t$id = $_GET['id'];\n\techo \"$id|\";\n\tif (isset($a_frontend[get_frontend_id($id)])) {\n\t\t$frontent = &$a_frontend[get_frontend_id($id)];\n\t\tif ($frontent['status'] != \"disabled\"){\n\t\t\t$frontent['status'] = 'disabled';\n\t\t\techo \"0|\";\n\t\t}else{\n\t\t\t$frontent['status'] = 'active';\n\t\t\techo \"1|\";\n\t\t}\n\t\t$changedesc .= \" set frontend '$id' status to: {$frontent['status']}\";\n\n\t\ttouch($d_haproxyconfdirty_path);\n\t\twrite_config($changedesc);\n\t}\n\techo \"ok|\";\n\texit;\n}\n\nif ($_POST) {\n\t$pconfig = $_POST;\n\n\tif ($_POST['apply']) {\n\t\t$result = haproxy_check_and_run($savemsg, true);\n\t\tif ($result) {\n\t\t\tunlink_if_exists($d_haproxyconfdirty_path);\n\t\t}\n\t} elseif ($_POST['del_x']) {\n\t\t/* delete selected rules */\n\t\t$deleted = false;\n\t\tif (is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tforeach ($selected as $itemnr) {\n\t\t\t\tunset($a_frontend[$itemnr]);\n\t\t\t\t$deleted = true;\n\t\t\t}\n\t\t\tif ($deleted) {\n\t\t\t\tif (write_config(\"HAProxy, deleting frontend(s)\")) {\n\t\t\t\t\t//mark_subsystem_dirty('filter');\n\t\t\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\t\t}\n\t\t\t}\n\t\t\theader(\"Location: haproxy_listeners.php\");\n\t\t\texit;\n\t\t}\n\t} else {\n\n\t\t// from '\\src\\usr\\local\\www\\vpn_ipsec.php'\n\t\t/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */\n\t\t// TODO: this. is. nasty.\n\t\tunset($delbtn, $delbtnp2, $movebtn, $movebtnp2, $togglebtn, $togglebtnp2);\n\t\tforeach ($_POST as $pn => $pd) {\n\t\t\t// if name contains a dot its replaced in $POST key value by a underscore while $pd can be an array for some values..\n\t\t\tif (preg_match(\"/move_(.+)/\", $pn, $matches)) {\n\t\t\t\t$movebtn = substr($pd, 5);\n\t\t\t}\n\t\t}\n\t\t//\n\n\t\t/* move selected p1 entries before this */\n\t\tif (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$moveto = get_frontend_id($movebtn);\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tarray_moveitemsbefore($a_frontend, $moveto, $selected);\n\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\twrite_config($changedesc);\n\t\t}\n\t}\n} else {\n\t$result = haproxy_check_config($retval);\n\tif ($result) {\n\t\t$savemsg = gettext($result);\n\t}\n}\n\nif ($_GET['act'] == \"del\") {\n\t$id = $_GET['id'];\n\t$id = get_frontend_id($id);\n\tif (isset($a_frontend[$id])) {\n\t\tif (!$input_errors) {\n\t\t\tunset($a_frontend[$id]);\n\t\t\t$changedesc .= \" Frontend delete\";\n\t\t\twrite_config($changedesc);\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t}\n\t\theader(\"Location: haproxy_listeners.php\");\n\t\texit;\n\t}\n}\n\nfunction haproxy_userlist_backend_servers($backendname) {\n\t//used for hint title text when hovering mouse over a backend name\n\tglobal $a_servermodes;\n\t$backend_servers = \"\";\n\t$backend = get_backend($backendname);\n\tif ($backend){\n\t\t$servers = getarraybyref($backend, 'ha_servers', 'item');\n\t\tif (count($servers) == 0) {\n\t\t\t$backend_servers = sprintf(gettext(\"There are no servers in \\\"%s\\\" pool\"), $backendname);\n\t\t} else {\n\t\t\t$backend_servers = sprintf(gettext(\"Servers in \\\"%s\\\" pool:\"), $backendname);\n\t\t\tforeach($servers as $server){\n\t\t\t\t$srvstatus = $server['status'];\n\t\t\t\t$status = $a_servermodes[$srvstatus]['sign'];\n\t\t\t\tif (isset($server['forwardto']) && $server['forwardto'] != \"\") {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}[{$server['forwardto']}]\";\n\t\t\t\t} else {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}{$server['address']}:{$server['port']}\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn $backend_servers;\n}\n\n$pgtitle = array(\"Services\", \"HAProxy\", \"Frontend\");\ninclude(\"head.inc\");\nif ($input_errors) {\n\tprint_input_errors($input_errors);\n}\nif ($savemsg) {\n\tprint_info_box($savemsg);\n}\n\n$display_apply = file_exists($d_haproxyconfdirty_path) ? \"\" : \"none\";\necho \"<div id='showapplysettings' style='display: {$display_apply};'>\";\nprint_apply_box(sprintf(gettext(\"The haproxy configuration has been changed.%sYou must apply the changes in order for them to take effect.\"), \"<br/>\"));\necho \"</div>\";\n\nhaproxy_display_top_tabs_active($haproxy_tab_array['haproxy'], \"frontend\");\n\n?>\n<form action=\"haproxy_listeners.php\" method=\"post\">\n<script type=\"text/javascript\">\nfunction set_content(elementid, image) {\n\tvar item = document.getElementById(elementid);\n\titem.innerHTML = image;\n}\nfunction toggleFrontend(frontendname) {\n\t$.ajax({\n\t\turl: \"\",\n\t\tdata: {id: frontendname, action:\"toggle\"},\n\t\tsuccess: function(data){\n\t\t\tjs_callback(data);\n\t\t}\n\t})\n}\nfunction js_callback(req) {\n\tshowapplysettings.style.display = 'block';\n\n\tif(req !== '') {\n\t\tvar itemsplit = req.split(\"|\");\n\t\tbuttonid = itemsplit[0];\n\t\tenabled = itemsplit[1];\n\t\tif (enabled === \"1\"){\n\t\t\timg = \"<?=haproxyicon(\"enabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t} else {\n\t\t\timg = \"<?=haproxyicon(\"disabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t}\n\t\tset_content('btn_'+buttonid, img);\n\t}\n}\n</script>\n<?php\n\n\tfunction sort_sharedfrontends(&$a, &$b) {\n\t\t// make sure the 'primary frontend' is the first in the array, after that sort by name.\n\t\tif ($a['secondary'] != $b['secondary']) {\n\t\t\treturn $a['secondary'] > $b['secondary'] ? 1 : -1;\n\t\t}\n\t\tif ($a['name'] != $b['name']) {\n\t\t\treturn $a['name'] > $b['name'] ? 1 : -1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t$a_frontend_grouped = array();\n\tforeach($a_frontend as &$frontend2) {\n\t\tgetarraybyref($frontend2);// makes it a valid array in case the item was completely empty.\n\t\t$mainfrontend = get_primaryfrontend($frontend2);\n\t\t$mainname = $mainfrontend['name'];\n\t\t$ipport = get_frontend_ipport($frontend2, true);\n\t\t$frontend2['ipport'] = $ipport;\n\t\t$frontend2['type'] = $mainfrontend['type'];\n\t\t$a_frontend_grouped[$mainname][] = $frontend2;\n\t}\n?>\n\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h2 class=\"panel-title\">Frontends</h2>\n\t\t</div>\n\t\t<div id=\"mainarea\" class=\"table-responsive panel-body\">\n\t\t\t<table class=\"table table-hover table-striped table-condensed\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Primary</th>\n\t\t\t\t\t\t<th>Shared</th>\n\t\t\t\t\t\t<th>On</th>\n\t\t\t\t\t\t<th>Advanced</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t\t<th>Address</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Backend</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody class=\"user-entries\">\n<?php\n\t\t$textgray = \"\";\n\t\t$first = true;\n\t\t$last_frontend_shared = false;\n\t\t$i = 0;\n\t\tforeach ($a_frontend_grouped as $a_frontend) {\n\t\t\t//usort($a_frontend, 'sort_sharedfrontends');\n\t\t\tif ((count($a_frontend) > 1 || $last_frontend_shared) && !$first) {\n\t\t\t\t?> <tr class=\"<?=$textgray?>\"><td colspan=\"10\">&nbsp;</td></tr> <?\n\t\t\t}\n\t\t\t$first = false;\n\t\t\t$last_frontend_shared = count($a_frontend) > 1;\n\t\t\tforeach ($a_frontend as $frontend) {\n\t\t\t\t$frontendname = $frontend['name'];\n\t\t\t\t$disabled = $frontend['status'] != 'active';\n\t\t\t\t?>\n\t\t\t\t\t<tr id=\"fr<?=$frontendname;?>\" <?=$display?> onClick=\"fr_toggle('<?=$frontendname;?>')\" ondblclick=\"document.location='haproxy_listeners_edit.php?id=<?=$frontendname;?>';\" <?=($disabled ? ' class=\"disabled\"' : '')?>>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t<?if($frontend['secondary'] != 'yes'):?>\n\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t\t\t<?endif?>\n\t\t\t\t\t\t</td>\n\t\t\t\t  <td>\n\t\t\t\t  <?if($frontend['secondary'] == 'yes'):?>\n\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t  <?endif?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t\tif ($frontend['status']=='disabled'){\n\t\t\t\t\t\t\t$iconfn = \"disabled\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$iconfn = \"enabled\";\n\t\t\t\t\t\t}?>\n\t\t\t\t\t<a id=\"btn_<?=$frontendname;?>\" href='javascript:toggleFrontend(\"<?=$frontendname;?>\");'>\n\t\t\t\t\t\t<?=haproxyicon($iconfn, gettext(\"click to toggle enable/disable this frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$acls = get_frontend_acls($frontend);\n\t\t\t\t\t$isaclset = \"\";\n\t\t\t\t\tforeach ($acls as $acl) {\n\t\t\t\t\t\t$isaclset .= \"\\n\" . htmlspecialchars($acl['descr']);\n\t\t\t\t\t}\n\t\t\t\t\tif ($isaclset) {\n\t\t\t\t\t\techo haproxyicon(\"acl\", gettext(\"acl's used\") . \": {$isaclset}\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get_frontend_uses_ssl($frontend)) {\n\t\t\t\t\t\t$cert = lookup_cert($frontend['ssloffloadcert']);\n\t\t\t\t\t\t$descr = htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t$certs = getarraybyref($frontend, 'ha_certificates', 'item');\n\t\t\t\t\t\tif (count($certs) > 0){\n\t\t\t\t\t\t\tforeach($certs as $certitem){\n\t\t\t\t\t\t\t\t$cert = lookup_cert($certitem['ssl_certificate']);\n\t\t\t\t\t\t\t\t$descr .= \"\\n\".htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading cert: {$descr}\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$isadvset = \"\";\n\t\t\t\t\tif ($frontend['advanced_bind']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced bind: \".htmlspecialchars($frontend['advanced_bind']).\"\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($frontend['advanced']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced pass thru setting used\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($isadvset) {\n\t\t\t\t\t\techo haproxyicon(\"advanced\", gettext(\"Advanced settings set\") . \": {$isadvset}\");\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['name'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['desc'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t    <?php\n\t\t\t\t\t\t$first = true;\n\t\t\t\t\t\tforeach($frontend['ipport'] as $addr) {\n\t\t\t\t\t\t\t//if (!$first)\n\t\t\t\t\t\t\t//\tprint \"<br/>\";\n\t\t\t\t\t\t\tprint \"<div style='white-space:nowrap;'>\";\n\t\t\t\t\t\t\tprint \"{$addr['addr']}:{$addr['port']}\";\n\t\t\t\t\t\t\tif ($addr['ssl'] == 'yes') {\n\t\t\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprint \"</div>\";\n\t\t\t\t\t\t\t$first = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t  <?php\n\t\t\t\t\tif ($frontend['type'] == 'http') {\n\t\t\t\t\t\t$mainfrontend = get_primaryfrontend($frontend);\n\t\t\t\t\t\t$sslused = get_frontend_uses_ssl($mainfrontend);\n\t\t\t\t\t\t$httpused = !get_frontend_uses_ssl_only($frontend);\n\t\t\t\t\t\tif ($httpused) {\n\t\t\t\t\t\t\techo \"http\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($sslused) {\n\t\t\t\t\t\t\techo ($httpused ? \"/\" : \"\") . \"https\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\techo $a_frontendmode[$frontend['type']]['shortname'];\n\t\t\t\t\t}\n\t\t\t\t  ?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$a_actionitems = getarraybyref($frontend, 'a_actionitems', 'item');\n\t\t\t\t\tforeach ($a_actionitems as $actionitem) {\n\t\t\t\t\t\tif ($actionitem['action'] == \"use_backend\") {\n\t\t\t\t\t\t\t$backend = $actionitem['use_backendbackend'];\n\t\t\t\t\t\t\t$hint = haproxy_userlist_backend_servers($backend);\n\t\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a>\";\n\t\t\t\t\t\t\tif (!empty($actionitem['acl'])) {\n\t\t\t\t\t\t\t\techo \"&nbsp;if({$actionitem['acl']})\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$hint = haproxy_userlist_backend_servers($frontend['backend_serverpool']);\n\t\t\t\t\t$backend = $frontend['backend_serverpool'];\n\t\t\t\t\tif (!empty($backend)) {\n\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a> (default)\";\n\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td class=\"action-buttons\">\n\t\t\t\t\t<button style=\"display: none;\" class=\"btn btn-default btn-xs\" type=\"submit\" id=\"move_<?=$frontendname?>\" name=\"move_<?=$frontendname?>\" value=\"move_<?=$frontendname?>\"></button>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"edit\", gettext(\"edit frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners.php?act=del&amp;id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"delete\", gettext(\"delete frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?dup=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"clone\", gettext(\"clone frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t</tr><?php\n\t\t\t}\n\t\t}\n?>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<nav class=\"action-buttons\">\n\t\t<a href=\"haproxy_listeners_edit.php\" role=\"button\" class=\"btn btn-sm btn-success\" title=\"<?=gettext('Add frontend to the end of the list')?>\">\n\t\t\t<i class=\"fa fa-level-down icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Add\");?>\n\t\t</a>\n\t\t<button name=\"del_x\" type=\"submit\" class=\"btn btn-danger btn-sm no-confirm\" value=\"<?=gettext(\"Delete selected frontends\"); ?>\" title=\"<?=gettext('Delete selected frontends')?>\">\n\t\t\t<i class=\"fa fa-trash icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Delete\"); ?>\n\t\t</button>\n\t\t<button type=\"submit\" id=\"order-store\" name=\"order-store\" class=\"btn btn-sm btn-primary no-confirm\" value=\"store changes\" disabled title=\"<?=gettext('Save backend order')?>\">\n\t\t\t<i class=\"fa fa-save icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Save\")?>\n\t\t</button>\n\t</nav>\n</form>\n\n<script type=\"text/javascript\">\n//<![CDATA[\nevents.push(function() {\n\t$('[id^=Xmove_]').click(function (event) {\n\t\t$('[id=\"'+event.target.id.slice(1)+'\"]').click();\n\t\treturn false;\n\t});\n\t$('[id^=Xmove_]').css('cursor', 'pointer');\n\n\t// Check all of the rule checkboxes so that their values are posted\n\t$('#order-store').click(function () {\n\t   $('[id^=frc]').prop('checked', true);\n\t});\n});\n//]]>\n</script>\n<?php include(\"foot.inc\");\n"], "fixing_code": ["# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-haproxy-devel\nPORTVERSION=\t0.59\nPORTREVISION=\t17\nCATEGORIES=\tnet\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package haproxy-devel\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\thaproxy>0:net/haproxy\n\nCONFLICTS=\tpfSense-pkg-haproxy-[0-9]*\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/include\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/shortcuts\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/haproxy\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/haproxy.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socket.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_sync.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_gui.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socketinfo.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_xmlrpcsyncclient.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_htmllist.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_utils.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/pkg_haproxy_tabs.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_upgrade_config.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_global.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_files.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pools.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pool_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_stats.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_templates.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/include/widget-haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/include\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/widgets/haproxy.widget.php \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/www/shortcuts/pkg_haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/shortcuts\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/haproxy.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * haproxy_listeners.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2008 Remco Hoef <remcoverhoef@pfsense.com>\n * Copyright (c) 2009 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 PiBa-NL\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n$shortcut_section = \"haproxy\";\nrequire_once(\"guiconfig.inc\");\nrequire_once(\"certs.inc\");\nrequire_once(\"haproxy/haproxy.inc\");\nrequire_once(\"haproxy/haproxy_gui.inc\");\nrequire_once(\"haproxy/haproxy_utils.inc\");\nrequire_once(\"haproxy/pkg_haproxy_tabs.inc\");\n\n$changedesc = \"Services: HAProxy: Frontends\";\n\nhaproxy_config_init();\n\n$a_frontend = &getarraybyref($config, 'installedpackages', 'haproxy', 'ha_backends', 'item');\n\nfunction array_moveitemsbefore(&$items, $before, $selected) {\n\t// generic function to move array items before the set item by their numeric indexes.\n\n\t$a_new = array();\n\t/* copy all entries < $before and not selected */\n\tfor ($i = 0; $i < $before; $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy all selected entries */\n\tfor ($i = 0; $i < count($items); $i++) {\n\t\tif ($i == $before) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy $before entry */\n\tif ($before < count($items)) {\n\t\t$a_new[] = $items[$before];\n\t}\n\t/* copy all entries > $before and not selected */\n\tfor ($i = $before+1; $i < count($items); $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\tif (count($a_new) > 0) {\n\t\t$items = $a_new;\n\t}\n}\n\nif($_GET['action'] == \"toggle\") {\n\t$id = $_GET['id'];\n\techo \"$id|\";\n\tif (isset($a_frontend[get_frontend_id($id)])) {\n\t\t$frontent = &$a_frontend[get_frontend_id($id)];\n\t\tif ($frontent['status'] != \"disabled\"){\n\t\t\t$frontent['status'] = 'disabled';\n\t\t\techo \"0|\";\n\t\t}else{\n\t\t\t$frontent['status'] = 'active';\n\t\t\techo \"1|\";\n\t\t}\n\t\t$changedesc .= \" set frontend '$id' status to: {$frontent['status']}\";\n\n\t\ttouch($d_haproxyconfdirty_path);\n\t\twrite_config($changedesc);\n\t}\n\techo \"ok|\";\n\texit;\n}\n\nif ($_POST) {\n\t$pconfig = $_POST;\n\n\tif ($_POST['apply']) {\n\t\t$result = haproxy_check_and_run($savemsg, true);\n\t\tif ($result) {\n\t\t\tunlink_if_exists($d_haproxyconfdirty_path);\n\t\t}\n\t} elseif ($_POST['del_x']) {\n\t\t/* delete selected rules */\n\t\t$deleted = false;\n\t\tif (is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tforeach ($selected as $itemnr) {\n\t\t\t\tunset($a_frontend[$itemnr]);\n\t\t\t\t$deleted = true;\n\t\t\t}\n\t\t\tif ($deleted) {\n\t\t\t\tif (write_config(\"HAProxy, deleting frontend(s)\")) {\n\t\t\t\t\t//mark_subsystem_dirty('filter');\n\t\t\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\t\t}\n\t\t\t}\n\t\t\theader(\"Location: haproxy_listeners.php\");\n\t\t\texit;\n\t\t}\n\t} else {\n\n\t\t// from '\\src\\usr\\local\\www\\vpn_ipsec.php'\n\t\t/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */\n\t\t// TODO: this. is. nasty.\n\t\tunset($delbtn, $delbtnp2, $movebtn, $movebtnp2, $togglebtn, $togglebtnp2);\n\t\tforeach ($_POST as $pn => $pd) {\n\t\t\t// if name contains a dot its replaced in $POST key value by a underscore while $pd can be an array for some values..\n\t\t\tif (preg_match(\"/move_(.+)/\", $pn, $matches)) {\n\t\t\t\t$movebtn = substr($pd, 5);\n\t\t\t}\n\t\t}\n\t\t//\n\n\t\t/* move selected p1 entries before this */\n\t\tif (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$moveto = get_frontend_id($movebtn);\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tarray_moveitemsbefore($a_frontend, $moveto, $selected);\n\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\twrite_config($changedesc);\n\t\t}\n\t}\n} else {\n\t$result = haproxy_check_config($retval);\n\tif ($result) {\n\t\t$savemsg = gettext($result);\n\t}\n}\n\nif ($_GET['act'] == \"del\") {\n\t$id = $_GET['id'];\n\t$id = get_frontend_id($id);\n\tif (isset($a_frontend[$id])) {\n\t\tif (!$input_errors) {\n\t\t\tunset($a_frontend[$id]);\n\t\t\t$changedesc .= \" Frontend delete\";\n\t\t\twrite_config($changedesc);\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t}\n\t\theader(\"Location: haproxy_listeners.php\");\n\t\texit;\n\t}\n}\n\nfunction haproxy_userlist_backend_servers($backendname) {\n\t//used for hint title text when hovering mouse over a backend name\n\tglobal $a_servermodes;\n\t$backend_servers = \"\";\n\t$backend = get_backend($backendname);\n\tif ($backend){\n\t\t$servers = getarraybyref($backend, 'ha_servers', 'item');\n\t\tif (count($servers) == 0) {\n\t\t\t$backend_servers = sprintf(gettext(\"There are no servers in \\\"%s\\\" pool\"), $backendname);\n\t\t} else {\n\t\t\t$backend_servers = sprintf(gettext(\"Servers in \\\"%s\\\" pool:\"), $backendname);\n\t\t\tforeach($servers as $server){\n\t\t\t\t$srvstatus = $server['status'];\n\t\t\t\t$status = $a_servermodes[$srvstatus]['sign'];\n\t\t\t\tif (isset($server['forwardto']) && $server['forwardto'] != \"\") {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}[{$server['forwardto']}]\";\n\t\t\t\t} else {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}{$server['address']}:{$server['port']}\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn $backend_servers;\n}\n\n$pgtitle = array(\"Services\", \"HAProxy\", \"Frontend\");\ninclude(\"head.inc\");\nif ($input_errors) {\n\tprint_input_errors($input_errors);\n}\nif ($savemsg) {\n\tprint_info_box($savemsg);\n}\n\n$display_apply = file_exists($d_haproxyconfdirty_path) ? \"\" : \"none\";\necho \"<div id='showapplysettings' style='display: {$display_apply};'>\";\nprint_apply_box(sprintf(gettext(\"The haproxy configuration has been changed.%sYou must apply the changes in order for them to take effect.\"), \"<br/>\"));\necho \"</div>\";\n\nhaproxy_display_top_tabs_active($haproxy_tab_array['haproxy'], \"frontend\");\n\n?>\n<form action=\"haproxy_listeners.php\" method=\"post\">\n<script type=\"text/javascript\">\nfunction set_content(elementid, image) {\n\tvar item = document.getElementById(elementid);\n\titem.innerHTML = image;\n}\nfunction toggleFrontend(frontendname) {\n\t$.ajax({\n\t\turl: \"\",\n\t\tdata: {id: frontendname, action:\"toggle\"},\n\t\tsuccess: function(data){\n\t\t\tjs_callback(data);\n\t\t}\n\t})\n}\nfunction js_callback(req) {\n\tshowapplysettings.style.display = 'block';\n\n\tif(req !== '') {\n\t\tvar itemsplit = req.split(\"|\");\n\t\tbuttonid = itemsplit[0];\n\t\tenabled = itemsplit[1];\n\t\tif (enabled === \"1\"){\n\t\t\timg = \"<?=haproxyicon(\"enabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t} else {\n\t\t\timg = \"<?=haproxyicon(\"disabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t}\n\t\tset_content('btn_'+buttonid, img);\n\t}\n}\n</script>\n<?php\n\n\tfunction sort_sharedfrontends(&$a, &$b) {\n\t\t// make sure the 'primary frontend' is the first in the array, after that sort by name.\n\t\tif ($a['secondary'] != $b['secondary']) {\n\t\t\treturn $a['secondary'] > $b['secondary'] ? 1 : -1;\n\t\t}\n\t\tif ($a['name'] != $b['name']) {\n\t\t\treturn $a['name'] > $b['name'] ? 1 : -1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t$a_frontend_grouped = array();\n\tforeach($a_frontend as &$frontend2) {\n\t\tgetarraybyref($frontend2);// makes it a valid array in case the item was completely empty.\n\t\t$mainfrontend = get_primaryfrontend($frontend2);\n\t\t$mainname = $mainfrontend['name'];\n\t\t$ipport = get_frontend_ipport($frontend2, true);\n\t\t$frontend2['ipport'] = $ipport;\n\t\t$frontend2['type'] = $mainfrontend['type'];\n\t\t$a_frontend_grouped[$mainname][] = $frontend2;\n\t}\n?>\n\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h2 class=\"panel-title\">Frontends</h2>\n\t\t</div>\n\t\t<div id=\"mainarea\" class=\"table-responsive panel-body\">\n\t\t\t<table class=\"table table-hover table-striped table-condensed\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Primary</th>\n\t\t\t\t\t\t<th>Shared</th>\n\t\t\t\t\t\t<th>On</th>\n\t\t\t\t\t\t<th>Advanced</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t\t<th>Address</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Backend</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody class=\"user-entries\">\n<?php\n\t\t$textgray = \"\";\n\t\t$first = true;\n\t\t$last_frontend_shared = false;\n\t\t$i = 0;\n\t\tforeach ($a_frontend_grouped as $a_frontend) {\n\t\t\t//usort($a_frontend, 'sort_sharedfrontends');\n\t\t\tif ((count($a_frontend) > 1 || $last_frontend_shared) && !$first) {\n\t\t\t\t?> <tr class=\"<?=$textgray?>\"><td colspan=\"10\">&nbsp;</td></tr> <?\n\t\t\t}\n\t\t\t$first = false;\n\t\t\t$last_frontend_shared = count($a_frontend) > 1;\n\t\t\tforeach ($a_frontend as $frontend) {\n\t\t\t\t$frontendname = $frontend['name'];\n\t\t\t\t$disabled = $frontend['status'] != 'active';\n\t\t\t\t?>\n\t\t\t\t\t<tr id=\"fr<?=$frontendname;?>\" <?=$display?> onClick=\"fr_toggle('<?=$frontendname;?>')\" ondblclick=\"document.location='haproxy_listeners_edit.php?id=<?=$frontendname;?>';\" <?=($disabled ? ' class=\"disabled\"' : '')?>>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t<?if($frontend['secondary'] != 'yes'):?>\n\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t\t\t<?endif?>\n\t\t\t\t\t\t</td>\n\t\t\t\t  <td>\n\t\t\t\t  <?if($frontend['secondary'] == 'yes'):?>\n\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t  <?endif?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t\tif ($frontend['status']=='disabled'){\n\t\t\t\t\t\t\t$iconfn = \"disabled\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$iconfn = \"enabled\";\n\t\t\t\t\t\t}?>\n\t\t\t\t\t<a id=\"btn_<?=$frontendname;?>\" href='javascript:toggleFrontend(\"<?=$frontendname;?>\");'>\n\t\t\t\t\t\t<?=haproxyicon($iconfn, gettext(\"click to toggle enable/disable this frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$acls = get_frontend_acls($frontend);\n\t\t\t\t\t$isaclset = \"\";\n\t\t\t\t\tforeach ($acls as $acl) {\n\t\t\t\t\t\t$isaclset .= \"\\n\" . htmlspecialchars($acl['descr']);\n\t\t\t\t\t}\n\t\t\t\t\tif ($isaclset) {\n\t\t\t\t\t\techo haproxyicon(\"acl\", gettext(\"acl's used\") . \": {$isaclset}\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get_frontend_uses_ssl($frontend)) {\n\t\t\t\t\t\t$cert = lookup_cert($frontend['ssloffloadcert']);\n\t\t\t\t\t\t$descr = htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t$certs = getarraybyref($frontend, 'ha_certificates', 'item');\n\t\t\t\t\t\tif (count($certs) > 0){\n\t\t\t\t\t\t\tforeach($certs as $certitem){\n\t\t\t\t\t\t\t\t$cert = lookup_cert($certitem['ssl_certificate']);\n\t\t\t\t\t\t\t\t$descr .= \"\\n\".htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading cert: {$descr}\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$isadvset = \"\";\n\t\t\t\t\tif ($frontend['advanced_bind']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced bind: \".htmlspecialchars($frontend['advanced_bind']).\"\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($frontend['advanced']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced pass thru setting used\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($isadvset) {\n\t\t\t\t\t\techo haproxyicon(\"advanced\", gettext(\"Advanced settings set\") . \": {$isadvset}\");\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['name'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=htmlspecialchars($frontend['desc']);?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t    <?php\n\t\t\t\t\t\t$first = true;\n\t\t\t\t\t\tforeach($frontend['ipport'] as $addr) {\n\t\t\t\t\t\t\t//if (!$first)\n\t\t\t\t\t\t\t//\tprint \"<br/>\";\n\t\t\t\t\t\t\tprint \"<div style='white-space:nowrap;'>\";\n\t\t\t\t\t\t\tprint \"{$addr['addr']}:{$addr['port']}\";\n\t\t\t\t\t\t\tif ($addr['ssl'] == 'yes') {\n\t\t\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprint \"</div>\";\n\t\t\t\t\t\t\t$first = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t  <?php\n\t\t\t\t\tif ($frontend['type'] == 'http') {\n\t\t\t\t\t\t$mainfrontend = get_primaryfrontend($frontend);\n\t\t\t\t\t\t$sslused = get_frontend_uses_ssl($mainfrontend);\n\t\t\t\t\t\t$httpused = !get_frontend_uses_ssl_only($frontend);\n\t\t\t\t\t\tif ($httpused) {\n\t\t\t\t\t\t\techo \"http\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($sslused) {\n\t\t\t\t\t\t\techo ($httpused ? \"/\" : \"\") . \"https\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\techo $a_frontendmode[$frontend['type']]['shortname'];\n\t\t\t\t\t}\n\t\t\t\t  ?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$a_actionitems = getarraybyref($frontend, 'a_actionitems', 'item');\n\t\t\t\t\tforeach ($a_actionitems as $actionitem) {\n\t\t\t\t\t\tif ($actionitem['action'] == \"use_backend\") {\n\t\t\t\t\t\t\t$backend = $actionitem['use_backendbackend'];\n\t\t\t\t\t\t\t$hint = haproxy_userlist_backend_servers($backend);\n\t\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a>\";\n\t\t\t\t\t\t\tif (!empty($actionitem['acl'])) {\n\t\t\t\t\t\t\t\techo \"&nbsp;if(\" . htmlspecialchars($actionitem['acl']) . \")\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$hint = haproxy_userlist_backend_servers($frontend['backend_serverpool']);\n\t\t\t\t\t$backend = $frontend['backend_serverpool'];\n\t\t\t\t\tif (!empty($backend)) {\n\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a> (default)\";\n\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td class=\"action-buttons\">\n\t\t\t\t\t<button style=\"display: none;\" class=\"btn btn-default btn-xs\" type=\"submit\" id=\"move_<?=$frontendname?>\" name=\"move_<?=$frontendname?>\" value=\"move_<?=$frontendname?>\"></button>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"edit\", gettext(\"edit frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners.php?act=del&amp;id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"delete\", gettext(\"delete frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?dup=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"clone\", gettext(\"clone frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t</tr><?php\n\t\t\t}\n\t\t}\n?>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<nav class=\"action-buttons\">\n\t\t<a href=\"haproxy_listeners_edit.php\" role=\"button\" class=\"btn btn-sm btn-success\" title=\"<?=gettext('Add frontend to the end of the list')?>\">\n\t\t\t<i class=\"fa fa-level-down icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Add\");?>\n\t\t</a>\n\t\t<button name=\"del_x\" type=\"submit\" class=\"btn btn-danger btn-sm no-confirm\" value=\"<?=gettext(\"Delete selected frontends\"); ?>\" title=\"<?=gettext('Delete selected frontends')?>\">\n\t\t\t<i class=\"fa fa-trash icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Delete\"); ?>\n\t\t</button>\n\t\t<button type=\"submit\" id=\"order-store\" name=\"order-store\" class=\"btn btn-sm btn-primary no-confirm\" value=\"store changes\" disabled title=\"<?=gettext('Save backend order')?>\">\n\t\t\t<i class=\"fa fa-save icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Save\")?>\n\t\t</button>\n\t</nav>\n</form>\n\n<script type=\"text/javascript\">\n//<![CDATA[\nevents.push(function() {\n\t$('[id^=Xmove_]').click(function (event) {\n\t\t$('[id=\"'+event.target.id.slice(1)+'\"]').click();\n\t\treturn false;\n\t});\n\t$('[id^=Xmove_]').css('cursor', 'pointer');\n\n\t// Check all of the rule checkboxes so that their values are posted\n\t$('#order-store').click(function () {\n\t   $('[id^=frc]').prop('checked', true);\n\t});\n});\n//]]>\n</script>\n<?php include(\"foot.inc\");\n", "# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-haproxy\nPORTVERSION=\t0.59\nPORTREVISION=\t16\nCATEGORIES=\tnet\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package haproxy\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\thaproxy17>0:net/haproxy17\n\nCONFLICTS=\tpfSense-pkg-haproxy-devel-[0-9]*\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/include\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/shortcuts\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www/haproxy\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/haproxy.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socket.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_sync.sh \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_gui.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_socketinfo.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_xmlrpcsyncclient.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_htmllist.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_utils.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/pkg_haproxy_tabs.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/haproxy/haproxy_upgrade_config.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_listeners_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_global.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_files.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pools.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_pool_edit.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_stats.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/haproxy/haproxy_templates.php \\\n\t\t${STAGEDIR}${PREFIX}/www/haproxy\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/include/widget-haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/include\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/widgets/widgets/haproxy.widget.php \\\n\t\t${STAGEDIR}${PREFIX}/www/widgets/widgets\n\t${INSTALL_DATA} -m 0755 ${FILESDIR}${PREFIX}/www/shortcuts/pkg_haproxy.inc \\\n\t\t${STAGEDIR}${PREFIX}/www/shortcuts\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/haproxy.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * haproxy_listeners.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2008 Remco Hoef <remcoverhoef@pfsense.com>\n * Copyright (c) 2009 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 PiBa-NL\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n$shortcut_section = \"haproxy\";\nrequire_once(\"guiconfig.inc\");\nrequire_once(\"certs.inc\");\nrequire_once(\"haproxy/haproxy.inc\");\nrequire_once(\"haproxy/haproxy_gui.inc\");\nrequire_once(\"haproxy/haproxy_utils.inc\");\nrequire_once(\"haproxy/pkg_haproxy_tabs.inc\");\n\n$changedesc = \"Services: HAProxy: Frontends\";\n\nhaproxy_config_init();\n\n$a_frontend = &getarraybyref($config, 'installedpackages', 'haproxy', 'ha_backends', 'item');\n\nfunction array_moveitemsbefore(&$items, $before, $selected) {\n\t// generic function to move array items before the set item by their numeric indexes.\n\n\t$a_new = array();\n\t/* copy all entries < $before and not selected */\n\tfor ($i = 0; $i < $before; $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy all selected entries */\n\tfor ($i = 0; $i < count($items); $i++) {\n\t\tif ($i == $before) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\t/* copy $before entry */\n\tif ($before < count($items)) {\n\t\t$a_new[] = $items[$before];\n\t}\n\t/* copy all entries > $before and not selected */\n\tfor ($i = $before+1; $i < count($items); $i++) {\n\t\tif (!in_array($i, $selected)) {\n\t\t\t$a_new[] = $items[$i];\n\t\t}\n\t}\n\tif (count($a_new) > 0) {\n\t\t$items = $a_new;\n\t}\n}\n\nif($_GET['action'] == \"toggle\") {\n\t$id = $_GET['id'];\n\techo \"$id|\";\n\tif (isset($a_frontend[get_frontend_id($id)])) {\n\t\t$frontent = &$a_frontend[get_frontend_id($id)];\n\t\tif ($frontent['status'] != \"disabled\"){\n\t\t\t$frontent['status'] = 'disabled';\n\t\t\techo \"0|\";\n\t\t}else{\n\t\t\t$frontent['status'] = 'active';\n\t\t\techo \"1|\";\n\t\t}\n\t\t$changedesc .= \" set frontend '$id' status to: {$frontent['status']}\";\n\n\t\ttouch($d_haproxyconfdirty_path);\n\t\twrite_config($changedesc);\n\t}\n\techo \"ok|\";\n\texit;\n}\n\nif ($_POST) {\n\t$pconfig = $_POST;\n\n\tif ($_POST['apply']) {\n\t\t$result = haproxy_check_and_run($savemsg, true);\n\t\tif ($result) {\n\t\t\tunlink_if_exists($d_haproxyconfdirty_path);\n\t\t}\n\t} elseif ($_POST['del_x']) {\n\t\t/* delete selected rules */\n\t\t$deleted = false;\n\t\tif (is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tforeach ($selected as $itemnr) {\n\t\t\t\tunset($a_frontend[$itemnr]);\n\t\t\t\t$deleted = true;\n\t\t\t}\n\t\t\tif ($deleted) {\n\t\t\t\tif (write_config(\"HAProxy, deleting frontend(s)\")) {\n\t\t\t\t\t//mark_subsystem_dirty('filter');\n\t\t\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\t\t}\n\t\t\t}\n\t\t\theader(\"Location: haproxy_listeners.php\");\n\t\t\texit;\n\t\t}\n\t} else {\n\n\t\t// from '\\src\\usr\\local\\www\\vpn_ipsec.php'\n\t\t/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */\n\t\t// TODO: this. is. nasty.\n\t\tunset($delbtn, $delbtnp2, $movebtn, $movebtnp2, $togglebtn, $togglebtnp2);\n\t\tforeach ($_POST as $pn => $pd) {\n\t\t\t// if name contains a dot its replaced in $POST key value by a underscore while $pd can be an array for some values..\n\t\t\tif (preg_match(\"/move_(.+)/\", $pn, $matches)) {\n\t\t\t\t$movebtn = substr($pd, 5);\n\t\t\t}\n\t\t}\n\t\t//\n\n\t\t/* move selected p1 entries before this */\n\t\tif (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {\n\t\t\t$moveto = get_frontend_id($movebtn);\n\t\t\t$selected = array();\n\t\t\tforeach($_POST['rule'] as $selection) {\n\t\t\t\t$selected[] = get_frontend_id($selection);\n\t\t\t}\n\t\t\tarray_moveitemsbefore($a_frontend, $moveto, $selected);\n\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t\twrite_config($changedesc);\n\t\t}\n\t}\n} else {\n\t$result = haproxy_check_config($retval);\n\tif ($result) {\n\t\t$savemsg = gettext($result);\n\t}\n}\n\nif ($_GET['act'] == \"del\") {\n\t$id = $_GET['id'];\n\t$id = get_frontend_id($id);\n\tif (isset($a_frontend[$id])) {\n\t\tif (!$input_errors) {\n\t\t\tunset($a_frontend[$id]);\n\t\t\t$changedesc .= \" Frontend delete\";\n\t\t\twrite_config($changedesc);\n\t\t\ttouch($d_haproxyconfdirty_path);\n\t\t}\n\t\theader(\"Location: haproxy_listeners.php\");\n\t\texit;\n\t}\n}\n\nfunction haproxy_userlist_backend_servers($backendname) {\n\t//used for hint title text when hovering mouse over a backend name\n\tglobal $a_servermodes;\n\t$backend_servers = \"\";\n\t$backend = get_backend($backendname);\n\tif ($backend){\n\t\t$servers = getarraybyref($backend, 'ha_servers', 'item');\n\t\tif (count($servers) == 0) {\n\t\t\t$backend_servers = sprintf(gettext(\"There are no servers in \\\"%s\\\" pool\"), $backendname);\n\t\t} else {\n\t\t\t$backend_servers = sprintf(gettext(\"Servers in \\\"%s\\\" pool:\"), $backendname);\n\t\t\tforeach($servers as $server){\n\t\t\t\t$srvstatus = $server['status'];\n\t\t\t\t$status = $a_servermodes[$srvstatus]['sign'];\n\t\t\t\tif (isset($server['forwardto']) && $server['forwardto'] != \"\") {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}[{$server['forwardto']}]\";\n\t\t\t\t} else {\n\t\t\t\t\t$backend_servers .= \"\\n{$status}{$server['address']}:{$server['port']}\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn $backend_servers;\n}\n\n$pgtitle = array(\"Services\", \"HAProxy\", \"Frontend\");\ninclude(\"head.inc\");\nif ($input_errors) {\n\tprint_input_errors($input_errors);\n}\nif ($savemsg) {\n\tprint_info_box($savemsg);\n}\n\n$display_apply = file_exists($d_haproxyconfdirty_path) ? \"\" : \"none\";\necho \"<div id='showapplysettings' style='display: {$display_apply};'>\";\nprint_apply_box(sprintf(gettext(\"The haproxy configuration has been changed.%sYou must apply the changes in order for them to take effect.\"), \"<br/>\"));\necho \"</div>\";\n\nhaproxy_display_top_tabs_active($haproxy_tab_array['haproxy'], \"frontend\");\n\n?>\n<form action=\"haproxy_listeners.php\" method=\"post\">\n<script type=\"text/javascript\">\nfunction set_content(elementid, image) {\n\tvar item = document.getElementById(elementid);\n\titem.innerHTML = image;\n}\nfunction toggleFrontend(frontendname) {\n\t$.ajax({\n\t\turl: \"\",\n\t\tdata: {id: frontendname, action:\"toggle\"},\n\t\tsuccess: function(data){\n\t\t\tjs_callback(data);\n\t\t}\n\t})\n}\nfunction js_callback(req) {\n\tshowapplysettings.style.display = 'block';\n\n\tif(req !== '') {\n\t\tvar itemsplit = req.split(\"|\");\n\t\tbuttonid = itemsplit[0];\n\t\tenabled = itemsplit[1];\n\t\tif (enabled === \"1\"){\n\t\t\timg = \"<?=haproxyicon(\"enabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t} else {\n\t\t\timg = \"<?=haproxyicon(\"disabled\", gettext(\"click to toggle enable/disable this frontend\"))?>\";\n\t\t}\n\t\tset_content('btn_'+buttonid, img);\n\t}\n}\n</script>\n<?php\n\n\tfunction sort_sharedfrontends(&$a, &$b) {\n\t\t// make sure the 'primary frontend' is the first in the array, after that sort by name.\n\t\tif ($a['secondary'] != $b['secondary']) {\n\t\t\treturn $a['secondary'] > $b['secondary'] ? 1 : -1;\n\t\t}\n\t\tif ($a['name'] != $b['name']) {\n\t\t\treturn $a['name'] > $b['name'] ? 1 : -1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t$a_frontend_grouped = array();\n\tforeach($a_frontend as &$frontend2) {\n\t\tgetarraybyref($frontend2);// makes it a valid array in case the item was completely empty.\n\t\t$mainfrontend = get_primaryfrontend($frontend2);\n\t\t$mainname = $mainfrontend['name'];\n\t\t$ipport = get_frontend_ipport($frontend2, true);\n\t\t$frontend2['ipport'] = $ipport;\n\t\t$frontend2['type'] = $mainfrontend['type'];\n\t\t$a_frontend_grouped[$mainname][] = $frontend2;\n\t}\n?>\n\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h2 class=\"panel-title\">Frontends</h2>\n\t\t</div>\n\t\t<div id=\"mainarea\" class=\"table-responsive panel-body\">\n\t\t\t<table class=\"table table-hover table-striped table-condensed\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Primary</th>\n\t\t\t\t\t\t<th>Shared</th>\n\t\t\t\t\t\t<th>On</th>\n\t\t\t\t\t\t<th>Advanced</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t\t<th>Address</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Backend</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody class=\"user-entries\">\n<?php\n\t\t$textgray = \"\";\n\t\t$first = true;\n\t\t$last_frontend_shared = false;\n\t\t$i = 0;\n\t\tforeach ($a_frontend_grouped as $a_frontend) {\n\t\t\t//usort($a_frontend, 'sort_sharedfrontends');\n\t\t\tif ((count($a_frontend) > 1 || $last_frontend_shared) && !$first) {\n\t\t\t\t?> <tr class=\"<?=$textgray?>\"><td colspan=\"10\">&nbsp;</td></tr> <?\n\t\t\t}\n\t\t\t$first = false;\n\t\t\t$last_frontend_shared = count($a_frontend) > 1;\n\t\t\tforeach ($a_frontend as $frontend) {\n\t\t\t\t$frontendname = $frontend['name'];\n\t\t\t\t$disabled = $frontend['status'] != 'active';\n\t\t\t\t?>\n\t\t\t\t\t<tr id=\"fr<?=$frontendname;?>\" <?=$display?> onClick=\"fr_toggle('<?=$frontendname;?>')\" ondblclick=\"document.location='haproxy_listeners_edit.php?id=<?=$frontendname;?>';\" <?=($disabled ? ' class=\"disabled\"' : '')?>>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t<?if($frontend['secondary'] != 'yes'):?>\n\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t\t\t<?endif?>\n\t\t\t\t\t\t</td>\n\t\t\t\t  <td>\n\t\t\t\t  <?if($frontend['secondary'] == 'yes'):?>\n\t\t\t\t\t<input type=\"checkbox\" id=\"frc<?=$frontendname;?>\" onClick=\"fr_toggle('<?=$frontendname;?>')\" name=\"rule[]\" value=\"<?=$frontendname;?>\"/>\n\t\t\t\t\t<a class=\"fa fa-anchor\" id=\"Xmove_<?=$frontendname?>\" title=\"<?=gettext(\"Move checked entries to here\")?>\"></a>\n\t\t\t\t  <?endif?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t\tif ($frontend['status']=='disabled'){\n\t\t\t\t\t\t\t$iconfn = \"disabled\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$iconfn = \"enabled\";\n\t\t\t\t\t\t}?>\n\t\t\t\t\t<a id=\"btn_<?=$frontendname;?>\" href='javascript:toggleFrontend(\"<?=$frontendname;?>\");'>\n\t\t\t\t\t\t<?=haproxyicon($iconfn, gettext(\"click to toggle enable/disable this frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$acls = get_frontend_acls($frontend);\n\t\t\t\t\t$isaclset = \"\";\n\t\t\t\t\tforeach ($acls as $acl) {\n\t\t\t\t\t\t$isaclset .= \"\\n\" . htmlspecialchars($acl['descr']);\n\t\t\t\t\t}\n\t\t\t\t\tif ($isaclset) {\n\t\t\t\t\t\techo haproxyicon(\"acl\", gettext(\"acl's used\") . \": {$isaclset}\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get_frontend_uses_ssl($frontend)) {\n\t\t\t\t\t\t$cert = lookup_cert($frontend['ssloffloadcert']);\n\t\t\t\t\t\t$descr = htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t$certs = getarraybyref($frontend, 'ha_certificates', 'item');\n\t\t\t\t\t\tif (count($certs) > 0){\n\t\t\t\t\t\t\tforeach($certs as $certitem){\n\t\t\t\t\t\t\t\t$cert = lookup_cert($certitem['ssl_certificate']);\n\t\t\t\t\t\t\t\t$descr .= \"\\n\".htmlspecialchars($cert['descr']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading cert: {$descr}\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$isadvset = \"\";\n\t\t\t\t\tif ($frontend['advanced_bind']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced bind: \".htmlspecialchars($frontend['advanced_bind']).\"\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($frontend['advanced']) {\n\t\t\t\t\t\t$isadvset .= \"Advanced pass thru setting used\\r\\n\";\n\t\t\t\t\t}\n\t\t\t\t\tif ($isadvset) {\n\t\t\t\t\t\techo haproxyicon(\"advanced\", gettext(\"Advanced settings set\") . \": {$isadvset}\");\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=$frontend['name'];?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?=htmlspecialchars($frontend['desc']);?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t    <?php\n\t\t\t\t\t\t$first = true;\n\t\t\t\t\t\tforeach($frontend['ipport'] as $addr) {\n\t\t\t\t\t\t\t//if (!$first)\n\t\t\t\t\t\t\t//\tprint \"<br/>\";\n\t\t\t\t\t\t\tprint \"<div style='white-space:nowrap;'>\";\n\t\t\t\t\t\t\tprint \"{$addr['addr']}:{$addr['port']}\";\n\t\t\t\t\t\t\tif ($addr['ssl'] == 'yes') {\n\t\t\t\t\t\t\t\techo haproxyicon(\"cert\", \"SSL offloading\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprint \"</div>\";\n\t\t\t\t\t\t\t$first = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t  <?php\n\t\t\t\t\tif ($frontend['type'] == 'http') {\n\t\t\t\t\t\t$mainfrontend = get_primaryfrontend($frontend);\n\t\t\t\t\t\t$sslused = get_frontend_uses_ssl($mainfrontend);\n\t\t\t\t\t\t$httpused = !get_frontend_uses_ssl_only($frontend);\n\t\t\t\t\t\tif ($httpused) {\n\t\t\t\t\t\t\techo \"http\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($sslused) {\n\t\t\t\t\t\t\techo ($httpused ? \"/\" : \"\") . \"https\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\techo $a_frontendmode[$frontend['type']]['shortname'];\n\t\t\t\t\t}\n\t\t\t\t  ?>\n\t\t\t\t  </td>\n\t\t\t\t  <td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$a_actionitems = getarraybyref($frontend, 'a_actionitems', 'item');\n\t\t\t\t\tforeach ($a_actionitems as $actionitem) {\n\t\t\t\t\t\tif ($actionitem['action'] == \"use_backend\") {\n\t\t\t\t\t\t\t$backend = $actionitem['use_backendbackend'];\n\t\t\t\t\t\t\t$hint = haproxy_userlist_backend_servers($backend);\n\t\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a>\";\n\t\t\t\t\t\t\tif (!empty($actionitem['acl'])) {\n\t\t\t\t\t\t\t\techo \"&nbsp;if(\" . htmlspecialchars($actionitem['acl']) . \")\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$hint = haproxy_userlist_backend_servers($frontend['backend_serverpool']);\n\t\t\t\t\t$backend = $frontend['backend_serverpool'];\n\t\t\t\t\tif (!empty($backend)) {\n\t\t\t\t\t\techo \"<div title='{$hint}'>\";\n\t\t\t\t\t\techo \"<a href='haproxy_pool_edit.php?id={$backend}'>{$backend}</a> (default)\";\n\t\t\t\t\t\techo \"<br/></div>\";\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t  </td>\n\t\t\t\t  <td class=\"action-buttons\">\n\t\t\t\t\t<button style=\"display: none;\" class=\"btn btn-default btn-xs\" type=\"submit\" id=\"move_<?=$frontendname?>\" name=\"move_<?=$frontendname?>\" value=\"move_<?=$frontendname?>\"></button>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"edit\", gettext(\"edit frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners.php?act=del&amp;id=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"delete\", gettext(\"delete frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href=\"haproxy_listeners_edit.php?dup=<?=$frontendname;?>\">\n\t\t\t\t\t\t<?=haproxyicon(\"clone\", gettext(\"clone frontend\"))?>\n\t\t\t\t\t</a>\n\t\t\t\t  </td>\n\t\t\t\t</tr><?php\n\t\t\t}\n\t\t}\n?>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<nav class=\"action-buttons\">\n\t\t<a href=\"haproxy_listeners_edit.php\" role=\"button\" class=\"btn btn-sm btn-success\" title=\"<?=gettext('Add frontend to the end of the list')?>\">\n\t\t\t<i class=\"fa fa-level-down icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Add\");?>\n\t\t</a>\n\t\t<button name=\"del_x\" type=\"submit\" class=\"btn btn-danger btn-sm no-confirm\" value=\"<?=gettext(\"Delete selected frontends\"); ?>\" title=\"<?=gettext('Delete selected frontends')?>\">\n\t\t\t<i class=\"fa fa-trash icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Delete\"); ?>\n\t\t</button>\n\t\t<button type=\"submit\" id=\"order-store\" name=\"order-store\" class=\"btn btn-sm btn-primary no-confirm\" value=\"store changes\" disabled title=\"<?=gettext('Save backend order')?>\">\n\t\t\t<i class=\"fa fa-save icon-embed-btn\"></i>\n\t\t\t<?=gettext(\"Save\")?>\n\t\t</button>\n\t</nav>\n</form>\n\n<script type=\"text/javascript\">\n//<![CDATA[\nevents.push(function() {\n\t$('[id^=Xmove_]').click(function (event) {\n\t\t$('[id=\"'+event.target.id.slice(1)+'\"]').click();\n\t\treturn false;\n\t});\n\t$('[id^=Xmove_]').css('cursor', 'pointer');\n\n\t// Check all of the rule checkboxes so that their values are posted\n\t$('#order-store').click(function () {\n\t   $('[id^=frc]').prop('checked', true);\n\t});\n});\n//]]>\n</script>\n<?php include(\"foot.inc\");\n"], "filenames": ["net/pfSense-pkg-haproxy-devel/Makefile", "net/pfSense-pkg-haproxy-devel/files/usr/local/www/haproxy/haproxy_listeners.php", "net/pfSense-pkg-haproxy/Makefile", "net/pfSense-pkg-haproxy/files/usr/local/www/haproxy/haproxy_listeners.php"], "buggy_code_start_loc": [5, 370, 5, 370], "buggy_code_end_loc": [6, 416, 6, 416], "fixing_code_start_loc": [5, 370, 5, 370], "fixing_code_end_loc": [6, 416, 6, 416], "type": "CWE-79", "message": "The HAProxy package before 0.59_16 for pfSense has XSS via the desc (aka Description) or table_actionsaclN parameter, related to haproxy_listeners.php and haproxy_listeners_edit.php.", "other": {"cve": {"id": "CVE-2019-8953", "sourceIdentifier": "cve@mitre.org", "published": "2019-02-20T16:29:00.900", "lastModified": "2019-03-14T15:52:39.183", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The HAProxy package before 0.59_16 for pfSense has XSS via the desc (aka Description) or table_actionsaclN parameter, related to haproxy_listeners.php and haproxy_listeners_edit.php."}, {"lang": "es", "value": "El paquete HAProxy, en versiones anteriores a la 0.59_16 para pfSense, tiene Cross-Site Scripting (XSS) mediante los par\u00e1metros desc (tambi\u00e9n conocido como Description) o table_actionsaclN, relacionados con haproxy_listeners.php y haproxy_listeners_edit.php."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:netgate:haproxy:*:*:*:*:*:pfsense:*:*", "versionEndExcluding": "0.59_16", "matchCriteriaId": "6B8D18DB-A7B7-424E-9FDC-3848C9D71E7B"}]}]}], "references": [{"url": "https://cxsecurity.com/issue/WLB-2019020153", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/pfsense/FreeBSD-ports/commit/2dded47b3202dfdf89aa96f84bf701b3d5acbe6c", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/pfsense/FreeBSD-ports/commit/3b40366aca55910b224ecf49d3fdacc9ad6c04f5", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://redmine.pfsense.org/issues/9335", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://www.exploit-db.com/exploits/46538/", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/pfsense/FreeBSD-ports/commit/2dded47b3202dfdf89aa96f84bf701b3d5acbe6c"}}