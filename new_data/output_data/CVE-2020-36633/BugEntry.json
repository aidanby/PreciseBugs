{"buggy_code": ["<?php\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    block_sitenews\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v4 or later\n * @author     Jan Eberhardt <eberhardt@math.tu-berlin.de>\n */\n\nrequire_once(__DIR__ . \"/locallib.php\");\nrequire_once($CFG->dirroot . \"/mod/forum/lib.php\");\n\nclass block_sitenews extends block_base {\n\n    public $items;\n\n    /**\n     * Initialization\n     */\n    public function init() {\n        $this->title = get_string(\"pluginname\", \"block_sitenews\");\n    }\n\n    /**\n     * In the next section restrit user's ability to modify this block\n     */\n    public function instance_allow_config() {\n        return true;\n    }\n\n    public function instance_allow_multiple() {\n        return false;\n    }\n\n    public function applicable_formats() {\n        return array(\"site-index\" => true, \"my-index\" => true);\n    }\n\n    /**\n     * Show content\n     *\n     * @see block_base::get_content()\n     */\n    public function get_content() {\n        global $SITE;\n\n        if (! $newsforum = forum_get_course_forum($SITE->id, \"news\")) {\n            print_error(\"cannotfindorcreateforum\", \"forum\");\n        }\n        $newsforumcm = get_coursemodule_from_instance('forum', $newsforum->id, $SITE->id, false, MUST_EXIST);\n\n        $updatemynumber = optional_param(\"mynewsitems\", -1, PARAM_INT);\n        $displaysetting = block_sitenews_get_itemsnumber();\n        if ($updatemynumber >= 0 && $updatemynumber < 11) {\n            block_sitenews_update_itemsnumber($updatemynumber);\n            $displaysetting = $items = $updatemynumber;\n        }\n        else {\n            $items = $displaysetting;\n        }\n\n        if ($items == 0) {\n            // Setting is \"preset\".\n            $items = $SITE->newsitems;\n        }\n\n        $this->content = new stdClass();\n        $this->content->text = \"\";\n        $this->content->footer = \"\";\n\n        $renderer = $this->page->get_renderer(\"block_sitenews\");\n\n        if ($this->page->user_is_editing()) {\n            $this->content->text .= $renderer->editing_bar_head($displaysetting);\n        }\n\n        if ($items > 0 && forum_get_discussions_count($newsforumcm)) {\n            // Admin disabled news or just nothing to display.\n            $this->content->text .= $renderer->sitenews($newsforum, $items);\n        }\n\n        return $this->content;\n    }\n\n}\n\n", "<?php\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    block_sitenews\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v4 or later\n * @author     Jan Eberhardt <eberhardt@math.tu-berlin.de>\n */\n\nrequire_once($CFG->dirroot.'/blocks/sitenews/locallib.php');\n\nclass block_sitenews_renderer extends plugin_renderer_base {\n\n    /**\n     * Prints the site news\n     *\n     * @param array $sitenews\n     * @return string\n     */\n    public function sitenews(stdClass $newsforum, $items) {\n        global $SITE;\n\n        $output = html_writer::start_div(\"\", array(\"id\" => \"block-site-news\")); // start div for styling\n\n        ob_start();\n        forum_print_latest_discussions($SITE, $newsforum, $items, 'plain', 'p.modified DESC');\n        $output .= ob_get_contents(); // there is no option for returning it as string... so grep the output via ob\n        ob_end_clean();\n\n        $output .= html_writer::end_div();\n\n        return $output;\n    }\n\n    /**\n     * Prints the editing header\n     *\n     * @param number $items Number of news items to display\n     * @return string\n     */\n    public function editing_bar_head($selected = 0) {\n        $output = $this->output->box_start(\"notice\");\n\n        $url = new moodle_url(\"/my/index.php\");\n        $options = range(0,10);\n        $options[0] = get_string(\"preset\", \"block_sitenews\");\n        $select = new single_select($url, \"mynewsitems\", $options, $selected, array());\n        $select->set_label(get_string(\"newsitemsnumber\") . \":\");\n        $output .= $this->output->render($select);\n\n        $output .= $this->output->box_end();\n        return $output;\n    }\n}"], "fixing_code": ["<?php\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    block_sitenews\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v4 or later\n * @author     Jan Eberhardt <eberhardt@math.tu-berlin.de>\n */\n\nrequire_once(__DIR__ . \"/locallib.php\");\nrequire_once($CFG->dirroot . \"/mod/forum/lib.php\");\n\nclass block_sitenews extends block_base {\n\n    public $items;\n\n    /**\n     * Initialization\n     */\n    public function init() {\n        $this->title = get_string(\"pluginname\", \"block_sitenews\");\n    }\n\n    /**\n     * In the next section restrit user's ability to modify this block\n     */\n    public function instance_allow_config() {\n        return true;\n    }\n\n    public function instance_allow_multiple() {\n        return false;\n    }\n\n    public function applicable_formats() {\n        return array(\"site-index\" => true, \"my-index\" => true);\n    }\n\n    /**\n     * Show content\n     *\n     * @see block_base::get_content()\n     */\n    public function get_content() {\n        global $SITE;\n\n        if (! $newsforum = forum_get_course_forum($SITE->id, \"news\")) {\n            print_error(\"cannotfindorcreateforum\", \"forum\");\n        }\n        $newsforumcm = get_coursemodule_from_instance('forum', $newsforum->id, $SITE->id, false, MUST_EXIST);\n\n        $updatemynumber = optional_param(\"mynewsitems\", -1, PARAM_INT);\n        $displaysetting = block_sitenews_get_itemsnumber();\n        if ($updatemynumber >= 0 && $updatemynumber < 11 && confirm_sesskey()) {\n            block_sitenews_update_itemsnumber($updatemynumber);\n            $displaysetting = $items = $updatemynumber;\n        }\n        else {\n            $items = $displaysetting;\n        }\n\n        if ($items == 0) {\n            // Setting is \"preset\".\n            $items = $SITE->newsitems;\n        }\n\n        $this->content = new stdClass();\n        $this->content->text = \"\";\n        $this->content->footer = \"\";\n\n        $renderer = $this->page->get_renderer(\"block_sitenews\");\n\n        if ($this->page->user_is_editing()) {\n            $this->content->text .= $renderer->editing_bar_head($displaysetting);\n        }\n\n        if ($items > 0 && forum_get_discussions_count($newsforumcm)) {\n            // Admin disabled news or just nothing to display.\n            $this->content->text .= $renderer->sitenews($newsforum, $items);\n        }\n\n        return $this->content;\n    }\n\n}\n\n", "<?php\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    block_sitenews\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v4 or later\n * @author     Jan Eberhardt <eberhardt@math.tu-berlin.de>\n */\n\nrequire_once($CFG->dirroot.'/blocks/sitenews/locallib.php');\n\nclass block_sitenews_renderer extends plugin_renderer_base {\n\n    /**\n     * Prints the site news\n     *\n     * @param array $sitenews\n     * @return string\n     */\n    public function sitenews(stdClass $newsforum, $items) {\n        global $SITE;\n\n        $output = html_writer::start_div(\"\", array(\"id\" => \"block-site-news\")); // start div for styling\n\n        ob_start();\n        forum_print_latest_discussions($SITE, $newsforum, $items, 'plain', 'p.modified DESC');\n        $output .= ob_get_contents(); // there is no option for returning it as string... so grep the output via ob\n        ob_end_clean();\n\n        $output .= html_writer::end_div();\n\n        return $output;\n    }\n\n    /**\n     * Prints the editing header\n     *\n     * @param number $items Number of news items to display\n     * @return string\n     */\n    public function editing_bar_head($selected = 0) {\n        $output = $this->output->box_start(\"notice\");\n\n        $url = new moodle_url(\"/my/index.php\");\n        $options = range(0,10);\n        $options[0] = get_string(\"preset\", \"block_sitenews\");\n        $select = new single_select($url, \"mynewsitems\", $options, $selected, array());\n        $select->method = 'post';\n        $select->set_label(get_string(\"newsitemsnumber\") . \":\");\n        $output .= $this->output->render($select);\n\n        $output .= $this->output->box_end();\n        return $output;\n    }\n}"], "filenames": ["block_sitenews.php", "renderer.php"], "buggy_code_start_loc": [67, 60], "buggy_code_end_loc": [68, 60], "fixing_code_start_loc": [67, 61], "fixing_code_end_loc": [68, 62], "type": "CWE-352", "message": "A vulnerability was found in moodle-block_sitenews 1.0. It has been classified as problematic. This affects the function get_content of the file block_sitenews.php. The manipulation leads to cross-site request forgery. It is possible to initiate the attack remotely. Upgrading to version 1.1 is able to address this issue. The name of the patch is cd18d8b1afe464ae6626832496f4e070bac4c58f. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-216879.", "other": {"cve": {"id": "CVE-2020-36633", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-27T13:15:10.907", "lastModified": "2023-01-06T06:04:10.067", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in moodle-block_sitenews 1.0. It has been classified as problematic. This affects the function get_content of the file block_sitenews.php. The manipulation leads to cross-site request forgery. It is possible to initiate the attack remotely. Upgrading to version 1.1 is able to address this issue. The name of the patch is cd18d8b1afe464ae6626832496f4e070bac4c58f. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-216879."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:moodle-block_sitenews_project:moodle-block_sitenews:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.1", "matchCriteriaId": "41E1659E-A707-4BF2-8603-0D1F2CF50B8F"}]}]}], "references": [{"url": "https://github.com/eberhardt/moodle-block_sitenews/commit/cd18d8b1afe464ae6626832496f4e070bac4c58f", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/eberhardt/moodle-block_sitenews/pull/5", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/eberhardt/moodle-block_sitenews/releases/tag/v1.1", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.216879", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216879", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/eberhardt/moodle-block_sitenews/commit/cd18d8b1afe464ae6626832496f4e070bac4c58f"}}