{"buggy_code": ["=== Post video players, slideshow albums, photo galleries and music / podcast playlist ===\r\nContributors: nicashmu\r\nTags: cincopa, responsive, photos, html5, flash, flv, slideshow, images, amazon, gallery, media, cooliris, admin, post, WPtouch, photo-albums, pictures, plugin, widget, photo, picture, video hosting, s3, music, playlists, playlist, sidebar, ajax, video, vidavee, iphone, cms, ipod, smooth gallery, nextgen, javascript, embed, menus, analytics, media library, itunes, mu, podpress, lightbox, podpress, flowplayer, jw player, comments, twitter, page, google, links, image\r\nRequires at least: 2.0.2\r\nTested up to: 4.2.2\r\n\r\nPost your videos, photo galleries/flash slideshows, music and playlists easily and in seconds.\r\n\r\n== Description ==\r\n\r\nNo need for multiple plugins for your WordPress media. Cincopa is **The only plugin you need for all your media needs**. Use Cincopa to easily add videos, photo galleries, slideshows, music and playlists and much more. Enjoy more than 40 designed skins for slideshows, video players, Cooliris, Lightbox and many more.\r\n\r\n* **HASSLE-FREE** WordPress media support for your site, include **Videos**, **Slideshows**, **Image Galleries**, **Audio playlists and podcasts**. \r\n\r\n* **Responsive design and HTML5** to ensure compatibility with mobile phones, tablets as well as desktops. Your audience is mobile more than ever, our technology will make sure that they can access your content anywhere and any time.\r\n\r\n* **Fully Managed** to ensure high speed, scalability, security and reliability of your media. [Read more](//www.cincopa.com/media-platform/services/what-is-a-cdn)\r\n\r\n* **Expert WordPress Support** - full [technical support](//help.cincopa.com/home), many [tutorials](//help.cincopa.com/categories/9559-media-platform-guides-tutorials) and [video tutorials](//help.cincopa.com/forums/376513-video-tutorials) to get you started.\r\n\r\n\r\nRead more about [Cincopa WordPress Media Plugin](//www.cincopa.com/media-platform/wordpress-plugin.aspx)\r\n\r\n\r\n[youtube https://www.youtube.com/watch?v=rgdK2sHpxnA]\r\n\r\n\r\n= Features =\r\n\r\n* **[more than 100 skins](//www.cincopa.com/media-platform/skins)** - slideshows, video players, playlists, flash, full-screen, Cooliris, lightbox, wedding skins and many more\r\n* Many customization options: size, colors, text and more\r\n* Simple media management directly from your WordPress dashboard\r\n* Automatic **resizing of photos**\r\n* **Automatic uploading and hosting**\r\n* Automatic **video transcoding** to flv/3gp/mp4\r\n* Supported file types - avi, mov, wmv, mp4, m4a, f4a, f4b, f4v, f4p, m2ts, mts, DVD vob, mkv, rmvb, m1v, qt, div, divx, dv, 3gp, 3gpp, 3g2, mpg, mpeg, mpe, flv, wav, wma\r\n* Complete analytics of your traffic\r\n* Support iPhone, iPad, Android, blackberry automatically and other smart and mobile phones\r\n* Hosting and delivering your media on Amazon S3 Web Services ensure scalability and reliability.\r\n* Video hosting, video serving, video streaming and pseudo streaming (progressive download) solutions\r\n* Many types of players to choose from including JW, flowplay, Cooliris and others\r\n* Support playlist with customizable side, bottom and top list using CSS\r\n* Add caption and description to any item\r\n* Integrates with your CDN solution\r\n* Management tool to allow your users/designers/web master to upload videos\r\n* Embed code button directly into article\r\n* Progressive Download (Pseudo streaming - httpd)\r\n* HD widescreen flv and H.264, ideal for videoblog and photoblog\r\n* Preview image in 4 sizes (for first frame of video).\r\n* Full Screen feature.\r\n* Domain lock feature to protect your video\r\n* Support HTTPS (SSL) sites\r\n* Download source feature\r\n* On screen Logo for branding\r\n* Google analytics Tracking Enabled\r\n* Support other CMS systems and public web sites\r\n* Post to your blog from anywhere and even if your videos are at home on your PC\r\n* The plugin is FREE, we do offer a [pro account](//www.cincopa.com/cincopamanager/paypal/plans.aspx) with even more options.\r\n\r\n\r\nThousands of site are already using Cincopa, [Start now for free](//downloads.wordpress.org/plugin/video-playlist-and-gallery-plugin.zip) and add media to your WordPress site in seconds.\r\n\r\n\r\nGet more information about [Cincopa WordPress Media Plugin](//www.cincopa.com/media-platform/wordpress-plugin.aspx) and see some examples.\r\n\r\nFor comments, questions and support use this email [support@cincopa.com](mailto:support@cincopa.com)\r\n\r\n<h4>Buddypress and wpmu</h4>\r\nIdeal multimedia solution for BuddyPress and mu because each user gets his own private storage space with zero cost to site owner. \r\n\r\n\r\n== Installation ==\r\n\r\n<ol>\r\n<li>Click download (on the right) to download the zip package</li>\r\n<li>Unzip the downloaded package and upload the <code><span style=\"font-family: Consolas\">post-rich-videos-and-photos-galleries</span></code> folder into the <code><span style=\"font-family: Consolas\">wp-content/plugins/</span></code> directory</li>\r\n\r\n<li>Log into your WordPress admin panel</li>\r\n<li>Activate the plugin (named 'WordPress Cincopa Plugin') through the &#8216;Plugins&#8217; menu in WordPress (if you are upgrading from an earlier version, make sure to de-activate and re-activate the plugin so that all options are updated)</li>\r\n<li>Go to your post/page and click on the C icon.</li>\r\n</ol>\r\n\r\n== Frequently Asked Questions ==\r\n\r\n= What about non-WordPress sites/blogs ? =\r\n\r\nYou can also embed your gallery in other sites/blogs using a HTML code. To create your gallery start here http://www.cincopa.com/media-platform/start.aspx and follow the instructions.\r\n\r\n= How much storage do I need to post videos and photos ? =\r\n\r\nNone, You don't need any space on your server, your files will be stored on Cincopa server.\r\n\r\n= How many photos and videos I can post ? =\r\n\r\nA lot, really.\r\n\r\n= What is a style/skin ? =\r\n\r\nAfter you select photos and videos for your post you need to select the style of how to display them, there are a lot of styles available, some good for playing many videos, some good for slideshows, some for music playlists etc.\r\n\r\n= How do I post my photos/videos ? =\r\n\r\nIn the post page, just click on the C icon and follow the instructions.\r\n\r\n= Do I need to upload my videos/photos to the server before starting ? =\r\n\r\nNo. Cincopa agent will do it for you after you've completed the post or you can batch upload it.\r\n\r\n= Do I need to register with Cincopa ? =\r\n\r\nYes. After clicking the C icon in the post page follow the instructions to register with Cincopa.\r\n\r\n= Why can't I use my server ? =\r\n\r\nIf you are using one of those low cost shared hosting solution then you better let Cincopa do the media hosting for you. Your hosting is perfect for hosting your site but they are not optimized to serve your videos, photos or music. Combining your hosting solution with Cincopa will render a professional site.\r\n\r\n\r\n== Screenshots ==\r\n\r\n1. Audio mobile\r\n2. Audio playlist\r\n3. Image gallery\r\n4. Image list pinterest\r\n5. Image list preview\r\n6. Ligthbox\r\n7. Start page\r\n8. Video gallery\r\n9. Video playlist", "<?php\r\n/*\r\nPlugin Name: Post video players, slideshow albums, photo galleries and music / podcast playlist\r\nPlugin URI: http://www.cincopa.com/media-platform/wordpress-plugin.aspx\r\nDescription: Post rich videos and photos galleries from your cincopa account\r\nAuthor: Cincopa \r\nVersion: 1.136\r\n*/\r\n\r\nfunction _cpmp_plugin_ver()\r\n{\r\n\treturn 'wp1.136';\r\n}\r\n\r\nfunction _cpmp_afc()\r\n{\r\n\t$cincopa_afc = get_site_option('CincopaAFC');\r\n\t\r\n\tif ($cincopa_afc == '')\r\n\t\treturn '';\r\n\t\r\n\treturn '&afc='.$cincopa_afc;\r\n}\r\n\r\nfunction _cpmp_url()\r\n{\r\n\treturn '//www.cincopa.com';\r\n}\r\n\r\nif (strpos($_SERVER['REQUEST_URI'], 'media-upload.php') && strpos($_SERVER['REQUEST_URI'], '&type=cincopa') && !strpos($_SERVER['REQUEST_URI'], '&wrt='))\r\n{\r\n\theader('Location: '._cpmp_url().'/media-platform/start.aspx?ver='._cpmp_plugin_ver()._cpmp_afc().'&rdt='.urlencode(_cpmp_selfURL()));\r\n\texit;\r\n}\r\n\r\nfunction _cpmp_selfURL()\r\n{\r\n\t$s = empty ( $_SERVER [\"HTTPS\"] ) ? '' : ($_SERVER [\"HTTPS\"] == \"on\") ? \"s\" : \"\";\r\n\r\n\t$protocol =  strtolower ( $_SERVER [\"SERVER_PROTOCOL\"] );\r\n\t$protocol =  substr($protocol, 0, strpos($protocol, \"/\"));\r\n\t$protocol .= $s;\r\n\r\n\t$port = ($_SERVER [\"SERVER_PORT\"] == \"80\") ? \"\" : (\":\" . $_SERVER [\"SERVER_PORT\"]);\r\n\t$ret = $protocol . \"://\" . $_SERVER ['SERVER_NAME'] . $port . $_SERVER ['REQUEST_URI'];\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_pluginURI()\r\n{\r\n\t$s = empty ( $_SERVER [\"HTTPS\"] ) ? '' : ($_SERVER [\"HTTPS\"] == \"on\") ? \"s\" : \"\";\r\n\r\n\t$protocol =  strtolower ( $_SERVER [\"SERVER_PROTOCOL\"] );\r\n\t$protocol =  substr($protocol, 0, strpos($protocol, \"/\"));\r\n\t$protocol .= $s;\r\n\r\n\t$url = site_url( '', $protocol );\r\n\t//echo 'url = ' . $url;\r\n\treturn $url . '/wp-content/plugins/'.dirname(plugin_basename(__FILE__));\r\n\t//return get_option('siteurl').'/wp-content/plugins/'.dirname(plugin_basename(__FILE__));\r\n}\r\n\r\nfunction _cpmp_WpMediaCincopa_init() // constructor\r\n{\r\n\tadd_action('media_buttons', '_cpmp_addMediaButton', 20);\r\n\r\n\tadd_action('media_upload_cincopa', '_cpmp_media_upload');\r\n\t// No longer needed in WP 2.6\r\n\tif ( !function_exists('wp_enqueue_style') )\r\n\t{\r\n\t\tadd_action('admin_head_media_upload_type_cincopa', 'media_admin_css');\r\n\t}\r\n      \r\n\t// check auth enabled\r\n\t//if(!function_exists('curl_init') && !ini_get('allow_url_fopen')) {}\r\n}\r\n\r\nfunction _cpmp_media_menu($tabs) {\r\n    $newtab = array('cincopabox' => __('Insert Media from Cincopa', 'cincopa'));\r\n    return array_merge($tabs, $newtab);\r\n}\r\nadd_filter('media_upload_tabs', '_cpmp_media_menu');\r\n\r\n\r\nfunction media_cincopabox_process() {\r\n    if(isset($_REQUEST['wrt'])){\r\n        _cpmp_media_upload_type_cincopa();\r\n        return;\r\n    }\r\n    if (sizeof($_POST)>0){\r\n        var_dump($_POST);\r\n        \r\n    }\r\n    media_upload_header();\r\n    ?>\r\n    <iframe src=\"<?php echo _cpmp_url().'/media-platform/start.aspx?ver='._cpmp_plugin_ver()._cpmp_afc().'&rdt='.urlencode(_cpmp_selfURL().\"&\")?>&\" width=\"100%\" height=\"98%\"></iframe>\r\n    <?php\r\n}\r\nfunction cincopabox_menu_handle() {\r\n    \r\n    return wp_iframe( 'media_cincopabox_process');\r\n}\r\n\r\nadd_action('media_upload_cincopabox', 'cincopabox_menu_handle');\r\n\r\n\r\nfunction _cpmp_addMediaButton($admin = true)\r\n{\r\n\tglobal $post_ID, $temp_ID;\r\n\t$uploading_iframe_ID = (int) (0 == $post_ID ? $temp_ID : $post_ID);\r\n\r\n\t$media_upload_iframe_src = get_option('siteurl').\"/wp-admin/media-upload.php?post_id=$uploading_iframe_ID\";\r\n\r\n\t$media_cincopa_iframe_src = apply_filters('media_cincopa_iframe_src', \"$media_upload_iframe_src&amp;type=cincopa&amp;tab=cincopa\");\r\n\t$media_cincopa_title = __('Add Cincopa Media', 'wp-media-cincopa');\r\n\t?>\r\n\t<div id=\"cincopa_button\">\r\n\t\t<a onClick=\"javascript:cincopa_launch_popup();\" class=\"insert-media \" data-editor=\"content\" title=\"Add Media\">\r\n\t\t\t<div class=\"first\" onClick=\"javascript:cincopa_launch_popup();\">\r\n\t\t\t\t<img src=\"<?php echo _cpmp_pluginURI(); ?>/media-cincopa.gif\" alt=\"<?php echo $media_cincopa_title; ?>\" />\r\n\t\t\t</div>\r\n\t\t</a>\r\n\t\t<div class=\"last cincopa-show-gallery\" id=\"cincopa_show_button\"<?php if (is_rtl()) echo ' style=\"border-right:1px solid #bbb;\"'; ?>></div>\r\n\t</div>\r\n\t<div class=\"cincopa-gallery-block\"><img src=\"<?php echo _cpmp_pluginURI(); ?>/loading.gif\"></div>\r\n\t<?php\r\n}\r\n\r\nfunction _cpmp_modifyMediaTab($tabs)\r\n{\r\n\treturn array(\r\n\t\t'cincopa' =>  __('Cincopa photo', 'wp-media-cincopa'),\r\n\t);\r\n}\r\n\r\nfunction _cpmp_media_upload()\r\n{\r\n\twp_iframe('_cpmp_media_upload_type_cincopa');\r\n}\r\n\r\n\r\nfunction _cpmp_media_upload_type_cincopa()\r\n{\r\n\tglobal $wpdb, $wp_query, $wp_locale, $type, $tab, $post_mime_types;\r\n\tadd_filter('media_upload_tabs', '_cpmp_modifyMediaTab');\r\n?>\r\n\r\n<br />\r\n<br />\r\n<h2>&nbsp;&nbsp;Please Wait...</h2>\r\n\r\n<script>\r\n\r\n\tfunction _cpmp_cincopa_stub()\r\n\t{\r\n\t\tvar i = location.href.indexOf(\"&wrt=\");\r\n\r\n\t\tif (i > -1)\r\n\t\t{\r\n\t\t\ttop.send_to_editor(unescape(location.href.substring(i+5)));\r\n\t\t}\r\n\r\n\t\ttop.tb_remove();\r\n\t}\r\n\r\n\twindow.onload = _cpmp_cincopa_stub;\r\n\r\n</script>\r\n\r\n<?php\r\n}\r\n\r\n_cpmp_WpMediaCincopa_init();\r\n\r\n\r\n// this new regex should resolve the problem of having unicode chars in the tag\r\ndefine(\"CINCOPA_REGEXP\", \"/\\[cincopa([^\\]]*)\\]/\");\r\n\r\n\r\nfunction _cpmp_cincopa_tag($fid)\r\n{\r\n\treturn _cpmp_plugin_callback(array($fid));\r\n}\r\n\r\nfunction _cpmp_plugin_callback($match)\r\n{\r\n\t$uni = uniqid('');\r\n\t\r\n\t// don't remove it. used for open graph generation\r\n\t$ret = sprintf( '<!-- %s -->', $match[0] );\r\n\t\r\n\t$ret .= '\r\n<!-- Cincopa WordPress plugin '._cpmp_plugin_ver().': //www.cincopa.com/media-platform/wordpress-plugin.aspx -->\r\n<div id=\"cp_widget_'.$uni.'\"><img src=\"//www.cincopa.com/media-platform/runtime/loading.gif\" style=\"border:0;\" alt=\"Cincopa WordPress plugin\" /></div>\r\n<script src=\"//www.cincopa.com/media-platform/runtime/libasync.js\" type=\"text/javascript\"></script>\r\n<script type=\"text/javascript\">\r\n/* PLEASE CHANGE DEFAULT EXCERPT HANDLING TO CLEAN OR FULL (go to your Wordpress Dashboard/Settings/Cincopa Options ... */\r\ncp_load_widget(\"'.urlencode($match[0]).'\", \"cp_widget_'.$uni.'\");\r\n</script>\r\n';\r\n\r\n\t$ret .= '<noscript>Powered by Cincopa Video Hosting.<br>';\r\n\t$ret .= '</noscript>';\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_async_plugin_callback($match)\r\n{\r\n\t$uni = uniqid('');\r\n\r\n\t$ret = '\r\n<!-- Cincopa WordPress plugin '._cpmp_plugin_ver().' (async engine): //www.cincopa.com/media-platform/wordpress-plugin.aspx -->\r\n\r\n<div id=\"cp_widget_'.$uni.'\"><img src=\"//www.cincopa.com/media-platform/runtime/loading.gif\" style=\"border:0;\" alt=\"Cincopa WordPress plugin\" /></div>\r\n\r\n<script type=\"text/javascript\">\r\n/* PLEASE CHANGE DEFAULT EXCERPT HANDLING TO CLEAN OR FULL (go to your Wordpress Dashboard/Settings/Cincopa Options ... */\r\n\r\nvar cpo = [];\r\ncpo[\"_object\"] =\"cp_widget_'.$uni.'\";\r\ncpo[\"_fid\"] = \"'.urlencode($match[0]).'\";\r\n\r\nvar _cpmp = _cpmp || [];\r\n_cpmp.push(cpo);\r\n\r\n(function() {\r\n\tvar cp = document.createElement(\"script\"); cp.type = \"text/javascript\";\r\n\tcp.async = true; cp.src = \"//www.cincopa.com/media-platform/runtime/libasync.js\";\r\n\tvar c = document.getElementsByTagName(\"script\")[0];\r\n\tc.parentNode.insertBefore(cp, c);\r\n})();\r\n\r\n</script>\r\n\r\n';\r\n\r\n\t$ret .= '<noscript>Powered by Cincopa Video Hosting.<br>';\r\n\t$ret .= '</noscript>';\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_feed_plugin_callback($match)\r\n{\r\n\t$ret = '<img style=\"border:0;\" src=\"//www.cincopa.com/media-platform/api/thumb.aspx?fid='.urlencode($match[1]).'&size=large\" />';\r\n\r\n\treturn $ret;\r\n}\r\n\r\n$opengraph_meta = array();\r\n\r\nfunction _cpmp_plugin($content) {\r\n\tglobal $opengraph_meta;\r\n\t\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'tcapc=true'))\r\n\t\t$cincopa_async = 'async';\r\n\telse if (strpos($_SERVER['REQUEST_URI'], 'tcapc=false'))\r\n\t\t$cincopa_async = 'plain';\r\n\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'cpdisable=true'))\r\n\t\treturn $content;\r\n\r\n\t$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\n\tif ($cincopa_excerpt_rt == 'remove' && (is_search() || is_category() || is_archive() || is_home()))\r\n\t\treturn preg_replace(CINCOPA_REGEXP, '', $content);\r\n\telse if ( is_feed() ) {\r\n\t\tif ($cincopa_rss == 'full') {\r\n\t\t\tif ($cincopa_async == 'async') {\r\n\t\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\t\t\t} else {\r\n\t\t\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_feed_plugin_callback', $content));\r\n\t\t}\r\n\t}\r\n\telse if ($cincopa_async == 'async')\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\telse {\r\n\t\t// add cincopa did into array for open graph generation\r\n\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t}\r\n}\r\n\r\nfunction _cpmp_plugin_rss($content)\r\n{\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'tcapc=true'))\r\n\t\t$cincopa_async = 'async';\r\n\telse if (strpos($_SERVER['REQUEST_URI'], 'tcapc=false'))\r\n\t\t$cincopa_async = 'plain';\r\n\t\r\n\tif ($cincopa_rss == 'full') {\r\n\t\tif ($cincopa_async == 'async') {\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\t\t} else {\r\n\t\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t\t}\r\n\t} else {\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_feed_plugin_callback', $content));\r\n\t}\r\n}\r\n\r\n//add_shortcode('cincopa', 'cincopa_plugin_shortcode');\r\nadd_filter('the_content', '_cpmp_plugin');\r\nadd_filter('the_content_rss', '_cpmp_plugin_rss');\r\nadd_filter('the_excerpt_rss', '_cpmp_plugin_rss');\r\nadd_filter('comment_text', '_cpmp_plugin'); \r\n\r\nadd_action ( 'bp_get_activity_content_body', '_cpmp_plugin' );\r\nadd_action ( 'bp_get_the_topic_post_content', '_cpmp_plugin' );\r\n\r\nadd_action('wp_dashboard_setup', '_cpmp_dashboard'); \r\n\r\n// Hook for adding admin menus\r\n// http://codex.wordpress.org/Adding_Administration_Menus\r\nadd_action('admin_menu', '_cpmp_mt_add_pages');\r\n\r\n// register CincopaWidget widget\r\nadd_action('widgets_init', create_function('', 'return register_widget(\"CincopaWidget\");'));\r\n\r\nwp_oembed_add_provider( '//www.cincopa.com/*', '//www.cincopa.com/media-platform/oembed.aspx' );\r\n\r\nif (get_site_option('cincopa_welcome_notice') != _cpmp_plugin_ver())\r\n\tadd_action( 'admin_notices', '_cpmp_activation_notice' );\r\n\r\n$open_graph_mode = get_site_option('CincopaOpenGraph');\r\nif ( $open_graph_mode == 1 ) {\r\n\tadd_action('wp_head', '_cpmp_buffer_start');\r\n\tadd_action('wp_footer', '_cpmp_buffer_end');\r\n\t\t\r\n\tadd_action('wp_head', '_cpmp_opengraph_meta_tags');\r\n\tadd_filter('language_attributes', '_cpmp_opengraph_add_prefix');\r\n}\r\n\r\nfunction _cpmp_buffer_start() { ob_start(\"_cpmp_content_callback\"); }\r\nfunction _cpmp_buffer_end() { ob_end_flush(); }\r\nfunction _cpmp_content_callback($buffer) {\r\n\t\r\n\t$meta_list = _cpmp_get_opengraph_meta_list();\r\n\t\r\n\tif ( ! empty($meta_list) ) {\r\n\t\t// modify buffer here, and then return the updated code\r\n\t\t$buffer = str_replace(_cpmp_opengraph_placeholder(), $meta_list, $buffer );\r\n\t}\r\n\t\r\n\treturn $buffer;\r\n}\r\n\r\nfunction _cpmp_get_opengraph_meta_list() {\r\n\tglobal $opengraph_meta;\r\n\r\n\t$opengraph_list = '';\r\n\tforeach ($opengraph_meta as $key => $item)\r\n\t\t$opengraph_list .= $item;\r\n\t\t\r\n\treturn $opengraph_list; \t\r\n}\r\n/**\r\n * Add Open Graph XML prefix to <html> element.\r\n *\r\n * @uses apply_filters calls 'opengraph_prefixes' filter on RDFa prefix array\r\n */\r\nfunction _cpmp_opengraph_add_prefix( $output ) {\r\n  $prefixes = array(\r\n    'og' => '//ogp.me/ns#'\r\n  );\r\n  $prefixes = apply_filters('_cpmp_opengraph_prefixes', $prefixes);\r\n\r\n  $prefix_str = '';\r\n  foreach( $prefixes as $k => $v ) {\r\n    $prefix_str .= $k . ': ' . $v . ' ';\r\n  }\r\n  $prefix_str = trim($prefix_str);\r\n \t\r\n  if (preg_match('/(prefix\\s*=\\s*[\\\"|\\'])/i', $output)) {\r\n    $output = preg_replace('/(prefix\\s*=\\s*[\\\"|\\'])/i', '${1}' . $prefix_str, $output);\r\n  } else {\r\n    $output .= ' prefix=\"' . $prefix_str . '\"';\r\n  }\r\n  return $output;\r\n}\r\n\r\nfunction _cpmp_opengraph_meta_tags_callback( $match ) {\r\n\tglobal $opengraph_meta;\r\n\r\n\tif ( empty($match[1]) ) \r\n\t\treturn '';\r\n\t\r\n\t$opengraph_meta_item = \r\n\t\t'<meta property=\"og:image\" content=\"//www.cincopa.com/media-platform/api/thumb_open.aspx?fid=' . urlencode(trim($match[1])) . '&size=large\">' . \"\\n\" .\r\n\t\t'<meta name=\"twitter:image\" content=\"//www.cincopa.com/media-platform/api/thumb_open.aspx?fid=' . urlencode(trim($match[1])) . '&size=large\">' . \"\\n\";\r\n\r\n\t$opengraph_meta[trim($match[1])] = $opengraph_meta_item;\r\n\t\r\n\treturn $opengraph_meta_item;\r\n}\r\nfunction _cpmp_opengraph_placeholder() {\r\n\treturn '<!-- [CincopaOpenGraph] -->';\r\n}\r\nfunction _cpmp_opengraph_meta_tags() {\r\n\r\n\tif ( ! is_singular() ) {\r\n\t\techo _cpmp_opengraph_placeholder();\r\n\t\treturn;\r\n\t}\r\n\t\t\r\n\t$post = get_queried_object();\r\n\t$content = $post->post_content;\r\n\t$meta = preg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\r\n\techo _cpmp_get_opengraph_meta_list();\r\n}\r\n\t\r\n/////////////////////////////////\r\n// #AB# dropdown menu functions\r\n/////////////////////////////////\r\n\r\n// register js and style on initialization\r\nadd_action('init', '_cpmp_register_script');\r\nfunction _cpmp_register_script() {\r\n\t\r\n\tif ( is_admin() ) {\r\n\t\t// add styles for dropdown \r\n\t\twp_register_style( 'cincopa-style', plugins_url('css.cincopa.css', __FILE__), false, '20130425.4', 'all' );\r\n\t\t// add js for dropdown \r\n\t\twp_register_script( 'cincopa-script', plugins_url('js.cincopa.js', __FILE__), array(), '20130425.4' );\r\n\t\t\r\n\t\twp_enqueue_script( 'cincopa-script' );\r\n\t\twp_enqueue_style( 'cincopa-style' );\r\n\t\t\r\n\t}\r\n}\r\n\r\n/////////////////////////////////\r\n// dashboard widget\r\n//////////////////////////////////\r\nfunction _cpmp_dashboard()\r\n{\r\n\tif(function_exists('wp_add_dashboard_widget'))\r\n\t\twp_add_dashboard_widget('cincopa', 'Cincopa', '_cpmp_dashboard_content');\r\n}\r\n\r\nfunction _cpmp_dashboard_content()\r\n{\r\n\r\n        \r\n\techo \"<iframe src='//www.cincopa.com/media-platform/wordpress-dashboard-content.aspx?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='100%' height='370px' scrolling='no'></iframe>\";\r\n\r\n}\r\n\r\n\r\n\r\n/*function changeUrl()\r\n{\r\n    $pageURL = $_SERVER['QUERY_STRING'];\r\n    \r\n    if( $pageURL == 'page=sub-page4' )\r\n    {\r\n        //header ('location: http://help.cincopa.com/home'); //in same tab\r\n    }\r\n}\r\nadd_action( 'admin_menu', 'changeUrl' );*/\r\n\r\n// action function for above hook\r\nfunction _cpmp_mt_add_pages()\r\n{\r\n\r\n\t// Add a new submenu under Options:\r\n\t\r\n\tadd_options_page('Cincopa Options', 'Cincopa Options', 'edit_pages', 'cincopaoptions', '_cpmp_mt_options_page');\r\n\r\n\r\n\tif(function_exists('add_menu_page'))\r\n\t{\r\n\t\t// Add a new top-level menu (ill-advised):\r\n\t\tadd_menu_page('Cincopa', 'Cincopa', 'edit_pages', __FILE__, '_cpmp_mt_toplevel_page');\r\n\r\n\t\t// kill the first menu item that is usually the the identical to the menu itself\r\n\t\tadd_submenu_page(__FILE__, '', '', 'edit_pages', __FILE__);\r\n\r\n\t\tadd_submenu_page(__FILE__, 'Manage Galleries', 'Manage Galleries', 'edit_pages', 'sub-page', '_cpmp_mt_sublevel_monitor');\r\n\r\n\t\tadd_submenu_page(__FILE__, 'Media Library', 'Media Library', 'edit_pages', 'sub-page1', '_cpmp_mt_sublevel_library');\r\n\r\n\t\tadd_submenu_page(__FILE__, 'Create Gallery', 'Create Gallery', 'edit_pages', 'sub-page2', '_cpmp_mt_sublevel_create');\r\n\r\n\t\tadd_submenu_page(__FILE__, 'My Account', 'My Account', 'edit_pages', 'sub-page3', '_cpmp_mt_sublevel_myaccount');\r\n\r\n\t\tadd_submenu_page(__FILE__, 'Support Forum', 'Support Forum', 'edit_pages', 'sub-page4', '_cpmp_mt_sublevel_forum');\r\n\t}\r\n}\r\n\r\nfunction _cpmp_isAdmin()\r\n{\r\n\treturn !function_exists('is_site_admin') || is_site_admin() == true;\r\n}\r\n\r\nfunction _cpmp_mt_options_page()\r\n{\r\n\r\n\r\n\tif (strpos($_SERVER['QUERY_STRING'], 'hide_note=welcome_notice'))\r\n\t{\r\n\t\tupdate_site_option('cincopa_welcome_notice', _cpmp_plugin_ver());\r\n\t\techo \"<script type=\\\"text/javascript\\\">\tdocument.location.href = '\".$_SERVER['HTTP_REFERER'].\"'; </script>\";\r\n\t\texit;\r\n\t}\r\n\r\n\t$cincopa_afc = get_site_option('CincopaAFC');\r\n\t$cincopa_excerpt = get_site_option('CincopaExcerpt');\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\t$cincopa_opengraph = get_site_option('CincopaOpenGraph');\r\n\tif ( $cincopa_opengraph === false ) {\r\n\t\t// enabled by default\r\n\t\tupdate_site_option('CincopaOpenGraph', 1);\r\n\t\t$cincopa_opengraph = 1;\t\r\n\t}\r\n\t\r\n\tif ( isset($_POST['submit']) )\r\n\t{\r\n\t\tif (_cpmp_isAdmin())\r\n\t\t{\r\n\t\t\tif (isset($_POST['cincopaafc']))\r\n\t\t\t{\r\n\t\t\t\t$cincopa_afc = $_POST['cincopaafc'];\r\n\t\t\t\tupdate_site_option('CincopaAFC', $cincopa_afc);\r\n\t\t\t}\r\n\r\n\t\t\tif (isset($_POST['asyncRel']))\r\n\t\t\t{\r\n\t\t\t\t$cincopa_async = $_POST['asyncRel'];\r\n\t\t\t\tupdate_site_option('CincopaAsync', $cincopa_async);\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif (isset($_POST['rssRel']))\r\n\t\t\t{\r\n\t\t\t\t$cincopa_rss = $_POST['rssRel'];\r\n\t\t\t\tupdate_site_option('CincopaRss', $cincopa_rss);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isset($_POST['embedRel']))\r\n\t\t{\r\n\t\t\t$cincopa_excerpt = $_POST['embedRel'];\r\n\t\t\tupdate_site_option('cincopaexcerpt', $cincopa_excerpt);\t\t\t\r\n\t\t}\r\n\t\tif (isset($_POST['open_graph']) && $_POST['open_graph'] == 1)\r\n\t\t{\r\n\t\t\t$cincopa_opengraph = 1;\r\n\t\t\tupdate_site_option('CincopaOpenGraph', 1);\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tupdate_site_option('CincopaOpenGraph', 0);\r\n\t\t\t$cincopa_opengraph = 0;\r\n\t\t}\r\n\t\t\r\n\t\techo \"<div id=\\\"updatemessage\\\" class=\\\"updated fade\\\"><p>Cincopa settings updated.</p></div>\\n\";\r\n\t\techo \"<script type=\\\"text/javascript\\\">setTimeout(function(){jQuery('#updatemessage').hide('slow');}, 3000);</script>\";\t\r\n\t}\r\n\r\n\t$tpl_checked = 'checked=\"checked\"';\r\n\t$disp_excerpt2 = $cincopa_excerpt == 'clean' ? $tpl_checked : '';\r\n\t$disp_excerpt3 = $cincopa_excerpt == 'full' ? $tpl_checked : '';\r\n\t$disp_excerpt4 = $cincopa_excerpt == 'remove' ? $tpl_checked : '';\r\n\t$disp_excerpt1 = $cincopa_excerpt == '' || $cincopa_excerpt == 'nothing' ? $tpl_checked : '';\r\n\r\n\t$disp_async2 = $cincopa_async == 'async' ? $tpl_checked : '';\r\n\t$disp_async1 = $cincopa_async == '' || $cincopa_async == 'plain' ? $tpl_checked : '';\r\n\r\n\t$disp_rss2 = $cincopa_rss == 'full' ? $tpl_checked : '';\r\n\t$disp_rss1 = $cincopa_rss == '' || $cincopa_rss == 'thumb' ? $tpl_checked : '';\r\n\r\n\t$disp_opengraph = ( $cincopa_opengraph == 1) ? $tpl_checked : '';\r\n\r\n?>\r\n\t<div class=\"wrap\">\r\n\t\t<h2>Cincopa Configuration</h2>\r\n\t\t<div class=\"postbox-container\">\r\n\t\t\t<div class=\"metabox-holder\">\r\n\t\t\t\t<div class=\"meta-box-sortables\">\r\n\t\t\t\t\t<form action=\"\" method=\"post\" id=\"cincopa-conf\">\r\n\t\t\t\t\t\t<div id=\"cincopa_settings\" class=\"postbox\">\r\n\t\t\t\t\t\t\t<div class=\"handlediv\" title=\"Click to toggle\">\r\n\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<h3 class=\"hndle\">\r\n\t\t\t\t\t\t\t\t<span>Cincopa Settings</span>\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t<div class=\"inside\" style=\"width:600px;\">\r\n\t\t\t\t\t\t\t\t<table class=\"form-table\">\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincopaafc\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tExcerpt Handling (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#excerpt\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt1; ?> id=\"embedCustomization0\" name=\"embedRel\" value=\"nothing\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization0\">Do nothing (default Wordpress behavior)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt2; ?> id=\"embedCustomization1\" name=\"embedRel\" value=\"clean\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization1\">Clean excerpt (do not show gallery)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt4; ?> id=\"embedCustomization3\" name=\"embedRel\" value=\"remove\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization3\">Remove gallery (do not show gallery in all non post pages)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt3; ?> id=\"embedCustomization2\" name=\"embedRel\" value=\"full\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization2\">Full excerpt (show gallery)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"open_graph\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tUse Open Graph Tags? (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#opengraph\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" <?php echo $disp_opengraph; ?> id=\"open_graph\" name=\"open_graph\" value=\"1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<?php\r\n\r\nif (_cpmp_isAdmin())\r\n{\r\n?>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincopaafc\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tCincopa AFC (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#afc\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input id=\"cincopaafc\" name=\"cincopaafc\" type=\"text\" size=\"20\" value=\"<?php echo $cincopa_afc; ?>\"/>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincopaasync\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tAsync Engine (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#async\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_async1; ?> id=\"asyncCustomization0\" name=\"asyncRel\" value=\"plain\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"asyncCustomization0\">Plain Sync</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_async2; ?> id=\"asyncCustomization1\" name=\"asyncRel\" value=\"async\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"asyncCustomization1\">Advanced Async </label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincoparss\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tRSS handling (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#rsshandling\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_rss1; ?> id=\"rss0\" name=\"rssRel\" value=\"thumb\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"rss0\">Show thumbnail</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_rss2; ?> id=\"rss1\" name=\"rssRel\" value=\"full\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"rss1\">Full gallery</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<?php\r\n}\r\n\r\n?>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\" colspan=2>\r\n\t\t\t\t\t\t\t\t\t\t\tNote:\r\n<ol>\r\n<li>Use this PHP code to add a gallery directly to your template : <br>&nbsp;&nbsp;&nbsp; <i>&lt;?php echo _cpmp_cincopa_tag(\"GALLERY ID\"); ?&gt;</i></li>\r\n</ol>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"submit\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" class=\"button-primary\" name=\"submit\" value=\"Update &raquo;\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n<?php\r\n    \r\n    \r\n}\r\n/*\r\n// _cpmp_mt_manage_page() displays the page content for the Test Manage submenu\r\nfunction _cpmp_mt_manage_page() {\r\n    echo \"<h2>Test Manage</h2>\";\r\n}\r\n*/\r\n\r\nfunction _cpmp_mt_toplevel_page() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/start.aspx?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_create() {\r\n    //echo \"<iframe src='//www.cincopa.com/media-platform/wizard_name.aspx?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='98%' height='2000px'></iframe>\";\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/start.aspx?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_monitor() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/wizard_edit15?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_library() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/wizard2/library15?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_myaccount() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/cincopaManager/manageaccount.aspx?ver=\"._cpmp_plugin_ver()._cpmp_afc().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_forum() {\r\n    //echo \"<iframe src='//www.cincopa.com/redirect_to_help.aspx' width='98%' height='2000px'></iframe>\";\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/learning-center' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\n\r\n\r\nif (!class_exists('CincopaWidget')) {\r\n\r\n\t/**\r\n\t * CincopaWidget Class\r\n\t */\r\n\tclass CincopaWidget extends WP_Widget {\r\n\t\t\t/** constructor */\r\n\t\t\tfunction CincopaWidget() {\r\n\t\t\t\t\tparent::WP_Widget(false, $name = 'Cincopa Gallery Widget');\t\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::widget */\r\n\t\t\tfunction widget($args, $instance) {\t\t\r\n\t\t\t\t\textract( $args );\r\n\r\n\t\t\t\t\tif (strpos($instance['galleryid'], 'cincopa'))\r\n\t\t\t\t\t\t$gallery = _cpmp_plugin($instance['galleryid']);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\t$gallery = _cpmp_plugin('[cincopa '.$instance['galleryid'].']');\r\n\r\n\t\t\t\t\techo $gallery;\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::update */\r\n\t\t\tfunction update($new_instance, $old_instance) {\t\t\t\t\r\n\t\t\t\t\treturn $new_instance;\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::form */\r\n\t\t\tfunction form($instance) {\t\t\t\t\r\n\t\t\t\t\t$galleryid = esc_attr($instance['galleryid']);\r\n\t\t\t\t\t?>\r\n\t<p>\r\n\t\t<label for=\"\"\r\n\t\t\t<?php echo $this->get_field_id('galleryid'); ?>\"><?php _e('Gallery ID:'); ?> <a target=\"_blank\" href=\"//help.cincopa.com/entries/405593-how-do-i-add-a-gallery-to-my-wordpress-sidebar\">what?</a> <input class=\"widefat\" id=\"\"<?php echo $this->get_field_id('galleryid'); ?>\" name=\"<?php echo $this->get_field_name('galleryid'); ?>\" type=\"text\" value=\"<?php echo $galleryid; ?>\" />\r\n\t\t</label>\r\n\t</p>\r\n\t<?php \r\n\t\t\t}\r\n\r\n\t} // class CincopaWidget\r\n\r\n}\r\n\r\n// http://www.aaronrussell.co.uk/blog/improving-wordpress-the_excerpt/\r\n\r\nfunction _cpmp_improved_trim_excerpt($text)\r\n{\r\n\tglobal $post;\r\n\tif ( '' == $text ) {\r\n\t\t$text = get_the_content('');\r\n\r\n\t\t$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\n\r\n\t\tif ($cincopa_excerpt_rt == 'clean')\r\n\t\t\t$text = preg_replace(CINCOPA_REGEXP, '', $text);\r\n\r\n\t\t$text = apply_filters('the_content', $text);\r\n\r\n\t\tif ($cincopa_excerpt_rt == 'full')\r\n\t\t\treturn $text;\r\n\r\n\t\t$text = str_replace(']]>', ']]&gt;', $text);\r\n\t\t$text = preg_replace('@<script[^>]*?>.*?</script>@si', '', $text);\r\n\r\n\t\t$text = strip_tags($text, '<'.'p'.'>');\r\n\t\t$excerpt_length = 80;\r\n\t\t$words = explode(' ', $text, $excerpt_length + 1);\r\n\t\tif (count($words)> $excerpt_length) \r\n\t\t{\r\n\t\t\tarray_pop($words);\r\n\t\t\tarray_push($words, '[...]');\r\n\t\t\t$text = implode(' ', $words);\r\n\t\t}\r\n\t}\r\n\t\t\t\r\n\treturn $text;\r\n}\r\n\r\n$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\nif ($cincopa_excerpt_rt == 'full' || $cincopa_excerpt_rt == 'clean')\r\n{\r\n\tremove_filter('get_the_excerpt', 'wp_trim_excerpt');\r\n\t//\tremove_all_filters('get_the_excerpt');\r\n\tadd_filter('get_the_excerpt', '_cpmp_improved_trim_excerpt');\r\n}\r\n\r\nfunction _cpmp_activation_notice()\r\n\t\t\t{ ?>\r\n\t\t\t<div id=\"message\" class=\"updated fade\">\r\n\t\t\t\t<p style=\"line-height: 150%\">\r\n\t\t\t\t\t<strong>Welcome to Cincopa Rich Media Plugin</strong> - the most popular way to add videos, photo galleries, slideshows, Cooliris gallery, podcast and music to your site.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tOn every post page (above the text box) you'll find this <img src=\"<?php echo _cpmp_pluginURI() ?>/media-cincopa.gif\"  /> icon, click on it to start or use sidebar Widgets (Appearance menu).\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\r\n<input type=\"button\" class=\"button\" value=\"Cincopa Options Page\" onclick=\"document.location.href = 'options-general.php?page=cincopaoptions';\" />\r\n\r\n<input type=\"button\" class=\"button\" value=\"Hide this message\" onclick=\"document.location.href = 'options-general.php?page=cincopaoptions&amp;hide_note=welcome_notice';\" />\r\n\r\n<input type=\"button\" class=\"button\" value=\"Video Tutorial\" onclick=\"window.open('//help.cincopa.com/entries/488838-how-to-use-the-wordpress-plugin');\" />\r\n\r\n\t\t\t\t</p>\r\n\r\n\t\t\t</div>\r\n\r\n\r\n\t\t\t<?php\r\n\r\n\tif (get_site_option('cincopa_installed') != 'true')\r\n\t{\r\n\t\tupdate_site_option('cincopa_installed', 'true');\r\n\t\techo \"<img src='//goo.gl/HqSz' width=0 height=0 />\";\r\n\t}\r\n\r\n}\r\n\r\nadd_action( 'admin_footer-post-new.php', 'cincopa_mediaDefault_script' );\r\nadd_action( 'admin_footer-post.php', 'cincopa_mediaDefault_script' );\r\nadd_action( 'admin_footer-index.php', 'cincopa_mediaDefault_script' );\r\n\r\nfunction cincopa_mediaDefault_script()\r\n{\r\n\t?>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\tvar cincopa_popup_timer = null;\r\n\t\t\tfunction cincopa_launch_popup()\r\n\t\t\t{\r\n\t\t\t\tcincopa_popup_timer = setInterval(cincopa_check_popup, 200);\r\n\t\t\t}\r\n\r\n\t\t\tfunction cincopa_check_popup()\r\n\t\t\t{\r\n\t\t\t\tif (jQuery(\".media-menu-item:contains('Cincopa')\").closest('.supports-drag-drop').css('display') == 'none') \r\n\t\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\t\tif (jQuery(\".media-menu-item:contains('Cincopa')\").length > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tjQuery(\".media-menu-item:contains('Cincopa')\")[0].click();\r\n\t\t\t\t\tclearInterval(cincopa_popup_timer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t</script>\r\n\t<?php\r\n}"], "fixing_code": ["=== Post video players, slideshow albums, photo galleries and music / podcast playlist ===\r\nContributors: nicashmu\r\nTags: cincopa, responsive, photos, video, html5, slideshow, images, podcast, video portal, gallery, media, admin, post, WPtouch, photo-albums, pictures, widget, photo, picture, video hosting, s3, music, playlists, playlist, sidebar, ajax, video, vidavee, iphone, cms, ipod, smooth gallery, nextgen, javascript, embed, menus, analytics, media library, itunes, mu, podpress, lightbox, podpress, flowplayer, jw player, comments, twitter, page, google, links, image\r\nRequires at least: 2.0.2\r\nTested up to: 4.2.2\r\n\r\nPost your videos, photo galleries/flash slideshows, music and playlists easily and in seconds.\r\n\r\n== Description ==\r\n\r\nNo need for multiple plugins for your WordPress media. Cincopa is **The only plugin you need for all your media needs**. Use Cincopa to easily add videos, photo galleries, slideshows, music and playlists and much more. Enjoy more than 40 designed skins for slideshows, video players, Cooliris, Lightbox and many more.\r\n\r\n* **HASSLE-FREE** WordPress media support for your site, include **Videos**, **Slideshows**, **Image Galleries**, **Audio playlists and podcasts**. \r\n\r\n* **Responsive design and HTML5** to ensure compatibility with mobile phones, tablets as well as desktops. Your audience is mobile more than ever, our technology will make sure that they can access your content anywhere and any time.\r\n\r\n* **Fully Managed** to ensure high speed, scalability, security and reliability of your media. [Read more](//www.cincopa.com/media-platform/services/what-is-a-cdn)\r\n\r\n* **Expert WordPress Support** - full [technical support](//help.cincopa.com/home), many [tutorials](//help.cincopa.com/categories/9559-media-platform-guides-tutorials) and [video tutorials](//help.cincopa.com/forums/376513-video-tutorials) to get you started.\r\n\r\n\r\nRead more about [Cincopa WordPress Media Plugin](//www.cincopa.com/media-platform/wordpress-plugin.aspx)\r\n\r\n\r\n[youtube https://www.youtube.com/watch?v=rgdK2sHpxnA]\r\n\r\n\r\n= Features =\r\n\r\n* **[more than 100 skins](//www.cincopa.com/media-platform/skins)** - slideshows, video players, playlists, flash, full-screen, Cooliris, lightbox, wedding skins and many more\r\n* Many customization options: size, colors, text and more\r\n* Simple media management directly from your WordPress dashboard\r\n* Automatic **resizing of photos**\r\n* **Automatic uploading and hosting**\r\n* Automatic **video transcoding** to flv/3gp/mp4\r\n* Supported file types - avi, mov, wmv, mp4, m4a, f4a, f4b, f4v, f4p, m2ts, mts, DVD vob, mkv, rmvb, m1v, qt, div, divx, dv, 3gp, 3gpp, 3g2, mpg, mpeg, mpe, flv, wav, wma\r\n* Complete analytics of your traffic\r\n* Support iPhone, iPad, Android, blackberry automatically and other smart and mobile phones\r\n* Hosting and delivering your media on Amazon S3 Web Services ensure scalability and reliability.\r\n* Video hosting, video serving, video streaming and pseudo streaming (progressive download) solutions\r\n* Many types of players to choose from including JW, flowplay, Cooliris and others\r\n* Support playlist with customizable side, bottom and top list using CSS\r\n* Add caption and description to any item\r\n* Integrates with your CDN solution\r\n* Management tool to allow your users/designers/web master to upload videos\r\n* Embed code button directly into article\r\n* Progressive Download (Pseudo streaming - httpd)\r\n* HD widescreen flv and H.264, ideal for videoblog and photoblog\r\n* Preview image in 4 sizes (for first frame of video).\r\n* Full Screen feature.\r\n* Domain lock feature to protect your video\r\n* Support HTTPS (SSL) sites\r\n* Download source feature\r\n* On screen Logo for branding\r\n* Google analytics Tracking Enabled\r\n* Support other CMS systems and public web sites\r\n* Post to your blog from anywhere and even if your videos are at home on your PC\r\n* The plugin is FREE, we do offer a [pro account](//www.cincopa.com/cincopamanager/paypal/plans.aspx) with even more options.\r\n\r\n\r\nThousands of site are already using Cincopa, [Start now for free](//downloads.wordpress.org/plugin/video-playlist-and-gallery-plugin.zip) and add media to your WordPress site in seconds.\r\n\r\n\r\nGet more information about [Cincopa WordPress Media Plugin](//www.cincopa.com/media-platform/wordpress-plugin.aspx) and see some examples.\r\n\r\nFor comments, questions and support use this email [support@cincopa.com](mailto:support@cincopa.com)\r\n\r\n<h4>Buddypress and wpmu</h4>\r\nIdeal multimedia solution for BuddyPress and mu because each user gets his own private storage space with zero cost to site owner. \r\n\r\n\r\n== Installation ==\r\n\r\n<ol>\r\n<li>Click download (on the right) to download the zip package</li>\r\n<li>Unzip the downloaded package and upload the <code><span style=\"font-family: Consolas\">post-rich-videos-and-photos-galleries</span></code> folder into the <code><span style=\"font-family: Consolas\">wp-content/plugins/</span></code> directory</li>\r\n\r\n<li>Log into your WordPress admin panel</li>\r\n<li>Activate the plugin (named 'WordPress Cincopa Plugin') through the &#8216;Plugins&#8217; menu in WordPress (if you are upgrading from an earlier version, make sure to de-activate and re-activate the plugin so that all options are updated)</li>\r\n<li>Go to your post/page and click on the C icon.</li>\r\n</ol>\r\n\r\n== Frequently Asked Questions ==\r\n\r\n= What about non-WordPress sites/blogs ? =\r\n\r\nYou can also embed your gallery in other sites/blogs using a HTML code. To create your gallery start here http://www.cincopa.com/media-platform/start.aspx and follow the instructions.\r\n\r\n= How much storage do I need to post videos and photos ? =\r\n\r\nNone, You don't need any space on your server, your files will be stored on Cincopa server.\r\n\r\n= How many photos and videos I can post ? =\r\n\r\nA lot, really.\r\n\r\n= What is a style/skin ? =\r\n\r\nAfter you select photos and videos for your post you need to select the style of how to display them, there are a lot of styles available, some good for playing many videos, some good for slideshows, some for music playlists etc.\r\n\r\n= How do I post my photos/videos ? =\r\n\r\nIn the post page, just click on the C icon and follow the instructions.\r\n\r\n= Do I need to upload my videos/photos to the server before starting ? =\r\n\r\nNo. Cincopa agent will do it for you after you've completed the post or you can batch upload it.\r\n\r\n= Do I need to register with Cincopa ? =\r\n\r\nYes. After clicking the C icon in the post page follow the instructions to register with Cincopa.\r\n\r\n= Why can't I use my server ? =\r\n\r\nIf you are using one of those low cost shared hosting solution then you better let Cincopa do the media hosting for you. Your hosting is perfect for hosting your site but they are not optimized to serve your videos, photos or music. Combining your hosting solution with Cincopa will render a professional site.\r\n\r\n\r\n== Screenshots ==\r\n\r\n1. Audio mobile\r\n2. Audio playlist\r\n3. Image gallery\r\n4. Image list pinterest\r\n5. Image list preview\r\n6. Ligthbox\r\n7. Start page\r\n8. Video gallery\r\n9. Video playlist", "<?php\r\n/*\r\nPlugin Name: Post video players, slideshow albums, photo galleries and music / podcast playlist\r\nPlugin URI: http://www.cincopa.com/media-platform/wordpress-plugin.aspx\r\nDescription: Post rich videos and photos galleries from your cincopa account\r\nAuthor: Cincopa \r\nVersion: 1.137\r\n*/\r\n\r\nfunction _cpmp_plugin_ver()\r\n{\r\n\treturn 'wp1.137';\r\n}\r\n\r\nfunction _cpmp_url()\r\n{\r\n\treturn '//www.cincopa.com';\r\n}\r\n\r\nif (strpos($_SERVER['REQUEST_URI'], 'media-upload.php') && strpos($_SERVER['REQUEST_URI'], '&type=cincopa') && !strpos($_SERVER['REQUEST_URI'], '&wrt='))\r\n{\r\n\theader('Location: '._cpmp_url().'/media-platform/start.aspx?ver='._cpmp_plugin_ver().'&rdt='.urlencode(_cpmp_selfURL()));\r\n\texit;\r\n}\r\n\r\nfunction _cpmp_selfURL()\r\n{\r\n\t$s = empty ( $_SERVER [\"HTTPS\"] ) ? '' : ($_SERVER [\"HTTPS\"] == \"on\") ? \"s\" : \"\";\r\n\r\n\t$protocol =  strtolower ( $_SERVER [\"SERVER_PROTOCOL\"] );\r\n\t$protocol =  substr($protocol, 0, strpos($protocol, \"/\"));\r\n\t$protocol .= $s;\r\n\r\n\t$port = ($_SERVER [\"SERVER_PORT\"] == \"80\") ? \"\" : (\":\" . $_SERVER [\"SERVER_PORT\"]);\r\n\t$ret = $protocol . \"://\" . $_SERVER ['SERVER_NAME'] . $port . $_SERVER ['REQUEST_URI'];\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_pluginURI()\r\n{\r\n\t$s = empty ( $_SERVER [\"HTTPS\"] ) ? '' : ($_SERVER [\"HTTPS\"] == \"on\") ? \"s\" : \"\";\r\n\r\n\t$protocol =  strtolower ( $_SERVER [\"SERVER_PROTOCOL\"] );\r\n\t$protocol =  substr($protocol, 0, strpos($protocol, \"/\"));\r\n\t$protocol .= $s;\r\n\r\n\t$url = site_url( '', $protocol );\r\n\t//echo 'url = ' . $url;\r\n\treturn $url . '/wp-content/plugins/'.dirname(plugin_basename(__FILE__));\r\n\t//return get_option('siteurl').'/wp-content/plugins/'.dirname(plugin_basename(__FILE__));\r\n}\r\n\r\nfunction _cpmp_WpMediaCincopa_init() // constructor\r\n{\r\n\tadd_action('media_buttons', '_cpmp_addMediaButton', 20);\r\n\r\n\tadd_action('media_upload_cincopa', '_cpmp_media_upload');\r\n\t// No longer needed in WP 2.6\r\n\tif ( !function_exists('wp_enqueue_style') )\r\n\t{\r\n\t\tadd_action('admin_head_media_upload_type_cincopa', 'media_admin_css');\r\n\t}\r\n      \r\n\t// check auth enabled\r\n\t//if(!function_exists('curl_init') && !ini_get('allow_url_fopen')) {}\r\n}\r\n\r\nfunction _cpmp_media_menu($tabs) {\r\n    $newtab = array('cincopabox' => __('Insert Media from Cincopa', 'cincopa'));\r\n    return array_merge($tabs, $newtab);\r\n}\r\nadd_filter('media_upload_tabs', '_cpmp_media_menu');\r\n\r\n\r\nfunction media_cincopabox_process() {\r\n    if(isset($_REQUEST['wrt'])){\r\n        _cpmp_media_upload_type_cincopa();\r\n        return;\r\n    }\r\n    if (sizeof($_POST)>0){\r\n        var_dump($_POST);\r\n        \r\n    }\r\n    media_upload_header();\r\n    ?>\r\n    <iframe src=\"<?php echo _cpmp_url().'/media-platform/start.aspx?ver='._cpmp_plugin_ver().'&rdt='.urlencode(_cpmp_selfURL().\"&\")?>&\" width=\"100%\" height=\"98%\"></iframe>\r\n    <?php\r\n}\r\nfunction cincopabox_menu_handle() {\r\n    \r\n    return wp_iframe( 'media_cincopabox_process');\r\n}\r\n\r\nadd_action('media_upload_cincopabox', 'cincopabox_menu_handle');\r\n\r\n\r\nfunction _cpmp_addMediaButton($admin = true)\r\n{\r\n\tglobal $post_ID, $temp_ID;\r\n\t$uploading_iframe_ID = (int) (0 == $post_ID ? $temp_ID : $post_ID);\r\n\r\n\t$media_upload_iframe_src = get_option('siteurl').\"/wp-admin/media-upload.php?post_id=$uploading_iframe_ID\";\r\n\r\n\t$media_cincopa_iframe_src = apply_filters('media_cincopa_iframe_src', \"$media_upload_iframe_src&amp;type=cincopa&amp;tab=cincopa\");\r\n\t$media_cincopa_title = __('Add Cincopa Media', 'wp-media-cincopa');\r\n\t?>\r\n\t<div id=\"cincopa_button\">\r\n\t\t<a onClick=\"javascript:cincopa_launch_popup();\" class=\"insert-media \" data-editor=\"content\" title=\"Add Media\">\r\n\t\t\t<div class=\"first\" onClick=\"javascript:cincopa_launch_popup();\">\r\n\t\t\t\t<img src=\"<?php echo _cpmp_pluginURI(); ?>/media-cincopa.gif\" alt=\"<?php echo $media_cincopa_title; ?>\" />\r\n\t\t\t</div>\r\n\t\t</a>\r\n\t\t<div class=\"last cincopa-show-gallery\" id=\"cincopa_show_button\"<?php if (is_rtl()) echo ' style=\"border-right:1px solid #bbb;\"'; ?>></div>\r\n\t</div>\r\n\t<div class=\"cincopa-gallery-block\"><img src=\"<?php echo _cpmp_pluginURI(); ?>/loading.gif\"></div>\r\n\t<?php\r\n}\r\n\r\nfunction _cpmp_modifyMediaTab($tabs)\r\n{\r\n\treturn array(\r\n\t\t'cincopa' =>  __('Cincopa photo', 'wp-media-cincopa'),\r\n\t);\r\n}\r\n\r\nfunction _cpmp_media_upload()\r\n{\r\n\twp_iframe('_cpmp_media_upload_type_cincopa');\r\n}\r\n\r\n\r\nfunction _cpmp_media_upload_type_cincopa()\r\n{\r\n\tglobal $wpdb, $wp_query, $wp_locale, $type, $tab, $post_mime_types;\r\n\tadd_filter('media_upload_tabs', '_cpmp_modifyMediaTab');\r\n?>\r\n\r\n<br />\r\n<br />\r\n<h2>&nbsp;&nbsp;Please Wait...</h2>\r\n\r\n<script>\r\n\r\n\tfunction _cpmp_cincopa_stub()\r\n\t{\r\n\t\tvar i = location.href.indexOf(\"&wrt=\");\r\n\r\n\t\tif (i > -1)\r\n\t\t{\r\n\t\t\ttop.send_to_editor(unescape(location.href.substring(i+5)));\r\n\t\t}\r\n\r\n\t\ttop.tb_remove();\r\n\t}\r\n\r\n\twindow.onload = _cpmp_cincopa_stub;\r\n\r\n</script>\r\n\r\n<?php\r\n}\r\n\r\n_cpmp_WpMediaCincopa_init();\r\n\r\n\r\n// this new regex should resolve the problem of having unicode chars in the tag\r\ndefine(\"CINCOPA_REGEXP\", \"/\\[cincopa([^\\]]*)\\]/\");\r\n\r\n\r\nfunction _cpmp_cincopa_tag($fid)\r\n{\r\n\treturn _cpmp_plugin_callback(array($fid));\r\n}\r\n\r\nfunction _cpmp_plugin_callback($match)\r\n{\r\n\t$uni = uniqid('');\r\n\t\r\n\t// don't remove it. used for open graph generation\r\n\t$ret = sprintf( '<!-- %s -->', $match[0] );\r\n\t\r\n\t$ret .= '\r\n<!-- Cincopa WordPress plugin '._cpmp_plugin_ver().': //www.cincopa.com/media-platform/wordpress-plugin.aspx -->\r\n<div id=\"cp_widget_'.$uni.'\"><img src=\"//www.cincopa.com/media-platform/runtime/loading.gif\" style=\"border:0;\" alt=\"Cincopa WordPress plugin\" /></div>\r\n<script src=\"//www.cincopa.com/media-platform/runtime/libasync.js\" type=\"text/javascript\"></script>\r\n<script type=\"text/javascript\">\r\n/* PLEASE CHANGE DEFAULT EXCERPT HANDLING TO CLEAN OR FULL (go to your Wordpress Dashboard/Settings/Cincopa Options ... */\r\ncp_load_widget(\"'.urlencode($match[0]).'\", \"cp_widget_'.$uni.'\");\r\n</script>\r\n';\r\n\r\n\t$ret .= '<noscript>Powered by Cincopa Video Hosting.<br>';\r\n\t$ret .= '</noscript>';\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_async_plugin_callback($match)\r\n{\r\n\t$uni = uniqid('');\r\n\r\n\t$ret = '\r\n<!-- Cincopa WordPress plugin '._cpmp_plugin_ver().' (async engine): //www.cincopa.com/media-platform/wordpress-plugin.aspx -->\r\n\r\n<div id=\"cp_widget_'.$uni.'\"><img src=\"//www.cincopa.com/media-platform/runtime/loading.gif\" style=\"border:0;\" alt=\"Cincopa WordPress plugin\" /></div>\r\n\r\n<script type=\"text/javascript\">\r\n/* PLEASE CHANGE DEFAULT EXCERPT HANDLING TO CLEAN OR FULL (go to your Wordpress Dashboard/Settings/Cincopa Options ... */\r\n\r\nvar cpo = [];\r\ncpo[\"_object\"] =\"cp_widget_'.$uni.'\";\r\ncpo[\"_fid\"] = \"'.urlencode($match[0]).'\";\r\n\r\nvar _cpmp = _cpmp || [];\r\n_cpmp.push(cpo);\r\n\r\n(function() {\r\n\tvar cp = document.createElement(\"script\"); cp.type = \"text/javascript\";\r\n\tcp.async = true; cp.src = \"//www.cincopa.com/media-platform/runtime/libasync.js\";\r\n\tvar c = document.getElementsByTagName(\"script\")[0];\r\n\tc.parentNode.insertBefore(cp, c);\r\n})();\r\n\r\n</script>\r\n\r\n';\r\n\r\n\t$ret .= '<noscript>Powered by Cincopa Video Hosting.<br>';\r\n\t$ret .= '</noscript>';\r\n\r\n\treturn $ret;\r\n}\r\n\r\nfunction _cpmp_feed_plugin_callback($match)\r\n{\r\n\t$ret = '<img style=\"border:0;\" src=\"//www.cincopa.com/media-platform/api/thumb.aspx?fid='.urlencode($match[1]).'&size=large\" />';\r\n\r\n\treturn $ret;\r\n}\r\n\r\n$opengraph_meta = array();\r\n\r\nfunction _cpmp_plugin($content) {\r\n\tglobal $opengraph_meta;\r\n\t\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'tcapc=true'))\r\n\t\t$cincopa_async = 'async';\r\n\telse if (strpos($_SERVER['REQUEST_URI'], 'tcapc=false'))\r\n\t\t$cincopa_async = 'plain';\r\n\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'cpdisable=true'))\r\n\t\treturn $content;\r\n\r\n\t$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\n\tif ($cincopa_excerpt_rt == 'remove' && (is_search() || is_category() || is_archive() || is_home()))\r\n\t\treturn preg_replace(CINCOPA_REGEXP, '', $content);\r\n\telse if ( is_feed() ) {\r\n\t\tif ($cincopa_rss == 'full') {\r\n\t\t\tif ($cincopa_async == 'async') {\r\n\t\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\t\t\t} else {\r\n\t\t\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_feed_plugin_callback', $content));\r\n\t\t}\r\n\t}\r\n\telse if ($cincopa_async == 'async')\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\telse {\r\n\t\t// add cincopa did into array for open graph generation\r\n\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t}\r\n}\r\n\r\nfunction _cpmp_plugin_rss($content)\r\n{\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\tif (strpos($_SERVER['REQUEST_URI'], 'tcapc=true'))\r\n\t\t$cincopa_async = 'async';\r\n\telse if (strpos($_SERVER['REQUEST_URI'], 'tcapc=false'))\r\n\t\t$cincopa_async = 'plain';\r\n\t\r\n\tif ($cincopa_rss == 'full') {\r\n\t\tif ($cincopa_async == 'async') {\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_async_plugin_callback', $content));\r\n\t\t} else {\r\n\t\t\tpreg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_plugin_callback', $content));\r\n\t\t}\r\n\t} else {\r\n\t\treturn (preg_replace_callback(CINCOPA_REGEXP, '_cpmp_feed_plugin_callback', $content));\r\n\t}\r\n}\r\n\r\n//add_shortcode('cincopa', 'cincopa_plugin_shortcode');\r\nadd_filter('the_content', '_cpmp_plugin');\r\nadd_filter('the_content_rss', '_cpmp_plugin_rss');\r\nadd_filter('the_excerpt_rss', '_cpmp_plugin_rss');\r\nadd_filter('comment_text', '_cpmp_plugin'); \r\n\r\nadd_action ( 'bp_get_activity_content_body', '_cpmp_plugin' );\r\nadd_action ( 'bp_get_the_topic_post_content', '_cpmp_plugin' );\r\n\r\nadd_action('wp_dashboard_setup', '_cpmp_dashboard'); \r\n\r\n// Hook for adding admin menus\r\n// http://codex.wordpress.org/Adding_Administration_Menus\r\nadd_action('admin_menu', '_cpmp_mt_add_pages');\r\n\r\n// register CincopaWidget widget\r\nadd_action('widgets_init', create_function('', 'return register_widget(\"CincopaWidget\");'));\r\n\r\nwp_oembed_add_provider( '//www.cincopa.com/*', '//www.cincopa.com/media-platform/oembed.aspx' );\r\n\r\nif (get_site_option('cincopa_welcome_notice') != _cpmp_plugin_ver())\r\n\tadd_action( 'admin_notices', '_cpmp_activation_notice' );\r\n\r\n$open_graph_mode = get_site_option('CincopaOpenGraph');\r\nif ( $open_graph_mode == 1 ) {\r\n\tadd_action('wp_head', '_cpmp_buffer_start');\r\n\tadd_action('wp_footer', '_cpmp_buffer_end');\r\n\t\t\r\n\tadd_action('wp_head', '_cpmp_opengraph_meta_tags');\r\n\tadd_filter('language_attributes', '_cpmp_opengraph_add_prefix');\r\n}\r\n\r\nfunction _cpmp_buffer_start() { ob_start(\"_cpmp_content_callback\"); }\r\nfunction _cpmp_buffer_end() { ob_end_flush(); }\r\nfunction _cpmp_content_callback($buffer) {\r\n\t\r\n\t$meta_list = _cpmp_get_opengraph_meta_list();\r\n\t\r\n\tif ( ! empty($meta_list) ) {\r\n\t\t// modify buffer here, and then return the updated code\r\n\t\t$buffer = str_replace(_cpmp_opengraph_placeholder(), $meta_list, $buffer );\r\n\t}\r\n\t\r\n\treturn $buffer;\r\n}\r\n\r\nfunction _cpmp_get_opengraph_meta_list() {\r\n\tglobal $opengraph_meta;\r\n\r\n\t$opengraph_list = '';\r\n\tforeach ($opengraph_meta as $key => $item)\r\n\t\t$opengraph_list .= $item;\r\n\t\t\r\n\treturn $opengraph_list; \t\r\n}\r\n/**\r\n * Add Open Graph XML prefix to <html> element.\r\n *\r\n * @uses apply_filters calls 'opengraph_prefixes' filter on RDFa prefix array\r\n */\r\nfunction _cpmp_opengraph_add_prefix( $output ) {\r\n  $prefixes = array(\r\n    'og' => '//ogp.me/ns#'\r\n  );\r\n  $prefixes = apply_filters('_cpmp_opengraph_prefixes', $prefixes);\r\n\r\n  $prefix_str = '';\r\n  foreach( $prefixes as $k => $v ) {\r\n    $prefix_str .= $k . ': ' . $v . ' ';\r\n  }\r\n  $prefix_str = trim($prefix_str);\r\n \t\r\n  if (preg_match('/(prefix\\s*=\\s*[\\\"|\\'])/i', $output)) {\r\n    $output = preg_replace('/(prefix\\s*=\\s*[\\\"|\\'])/i', '${1}' . $prefix_str, $output);\r\n  } else {\r\n    $output .= ' prefix=\"' . $prefix_str . '\"';\r\n  }\r\n  return $output;\r\n}\r\n\r\nfunction _cpmp_opengraph_meta_tags_callback( $match ) {\r\n\tglobal $opengraph_meta;\r\n\r\n\tif ( empty($match[1]) ) \r\n\t\treturn '';\r\n\t\r\n\t$opengraph_meta_item = \r\n\t\t'<meta property=\"og:image\" content=\"//www.cincopa.com/media-platform/api/thumb_open.aspx?fid=' . urlencode(trim($match[1])) . '&size=large\">' . \"\\n\" .\r\n\t\t'<meta name=\"twitter:image\" content=\"//www.cincopa.com/media-platform/api/thumb_open.aspx?fid=' . urlencode(trim($match[1])) . '&size=large\">' . \"\\n\";\r\n\r\n\t$opengraph_meta[trim($match[1])] = $opengraph_meta_item;\r\n\t\r\n\treturn $opengraph_meta_item;\r\n}\r\nfunction _cpmp_opengraph_placeholder() {\r\n\treturn '<!-- [CincopaOpenGraph] -->';\r\n}\r\nfunction _cpmp_opengraph_meta_tags() {\r\n\r\n\tif ( ! is_singular() ) {\r\n\t\techo _cpmp_opengraph_placeholder();\r\n\t\treturn;\r\n\t}\r\n\t\t\r\n\t$post = get_queried_object();\r\n\t$content = $post->post_content;\r\n\t$meta = preg_replace_callback(CINCOPA_REGEXP, '_cpmp_opengraph_meta_tags_callback', $content);\r\n\t\r\n\techo _cpmp_get_opengraph_meta_list();\r\n}\r\n\t\r\n/////////////////////////////////\r\n// #AB# dropdown menu functions\r\n/////////////////////////////////\r\n\r\n// register js and style on initialization\r\nadd_action('init', '_cpmp_register_script');\r\nfunction _cpmp_register_script() {\r\n\t\r\n\tif ( is_admin() ) {\r\n\t\t// add styles for dropdown \r\n\t\twp_register_style( 'cincopa-style', plugins_url('css.cincopa.css', __FILE__), false, '20130425.4', 'all' );\r\n\t\t// add js for dropdown \r\n\t\twp_register_script( 'cincopa-script', plugins_url('js.cincopa.js', __FILE__), array(), '20130425.4' );\r\n\t\t\r\n\t\twp_enqueue_script( 'cincopa-script' );\r\n\t\twp_enqueue_style( 'cincopa-style' );\r\n\t\t\r\n\t}\r\n}\r\n\r\n/////////////////////////////////\r\n// dashboard widget\r\n//////////////////////////////////\r\nfunction _cpmp_dashboard()\r\n{\r\n\tif(function_exists('wp_add_dashboard_widget'))\r\n\t\twp_add_dashboard_widget('cincopa', 'Cincopa', '_cpmp_dashboard_content');\r\n}\r\n\r\nfunction _cpmp_dashboard_content()\r\n{\r\n\r\n        \r\n\techo \"<iframe src='//www.cincopa.com/media-platform/wordpress-dashboard-content.aspx?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='100%' height='370px' scrolling='no'></iframe>\";\r\n\r\n}\r\n\r\n\r\n\r\n/*function changeUrl()\r\n{\r\n    $pageURL = $_SERVER['QUERY_STRING'];\r\n    \r\n    if( $pageURL == 'page=sub-page4' )\r\n    {\r\n        //header ('location: http://help.cincopa.com/home'); //in same tab\r\n    }\r\n}\r\nadd_action( 'admin_menu', 'changeUrl' );*/\r\n\r\n// action function for above hook\r\nfunction _cpmp_mt_add_pages()\r\n{\r\n\t// Add a new submenu under Options:\r\n\t\r\n\tadd_options_page('Cincopa Options', 'Cincopa Options', 'edit_pages', 'cincopaoptions', '_cpmp_mt_options_page');\r\n\r\n\tif(function_exists('add_menu_page'))\r\n\t{\r\n\t\t// Add a new top-level menu (ill-advised):\r\n\t\tadd_menu_page('Cincopa', 'Cincopa', 'edit_pages', __FILE__, '_cpmp_mt_toplevel_page');\r\n\r\n\t\t// kill the first menu item that is usually the the identical to the menu itself\r\n\t\tadd_submenu_page(__FILE__, '', '', 'edit_pages', __FILE__);\r\n\t\tadd_submenu_page(__FILE__, 'Manage Galleries', 'Manage Galleries', 'edit_pages', 'sub-page', '_cpmp_mt_sublevel_monitor');\r\n\t\tadd_submenu_page(__FILE__, 'Media Library', 'Media Library', 'edit_pages', 'sub-page1', '_cpmp_mt_sublevel_library');\r\n\t\tadd_submenu_page(__FILE__, 'Create Gallery', 'Create Gallery', 'edit_pages', 'sub-page2', '_cpmp_mt_sublevel_create');\r\n\t\tadd_submenu_page(__FILE__, 'My Account', 'My Account', 'edit_pages', 'sub-page3', '_cpmp_mt_sublevel_myaccount');\r\n\t\tadd_submenu_page(__FILE__, 'Support Forum', 'Support Forum', 'edit_pages', 'sub-page4', '_cpmp_mt_sublevel_forum');\r\n\t}\r\n}\r\n\r\nfunction _cpmp_isAdmin()\r\n{\r\n\treturn !function_exists('is_site_admin') || is_site_admin() == true;\r\n}\r\n\r\nfunction _cpmp_mt_options_page()\r\n{\r\n\r\n\r\n\tif (strpos($_SERVER['QUERY_STRING'], 'hide_note=welcome_notice'))\r\n\t{\r\n\t\tupdate_site_option('cincopa_welcome_notice', _cpmp_plugin_ver());\r\n\t\techo \"<script type=\\\"text/javascript\\\">\tdocument.location.href = '\".$_SERVER['HTTP_REFERER'].\"'; </script>\";\r\n\t\texit;\r\n\t}\r\n\t\r\n\tif (empty($_COOKIE[\"csrfToken\"]))\r\n\t\tsetcookie('csrfToken', md5(uniqid(rand(), true)));\r\n\r\n\t$cincopa_excerpt = get_site_option('CincopaExcerpt');\r\n\t$cincopa_async = get_site_option('CincopaAsync');\r\n\t$cincopa_rss = get_site_option('CincopaRss');\r\n\t$cincopa_opengraph = get_site_option('CincopaOpenGraph');\r\n\tif ( $cincopa_opengraph === false ) {\r\n\t\t// enabled by default\r\n\t\tupdate_site_option('CincopaOpenGraph', 1);\r\n\t\t$cincopa_opengraph = 1;\t\r\n\t}\r\n\t\r\n\tif ( isset($_POST['submit']) )\r\n\t{\r\n\t\tif ($_POST['csrfToken'] != $_COOKIE['csrfToken'])\r\n\t\t{\r\n\t\t\techo \"nope\";\r\n\t\t\texit();\r\n\t\t}\r\n\r\n\t\tif (_cpmp_isAdmin())\r\n\t\t{\r\n\r\n\t\t\tif (isset($_POST['asyncRel']))\r\n\t\t\t{\r\n\t\t\t\t$cincopa_async = $_POST['asyncRel'];\r\n\t\t\t\tupdate_site_option('CincopaAsync', $cincopa_async);\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif (isset($_POST['rssRel']))\r\n\t\t\t{\r\n\t\t\t\t$cincopa_rss = $_POST['rssRel'];\r\n\t\t\t\tupdate_site_option('CincopaRss', $cincopa_rss);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isset($_POST['embedRel']))\r\n\t\t{\r\n\t\t\t$cincopa_excerpt = $_POST['embedRel'];\r\n\t\t\tupdate_site_option('cincopaexcerpt', $cincopa_excerpt);\t\t\t\r\n\t\t}\r\n\t\tif (isset($_POST['open_graph']) && $_POST['open_graph'] == 1)\r\n\t\t{\r\n\t\t\t$cincopa_opengraph = 1;\r\n\t\t\tupdate_site_option('CincopaOpenGraph', 1);\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tupdate_site_option('CincopaOpenGraph', 0);\r\n\t\t\t$cincopa_opengraph = 0;\r\n\t\t}\r\n\t\t\r\n\t\techo \"<div id=\\\"updatemessage\\\" class=\\\"updated fade\\\"><p>Cincopa settings updated.</p></div>\\n\";\r\n\t\techo \"<script type=\\\"text/javascript\\\">setTimeout(function(){jQuery('#updatemessage').hide('slow');}, 3000);</script>\";\t\r\n\t}\r\n\r\n\t$tpl_checked = 'checked=\"checked\"';\r\n\t$disp_excerpt2 = $cincopa_excerpt == 'clean' ? $tpl_checked : '';\r\n\t$disp_excerpt3 = $cincopa_excerpt == 'full' ? $tpl_checked : '';\r\n\t$disp_excerpt4 = $cincopa_excerpt == 'remove' ? $tpl_checked : '';\r\n\t$disp_excerpt1 = $cincopa_excerpt == '' || $cincopa_excerpt == 'nothing' ? $tpl_checked : '';\r\n\r\n\t$disp_async2 = $cincopa_async == 'async' ? $tpl_checked : '';\r\n\t$disp_async1 = $cincopa_async == '' || $cincopa_async == 'plain' ? $tpl_checked : '';\r\n\r\n\t$disp_rss2 = $cincopa_rss == 'full' ? $tpl_checked : '';\r\n\t$disp_rss1 = $cincopa_rss == '' || $cincopa_rss == 'thumb' ? $tpl_checked : '';\r\n\r\n\t$disp_opengraph = ( $cincopa_opengraph == 1) ? $tpl_checked : '';\r\n\r\n?>\r\n\t<div class=\"wrap\">\r\n\t\t<h2>Cincopa Configuration</h2>\r\n\t\t<div class=\"postbox-container\">\r\n\t\t\t<div class=\"metabox-holder\">\r\n\t\t\t\t<div class=\"meta-box-sortables\">\r\n\t\t\t\t\t<form action=\"\" method=\"post\" id=\"cincopa-conf\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"csrfToken\" value=\"<?php echo($_COOKIE[\"csrfToken\"]) ?>\" />\r\n\t\t\t\t\t\t<div id=\"cincopa_settings\" class=\"postbox\">\r\n\t\t\t\t\t\t\t<div class=\"handlediv\" title=\"Click to toggle\">\r\n\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<h3 class=\"hndle\">\r\n\t\t\t\t\t\t\t\t<span>Cincopa Settings</span>\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t<div class=\"inside\" style=\"width:600px;\">\r\n\t\t\t\t\t\t\t\t<table class=\"form-table\">\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label>\r\n\t\t\t\t\t\t\t\t\t\t\t\tExcerpt Handling (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#excerpt\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt1; ?> id=\"embedCustomization0\" name=\"embedRel\" value=\"nothing\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization0\">Do nothing (default Wordpress behavior)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt2; ?> id=\"embedCustomization1\" name=\"embedRel\" value=\"clean\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization1\">Clean excerpt (do not show gallery)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt4; ?> id=\"embedCustomization3\" name=\"embedRel\" value=\"remove\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization3\">Remove gallery (do not show gallery in all non post pages)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_excerpt3; ?> id=\"embedCustomization2\" name=\"embedRel\" value=\"full\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"embedCustomization2\">Full excerpt (show gallery)</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"open_graph\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tUse Open Graph Tags? (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#opengraph\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" <?php echo $disp_opengraph; ?> id=\"open_graph\" name=\"open_graph\" value=\"1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<?php\r\n\r\nif (_cpmp_isAdmin())\r\n{\r\n?>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincopaasync\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tAsync Engine (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#async\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_async1; ?> id=\"asyncCustomization0\" name=\"asyncRel\" value=\"plain\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"asyncCustomization0\">Plain Sync</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_async2; ?> id=\"asyncCustomization1\" name=\"asyncRel\" value=\"async\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"asyncCustomization1\">Advanced Async </label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"cincoparss\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tRSS handling (<a target=\"_blank\" href=\"//help.cincopa.com/entries/448859-wordpress-plugin-settings-page#rsshandling\">what?</a>):\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_rss1; ?> id=\"rss0\" name=\"rssRel\" value=\"thumb\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"rss0\">Show thumbnail</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" <?php echo $disp_rss2; ?> id=\"rss1\" name=\"rssRel\" value=\"full\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"rss1\">Full gallery</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<br/>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<?php\r\n}\r\n\r\n?>\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<tr style=\"width:100%;\">\r\n\t\t\t\t\t\t\t\t\t\t<th valign=\"top\" scrope=\"row\" colspan=2>\r\n\t\t\t\t\t\t\t\t\t\t\tNote:\r\n<ol>\r\n<li>Use this PHP code to add a gallery directly to your template : <br>&nbsp;&nbsp;&nbsp; <i>&lt;?php echo _cpmp_cincopa_tag(\"GALLERY ID\"); ?&gt;</i></li>\r\n</ol>\r\n\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"submit\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" class=\"button-primary\" name=\"submit\" value=\"Update &raquo;\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n<?php\r\n    \r\n    \r\n}\r\n/*\r\n// _cpmp_mt_manage_page() displays the page content for the Test Manage submenu\r\nfunction _cpmp_mt_manage_page() {\r\n    echo \"<h2>Test Manage</h2>\";\r\n}\r\n*/\r\n\r\nfunction _cpmp_mt_toplevel_page() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/start.aspx?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_create() {\r\n    //echo \"<iframe src='//www.cincopa.com/media-platform/wizard_name.aspx?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='98%' height='2000px'></iframe>\";\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/start.aspx?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_monitor() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/wizard_edit15?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_library() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/media-platform/wizard2/library15?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_myaccount() {\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/cincopaManager/manageaccount.aspx?ver=\"._cpmp_plugin_ver().\"&src=\".urlencode(_cpmp_selfURL()).\"' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\nfunction _cpmp_mt_sublevel_forum() {\r\n    //echo \"<iframe src='//www.cincopa.com/redirect_to_help.aspx' width='98%' height='2000px'></iframe>\";\r\n    echo \"<div style='clear: both;'></div><iframe style='position: fixed; left: 165px;' src='//www.cincopa.com/learning-center' width='88%' height='100%'></iframe>\";\r\n}\r\n\r\n\r\n\r\nif (!class_exists('CincopaWidget')) {\r\n\r\n\t/**\r\n\t * CincopaWidget Class\r\n\t */\r\n\tclass CincopaWidget extends WP_Widget {\r\n\t\t\t/** constructor */\r\n\t\t\tfunction CincopaWidget() {\r\n\t\t\t\t\tparent::WP_Widget(false, $name = 'Cincopa Gallery Widget');\t\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::widget */\r\n\t\t\tfunction widget($args, $instance) {\t\t\r\n\t\t\t\t\textract( $args );\r\n\r\n\t\t\t\t\tif (strpos($instance['galleryid'], 'cincopa'))\r\n\t\t\t\t\t\t$gallery = _cpmp_plugin($instance['galleryid']);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\t$gallery = _cpmp_plugin('[cincopa '.$instance['galleryid'].']');\r\n\r\n\t\t\t\t\techo $gallery;\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::update */\r\n\t\t\tfunction update($new_instance, $old_instance) {\t\t\t\t\r\n\t\t\t\t\treturn $new_instance;\r\n\t\t\t}\r\n\r\n\t\t\t/** @see WP_Widget::form */\r\n\t\t\tfunction form($instance) {\t\t\t\t\r\n\t\t\t\t\t$galleryid = esc_attr($instance['galleryid']);\r\n\t\t\t\t\t?>\r\n\t<p>\r\n\t\t<label for=\"\"\r\n\t\t\t<?php echo $this->get_field_id('galleryid'); ?>\"><?php _e('Gallery ID:'); ?> <a target=\"_blank\" href=\"//help.cincopa.com/entries/405593-how-do-i-add-a-gallery-to-my-wordpress-sidebar\">what?</a> <input class=\"widefat\" id=\"\"<?php echo $this->get_field_id('galleryid'); ?>\" name=\"<?php echo $this->get_field_name('galleryid'); ?>\" type=\"text\" value=\"<?php echo $galleryid; ?>\" />\r\n\t\t</label>\r\n\t</p>\r\n\t<?php \r\n\t\t\t}\r\n\r\n\t} // class CincopaWidget\r\n\r\n}\r\n\r\n// http://www.aaronrussell.co.uk/blog/improving-wordpress-the_excerpt/\r\n\r\nfunction _cpmp_improved_trim_excerpt($text)\r\n{\r\n\tglobal $post;\r\n\tif ( '' == $text ) {\r\n\t\t$text = get_the_content('');\r\n\r\n\t\t$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\n\r\n\t\tif ($cincopa_excerpt_rt == 'clean')\r\n\t\t\t$text = preg_replace(CINCOPA_REGEXP, '', $text);\r\n\r\n\t\t$text = apply_filters('the_content', $text);\r\n\r\n\t\tif ($cincopa_excerpt_rt == 'full')\r\n\t\t\treturn $text;\r\n\r\n\t\t$text = str_replace(']]>', ']]&gt;', $text);\r\n\t\t$text = preg_replace('@<script[^>]*?>.*?</script>@si', '', $text);\r\n\r\n\t\t$text = strip_tags($text, '<'.'p'.'>');\r\n\t\t$excerpt_length = 80;\r\n\t\t$words = explode(' ', $text, $excerpt_length + 1);\r\n\t\tif (count($words)> $excerpt_length) \r\n\t\t{\r\n\t\t\tarray_pop($words);\r\n\t\t\tarray_push($words, '[...]');\r\n\t\t\t$text = implode(' ', $words);\r\n\t\t}\r\n\t}\r\n\t\t\t\r\n\treturn $text;\r\n}\r\n\r\n$cincopa_excerpt_rt = get_site_option('CincopaExcerpt');\r\nif ($cincopa_excerpt_rt == 'full' || $cincopa_excerpt_rt == 'clean')\r\n{\r\n\tremove_filter('get_the_excerpt', 'wp_trim_excerpt');\r\n\t//\tremove_all_filters('get_the_excerpt');\r\n\tadd_filter('get_the_excerpt', '_cpmp_improved_trim_excerpt');\r\n}\r\n\r\nfunction _cpmp_activation_notice()\r\n\t\t\t{ ?>\r\n\t\t\t<div id=\"message\" class=\"updated fade\">\r\n\t\t\t\t<p style=\"line-height: 150%\">\r\n\t\t\t\t\t<strong>Welcome to Cincopa Rich Media Plugin</strong> - the most popular way to add videos, photo galleries, slideshows, Cooliris gallery, podcast and music to your site.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tOn every post page (above the text box) you'll find this <img src=\"<?php echo _cpmp_pluginURI() ?>/media-cincopa.gif\"  /> icon, click on it to start or use sidebar Widgets (Appearance menu).\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\r\n<input type=\"button\" class=\"button\" value=\"Cincopa Options Page\" onclick=\"document.location.href = 'options-general.php?page=cincopaoptions';\" />\r\n\r\n<input type=\"button\" class=\"button\" value=\"Hide this message\" onclick=\"document.location.href = 'options-general.php?page=cincopaoptions&amp;hide_note=welcome_notice';\" />\r\n\r\n<input type=\"button\" class=\"button\" value=\"Video Tutorial\" onclick=\"window.open('//help.cincopa.com/entries/488838-how-to-use-the-wordpress-plugin');\" />\r\n\r\n\t\t\t\t</p>\r\n\r\n\t\t\t</div>\r\n\r\n\r\n\t\t\t<?php\r\n\r\n\tif (get_site_option('cincopa_installed') != 'true')\r\n\t{\r\n\t\tupdate_site_option('cincopa_installed', 'true');\r\n\t\techo \"<img src='//goo.gl/HqSz' width=0 height=0 />\";\r\n\t}\r\n\r\n}\r\n\r\nadd_action( 'admin_footer-post-new.php', 'cincopa_mediaDefault_script' );\r\nadd_action( 'admin_footer-post.php', 'cincopa_mediaDefault_script' );\r\nadd_action( 'admin_footer-index.php', 'cincopa_mediaDefault_script' );\r\n\r\nfunction cincopa_mediaDefault_script()\r\n{\r\n\t?>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\tvar cincopa_popup_timer = null;\r\n\t\t\tfunction cincopa_launch_popup()\r\n\t\t\t{\r\n\t\t\t\tcincopa_popup_timer = setInterval(cincopa_check_popup, 200);\r\n\t\t\t}\r\n\r\n\t\t\tfunction cincopa_check_popup()\r\n\t\t\t{\r\n\t\t\t\tif (jQuery(\".media-menu-item:contains('Cincopa')\").closest('.supports-drag-drop').css('display') == 'none') \r\n\t\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\t\tif (jQuery(\".media-menu-item:contains('Cincopa')\").length > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tjQuery(\".media-menu-item:contains('Cincopa')\")[0].click();\r\n\t\t\t\t\tclearInterval(cincopa_popup_timer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t</script>\r\n\t<?php\r\n}"], "filenames": ["readme.txt", "wp-media-cincopa.php"], "buggy_code_start_loc": [3, 7], "buggy_code_end_loc": [4, 761], "fixing_code_start_loc": [3, 7], "fixing_code_end_loc": [4, 733], "type": "CWE-352", "message": "A vulnerability was found in Video Playlist and Gallery Plugin up to 1.136 on WordPress. It has been rated as problematic. Affected by this issue is some unknown functionality of the file wp-media-cincopa.php. The manipulation leads to cross-site request forgery. The attack may be launched remotely. Upgrading to version 1.137 is able to address this issue. The name of the patch is ee28e91f4d5404905204c43b7b84a8ffecad932e. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230264.", "other": {"cve": {"id": "CVE-2015-10109", "sourceIdentifier": "cna@vuldb.com", "published": "2023-06-01T13:15:10.180", "lastModified": "2023-06-08T18:13:52.147", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in Video Playlist and Gallery Plugin up to 1.136 on WordPress. It has been rated as problematic. Affected by this issue is some unknown functionality of the file wp-media-cincopa.php. The manipulation leads to cross-site request forgery. The attack may be launched remotely. Upgrading to version 1.137 is able to address this issue. The name of the patch is ee28e91f4d5404905204c43b7b84a8ffecad932e. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230264."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:cincopa:video_and_media_plug-in:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "1.137", "matchCriteriaId": "0A7FCCD3-DAD8-4594-8299-2B201D22BBCB"}]}]}], "references": [{"url": "https://github.com/wp-plugins/video-playlist-and-gallery-plugin/commit/ee28e91f4d5404905204c43b7b84a8ffecad932e", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/wp-plugins/video-playlist-and-gallery-plugin/releases/tag/1.137", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.230264", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.230264", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/video-playlist-and-gallery-plugin/commit/ee28e91f4d5404905204c43b7b84a8ffecad932e"}}