{"buggy_code": ["<!DOCTYPE HTML>\n<html <?php print lang_attributes(); ?>>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <?php $module_info = false;\n    if (isset($params['module'])): ?>\n        <?php $module_info = mw()->module_manager->get('one=1&ui=any&module=' . $params['module']); ?>\n    <?php endif; ?>\n\n    <script src=\"<?php print(mw()->template->get_apijs_combined_url()); ?>\"></script>\n    <script>\n        mw.lib.require('mwui');\n        mw.lib.require('mwui_init');\n    </script>\n\n    <script src=\"<?php print mw_includes_url(); ?>api/jquery-ui.js\"></script>\n\n    <?php template_stack_display('default'); ?>\n\n    <?php\n    template_stack_add(mw_includes_url() . 'default.css');\n    template_stack_add(mw_includes_url() . 'css/components.css');\n    template_stack_add(mw_includes_url() . 'css/admin.css');\n    template_stack_add(mw_includes_url() . 'css/admin-new.css');\n    template_stack_add(mw_includes_url() . 'css/fade-window.css');\n    template_stack_add(mw_includes_url() . 'css/popup.css');\n\n\n    template_stack_add(mw_includes_url() . 'api/instruments.js');\n    template_stack_add(mw_includes_url() . 'api/events.js');\n    template_stack_add(mw_includes_url() . 'api/url.js');\n\n    template_stack_add(mw_includes_url() . 'api/admin.js');\n    template_stack_add(mw_includes_url() . 'api/dialog.js');\n    template_stack_add(mw_includes_url() . 'api/liveadmin.js');\n    template_stack_add(mw_includes_url() . 'api/wysiwyg.js');\n    template_stack_add(mw_includes_url() . 'css/wysiwyg.css');\n    template_stack_add(mw_includes_url() . 'api/options.js');\n    ?>\n    <link type=\"text/css\" rel=\"stylesheet\" media=\"all\" href=\"<?php print(mw()->template->get_admin_system_ui_css_url()); ?>\"/>\n\n    <?php if (isset($params['live_edit_sidebar'])): ?>\n\n        <script type=\"text/javascript\">\n            window.live_edit_sidebar = true;\n        </script>\n    <?php endif; ?>\n\n\n    <script type=\"text/javascript\">\n        liveEditSettings = true;\n\n        <?php if(_lang_is_rtl()){ ?>\n        mw.require('<?php print mw_includes_url(); ?>css/rtl.css');\n        <?php } ?>\n\n        mw.lib.require('font_awesome5');\n    </script>\n\n\n    <style>\n        #settings-main {\n            min-height: 200px;\n            overflow-x: hidden;\n            /*padding: 10px 25px;*/\n        }\n\n        #settings-container {\n            overflow: hidden;\n            position: relative;\n            min-height: 300px;\n            padding: 25px;\n        }\n\n        #settings-container:after {\n            content: \".\";\n            display: block;\n            clear: both;\n            visibility: hidden;\n            line-height: 0;\n            height: 0;\n        }\n    </style>\n\n    <?php\n    $autoSize = true;\n    if (isset($_GET['autosize'])) {\n        $autoSize = $_GET['autosize'];\n    }\n\n    $type = '';\n    if (isset($_GET['type'])) {\n        $type = $_GET['type'];\n    }\n\n    $mod_id = $mod_orig_id = false;\n    $is_linked_mod = false;\n\n    if (isset($params['id'])) {\n        $mod_orig_id = $mod_id = $params['id'];\n    }\n\n    if (isset($params['data-module-original-id']) and $params['data-module-original-id']) {\n        $mod_orig_id = $params['data-module-original-id'];\n    }\n    if ($mod_id != $mod_orig_id) {\n        $is_linked_mod = true;\n    }\n    ?>\n\n    <script type=\"text/javascript\">\n        addIcon = function () {\n            if (window.thismodal && thismodal.main) {\n                var holder = $(\".mw_modal_toolbar\", thismodal.main);\n                if ($('.mw_modal_icon', holder).length === 0) {\n                    <?php if(is_array($module_info) and isset($module_info['icon'])) :  ?>\n                    holder.prepend('<span class=\"mw_modal_icon\"><img src=\"<?php print $module_info['icon']; ?>\"></span>')\n                    <?php endif; ?>\n                }\n            }\n        };\n        addIcon();\n\n        autoSize = <?php  print $autoSize; ?>;\n        settingsType = '<?php print $type; ?>';\n\n        window.onbeforeunload = function () {\n            $(document.body).addClass(\"mw-external-loading\")\n            window.parent.$('.module-modal-settings-menu-holder').remove();\n        };\n\n        mw_module_settings_info = \"\";\n        <?php if(is_array($module_info)): ?>\n\n        mw_module_settings_info = <?php print json_encode($module_info); ?>\n        <?php\n            $mpar = $params;\n            if (isset($mpar['module_settings'])) {\n                unset($mpar['module_settings']);\n            }\n            ?>\n\n            mw_module_params =\n        <?php print json_encode($mpar); ?>\n\n        <?php endif; ?>\n\n        if (typeof thismodal === 'undefined' && self !== parent && typeof this.name != 'undefined' && this.name != '') {\n            var frame = mw.parent().$('#' + this.name)[0];\n            thismodal = mw.parent().dialog.get(mw.tools.firstParentWithClass(frame, 'mw_modal'));\n        }\n\n\n        //var the_module_settings_frame = mw.parent().$('#' + this.name)[0];\n\n        if (typeof thismodal != 'undefined' && thismodal != false) {\n            var modal_title_str = '';\n            if (typeof(mw_module_settings_info.name) == \"undefined\") {\n                modal_title_str = \"<?php _ejs(\"Settings\"); ?>\"\n            } else {\n                modal_title_str = mw_module_settings_info.name;\n            }\n\n            var ex_title = $(thismodal.main).find(\".mw_modal_title\").html();\n\n            if (ex_title == '') {\n                $(thismodal.main).find(\".mw_modal_title\").html(modal_title_str + '');\n            }\n            if (thismodal.main && typeof thismodal.main.scrollTop == 'function') {\n                thismodal.main.scrollTop(0);\n            }\n\n            var icon = '';\n            if (mw_module_settings_info.icon) {\n                modal_title_str = ('<img class=\"mw-module-dialog-icon\" src=\"' + mw_module_settings_info.icon + '\">' + modal_title_str)\n            }\n\n            if (thismodal.title) {\n                thismodal.title(modal_title_str)\n            }\n\n\n        }\n\n        $(window).load(function () {\n            $(document.body).removeClass('mw-external-loading');\n            $(document.body).ajaxStop(function () {\n                $(document.body).removeClass('mw-external-loading');\n            });\n\n            addIcon();\n        });\n\n        $(window).load(function () {\n            // add dropdown\n\n\n            if (!window.thismodal && mw.top().win.module_settings_modal_reference_preset_editor_thismodal) {\n                window.thismodal = mw.top().win.module_settings_modal_reference_preset_editor_thismodal\n\n            }\n\n            if (window.thismodal) {\n\n                var toolbar = thismodal.dialogHeader;\n\n                var dd = document.createElement('div');\n                dd.className = 'mw-presets-dropdown module-modal-settings-menu-holder';\n                $(toolbar).append(dd);\n\n\n                mw.module_preset_linked_dd_menu_show_icon = function () {\n\n                    var is_module_preset_tml_holder = $(\".module-modal-preset-linked-icon\", toolbar);\n\n                    if (is_module_preset_tml_holder.length == 0) {\n                        var linked_dd = window.parent.document.createElement('div');\n                        // linked_dd.id = 'module-modal-preset-linked-icon';\n                        linked_dd.class = 'module-modal-preset-linked-icon';\n                        linked_dd.style.display = \"none\";\n                        $(toolbar).prepend(linked_dd);\n\n                    }\n\n                    is_module_preset_tml_holder = window.parent.$(\".module-modal-preset-linked-icon\");\n                    <?php if($is_linked_mod){  ?>\n                    $(\".module-modal-preset-linked-icon\", toolbar).addClass('is-linked').show();\n                    <?php  } else { ?>\n                    $(\".module-modal-preset-linked-icon\", toolbar).removeClass('is-linked').hide();\n\n                    <?php  } ?>\n                }\n\n\n                $(document).ready(function () {\n\n\n                    //   mw.top().win.module_settings_modal_reference = thismodal;\n                    <?php if(is_array($module_info) and isset($module_info['module'])): ?>\n\n                    <?php $mod_adm = admin_url('load_module:') . module_name_encode($module_info['module']); ?>\n\n                    var is_module_tml_holder = $(toolbar).find(\".module-modal-settings-menu-holder\");\n                    if (is_module_tml_holder.length > 0) {\n                        is_module_tml_holder.empty();\n\n\n                        var holder = document.createElement('div');\n                        holder.className = 'mw-module-presets-content';\n\n                        var html = \"\"\n                            + \"<div id='module-modal-settings-menu-items<?php print $params['id'] ?>' module_id='<?php print $params['id'] ?>' module_name='<?php print $module_info['module'] ?>'>\"\n                            + \"</div>\"\n                            + \"<hr>\"\n                            + \"<div class='module-modal-settings-menu-holder-2<?php print $params['id'] ?>'>\"\n                            + \"<a href='<?php print $mod_adm  ?>'><?php _e(\"Go to admin\"); ?></a></div>\";\n\n                        window.parent.modal_preset_manager_html_placeholder_for_reload = function () {\n                            modal_preset_manager_html_placeholder_for_reload_content = \"\"\n                                + \"<div id='module-modal-settings-menu-items-presets-holder<?php print $params['id'] ?>' module_id='<?php print $params['id'] ?>' module_name='<?php print $module_info['module'] ?>'>\"\n                                + \"</div>\";\n\n                            var presetsthismodalid = thismodal.id;\n\n\n                            // window.parent.module_settings_modal_reference_preset_editor_modal_id = presetsthismodalid;\n                            // window.parent.module_settings_modal_reference_window = top;\n\n                            mw.top().win.module_settings_modal_reference_preset_editor_modal_id = presetsthismodalid;\n                            mw.top().win.module_settings_modal_reference_preset_editor_thismodal = window.thismodal;\n                            mw.top().win.module_settings_modal_reference_window = window;\n\n\n                            //  alert(presetsthismodalid);\n\n\n                            window.parent.$('#module-modal-settings-menu-holder-open-presets').html('');\n                            window.parent.$('.module-modal-settings-menu-holder-open-presets').html('');\n\n                            // HERE FOR DROPDOWN\n                            window.parent.$('.module-modal-settings-menu-holder-open-presets', toolbar).html(modal_preset_manager_html_placeholder_for_reload_content);\n                        };\n\n                        var html = \"\"\n                            + \"<div class='mw-ui-btn-nav module-modal-settings-menu-content'>\" +\n                            \"<a class='mw-ui-btn mw-ui-btn-medium' href='javascript:window.mw.parent().tools.confirm_reset_module_by_id(\\\"<?php print $params['id'] ?>\\\");'>Reset module</a>\" +\n\n                            \"<a class='mw-ui-btn mw-ui-btn-medium' disabled-href='javascript:window.parent.modal_preset_manager_html_placeholder_for_reload();'>Presets</a>\" +\n\n\n                            \"</div>\"\n                            + \"<div class='module-modal-settings-menu-holder-open-presets' ></div>\";\n\n\n                        var dropdown = document.createElement('div');\n                        var dropdownContent = document.createElement('div');\n                        dropdownContent.className = 'mw-dropdown-content';\n                        dropdownContent.innerHTML = '<ul></ul>';\n                        dropdown.className = 'mw-dropdown mw-dropdown-default';\n                        dropdown.innerHTML = '<span class=\"mw-dropdown-value mw-ui-btn mw-ui-btn-small mw-dropdown-val css-preset-dropdown\"></span>';\n                        var btn = document.createElement('li');\n                        var btn2 = document.createElement('li');\n                        btn2.innerHTML = 'Reset module';\n                        // btn2.innerHTML = 'Reset module' +\"<br><small><?php print $params['id'] ?></small>\";\n\n                        btn2.onclick = function (ev) {\n                            window\n                                .parent\n                                .mw.tools.confirm_reset_module_by_id(\"<?php print $params['id'] ?>\");\n                        };\n                        dropdown.appendChild(dropdownContent);\n                        $('ul', dropdownContent)\n                            .append(btn)\n                            .append(btn2);\n\n\n                        btn.className = 'mw-module-presets-opener';\n                        btn.dataset.tipposition = 'bottom-right';\n                        //btn.innerHTML = '<svg class=\"icon\" height=\"30\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M736 576c-89.6 0-160 70.4-160 160s70.4 160 160 160 160-70.4 160-160-70.4-160-160-160z m96 192h-64v64h-64v-64h-64v-64h64v-64h64v64h64v64z\" fill=\"white\" /><path d=\"M256 291.2h384v64H256zM256 419.2h384v64H256zM640 550.4V544H256v64h313.6c19.2-22.4 44.8-41.6 70.4-57.6z\" fill=\"white\" /><path d=\"M531.2 768H192V192h512v339.2c9.6-3.2 22.4-3.2 32-3.2s22.4 0 32 3.2V160c0-19.2-12.8-32-32-32H160c-19.2 0-32 12.8-32 32v640c0 19.2 12.8 32 32 32h390.4c-9.6-19.2-16-41.6-19.2-64z\" fill=\"white\" /></svg>';\n                        btn.innerHTML = 'Presets';\n                        //$('.mw-module-presets-opener').on('click', function () {\n                        $(btn).on('click', function () {\n                            $(this).parent().toggleClass('active');\n\n\n                            var presets_mod = {};\n\n                            presets_mod.module_id = '<?php print $params['id'] ?>'\n                            presets_mod.module_name = '<?php print $params['module'] ?>'\n                            presets_mod.id = 'presets-<?php print $params['id'] ?>'\n                            //   presets_mod.mod_orig_id='<?php print $mod_orig_id ?>'\n                            //  var src = mw.settings.site_url + \"api/module?\" + json2url(presets_mod);\n                            var src = mw.settings.site_url + 'editor_tools/module_presets?' + json2url(presets_mod);\n                            var iframeid = 'frame-' + presets_mod.module_id;\n\n                            var mod_presets_iframe_html_fr = '' +\n                                '<div class=\"js-module-presets-edit-frame\">' +\n                                '<iframe id=\"' + iframeid + '\" src=\"' + src + '\" frameborder=\"0\" scrolling=\"no\" width=\"100%\" onload=\"this.parentNode.classList.remove(\\'loading\\')\"></iframe>' +\n                                '</div>';\n\n                            /*mw.parent().tooltip({\n                             close_on_click_outside: false,\n                             content: mod_presets_iframe_html_fr,\n                             position: 'bottom-right',\n                             element: mw.parent().$('#module-modal-settings-menu-items-presets-holder<?php print $params['id'] ?>')[0]\n                             });*/\n\n                            presetsDialogModal = mw.top().dialog({\n                                content: holder,\n                                width: 400,\n                                height: 'auto',\n                                id: 'dialog-' + iframeid,\n                                autoHeight: true,\n                                title: 'Presets'\n                            });\n                            mw.tools.loading(presetsDialogModal.dialogContainer, 90);\n\n\n                            $(presetsDialogModal.dialogContainer).html(mod_presets_iframe_html_fr);\n                            mw.top().$(\".mw-presets-dropdown .module\").removeClass('module');\n                            var frame = presetsDialogModal.dialogContainer.querySelector('iframe');\n                            mw.tools.iframeAutoHeight(frame);\n                            $(frame).on('load', function () {\n                                if (typeof(presetsDialogModal) !== 'undefined') {\n                                    if (typeof(presetsDialogModal.center) !== 'undefined') {\n                                        presetsDialogModal.center();\n                                    }\n                                    mw.tools.loading(presetsDialogModal.dialogContainer, false)\n                                }\n                            })\n\n                        });\n\n\n                        //var module_has_editable_parent = window.parent.$('#<?php print $params['id'] ?>');\n                        var module_has_editable_parent = window.parent.$('#<?php print $params['id'] ?>').parent();\n\n                        if (typeof(module_has_editable_parent[0]) != 'undefined' && window.mw.parent().tools.parentsOrCurrentOrderMatchOrOnlyFirst(module_has_editable_parent[0], ['edit', 'module'])) {\n\n                            $(holder).append(html);\n                            $(dd).prepend(dropdown);\n\n                            is_module_tml_holder.append(holder);\n                        }\n                    }\n\n                    window.parent.modal_preset_manager_html_placeholder_for_reload();\n                    mw.module_preset_linked_dd_menu_show_icon();\n\n\n\n                    mw.dropdown(mw.top().win.document);\n                    mw.dropdown();\n                    <?php endif; ?>\n                });\n            }\n        });\n\n\n        var settingsAction = function () {\n            var settings_container_mod_el = $('#settings-container');\n            mw.options.form(settings_container_mod_el, function () {\n                if (mw.notification) {\n                    mw.notification.success('<?php _ejs('Settings are saved') ?>');\n                }\n                mw.reload_module_parent('#<?php print $params['id']  ?>')\n\n            });\n\n            createAutoHeight()\n        };\n\n        var createAutoHeight = function () {\n            if (window.thismodal && thismodal.iframe) {\n                mw.tools.iframeAutoHeight(thismodal.iframe, 'now');\n            }\n            else if (mw.top().win.frameElement && mw.top().win.frameElement.contentWindow === window) {\n                mw.tools.iframeAutoHeight(mw.top().win.frameElement, 'now');\n            } else if (window.top !== window) {\n                mw.top().$('iframe').each(function () {\n                    try {\n                        if (this.contentWindow === window) {\n                            mw.tools.iframeAutoHeight(this, 'now');\n                        }\n                    } catch (e) {\n                    }\n                })\n            }\n        };\n\n\n    </script>\n\n\n\n\n\n\n</head>\n<body class=\"mw-external-loading loading\">\n<div id=\"settings-main\">\n    <div id=\"settings-container\">\n        <div class=\"mw-module-live-edit-settings <?php print $params['id'] ?>\"\n             id=\"module-id-<?php print $params['id'] ?>\">{content}\n        </div>\n    </div>\n</div>\n\n\n<form method=\"get\" id=\"mw_reload_this_module_popup_form\" style=\"display:none\">\n    <?php $mpar = $params;\n    if (isset($mpar['module_settings'])) {\n        unset($mpar['module_settings']);\n    }\n\n    ?>\n    <?php if (is_array($params)): ?>\n        <?php foreach ($params as $k => $item): ?>\n            <input type=\"text\" name=\"<?php print $k ?>\" value=\"<?php print $item ?>\"/>\n        <?php endforeach; ?>\n        <input type=\"submit\"/>\n    <?php endif; ?>\n</form>\n\n<script>\n    $(document).ready(function () {\n        settingsAction();\n    });\n\n\n    $(window).on('load', function () {\n\n        mw.interval('_settingsAutoHeight', function () {\n            if (document.querySelector('.mw-iframe-auto-height-detector') === null) {\n                createAutoHeight();\n            }\n        });\n\n    });\n\n\n</script>\n</body>\n</html>\n"], "fixing_code": ["<!DOCTYPE HTML>\n<html <?php print lang_attributes(); ?>>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <?php $module_info = false;\n    if (isset($params['module'])): ?>\n        <?php $module_info = mw()->module_manager->get('one=1&ui=any&module=' . $params['module']); ?>\n    <?php endif; ?>\n\n    <script src=\"<?php print(mw()->template->get_apijs_combined_url()); ?>\"></script>\n    <script>\n        mw.lib.require('mwui');\n        mw.lib.require('mwui_init');\n    </script>\n\n    <script src=\"<?php print mw_includes_url(); ?>api/jquery-ui.js\"></script>\n\n    <?php template_stack_display('default'); ?>\n\n    <?php\n    template_stack_add(mw_includes_url() . 'default.css');\n    template_stack_add(mw_includes_url() . 'css/components.css');\n    template_stack_add(mw_includes_url() . 'css/admin.css');\n    template_stack_add(mw_includes_url() . 'css/admin-new.css');\n    template_stack_add(mw_includes_url() . 'css/fade-window.css');\n    template_stack_add(mw_includes_url() . 'css/popup.css');\n\n\n    template_stack_add(mw_includes_url() . 'api/instruments.js');\n    template_stack_add(mw_includes_url() . 'api/events.js');\n    template_stack_add(mw_includes_url() . 'api/url.js');\n\n    template_stack_add(mw_includes_url() . 'api/admin.js');\n    template_stack_add(mw_includes_url() . 'api/dialog.js');\n    template_stack_add(mw_includes_url() . 'api/liveadmin.js');\n    template_stack_add(mw_includes_url() . 'api/wysiwyg.js');\n    template_stack_add(mw_includes_url() . 'css/wysiwyg.css');\n    template_stack_add(mw_includes_url() . 'api/options.js');\n    ?>\n    <link type=\"text/css\" rel=\"stylesheet\" media=\"all\" href=\"<?php print(mw()->template->get_admin_system_ui_css_url()); ?>\"/>\n\n    <?php if (isset($params['live_edit_sidebar'])): ?>\n\n        <script type=\"text/javascript\">\n            window.live_edit_sidebar = true;\n        </script>\n    <?php endif; ?>\n\n\n    <script type=\"text/javascript\">\n        liveEditSettings = true;\n\n        <?php if(_lang_is_rtl()){ ?>\n        mw.require('<?php print mw_includes_url(); ?>css/rtl.css');\n        <?php } ?>\n\n        mw.lib.require('font_awesome5');\n    </script>\n\n\n    <style>\n        #settings-main {\n            min-height: 200px;\n            overflow-x: hidden;\n            /*padding: 10px 25px;*/\n        }\n\n        #settings-container {\n            overflow: hidden;\n            position: relative;\n            min-height: 300px;\n            padding: 25px;\n        }\n\n        #settings-container:after {\n            content: \".\";\n            display: block;\n            clear: both;\n            visibility: hidden;\n            line-height: 0;\n            height: 0;\n        }\n    </style>\n\n    <?php\n    $autoSize = true;\n    if (isset($_GET['autosize'])) {\n        $autoSize = $_GET['autosize'];\n    }\n    $autoSize = xss_clean($autoSize);\n\n    $type = '';\n    if (isset($_GET['type'])) {\n        $type = $_GET['type'];\n    }\n    $type = xss_clean($type);\n\n    $mod_id = $mod_orig_id = false;\n    $is_linked_mod = false;\n\n    if (isset($params['id'])) {\n        $mod_orig_id = $mod_id = $params['id'];\n    }\n\n    if (isset($params['data-module-original-id']) and $params['data-module-original-id']) {\n        $mod_orig_id = $params['data-module-original-id'];\n    }\n    if ($mod_id != $mod_orig_id) {\n        $is_linked_mod = true;\n    }\n    ?>\n\n    <script type=\"text/javascript\">\n        addIcon = function () {\n            if (window.thismodal && thismodal.main) {\n                var holder = $(\".mw_modal_toolbar\", thismodal.main);\n                if ($('.mw_modal_icon', holder).length === 0) {\n                    <?php if(is_array($module_info) and isset($module_info['icon'])) :  ?>\n                    holder.prepend('<span class=\"mw_modal_icon\"><img src=\"<?php print $module_info['icon']; ?>\"></span>')\n                    <?php endif; ?>\n                }\n            }\n        };\n        addIcon();\n\n        autoSize = <?php  print $autoSize; ?>;\n        settingsType = '<?php print $type; ?>';\n\n        window.onbeforeunload = function () {\n            $(document.body).addClass(\"mw-external-loading\")\n            window.parent.$('.module-modal-settings-menu-holder').remove();\n        };\n\n        mw_module_settings_info = \"\";\n        <?php if(is_array($module_info)): ?>\n\n        mw_module_settings_info = <?php print json_encode($module_info); ?>\n        <?php\n            $mpar = $params;\n            if (isset($mpar['module_settings'])) {\n                unset($mpar['module_settings']);\n            }\n            ?>\n\n            mw_module_params =\n        <?php print json_encode($mpar); ?>\n\n        <?php endif; ?>\n\n        if (typeof thismodal === 'undefined' && self !== parent && typeof this.name != 'undefined' && this.name != '') {\n            var frame = mw.parent().$('#' + this.name)[0];\n            thismodal = mw.parent().dialog.get(mw.tools.firstParentWithClass(frame, 'mw_modal'));\n        }\n\n\n        //var the_module_settings_frame = mw.parent().$('#' + this.name)[0];\n\n        if (typeof thismodal != 'undefined' && thismodal != false) {\n            var modal_title_str = '';\n            if (typeof(mw_module_settings_info.name) == \"undefined\") {\n                modal_title_str = \"<?php _ejs(\"Settings\"); ?>\"\n            } else {\n                modal_title_str = mw_module_settings_info.name;\n            }\n\n            var ex_title = $(thismodal.main).find(\".mw_modal_title\").html();\n\n            if (ex_title == '') {\n                $(thismodal.main).find(\".mw_modal_title\").html(modal_title_str + '');\n            }\n            if (thismodal.main && typeof thismodal.main.scrollTop == 'function') {\n                thismodal.main.scrollTop(0);\n            }\n\n            var icon = '';\n            if (mw_module_settings_info.icon) {\n                modal_title_str = ('<img class=\"mw-module-dialog-icon\" src=\"' + mw_module_settings_info.icon + '\">' + modal_title_str)\n            }\n\n            if (thismodal.title) {\n                thismodal.title(modal_title_str)\n            }\n\n\n        }\n\n        $(window).load(function () {\n            $(document.body).removeClass('mw-external-loading');\n            $(document.body).ajaxStop(function () {\n                $(document.body).removeClass('mw-external-loading');\n            });\n\n            addIcon();\n        });\n\n        $(window).load(function () {\n            // add dropdown\n\n\n            if (!window.thismodal && mw.top().win.module_settings_modal_reference_preset_editor_thismodal) {\n                window.thismodal = mw.top().win.module_settings_modal_reference_preset_editor_thismodal\n\n            }\n\n            if (window.thismodal) {\n\n                var toolbar = thismodal.dialogHeader;\n\n                var dd = document.createElement('div');\n                dd.className = 'mw-presets-dropdown module-modal-settings-menu-holder';\n                $(toolbar).append(dd);\n\n\n                mw.module_preset_linked_dd_menu_show_icon = function () {\n\n                    var is_module_preset_tml_holder = $(\".module-modal-preset-linked-icon\", toolbar);\n\n                    if (is_module_preset_tml_holder.length == 0) {\n                        var linked_dd = window.parent.document.createElement('div');\n                        // linked_dd.id = 'module-modal-preset-linked-icon';\n                        linked_dd.class = 'module-modal-preset-linked-icon';\n                        linked_dd.style.display = \"none\";\n                        $(toolbar).prepend(linked_dd);\n\n                    }\n\n                    is_module_preset_tml_holder = window.parent.$(\".module-modal-preset-linked-icon\");\n                    <?php if($is_linked_mod){  ?>\n                    $(\".module-modal-preset-linked-icon\", toolbar).addClass('is-linked').show();\n                    <?php  } else { ?>\n                    $(\".module-modal-preset-linked-icon\", toolbar).removeClass('is-linked').hide();\n\n                    <?php  } ?>\n                }\n\n\n                $(document).ready(function () {\n\n\n                    //   mw.top().win.module_settings_modal_reference = thismodal;\n                    <?php if(is_array($module_info) and isset($module_info['module'])): ?>\n\n                    <?php $mod_adm = admin_url('load_module:') . module_name_encode($module_info['module']); ?>\n\n                    var is_module_tml_holder = $(toolbar).find(\".module-modal-settings-menu-holder\");\n                    if (is_module_tml_holder.length > 0) {\n                        is_module_tml_holder.empty();\n\n\n                        var holder = document.createElement('div');\n                        holder.className = 'mw-module-presets-content';\n\n                        var html = \"\"\n                            + \"<div id='module-modal-settings-menu-items<?php print $params['id'] ?>' module_id='<?php print $params['id'] ?>' module_name='<?php print $module_info['module'] ?>'>\"\n                            + \"</div>\"\n                            + \"<hr>\"\n                            + \"<div class='module-modal-settings-menu-holder-2<?php print $params['id'] ?>'>\"\n                            + \"<a href='<?php print $mod_adm  ?>'><?php _e(\"Go to admin\"); ?></a></div>\";\n\n                        window.parent.modal_preset_manager_html_placeholder_for_reload = function () {\n                            modal_preset_manager_html_placeholder_for_reload_content = \"\"\n                                + \"<div id='module-modal-settings-menu-items-presets-holder<?php print $params['id'] ?>' module_id='<?php print $params['id'] ?>' module_name='<?php print $module_info['module'] ?>'>\"\n                                + \"</div>\";\n\n                            var presetsthismodalid = thismodal.id;\n\n\n                            // window.parent.module_settings_modal_reference_preset_editor_modal_id = presetsthismodalid;\n                            // window.parent.module_settings_modal_reference_window = top;\n\n                            mw.top().win.module_settings_modal_reference_preset_editor_modal_id = presetsthismodalid;\n                            mw.top().win.module_settings_modal_reference_preset_editor_thismodal = window.thismodal;\n                            mw.top().win.module_settings_modal_reference_window = window;\n\n\n                            //  alert(presetsthismodalid);\n\n\n                            window.parent.$('#module-modal-settings-menu-holder-open-presets').html('');\n                            window.parent.$('.module-modal-settings-menu-holder-open-presets').html('');\n\n                            // HERE FOR DROPDOWN\n                            window.parent.$('.module-modal-settings-menu-holder-open-presets', toolbar).html(modal_preset_manager_html_placeholder_for_reload_content);\n                        };\n\n                        var html = \"\"\n                            + \"<div class='mw-ui-btn-nav module-modal-settings-menu-content'>\" +\n                            \"<a class='mw-ui-btn mw-ui-btn-medium' href='javascript:window.mw.parent().tools.confirm_reset_module_by_id(\\\"<?php print $params['id'] ?>\\\");'>Reset module</a>\" +\n\n                            \"<a class='mw-ui-btn mw-ui-btn-medium' disabled-href='javascript:window.parent.modal_preset_manager_html_placeholder_for_reload();'>Presets</a>\" +\n\n\n                            \"</div>\"\n                            + \"<div class='module-modal-settings-menu-holder-open-presets' ></div>\";\n\n\n                        var dropdown = document.createElement('div');\n                        var dropdownContent = document.createElement('div');\n                        dropdownContent.className = 'mw-dropdown-content';\n                        dropdownContent.innerHTML = '<ul></ul>';\n                        dropdown.className = 'mw-dropdown mw-dropdown-default';\n                        dropdown.innerHTML = '<span class=\"mw-dropdown-value mw-ui-btn mw-ui-btn-small mw-dropdown-val css-preset-dropdown\"></span>';\n                        var btn = document.createElement('li');\n                        var btn2 = document.createElement('li');\n                        btn2.innerHTML = 'Reset module';\n                        // btn2.innerHTML = 'Reset module' +\"<br><small><?php print $params['id'] ?></small>\";\n\n                        btn2.onclick = function (ev) {\n                            window\n                                .parent\n                                .mw.tools.confirm_reset_module_by_id(\"<?php print $params['id'] ?>\");\n                        };\n                        dropdown.appendChild(dropdownContent);\n                        $('ul', dropdownContent)\n                            .append(btn)\n                            .append(btn2);\n\n\n                        btn.className = 'mw-module-presets-opener';\n                        btn.dataset.tipposition = 'bottom-right';\n                        //btn.innerHTML = '<svg class=\"icon\" height=\"30\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M736 576c-89.6 0-160 70.4-160 160s70.4 160 160 160 160-70.4 160-160-70.4-160-160-160z m96 192h-64v64h-64v-64h-64v-64h64v-64h64v64h64v64z\" fill=\"white\" /><path d=\"M256 291.2h384v64H256zM256 419.2h384v64H256zM640 550.4V544H256v64h313.6c19.2-22.4 44.8-41.6 70.4-57.6z\" fill=\"white\" /><path d=\"M531.2 768H192V192h512v339.2c9.6-3.2 22.4-3.2 32-3.2s22.4 0 32 3.2V160c0-19.2-12.8-32-32-32H160c-19.2 0-32 12.8-32 32v640c0 19.2 12.8 32 32 32h390.4c-9.6-19.2-16-41.6-19.2-64z\" fill=\"white\" /></svg>';\n                        btn.innerHTML = 'Presets';\n                        //$('.mw-module-presets-opener').on('click', function () {\n                        $(btn).on('click', function () {\n                            $(this).parent().toggleClass('active');\n\n\n                            var presets_mod = {};\n\n                            presets_mod.module_id = '<?php print $params['id'] ?>'\n                            presets_mod.module_name = '<?php print $params['module'] ?>'\n                            presets_mod.id = 'presets-<?php print $params['id'] ?>'\n                            //   presets_mod.mod_orig_id='<?php print $mod_orig_id ?>'\n                            //  var src = mw.settings.site_url + \"api/module?\" + json2url(presets_mod);\n                            var src = mw.settings.site_url + 'editor_tools/module_presets?' + json2url(presets_mod);\n                            var iframeid = 'frame-' + presets_mod.module_id;\n\n                            var mod_presets_iframe_html_fr = '' +\n                                '<div class=\"js-module-presets-edit-frame\">' +\n                                '<iframe id=\"' + iframeid + '\" src=\"' + src + '\" frameborder=\"0\" scrolling=\"no\" width=\"100%\" onload=\"this.parentNode.classList.remove(\\'loading\\')\"></iframe>' +\n                                '</div>';\n\n                            /*mw.parent().tooltip({\n                             close_on_click_outside: false,\n                             content: mod_presets_iframe_html_fr,\n                             position: 'bottom-right',\n                             element: mw.parent().$('#module-modal-settings-menu-items-presets-holder<?php print $params['id'] ?>')[0]\n                             });*/\n\n                            presetsDialogModal = mw.top().dialog({\n                                content: holder,\n                                width: 400,\n                                height: 'auto',\n                                id: 'dialog-' + iframeid,\n                                autoHeight: true,\n                                title: 'Presets'\n                            });\n                            mw.tools.loading(presetsDialogModal.dialogContainer, 90);\n\n\n                            $(presetsDialogModal.dialogContainer).html(mod_presets_iframe_html_fr);\n                            mw.top().$(\".mw-presets-dropdown .module\").removeClass('module');\n                            var frame = presetsDialogModal.dialogContainer.querySelector('iframe');\n                            mw.tools.iframeAutoHeight(frame);\n                            $(frame).on('load', function () {\n                                if (typeof(presetsDialogModal) !== 'undefined') {\n                                    if (typeof(presetsDialogModal.center) !== 'undefined') {\n                                        presetsDialogModal.center();\n                                    }\n                                    mw.tools.loading(presetsDialogModal.dialogContainer, false)\n                                }\n                            })\n\n                        });\n\n\n                        //var module_has_editable_parent = window.parent.$('#<?php print $params['id'] ?>');\n                        var module_has_editable_parent = window.parent.$('#<?php print $params['id'] ?>').parent();\n\n                        if (typeof(module_has_editable_parent[0]) != 'undefined' && window.mw.parent().tools.parentsOrCurrentOrderMatchOrOnlyFirst(module_has_editable_parent[0], ['edit', 'module'])) {\n\n                            $(holder).append(html);\n                            $(dd).prepend(dropdown);\n\n                            is_module_tml_holder.append(holder);\n                        }\n                    }\n\n                    window.parent.modal_preset_manager_html_placeholder_for_reload();\n                    mw.module_preset_linked_dd_menu_show_icon();\n\n\n\n                    mw.dropdown(mw.top().win.document);\n                    mw.dropdown();\n                    <?php endif; ?>\n                });\n            }\n        });\n\n\n        var settingsAction = function () {\n            var settings_container_mod_el = $('#settings-container');\n            mw.options.form(settings_container_mod_el, function () {\n                if (mw.notification) {\n                    mw.notification.success('<?php _ejs('Settings are saved') ?>');\n                }\n                <?php if (isset($params['id'])) : ?>\n                mw.reload_module_parent('#<?php print $params['id']  ?>')\n                <?php endif; ?>\n\n            });\n\n            createAutoHeight()\n        };\n\n        var createAutoHeight = function () {\n            if (window.thismodal && thismodal.iframe) {\n                mw.tools.iframeAutoHeight(thismodal.iframe, 'now');\n            }\n            else if (mw.top().win.frameElement && mw.top().win.frameElement.contentWindow === window) {\n                mw.tools.iframeAutoHeight(mw.top().win.frameElement, 'now');\n            } else if (window.top !== window) {\n                mw.top().$('iframe').each(function () {\n                    try {\n                        if (this.contentWindow === window) {\n                            mw.tools.iframeAutoHeight(this, 'now');\n                        }\n                    } catch (e) {\n                    }\n                })\n            }\n        };\n\n\n    </script>\n\n\n\n\n\n\n</head>\n<body class=\"mw-external-loading loading\">\n<div id=\"settings-main\">\n    <div id=\"settings-container\">\n        <?php if (isset($params['id'])) : ?>\n            <div class=\"mw-module-live-edit-settings <?php print $params['id'] ?>\"\n                 id=\"module-id-<?php print $params['id'] ?>\">{content}\n            </div>\n        <?php endif; ?>\n    </div>\n</div>\n\n\n<form method=\"get\" id=\"mw_reload_this_module_popup_form\" style=\"display:none\">\n    <?php $mpar = $params;\n    if (isset($mpar['module_settings'])) {\n        unset($mpar['module_settings']);\n    }\n\n    ?>\n    <?php if (is_array($params)): ?>\n        <?php foreach ($params as $k => $item): ?>\n            <input type=\"text\" name=\"<?php print $k ?>\" value=\"<?php print $item ?>\"/>\n        <?php endforeach; ?>\n        <input type=\"submit\"/>\n    <?php endif; ?>\n</form>\n\n<script>\n    $(document).ready(function () {\n        settingsAction();\n    });\n\n\n    $(window).on('load', function () {\n\n        mw.interval('_settingsAutoHeight', function () {\n            if (document.querySelector('.mw-iframe-auto-height-detector') === null) {\n                createAutoHeight();\n            }\n        });\n\n    });\n\n\n</script>\n</body>\n</html>\n"], "filenames": ["userfiles/modules/microweber/toolbar/editor_tools/module_settings/index.php"], "buggy_code_start_loc": [89], "buggy_code_end_loc": [446], "fixing_code_start_loc": [90], "fixing_code_end_loc": [452], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Reflected in GitHub repository microweber/microweber prior to 1.2.18.", "other": {"cve": {"id": "CVE-2022-2174", "sourceIdentifier": "security@huntr.dev", "published": "2022-06-22T12:15:08.130", "lastModified": "2022-06-28T21:44:09.160", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Reflected in GitHub repository microweber/microweber prior to 1.2.18."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross-site Scripting (XSS) - Reflejo en el repositorio de GitHub microweber/microweber versiones anteriores a 1.2.18"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 2.5}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:microweber:microweber:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.2.18", "matchCriteriaId": "8B4ED391-51EA-4930-AC76-9896407330E5"}]}]}], "references": [{"url": "https://github.com/microweber/microweber/commit/c51285f791e48e536111cd57a9544ccbf7f33961", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/ac68e3fc-8cf1-4a62-90ee-95c4b2bad607", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/microweber/microweber/commit/c51285f791e48e536111cd57a9544ccbf7f33961"}}