{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2018\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tJames Rose <james.o.rose@gmail.com>\n*/\n//includes\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('system_status_sofia_status')\n\t\t|| permission_exists('system_status_sofia_status_profile')\n\t\t|| if_group(\"superadmin\")) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//define variables\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\nif ($_GET['a'] == \"download\") {\n\tif ($_GET['t'] == \"cdrcsv\") {\n\t\t$tmp = $_SESSION['switch']['log']['dir'].'/cdr-csv/';\n\t\t$filename = 'Master.csv';\n\t}\n\tif ($_GET['t'] == \"backup\") {\n\t\t$tmp = $backup_dir.'/';\n\t\t$filename = 'backup.tgz';\n\t\tif (!is_dir($backup_dir.'/')) {\n\t\t\texec(\"mkdir \".$backup_dir.\"/\");\n\t\t}\n\t\t$parent_dir = realpath($_SESSION['switch']['base']['dir'].\"/..\");\n\t\tchdir($parent_dir);\n\t\tshell_exec('tar cvzf freeswitch '.$backup_dir.'/backup.tgz');\n\t}\n\tsession_cache_limiter('public');\n\t$fd = fopen($tmp.$filename, \"rb\");\n\theader(\"Content-Type: binary/octet-stream\");\n\theader(\"Content-Length: \" . filesize($tmp.$filename));\n\theader('Content-Disposition: attachment; filename=\"'.$filename.'\"');\n\tfpassthru($fd);\n\texit;\n}\n\n//show the content\n\trequire_once \"resources/header.php\";\n\t$document['title'] = $text['title-sip-status'];\n\n\t$msg = $_GET[\"savemsg\"];\n\tif ($_SESSION['event_socket_ip_address'] == \"0.0.0.0\") {\n\t\t$socket_ip = '127.0.0.1';\n\t\t$fp = event_socket_create($socket_ip, $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\n\t} else {\n\t\t$fp = event_socket_create($_SESSION['event_socket_ip_address'], $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\n\t}\n\tif (!$fp) {\n\t\t$msg = \"<div align='center'>\".$text['error-event-socket'].\"<br /></div>\";\n\t}\n\tif (strlen($msg) > 0) {\n\t\techo \"<div align='center'>\\n\";\n\t\techo \"<table width='40%'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<th align='left'>\".$text['label-message'].\"</th>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td class='row_style1'><strong>\".escape($msg).\"</strong></td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\t\techo \"</div>\\n\";\n\t}\n\n//get the gateways\n\t$sql = \"select g.domain_uuid, g.gateway, g.gateway_uuid, d.domain_name \";\n\t$sql .= \"from v_gateways as g left \";\n\t$sql .= \"outer join v_domains as d on d.domain_uuid = g.domain_uuid\";\n\t$database = new database;\n\t$gateways = $database->select($sql, null, 'all');\n\tunset($sql);\n\n\tif ($fp) {\n\t\t$hostname = trim(event_socket_request($fp, 'api switchname'));\n\t}\n\n//get the sip profiles\n\t$sql = \"select sip_profile_name from v_sip_profiles \";\n\t$sql .= \"where sip_profile_enabled = 'true' \";\n\tif ($hostname) {\n\t\t$sql .= \"and (sip_profile_hostname = :sip_profile_hostname \";\n\t\t$sql .= \"or sip_profile_hostname = '' \";\n\t\t$sql .= \"or sip_profile_hostname is null) \";\n\t\t$parameters['sip_profile_hostname'] = $hostname;\n\t}\n\t$sql .= \"order by sip_profile_name asc \";\n\t$database = new database;\n\t$sip_profiles = $database->select($sql, (is_array($parameters) && @sizeof($parameters) != 0 ? $parameters : null), 'all');\n\tunset($sql, $parameters);\n\n//sofia status\n\tif ($fp && permission_exists('system_status_sofia_status')) {\n\t\t$cmd = \"api sofia xmlstatus\";\n\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\ttry {\n\t\t\t$xml = new SimpleXMLElement($xml_response);\n\t\t}\n\t\tcatch(Exception $e) {\n\t\t\techo $e->getMessage();\n\t\t}\n\t\t$cmd = \"api sofia xmlstatus gateway\";\n\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\ttry {\n\t\t\t$xml_gateways = new SimpleXMLElement($xml_response);\n\t\t}\n\t\tcatch(Exception $e) {\n\t\t\techo $e->getMessage();\n\t\t}\n\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td width='50%'>\\n\";\n\t\techo \"\t<b>\".$text['header-sip-status'].\"</b>\";\n\t\techo \"\t<br><br>\";\n\t\techo \"</td>\\n\";\n\t\techo \"<td width='50%' align='right'>\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-flush_cache'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+cache+flush';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-reload_acl'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+reloadacl';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-reload_xml'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+reloadxml';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-refresh'].\"' onclick=\\\"document.location.href='sip_status.php';\\\" />\\n\";\n\t\techo \"</td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\n\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0' style='margin-bottom: 10px;'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td><b><a href='javascript:void(0);' onclick=\\\"$('#sofia_status').slideToggle();\\\">\".$text['title-sofia-status'].\"</a></b></td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\n\t\techo \"<div id='sofia_status' style='margin-top: 20px; margin-bottom: 30px;'>\";\n\t\techo \"<table width='100%' cellspacing='0' border='0'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<th>\".$text['label-name'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-type'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-data'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-state'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-action'].\"</th>\\n\";\n\t\techo \"</tr>\\n\";\n\t\tforeach ($xml->profile as $row) {\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->name).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->type).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->data).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>&nbsp;</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\tforeach ($xml_gateways->gateway as $row) {\n\t\t\t$gateway_name = '';\n\t\t\t$gateway_domain_name = '';\n\t\t\tforeach($gateways as $field) {\n\t\t\t\tif ($field[\"gateway_uuid\"] == strtolower($row->name)) {\n\t\t\t\t\t$gateway_name = $field[\"gateway\"];\n\t\t\t\t\t$gateway_domain_name = $field[\"domain_name\"];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\";\n\t\t\tif ($_SESSION[\"domain_name\"] == $gateway_domain_name) {\n\t\t\t\techo \"<a href='\".PROJECT_PATH.\"/app/gateways/gateway_edit.php?id=\".strtolower(escape($row->name)).\"'>\".escape($gateway_name).\"@\".escape($gateway_domain_name).\"</a>\";\n\t\t\t}\n\t\t\telse if ($gateway_domain_name == '') {\n\t\t\t\techo $gateway_name ? $gateway_name : $row->name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\techo $gateway_name.\"@\".$gateway_domain_name;\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>Gateway</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->to).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'><a onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($row->profile).\"+killgw+\".escape($row->name).\"';\\\" />\".$text['button-stop'].\"</a></td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\tforeach ($xml->alias as $row) {\n\t\t\t//print_r($row);\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->name).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->type).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->data).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>&nbsp;</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\techo \"</table>\\n\";\n\t\techo \"</div>\\n\";\n\t\tunset($xml);\n\t}\n\n//sofia status profile\n\tif (permission_exists('system_status_sofia_status_profile')) {\n\t\tforeach ($sip_profiles as $row) {\n\t\t\t$sip_profile_name = $row[\"sip_profile_name\"];\n\n\t\t\tif ($fp) {\n\t\t\t\t$cmd = \"api sofia xmlstatus profile \".$sip_profile_name.\"\";\n\t\t\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\t\t\tif ($xml_response == \"Invalid Profile!\") {\n\t\t\t\t\t$xml_response = \"<error_msg>Invalid Profile!</error_msg>\";\n\t\t\t\t\t$profile_state = 'stopped';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$profile_state = 'running';\n\t\t\t\t}\n\t\t\t\t$xml_response = str_replace(\"<profile-info>\", \"<profile_info>\", $xml_response);\n\t\t\t\t$xml_response = str_replace(\"</profile-info>\", \"</profile_info>\", $xml_response);\n\t\t\t\ttry {\n\t\t\t\t\t$xml = new SimpleXMLElement($xml_response);\n\t\t\t\t}\n\t\t\t\tcatch(Exception $e) {\n\t\t\t\t\techo $e->getMessage();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0' style='margin-bottom: 10px;'>\\n\";\n\t\t\t\techo \"<tr>\\n\";\n\t\t\t\techo \"<td width='100%'>\\n\";\n\t\t\t\techo \"  <b><a href='javascript:void(0);' onclick=\\\"$('#\".escape($sip_profile_name).\"').slideToggle();\\\">\".$text['title-sofia-status-profile'].\" \".escape($sip_profile_name).\"</a></b> \\n\";\n\t\t\t\techo \"</td>\\n\";\n\t\t\t\techo \"<td align='right' nowrap>\\n\";\n\t\t\t\tif ($sip_profile_name != \"external\") {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-flush_registrations'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+flush_inbound_reg';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-registrations'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/registrations/registrations.php?show_reg=1&profile=\".escape($sip_profile_name).\"';\\\" />\\n\";\n\t\t\t\tif ($profile_state == 'stopped') {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-start'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+start';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\tif ($profile_state == 'running') {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-stop'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+stop';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-restart'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+restart';\\\" />\\n\";\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-rescan'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+rescan';\\\" />\\n\";\n\t\t\t\techo \"</td>\\n\";\n\t\t\t\techo \"</tr>\\n\";\n\t\t\t\techo \"</table>\\n\";\n\n\t\t\t\techo \"<div id='\".escape($sip_profile_name).\"' style='display: none; margin-bottom: 30px;'>\";\n\t\t\t\techo \"<table width='100%' cellspacing='0' cellpadding='5'>\\n\";\n\t\t\t\techo \"<tr>\\n\";\n\t\t\t\techo \"<th width='20%'>&nbsp;</th>\\n\";\n\t\t\t\techo \"<th>&nbsp;</th>\\n\";\n\t\t\t\techo \"</tr>\\n\";\n\n\t\t\t\tforeach ($xml->profile_info as $row) {\n\t\t\t\t\techo \"\t<tr><td class='vncell'>name</td><td class='vtable'>&nbsp; &nbsp;\".escape($row->name).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>domain-name</td><td class='vtable'>&nbsp; &nbsp;\".escape($row->{'domain-name'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>auto-nat</td><td class='vtable'>&nbsp;\".escape($row->{'auto-nat'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>db-name</td><td class='vtable'>&nbsp;\".escape($row->{'db-name'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>pres-hosts</td><td class='vtable'>&nbsp;\".escape($row->{'pres-hosts'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>dialplan</td><td class='vtable'>&nbsp;\".escape($row->dialplan).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>context</td><td class='vtable'>&nbsp;\".escape($row->context).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>challenge-realm</td><td class='vtable'>&nbsp;\".escape($row->{'challenge-realm'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>rtp-ip</td><td class='vtable'>&nbsp;\".escape($row->{'rtp-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>ext-rtp-ip</td><td class='vtable'>&nbsp;\".escape($row->{'ext-rtp-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>sip-ip</td><td class='vtable'>&nbsp;\".escape($row->{'sip-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>ext-sip-ip</td><td class='vtable'>&nbsp;\".escape($row->{'ext-sip-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>url</td><td class='vtable'>&nbsp;\".escape($row->url).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>bind-url</td><td class='vtable'>&nbsp;\".escape($row->{'bind-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tls-url</td><td class='vtable'>&nbsp;\".escape($row->{'tls-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tls-bind-url</td><td class='vtable'>&nbsp;\".escape($row->{'tls-bind-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>hold-music</td><td class='vtable'>&nbsp;\".escape($row->{'hold-music'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>outbound-proxy</td><td class='vtable'>&nbsp;\".escape($row->{'outbound-proxy'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>inbound-codecs</td><td class='vtable'>&nbsp;\".escape($row->{'inbound-codecs'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>outbound-codecs</td><td class='vtable'>&nbsp;\".$row->{'outbound-codecs'}.\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tel-event</td><td class='vtable'>&nbsp;\".escape($row->{'tel-event'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>dtmf-mode</td><td class='vtable'>&nbsp;\".escape($row->{'dtmf-mode'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>cng</td><td class='vtable'>&nbsp;\".escape($row->cng).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>session-to</td><td class='vtable'>&nbsp;\".escape($row->{'session-to'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>max-dialog</td><td class='vtable'>&nbsp;\".escape($row->{'max-dialog'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>nomedia</td><td class='vtable'>&nbsp;\".escape($row->{'nomedia'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>late-neg</td><td class='vtable'>&nbsp;\".escape($row->{'late-neg'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>proxy-media</td><td class='vtable'>&nbsp;\".escape($row->{'proxy-media'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>aggressive-nat</td><td class='vtable'>&nbsp;\".escape($row->{'aggressive-nat'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>stun-enabled</td><td class='vtable'>&nbsp;\".escape($row->{'stun-enabled'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>stun-auto-disable</td><td class='vtable'>&nbsp;\".escape($row->{'stun-auto-disable'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>user-agent-filter</td><td class='vtable'>&nbsp;\".escape($row->{'user-agent-filter'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>max-registrations-per-extension</td><td class='vtable'>&nbsp;\".escape($row->{'max-registrations-per-extension'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>calls-in</td><td class='vtable'>&nbsp;\".escape($row->{'calls-in'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>calls-out</td><td class='vtable'>&nbsp;\".escape($row->{'calls-out'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>failed-calls-in</td><td class='vtable'>&nbsp;\".escape($row->{'failed-calls-in'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>failed-calls-out</td><td class='vtable'>&nbsp;\".escape($row->{'failed-calls-out'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t}\n\t\t\t\techo \"</table>\\n\";\n\t\t\t\techo \"</div>\";\n\t\t\t\tunset($xml);\n\t\t\t}\n\t\t}\n\t}\n\n//status\n\tif ($fp && permission_exists('sip_status_switch_status')) {\n\t\t$cmd = \"api status\";\n\t\t$response = event_socket_request($fp, $cmd);\n\t\techo \"<b><a href='javascript:void(0);' onclick=\\\"$('#status').slideToggle();\\\">\".$text['title-status'].\"</a></b>\\n\";\n\t\techo \"<div id='status' style='margin-top: 20px; font-size: 9pt;'>\";\n\t\techo \"<pre>\";\n\t\techo trim(escape($response));\n\t\techo \"</pre>\\n\";\n\t\techo \"</div>\";\n\t\tfclose($fp);\n\t}\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2018\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tJames Rose <james.o.rose@gmail.com>\n*/\n//includes\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('system_status_sofia_status')\n\t\t|| permission_exists('system_status_sofia_status_profile')\n\t\t|| if_group(\"superadmin\")) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//define variables\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the content\n\trequire_once \"resources/header.php\";\n\t$document['title'] = $text['title-sip-status'];\n\n\t$msg = $_GET[\"savemsg\"];\n\tif ($_SESSION['event_socket_ip_address'] == \"0.0.0.0\") {\n\t\t$socket_ip = '127.0.0.1';\n\t\t$fp = event_socket_create($socket_ip, $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\n\t} else {\n\t\t$fp = event_socket_create($_SESSION['event_socket_ip_address'], $_SESSION['event_socket_port'], $_SESSION['event_socket_password']);\n\t}\n\tif (!$fp) {\n\t\t$msg = \"<div align='center'>\".$text['error-event-socket'].\"<br /></div>\";\n\t}\n\tif (strlen($msg) > 0) {\n\t\techo \"<div align='center'>\\n\";\n\t\techo \"<table width='40%'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<th align='left'>\".$text['label-message'].\"</th>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td class='row_style1'><strong>\".escape($msg).\"</strong></td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\t\techo \"</div>\\n\";\n\t}\n\n//get the gateways\n\t$sql = \"select g.domain_uuid, g.gateway, g.gateway_uuid, d.domain_name \";\n\t$sql .= \"from v_gateways as g left \";\n\t$sql .= \"outer join v_domains as d on d.domain_uuid = g.domain_uuid\";\n\t$database = new database;\n\t$gateways = $database->select($sql, null, 'all');\n\tunset($sql);\n\n\tif ($fp) {\n\t\t$hostname = trim(event_socket_request($fp, 'api switchname'));\n\t}\n\n//get the sip profiles\n\t$sql = \"select sip_profile_name from v_sip_profiles \";\n\t$sql .= \"where sip_profile_enabled = 'true' \";\n\tif ($hostname) {\n\t\t$sql .= \"and (sip_profile_hostname = :sip_profile_hostname \";\n\t\t$sql .= \"or sip_profile_hostname = '' \";\n\t\t$sql .= \"or sip_profile_hostname is null) \";\n\t\t$parameters['sip_profile_hostname'] = $hostname;\n\t}\n\t$sql .= \"order by sip_profile_name asc \";\n\t$database = new database;\n\t$sip_profiles = $database->select($sql, (is_array($parameters) && @sizeof($parameters) != 0 ? $parameters : null), 'all');\n\tunset($sql, $parameters);\n\n//sofia status\n\tif ($fp && permission_exists('system_status_sofia_status')) {\n\t\t$cmd = \"api sofia xmlstatus\";\n\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\ttry {\n\t\t\t$xml = new SimpleXMLElement($xml_response);\n\t\t}\n\t\tcatch(Exception $e) {\n\t\t\techo $e->getMessage();\n\t\t}\n\t\t$cmd = \"api sofia xmlstatus gateway\";\n\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\ttry {\n\t\t\t$xml_gateways = new SimpleXMLElement($xml_response);\n\t\t}\n\t\tcatch(Exception $e) {\n\t\t\techo $e->getMessage();\n\t\t}\n\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td width='50%'>\\n\";\n\t\techo \"\t<b>\".$text['header-sip-status'].\"</b>\";\n\t\techo \"\t<br><br>\";\n\t\techo \"</td>\\n\";\n\t\techo \"<td width='50%' align='right'>\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-flush_cache'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+cache+flush';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-reload_acl'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+reloadacl';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-reload_xml'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+reloadxml';\\\" />\\n\";\n\t\techo \"  <input type='button' class='btn' value='\".$text['button-refresh'].\"' onclick=\\\"document.location.href='sip_status.php';\\\" />\\n\";\n\t\techo \"</td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\n\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0' style='margin-bottom: 10px;'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<td><b><a href='javascript:void(0);' onclick=\\\"$('#sofia_status').slideToggle();\\\">\".$text['title-sofia-status'].\"</a></b></td>\\n\";\n\t\techo \"</tr>\\n\";\n\t\techo \"</table>\\n\";\n\n\t\techo \"<div id='sofia_status' style='margin-top: 20px; margin-bottom: 30px;'>\";\n\t\techo \"<table width='100%' cellspacing='0' border='0'>\\n\";\n\t\techo \"<tr>\\n\";\n\t\techo \"<th>\".$text['label-name'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-type'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-data'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-state'].\"</th>\\n\";\n\t\techo \"<th>\".$text['label-action'].\"</th>\\n\";\n\t\techo \"</tr>\\n\";\n\t\tforeach ($xml->profile as $row) {\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->name).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->type).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->data).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>&nbsp;</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\tforeach ($xml_gateways->gateway as $row) {\n\t\t\t$gateway_name = '';\n\t\t\t$gateway_domain_name = '';\n\t\t\tforeach($gateways as $field) {\n\t\t\t\tif ($field[\"gateway_uuid\"] == strtolower($row->name)) {\n\t\t\t\t\t$gateway_name = $field[\"gateway\"];\n\t\t\t\t\t$gateway_domain_name = $field[\"domain_name\"];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\";\n\t\t\tif ($_SESSION[\"domain_name\"] == $gateway_domain_name) {\n\t\t\t\techo \"<a href='\".PROJECT_PATH.\"/app/gateways/gateway_edit.php?id=\".strtolower(escape($row->name)).\"'>\".escape($gateway_name).\"@\".escape($gateway_domain_name).\"</a>\";\n\t\t\t}\n\t\t\telse if ($gateway_domain_name == '') {\n\t\t\t\techo $gateway_name ? $gateway_name : $row->name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\techo $gateway_name.\"@\".$gateway_domain_name;\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>Gateway</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->to).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'><a onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($row->profile).\"+killgw+\".escape($row->name).\"';\\\" />\".$text['button-stop'].\"</a></td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\tforeach ($xml->alias as $row) {\n\t\t\t//print_r($row);\n\t\t\techo \"<tr>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->name).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->type).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->data).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>\".escape($row->state).\"</td>\\n\";\n\t\t\techo \"\t<td class='\".$row_style[$c].\"'>&nbsp;</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t}\n\t\techo \"</table>\\n\";\n\t\techo \"</div>\\n\";\n\t\tunset($xml);\n\t}\n\n//sofia status profile\n\tif (permission_exists('system_status_sofia_status_profile')) {\n\t\tforeach ($sip_profiles as $row) {\n\t\t\t$sip_profile_name = $row[\"sip_profile_name\"];\n\n\t\t\tif ($fp) {\n\t\t\t\t$cmd = \"api sofia xmlstatus profile \".$sip_profile_name.\"\";\n\t\t\t\t$xml_response = trim(event_socket_request($fp, $cmd));\n\t\t\t\tif ($xml_response == \"Invalid Profile!\") {\n\t\t\t\t\t$xml_response = \"<error_msg>Invalid Profile!</error_msg>\";\n\t\t\t\t\t$profile_state = 'stopped';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$profile_state = 'running';\n\t\t\t\t}\n\t\t\t\t$xml_response = str_replace(\"<profile-info>\", \"<profile_info>\", $xml_response);\n\t\t\t\t$xml_response = str_replace(\"</profile-info>\", \"</profile_info>\", $xml_response);\n\t\t\t\ttry {\n\t\t\t\t\t$xml = new SimpleXMLElement($xml_response);\n\t\t\t\t}\n\t\t\t\tcatch(Exception $e) {\n\t\t\t\t\techo $e->getMessage();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0' style='margin-bottom: 10px;'>\\n\";\n\t\t\t\techo \"<tr>\\n\";\n\t\t\t\techo \"<td width='100%'>\\n\";\n\t\t\t\techo \"  <b><a href='javascript:void(0);' onclick=\\\"$('#\".escape($sip_profile_name).\"').slideToggle();\\\">\".$text['title-sofia-status-profile'].\" \".escape($sip_profile_name).\"</a></b> \\n\";\n\t\t\t\techo \"</td>\\n\";\n\t\t\t\techo \"<td align='right' nowrap>\\n\";\n\t\t\t\tif ($sip_profile_name != \"external\") {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-flush_registrations'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+flush_inbound_reg';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-registrations'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/registrations/registrations.php?show_reg=1&profile=\".escape($sip_profile_name).\"';\\\" />\\n\";\n\t\t\t\tif ($profile_state == 'stopped') {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-start'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+start';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\tif ($profile_state == 'running') {\n\t\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-stop'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+stop';\\\" />\\n\";\n\t\t\t\t}\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-restart'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+restart';\\\" />\\n\";\n\t\t\t\techo \"  <input type='button' class='btn' value='\".$text['button-rescan'].\"' onclick=\\\"document.location.href='cmd.php?cmd=api+sofia+profile+\".escape($sip_profile_name).\"+rescan';\\\" />\\n\";\n\t\t\t\techo \"</td>\\n\";\n\t\t\t\techo \"</tr>\\n\";\n\t\t\t\techo \"</table>\\n\";\n\n\t\t\t\techo \"<div id='\".escape($sip_profile_name).\"' style='display: none; margin-bottom: 30px;'>\";\n\t\t\t\techo \"<table width='100%' cellspacing='0' cellpadding='5'>\\n\";\n\t\t\t\techo \"<tr>\\n\";\n\t\t\t\techo \"<th width='20%'>&nbsp;</th>\\n\";\n\t\t\t\techo \"<th>&nbsp;</th>\\n\";\n\t\t\t\techo \"</tr>\\n\";\n\n\t\t\t\tforeach ($xml->profile_info as $row) {\n\t\t\t\t\techo \"\t<tr><td class='vncell'>name</td><td class='vtable'>&nbsp; &nbsp;\".escape($row->name).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>domain-name</td><td class='vtable'>&nbsp; &nbsp;\".escape($row->{'domain-name'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>auto-nat</td><td class='vtable'>&nbsp;\".escape($row->{'auto-nat'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>db-name</td><td class='vtable'>&nbsp;\".escape($row->{'db-name'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>pres-hosts</td><td class='vtable'>&nbsp;\".escape($row->{'pres-hosts'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>dialplan</td><td class='vtable'>&nbsp;\".escape($row->dialplan).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>context</td><td class='vtable'>&nbsp;\".escape($row->context).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>challenge-realm</td><td class='vtable'>&nbsp;\".escape($row->{'challenge-realm'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>rtp-ip</td><td class='vtable'>&nbsp;\".escape($row->{'rtp-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>ext-rtp-ip</td><td class='vtable'>&nbsp;\".escape($row->{'ext-rtp-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>sip-ip</td><td class='vtable'>&nbsp;\".escape($row->{'sip-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>ext-sip-ip</td><td class='vtable'>&nbsp;\".escape($row->{'ext-sip-ip'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>url</td><td class='vtable'>&nbsp;\".escape($row->url).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>bind-url</td><td class='vtable'>&nbsp;\".escape($row->{'bind-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tls-url</td><td class='vtable'>&nbsp;\".escape($row->{'tls-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tls-bind-url</td><td class='vtable'>&nbsp;\".escape($row->{'tls-bind-url'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>hold-music</td><td class='vtable'>&nbsp;\".escape($row->{'hold-music'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>outbound-proxy</td><td class='vtable'>&nbsp;\".escape($row->{'outbound-proxy'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>inbound-codecs</td><td class='vtable'>&nbsp;\".escape($row->{'inbound-codecs'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>outbound-codecs</td><td class='vtable'>&nbsp;\".$row->{'outbound-codecs'}.\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>tel-event</td><td class='vtable'>&nbsp;\".escape($row->{'tel-event'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>dtmf-mode</td><td class='vtable'>&nbsp;\".escape($row->{'dtmf-mode'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>cng</td><td class='vtable'>&nbsp;\".escape($row->cng).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>session-to</td><td class='vtable'>&nbsp;\".escape($row->{'session-to'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>max-dialog</td><td class='vtable'>&nbsp;\".escape($row->{'max-dialog'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>nomedia</td><td class='vtable'>&nbsp;\".escape($row->{'nomedia'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>late-neg</td><td class='vtable'>&nbsp;\".escape($row->{'late-neg'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>proxy-media</td><td class='vtable'>&nbsp;\".escape($row->{'proxy-media'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>aggressive-nat</td><td class='vtable'>&nbsp;\".escape($row->{'aggressive-nat'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>stun-enabled</td><td class='vtable'>&nbsp;\".escape($row->{'stun-enabled'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>stun-auto-disable</td><td class='vtable'>&nbsp;\".escape($row->{'stun-auto-disable'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>user-agent-filter</td><td class='vtable'>&nbsp;\".escape($row->{'user-agent-filter'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>max-registrations-per-extension</td><td class='vtable'>&nbsp;\".escape($row->{'max-registrations-per-extension'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>calls-in</td><td class='vtable'>&nbsp;\".escape($row->{'calls-in'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>calls-out</td><td class='vtable'>&nbsp;\".escape($row->{'calls-out'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>failed-calls-in</td><td class='vtable'>&nbsp;\".escape($row->{'failed-calls-in'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t\techo \"\t<tr><td class='vncell'>failed-calls-out</td><td class='vtable'>&nbsp;\".escape($row->{'failed-calls-out'}).\"&nbsp;</td></tr>\\n\";\n\t\t\t\t}\n\t\t\t\techo \"</table>\\n\";\n\t\t\t\techo \"</div>\";\n\t\t\t\tunset($xml);\n\t\t\t}\n\t\t}\n\t}\n\n//status\n\tif ($fp && permission_exists('sip_status_switch_status')) {\n\t\t$cmd = \"api status\";\n\t\t$response = event_socket_request($fp, $cmd);\n\t\techo \"<b><a href='javascript:void(0);' onclick=\\\"$('#status').slideToggle();\\\">\".$text['title-status'].\"</a></b>\\n\";\n\t\techo \"<div id='status' style='margin-top: 20px; font-size: 9pt;'>\";\n\t\techo \"<pre>\";\n\t\techo trim(escape($response));\n\t\techo \"</pre>\\n\";\n\t\techo \"</div>\";\n\t\tfclose($fp);\n\t}\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/sip_status/sip_status.php"], "buggy_code_start_loc": [51], "buggy_code_end_loc": [75], "fixing_code_start_loc": [50], "fixing_code_end_loc": [50], "type": "CWE-79", "message": "In FusionPBX up to 4.5.7, the file app\\sip_status\\sip_status.php uses an unsanitized \"savemsg\" variable coming from the URL, which is reflected in HTML, leading to XSS.", "other": {"cve": {"id": "CVE-2019-16970", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T20:15:11.070", "lastModified": "2023-02-03T21:34:48.897", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In FusionPBX up to 4.5.7, the file app\\sip_status\\sip_status.php uses an unsanitized \"savemsg\" variable coming from the URL, which is reflected in HTML, leading to XSS."}, {"lang": "es", "value": "En FusionPBX versiones hasta 4.5.7, el archivo app\\sip_status\\sip_status.php utiliza una variable \"savemsg\" no saneada que proviene de la URL, que es reflejada en HTML, conllevando a una vulnerabilidad de tipo XSS."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/a55f1cd5d8edd655058152e9acf212680d5b75f3", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-3/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/a55f1cd5d8edd655058152e9acf212680d5b75f3"}}