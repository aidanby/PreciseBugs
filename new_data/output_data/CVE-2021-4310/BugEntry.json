{"buggy_code": ["<?PHP\n/* \n\t01-Artikelsystem V3 - Copyright 2006-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01article\n\tDateiinfo: \tFrontend-Ausgabe 01-Artikelsystem\n\t#fv.321#\n*/\n\n//Hinweis zum Einbinden des Artikelsystems per include();\n/*Folgender PHP-Code n\u00f6tig:\n\n<?PHP\n$subfolder \t\t= \"01scripts/\";\n$modul\t\t\t= \"01article/\";\n\ninclude($subfolder.\"01module/\".$modul.\"01article.php\");\n?>\n\n*/\n\n$frontp\t\t= 1;\n$flag_acp\t= FALSE;\nif(!isset($flag_utf8))\t\t$flag_utf8\t= FALSE;\nif(!isset($flag_nocss))\t\t$flag_nocss = FALSE;\nif(!isset($flag_second))\t$flag_second= FALSE;\n\n@ini_set('session.use_trans_sid',0);\n\nif(isset($subfolder) && !empty($subfolder)){\n    if(substr_count($subfolder, \"/\") < 1){ $subfolder .= \"/\"; }\n\t}\nelseif(isset($_GET['rss']) && ($_GET['rss'] == \"show_rssfeed\" || $_GET['rss'] == \"show_commentrssfeed\"))\n   $subfolder = \"../../\";\nelse\n\t$subfolder = \"\";\n\n// Globale Config-Datei einbinden\ninclude_once($subfolder.\"01_config.php\");\ninclude_once($subfolder.\"01acp/system/headinclude.php\");\nif(!$flag_second) include_once($subfolder.\"01acp/system/functions.php\");\n\n$modulvz = $modul.\"/\";\n// Modul-Config-Dateien einbinden\ninclude_once($moduldir.$modulvz.\"_headinclude.php\");\ninclude_once($moduldir.$modulvz.\"_functions.php\");\n\n// Variablen\n$imagepf \t= $moduldir.$modulvz.$imagepf;          // Pfad zum Bild-Verzeichnis\n$tempdir\t= $moduldir.$modulvz.$tempdir;\t\t\t// Template-Verzeichnis\n$filename\t= $_SERVER['PHP_SELF'];\t\t\t\t\t// Variable enth\u00e4lt die Adresse der Datei, auf der das Artikelsystem eingebunden wurde\n$flag_comments_js\t= TRUE;\t\t\t\t\t\t\t// Kommentar-Feld per Default via JavaScript ausblenden?\n\n// Language-File einbinden\ninclude_once($tempdir.\"lang_vars.php\");\n\n// Weitere Variablen +Bitte nehmen Sie hier keine \u00c4nderungen vor+\n$sites\t\t\t\t= 0;\n$qt\t\t\t\t\t= 0;\n$svl2a\t\t\t\t= \"\";\n$qt_query\t\t\t= \"\";\n$flag_archiv\t\t= \"\";\n$flag_IamStandard\t= FALSE;\n\n// ggf. Zuweisung $show[] -> $_GET[]\nif(!isset($_REQUEST[$names['catid']]) && isset($show['catid']) && !empty($show['catid'])) $_REQUEST[$names['catid']] = $show['catid']; \nif(!isset($_REQUEST[$names['search']]) && isset($show['search']) && !empty($show['search'])) $_REQUEST[$names['search']] = $show['search'];\nif(!isset($_REQUEST[$names['page']]) && isset($show['page']) && !empty($show['page'])) $_REQUEST[$names['page']] = $show['page'];\nif(!isset($_GET[$names['artid']]) && isset($show['artid']) && !empty($show['artid'])) $_GET[$names['artid']] = $show['artid'];\n\n// Notice: Undefined index: ... beheben & strip_tags auf \u00fcbergebene Werte anwenden (+ Anti-XSS)\nif(!isset($_REQUEST[$names['search']])) $_REQUEST[$names['search']] = \"\";\nelse $_REQUEST[$names['search']]\t\t= strip_tags($_REQUEST[$names['search']]);\nif(!isset($_REQUEST[$names['page']])) \t$_REQUEST[$names['page']] \t= \"\";\nelse $_REQUEST[$names['page']]\t\t\t= strip_tags($_REQUEST[$names['page']]);\nif(!isset($_REQUEST[$names['catid']])) \t$_REQUEST[$names['catid']] \t= \"\";\nelse $_REQUEST[$names['catid']]\t\t\t= strip_tags($_REQUEST[$names['catid']]);\nif(!isset($_REQUEST[$names['cpage']])) \t$_REQUEST[$names['cpage']] \t= \"\";\nelse $_REQUEST[$names['cpage']]\t\t\t= strip_tags($_REQUEST[$names['cpage']]);\nif(!isset($_REQUEST[$names['rss']])) \t$_REQUEST[$names['rss']] \t= \"\";\nelse $_REQUEST[$names['rss']]\t\t\t= strip_tags($_REQUEST[$names['rss']]);\nif(!isset($_GET[$names['artid']])) \t\t$_GET[$names['artid']] \t\t= \"\";\nelse $_GET[$names['artid']]\t\t\t\t= strip_tags($_GET[$names['artid']]);\nif(!isset($_GET[$names['cpage']])) \t\t$_GET[$names['cpage']] \t\t= \"\";\nelse $_GET[$names['cpage']]\t\t\t\t= strip_tags($_GET[$names['cpage']]);\nif(!isset($_GET[$names['rss']])) \t\t$_GET[$names['rss']] \t\t= \"\";\nelse $_GET[$names['rss']]\t\t\t\t= strip_tags($_GET[$names['rss']]);\nif(!isset($static))\t\t\t\t\t\t$static\t\t\t\t\t\t= 0;\nif(!isset($_POST['deaktiv_bbc']))\t\t$_POST['deaktiv_bbc']\t\t= 0;\nelse $_POST['deaktiv_bbc']\t\t\t\t= strip_tags($_POST['deaktiv_bbc']);\nif(!isset($_GET[$names['page']]) || isset($_GET[$names['page']]) && $_GET[$names['page']] != $_REQUEST[$names['page']]) $_GET[$names['page']] = $_REQUEST[$names['page']];  \nif(!isset($_POST['antispam']))          $_POST['antispam'] = \"\";\n\n//Link-String generieren\n$system_link \t\t= addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]);\n$system_link_index \t= parse_cleanerlinks(addParameter2Link($filename,$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]));\n$system_link_rss\t= $subfolder.\"01module/\".$modul.\"/01article.php\";\n\n\n\n\n\n// Ausf\u00fchrung der weiteren Seite wird nach dem Aufruf der n\u00f6tigen RSS-Funktionen durch exit; unterbrochen\nif(isset($_GET[$names['rss']]) && ($_GET[$names['rss']] == \"show_rssfeed\" || $_GET[$names['rss']] == \"show_commentrssfeed\") && \n   $settings['rss_aktiv'] == 1 && ($settings['artikelrssfeedaktiv'] == 1 || $settings['artikelkommentarfeed'] == 1)){\n\t\n\tif(!isset($_GET['entries'])) $_GET['entries'] = \"\";\n\telse $_GET['entries'] = strip_tags($_GET['entries']);\n\n\tinclude_once($subfolder.\"01acp/system/includes/htmLawed.php\");\n\t\n\theader(\"Content-type: text/xml\");\n\techo _01article_RSS($_GET[$names['rss']],$_GET['entries'],$_REQUEST[$names['catid']]);\n\texit;\n\t}\nelseif(isset($_GET[$names['rss']]) && ($_GET[$names['rss']] == \"show_rssfeed\" || $_GET[$names['rss']] == \"show_commentrssfeed\")){\n\techo \"Fehler: Der RSS-Feed wurde deaktiviert!\";\n\texit;\n\t}\n\n\n// CSS-Datei einbinden\nif(isset($settings['extern_css']) && !empty($settings['extern_css']) && filter_var($settings['extern_css'], FILTER_VALIDATE_URL) !== FALSE && !$flag_nocss)\n\t$echo_css = \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"\".$settings['extern_css'].\"\\\" />\";\nelseif(!$flag_nocss)\n\t$echo_css = \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"\".$tempdir.\"style.css\\\" />\";\nelse $echo_css = \"\";\n\n// Alle Kategorien in einen mehrdimensionalen Array einlesen\n$listcat = $mysqli->query(\"SELECT * FROM \".$mysql_tables['cats'].\" ORDER BY sortid,name\");\nwhile($rowcat = $listcat->fetch_assoc()){\n\t$category[$rowcat['id']]['id'] \t\t= $rowcat['id'];\n\t$category[$rowcat['id']]['name']\t= htmlentities($rowcat['name'],$htmlent_flags,$htmlent_encoding_acp);\n\t$category[$rowcat['id']]['catpic']\t= $rowcat['catpic'];\n\t}\n\n\n\n\n// ggf. Archiv-Zeit berechnen\nif(!empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time']))\n\t$qt = time()-($settings['archiv_time']*24*60*60);\n\n// Alternative Abfrage, wenn nur ein Artikel / eine Seite angezeigt werden soll\nif(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && $_GET[$names['artid']] > 0 && is_numeric($_GET[$names['artid']])){\n    $query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime = '0') AND id = '\".$mysqli->escape_string($_GET[$names['artid']]).\"' LIMIT 1\";\n\t$iderror = 1;\n\n    //Hits +1:\n    $mysqli->query(\"UPDATE \".$mysql_tables['artikel'].\" SET hits = hits+1 WHERE id = '\".$mysqli->escape_string($_GET[$names['artid']]).\"' LIMIT 1\");\n    }\n// Archiv-Ansicht\nelseif(isset($_GET[$names['artid']]) && $_GET[$names['artid']] == \"archiv\" && !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time'])){\n    $flag_archiv = \"&amp;\".$names['artid'].\"=archiv\";\n\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n    $query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND (utimestamp <= '\".$qt.\"' OR (endtime <= '\".time().\"' AND endtime != '0')) AND (endtime <= '\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\") ORDER BY utimestamp DESC\";\n\n    $settings['articleperpage'] = ANZ_PP_ARCHIV;\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\n\t\n\t$iderror = 1;\n    }\n// Alle Artikel anzeigen\nelse{\n\tif(!empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time']))\n\t\t$qt_query = \"AND (utimestamp>'\".$qt.\"' OR top = '1' OR endtime >= '\".time().\"') \";\n\telse $qt_query = \"\";\n\t\n    if(isset($_REQUEST[$names['search']]) && !empty($_REQUEST[$names['search']]) && $settings['artikelsuche'] == 1){\n\t\tif($flag_utf8)\n\t\t\t$parsed_searchstring = $mysqli->escape_string(parse_uml(utf8_decode(str_replace(\"*\",\"\",$_REQUEST[$names['search']]))));\n\t\telse\n\t\t\t$parsed_searchstring = $mysqli->escape_string(parse_uml(str_replace(\"*\",\"\",$_REQUEST[$names['search']])));\n\n\t\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n        $add2query = \"AND MATCH (titel,content,zusammenfassung) AGAINST ('\".$parsed_searchstring.\"') >= \".FULLTEXT_INDEX_SEARCH_SCHWELLE.\" AND (\".$add2query_cat.\")\";\n        $iderror = 2;\t// Flag f\u00fcr Fehlermeldung in main_top\n\t\t}\n    elseif(isset($_REQUEST[$names['catid']]) && !empty($_REQUEST[$names['catid']])){\n        $add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n\t\t$add2query = $qt_query.\"AND (\".$add2query_cat.\") ORDER BY top DESC,utimestamp DESC\";\n\t\t$iderror = 3;\t// Flag f\u00fcr Fehlermeldung in main_top\n\t\t}\n    else{\n        $add2query = $qt_query.\"ORDER BY top DESC,utimestamp DESC\";\n        $flag_IamStandard = true;\n        $iderror = 1;\t// Flag f\u00fcr Fehlermeldung in main_top\n        }\n\n\t$query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') \".$add2query;\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\t\t\n\t}\n\n// List > 0?\n$list = $mysqli->query($query);\necho \"<!-- 2559ad821dde361560dbf967c3406f51 -->\";\n\n// Wenn nichts angezeigt werden konnte neuer Versuch mit Standardabfrage\nif($list->num_rows == 0 && !$flag_IamStandard){\n\t$query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') \".$qt_query.\"ORDER BY top DESC,utimestamp DESC\";\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\n\t$list = $mysqli->query($query);\n\t\n\t$_GET[$names['artid']] = \"\";\n\t}\nelseif($list->num_rows > 0){\n\tif(isset($_REQUEST[$names['search']]) && !empty($_REQUEST[$names['search']]) && $settings['artikelsuche'] == 1)\n\t\t$iderror = 4;\n\telseif(isset($_REQUEST[$names['catid']]) && !empty($_REQUEST[$names['catid']]))\n\t    $iderror = 5;\n\telse\n\t\t$iderror = 0;\t// Flag f\u00fcr Fehlermeldung zur\u00fccksetzen, wenn mind. 1 Artikel angezeigt werden kann\n\t}\n\n\n\n\n// main_top einbinden\ninclude($tempdir.\"main_top.html\");\n\n\n\n\n\n// ARCHIV\nif(isset($_GET[$names['artid']]) && $_GET[$names['artid']] == \"archiv\" && !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time'])){\n    include($tempdir.\"archiv_top.html\");\n    \n\t$round = 1;\n\twhile($row = $list->fetch_assoc()){\n        if($round == 1){\n        \t$archiv_year = date(\"Y\",$row['utimestamp']);\n\t\t\t$archiv_month = date(\"n\",$row['utimestamp']);\n\t\t\t\n\t\t\tinclude($tempdir.\"archiv_top_year.html\");\n\t\t\tinclude($tempdir.\"archiv_top_month.html\");\n\t\t}\n\t\t\n\t\tif($archiv_year != date(\"Y\",$row['utimestamp'])){\n\t\t\t$archiv_year = date(\"Y\",$row['utimestamp']);\n\t\t\tinclude($tempdir.\"archiv_top_year.html\");\n\t\t\t}\n\t\tif($archiv_month != date(\"n\",$row['utimestamp'])){\n\t\t\t$archiv_month = date(\"n\",$row['utimestamp']);\n\t\t\tinclude($tempdir.\"archiv_top_month.html\");\n\t\t\t}\n\t\t\n\t\t$datum = date(\"d.m.y\",$row['utimestamp']).\", \".date(\"G:i\",$row['utimestamp']);\n        $titel = $row['titel'];\n\t\t\n        $username_array = getUserdatafields($row['uid'],\"username\");\n\t\t$autor = htmlentities($username_array['username'],$htmlent_flags,$htmlent_encoding_acp);\n\t\t\n        include($tempdir.\"archiv_bit.html\");\n        $round++;\n        }\n\t\t\n    include($tempdir.\"archiv_bottom.html\");\n\t$iderror = 0;\n    }\n\t\n\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// NORMALE AUSGABE\nelse{\n\twhile($row = $list->fetch_assoc()){\n        $datum \t\t= date(\"d.m.y\",$row['utimestamp']);\n        $uhrzeit \t= date(\"G:i\",$row['utimestamp']);\n\n        //Catid & Catimage auslesen\n        if($row['newscatid'] != \"0\"){\n            $c = 0;\n\t\t\t$catimg = \"\"; $catname = \"\";\n            $newscatids_array = explode(\",\",substr($row['newscatid'],1,strlen($row['newscatid'])-2));\n            foreach($newscatids_array as $newscatid_s){\n\t\t\t\tif(isset($category[$newscatid_s]['name'])){\n                    if(isset($category[$newscatid_s]['catpic']) && $category[$newscatid_s]['catpic'] != \"\")\n                        $catimg .= \"<a href=\\\"\".addParameter2Link($filename,$names['catid'].\"=\".$newscatid_s).\"\\\"><img src=\\\"\".$catuploaddir.$category[$newscatid_s]['catpic'].\"\\\" alt=\\\"Kategorie: \".$category[$newscatid_s]['name'].\"\\\" title=\\\"Kategorie: \".$category[$newscatid_s]['name'].\"\\\" align=\\\"left\\\" /></a> \";\n                    else\n                        $catimg .= \"\";\n\t\t\t\t\t\t\n                    if($c > 0) $catname .= \", \";\n                    $catname .= \"<a href=\\\"\".addParameter2Link($filename,$names['catid'].\"=\".$newscatid_s).\"\\\" class=\\\"catlink\\\">\".$category[$newscatid_s]['name'].\"</a>\";\n                    $c++;\n\t\t\t\t\t}\n                }\n            }\n        else{ $catimg = \"\"; $catname = \"\"; }\n\n\t\t$more = 0;\n\t\t// Normalen, kompletten Haupttext anzeigen\n\t\tif((isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) ||\n\t\t   $settings['artikeleinleitung'] == 0 ||\n\t\t   $settings['artikeleinleitung'] == 2 && $row['autozusammen'] == 0 && empty($row['zusammenfassung'])) &&\n\t\t   (!isset($_REQUEST[$names['search']]) || isset($_REQUEST[$names['search']]) && empty($_REQUEST[$names['search']]) || $iderror == 2)){\n\n\t        $artikeltext = $row['content'];\n\t\t\t$artikeltext = str_replace(\"../01pics/\",$picuploaddir,$artikeltext);\n\t\t\t$artikeltext = str_replace(\"../01files/\",$attachmentuploaddir,$artikeltext);\n\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t\t\t$artikeltext = preg_replace_callback(\"/\\{Insert#(\\d+)GalleryPicsFrom#(\\d+)\\}/\",\"_01article_callback_GetGalThumbs4Article\",$artikeltext);\n\t\t\t}\n\t\t// Zusammenfassung anzeigen\n\t\telse{\n\t        if($row['autozusammen'] == 0 && !empty($row['zusammenfassung'])){\n\t            $artikeltext = $row['zusammenfassung'];\n\t\t\t\t$artikeltext = str_replace(\"../01pics/\",$picuploaddir,$artikeltext);\n\t\t\t\t$artikeltext = str_replace(\"../01files/\",$attachmentuploaddir,$artikeltext);\n\t\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t            }\n\t        else{\n\t\t\t\t$artikeltext = \"<p>\".substr(strip_tags($row['content']),0,$settings['artikeleinleitungslaenge']).$lang['weiterlesen'].\"</p>\";\n\t\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t\t\t\t}\n\t\t\t$artikeltext = preg_replace_callback(\"/\\{Insert#(\\d+)GalleryPicsFrom#(\\d+)\\}/\",\"_01article_callback_GetGalThumbs4Article\",$artikeltext);\n\n\t\t\t// Weiterlesen-Link nur einbinden, wenn Text l\u00e4nger als Zusammenfassung oder eigener Text eingegeben wurde\n\t\t\tif($row['autozusammen'] == 0 && !empty($row['zusammenfassung']) || \n\t\t\t   strlen($artikeltext) < strlen($row['content']))\n\t\t\t\t$more = 1;\n\t\t\telse $more = 0;\n\t\t\t}\n\n        // Anzahl bisheriger Kommentare ermitteln\n        if($settings['comments'] == 1){ \n\t\t\t$comments = 0;\n\t\t\tlist($comments) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul = '\".$mysqli->escape_string($modul).\"' AND postid = '\".$row['id'].\"'\")->fetch_array(MYSQLI_NUM);\n\t\t\t}\n\n        // Weitere Variablen f\u00fcr die Template-Ausgabe aufbereiten\n        $username_array = getUserdatafields($row['uid'],\"username,01acp_signatur\");\n\t\t$username = htmlentities($username_array['username'],$htmlent_flags,$htmlent_encoding_acp);\n\t\tif(!empty($username_array['signatur']) && $more == 0 && $row['hide_signature'] == 0)\n\t\t\t$signatur = \"<p class=\\\"signatur\\\">\".nl2br(str_replace(\"&\",\"&amp;\",$username_array['signatur'])).\"</p>\";\n            if($flag_utf8) $signatur = utf8_encode($signatur);\n\t\telse\n\t\t\t$signatur = \"\";\n\t\t\n        $titel = $row['titel'];\n\t\t$static = $row['static'];\n        $system_link_row = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($row['id'],$row['titel'],$row['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]));\n        \n\t\t// Get serialized data\n\t\tif($ser_fields){\n\t\t\t$return_temp = unserialize($row['serialized_data']);\n\n\t\t\tif(empty($return_temp)){\n\t\t\t\tfor($x=1;$x<=ANZ_SER_FIELDS;$x++){\n\t\t\t\t\t$row['ser_field_'.$x] = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\tfor($x=1;$x<=ANZ_SER_FIELDS;$x++){\n\t\t\t\t\t$row['ser_field_'.$x] = htmlspecialchars($return_temp['field_'.$x],$htmlent_flags,$htmlent_encoding_acp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t// artikel_self-Link\n        $artikeltext = str_replace(\"{artikel_self}\",$system_link_row,$artikeltext);\n\n        // ggf. Links zum vorherigen / n\u00e4chsten Eintrag generieren\n        if(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && $row['static'] == 0){\n\t\t\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n\t\t\n\t\t\t$listnext = $mysqli->query(\"SELECT id,utimestamp,titel FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp > '\".$row['utimestamp'].\"' AND utimestamp <= '\".time().\"' AND (endtime>='\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\") ORDER BY utimestamp LIMIT 1\");\n            $rownext = $listnext->fetch_assoc();\n            $next_link = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($rownext['id'],$rownext['titel'],$rownext['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\"));\n            $next_titel = $rownext['titel'];\n\t\t\t\n            $listprev = $mysqli->query(\"SELECT id,utimestamp,titel FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp < '\".$row['utimestamp'].\"' AND (endtime>='\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\")  ORDER BY utimestamp DESC LIMIT 1\");\n            $rowprev = $listprev->fetch_assoc();\n            $prev_link = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($rowprev['id'],$rowprev['titel'],$rowprev['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\"));\n            $prev_titel = $rowprev['titel'];\n            }\n\n        // Template einbinden\n        include($tempdir.\"artikel.html\");\n\n\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t// KOMMENTAR-AUSGABE & FORMULAR, etc.\n\t\tif(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] > 0 && \n\t\t   is_numeric($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && \n\t\t   $settings['comments'] == 1 && $settings['artikelcomments'] >= 1 && $row['comments'] == 1){\n            \n            // Anti-XSS\n            if(isset($_POST['send_comment']))\t$_POST['send_comment']\t\t= strip_tags($_POST['send_comment']);\n            if(isset($_POST['modul_comment']))\t$_POST['modul_comment']\t\t= strip_tags($_POST['modul_comment']);\n            if(isset($_POST['autor']))\t\t\t$_POST['autor']\t\t\t\t= filter_var($_POST['autor'],FILTER_SANITIZE_SPECIAL_CHARS);\n            if(isset($_POST['email']))\t\t\t$_POST['email']\t\t\t\t= strip_tags($_POST['email']);\n            if(isset($_POST['url']))\t\t\t$_POST['url']\t\t\t\t= strip_tags($_POST['url']);\n            if(isset($_POST['comment']))\t\t$_POST['comment']\t\t\t= strip_tags($_POST['comment']);\n            if(isset($_POST['antispam']))\t\t$_POST['antispam']\t\t\t= strip_tags($_POST['antispam']);\n            if(isset($_POST['deaktiv_bbc']))\t$_POST['deaktiv_bbc']\t\t= strip_tags($_POST['deaktiv_bbc']);\n            if(isset($_POST['uid']))\t\t\t$_POST['uid']\t\t\t\t= strip_tags($_POST['uid']);\n\t\t\t\n\t\t\t$message = 0;\n            // Neuen Kommentar hinzuf\u00fcgen\n            if(isset($_POST['send_comment']) && $_POST['send_comment'] == 1 &&\n\t\t\t   isset($_POST['modul_comment']) && $_POST['modul_comment'] == $modul){\n\t\t\t\t\t$message = insert_Comment($_POST['autor'],$_POST['email'],$_POST['url'],$_POST['comment'],$_POST['antispam'],$_POST['deaktiv_bbc'],$row['id'],$_POST['uid'],0,$_POST['link'],$_POST['time']);\n\t\t\t\t}\n\n\t\t\t//Template einbinden\n            include($tempdir.\"comments_head.html\");\n\n            // KOMMENTARE AUSGEBEN\n            $nr = 1;\n            $comment_query = \"SELECT * FROM \".$mysql_tables['comments'].\" WHERE modul='\".$modul.\"' AND postid='\".$row['id'].\"' AND frei='1' ORDER BY utimestamp \".$mysqli->escape_string($comment_desc).\"\";\n            \n\t\t\t// Seiten-Funktion\n            if($settings['comments_perpage'] > 0){\n                $comment_sc = $mysqli->query($comment_query)->num_rows;\n                $comment_sites = ceil($comment_sc/$settings['comments_perpage']);    //=Anzahl an Seiten\n\t\t\t\t\n                if(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] == \"last\" && $comment_sites > 1){\n                    $_GET[$names['cpage']] = $comment_sites;\n                    $commentsstart = $comment_sites*$settings['comments_perpage']-$settings['comments_perpage'];\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($commentsstart).\",\".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                    $nr = $commentsstart+1;\n                    }\n                elseif(isset($_GET[$names['cpage']]) && !empty($_GET[$names['cpage']]) && $_GET[$names['cpage']] <= $comment_sites && $comment_sites > 1){\n                    $commentsstart = $_GET[$names['cpage']]*$settings['comments_perpage']-$settings['comments_perpage'];\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($commentsstart).\",\".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                    $nr = $commentsstart+1;\n                    }\n                else\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                }\n\n            $clist = $mysqli->query($comment_query);\n            while($crow = $clist->fetch_assoc()){\n                \n\t\t\t\t// URL\n                if(!empty($crow['url']) && $crow['url'] != \"http://\"){\n                    if(substr_count($crow['url'], \"http://\") < 1)\n\t\t\t\t\t\t$url = \"http://\".$crow['url'];\n\t\t\t\t\telse\n\t\t\t\t\t\t$url = $crow['url']; \n                    }\n                else $url = \"\";\n\n                // Weitere Variablen f\u00fcr die Template-Ausgabe aufbereiten\n                $datum = date(\"d.m.y - G:i\",$crow['utimestamp']);\n                $autorenname = $crow['autor'];\n                $comment_id = $crow['id'];\n\n                // BB-Code & Smilies\n                $comment = $crow['message'];\n                if($crow['bbc'] == 1 && $settings['comments_bbc'] == 1 && $crow['smilies'] == 1 && $settings['comments_smilies'] == 1)\n\t\t\t\t\t$comment = bb_code_comment($comment,1,1,1);\n\t\t\t\telseif($crow['bbc'] == 1 && $settings['comments_bbc'] == 1 && ($crow['smilies'] == 0 || $settings['comments_smilies'] == 0))\n\t\t\t\t\t$comment = bb_code_comment($comment,1,1,0);\n\t\t\t\telseif(($crow['bbc'] == 0 || $settings['comments_bbc'] == 0) && $crow['smilies'] == 1 && $settings['comments_smilies'] == 1)\n\t\t\t\t\t$comment = bb_code_comment($comment,1,0,1);\n\t\t\t\telse \n\t\t\t\t\t$comment = nl2br($comment);\n\n                // Template ausgeben\n                include($tempdir.\"commentbit.html\");\n\n                $nr++;\n                }\n\n            //Seiten (Kommentare) ausgeben\n            if($comment_sites > 1 && $settings['comments_perpage'] > 0){\n                if(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] > 1){\n                    $c_sz = $_GET[$names['cpage']]-1;\n                    if($c_sz > 1)\n\t\t\t\t\t\t$c_szl1 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=1&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    $c_szl2 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$c_sz.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    }\n                else{ $c_szl1 = \"\"; $c_szl2 = \"\"; $c_sz = 0; }\n                \n\t\t\t\tif(!isset($_GET[$names['cpage']]) || isset($_GET[$names['cpage']]) && empty($_GET[$names['cpage']]))\n                    {\n                    $comment_current = 1;\n                    if($comment_sites > 1) $c_sv = 2;\n                    }\n                else{\n                    $comment_current = $_GET[$names['cpage']];\n                    $c_sv = $_GET[$names['cpage']]+1;\n                    }\n                \n\t\t\t\tif(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] < $comment_sites || !isset($_GET[$names['cpage']]) && $comment_sites > 1){\n                    $c_svl1 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$c_sv.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    if($c_sv != $comment_sites)\n\t\t\t\t\t\t$c_svl2 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$comment_sites.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    }\n                else{ $c_svl1 = \"\"; $c_svl2 = \"\"; }\n                }\n\n\t\t\t//Template ausgeben\n            if($message > 2) $flag_comments_js = FALSE;\t\t\t// Formular nicht per JS ausblenden, wenn eine Fehlermeldung erzeugt wurde.\n            include($tempdir.\"comments_end.html\");\n\n            //Unterschiedliche Sprungmarken nach Absenden des Kommentarformulars\n            if(!isset($jumpto_id)) $jumpto_id = \"\";\n\t\t\tif($settings['commentfreischaltung'] == 0) $jumpto = \"01comment\".$jumpto_id; else $jumpto = \"01jumpcomments\";\n            if($comment_desc == \"\") $jumpto_csite = \"last\"; else $jumpto_csite = \"1\";\n\t\t\t\n            $system_link_form = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$jumpto_csite.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments_add\"));\n\n            if($settings['artikelcomments'] == 1){\n\t\t\t\t$zahl = mt_rand(1, 9999999999999);\n\t\t\t\t$uid = md5(time().$_SERVER['REMOTE_ADDR'].$zahl.$_GET[$names['artid']]);\n\t\t\t\t//Template ausgeben\n                include($tempdir.\"comments_add.html\");\n                }\n            elseif ($settings['artikelcomments'] == 2 && !empty($settings['Disqus_Username'])) {\n                include($tempdir.\"comments_disqus.html\");\n                }\n            }\n        unset($catimg);\n        unset($catname);\n        }\n    }\n\n// Ausgabe der Seiten\nif($sites > 1){\n    $option_sites = \"\";\n\tfor($o=1;$o<=$sites;$o++){\n        $option_sites .= \"<option>\".$o.\"</option>\\n\";\n        }\n\n    if(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] > 1){\n        $sz = $_REQUEST[$names['page']]-1;\n\n        if($sz != 1)\n\t\t\t$szl1 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=1&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n\t\telse $szl1 = \"\";\n\n\t\t$szl2 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sz.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n        }\n    else{ $szl1 = \"\"; $szl2 = \"\"; }\n\t\n    if(!isset($_REQUEST[$names['page']]) || isset($_REQUEST[$names['page']]) && empty($_REQUEST[$names['page']])){\n        $current = 1;\n        if($sites > 1){ $sv = 2; }\n        }\n    else{\n        $current = $_REQUEST[$names['page']];\n        $sv = $_REQUEST[$names['page']]+1;\n        }\n    \n\tif(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] < $sites || !isset($_REQUEST[$names['page']]) && $sites > 1){\n        \n\t\t$svl1 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sv.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\")); \n        if($sv != $sites) \n\t\t\t$svl2 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sites.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n        }\n    else{\n\t\t$svl1 = \"\";\n\t\t$svl2 = \"\";\n\n\t\tif(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] == $sites &&\n\t\t   !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && $_GET[$names['artid']] != \"archiv\")\n\t\t\t$svl2a = \"<a href=\\\"\".parse_cleanerlinks(addParameter2Link($filename,$names['artid'].\"=archiv&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\")).\"\\\">Archiv &raquo;</a>\";\n\t\t}\n    }\n\n// Kategorien vorhanden? --> Ausgeben\nif(isset($category) && count($category) > 0){\n\t$listcats = \"\";\n\tforeach($category as $cat){\n\t\t// Sind Eintr\u00e4ge dieser Kategorie zugeordnet?\n\t\tif($qt > 0)\n\t\t\tlist($newsvorhanden) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND utimestamp <= '\".time().\"' AND utimestamp>'\".$qt.\"' AND (endtime >= '\".time().\"' OR endtime='0') AND newscatid LIKE '%,\".$cat['id'].\",%'\")->fetch_array(MYSQLI_NUM);\n\t\telse\n\t\t\tlist($newsvorhanden) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') AND newscatid LIKE '%,\".$cat['id'].\",%'\")->fetch_array(MYSQLI_NUM);\n\t\t\n\t\tif($newsvorhanden > 0)\n\t\t\t$listcats .= \"<option value=\\\"\".$cat['id'].\"\\\">\".$cat['name'].\" (\".$newsvorhanden.\")</option>\\n\";\n\n\t\t$newsvorhanden = 0;    \n\t\t}\n\t}\n\n//Template einbinden\ninclude($tempdir.\"pages.html\");\n\n//Template einbinden\ninclude($tempdir.\"main_bottom.html\");\n\n$tempdir\t= \"templates/\";\n$query\t\t= \"\";\n\n?>"], "fixing_code": ["<?PHP\n/* \n\t01-Artikelsystem V3 - Copyright 2006-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01article\n\tDateiinfo: \tFrontend-Ausgabe 01-Artikelsystem\n\t#fv.321#\n*/\n\n//Hinweis zum Einbinden des Artikelsystems per include();\n/*Folgender PHP-Code n\u98c6ig:\n\n<?PHP\n$subfolder \t\t= \"01scripts/\";\n$modul\t\t\t= \"01article/\";\n\ninclude($subfolder.\"01module/\".$modul.\"01article.php\");\n?>\n\n*/\n\n$frontp\t\t= 1;\n$flag_acp\t= FALSE;\nif(!isset($flag_utf8))\t\t$flag_utf8\t= FALSE;\nif(!isset($flag_nocss))\t\t$flag_nocss = FALSE;\nif(!isset($flag_second))\t$flag_second= FALSE;\n\n@ini_set('session.use_trans_sid',0);\n\nif(isset($subfolder) && !empty($subfolder)){\n    if(substr_count($subfolder, \"/\") < 1){ $subfolder .= \"/\"; }\n\t}\nelseif(isset($_GET['rss']) && ($_GET['rss'] == \"show_rssfeed\" || $_GET['rss'] == \"show_commentrssfeed\"))\n   $subfolder = \"../../\";\nelse\n\t$subfolder = \"\";\n\n// Globale Config-Datei einbinden\ninclude_once($subfolder.\"01_config.php\");\ninclude_once($subfolder.\"01acp/system/headinclude.php\");\nif(!$flag_second) include_once($subfolder.\"01acp/system/functions.php\");\n\n$modulvz = $modul.\"/\";\n// Modul-Config-Dateien einbinden\ninclude_once($moduldir.$modulvz.\"_headinclude.php\");\ninclude_once($moduldir.$modulvz.\"_functions.php\");\n\n// Variablen\n$imagepf \t= $moduldir.$modulvz.$imagepf;          // Pfad zum Bild-Verzeichnis\n$tempdir\t= $moduldir.$modulvz.$tempdir;\t\t\t// Template-Verzeichnis\n$filename\t= $_SERVER['SCRIPT_NAME'];\t            // Variable enth\u911ft die Adresse der Datei, auf der das Artikelsystem eingebunden wurde\n$flag_comments_js\t= TRUE;\t\t\t\t\t\t\t// Kommentar-Feld per Default via JavaScript ausblenden?\n\n// Language-File einbinden\ninclude_once($tempdir.\"lang_vars.php\");\n\n// Weitere Variablen +Bitte nehmen Sie hier keine \u74cfderungen vor+\n$sites\t\t\t\t= 0;\n$qt\t\t\t\t\t= 0;\n$svl2a\t\t\t\t= \"\";\n$qt_query\t\t\t= \"\";\n$flag_archiv\t\t= \"\";\n$flag_IamStandard\t= FALSE;\n\n// ggf. Zuweisung $show[] -> $_GET[]\nif(!isset($_REQUEST[$names['catid']]) && isset($show['catid']) && !empty($show['catid'])) $_REQUEST[$names['catid']] = $show['catid']; \nif(!isset($_REQUEST[$names['search']]) && isset($show['search']) && !empty($show['search'])) $_REQUEST[$names['search']] = $show['search'];\nif(!isset($_REQUEST[$names['page']]) && isset($show['page']) && !empty($show['page'])) $_REQUEST[$names['page']] = $show['page'];\nif(!isset($_GET[$names['artid']]) && isset($show['artid']) && !empty($show['artid'])) $_GET[$names['artid']] = $show['artid'];\n\n// Notice: Undefined index: ... beheben & strip_tags auf \u6685ergebene Werte anwenden (+ Anti-XSS)\nif(!isset($_REQUEST[$names['search']])) $_REQUEST[$names['search']] = \"\";\nelse $_REQUEST[$names['search']]\t\t= strip_tags($_REQUEST[$names['search']]);\nif(!isset($_REQUEST[$names['page']])) \t$_REQUEST[$names['page']] \t= \"\";\nelse $_REQUEST[$names['page']]\t\t\t= strip_tags($_REQUEST[$names['page']]);\nif(!isset($_REQUEST[$names['catid']])) \t$_REQUEST[$names['catid']] \t= \"\";\nelse $_REQUEST[$names['catid']]\t\t\t= strip_tags($_REQUEST[$names['catid']]);\nif(!isset($_REQUEST[$names['cpage']])) \t$_REQUEST[$names['cpage']] \t= \"\";\nelse $_REQUEST[$names['cpage']]\t\t\t= strip_tags($_REQUEST[$names['cpage']]);\nif(!isset($_REQUEST[$names['rss']])) \t$_REQUEST[$names['rss']] \t= \"\";\nelse $_REQUEST[$names['rss']]\t\t\t= strip_tags($_REQUEST[$names['rss']]);\nif(!isset($_GET[$names['artid']])) \t\t$_GET[$names['artid']] \t\t= \"\";\nelse $_GET[$names['artid']]\t\t\t\t= strip_tags($_GET[$names['artid']]);\nif(!isset($_GET[$names['cpage']])) \t\t$_GET[$names['cpage']] \t\t= \"\";\nelse $_GET[$names['cpage']]\t\t\t\t= strip_tags($_GET[$names['cpage']]);\nif(!isset($_GET[$names['rss']])) \t\t$_GET[$names['rss']] \t\t= \"\";\nelse $_GET[$names['rss']]\t\t\t\t= strip_tags($_GET[$names['rss']]);\nif(!isset($static))\t\t\t\t\t\t$static\t\t\t\t\t\t= 0;\nif(!isset($_POST['deaktiv_bbc']))\t\t$_POST['deaktiv_bbc']\t\t= 0;\nelse $_POST['deaktiv_bbc']\t\t\t\t= strip_tags($_POST['deaktiv_bbc']);\nif(!isset($_GET[$names['page']]) || isset($_GET[$names['page']]) && $_GET[$names['page']] != $_REQUEST[$names['page']]) $_GET[$names['page']] = $_REQUEST[$names['page']];  \nif(!isset($_POST['antispam']))          $_POST['antispam'] = \"\";\n\n//Link-String generieren\n$system_link \t\t= addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]);\n$system_link_index \t= parse_cleanerlinks(addParameter2Link($filename,$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]));\n$system_link_rss\t= $subfolder.\"01module/\".$modul.\"/01article.php\";\n\n\n\n\n\n// Ausf\ud849\udfb4rung der weiteren Seite wird nach dem Aufruf der n\u98c6igen RSS-Funktionen durch exit; unterbrochen\nif(isset($_GET[$names['rss']]) && ($_GET[$names['rss']] == \"show_rssfeed\" || $_GET[$names['rss']] == \"show_commentrssfeed\") && \n   $settings['rss_aktiv'] == 1 && ($settings['artikelrssfeedaktiv'] == 1 || $settings['artikelkommentarfeed'] == 1)){\n\t\n\tif(!isset($_GET['entries'])) $_GET['entries'] = \"\";\n\telse $_GET['entries'] = strip_tags($_GET['entries']);\n\n\tinclude_once($subfolder.\"01acp/system/includes/htmLawed.php\");\n\t\n\theader(\"Content-type: text/xml\");\n\techo _01article_RSS($_GET[$names['rss']],$_GET['entries'],$_REQUEST[$names['catid']]);\n\texit;\n\t}\nelseif(isset($_GET[$names['rss']]) && ($_GET[$names['rss']] == \"show_rssfeed\" || $_GET[$names['rss']] == \"show_commentrssfeed\")){\n\techo \"Fehler: Der RSS-Feed wurde deaktiviert!\";\n\texit;\n\t}\n\n\n// CSS-Datei einbinden\nif(isset($settings['extern_css']) && !empty($settings['extern_css']) && filter_var($settings['extern_css'], FILTER_VALIDATE_URL) !== FALSE && !$flag_nocss)\n\t$echo_css = \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"\".$settings['extern_css'].\"\\\" />\";\nelseif(!$flag_nocss)\n\t$echo_css = \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"\".$tempdir.\"style.css\\\" />\";\nelse $echo_css = \"\";\n\n// Alle Kategorien in einen mehrdimensionalen Array einlesen\n$listcat = $mysqli->query(\"SELECT * FROM \".$mysql_tables['cats'].\" ORDER BY sortid,name\");\nwhile($rowcat = $listcat->fetch_assoc()){\n\t$category[$rowcat['id']]['id'] \t\t= $rowcat['id'];\n\t$category[$rowcat['id']]['name']\t= htmlentities($rowcat['name'],$htmlent_flags,$htmlent_encoding_acp);\n\t$category[$rowcat['id']]['catpic']\t= $rowcat['catpic'];\n\t}\n\n\n\n\n// ggf. Archiv-Zeit berechnen\nif(!empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time']))\n\t$qt = time()-($settings['archiv_time']*24*60*60);\n\n// Alternative Abfrage, wenn nur ein Artikel / eine Seite angezeigt werden soll\nif(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && $_GET[$names['artid']] > 0 && is_numeric($_GET[$names['artid']])){\n    $query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime = '0') AND id = '\".$mysqli->escape_string($_GET[$names['artid']]).\"' LIMIT 1\";\n\t$iderror = 1;\n\n    //Hits +1:\n    $mysqli->query(\"UPDATE \".$mysql_tables['artikel'].\" SET hits = hits+1 WHERE id = '\".$mysqli->escape_string($_GET[$names['artid']]).\"' LIMIT 1\");\n    }\n// Archiv-Ansicht\nelseif(isset($_GET[$names['artid']]) && $_GET[$names['artid']] == \"archiv\" && !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time'])){\n    $flag_archiv = \"&amp;\".$names['artid'].\"=archiv\";\n\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n    $query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND (utimestamp <= '\".$qt.\"' OR (endtime <= '\".time().\"' AND endtime != '0')) AND (endtime <= '\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\") ORDER BY utimestamp DESC\";\n\n    $settings['articleperpage'] = ANZ_PP_ARCHIV;\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\n\t\n\t$iderror = 1;\n    }\n// Alle Artikel anzeigen\nelse{\n\tif(!empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time']))\n\t\t$qt_query = \"AND (utimestamp>'\".$qt.\"' OR top = '1' OR endtime >= '\".time().\"') \";\n\telse $qt_query = \"\";\n\t\n    if(isset($_REQUEST[$names['search']]) && !empty($_REQUEST[$names['search']]) && $settings['artikelsuche'] == 1){\n\t\tif($flag_utf8)\n\t\t\t$parsed_searchstring = $mysqli->escape_string(parse_uml(utf8_decode(str_replace(\"*\",\"\",$_REQUEST[$names['search']]))));\n\t\telse\n\t\t\t$parsed_searchstring = $mysqli->escape_string(parse_uml(str_replace(\"*\",\"\",$_REQUEST[$names['search']])));\n\n\t\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n        $add2query = \"AND MATCH (titel,content,zusammenfassung) AGAINST ('\".$parsed_searchstring.\"') >= \".FULLTEXT_INDEX_SEARCH_SCHWELLE.\" AND (\".$add2query_cat.\")\";\n        $iderror = 2;\t// Flag f\u50e1 Fehlermeldung in main_top\n\t\t}\n    elseif(isset($_REQUEST[$names['catid']]) && !empty($_REQUEST[$names['catid']])){\n        $add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n\t\t$add2query = $qt_query.\"AND (\".$add2query_cat.\") ORDER BY top DESC,utimestamp DESC\";\n\t\t$iderror = 3;\t// Flag f\u50e1 Fehlermeldung in main_top\n\t\t}\n    else{\n        $add2query = $qt_query.\"ORDER BY top DESC,utimestamp DESC\";\n        $flag_IamStandard = true;\n        $iderror = 1;\t// Flag f\u50e1 Fehlermeldung in main_top\n        }\n\n\t$query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') \".$add2query;\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\t\t\n\t}\n\n// List > 0?\n$list = $mysqli->query($query);\necho \"<!-- 2559ad821dde361560dbf967c3406f51 -->\";\n\n// Wenn nichts angezeigt werden konnte neuer Versuch mit Standardabfrage\nif($list->num_rows == 0 && !$flag_IamStandard){\n\t$query = \"SELECT * FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') \".$qt_query.\"ORDER BY top DESC,utimestamp DESC\";\n\tmakepages($query,$sites,$names['page'],$settings['articleperpage']);\n\t$list = $mysqli->query($query);\n\t\n\t$_GET[$names['artid']] = \"\";\n\t}\nelseif($list->num_rows > 0){\n\tif(isset($_REQUEST[$names['search']]) && !empty($_REQUEST[$names['search']]) && $settings['artikelsuche'] == 1)\n\t\t$iderror = 4;\n\telseif(isset($_REQUEST[$names['catid']]) && !empty($_REQUEST[$names['catid']]))\n\t    $iderror = 5;\n\telse\n\t\t$iderror = 0;\t// Flag f\u50e1 Fehlermeldung zur\ud846\udc77ksetzen, wenn mind. 1 Artikel angezeigt werden kann\n\t}\n\n\n\n\n// main_top einbinden\ninclude($tempdir.\"main_top.html\");\n\n\n\n\n\n// ARCHIV\nif(isset($_GET[$names['artid']]) && $_GET[$names['artid']] == \"archiv\" && !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && is_numeric($settings['archiv_time'])){\n    include($tempdir.\"archiv_top.html\");\n    \n\t$round = 1;\n\twhile($row = $list->fetch_assoc()){\n        if($round == 1){\n        \t$archiv_year = date(\"Y\",$row['utimestamp']);\n\t\t\t$archiv_month = date(\"n\",$row['utimestamp']);\n\t\t\t\n\t\t\tinclude($tempdir.\"archiv_top_year.html\");\n\t\t\tinclude($tempdir.\"archiv_top_month.html\");\n\t\t}\n\t\t\n\t\tif($archiv_year != date(\"Y\",$row['utimestamp'])){\n\t\t\t$archiv_year = date(\"Y\",$row['utimestamp']);\n\t\t\tinclude($tempdir.\"archiv_top_year.html\");\n\t\t\t}\n\t\tif($archiv_month != date(\"n\",$row['utimestamp'])){\n\t\t\t$archiv_month = date(\"n\",$row['utimestamp']);\n\t\t\tinclude($tempdir.\"archiv_top_month.html\");\n\t\t\t}\n\t\t\n\t\t$datum = date(\"d.m.y\",$row['utimestamp']).\", \".date(\"G:i\",$row['utimestamp']);\n        $titel = $row['titel'];\n\t\t\n        $username_array = getUserdatafields($row['uid'],\"username\");\n\t\t$autor = htmlentities($username_array['username'],$htmlent_flags,$htmlent_encoding_acp);\n\t\t\n        include($tempdir.\"archiv_bit.html\");\n        $round++;\n        }\n\t\t\n    include($tempdir.\"archiv_bottom.html\");\n\t$iderror = 0;\n    }\n\t\n\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// NORMALE AUSGABE\nelse{\n\twhile($row = $list->fetch_assoc()){\n        $datum \t\t= date(\"d.m.y\",$row['utimestamp']);\n        $uhrzeit \t= date(\"G:i\",$row['utimestamp']);\n\n        //Catid & Catimage auslesen\n        if($row['newscatid'] != \"0\"){\n            $c = 0;\n\t\t\t$catimg = \"\"; $catname = \"\";\n            $newscatids_array = explode(\",\",substr($row['newscatid'],1,strlen($row['newscatid'])-2));\n            foreach($newscatids_array as $newscatid_s){\n\t\t\t\tif(isset($category[$newscatid_s]['name'])){\n                    if(isset($category[$newscatid_s]['catpic']) && $category[$newscatid_s]['catpic'] != \"\")\n                        $catimg .= \"<a href=\\\"\".addParameter2Link($filename,$names['catid'].\"=\".$newscatid_s).\"\\\"><img src=\\\"\".$catuploaddir.$category[$newscatid_s]['catpic'].\"\\\" alt=\\\"Kategorie: \".$category[$newscatid_s]['name'].\"\\\" title=\\\"Kategorie: \".$category[$newscatid_s]['name'].\"\\\" align=\\\"left\\\" /></a> \";\n                    else\n                        $catimg .= \"\";\n\t\t\t\t\t\t\n                    if($c > 0) $catname .= \", \";\n                    $catname .= \"<a href=\\\"\".addParameter2Link($filename,$names['catid'].\"=\".$newscatid_s).\"\\\" class=\\\"catlink\\\">\".$category[$newscatid_s]['name'].\"</a>\";\n                    $c++;\n\t\t\t\t\t}\n                }\n            }\n        else{ $catimg = \"\"; $catname = \"\"; }\n\n\t\t$more = 0;\n\t\t// Normalen, kompletten Haupttext anzeigen\n\t\tif((isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) ||\n\t\t   $settings['artikeleinleitung'] == 0 ||\n\t\t   $settings['artikeleinleitung'] == 2 && $row['autozusammen'] == 0 && empty($row['zusammenfassung'])) &&\n\t\t   (!isset($_REQUEST[$names['search']]) || isset($_REQUEST[$names['search']]) && empty($_REQUEST[$names['search']]) || $iderror == 2)){\n\n\t        $artikeltext = $row['content'];\n\t\t\t$artikeltext = str_replace(\"../01pics/\",$picuploaddir,$artikeltext);\n\t\t\t$artikeltext = str_replace(\"../01files/\",$attachmentuploaddir,$artikeltext);\n\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t\t\t$artikeltext = preg_replace_callback(\"/\\{Insert#(\\d+)GalleryPicsFrom#(\\d+)\\}/\",\"_01article_callback_GetGalThumbs4Article\",$artikeltext);\n\t\t\t}\n\t\t// Zusammenfassung anzeigen\n\t\telse{\n\t        if($row['autozusammen'] == 0 && !empty($row['zusammenfassung'])){\n\t            $artikeltext = $row['zusammenfassung'];\n\t\t\t\t$artikeltext = str_replace(\"../01pics/\",$picuploaddir,$artikeltext);\n\t\t\t\t$artikeltext = str_replace(\"../01files/\",$attachmentuploaddir,$artikeltext);\n\t\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t            }\n\t        else{\n\t\t\t\t$artikeltext = \"<p>\".substr(strip_tags($row['content']),0,$settings['artikeleinleitungslaenge']).$lang['weiterlesen'].\"</p>\";\n\t\t\t\tif($settings['artikellightbox'] == 1) $artikeltext = str_replace(\"class=\\\"lightbox\\\"\",\"class=\\\"lightbox\\\" rel=\\\"lightbox-art\".$row['id'].\"\\\"\",$artikeltext);\n\t\t\t\t}\n\t\t\t$artikeltext = preg_replace_callback(\"/\\{Insert#(\\d+)GalleryPicsFrom#(\\d+)\\}/\",\"_01article_callback_GetGalThumbs4Article\",$artikeltext);\n\n\t\t\t// Weiterlesen-Link nur einbinden, wenn Text l\u911ager als Zusammenfassung oder eigener Text eingegeben wurde\n\t\t\tif($row['autozusammen'] == 0 && !empty($row['zusammenfassung']) || \n\t\t\t   strlen($artikeltext) < strlen($row['content']))\n\t\t\t\t$more = 1;\n\t\t\telse $more = 0;\n\t\t\t}\n\n        // Anzahl bisheriger Kommentare ermitteln\n        if($settings['comments'] == 1){ \n\t\t\t$comments = 0;\n\t\t\tlist($comments) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul = '\".$mysqli->escape_string($modul).\"' AND postid = '\".$row['id'].\"'\")->fetch_array(MYSQLI_NUM);\n\t\t\t}\n\n        // Weitere Variablen f\u50e1 die Template-Ausgabe aufbereiten\n        $username_array = getUserdatafields($row['uid'],\"username,01acp_signatur\");\n\t\t$username = htmlentities($username_array['username'],$htmlent_flags,$htmlent_encoding_acp);\n\t\tif(!empty($username_array['signatur']) && $more == 0 && $row['hide_signature'] == 0)\n\t\t\t$signatur = \"<p class=\\\"signatur\\\">\".nl2br(str_replace(\"&\",\"&amp;\",$username_array['signatur'])).\"</p>\";\n            if($flag_utf8) $signatur = utf8_encode($signatur);\n\t\telse\n\t\t\t$signatur = \"\";\n\t\t\n        $titel = $row['titel'];\n\t\t$static = $row['static'];\n        $system_link_row = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($row['id'],$row['titel'],$row['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']]));\n        \n\t\t// Get serialized data\n\t\tif($ser_fields){\n\t\t\t$return_temp = unserialize($row['serialized_data']);\n\n\t\t\tif(empty($return_temp)){\n\t\t\t\tfor($x=1;$x<=ANZ_SER_FIELDS;$x++){\n\t\t\t\t\t$row['ser_field_'.$x] = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\tfor($x=1;$x<=ANZ_SER_FIELDS;$x++){\n\t\t\t\t\t$row['ser_field_'.$x] = htmlspecialchars($return_temp['field_'.$x],$htmlent_flags,$htmlent_encoding_acp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t// artikel_self-Link\n        $artikeltext = str_replace(\"{artikel_self}\",$system_link_row,$artikeltext);\n\n        // ggf. Links zum vorherigen / n\u8e04hsten Eintrag generieren\n        if(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && $row['static'] == 0){\n\t\t\t$add2query_cat = _01article_CreateCatQuery($_REQUEST[$names['catid']]);\n\t\t\n\t\t\t$listnext = $mysqli->query(\"SELECT id,utimestamp,titel FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp > '\".$row['utimestamp'].\"' AND utimestamp <= '\".time().\"' AND (endtime>='\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\") ORDER BY utimestamp LIMIT 1\");\n            $rownext = $listnext->fetch_assoc();\n            $next_link = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($rownext['id'],$rownext['titel'],$rownext['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\"));\n            $next_titel = $rownext['titel'];\n\t\t\t\n            $listprev = $mysqli->query(\"SELECT id,utimestamp,titel FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static='0' AND utimestamp < '\".$row['utimestamp'].\"' AND (endtime>='\".time().\"' OR endtime = '0') AND (\".$add2query_cat.\")  ORDER BY utimestamp DESC LIMIT 1\");\n            $rowprev = $listprev->fetch_assoc();\n            $prev_link = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($rowprev['id'],$rowprev['titel'],$rowprev['utimestamp']),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\"));\n            $prev_titel = $rowprev['titel'];\n            }\n\n        // Template einbinden\n        include($tempdir.\"artikel.html\");\n\n\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t// KOMMENTAR-AUSGABE & FORMULAR, etc.\n\t\tif(isset($_GET[$names['artid']]) && !empty($_GET[$names['artid']]) && $_GET[$names['artid']] > 0 && \n\t\t   is_numeric($_GET[$names['artid']]) && $_GET[$names['artid']] != \"archiv\" && \n\t\t   $settings['comments'] == 1 && $settings['artikelcomments'] >= 1 && $row['comments'] == 1){\n            \n            // Anti-XSS\n            if(isset($_POST['send_comment']))\t$_POST['send_comment']\t\t= strip_tags($_POST['send_comment']);\n            if(isset($_POST['modul_comment']))\t$_POST['modul_comment']\t\t= strip_tags($_POST['modul_comment']);\n            if(isset($_POST['autor']))\t\t\t$_POST['autor']\t\t\t\t= filter_var($_POST['autor'],FILTER_SANITIZE_SPECIAL_CHARS);\n            if(isset($_POST['email']))\t\t\t$_POST['email']\t\t\t\t= strip_tags($_POST['email']);\n            if(isset($_POST['url']))\t\t\t$_POST['url']\t\t\t\t= strip_tags($_POST['url']);\n            if(isset($_POST['comment']))\t\t$_POST['comment']\t\t\t= strip_tags($_POST['comment']);\n            if(isset($_POST['antispam']))\t\t$_POST['antispam']\t\t\t= strip_tags($_POST['antispam']);\n            if(isset($_POST['deaktiv_bbc']))\t$_POST['deaktiv_bbc']\t\t= strip_tags($_POST['deaktiv_bbc']);\n            if(isset($_POST['uid']))\t\t\t$_POST['uid']\t\t\t\t= strip_tags($_POST['uid']);\n\t\t\t\n\t\t\t$message = 0;\n            // Neuen Kommentar hinzuf\u5790en\n            if(isset($_POST['send_comment']) && $_POST['send_comment'] == 1 &&\n\t\t\t   isset($_POST['modul_comment']) && $_POST['modul_comment'] == $modul){\n\t\t\t\t\t$message = insert_Comment($_POST['autor'],$_POST['email'],$_POST['url'],$_POST['comment'],$_POST['antispam'],$_POST['deaktiv_bbc'],$row['id'],$_POST['uid'],0,$_POST['link'],$_POST['time']);\n\t\t\t\t}\n\n\t\t\t//Template einbinden\n            include($tempdir.\"comments_head.html\");\n\n            // KOMMENTARE AUSGEBEN\n            $nr = 1;\n            $comment_query = \"SELECT * FROM \".$mysql_tables['comments'].\" WHERE modul='\".$modul.\"' AND postid='\".$row['id'].\"' AND frei='1' ORDER BY utimestamp \".$mysqli->escape_string($comment_desc).\"\";\n            \n\t\t\t// Seiten-Funktion\n            if($settings['comments_perpage'] > 0){\n                $comment_sc = $mysqli->query($comment_query)->num_rows;\n                $comment_sites = ceil($comment_sc/$settings['comments_perpage']);    //=Anzahl an Seiten\n\t\t\t\t\n                if(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] == \"last\" && $comment_sites > 1){\n                    $_GET[$names['cpage']] = $comment_sites;\n                    $commentsstart = $comment_sites*$settings['comments_perpage']-$settings['comments_perpage'];\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($commentsstart).\",\".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                    $nr = $commentsstart+1;\n                    }\n                elseif(isset($_GET[$names['cpage']]) && !empty($_GET[$names['cpage']]) && $_GET[$names['cpage']] <= $comment_sites && $comment_sites > 1){\n                    $commentsstart = $_GET[$names['cpage']]*$settings['comments_perpage']-$settings['comments_perpage'];\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($commentsstart).\",\".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                    $nr = $commentsstart+1;\n                    }\n                else\n                    $comment_query .= \" LIMIT \".$mysqli->escape_string($settings['comments_perpage']).\"\";\n                }\n\n            $clist = $mysqli->query($comment_query);\n            while($crow = $clist->fetch_assoc()){\n                \n\t\t\t\t// URL\n                if(!empty($crow['url']) && $crow['url'] != \"http://\"){\n                    if(substr_count($crow['url'], \"http://\") < 1)\n\t\t\t\t\t\t$url = \"http://\".$crow['url'];\n\t\t\t\t\telse\n\t\t\t\t\t\t$url = $crow['url']; \n                    }\n                else $url = \"\";\n\n                // Weitere Variablen f\u50e1 die Template-Ausgabe aufbereiten\n                $datum = date(\"d.m.y - G:i\",$crow['utimestamp']);\n                $autorenname = $crow['autor'];\n                $comment_id = $crow['id'];\n\n                // BB-Code & Smilies\n                $comment = $crow['message'];\n                if($crow['bbc'] == 1 && $settings['comments_bbc'] == 1 && $crow['smilies'] == 1 && $settings['comments_smilies'] == 1)\n\t\t\t\t\t$comment = bb_code_comment($comment,1,1,1);\n\t\t\t\telseif($crow['bbc'] == 1 && $settings['comments_bbc'] == 1 && ($crow['smilies'] == 0 || $settings['comments_smilies'] == 0))\n\t\t\t\t\t$comment = bb_code_comment($comment,1,1,0);\n\t\t\t\telseif(($crow['bbc'] == 0 || $settings['comments_bbc'] == 0) && $crow['smilies'] == 1 && $settings['comments_smilies'] == 1)\n\t\t\t\t\t$comment = bb_code_comment($comment,1,0,1);\n\t\t\t\telse \n\t\t\t\t\t$comment = nl2br($comment);\n\n                // Template ausgeben\n                include($tempdir.\"commentbit.html\");\n\n                $nr++;\n                }\n\n            //Seiten (Kommentare) ausgeben\n            if($comment_sites > 1 && $settings['comments_perpage'] > 0){\n                if(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] > 1){\n                    $c_sz = $_GET[$names['cpage']]-1;\n                    if($c_sz > 1)\n\t\t\t\t\t\t$c_szl1 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=1&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    $c_szl2 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$c_sz.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    }\n                else{ $c_szl1 = \"\"; $c_szl2 = \"\"; $c_sz = 0; }\n                \n\t\t\t\tif(!isset($_GET[$names['cpage']]) || isset($_GET[$names['cpage']]) && empty($_GET[$names['cpage']]))\n                    {\n                    $comment_current = 1;\n                    if($comment_sites > 1) $c_sv = 2;\n                    }\n                else{\n                    $comment_current = $_GET[$names['cpage']];\n                    $c_sv = $_GET[$names['cpage']]+1;\n                    }\n                \n\t\t\t\tif(isset($_GET[$names['cpage']]) && $_GET[$names['cpage']] < $comment_sites || !isset($_GET[$names['cpage']]) && $comment_sites > 1){\n                    $c_svl1 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$c_sv.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    if($c_sv != $comment_sites)\n\t\t\t\t\t\t$c_svl2 = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$comment_sites.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments\"));\n                    }\n                else{ $c_svl1 = \"\"; $c_svl2 = \"\"; }\n                }\n\n\t\t\t//Template ausgeben\n            if($message > 2) $flag_comments_js = FALSE;\t\t\t// Formular nicht per JS ausblenden, wenn eine Fehlermeldung erzeugt wurde.\n            include($tempdir.\"comments_end.html\");\n\n            //Unterschiedliche Sprungmarken nach Absenden des Kommentarformulars\n            if(!isset($jumpto_id)) $jumpto_id = \"\";\n\t\t\tif($settings['commentfreischaltung'] == 0) $jumpto = \"01comment\".$jumpto_id; else $jumpto = \"01jumpcomments\";\n            if($comment_desc == \"\") $jumpto_csite = \"last\"; else $jumpto_csite = \"1\";\n\t\t\t\n            $system_link_form = parse_cleanerlinks(addParameter2Link(_01article_echo_ArticleLink($_GET[$names['artid']]),$names['page'].\"=\".$_REQUEST[$names['page']].\"&amp;\".$names['cpage'].\"=\".$jumpto_csite.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpcomments_add\"));\n\n            if($settings['artikelcomments'] == 1){\n\t\t\t\t$zahl = mt_rand(1, 9999999999999);\n\t\t\t\t$uid = md5(time().$_SERVER['REMOTE_ADDR'].$zahl.$_GET[$names['artid']]);\n\t\t\t\t//Template ausgeben\n                include($tempdir.\"comments_add.html\");\n                }\n            elseif ($settings['artikelcomments'] == 2 && !empty($settings['Disqus_Username'])) {\n                include($tempdir.\"comments_disqus.html\");\n                }\n            }\n        unset($catimg);\n        unset($catname);\n        }\n    }\n\n// Ausgabe der Seiten\nif($sites > 1){\n    $option_sites = \"\";\n\tfor($o=1;$o<=$sites;$o++){\n        $option_sites .= \"<option>\".$o.\"</option>\\n\";\n        }\n\n    if(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] > 1){\n        $sz = $_REQUEST[$names['page']]-1;\n\n        if($sz != 1)\n\t\t\t$szl1 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=1&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n\t\telse $szl1 = \"\";\n\n\t\t$szl2 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sz.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n        }\n    else{ $szl1 = \"\"; $szl2 = \"\"; }\n\t\n    if(!isset($_REQUEST[$names['page']]) || isset($_REQUEST[$names['page']]) && empty($_REQUEST[$names['page']])){\n        $current = 1;\n        if($sites > 1){ $sv = 2; }\n        }\n    else{\n        $current = $_REQUEST[$names['page']];\n        $sv = $_REQUEST[$names['page']]+1;\n        }\n    \n\tif(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] < $sites || !isset($_REQUEST[$names['page']]) && $sites > 1){\n        \n\t\t$svl1 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sv.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\")); \n        if($sv != $sites) \n\t\t\t$svl2 = parse_cleanerlinks(addParameter2Link($filename,$names['page'].\"=\".$sites.\"&amp;\".$names['search'].\"=\".$_REQUEST[$names['search']].\"&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].$flag_archiv.\"#01jumpartikel\"));\n        }\n    else{\n\t\t$svl1 = \"\";\n\t\t$svl2 = \"\";\n\n\t\tif(isset($_REQUEST[$names['page']]) && $_REQUEST[$names['page']] == $sites &&\n\t\t   !empty($settings['archiv_time']) && $settings['archiv_time'] > 0 && $_GET[$names['artid']] != \"archiv\")\n\t\t\t$svl2a = \"<a href=\\\"\".parse_cleanerlinks(addParameter2Link($filename,$names['artid'].\"=archiv&amp;\".$names['catid'].\"=\".$_REQUEST[$names['catid']].\"#01jumpartikel\")).\"\\\">Archiv &raquo;</a>\";\n\t\t}\n    }\n\n// Kategorien vorhanden? --> Ausgeben\nif(isset($category) && count($category) > 0){\n\t$listcats = \"\";\n\tforeach($category as $cat){\n\t\t// Sind Eintr\u8f0de dieser Kategorie zugeordnet?\n\t\tif($qt > 0)\n\t\t\tlist($newsvorhanden) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND utimestamp <= '\".time().\"' AND utimestamp>'\".$qt.\"' AND (endtime >= '\".time().\"' OR endtime='0') AND newscatid LIKE '%,\".$cat['id'].\",%'\")->fetch_array(MYSQLI_NUM);\n\t\telse\n\t\t\tlist($newsvorhanden) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['artikel'].\" WHERE frei='1' AND hide='0' AND static = '0' AND utimestamp <= '\".time().\"' AND (endtime >= '\".time().\"' OR endtime='0') AND newscatid LIKE '%,\".$cat['id'].\",%'\")->fetch_array(MYSQLI_NUM);\n\t\t\n\t\tif($newsvorhanden > 0)\n\t\t\t$listcats .= \"<option value=\\\"\".$cat['id'].\"\\\">\".$cat['name'].\" (\".$newsvorhanden.\")</option>\\n\";\n\n\t\t$newsvorhanden = 0;    \n\t\t}\n\t}\n\n//Template einbinden\ninclude($tempdir.\"pages.html\");\n\n//Template einbinden\ninclude($tempdir.\"main_bottom.html\");\n\n$tempdir\t= \"templates/\";\n$query\t\t= \"\";\n\n?>"], "filenames": ["01article.php"], "buggy_code_start_loc": [13], "buggy_code_end_loc": [586], "fixing_code_start_loc": [13], "fixing_code_end_loc": [586], "type": "CWE-79", "message": "A vulnerability was found in 01-Scripts 01-Artikelsystem. It has been classified as problematic. Affected is an unknown function of the file 01article.php. The manipulation of the argument $_SERVER['PHP_SELF'] leads to cross site scripting. It is possible to launch the attack remotely. The name of the patch is ae849b347a58c2cb1be38d04bbe56fc883d5d84a. It is recommended to apply a patch to fix this issue. VDB-217662 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2021-4310", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-09T09:15:09.940", "lastModified": "2023-01-13T12:56:45.903", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in 01-Scripts 01-Artikelsystem. It has been classified as problematic. Affected is an unknown function of the file 01article.php. The manipulation of the argument $_SERVER['PHP_SELF'] leads to cross site scripting. It is possible to launch the attack remotely. The name of the patch is ae849b347a58c2cb1be38d04bbe56fc883d5d84a. It is recommended to apply a patch to fix this issue. VDB-217662 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:01-scripts:01-artikelsystem:*:*:*:*:*:01acp:*:*", "versionEndExcluding": "2021-09-15", "matchCriteriaId": "AF9215EA-109F-45DA-A9BF-3AD88BD9B852"}]}]}], "references": [{"url": "https://github.com/01-Scripts/01-Artikelsystem/commit/ae849b347a58c2cb1be38d04bbe56fc883d5d84a", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217662", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217662", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/01-Scripts/01-Artikelsystem/commit/ae849b347a58c2cb1be38d04bbe56fc883d5d84a"}}