{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.1\">\n  <web>FlamingoThemesCode</web>\n  <name>WebHomeSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('platform.flamingo.themes.home.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n################################\n## Globals\n################################\n#set ($discard = $xwiki.ssx.use('FlamingoThemesCode.WebHomeSheet'))\n####################################\n## CONTROLLER\n####################################\n#if($request.action == 'setTheme')\n  #setTheme()\n#elseif($request.action == 'setThemeSuccess')\n  #prepareView()\n  #setThemeSuccess()\n  #view()\n#elseif($request.action == 'create')\n  #create()\n#else\n  #prepareView()\n  #view()\n#end\n####################################\n## PREPARE VIEW\n####################################\n#macro(prepareView)\n  #set ($currentTheme = $xwiki.getXWikiPreference('colorTheme'))\n  #if (\"$!currentTheme\" == '')\n    #set ($currentTheme = 'FlamingoThemes.Charcoal')\n  #end\n  #set ($currentThemeDoc = $xwiki.getDocument($currentTheme))\n  #set ($isSubWiki = $services.wiki.currentWikiId != $services.wiki.mainWikiId)\n  #set ($flamingoThemesFromThisWiki = [])\n  #getFlamingoThemes($services.wiki.currentWikiId, $flamingoThemesFromThisWiki)\n  #if ($isSubWiki)\n    #set ($flamingoThemesFromMainWiki = [])\n    #getFlamingoThemes($services.wiki.mainWikiId,  $flamingoThemesFromMainWiki)\n  #end\n  #set ($currentScope = 'local')\n  #if (\"$!currentTheme\" != '' &amp;&amp; $services.model.resolveDocument($currentTheme).wikiReference.name == $services.wiki.mainWikiId)\n    #set ($currentScope = 'global')\n  #end\n#end\n################################\n## Get Flamingo themes\n################################\n#macro(getFlamingoThemes $wiki $return)\n  #set ($results = [])\n  #set ($xwql = \"from doc.object(FlamingoThemesCode.ThemeClass) obj WHERE doc.fullName &lt;&gt; 'FlamingoThemesCode.ThemeTemplate' ORDER BY doc.name\")\n  #getThemesFromQuery ($xwql, $wiki, $results)\n  #set ($return = $NULL)\n  #setVariable (\"$return\", $results)\n#end\n################################\n## Get themes from a query\n################################\n#macro(getThemesFromQuery $xwql $wiki $return)\n  #set ($wikiReference = $services.model.createWikiReference($wiki))\n  #set ($themes = $services.query.xwql($xwql).setWiki($wiki).execute())\n  #set ($themesRef = [])\n  #foreach ($theme in $themes)\n    #set ($themeRef = $services.model.resolveDocument($theme, 'default', $wikiReference))\n    #if ($services.security.authorization.hasAccess('view', $xcontext.userReference, $themeRef))\n      #set ($discard = $themesRef.add($themeRef))\n    #end\n  #end\n  #set ($return = $NULL)\n  #setVariable(\"$return\" $themesRef)\n#end\n####################################\n## VIEW\n####################################\n#macro(view)\n  (% class=\"theme-viewer\" %)\n  (((\n    ## Display a warning about old color themes (if any)\n    #if($xwiki.exists($services.model.createDocumentReference('', 'ColorThemes', 'ColorThemeClass')) &amp;&amp; $xwiki.exists($services.model.createDocumentReference('', 'ColorThemes', 'WebHome')))\n      {{info}}\n        $services.localization.render('platform.flamingo.themes.home.warningOldColorThemeInstalled', [\"[[\", \"&gt;&gt;ColorThemes.WebHome]]\"])\n      {{/info}}\n    #end\n    \n    ## Display the current theme\n    == $services.localization.render('platform.flamingo.themes.home.currenttheme') ==\n    #if($currentThemeDoc.getObject('ColorThemes.ColorThemeClass'))\n      {{warning}}\n        $services.localization.render('platform.flamingo.themes.home.warningCurrentOldColorTheme')\n      {{/warning}}\n    #end\n    #displayTheme($currentThemeDoc.documentReference, $currentScope)\n    \n    ## Display the other themes\n    ## Creation form\n    #creationForm()\n    \n    == $services.localization.render('platform.flamingo.themes.home.otherthemes') ==\n    #if ($isSubWiki &amp;&amp; !$flamingoThemesFromMainWiki.isEmpty())\n      {{html}}\n      &lt;ul class=\"nav nav-tabs\" role=\"tablist\"&gt;\n        &lt;li role=\"presentation\" class=\"active\"&gt;&lt;a href=\"#local\" role=\"tab\" data-toggle=\"tab\"&gt;$escapetool.xml($services.localization.render('platform.flamingo.themes.local'))&lt;/a&gt;&lt;/li&gt;\n        &lt;li role=\"presentation\"&gt;&lt;a href=\"#global\" role=\"tab\" data-toggle=\"tab\"&gt;$escapetool.xml($services.localization.render('platform.flamingo.themes.global'))&lt;/a&gt;&lt;/li&gt;\n      &lt;/ul&gt;\n      {{/html}}\n      \n      (% class=\"tab-content\" %)\n      (((\n        (% class=\"tab-pane active\" id=\"local\" %)\n        (((\n          #foreach($themeRef in $flamingoThemesFromThisWiki)\n            #displayTheme($themeRef, 'local')\n          #end\n        )))\n        \n        (% class=\"tab-pane\" id=\"global\" %)\n        (((\n          #foreach($themeRef in $flamingoThemesFromMainWiki)\n            #displayTheme($themeRef, 'global')\n          #end\n        )))\n      )))\n    #else\n      #foreach($themeRef in $flamingoThemesFromThisWiki)\n        #displayTheme($themeRef, 'local')\n      #end\n    #end\n  )))\n#end\n####################################\n## DISPLAY THEME\n####################################\n#macro(displayTheme $themeReference $scope)\n  #if ($scope == 'local')\n    #set ($fullName = $services.model.serialize($themeReference, 'local'))\n  #else\n    #set ($fullName = $services.model.serialize($themeReference, 'default'))\n  #end\n  #set ($isCurrentTheme = ($currentThemeDoc.documentReference == $themeReference))\n  #set ($themeDoc = $xwiki.getDocument($themeReference))\n  #set ($themeObj = $themeDoc.getObject('FlamingoThemesCode.ThemeClass'))\n  (% class=\"theme #if($isCurrentTheme) current-theme#end\" %)\n  (((\n    ## Display the mockup\n    #themeMockup($themeObj)\n    ## Display the informations\n    (% class=\"theme-info\" %)\n    (((\n      === [[$themeDoc.displayTitle&gt;&gt;$fullName]] #if ($isSubWiki &amp;&amp; $scope == 'local') ($services.wiki.currentWikiId)#end===\n      #if ($hasAdmin &amp;&amp; !$isCurrentTheme)\n        $services.icon.render('bullet_go') [[$services.localization.render('platform.flamingo.themes.home.useThisTheme')&gt;&gt;path:$doc.getURL('view', \"action=setTheme&amp;theme=${fullName}&amp;form_token=$services.csrf.token\")]]\n      #end\n    )))\n  )))\n#end\n####################################\n## THEME MOCKUP\n####################################\n#macro(themeMockup $themeObj)\n  #macro(displayValue $variableName $fallback)\n    #set($value = $themeObj.getValue($variableName))\n    #if(\"$!value\" == '')\n      #set($value = $fallback)\n    #end\n    $value##\n  #end\n\n  {{html}}\n    &lt;div class=\"mockup-page\" style=\"background-color: #displayValue('body-bg', '#fff')\"&gt;\n      ## A fake navbar\n      &lt;div class=\"mockup-navbar\" style=\"background-color: #displayValue('navbar-default-bg', '#eee')\"&gt;\n        ## A fake logo\n        &lt;div class=\"mockup-logo\"&gt;&lt;/div&gt;\n        ## A fake menu\n        &lt;div class=\"mockup-navbar-menu\" style=\"border-color: #displayValue('navbar-default-color', '#000')\"&gt;&lt;/div&gt;\n        ## A fake add button\n        &lt;div class=\"mockup-add-button\" style=\"background-color: #displayValue('btn-success-bg', '#4D9244')\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake page content\n      &lt;div class=\"mockup-page-content\" style=\"background-color: #displayValue('xwiki-page-content-bg', '#fff')\"&gt;\n        &lt;div class=\"mockup-title\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text1\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text2\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text3\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text4\" style=\"border-color: #displayValue('link-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text5\" style=\"border-color: #displayValue('text-color', '#0000ff')\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake app bar \n      &lt;div class=\"mockup-left-panel\" style=\"color: #displayValue('link-color', '#0000ff')\"&gt;&lt;/div&gt;\n      \n      ## A fake right panel\n      &lt;div class=\"mockup-right-panel\"&gt;\n        &lt;div class=\"mockup-right-panel-header\" style=\"color: #displayValue('panel-default-text', '#000'); background-color: #displayValue('panel-bg', '#fff')\"&gt;\n          &lt;div class=\"mockup-right-panel-header-text\" style=\"border-color: #displayValue('panel-default-text', '#000')\"&gt;&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"mockup-right-panel-contents\" style=\"background-color: #displayValue('panel-bg', '#fff')\"&gt;\n          &lt;div class=\"mockup-right-panel-text1\" style=\"background-color: #displayValue('panel-default-text', '#000')\"&gt; &lt;/div&gt;\n          &lt;div class=\"mockup-right-panel-text2\" style=\"background-color: #displayValue('panel-default-text', '#000')\"&gt; &lt;/div&gt;\n          &lt;div class=\"mockup-right-panel-text3\" style=\"background-color: #displayValue('link-color', '#0000ff')\"&gt; &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake footer\n      &lt;div class=\"mockup-footer\" style=\"background-color: #displayValue('navbar-default-bg', '#fff')\"&gt;\n        &lt;div class=\"mockup-footer-content\" style=\"border-color: #displayValue('navbar-default-link-color', '#000')\"&gt;\n      &lt;/div&gt;\n      \n    &lt;/div&gt;\n  {{/html}}\n  \n#end\n####################################\n## CREATION FORM\n####################################\n#macro(creationForm)\n  #if($xwiki.hasAccessLevel('edit', $xcontext.user, 'FlamingoThemes.AnyPage____________'))\n    (% class=\"clearfix\" %)\n    (((\n  \n    {{html}}\n      &lt;div class=\"theme-creation-form\" &gt;\n        &lt;form action=\"$doc.getURL()\" method=\"post\" class=\"form-inline\"&gt;\n          &lt;input type=\"hidden\" name=\"form_token\" value=\"$services.csrf.token\" /&gt;\n          &lt;input type=\"hidden\" name=\"action\" value=\"create\"/&gt;\n          &lt;label for=\"newThemeName\" class=\"hidden\"&gt;$services.localization.render('platform.flamingo.themes.home.newThemeName')&lt;/label&gt;\n          &lt;input type=\"text\" name=\"newThemeName\" id=\"newThemeName\" value=\"$services.localization.render('platform.flamingo.themes.home.newThemeName')\" class=\"withTip\" size=\"30\"/&gt;\n          &lt;input type=\"submit\" value=\"$services.localization.render('platform.flamingo.themes.home.create')\" class=\"button\"/&gt;\n        &lt;/form&gt;\n      &lt;/div&gt;\n    {{/html}}\n    \n    )))\n  #end\n#end\n####################################\n## CREATE A NEW THEME\n####################################\n#macro(create)\n  #if(\"$!request.newThemeName\" == '')\n    {{error}}\n      {{translation key=\"platform.flamingo.themes.home.create.invalid\" /}}\n    {{/error}}\n    \n    #creationForm()\n  #elseif(!$services.csrf.isTokenValid($request.form_token))\n    {{error}}\n      {{translation key=\"platform.flamingo.themes.home.create.csrf\" parameters=\"$request.newThemeName\" /}}\n    {{/error}}\n    \n    {{html}}\n      &lt;form action=\"$doc.getURL()\" method=\"post\"&gt;\n        &lt;input type=\"hidden\" name=\"form_token\" value=\"$services.csrf.token\" /&gt;\n        &lt;input type=\"hidden\" name=\"action\" value=\"create\"/&gt;\n        &lt;input type=\"hidden\" name=\"newThemeName\" id=\"newThemeName\" value=\"$request.newThemeName\" /&gt;\n        &lt;input type=\"submit\" value=\"$services.localization.render('platform.flamingo.themes.home.create.confirm')\" class=\"button\"/&gt;\n      &lt;/form&gt;\n    {{/html}}\n  #else\n    ## Let's do it\n    $response.sendRedirect($xwiki.getDocument($services.model.createDocumentReference('', 'FlamingoThemes', $request.newThemeName)).getURL('edit', \"template=FlamingoThemesCode.ThemeTemplate&amp;title=$escapetool.url($request.newThemeName)&amp;parent=$doc.fullName&amp;xhidden=1\"))\n  #end\n#end\n####################################\n## SET THEME\n####################################\n#macro(setTheme)\n  #if(\"$!request.theme\" != '' &amp;&amp; $hasAdmin &amp;&amp; ${services.csrf.isTokenValid(\"$!{request.getParameter('form_token')}\")})\n    #set($preferencesDoc = $xwiki.getDocument('XWiki.XWikiPreferences'))\n    #set($preferencesObj = $preferencesDoc.getObject('XWiki.XWikiPreferences'))\n    $preferencesObj.set('colorTheme', $request.theme)\n    $preferencesDoc.save()\n    $response.sendRedirect($doc.getURL('view', \"theme=$escapetool.url($request.theme)&amp;action=setThemeSuccess\"))\n  #end\n#end\n####################################\n## SET THEME SUCCESS\n####################################\n#macro(setThemeSuccess)\n  #if(\"$!request.theme\" != '')\n  \n    {{success}}\n      $services.localization.render('platform.flamingo.themes.home.set.success', [$xwiki.getDocument($request.theme).displayTitle])\n    {{/success}}\n    \n  #end\n#end\n{{/velocity}}\n</content>\n  <object>\n    <name>FlamingoThemesCode.WebHomeSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>36837eed-1247-4e50-9e0d-0abc7f698eed</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <disabled>0</disabled>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#template('colorThemeInit.vm')\n.theme {\n  border: 1px dotted $theme.borderColor;\n  float: left;\n  margin: 0 1em 1em 0;\n  padding: 2px 4px;\n  width: 300px;\n}\n\n.current-theme {\n  background-color: $theme.highlightColor;\n}\n\n.theme-info {\n  margin-left: 60px;\n  color: $theme.textSecondaryColor;\n  font-size: .9em;\n}\n\n.theme-info h3{\n  margin-top: 0;\n  border-bottom: 1px solid $theme.borderColor;\n}\n\n/* Clear the floatting strategy after the display of all themes */\n.theme-viewer h2, .theme-creation-form {\n  clear: both;\n}\n\n.mockup-page {\n  border: 1px solid #aaa;\n  float: left;\n  height: 47px;\n  margin: 0 4px;\n  position: relative;\n  width: 50px;\n}\n\n.mockup-page * {\n  line-height: 1px;\n  overflow: hidden;\n  position: absolute;\n}\n\n/* Pretend to be the navbar */\n.mockup-navbar {\n  left: 0;\n  height: 3px;\n  top: 0;\n  width: 49px;\n}\n\n/* Pretend to be a logo */\n.mockup-logo {\n  background-color: orange;\n  top: 1px;\n  left: 1px;\n  height: 1px;\n  width: 6px;\n}\n\n/* Pretend to be menu inside the navbar */\n.mockup-navbar-menu {\n  width: 16px;\n  height: 1px;\n  border-style: dashed;\n  border-width: 1px;\n  left: 12px;\n}\n\n/* Pretend to be the add button */\n.mockup-add-button {\n  left: 30px;\n  height: 2px;\n  width: 5px;\n  top: 0px;\n}\n\n/* Pretend to be the page content */\n.mockup-page-content {\n  height: 40px;\n  left: 6px;\n  overflow: hidden;\n  top: 3px;\n  width: 32px;\n}\n\n.mockup-title, .mockup-text1, .mockup-text2, .mockup-text3, .mockup-text4, .mockup-text5{\n  left: 2px;\n  height: 1px;\n  width: 28px;\n  border-style: dotted;\n  border-width: 1px;\n}\n\n.mockup-title {\n  top: 4px;\n}\n\n.mockup-text1 {\n  top: 10px;\n}\n\n.mockup-text2 {\n  top: 13px;\n}\n\n.mockup-text3 {\n  top: 16px;\n}\n\n.mockup-text4 {\n  top: 19px;\n}\n\n.mockup-text5 {\n  top: 22px;\n}\n\n/* Pretend to be the app bar */\n.mockup-left-panel, .mockup-left-panel:before{\n  height: 40px;\n  top: 3px;\n  width: 4px;\n  left: 2px;\n}\n\n.mockup-left-panel:before{\n  content: \"@ @ @ @ @\";\n  font-size: 2px;\n}\n\n/* Pretend to be the right panel */\n.mockup-right-panel {\n  height: 24px;\n  top: 7px;\n  width: 7px;\n  right: 2px;\n}\n\n.mockup-right-panel-header-text, .mockup-right-panel-text1, .mockup-right-panel-text2, .mockup-right-panel-text3 {\n  height: 1px;\n  left: 2px;\n  top: 1px;\n  width: 8px;\n  border-style: dotted;\n  border-width: 1px;\n}\n\n.mockup-right-panel-header {\n  border-bottom: 1px dotted;\n  width: 12px;\n}\n\n.mockup-right-panel-contents{\n  top: 5px;\n  width: 8px;\n  height: 20px;\n}\n\n.mockup-right-panel-text1 {\n  top: 0px;\n}\n\n.mockup-right-panel-text2 {\n  top: 3px;\n}\n\n.mockup-right-panel-text3 {\n  top: 6px;\n}\n\n/* Pretend to be the footer */\n.mockup-footer {\n  top: 43px;\n  height: 3px;\n  width: 49px;\n  left: 0px;\n}\n\n.mockup-footer-content {\n  width: 25px;\n  height: 1px;\n  border-style: dashed;\n  border-width: 1px;\n  left: 12px;\n}\n\n.theme-creation-form form {\n  background: url(\"$xwiki.getSkinFile('icons/silk/add.png')\") no-repeat .2em center $theme.backgroundSecondaryColor;\n  border: 1px dotted $theme.borderColor;\n  display: inline-block;\n  padding: .5em .5em .5em 22px;\n  margin-bottom: 1em;\n}\n\n</code>\n    </property>\n    <property>\n      <name>CSS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.1\">\n  <web>FlamingoThemesCode</web>\n  <name>WebHomeSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('platform.flamingo.themes.home.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n################################\n## Globals\n################################\n#set ($discard = $xwiki.ssx.use('FlamingoThemesCode.WebHomeSheet'))\n####################################\n## CONTROLLER\n####################################\n#if($request.action == 'setTheme')\n  #setTheme()\n#elseif($request.action == 'setThemeSuccess')\n  #prepareView()\n  #setThemeSuccess()\n  #view()\n#elseif($request.action == 'create')\n  #create()\n#else\n  #prepareView()\n  #view()\n#end\n####################################\n## PREPARE VIEW\n####################################\n#macro(prepareView)\n  #set ($currentTheme = $xwiki.getXWikiPreference('colorTheme'))\n  #if (\"$!currentTheme\" == '')\n    #set ($currentTheme = 'FlamingoThemes.Charcoal')\n  #end\n  #set ($currentThemeDoc = $xwiki.getDocument($currentTheme))\n  #set ($isSubWiki = $services.wiki.currentWikiId != $services.wiki.mainWikiId)\n  #set ($flamingoThemesFromThisWiki = [])\n  #getFlamingoThemes($services.wiki.currentWikiId, $flamingoThemesFromThisWiki)\n  #if ($isSubWiki)\n    #set ($flamingoThemesFromMainWiki = [])\n    #getFlamingoThemes($services.wiki.mainWikiId,  $flamingoThemesFromMainWiki)\n  #end\n  #set ($currentScope = 'local')\n  #if (\"$!currentTheme\" != '' &amp;&amp; $services.model.resolveDocument($currentTheme).wikiReference.name == $services.wiki.mainWikiId)\n    #set ($currentScope = 'global')\n  #end\n#end\n################################\n## Get Flamingo themes\n################################\n#macro(getFlamingoThemes $wiki $return)\n  #set ($results = [])\n  #set ($xwql = \"from doc.object(FlamingoThemesCode.ThemeClass) obj WHERE doc.fullName &lt;&gt; 'FlamingoThemesCode.ThemeTemplate' ORDER BY doc.name\")\n  #getThemesFromQuery ($xwql, $wiki, $results)\n  #set ($return = $NULL)\n  #setVariable (\"$return\", $results)\n#end\n################################\n## Get themes from a query\n################################\n#macro(getThemesFromQuery $xwql $wiki $return)\n  #set ($wikiReference = $services.model.createWikiReference($wiki))\n  #set ($themes = $services.query.xwql($xwql).setWiki($wiki).execute())\n  #set ($themesRef = [])\n  #foreach ($theme in $themes)\n    #set ($themeRef = $services.model.resolveDocument($theme, 'default', $wikiReference))\n    #if ($services.security.authorization.hasAccess('view', $xcontext.userReference, $themeRef))\n      #set ($discard = $themesRef.add($themeRef))\n    #end\n  #end\n  #set ($return = $NULL)\n  #setVariable(\"$return\" $themesRef)\n#end\n####################################\n## VIEW\n####################################\n#macro(view)\n  (% class=\"theme-viewer\" %)\n  (((\n    ## Display a warning about old color themes (if any)\n    #if($xwiki.exists($services.model.createDocumentReference('', 'ColorThemes', 'ColorThemeClass')) &amp;&amp; $xwiki.exists($services.model.createDocumentReference('', 'ColorThemes', 'WebHome')))\n      {{info}}\n        $services.localization.render('platform.flamingo.themes.home.warningOldColorThemeInstalled', [\"[[\", \"&gt;&gt;ColorThemes.WebHome]]\"])\n      {{/info}}\n    #end\n    \n    ## Display the current theme\n    == $services.localization.render('platform.flamingo.themes.home.currenttheme') ==\n    #if($currentThemeDoc.getObject('ColorThemes.ColorThemeClass'))\n      {{warning}}\n        $services.localization.render('platform.flamingo.themes.home.warningCurrentOldColorTheme')\n      {{/warning}}\n    #end\n    #displayTheme($currentThemeDoc.documentReference, $currentScope)\n    \n    ## Display the other themes\n    ## Creation form\n    #creationForm()\n    \n    == $services.localization.render('platform.flamingo.themes.home.otherthemes') ==\n    #if ($isSubWiki &amp;&amp; !$flamingoThemesFromMainWiki.isEmpty())\n      {{html}}\n      &lt;ul class=\"nav nav-tabs\" role=\"tablist\"&gt;\n        &lt;li role=\"presentation\" class=\"active\"&gt;&lt;a href=\"#local\" role=\"tab\" data-toggle=\"tab\"&gt;$escapetool.xml($services.localization.render('platform.flamingo.themes.local'))&lt;/a&gt;&lt;/li&gt;\n        &lt;li role=\"presentation\"&gt;&lt;a href=\"#global\" role=\"tab\" data-toggle=\"tab\"&gt;$escapetool.xml($services.localization.render('platform.flamingo.themes.global'))&lt;/a&gt;&lt;/li&gt;\n      &lt;/ul&gt;\n      {{/html}}\n      \n      (% class=\"tab-content\" %)\n      (((\n        (% class=\"tab-pane active\" id=\"local\" %)\n        (((\n          #foreach($themeRef in $flamingoThemesFromThisWiki)\n            #displayTheme($themeRef, 'local')\n          #end\n        )))\n        \n        (% class=\"tab-pane\" id=\"global\" %)\n        (((\n          #foreach($themeRef in $flamingoThemesFromMainWiki)\n            #displayTheme($themeRef, 'global')\n          #end\n        )))\n      )))\n    #else\n      #foreach($themeRef in $flamingoThemesFromThisWiki)\n        #displayTheme($themeRef, 'local')\n      #end\n    #end\n  )))\n#end\n####################################\n## DISPLAY THEME\n####################################\n#macro(displayTheme $themeReference $scope)\n  #if ($scope == 'local')\n    #set ($fullName = $services.model.serialize($themeReference, 'local'))\n  #else\n    #set ($fullName = $services.model.serialize($themeReference, 'default'))\n  #end\n  #set ($isCurrentTheme = ($currentThemeDoc.documentReference == $themeReference))\n  #set ($themeDoc = $xwiki.getDocument($themeReference))\n  #set ($themeObj = $themeDoc.getObject('FlamingoThemesCode.ThemeClass'))\n  (% class=\"theme #if($isCurrentTheme) current-theme#end\" %)\n  (((\n    ## Display the mockup\n    #themeMockup($themeObj)\n    ## Display the informations\n    (% class=\"theme-info\" %)\n    (((\n      === [[$themeDoc.displayTitle&gt;&gt;$fullName]] #if ($isSubWiki &amp;&amp; $scope == 'local') ($services.wiki.currentWikiId)#end===\n      #if ($hasAdmin &amp;&amp; !$isCurrentTheme)\n        $services.icon.render('bullet_go') [[$services.localization.render('platform.flamingo.themes.home.useThisTheme')&gt;&gt;path:$doc.getURL('view', \"action=setTheme&amp;theme=${fullName}&amp;form_token=$services.csrf.token\")]]\n      #end\n    )))\n  )))\n#end\n####################################\n## THEME MOCKUP\n####################################\n#macro(themeMockup $themeObj)\n  #macro(displayValue $variableName $fallback)\n    #set($value = $themeObj.getValue($variableName))\n    #if(\"$!value\" == '')\n      #set($value = $fallback)\n    #end\n    $value##\n  #end\n\n  {{html}}\n    &lt;div class=\"mockup-page\" style=\"background-color: #displayValue('body-bg', '#fff')\"&gt;\n      ## A fake navbar\n      &lt;div class=\"mockup-navbar\" style=\"background-color: #displayValue('navbar-default-bg', '#eee')\"&gt;\n        ## A fake logo\n        &lt;div class=\"mockup-logo\"&gt;&lt;/div&gt;\n        ## A fake menu\n        &lt;div class=\"mockup-navbar-menu\" style=\"border-color: #displayValue('navbar-default-color', '#000')\"&gt;&lt;/div&gt;\n        ## A fake add button\n        &lt;div class=\"mockup-add-button\" style=\"background-color: #displayValue('btn-success-bg', '#4D9244')\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake page content\n      &lt;div class=\"mockup-page-content\" style=\"background-color: #displayValue('xwiki-page-content-bg', '#fff')\"&gt;\n        &lt;div class=\"mockup-title\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text1\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text2\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text3\" style=\"border-color: #displayValue('text-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text4\" style=\"border-color: #displayValue('link-color', '#000')\"&gt;&lt;/div&gt;\n        &lt;div class=\"mockup-text5\" style=\"border-color: #displayValue('text-color', '#0000ff')\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake app bar \n      &lt;div class=\"mockup-left-panel\" style=\"color: #displayValue('link-color', '#0000ff')\"&gt;&lt;/div&gt;\n      \n      ## A fake right panel\n      &lt;div class=\"mockup-right-panel\"&gt;\n        &lt;div class=\"mockup-right-panel-header\" style=\"color: #displayValue('panel-default-text', '#000'); background-color: #displayValue('panel-bg', '#fff')\"&gt;\n          &lt;div class=\"mockup-right-panel-header-text\" style=\"border-color: #displayValue('panel-default-text', '#000')\"&gt;&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"mockup-right-panel-contents\" style=\"background-color: #displayValue('panel-bg', '#fff')\"&gt;\n          &lt;div class=\"mockup-right-panel-text1\" style=\"background-color: #displayValue('panel-default-text', '#000')\"&gt; &lt;/div&gt;\n          &lt;div class=\"mockup-right-panel-text2\" style=\"background-color: #displayValue('panel-default-text', '#000')\"&gt; &lt;/div&gt;\n          &lt;div class=\"mockup-right-panel-text3\" style=\"background-color: #displayValue('link-color', '#0000ff')\"&gt; &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      \n      ## A fake footer\n      &lt;div class=\"mockup-footer\" style=\"background-color: #displayValue('navbar-default-bg', '#fff')\"&gt;\n        &lt;div class=\"mockup-footer-content\" style=\"border-color: #displayValue('navbar-default-link-color', '#000')\"&gt;\n      &lt;/div&gt;\n      \n    &lt;/div&gt;\n  {{/html}}\n  \n#end\n####################################\n## CREATION FORM\n####################################\n#macro(creationForm)\n  #if($xwiki.hasAccessLevel('edit', $xcontext.user, 'FlamingoThemes.AnyPage____________'))\n    (% class=\"clearfix\" %)\n    (((\n  \n    {{html}}\n      &lt;div class=\"theme-creation-form\" &gt;\n        &lt;form action=\"$doc.getURL()\" method=\"post\" class=\"form-inline\"&gt;\n          &lt;input type=\"hidden\" name=\"form_token\" value=\"$services.csrf.token\" /&gt;\n          &lt;input type=\"hidden\" name=\"action\" value=\"create\"/&gt;\n          &lt;label for=\"newThemeName\" class=\"hidden\"&gt;$services.localization.render('platform.flamingo.themes.home.newThemeName')&lt;/label&gt;\n          &lt;input type=\"text\" name=\"newThemeName\" id=\"newThemeName\" value=\"$services.localization.render('platform.flamingo.themes.home.newThemeName')\" class=\"withTip\" size=\"30\"/&gt;\n          &lt;input type=\"submit\" value=\"$services.localization.render('platform.flamingo.themes.home.create')\" class=\"button\"/&gt;\n        &lt;/form&gt;\n      &lt;/div&gt;\n    {{/html}}\n    \n    )))\n  #end\n#end\n####################################\n## CREATE A NEW THEME\n####################################\n#macro(create)\n  #if(\"$!request.newThemeName\" == '')\n    {{error}}\n      {{translation key=\"platform.flamingo.themes.home.create.invalid\" /}}\n    {{/error}}\n    \n    #creationForm()\n  #elseif(!$services.csrf.isTokenValid($request.form_token))\n    {{error}}\n      {{translation key=\"platform.flamingo.themes.home.create.csrf\" parameters=\"$request.newThemeName\" /}}\n    {{/error}}\n    \n    {{html}}\n      &lt;form action=\"$doc.getURL()\" method=\"post\"&gt;\n        &lt;input type=\"hidden\" name=\"form_token\" value=\"$services.csrf.token\" /&gt;\n        &lt;input type=\"hidden\" name=\"action\" value=\"create\"/&gt;\n        &lt;input type=\"hidden\" name=\"newThemeName\" id=\"newThemeName\" value=\"$escapetool.xml($request.newThemeName)\" /&gt;\n        &lt;input type=\"submit\" value=\"$services.localization.render('platform.flamingo.themes.home.create.confirm')\" class=\"button\"/&gt;\n      &lt;/form&gt;\n    {{/html}}\n  #else\n    ## Let's do it\n    $response.sendRedirect($xwiki.getDocument($services.model.createDocumentReference('', 'FlamingoThemes', $request.newThemeName)).getURL('edit', \"template=FlamingoThemesCode.ThemeTemplate&amp;title=$escapetool.url($request.newThemeName)&amp;parent=$doc.fullName&amp;xhidden=1\"))\n  #end\n#end\n####################################\n## SET THEME\n####################################\n#macro(setTheme)\n  #if(\"$!request.theme\" != '' &amp;&amp; $hasAdmin &amp;&amp; ${services.csrf.isTokenValid(\"$!{request.getParameter('form_token')}\")})\n    #set($preferencesDoc = $xwiki.getDocument('XWiki.XWikiPreferences'))\n    #set($preferencesObj = $preferencesDoc.getObject('XWiki.XWikiPreferences'))\n    $preferencesObj.set('colorTheme', $request.theme)\n    $preferencesDoc.save()\n    $response.sendRedirect($doc.getURL('view', \"theme=$escapetool.url($request.theme)&amp;action=setThemeSuccess\"))\n  #end\n#end\n####################################\n## SET THEME SUCCESS\n####################################\n#macro(setThemeSuccess)\n  #if(\"$!request.theme\" != '')\n  \n    {{success}}\n      $services.localization.render('platform.flamingo.themes.home.set.success', [$xwiki.getDocument($request.theme).displayTitle])\n    {{/success}}\n    \n  #end\n#end\n{{/velocity}}\n</content>\n  <object>\n    <name>FlamingoThemesCode.WebHomeSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>36837eed-1247-4e50-9e0d-0abc7f698eed</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <disabled>0</disabled>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#template('colorThemeInit.vm')\n.theme {\n  border: 1px dotted $theme.borderColor;\n  float: left;\n  margin: 0 1em 1em 0;\n  padding: 2px 4px;\n  width: 300px;\n}\n\n.current-theme {\n  background-color: $theme.highlightColor;\n}\n\n.theme-info {\n  margin-left: 60px;\n  color: $theme.textSecondaryColor;\n  font-size: .9em;\n}\n\n.theme-info h3{\n  margin-top: 0;\n  border-bottom: 1px solid $theme.borderColor;\n}\n\n/* Clear the floatting strategy after the display of all themes */\n.theme-viewer h2, .theme-creation-form {\n  clear: both;\n}\n\n.mockup-page {\n  border: 1px solid #aaa;\n  float: left;\n  height: 47px;\n  margin: 0 4px;\n  position: relative;\n  width: 50px;\n}\n\n.mockup-page * {\n  line-height: 1px;\n  overflow: hidden;\n  position: absolute;\n}\n\n/* Pretend to be the navbar */\n.mockup-navbar {\n  left: 0;\n  height: 3px;\n  top: 0;\n  width: 49px;\n}\n\n/* Pretend to be a logo */\n.mockup-logo {\n  background-color: orange;\n  top: 1px;\n  left: 1px;\n  height: 1px;\n  width: 6px;\n}\n\n/* Pretend to be menu inside the navbar */\n.mockup-navbar-menu {\n  width: 16px;\n  height: 1px;\n  border-style: dashed;\n  border-width: 1px;\n  left: 12px;\n}\n\n/* Pretend to be the add button */\n.mockup-add-button {\n  left: 30px;\n  height: 2px;\n  width: 5px;\n  top: 0px;\n}\n\n/* Pretend to be the page content */\n.mockup-page-content {\n  height: 40px;\n  left: 6px;\n  overflow: hidden;\n  top: 3px;\n  width: 32px;\n}\n\n.mockup-title, .mockup-text1, .mockup-text2, .mockup-text3, .mockup-text4, .mockup-text5{\n  left: 2px;\n  height: 1px;\n  width: 28px;\n  border-style: dotted;\n  border-width: 1px;\n}\n\n.mockup-title {\n  top: 4px;\n}\n\n.mockup-text1 {\n  top: 10px;\n}\n\n.mockup-text2 {\n  top: 13px;\n}\n\n.mockup-text3 {\n  top: 16px;\n}\n\n.mockup-text4 {\n  top: 19px;\n}\n\n.mockup-text5 {\n  top: 22px;\n}\n\n/* Pretend to be the app bar */\n.mockup-left-panel, .mockup-left-panel:before{\n  height: 40px;\n  top: 3px;\n  width: 4px;\n  left: 2px;\n}\n\n.mockup-left-panel:before{\n  content: \"@ @ @ @ @\";\n  font-size: 2px;\n}\n\n/* Pretend to be the right panel */\n.mockup-right-panel {\n  height: 24px;\n  top: 7px;\n  width: 7px;\n  right: 2px;\n}\n\n.mockup-right-panel-header-text, .mockup-right-panel-text1, .mockup-right-panel-text2, .mockup-right-panel-text3 {\n  height: 1px;\n  left: 2px;\n  top: 1px;\n  width: 8px;\n  border-style: dotted;\n  border-width: 1px;\n}\n\n.mockup-right-panel-header {\n  border-bottom: 1px dotted;\n  width: 12px;\n}\n\n.mockup-right-panel-contents{\n  top: 5px;\n  width: 8px;\n  height: 20px;\n}\n\n.mockup-right-panel-text1 {\n  top: 0px;\n}\n\n.mockup-right-panel-text2 {\n  top: 3px;\n}\n\n.mockup-right-panel-text3 {\n  top: 6px;\n}\n\n/* Pretend to be the footer */\n.mockup-footer {\n  top: 43px;\n  height: 3px;\n  width: 49px;\n  left: 0px;\n}\n\n.mockup-footer-content {\n  width: 25px;\n  height: 1px;\n  border-style: dashed;\n  border-width: 1px;\n  left: 12px;\n}\n\n.theme-creation-form form {\n  background: url(\"$xwiki.getSkinFile('icons/silk/add.png')\") no-repeat .2em center $theme.backgroundSecondaryColor;\n  border: 1px dotted $theme.borderColor;\n  display: inline-block;\n  padding: .5em .5em .5em 22px;\n  margin-bottom: 1em;\n}\n\n</code>\n    </property>\n    <property>\n      <name>CSS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>onDemand</use>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-theme/xwiki-platform-flamingo-theme-ui/src/main/resources/FlamingoThemesCode/WebHomeSheet.xml"], "buggy_code_start_loc": [290], "buggy_code_end_loc": [291], "fixing_code_start_loc": [290], "fixing_code_end_loc": [291], "type": "CWE-79", "message": "XWiki Platform Flamingo Theme UI is a tool that allows customization and preview of any Flamingo-based skin. Starting with versions 6.2.4 and 6.3-rc-1, a possible cross-site scripting vector is present in the `FlamingoThemesCode.WebHomeSheet` wiki page related to the \"newThemeName\" form field. The issue is patched in versions 12.10.11, 14.0-rc-1, 13.4.7, and 13.10.3. The easiest available workaround is to edit the wiki page `FlamingoThemesCode.WebHomeSheet` (with wiki editor) according to the suggestion provided in the GitHub Security Advisory.", "other": {"cve": {"id": "CVE-2022-29251", "sourceIdentifier": "security-advisories@github.com", "published": "2022-05-25T21:15:08.350", "lastModified": "2022-06-07T18:32:43.907", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform Flamingo Theme UI is a tool that allows customization and preview of any Flamingo-based skin. Starting with versions 6.2.4 and 6.3-rc-1, a possible cross-site scripting vector is present in the `FlamingoThemesCode.WebHomeSheet` wiki page related to the \"newThemeName\" form field. The issue is patched in versions 12.10.11, 14.0-rc-1, 13.4.7, and 13.10.3. The easiest available workaround is to edit the wiki page `FlamingoThemesCode.WebHomeSheet` (with wiki editor) according to the suggestion provided in the GitHub Security Advisory."}, {"lang": "es", "value": "XWiki Platform Flamingo Theme UI es una herramienta que permite personalizar y previsualizar cualquier skin basado en Flamingo. A partir de las versiones 6.2.4 y 6.3-rc-1, se presenta un posible vector de cross-site scripting en la p\u00e1gina wiki \"FlamingoThemesCode.WebHomeSheet\" relacionado con el campo de formulario \"newThemeName\". El problema est\u00e1 parcheado en versiones 12.10.11, 14.0-rc-1, 13.4.7 y 13.10.3. La mitigaci\u00f3n m\u00e1s f\u00e1cil disponible es editar la p\u00e1gina wiki \"FlamingoThemesCode.WebHomeSheet\" (con el editor wiki) de acuerdo con la sugerencia proporcionada en el aviso de seguridad de GitHub"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 7.4, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 4.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-116"}, {"lang": "en", "value": "CWE-80"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.2.4", "versionEndExcluding": "12.10.11", "matchCriteriaId": "89BA3AE2-A6E9-4216-9AA5-814887F21FBB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "13.0", "versionEndExcluding": "13.4.7", "matchCriteriaId": "46DEE085-75DA-4505-A874-EB0EBEC70FBE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "13.5", "versionEndExcluding": "13.10.3", "matchCriteriaId": "14BFEB5B-7E8A-431B-A265-CE9FAE6A2F60"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/bd935320bee3c27cf7548351b1d0f935f116d437", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-vmhh-xh3g-j992", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-19294", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/bd935320bee3c27cf7548351b1d0f935f116d437"}}