{"buggy_code": ["/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\npackage com.xpn.xwiki.internal.mandatory;\n\nimport javax.inject.Named;\nimport javax.inject.Singleton;\n\nimport org.xwiki.component.annotation.Component;\nimport org.xwiki.model.reference.LocalDocumentReference;\nimport org.xwiki.model.reference.RegexEntityReference;\n\nimport com.xpn.xwiki.XWiki;\nimport com.xpn.xwiki.objects.BaseObjectReference;\nimport com.xpn.xwiki.objects.classes.BaseClass;\nimport com.xpn.xwiki.objects.classes.TextAreaClass;\n\n/**\n * Update XWiki.XWikiComments document with all required informations.\n *\n * @version $Id$\n * @since 4.3M1\n */\n@Component\n@Named(XWikiCommentsDocumentInitializer.LOCAL_REFERENCE_STRING)\n@Singleton\npublic class XWikiCommentsDocumentInitializer extends AbstractCommentsDocumentInitializer\n{\n    /**\n     * The name of the initialized document.\n     * \n     * @since 9.4RC1\n     */\n    public static final String NAME = \"XWikiComments\";\n\n    /**\n     * The local reference of the initialized document as String.\n     * \n     * @since 9.4RC1\n     */\n    public static final String LOCAL_REFERENCE_STRING = XWiki.SYSTEM_SPACE + '.' + NAME;\n\n    /**\n     * The local reference of the initialized document as String.\n     * \n     * @since 9.4RC1\n     */\n    public static final LocalDocumentReference LOCAL_REFERENCE = new LocalDocumentReference(XWiki.SYSTEM_SPACE, NAME);\n\n    /**\n     * A regex to match any object reference with initialized class.\n     * \n     * @since 9.4RC1\n     */\n    public static final RegexEntityReference OBJECT_REFERENCE = BaseObjectReference.any(LOCAL_REFERENCE_STRING);\n\n    /**\n     * Default constructor.\n     */\n    public XWikiCommentsDocumentInitializer()\n    {\n        super(LOCAL_REFERENCE);\n    }\n\n    @Override\n    protected void createClass(BaseClass xclass)\n    {\n        super.createClass(xclass);\n\n        xclass.addTextAreaField(\"highlight\", \"Highlighted Text\", 40, 2);\n        xclass.addNumberField(\"replyto\", \"Reply To\", 5, \"integer\");\n\n        String commentPropertyName = \"comment\";\n        xclass.addTextAreaField(commentPropertyName, \"Comment\", 40, 5);\n\n        // FIXME: Ensure that the comment text editor is set to its default value after an upgrade. This should be\n        // handled in a cleaner way in BaseClass#addTextAreaField. See: https://jira.xwiki.org/browse/XWIKI-17605\n        TextAreaClass comment =  (TextAreaClass) xclass.getField(commentPropertyName);\n        comment.setEditor((String) null);\n    }\n}\n"], "fixing_code": ["/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\npackage com.xpn.xwiki.internal.mandatory;\n\nimport javax.inject.Named;\nimport javax.inject.Singleton;\n\nimport org.xwiki.component.annotation.Component;\nimport org.xwiki.model.reference.LocalDocumentReference;\nimport org.xwiki.model.reference.RegexEntityReference;\n\nimport com.xpn.xwiki.XWiki;\nimport com.xpn.xwiki.objects.BaseObjectReference;\nimport com.xpn.xwiki.objects.classes.BaseClass;\nimport com.xpn.xwiki.objects.classes.TextAreaClass;\n\n/**\n * Update XWiki.XWikiComments document with all required informations.\n *\n * @version $Id$\n * @since 4.3M1\n */\n@Component\n@Named(XWikiCommentsDocumentInitializer.LOCAL_REFERENCE_STRING)\n@Singleton\npublic class XWikiCommentsDocumentInitializer extends AbstractCommentsDocumentInitializer\n{\n    /**\n     * The name of the initialized document.\n     * \n     * @since 9.4RC1\n     */\n    public static final String NAME = \"XWikiComments\";\n\n    /**\n     * The local reference of the initialized document as String.\n     * \n     * @since 9.4RC1\n     */\n    public static final String LOCAL_REFERENCE_STRING = XWiki.SYSTEM_SPACE + '.' + NAME;\n\n    /**\n     * The local reference of the initialized document as String.\n     * \n     * @since 9.4RC1\n     */\n    public static final LocalDocumentReference LOCAL_REFERENCE = new LocalDocumentReference(XWiki.SYSTEM_SPACE, NAME);\n\n    /**\n     * A regex to match any object reference with initialized class.\n     * \n     * @since 9.4RC1\n     */\n    public static final RegexEntityReference OBJECT_REFERENCE = BaseObjectReference.any(LOCAL_REFERENCE_STRING);\n\n    /**\n     * Default constructor.\n     */\n    public XWikiCommentsDocumentInitializer()\n    {\n        super(LOCAL_REFERENCE);\n    }\n\n    @Override\n    protected void createClass(BaseClass xclass)\n    {\n        super.createClass(xclass);\n\n        xclass.addTextAreaField(\"highlight\", \"Highlighted Text\", 40, 2);\n        xclass.addNumberField(\"replyto\", \"Reply To\", 5, \"integer\");\n\n        String commentPropertyName = \"comment\";\n        xclass.addTextAreaField(commentPropertyName, \"Comment\", 40, 5, true);\n\n        // FIXME: Ensure that the comment text editor is set to its default value after an upgrade. This should be\n        // handled in a cleaner way in BaseClass#addTextAreaField. See: https://jira.xwiki.org/browse/XWIKI-17605\n        TextAreaClass comment =  (TextAreaClass) xclass.getField(commentPropertyName);\n        comment.setEditor((String) null);\n    }\n}\n"], "filenames": ["xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/mandatory/XWikiCommentsDocumentInitializer.java"], "buggy_code_start_loc": [90], "buggy_code_end_loc": [91], "fixing_code_start_loc": [90], "fixing_code_end_loc": [91], "type": "CWE-269", "message": "XWiki Platform is a generic wiki platform. Starting in version 2.3-milestone-1, the annotation displayer does not execute the content in a restricted context. This allows executing anything with the right of the author of any document by annotating the document. This has been patched in XWiki 13.10.11, 14.4.7 and 14.10. There is no easy workaround except to upgrade.", "other": {"cve": {"id": "CVE-2023-26475", "sourceIdentifier": "security-advisories@github.com", "published": "2023-03-02T19:15:11.470", "lastModified": "2023-03-13T17:53:39.227", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform is a generic wiki platform. Starting in version 2.3-milestone-1, the annotation displayer does not execute the content in a restricted context. This allows executing anything with the right of the author of any document by annotating the document. This has been patched in XWiki 13.10.11, 14.4.7 and 14.10. There is no easy workaround except to upgrade."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-269"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-269"}, {"lang": "en", "value": "CWE-270"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartExcluding": "2.3", "versionEndExcluding": "13.10.11", "matchCriteriaId": "E2345A26-DC22-4A19-9CE0-9DCE395C7996"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.4.7", "matchCriteriaId": "FA3A5151-58FB-48CF-BFFB-5688608200C8"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.5", "versionEndExcluding": "14.10", "matchCriteriaId": "569EE28C-5C86-467F-A153-DD4B9BF0053D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:2.3:milestone1:*:*:*:*:*:*", "matchCriteriaId": "0075AEEF-E71A-4BE1-9062-1F304E734E09"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/d87d7bfd8db18c20d3264f98c6deefeae93b99f7", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-h6f5-8jj5-cxhr", "source": "security-advisories@github.com", "tags": ["Exploit", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20360", "source": "security-advisories@github.com", "tags": ["Exploit", "Issue Tracking", "Patch", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20384", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/d87d7bfd8db18c20d3264f98c6deefeae93b99f7"}}