{"buggy_code": ["<?php\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\n//check permissions\n\trequire_once \"resources/check_auth.php\";\n\tif (permission_exists('conference_control_detail_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//add the search term\n\t$search = $_GET[\"search\"];\n\tif (strlen($search) > 0) {\n\t\t$sql_search = \"and (\";\n\t\t$sql_search .= \"control_digits like :search\";\n\t\t$sql_search .= \"or control_action like :search\";\n\t\t$sql_search .= \"or control_data like :search\";\n\t\t$sql_search .= \"or control_enabled like :search\";\n\t\t$sql_search .= \")\";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//prepare to page the results\n\t$sql = \"select count(*) \";\n\t$sql .= \"from v_conference_control_details \";\n\t$sql .= \"where conference_control_uuid = :conference_control_uuid \";\n\t//$sql .= \"and domain_uuid = :domain_uuid \";\n\t$sql .= $sql_search;\n\t$parameters['conference_control_uuid'] = $conference_control_uuid;\n\t//$parameters['domain_uuid'] = $domain_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"\";\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_conference_control_details \";\n\t$sql .= \"where conference_control_uuid = :conference_control_uuid \";\n\t//$sql .= \"and domain_uuid = :domain_uuid \";\n\t$sql .= $sql_search;\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\n//alternate the row style\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' nowrap='nowrap'><b>\".$text['title-conference_control_details'].\"</b></td>\\n\";\n\t//echo \"\t\t<form method='get' action=''>\\n\";\n\t//echo \"\t\t\t<td width='50%' style='vertical-align: top; text-align: right; white-space: nowrap;'>\\n\";\n\t//echo \"\t\t\t\t<input type='text' class='txt' style='width: 150px' name='search' id='search' value='\".escape($search).\"'>\\n\";\n\t//echo \"\t\t\t\t<input type='submit' class='btn' name='submit' value='\".$text['button-search'].\"'>\\n\";\n\t//echo \"\t\t\t</td>\\n\";\n\t//echo \"\t\t</form>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('control_digits', $text['label-control_digits'], $order_by, $order);\n\techo th_order_by('control_action', $text['label-control_action'], $order_by, $order);\n\techo th_order_by('control_data', $text['label-control_data'], $order_by, $order);\n\techo th_order_by('control_enabled', $text['label-control_enabled'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('conference_control_detail_add')) {\n\t\techo \"<a href='conference_control_detail_edit.php?conference_control_uuid=\".$_GET['id'].\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($result) && sizeof($result) != 0) {\n\t\tforeach($result as $row) {\n\t\t\tif (permission_exists('conference_control_detail_edit')) {\n\t\t\t\t$tr_link = \"href='conference_control_detail_edit.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_digits']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_action']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_data']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_enabled']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('conference_control_detail_edit')) {\n\t\t\t\techo \"<a href='conference_control_detail_edit.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('conference_control_detail_delete')) {\n\t\t\t\techo \"<a href='conference_control_detail_delete.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t} //end foreach\n\t\tunset($result);\n\t} //end if results\n\n\techo \"<tr>\\n\";\n\techo \"<td colspan='5' align='left'>\\n\";\n\techo \"\t<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='33.3%' nowrap='nowrap'>&nbsp;</td>\\n\";\n\techo \"\t\t<td width='33.3%' align='center' nowrap='nowrap'>$paging_controls</td>\\n\";\n\techo \"\t\t<td class='list_control_icons'>\";\n\tif (permission_exists('conference_control_detail_add')) {\n\t\techo \t\t\"<a href='conference_control_detail_edit.php?conference_control_uuid=\".$_GET['id'].\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \t\t\"&nbsp;\";\n\t}\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n \techo \"\t</table>\\n\";\n\techo \"</td>\\n\";\n\techo \"</tr>\\n\";\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "fixing_code": ["<?php\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\n//check permissions\n\trequire_once \"resources/check_auth.php\";\n\tif (permission_exists('conference_control_detail_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//add the search term\n\t$search = $_GET[\"search\"];\n\tif (strlen($search) > 0) {\n\t\t$sql_search = \"and (\";\n\t\t$sql_search .= \"control_digits like :search\";\n\t\t$sql_search .= \"or control_action like :search\";\n\t\t$sql_search .= \"or control_data like :search\";\n\t\t$sql_search .= \"or control_enabled like :search\";\n\t\t$sql_search .= \")\";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//prepare to page the results\n\t$sql = \"select count(*) \";\n\t$sql .= \"from v_conference_control_details \";\n\t$sql .= \"where conference_control_uuid = :conference_control_uuid \";\n\t//$sql .= \"and domain_uuid = :domain_uuid \";\n\t$sql .= $sql_search;\n\t$parameters['conference_control_uuid'] = $conference_control_uuid;\n\t//$parameters['domain_uuid'] = $domain_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"\";\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_conference_control_details \";\n\t$sql .= \"where conference_control_uuid = :conference_control_uuid \";\n\t//$sql .= \"and domain_uuid = :domain_uuid \";\n\t$sql .= $sql_search;\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\n//alternate the row style\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' nowrap='nowrap'><b>\".$text['title-conference_control_details'].\"</b></td>\\n\";\n\t//echo \"\t\t<form method='get' action=''>\\n\";\n\t//echo \"\t\t\t<td width='50%' style='vertical-align: top; text-align: right; white-space: nowrap;'>\\n\";\n\t//echo \"\t\t\t\t<input type='text' class='txt' style='width: 150px' name='search' id='search' value='\".escape($search).\"'>\\n\";\n\t//echo \"\t\t\t\t<input type='submit' class='btn' name='submit' value='\".$text['button-search'].\"'>\\n\";\n\t//echo \"\t\t\t</td>\\n\";\n\t//echo \"\t\t</form>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('control_digits', $text['label-control_digits'], $order_by, $order);\n\techo th_order_by('control_action', $text['label-control_action'], $order_by, $order);\n\techo th_order_by('control_data', $text['label-control_data'], $order_by, $order);\n\techo th_order_by('control_enabled', $text['label-control_enabled'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('conference_control_detail_add')) {\n\t\techo \"<a href='conference_control_detail_edit.php?conference_control_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($result) && sizeof($result) != 0) {\n\t\tforeach($result as $row) {\n\t\t\tif (permission_exists('conference_control_detail_edit')) {\n\t\t\t\t$tr_link = \"href='conference_control_detail_edit.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_digits']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_action']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_data']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['control_enabled']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('conference_control_detail_edit')) {\n\t\t\t\techo \"<a href='conference_control_detail_edit.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('conference_control_detail_delete')) {\n\t\t\t\techo \"<a href='conference_control_detail_delete.php?conference_control_uuid=\".escape($row['conference_control_uuid']).\"&id=\".escape($row['conference_control_detail_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t} //end foreach\n\t\tunset($result);\n\t} //end if results\n\n\techo \"<tr>\\n\";\n\techo \"<td colspan='5' align='left'>\\n\";\n\techo \"\t<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='33.3%' nowrap='nowrap'>&nbsp;</td>\\n\";\n\techo \"\t\t<td width='33.3%' align='center' nowrap='nowrap'>$paging_controls</td>\\n\";\n\techo \"\t\t<td class='list_control_icons'>\";\n\tif (permission_exists('conference_control_detail_add')) {\n\t\techo \t\t\"<a href='conference_control_detail_edit.php?conference_control_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \t\t\"&nbsp;\";\n\t}\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n \techo \"\t</table>\\n\";\n\techo \"</td>\\n\";\n\techo \"</tr>\\n\";\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/conference_controls/conference_control_details.php"], "buggy_code_start_loc": [95], "buggy_code_end_loc": [136], "fixing_code_start_loc": [95], "fixing_code_end_loc": [136], "type": "CWE-79", "message": "An issue was discovered in FusionPBX up to 4.5.7. In the file app\\conference_controls\\conference_control_details.php, an unsanitized id variable coming from the URL is reflected in HTML on 2 occasions, leading to XSS.", "other": {"cve": {"id": "CVE-2019-16968", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T20:15:10.977", "lastModified": "2023-02-03T21:52:10.697", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in FusionPBX up to 4.5.7. In the file app\\conference_controls\\conference_control_details.php, an unsanitized id variable coming from the URL is reflected in HTML on 2 occasions, leading to XSS."}, {"lang": "es", "value": "Se detect\u00f3 un problema en FusionPBX versiones hasta 4.5.7. En el archivo app\\conference_controls\\conference_control_details.php, una variable id no saneada que proviene de la URL es reflejada en HTML en 2 ocasiones, conllevando a una vulnerabilidad de tipo XSS."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/02378c54722d89f875c66ddb00ff06468dabbc6d", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-1/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/02378c54722d89f875c66ddb00ff06468dabbc6d"}}