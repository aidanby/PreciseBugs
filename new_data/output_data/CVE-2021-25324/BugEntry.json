{"buggy_code": ["<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'galaxies', 'menuItem' => 'view_cluster'));\n\n    $extendedFromHtml = '';\n    $extendFromLinks = array();\n    if (!empty($cluster['GalaxyCluster']['extended_from'])) {\n        $element = $this->element('genericElements/IndexTable/Fields/links', array(\n            'url' => $baseurl . '/galaxy_clusters/view/',\n            'row' => $cluster,\n            'field' => array(\n                'data_path' => 'GalaxyCluster.extended_from.GalaxyCluster.id',\n                'title' => sprintf(__('%s (version: %s)'), $cluster['GalaxyCluster']['extended_from']['GalaxyCluster']['value'], $cluster['GalaxyCluster']['extends_version'])\n            ),\n        ));\n        $extendFromLinks[] = sprintf('<li>%s</li>', $element);\n    }\n    $extendedFromHtml = sprintf('<ul>%s</ul>', implode('', $extendFromLinks));\n    if ($newVersionAvailable) {\n        $extendedFromHtml .= sprintf('<div class=\"alert alert-warning\">%s</div>', sprintf(__('New version available! <a href=\"%s\">Update cluster to version <b>%s</b></a>'),\n            '/galaxy_clusters/updateCluster/' . $cluster['GalaxyCluster']['id'],\n            h($cluster['GalaxyCluster']['extended_from']['GalaxyCluster']['version'])\n        ));\n    }\n\n    $extendedByHtml = '';\n    $extendByLinks = array();\n    foreach($cluster['GalaxyCluster']['extended_by'] as $extendCluster) {\n        $element = $this->element('genericElements/IndexTable/Fields/links', array(\n            'url' => '/galaxy_clusters/view/',\n            'row' => $extendCluster,\n            'field' => array(\n                'data_path' => 'GalaxyCluster.id',\n                'title' => sprintf(__('%s (parent version: %s)'), $extendCluster['GalaxyCluster']['value'], $extendCluster['GalaxyCluster']['extends_version'])\n            ),\n        ));\n        $extendByLinks[] = sprintf('<li>%s</li>', $element);\n    }\n    $extendedByHtml = sprintf('<ul>%s</ul>', implode('', $extendByLinks));\n    $table_data = array();\n    $table_data[] = array('key' => __('Cluster ID'), 'value' => $cluster['GalaxyCluster']['id']);\n    $table_data[] = array('key' => __('Name'), 'value' => $cluster['GalaxyCluster']['value']);\n    $table_data[] = array('key' => __('Parent Galaxy'), 'value' => $cluster['GalaxyCluster']['Galaxy']['name'] ? $cluster['GalaxyCluster']['Galaxy']['name'] : $cluster['GalaxyCluster']['Galaxy']['type']);\n    $table_data[] = array('key' => __('Description'), 'value' => $cluster['GalaxyCluster']['description']);\n    $table_data[] = array('key' => __('Published'), 'boolean' => $cluster['GalaxyCluster']['published'], 'class' => (!$cluster['GalaxyCluster']['published'] ? 'background-red bold': ''));\n    $table_data[] = array('key' => __('Default'), 'boolean' => $cluster['GalaxyCluster']['default'], 'class' => (!$cluster['GalaxyCluster']['published'] ? 'black': 'black'));\n    $table_data[] = array('key' => __('Version'), 'value' => $cluster['GalaxyCluster']['version']);\n    $table_data[] = array('key' => __('UUID'), 'value' => $cluster['GalaxyCluster']['uuid'], 'value_class' => 'quickSelect');\n    $table_data[] = array('key' => __('Collection UUID'), 'value' => $cluster['GalaxyCluster']['collection_uuid'], 'value_class' => 'quickSelect');\n    $table_data[] = array(\n        'key' => __('Source'),\n        'html' => filter_var($cluster['GalaxyCluster']['source'], FILTER_VALIDATE_URL) ?\n            '<a href=\"' . $cluster['GalaxyCluster']['source'] . '\" rel=\"noreferrer noopener\">' . h($cluster['GalaxyCluster']['source']) :\n            h($cluster['GalaxyCluster']['source']),\n    );\n    $table_data[] = array('key' => __('Authors'), 'value' => !empty($cluster['GalaxyCluster']['authors']) ? implode(', ', $cluster['GalaxyCluster']['authors']) : __('N/A'));\n    $table_data[] = array('key' => __('Distribution'), 'element' => 'genericElements/IndexTable/Fields/distribution_levels', 'element_params' => array(\n        'row' => $cluster['GalaxyCluster'],\n        'field' => array('data_path' => 'distribution')\n    ));\n    $table_data[] = array(\n        'key' => __('Owner Organisation'), \n        'html' => $this->OrgImg->getOrgImg(array('name' => $cluster['GalaxyCluster']['Org']['name'], 'id' => $cluster['GalaxyCluster']['Org']['id'], 'size' => 18), true),\n    );\n    $table_data[] = array(\n        'key' => __('Creator Organisation'), \n        'html' => $this->OrgImg->getOrgImg(array('name' => $cluster['GalaxyCluster']['Orgc']['name'], 'id' => $cluster['GalaxyCluster']['Orgc']['id'], 'size' => 18), true),\n    );\n    $table_data[] = array('key' => __('Connector tag'), 'value' => $cluster['GalaxyCluster']['tag_name']);\n    $table_data[] = array('key' => __('Events'), 'html' => isset($cluster['GalaxyCluster']['tag_count']) ? \n                        sprintf('<a href=\"%s\">%s</a>',\n                            sprintf('%s/events/index/searchtag:%s', $baseurl, h($cluster['GalaxyCluster']['tag_id'])),\n                            __n('%s event', '%s events', $cluster['GalaxyCluster']['tag_count'], h($cluster['GalaxyCluster']['tag_count']))\n                        ):\n                        '0'\n                    );\n    if (!empty($extendedFromHtml)) {\n        $table_data[] = array('key' => __('Forked From'), 'html' => $extendedFromHtml);\n    }\n    if (!empty($extendedByHtml)) {\n        $table_data[] = array('key' => __('Forked By'), 'html' => $extendedByHtml);\n    }\n?>\n\n<div class='view'>\n    <div class=\"row-fluid\">\n        <div class=\"span8\">\n            <h2>\n                <?= sprintf('%s :: %s', h($cluster['GalaxyCluster']['Galaxy']['name']), $cluster['GalaxyCluster']['value']); ?>\n            </h2>\n            <?php echo $this->element('genericElements/viewMetaTable', array('table_data' => $table_data)); ?>\n        </div>\n    </div>\n    <div class=\"row-fuild\">\n        <div id=\"matrix_container\"></div>\n    </div>\n    <div class=\"row-fuild\">\n        <div id=\"relations_container\"></div>\n    </div>\n    <div class=\"row-fluid\">\n        <div id=\"elements_div\" class=\"span8\"></div>\n    </div>\n</div>\n<script type=\"text/javascript\">\n$(function () {\n    $.get(\"<?php echo $baseurl; ?>/galaxy_elements/index/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#elements_div\").html(data);\n    });\n    $.get(\"<?php echo $baseurl; ?>/galaxy_clusters/viewGalaxyMatrix/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#matrix_container\").html(data);\n    });\n    $.get(\"/galaxy_clusters/viewRelations/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#relations_container\").html(data);\n    });\n});\n</script>\n"], "fixing_code": ["<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'galaxies', 'menuItem' => 'view_cluster'));\n\n    $extendedFromHtml = '';\n    $extendFromLinks = array();\n    if (!empty($cluster['GalaxyCluster']['extended_from'])) {\n        $element = $this->element('genericElements/IndexTable/Fields/links', array(\n            'url' => $baseurl . '/galaxy_clusters/view/',\n            'row' => $cluster,\n            'field' => array(\n                'data_path' => 'GalaxyCluster.extended_from.GalaxyCluster.id',\n                'title' => sprintf(__('%s (version: %s)'), $cluster['GalaxyCluster']['extended_from']['GalaxyCluster']['value'], $cluster['GalaxyCluster']['extends_version'])\n            ),\n        ));\n        $extendFromLinks[] = sprintf('<li>%s</li>', $element);\n    }\n    $extendedFromHtml = sprintf('<ul>%s</ul>', implode('', $extendFromLinks));\n    if ($newVersionAvailable) {\n        $extendedFromHtml .= sprintf('<div class=\"alert alert-warning\">%s</div>', sprintf(__('New version available! <a href=\"%s\">Update cluster to version <b>%s</b></a>'),\n            '/galaxy_clusters/updateCluster/' . $cluster['GalaxyCluster']['id'],\n            h($cluster['GalaxyCluster']['extended_from']['GalaxyCluster']['version'])\n        ));\n    }\n\n    $extendedByHtml = '';\n    $extendByLinks = array();\n    foreach($cluster['GalaxyCluster']['extended_by'] as $extendCluster) {\n        $element = $this->element('genericElements/IndexTable/Fields/links', array(\n            'url' => '/galaxy_clusters/view/',\n            'row' => $extendCluster,\n            'field' => array(\n                'data_path' => 'GalaxyCluster.id',\n                'title' => sprintf(__('%s (parent version: %s)'), $extendCluster['GalaxyCluster']['value'], $extendCluster['GalaxyCluster']['extends_version'])\n            ),\n        ));\n        $extendByLinks[] = sprintf('<li>%s</li>', $element);\n    }\n    $extendedByHtml = sprintf('<ul>%s</ul>', implode('', $extendByLinks));\n    $table_data = array();\n    $table_data[] = array('key' => __('Cluster ID'), 'value' => $cluster['GalaxyCluster']['id']);\n    $table_data[] = array('key' => __('Name'), 'value' => $cluster['GalaxyCluster']['value']);\n    $table_data[] = array('key' => __('Parent Galaxy'), 'value' => $cluster['GalaxyCluster']['Galaxy']['name'] ? $cluster['GalaxyCluster']['Galaxy']['name'] : $cluster['GalaxyCluster']['Galaxy']['type']);\n    $table_data[] = array('key' => __('Description'), 'value' => $cluster['GalaxyCluster']['description']);\n    $table_data[] = array('key' => __('Published'), 'boolean' => $cluster['GalaxyCluster']['published'], 'class' => (!$cluster['GalaxyCluster']['published'] ? 'background-red bold': ''));\n    $table_data[] = array('key' => __('Default'), 'boolean' => $cluster['GalaxyCluster']['default'], 'class' => (!$cluster['GalaxyCluster']['published'] ? 'black': 'black'));\n    $table_data[] = array('key' => __('Version'), 'value' => $cluster['GalaxyCluster']['version']);\n    $table_data[] = array('key' => __('UUID'), 'value' => $cluster['GalaxyCluster']['uuid'], 'value_class' => 'quickSelect');\n    $table_data[] = array('key' => __('Collection UUID'), 'value' => $cluster['GalaxyCluster']['collection_uuid'], 'value_class' => 'quickSelect');\n    $table_data[] = array(\n        'key' => __('Source'),\n        'html' => filter_var($cluster['GalaxyCluster']['source'], FILTER_VALIDATE_URL) ?\n            '<a href=\"' . $cluster['GalaxyCluster']['source'] . '\" rel=\"noreferrer noopener\">' . h($cluster['GalaxyCluster']['source']) :\n            h($cluster['GalaxyCluster']['source']),\n    );\n    $table_data[] = array('key' => __('Authors'), 'value' => !empty($cluster['GalaxyCluster']['authors']) ? implode(', ', $cluster['GalaxyCluster']['authors']) : __('N/A'));\n    $table_data[] = array('key' => __('Distribution'), 'element' => 'genericElements/IndexTable/Fields/distribution_levels', 'element_params' => array(\n        'row' => $cluster['GalaxyCluster'],\n        'field' => array('data_path' => 'distribution')\n    ));\n    $table_data[] = array(\n        'key' => __('Owner Organisation'),\n        'html' => $this->OrgImg->getOrgImg(array('name' => $cluster['GalaxyCluster']['Org']['name'], 'id' => $cluster['GalaxyCluster']['Org']['id'], 'size' => 18), true),\n    );\n    $table_data[] = array(\n        'key' => __('Creator Organisation'),\n        'html' => $this->OrgImg->getOrgImg(array('name' => $cluster['GalaxyCluster']['Orgc']['name'], 'id' => $cluster['GalaxyCluster']['Orgc']['id'], 'size' => 18), true),\n    );\n    $table_data[] = array('key' => __('Connector tag'), 'value' => $cluster['GalaxyCluster']['tag_name']);\n    $table_data[] = array('key' => __('Events'), 'html' => isset($cluster['GalaxyCluster']['tag_count']) ?\n                        sprintf('<a href=\"%s\">%s</a>',\n                            sprintf('%s/events/index/searchtag:%s', $baseurl, h($cluster['GalaxyCluster']['tag_id'])),\n                            __n('%s event', '%s events', $cluster['GalaxyCluster']['tag_count'], h($cluster['GalaxyCluster']['tag_count']))\n                        ):\n                        '0'\n                    );\n    if (!empty($extendedFromHtml)) {\n        $table_data[] = array('key' => __('Forked From'), 'html' => $extendedFromHtml);\n    }\n    if (!empty($extendedByHtml)) {\n        $table_data[] = array('key' => __('Forked By'), 'html' => $extendedByHtml);\n    }\n?>\n\n<div class='view'>\n    <div class=\"row-fluid\">\n        <div class=\"span8\">\n            <h2>\n                <?= sprintf('%s :: %s', h($cluster['GalaxyCluster']['Galaxy']['name']), h($cluster['GalaxyCluster']['value'])); ?>\n            </h2>\n            <?php echo $this->element('genericElements/viewMetaTable', array('table_data' => $table_data)); ?>\n        </div>\n    </div>\n    <div class=\"row-fuild\">\n        <div id=\"matrix_container\"></div>\n    </div>\n    <div class=\"row-fuild\">\n        <div id=\"relations_container\"></div>\n    </div>\n    <div class=\"row-fluid\">\n        <div id=\"elements_div\" class=\"span8\"></div>\n    </div>\n</div>\n<script type=\"text/javascript\">\n$(function () {\n    $.get(\"<?php echo $baseurl; ?>/galaxy_elements/index/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#elements_div\").html(data);\n    });\n    $.get(\"<?php echo $baseurl; ?>/galaxy_clusters/viewGalaxyMatrix/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#matrix_container\").html(data);\n    });\n    $.get(\"/galaxy_clusters/viewRelations/<?php echo $cluster['GalaxyCluster']['id']; ?>\", function(data) {\n        $(\"#relations_container\").html(data);\n    });\n});\n</script>\n"], "filenames": ["app/View/GalaxyClusters/view.ctp"], "buggy_code_start_loc": [61], "buggy_code_end_loc": [89], "fixing_code_start_loc": [61], "fixing_code_end_loc": [89], "type": "CWE-79", "message": "MISP 2.4.136 has Stored XSS in the galaxy cluster view via a cluster name to app/View/GalaxyClusters/view.ctp.", "other": {"cve": {"id": "CVE-2021-25324", "sourceIdentifier": "cve@mitre.org", "published": "2021-01-19T16:15:13.390", "lastModified": "2021-01-21T21:36:20.787", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "MISP 2.4.136 has Stored XSS in the galaxy cluster view via a cluster name to app/View/GalaxyClusters/view.ctp."}, {"lang": "es", "value": "MISP versi\u00f3n 2.4.136, presenta un XSS Almacenado en la vista del cl\u00faster galaxy por medio de un nombre de cl\u00faster en el archivo app/View/GalaxyClusters/view.ctp"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:2.4.136:*:*:*:*:*:*:*", "matchCriteriaId": "847602BA-85D7-432D-917D-76D14E6D2769"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/741243f707cac7de1a3769a38e03004f037f4a3d", "source": "cve@mitre.org", "tags": ["Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/741243f707cac7de1a3769a38e03004f037f4a3d"}}