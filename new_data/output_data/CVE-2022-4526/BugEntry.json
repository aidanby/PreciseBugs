{"buggy_code": ["Changelog\n=========\n\n3.16 (unreleased)\n-----------------\n\n- Split out zip upload functionality into a separate function (#222) (contributed by lausek).\n\n\n3.15.1 (2022-02-23)\n-------------------\n\n- Django 4.0 adds a no-op migration (#221) (reported by rhbvkleef).\n\n\n3.15 (2022-02-05)\n-----------------\n\n- Made compatible with Django 4.0 (#220) (contributed by Martijn Verkleij).\n- Updated French translation (#219) (contributed by Alexandre Iooss).\n\n3.14 (2021-10-03)\n-----------------\n\n- Updated the sample templates to use Bootstrap 5 (previously used Bootstrap 3).\n- Checked compatibility with Django 3.2.\n- Use isort to tidy the Python imports.\n\n3.13 (2020-09-03)\n-----------------\n\n- Checked compatibility with Django 3.1.\n- Apply crop/effect changes to existing images (#210).\n- Encoding objects before hashing error\t(#205).\n\n3.12 (2020-07-30)\n-----------------\n\n- Drop alpha channel only on jpeg save (contributed by drazen)\n- Added zh_Hans translation\t(contributed by Lessica)\n- improved Dutch translations (contributed by andreas.milants)\n\n3.11 (2019-12-13)\n-----------------\n\n- Added support for Django 3.\n- Dropped support for Python 2, python 3.4 and Django 2.1.\n\n\n3.10 (2019-08-29)\n-----------------\n\n- Compatibility with Django 2.2.\n\n\n3.9 (2019-04-21)\n----------------\n\n- Fixes when file doesn't exist in the file system but still is in S3.\n- Doc tweaks - and added a page on how to actually use Photologue!\n- Make setup compatible with latest version of pip.\n- Checked compatibility with Django 2.1 and Python 3.7.\n- Updated translations for Catalan and Basque.\n- Missed a Django migration (issue #194).\n- Test Tox; integrate with Travis and Coveralls.\n- Removed old code (old-style demo templates that have been deprecated since 2014).\n- Removed old code (old views that have been deprecated since 2014).\n- Removed all references to PIL (which hasn't been updated since 2009). I think that by now\n  there are no servers left anywhere in the world that still use it :-)\n\n3.8.1 (2017-12-03)\n------------------\n\n- Admin thumbnails were not displaying correctly.\n\n\n3.8 (2017-12-03)\n----------------\n\n- Added support for Django 2.0.\n- Dropped support for Django 1.8 and 1.10.\n- Did not really work with Django 1.11 - sortedm2m library was broken. Upgraded sortedm2m and it now works with 1.11.\n- New translation for Ukrainian; updated translation for Spanish.\n- Fixed template tag that was broken in Django 1.11.\n\n3.7 (2017-05-10)\n----------------\n\n- Now works with Django 1.11. Deprecated support for Django 1.9.\n- Fixed the management commands to work in the latest versions of Django.\n- Fixed an issue with some photo sizes not being created (see #170).\n- Updated translations for French and Basque (provided by matthieu.payet and urtzai).\n\n3.6 (2016-10-05)\n----------------\n\n- Now works with Django 1.10 (to be precise: Photologue worked, but the unit tests did not).\n- Updated urlpatterns in docs, tests and example project for Django 1.8+\n- Enhance Python 2.7 EXIF info.\n- Updated docs (contributed by lizwalsh).\n- Fixed command plcreatesize (contributed by Mikel Larreategi).\n- Fixed deprecated template settings (contributed by Justin Dugger).\n- Updated translations for German and Russian.\n\n3.5.1 (2016-01-13)\n------------------\n\n- Photologue 3.5 failed to install under Python 2.7. Looks like distutils does not like files\n  with non-ascii filenames (reported in #149).\n- Fix for issue #149 - bug with projects that extend ImageModel.\n\n\n3.5 (2016-01-09)\n----------------\n\n- Increased length of 'title' fields to 250 chars in order to store longer title.\n- Rotate image before resize, to comply with height/width constraints (see #145).\n- Added forgotten migration (#148).\n- Changing \"Photo\" image leaves extra files on server (#147).\n- Normalize filenames to ASCII so they work across all filesystems (#109).\n- Updated Hungarian translation.\n\n3.4.1 (2015-12-23)\n------------------\n\n- Django 1.9 requires latest version of django-sortedm2m.\n\n\n3.4 (2015-12-23)\n----------------\n\nUpgrade notes:\n- The EXIF property of an Image is now a method instead.\n\n- Dropped support for Django 1.7.\n- Fixed a few minor issues with the unit tests.\n- Adding a watermark was crashing (fix suggested by hambro).\n- Added/updated translations: Danish, Slovak (contributed by Rasmus Klett, saboter).\n- Fixed Django 1.9 Deprecation warnings (contributed by jlemaes).\n- Processing of EXIF data was broken (and very broken in Python 3) - updated library and bug fixes.\n\n\n3.3.2 (2015-07-20)\n------------------\n\n- Release Photologue as a universal wheel.\n\n\n3.3.1 (2015-07-20)\n------------------\n\n- Upload of 3.3 to Pypi had failed.\n\n3.3 (2015-07-20)\n----------------\n\n- In the initial data setup, the 'thumbnail' photosizes should not increment the\n  view count (issue #133).\n- Fix typo in admin text (issue reported by Transifex user ciastko).\n- Updated translations: Hungarian, Czech, Dutch.\n- Zip upload used gallery title instead of \"Title\" field for photos (#139).\n- Zip upload: an uploaded photo is not a duplicate of an existing photo simply because they share the same slug.\n- Updated django-sortedm2m version - this should help admin performance for galleries with lots of photos.\n\n3.2 (2015-05-11)\n----------------\n\n- Dropped support for Django 1.6.\n- Rotation of photos based upon EXIF data if available, so they get displayed correctly (#122).\n- Misc doc tweaks.\n- Only clear scale cache if image has changed.\n- Pagination is now hard-coded to 20 items per page - it's a convenience to have it available as\n  soon as the app is run, but having settings to tweak this value is not needed as it's so\n  easy to override in a Django project.\n- PHOTOLOGUE_GALLERY_PAGINATE_BY and PHOTOLOGUE_PHOTO_PAGINATE_BY were previously deprecated\n  and have now been removed.\n- Tagging has been removed from Photologue.\n- All references to 'title_slug' field have been removed.\n- Django can now natively chain custom manager filters - so the dependency on django-model-utils\n  is removed.\n- Updated German translation.\n- Improved setup file.\n\n3.1.1 (2014-11-13)\n------------------\n\n- The 'zip upload' functionality did not work (the required html templates\n  were not included into the released package).\n- Updated French translation.\n\n3.1 (2014-11-03)\n----------------\n\n- The 'zip upload' functionality has been moved to a custom admin page.\n- Refactor `add_accessor_methods` to be lazily applied (see #110).\n- Updated German translation.\n- Several improvements to the sample Bootstrap templates.\n- Support CACHEDIR.TAG spec issue #89\n- Fix issue #99 by adding 10 extra char to photo title(max gallery size up to 999999999 images)\n- Sitemap.xml was not aware of Sites (#104).\n- In python 3, gallery upload would crash if uploaded file was not a zip file (#106).\n\n3.0.2 (2014-09-23)\n------------------\n\n- Updated django-sortedm2m to an official release.\n- Updated Spanish translation.\n- Updated Bootstrap version used in example project.\n\n3.0.1 (2014-09-16)\n------------------\n\n- Missed out some templates from the released package.\n\n3.0 (2014-09-15)\n----------------\n\nUpgrade notes:\n\nWARNING: IF YOU'RE USING POSTGRESQL AS A DATABASE & DJANGO 1.7, THE LATEST RELEASE OF\nDJANGO-SORTEDM2M HAS A BUG. INSTEAD, YOU'LL HAVE TO MANUALLY INSTALL:\n\npip install -e git://github.com/richardbarran/django-sortedm2m.git@9a609a1c6b790a40a016e4ceadedbb6dd6b92010#egg=sortedm2m\n\n\n\nTHE FOLLOWING CHANGES BREAK BACKWARDS COMPATIBILITY!\n\n- Django 1.7 comes with a new migrations framework which replaces South -\n  if you continue to use Django 1.6, you'll need to add new settings. Please\n  refer in the docs to the installation instructions.\n  If you're upgrading to Django 1.7 - upgrade Photologue first, THEN upgrade\n  Django.\n- The Twitter-Bootstrap templates - previously in 'contrib' - become the default; the\n  previous templates are moved to 'contrib'.\n- The django-tagging library is no longer maintained by its author. As a consequence,\n  it has been disabled - see the docs for more information (page\n  https://django-photologue.readthedocs.org/en/latest/pages/customising/settings.html#photologue-enable-tags)\n- Support for Django 1.4 and 1.5 has been dropped (Photologue depends on django-sortedm2m,\n  which has dropped support for 1.4; and Django 1.5 is no longer supported).\n- PHOTOLOGUE_USE_CKEDITOR has been removed.\n- Many urls have been renamed; photologue urls now go into their own namespace. See the urls.py\n  file for all the changes.\n\nOther changes:\n\n- Support for Amazon S3 to store images (thank you Celia Oakley!).\n- List views have changed urls: instead of /page/<n>/, we now have a /?page=<n> pattern.\n  This is a more common style, and allows us to simplify template code e.g. paginators!\n- date_taken field not correctly handled during single photo upload (#80).\n- Removed deprecated PhotologueSitemap.\n- Gallery zip uploads would fail if the title contained unicode characters.\n- Gallery-uploads: Do not require title for uploading to existing gallery (#98).\n- The Photologue urls used to use names for months; this has been changed to using\n  numbers, which is better for non-English websites (#101).\n\n\n2.8.3 (2014-08-28)\n------------------\n\n- Updated Spanish translation.\n\n2.8.2 (2014-07-26)\n------------------\n\n- The latest release of django-sortedm2m is not compatible with older\n  versions of Django, so don't use it (issue #92).\n\n2.8.1 (2014-07-26)\n------------------\n\n- Fixed issue #94 (problem with i18n plural forms).\n- Updated Slovak translation.\n\n2.8 (2014-05-04)\n----------------\n\nUpgrade notes:\n\n1. Photologue now depends on django-sortedm2m and django-model-utils - please\n   refer to installation instructions. These dependencies should be added\n   automatically.\n\n2. Run South migrations.\n\nList of changes:\n\n- Photo and Gallery models now support Django's sites framework.\n- Photologue now uses django-sortedm2m to sort photos in a gallery.\n- Major rewrite of zip archive uploader: warn users of files that could not be\n  processed, get code to work with Python 3 (issue #71), add extra error\n  handling.\n- Renamed field title_slug to slug - this allows us to simplify views.py a\n  bit.\n- PHOTOLOGUE_USE_CKEDITOR, PHOTOLOGUE_GALLERY_PAGINATE_BY and\n  PHOTOLOGUE_PHOTO_PAGINATE_BY are deprecated.\n- Fixed pagination controls for photo list template.\n- Tightened naming rules for Photosize names.\n- Fixed a couple of unicode-related bugs.\n- Added to the documentation pages describing how to customise the admin and\n  the views.\n- Refactored slightly views.py.\n- Started work on chainable querysets.\n\n2.7 (2013-10-27)\n----------------\n\nUpgrade notes:\n\n1. All settings are now prefixed with ``PHOTOLOGUE_``. Please check that you are\n   not affected by this.\n\nList of changes:\n\n- Fixed issue #56, Gallery pagination is broken.\n- Photologue now works with Python 3.\n- Added a set of templates that work well with Twitter-Bootstrap 3, and used\n  them for the 'example_project'.\n- Fixed issue #64 (allow installation without installing Pillow).\n- Optional use of CKEditor.\n- Updated/new translations for Polish, Slovak and German.\n- Bugfix: allow viewing latest galleries/latest photos pages even if they\n  are empty.\n- Started using factory-boy - makes unit tests a bit easier to read.\n- Added settings to customise pagination count on list pages.\n- Documented all settings.\n- All settings are now prefixed with ``PHOTOLOGUE_``.\n\n2.6.1 (2013-05-19)\n------------------\n\nList of changes:\n\n- Fixed broken packaging in release 2.6.\n\n2.6 (2013-05-19)\n----------------\n\nUpgrade notes:\n\n1. Photologue now relies on Pillow instead of PIL. The easiest way to upgrade\n   is to remove PIL completely, then install the new version of Photologue.\n2. Photologue, in line with Django itself, has dropped support for Django 1.3.\n\nList of changes:\n\n- Switched from PIL to Pillow - hopefully this should make installation\n  easier.\n- Initial setup of data: removed plinit and replaced it with a South data\n  migration.\n- Added feature to allow extending the built-in templates (and documented\n  it!).\n- Allow editing of Photo added date (temp way of sorting photos).\n- Added an example project to help people wanting to contribute to the\n  project.\n- Fixed buggy Travis CI script.\n- fixed issue #52, transactions in migration\n- fixed issue #51, uniqueness collisions in migration\n- Accessing the root url (usually /photologue/ will now redirect you to the\n  gallery list view.\n- Photologue requires min. Django 1.4.\n- Tidied a data validator on PhotoSizes.\n\n2.5 (2012-12-13)\n----------------\n\n- added a sitemap.xml.\n- added some templatetags.\n- started using Sphinx for managing documentation.\n- started using Transifex for managing translations.\n- started using Travis CI.\n- added 12 new translations and improved some of the existing translations.\n- fixed issue #29 (quote URL of resized image properly).\n- misc improvements to clarity of unit tests.\n- added Django 1.4 timezone support.\n\n2.4 (2012-08-13)\n----------------\n\nUpgrade notes:\n\n1. Starting with this version, Photologue uses South to manage the database\n   schema. If you are upgrading an existing Photologue installation, please\n   follow the South instructions at:\n   http://south.readthedocs.org/en/latest/convertinganapp.html#converting-other-installations-and-servers\n\n2. Photologue has dropped support for Django 1.2.\n\nList of changes:\n\n- use South to manage schema changes.\n- updated installation instructions.\n- fixed issue #9 (In Django 1.3, FileField no longer deletes files).\n- switched from function-based generic views to class-based views.\n- fixed PendingDeprecationWarnings seen when running Django 1.3 - this will\n  make the move to Django 1.5 easier.\n- added unit tests.\n- fixed bug where GALLERY_SAMPLE_SIZE setting was not being used.\n- fixed issue #11 (GalleryUpload with len(title) > 50 causes a crash).\n- fixed issue #10 (Increase the size of the name field for photosize).\n", "#####\nUsage\n#####\n\nNow that you've installed Photologue, here are a few suggestions on how to use it:\n\nUpload some photos in the admin\n-------------------------------\nThe ``Photo`` model in the admin allows you to add new photos to Photologue. You can add photos one by one - and\nit the top-right corner there is a 'Upload a Zip archive' button that will allow you to upload many photos at once.\n\nDefine some Photosizes\n----------------------\nPhotologue will create thumbnails of the photos that you upload, and the thumbnails are what is displayed in the\npublic website. By default Photologue comes with a few Photosizes to get you started - feel free to tweak them, or\nto create new ones.\n\nJust note that the ``admin_thumbnail`` size is used by the admin pages, so it's not a good idea to delete it!\n\nBuilt-in pages and templates\n----------------------------\n\nIf you've followed all the instructions in the installation page, you will have included Photologue's\nurls at ``/photologue/`` - you can use these, tweak them, or discard them if they do not fit in with your website's\nrequirements.\n\nCustom usage\n------------\nThe base of Photologue is the ``Photo`` model. When an instance is created, we automatically add methods to retrieve\nphotos at various photosizes. E.g. if you have an instance of ``Photo`` called ``photo``, then the\nfollowing methods will have been added automatically::\n\n    photo.get_thumbnail_url()\n    photo.get_display_url()\n    photo.get_admin_thumbnail_url()\n\nThese can be used in a custom template to display a thumbnail, e.g.::\n\n    <a href=\"{{ photo.image.url }}\">\n        <img src=\"{{ photo.get_display_url }}\" alt=\"{{ photo.title }}\">\n    </a>\n\nThis will display an image, sized to the dimensions specified in the Photosize ``display``,\nand provide a clickable link to the raw image. Please refer to the example templates for ideas on how to use\n``Photo`` and ``Gallery`` instances!\n", "{% extends \"photologue/root.html\" %}\r\n{% load photologue_tags i18n %}\r\n\r\n{% block title %}{{ object.title }}{% endblock %}\r\n\r\n{% block content %}\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-lg-12\">\r\n        <h1>{{ object.title }}</h1>\r\n        <p class=\"text-muted small\">{% trans \"Published\" %} {{ object.date_added }}</p>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-md-6\">\r\n        {% if object.caption %}<p>{{ object.caption|safe }}</p>{% endif %}\r\n        <a href=\"{{ object.image.url }}\">\r\n            <img src=\"{{ object.get_display_url }}\" class=\"img-thumbnail\" alt=\"{{ object.title }}\">\r\n        </a>\r\n    </div>\r\n    <div class=\"col-md-6\">\r\n        {% if object.public_galleries %}\r\n        <p>{% trans \"This photo is found in the following galleries\" %}:</p>\r\n        <table>\r\n            {% for gallery in object.public_galleries %}\r\n            <tr>\r\n                <td>{% previous_in_gallery object gallery %}</td>\r\n                <td class=\"text-center\"><a href=\"{{ gallery.get_absolute_url }}\">{{ gallery.title }}</a></td>\r\n                <td>{% next_in_gallery object gallery %}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n        {% endif %}\r\n    </div>\r\n</div>\r\n\r\n{% endblock %}\r\n", "from django.test import TestCase, override_settings\n\nfrom ..models import Photo\nfrom .factories import PhotoFactory\n\n\n@override_settings(ROOT_URLCONF='photologue.tests.test_urls')\nclass RequestPhotoTest(TestCase):\n\n    def setUp(self):\n        super().setUp()\n        self.photo = PhotoFactory(slug='fake-photo')\n\n    def tearDown(self):\n        super().tearDown()\n        self.photo.delete()\n\n    def test_archive_photo_url_works(self):\n        response = self.client.get('/ptests/photo/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_photo_empty(self):\n        \"\"\"If there are no photo to show, tell the visitor - don't show a\n        404.\"\"\"\n\n        Photo.objects.all().update(is_public=False)\n\n        response = self.client.get('/ptests/photo/')\n        self.assertEqual(response.status_code, 200)\n\n        self.assertEqual(response.context['latest'].count(),\n                         0)\n\n    def test_paginated_photo_url_works(self):\n        response = self.client.get('/ptests/photolist/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_photo_works(self):\n        response = self.client.get('/ptests/photo/fake-photo/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_year_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_month_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_day_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/23/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_detail_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/23/fake-photo/')\n        self.assertEqual(response.status_code, 200)\n"], "fixing_code": ["Changelog\n=========\n\n3.16 (unreleased)\n-----------------\n\n- Split out zip upload functionality into a separate function (#222) (contributed by lausek).\n- Do not allow JS injection into the Photo caption field (#223) (bug detected by Domiee13).\n\n\n3.15.1 (2022-02-23)\n-------------------\n\n- Django 4.0 adds a no-op migration (#221) (reported by rhbvkleef).\n\n\n3.15 (2022-02-05)\n-----------------\n\n- Made compatible with Django 4.0 (#220) (contributed by Martijn Verkleij).\n- Updated French translation (#219) (contributed by Alexandre Iooss).\n\n3.14 (2021-10-03)\n-----------------\n\n- Updated the sample templates to use Bootstrap 5 (previously used Bootstrap 3).\n- Checked compatibility with Django 3.2.\n- Use isort to tidy the Python imports.\n\n3.13 (2020-09-03)\n-----------------\n\n- Checked compatibility with Django 3.1.\n- Apply crop/effect changes to existing images (#210).\n- Encoding objects before hashing error\t(#205).\n\n3.12 (2020-07-30)\n-----------------\n\n- Drop alpha channel only on jpeg save (contributed by drazen)\n- Added zh_Hans translation\t(contributed by Lessica)\n- improved Dutch translations (contributed by andreas.milants)\n\n3.11 (2019-12-13)\n-----------------\n\n- Added support for Django 3.\n- Dropped support for Python 2, python 3.4 and Django 2.1.\n\n\n3.10 (2019-08-29)\n-----------------\n\n- Compatibility with Django 2.2.\n\n\n3.9 (2019-04-21)\n----------------\n\n- Fixes when file doesn't exist in the file system but still is in S3.\n- Doc tweaks - and added a page on how to actually use Photologue!\n- Make setup compatible with latest version of pip.\n- Checked compatibility with Django 2.1 and Python 3.7.\n- Updated translations for Catalan and Basque.\n- Missed a Django migration (issue #194).\n- Test Tox; integrate with Travis and Coveralls.\n- Removed old code (old-style demo templates that have been deprecated since 2014).\n- Removed old code (old views that have been deprecated since 2014).\n- Removed all references to PIL (which hasn't been updated since 2009). I think that by now\n  there are no servers left anywhere in the world that still use it :-)\n\n3.8.1 (2017-12-03)\n------------------\n\n- Admin thumbnails were not displaying correctly.\n\n\n3.8 (2017-12-03)\n----------------\n\n- Added support for Django 2.0.\n- Dropped support for Django 1.8 and 1.10.\n- Did not really work with Django 1.11 - sortedm2m library was broken. Upgraded sortedm2m and it now works with 1.11.\n- New translation for Ukrainian; updated translation for Spanish.\n- Fixed template tag that was broken in Django 1.11.\n\n3.7 (2017-05-10)\n----------------\n\n- Now works with Django 1.11. Deprecated support for Django 1.9.\n- Fixed the management commands to work in the latest versions of Django.\n- Fixed an issue with some photo sizes not being created (see #170).\n- Updated translations for French and Basque (provided by matthieu.payet and urtzai).\n\n3.6 (2016-10-05)\n----------------\n\n- Now works with Django 1.10 (to be precise: Photologue worked, but the unit tests did not).\n- Updated urlpatterns in docs, tests and example project for Django 1.8+\n- Enhance Python 2.7 EXIF info.\n- Updated docs (contributed by lizwalsh).\n- Fixed command plcreatesize (contributed by Mikel Larreategi).\n- Fixed deprecated template settings (contributed by Justin Dugger).\n- Updated translations for German and Russian.\n\n3.5.1 (2016-01-13)\n------------------\n\n- Photologue 3.5 failed to install under Python 2.7. Looks like distutils does not like files\n  with non-ascii filenames (reported in #149).\n- Fix for issue #149 - bug with projects that extend ImageModel.\n\n\n3.5 (2016-01-09)\n----------------\n\n- Increased length of 'title' fields to 250 chars in order to store longer title.\n- Rotate image before resize, to comply with height/width constraints (see #145).\n- Added forgotten migration (#148).\n- Changing \"Photo\" image leaves extra files on server (#147).\n- Normalize filenames to ASCII so they work across all filesystems (#109).\n- Updated Hungarian translation.\n\n3.4.1 (2015-12-23)\n------------------\n\n- Django 1.9 requires latest version of django-sortedm2m.\n\n\n3.4 (2015-12-23)\n----------------\n\nUpgrade notes:\n- The EXIF property of an Image is now a method instead.\n\n- Dropped support for Django 1.7.\n- Fixed a few minor issues with the unit tests.\n- Adding a watermark was crashing (fix suggested by hambro).\n- Added/updated translations: Danish, Slovak (contributed by Rasmus Klett, saboter).\n- Fixed Django 1.9 Deprecation warnings (contributed by jlemaes).\n- Processing of EXIF data was broken (and very broken in Python 3) - updated library and bug fixes.\n\n\n3.3.2 (2015-07-20)\n------------------\n\n- Release Photologue as a universal wheel.\n\n\n3.3.1 (2015-07-20)\n------------------\n\n- Upload of 3.3 to Pypi had failed.\n\n3.3 (2015-07-20)\n----------------\n\n- In the initial data setup, the 'thumbnail' photosizes should not increment the\n  view count (issue #133).\n- Fix typo in admin text (issue reported by Transifex user ciastko).\n- Updated translations: Hungarian, Czech, Dutch.\n- Zip upload used gallery title instead of \"Title\" field for photos (#139).\n- Zip upload: an uploaded photo is not a duplicate of an existing photo simply because they share the same slug.\n- Updated django-sortedm2m version - this should help admin performance for galleries with lots of photos.\n\n3.2 (2015-05-11)\n----------------\n\n- Dropped support for Django 1.6.\n- Rotation of photos based upon EXIF data if available, so they get displayed correctly (#122).\n- Misc doc tweaks.\n- Only clear scale cache if image has changed.\n- Pagination is now hard-coded to 20 items per page - it's a convenience to have it available as\n  soon as the app is run, but having settings to tweak this value is not needed as it's so\n  easy to override in a Django project.\n- PHOTOLOGUE_GALLERY_PAGINATE_BY and PHOTOLOGUE_PHOTO_PAGINATE_BY were previously deprecated\n  and have now been removed.\n- Tagging has been removed from Photologue.\n- All references to 'title_slug' field have been removed.\n- Django can now natively chain custom manager filters - so the dependency on django-model-utils\n  is removed.\n- Updated German translation.\n- Improved setup file.\n\n3.1.1 (2014-11-13)\n------------------\n\n- The 'zip upload' functionality did not work (the required html templates\n  were not included into the released package).\n- Updated French translation.\n\n3.1 (2014-11-03)\n----------------\n\n- The 'zip upload' functionality has been moved to a custom admin page.\n- Refactor `add_accessor_methods` to be lazily applied (see #110).\n- Updated German translation.\n- Several improvements to the sample Bootstrap templates.\n- Support CACHEDIR.TAG spec issue #89\n- Fix issue #99 by adding 10 extra char to photo title(max gallery size up to 999999999 images)\n- Sitemap.xml was not aware of Sites (#104).\n- In python 3, gallery upload would crash if uploaded file was not a zip file (#106).\n\n3.0.2 (2014-09-23)\n------------------\n\n- Updated django-sortedm2m to an official release.\n- Updated Spanish translation.\n- Updated Bootstrap version used in example project.\n\n3.0.1 (2014-09-16)\n------------------\n\n- Missed out some templates from the released package.\n\n3.0 (2014-09-15)\n----------------\n\nUpgrade notes:\n\nWARNING: IF YOU'RE USING POSTGRESQL AS A DATABASE & DJANGO 1.7, THE LATEST RELEASE OF\nDJANGO-SORTEDM2M HAS A BUG. INSTEAD, YOU'LL HAVE TO MANUALLY INSTALL:\n\npip install -e git://github.com/richardbarran/django-sortedm2m.git@9a609a1c6b790a40a016e4ceadedbb6dd6b92010#egg=sortedm2m\n\n\n\nTHE FOLLOWING CHANGES BREAK BACKWARDS COMPATIBILITY!\n\n- Django 1.7 comes with a new migrations framework which replaces South -\n  if you continue to use Django 1.6, you'll need to add new settings. Please\n  refer in the docs to the installation instructions.\n  If you're upgrading to Django 1.7 - upgrade Photologue first, THEN upgrade\n  Django.\n- The Twitter-Bootstrap templates - previously in 'contrib' - become the default; the\n  previous templates are moved to 'contrib'.\n- The django-tagging library is no longer maintained by its author. As a consequence,\n  it has been disabled - see the docs for more information (page\n  https://django-photologue.readthedocs.org/en/latest/pages/customising/settings.html#photologue-enable-tags)\n- Support for Django 1.4 and 1.5 has been dropped (Photologue depends on django-sortedm2m,\n  which has dropped support for 1.4; and Django 1.5 is no longer supported).\n- PHOTOLOGUE_USE_CKEDITOR has been removed.\n- Many urls have been renamed; photologue urls now go into their own namespace. See the urls.py\n  file for all the changes.\n\nOther changes:\n\n- Support for Amazon S3 to store images (thank you Celia Oakley!).\n- List views have changed urls: instead of /page/<n>/, we now have a /?page=<n> pattern.\n  This is a more common style, and allows us to simplify template code e.g. paginators!\n- date_taken field not correctly handled during single photo upload (#80).\n- Removed deprecated PhotologueSitemap.\n- Gallery zip uploads would fail if the title contained unicode characters.\n- Gallery-uploads: Do not require title for uploading to existing gallery (#98).\n- The Photologue urls used to use names for months; this has been changed to using\n  numbers, which is better for non-English websites (#101).\n\n\n2.8.3 (2014-08-28)\n------------------\n\n- Updated Spanish translation.\n\n2.8.2 (2014-07-26)\n------------------\n\n- The latest release of django-sortedm2m is not compatible with older\n  versions of Django, so don't use it (issue #92).\n\n2.8.1 (2014-07-26)\n------------------\n\n- Fixed issue #94 (problem with i18n plural forms).\n- Updated Slovak translation.\n\n2.8 (2014-05-04)\n----------------\n\nUpgrade notes:\n\n1. Photologue now depends on django-sortedm2m and django-model-utils - please\n   refer to installation instructions. These dependencies should be added\n   automatically.\n\n2. Run South migrations.\n\nList of changes:\n\n- Photo and Gallery models now support Django's sites framework.\n- Photologue now uses django-sortedm2m to sort photos in a gallery.\n- Major rewrite of zip archive uploader: warn users of files that could not be\n  processed, get code to work with Python 3 (issue #71), add extra error\n  handling.\n- Renamed field title_slug to slug - this allows us to simplify views.py a\n  bit.\n- PHOTOLOGUE_USE_CKEDITOR, PHOTOLOGUE_GALLERY_PAGINATE_BY and\n  PHOTOLOGUE_PHOTO_PAGINATE_BY are deprecated.\n- Fixed pagination controls for photo list template.\n- Tightened naming rules for Photosize names.\n- Fixed a couple of unicode-related bugs.\n- Added to the documentation pages describing how to customise the admin and\n  the views.\n- Refactored slightly views.py.\n- Started work on chainable querysets.\n\n2.7 (2013-10-27)\n----------------\n\nUpgrade notes:\n\n1. All settings are now prefixed with ``PHOTOLOGUE_``. Please check that you are\n   not affected by this.\n\nList of changes:\n\n- Fixed issue #56, Gallery pagination is broken.\n- Photologue now works with Python 3.\n- Added a set of templates that work well with Twitter-Bootstrap 3, and used\n  them for the 'example_project'.\n- Fixed issue #64 (allow installation without installing Pillow).\n- Optional use of CKEditor.\n- Updated/new translations for Polish, Slovak and German.\n- Bugfix: allow viewing latest galleries/latest photos pages even if they\n  are empty.\n- Started using factory-boy - makes unit tests a bit easier to read.\n- Added settings to customise pagination count on list pages.\n- Documented all settings.\n- All settings are now prefixed with ``PHOTOLOGUE_``.\n\n2.6.1 (2013-05-19)\n------------------\n\nList of changes:\n\n- Fixed broken packaging in release 2.6.\n\n2.6 (2013-05-19)\n----------------\n\nUpgrade notes:\n\n1. Photologue now relies on Pillow instead of PIL. The easiest way to upgrade\n   is to remove PIL completely, then install the new version of Photologue.\n2. Photologue, in line with Django itself, has dropped support for Django 1.3.\n\nList of changes:\n\n- Switched from PIL to Pillow - hopefully this should make installation\n  easier.\n- Initial setup of data: removed plinit and replaced it with a South data\n  migration.\n- Added feature to allow extending the built-in templates (and documented\n  it!).\n- Allow editing of Photo added date (temp way of sorting photos).\n- Added an example project to help people wanting to contribute to the\n  project.\n- Fixed buggy Travis CI script.\n- fixed issue #52, transactions in migration\n- fixed issue #51, uniqueness collisions in migration\n- Accessing the root url (usually /photologue/ will now redirect you to the\n  gallery list view.\n- Photologue requires min. Django 1.4.\n- Tidied a data validator on PhotoSizes.\n\n2.5 (2012-12-13)\n----------------\n\n- added a sitemap.xml.\n- added some templatetags.\n- started using Sphinx for managing documentation.\n- started using Transifex for managing translations.\n- started using Travis CI.\n- added 12 new translations and improved some of the existing translations.\n- fixed issue #29 (quote URL of resized image properly).\n- misc improvements to clarity of unit tests.\n- added Django 1.4 timezone support.\n\n2.4 (2012-08-13)\n----------------\n\nUpgrade notes:\n\n1. Starting with this version, Photologue uses South to manage the database\n   schema. If you are upgrading an existing Photologue installation, please\n   follow the South instructions at:\n   http://south.readthedocs.org/en/latest/convertinganapp.html#converting-other-installations-and-servers\n\n2. Photologue has dropped support for Django 1.2.\n\nList of changes:\n\n- use South to manage schema changes.\n- updated installation instructions.\n- fixed issue #9 (In Django 1.3, FileField no longer deletes files).\n- switched from function-based generic views to class-based views.\n- fixed PendingDeprecationWarnings seen when running Django 1.3 - this will\n  make the move to Django 1.5 easier.\n- added unit tests.\n- fixed bug where GALLERY_SAMPLE_SIZE setting was not being used.\n- fixed issue #11 (GalleryUpload with len(title) > 50 causes a crash).\n- fixed issue #10 (Increase the size of the name field for photosize).\n", "#####\nUsage\n#####\n\nNow that you've installed Photologue, here are a few suggestions on how to use it:\n\nUpload some photos in the admin\n-------------------------------\nThe ``Photo`` model in the admin allows you to add new photos to Photologue. You can add photos one by one - and\nit the top-right corner there is a 'Upload a Zip archive' button that will allow you to upload many photos at once.\n\nDefine some Photosizes\n----------------------\nPhotologue will create thumbnails of the photos that you upload, and the thumbnails are what is displayed in the\npublic website. By default Photologue comes with a few Photosizes to get you started - feel free to tweak them, or\nto create new ones.\n\nJust note that the ``admin_thumbnail`` size is used by the admin pages, so it's not a good idea to delete it!\n\nBuilt-in pages and templates\n----------------------------\n\nIf you've followed all the instructions in the installation page, you will have included Photologue's\nurls at ``/photologue/`` - you can use these, tweak them, or discard them if they do not fit in with your website's\nrequirements.\n\nCustom usage\n------------\nThe base of Photologue is the ``Photo`` model. When an instance is created, we automatically add methods to retrieve\nphotos at various photosizes. E.g. if you have an instance of ``Photo`` called ``photo``, then the\nfollowing methods will have been added automatically::\n\n    photo.get_thumbnail_url()\n    photo.get_display_url()\n    photo.get_admin_thumbnail_url()\n\nThese can be used in a custom template to display a thumbnail, e.g.::\n\n    <a href=\"{{ photo.image.url }}\">\n        <img src=\"{{ photo.get_display_url }}\" alt=\"{{ photo.title }}\">\n    </a>\n\nThis will display an image, sized to the dimensions specified in the Photosize ``display``,\nand provide a clickable link to the raw image. Please refer to the example templates for ideas on how to use\n``Photo`` and ``Gallery`` instances!\n\nData integrity\n--------------\nPhotologue will store 'as-is' any data stored for galleries and photos.\nYou may want to enforce some data integrity rules - e.g. to sanitise\nany javascript injected into a ``Photo`` ``caption`` field. An easy way to do this\nwould be to add extra processing on a ``post-save`` signal.\n\nPhotologue does not sanitise data itself as you may legitimately want to store html and\njavascript in a caption field e.g. if you use a rich-text editor.\n\n", "{% extends \"photologue/root.html\" %}\r\n{% load photologue_tags i18n %}\r\n\r\n{% block title %}{{ object.title }}{% endblock %}\r\n\r\n{% block content %}\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-lg-12\">\r\n        <h1>{{ object.title }}</h1>\r\n        <p class=\"text-muted small\">{% trans \"Published\" %} {{ object.date_added }}</p>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-md-6\">\r\n        {% if object.caption %}<p>{{ object.caption }}</p>{% endif %}\r\n        <a href=\"{{ object.image.url }}\">\r\n            <img src=\"{{ object.get_display_url }}\" class=\"img-thumbnail\" alt=\"{{ object.title }}\">\r\n        </a>\r\n    </div>\r\n    <div class=\"col-md-6\">\r\n        {% if object.public_galleries %}\r\n        <p>{% trans \"This photo is found in the following galleries\" %}:</p>\r\n        <table>\r\n            {% for gallery in object.public_galleries %}\r\n            <tr>\r\n                <td>{% previous_in_gallery object gallery %}</td>\r\n                <td class=\"text-center\"><a href=\"{{ gallery.get_absolute_url }}\">{{ gallery.title }}</a></td>\r\n                <td>{% next_in_gallery object gallery %}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n        {% endif %}\r\n    </div>\r\n</div>\r\n\r\n{% endblock %}\r\n", "from django.test import TestCase, override_settings\n\nfrom ..models import Photo\nfrom .factories import PhotoFactory\n\n\n@override_settings(ROOT_URLCONF='photologue.tests.test_urls')\nclass RequestPhotoTest(TestCase):\n\n    def setUp(self):\n        super().setUp()\n        self.photo = PhotoFactory(slug='fake-photo')\n\n    def tearDown(self):\n        super().tearDown()\n        self.photo.delete()\n\n    def test_archive_photo_url_works(self):\n        response = self.client.get('/ptests/photo/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_photo_empty(self):\n        \"\"\"If there are no photo to show, tell the visitor - don't show a\n        404.\"\"\"\n\n        Photo.objects.all().update(is_public=False)\n\n        response = self.client.get('/ptests/photo/')\n        self.assertEqual(response.status_code, 200)\n\n        self.assertEqual(response.context['latest'].count(),\n                         0)\n\n    def test_paginated_photo_url_works(self):\n        response = self.client.get('/ptests/photolist/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_photo_works(self):\n        response = self.client.get('/ptests/photo/fake-photo/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_year_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_month_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_archive_day_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/23/')\n        self.assertEqual(response.status_code, 200)\n\n    def test_detail_photo_works(self):\n        response = self.client.get('/ptests/photo/2011/12/23/fake-photo/')\n        self.assertEqual(response.status_code, 200)\n    def test_detail_photo_xss(self):\n        \"\"\"Check that the default templates handle XSS.\"\"\"\n        self.photo.title = '<img src=x onerror=alert(\"title\")>'\n        self.photo.caption = '<img src=x onerror=alert(origin)>'\n        self.photo.save()\n        response = self.client.get('/ptests/photo/2011/12/23/fake-photo/')\n        self.assertContains(response, 'Photologue Demo - &lt;img src=x onerror=alert(&quot;title&quot;)&gt;')\n        self.assertNotContains(response, '<img src=x onerror=alert(\"title\")>')\n        self.assertContains(response, '&lt;img src=x onerror=alert(origin)&gt;')\n        self.assertNotContains(response, '<img src=x onerror=alert(origin)>')\n"], "filenames": ["CHANGELOG.txt", "docs/pages/usage.rst", "photologue/templates/photologue/photo_detail.html", "photologue/tests/test_views_photo.py"], "buggy_code_start_loc": [7, 45, 17, 56], "buggy_code_end_loc": [7, 45, 18, 56], "fixing_code_start_loc": [8, 46, 17, 57], "fixing_code_end_loc": [9, 57, 18, 67], "type": "CWE-79", "message": "A vulnerability was found in django-photologue up to 3.15.1 and classified as problematic. Affected by this issue is some unknown functionality of the file photologue/templates/photologue/photo_detail.html of the component Default Template Handler. The manipulation of the argument object.caption leads to cross site scripting. The attack may be launched remotely. Upgrading to version 3.16 is able to address this issue. The name of the patch is 960cb060ce5e2964e6d716ff787c72fc18a371e7. It is recommended to apply a patch to fix this issue. VDB-215906 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2022-4526", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-15T21:15:13.207", "lastModified": "2022-12-21T13:33:34.943", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in django-photologue up to 3.15.1 and classified as problematic. Affected by this issue is some unknown functionality of the file photologue/templates/photologue/photo_detail.html of the component Default Template Handler. The manipulation of the argument object.caption leads to cross site scripting. The attack may be launched remotely. Upgrading to version 3.16 is able to address this issue. The name of the patch is 960cb060ce5e2964e6d716ff787c72fc18a371e7. It is recommended to apply a patch to fix this issue. VDB-215906 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:django-photologue_project:django-photologue:*:*:*:*:*:*:*:*", "versionEndIncluding": "3.15.1", "matchCriteriaId": "F9673561-FB49-418C-884E-01152D1AA143"}]}]}], "references": [{"url": "https://github.com/richardbarran/django-photologue/commit/960cb060ce5e2964e6d716ff787c72fc18a371e7", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/richardbarran/django-photologue/issues/223", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215906", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/richardbarran/django-photologue/commit/960cb060ce5e2964e6d716ff787c72fc18a371e7"}}