{"buggy_code": ["<?php\nnamespace FreePBX\\modules;\n\nclass Manager implements \\BMO {\n\tpublic function __construct($freepbx = null) {\n\t\tif ($freepbx == null) {\n\t\t\tthrow new Exception(\"Not given a FreePBX Object\");\n\t\t}\n\t\t$this->FreePBX = $freepbx;\n\t\t$this->db = $freepbx->Database;\n\t}\n\tpublic function install() {\n\t\t$dbh = $this->db;\n\t\t$sql = \"CREATE TABLE IF NOT EXISTS manager (\n\t\t\t`manager_id` INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,\n\t\t\t`name` VARCHAR( 15 ) NOT NULL ,\n\t\t\t`secret` VARCHAR( 50 ) ,\n\t\t\t`deny` VARCHAR( 255 ) ,\n\t\t\t`permit` VARCHAR( 255 ) ,\n\t\t\t`read` VARCHAR( 255 ) ,\n\t\t\t`write` VARCHAR( 255 )\n\t\t)\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\t$stmt->execute();\n\t\t\\outn(_(\"Increasing read field size if needed..\"));\n\t\t$sql = \"ALTER TABLE `manager` CHANGE `read` `read` VARCHAR( 255 )\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t\\out(_(\"error encountered, not altered\"));\n\t\t}\n\n\t\toutn(_(\"Increasing write field size if needed..\"));\n\t\t$sql = \"ALTER TABLE `manager` CHANGE `write` `write` VARCHAR( 255 )\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t\\out(_(\"error encountered, not altered\"));\n\t\t}\n\t\toutn(_(\"Adding write timeout..\"));\n\t\t$sql = \"ALTER TABLE manager ADD writetimeout INT\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t//We are ok with 42S21 because we are trying to add a column and it says that column is present.\n\t\t\tif($e->getCode() == '42S21'){\n\t\t\t\t\\out(_(\"Column present\"));\n\t\t\t}else{\n\t\t\t\t//All other exceptions are bad mmmk\n\t\t\t\t\\out($e->getMessage());\n\t\t\t\tthrow $e;\n\t\t\t}\n\t\t}\n\t}\n\tpublic function uninstall() {\n\t}\n\tpublic function backup() {\n\t}\n\tpublic function restore($backup) {\n\t}\n\tpublic function doConfigPageInit($page) {\n\t\t$action = isset($_REQUEST['action'])?$_REQUEST['action']:'';\n\t\t//the extension we are currently displaying\n\t\t$managerdisplay = isset($_REQUEST['managerdisplay'])?$_REQUEST['managerdisplay']:'';\n\t\t$name = isset($_REQUEST['name'])?$_REQUEST['name']:'';\n\t\t$secret = isset($_REQUEST['secret'])?$_REQUEST['secret']:'';\n\t\t$deny = isset($_REQUEST['deny'])?$_REQUEST['deny']:'0.0.0.0/0.0.0.0';\n\t\t$permit = isset($_REQUEST['permit'])?$_REQUEST['permit']:'127.0.0.1/255.255.255.0';\n\t\t$engineinfo = engine_getinfo();\n\t\t$writetimeout = isset($_REQUEST['writetimeout'])?$_REQUEST['writetimeout']:'100';\n\t\t$astver =  $engineinfo['version'];\n\t\t//if submitting form, update database\n\t\tglobal $amp_conf;\n\t\tif($action == 'add' || $action == 'delete') {\n\t\t\t$ampuser = $amp_conf['AMPMGRUSER'];\n\t\t\tif($ampuser == $name) {\n\t\t\t\t$action = 'conflict';\n\t\t\t}\n\t\t}\n\t\tswitch ($action) {\n\t\tcase \"add\":\n\t\t\t$rights = manager_format_in($_REQUEST);\n\t\t\tmanager_add($name,$secret,$deny,$permit,$rights['read'],$rights['write'],$writetimeout);\n\t\t\t$_REQUEST['managerdisplay'] = $name;\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"delete\":\n\t\t\tmanager_del($managerdisplay);\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"edit\":  //just delete and re-add\n\t\t\tmanager_del($name);\n\t\t\t$rights = manager_format_in($_REQUEST);\n\t\t\tmanager_add($name,$secret,$deny,$permit,$rights['read'],$rights['write'],$writetimeout);\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"conflict\":\n\t\t\t//do nothing we are conflicting with the FreePBX Asterisk Manager User\n\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function getActionBar($request) {\n\t\t$buttons = array();\n\t\tswitch($request['display']) {\n\t\tcase 'manager':\n\t\t\t$buttons = array(\n\t\t\t\t'delete' => array(\n\t\t\t\t\t'name' => 'delete',\n\t\t\t\t\t'id' => 'delete',\n\t\t\t\t\t'value' => _('Delete')\n\t\t\t\t),\n\t\t\t\t'reset' => array(\n\t\t\t\t\t'name' => 'reset',\n\t\t\t\t\t'id' => 'reset',\n\t\t\t\t\t'value' => _('Reset')\n\t\t\t\t),\n\t\t\t\t'submit' => array(\n\t\t\t\t\t'name' => 'submit',\n\t\t\t\t\t'id' => 'submit',\n\t\t\t\t\t'value' => _('Submit')\n\t\t\t\t)\n\t\t\t);\n\t\t\tif (empty($request['managerdisplay'])) {\n\t\t\t\tunset($buttons['delete']);\n\t\t\t}\n\t\t\tif(!isset($_REQUEST['view'])){\n\t\t\t\t$buttons = array();\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\treturn $buttons;\n\t}\n\tpublic function ajaxRequest($req, &$setting) {\n\t\tswitch ($req) {\n\t\tcase 'getJSON':\n\t\t\treturn true;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function ajaxHandler(){\n\t\tswitch ($_REQUEST['command']) {\n\t\tcase 'getJSON':\n\t\t\tswitch ($_REQUEST['jdata']) {\n\t\t\tcase 'grid':\n\t\t\t\treturn $this->listManagers();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function listManagers(){\n\t\t$dbh = $this->db;\n\t\t$sql = \"SELECT manager_id, name, deny, permit FROM manager ORDER BY name\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\t$stmt->execute();\n\t\t$ret = $stmt->fetchAll(\\PDO::FETCH_ASSOC);\n\t\t$res = is_array($ret)?$ret:array();\n\t\treturn $res;\n\t}\n}\n", "<?php\n\nif (isset($_REQUEST['managerdisplay'])){\n  $managerdisplay = $_REQUEST['managerdisplay'];\n  $subhead = '<h2>'._(\"Manager\").' '.$managerdisplay.'</h2>';\n  $delURL = '?display=manager&amp;managerdisplay='.$managerdisplay.'&amp;action=delete';\n  //get details for this manager\n  $thisManager = manager_get($managerdisplay);\n  //create variables\n  extract(manager_format_out($thisManager));\n} else {\n  $subhead = '<h2>'._(\"Add Manager\").'</h2>';\n  $delURL = '';\n  $rall = 1;\n  $wall = 1;\n  $name = '';\n  $secret = md5(openssl_random_pseudo_bytes(16));\n  $deny = '0.0.0.0/0.0.0.0';\n  $permit = '127.0.0.1/255.255.255.0';\n}\n$permtypes = array(\n  'system' => _(\"system\"),\n  'call' => _(\"call\"),\n  'log' => _(\"log\"),\n  'verbose' => _(\"verbose\"),\n  'command' => _(\"command\"),\n  'agent' => _(\"agent\"),\n  'user' => _(\"user\"),\n  'config' => _(\"config\"),\n  'dtmf' => _(\"dtmf\"),\n  'reporting' => _(\"reporting\"),\n  'cdr' => _(\"cdr\"),\n  'dialplan' => _(\"dialplan\"),\n  'originate' => _(\"originate\"),\n\n);\nif(isset($rall)){\n  foreach ($permtypes as $key => $value) {\n    $genkey = 'r'.$key;\n    $$genkey = true;\n  }\n}\nif(isset($wall)){\n  foreach ($permtypes as $key => $value) {\n    $genkey = 'w'.$key;\n    $$genkey = true;\n  }\n}\n?>\n<?php echo $subhead; ?>\n<form class=\"fpbx-submit\" name=\"editMan\" action=\"\" onsubmit=\"return checkConf();\" method=\"post\" autocomplete=\"off\" data-fpbx-delete=\"<?php echo $delURL?>\" role=\"form\">\n  <input type=\"hidden\" name=\"display\" value=\"manager\">\n\t<input type=\"hidden\" name=\"action\" value=\"<?php echo (isset($managerdisplay) ? 'edit' : 'add') ?>\">\n  <input type=\"hidden\" name=\"view\" value=\"form\">\n    <ul class=\"nav nav-tabs\" role=\"tablist\">\n        <li data-name=\"managerset\" class=\"change-tab active\"><a href=\"#managerset\" aria-controls=\"managerset\" role=\"tab\" data-toggle=\"tab\"><?php echo _(\"General\")?></a></li>\n        <li data-name=\"managerperm\" class=\"change-tab\"><a href=\"#managerperm\" aria-controls=\"managerperm\" role=\"tab\" data-toggle=\"tab\"><?php echo _(\"Permissions\")?></a></li>\n    </ul>\n    <div class=\"tab-content display\">\n        <div id=\"managerset\" class=\"tab-pane active\">\n            <!--Manager name-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"name\"><?php echo _(\"Manager name\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"name\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"name\" name=\"name\" value=\"<?php echo isset($name)?$name:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"name-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Name of the manager without spaces.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Manager name-->\n            <!--Manager secret-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"secret\"><?php echo _(\"Manager secret\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"secret\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <div class=\"input-group\">\n                          <input type=\"password\" class=\"form-control password-meter\" id=\"secret\" name=\"secret\" value=\"<?php echo isset($secret)?$secret:''?>\">\n                          <span class=\"input-group-addon toggle-password\" id=\"pwtoggle\" data-id=\"secret\"><i class=\"fa fa-eye\"></i></a></span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"secret-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Password for the manager.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Manager secret-->\n            <!--Deny-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"deny\"><?php echo _(\"Deny\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"deny\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"deny\" name=\"deny\" value=\"<?php echo isset($deny)?$deny:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"deny-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"If you want to deny many hosts or networks, use & char as separator.<br/><br/>Example: 192.168.1.0/255.255.255.0&10.0.0.0/255.0.0.0\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Deny-->\n            <!--Permit-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"permit\"><?php echo _(\"Permit\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"permit\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"permit\" name=\"permit\" value=\"<?php echo isset($permit)?$permit:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"permit-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"If you want to permit many hosts or networks, use & char as separator. Look at deny example.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Permit-->\n            <!--Write Timeout-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"writetimeout\"><?php echo _(\"Write Timeout\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"writetimeout\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <div class=\"input-group\">\n                          <input type=\"text\" class=\"form-control\" id=\"writetimeout\" name=\"writetimeout\" value=\"<?php echo isset($writetimeout)?$writetimeout:'100'?>\">\n                          <span class=\"input-group-addon\"><?php echo _(\"milliseconds\") ?></span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"writetimeout-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Sets the timeout used by Asterisk when writing data to the AMI connection for this user\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Write Timeout-->\n        </div>\n        <div id=\"managerperm\" class=\"tab-pane\">\n          <div class=\"well well-info\">\n            <?php echo _(\"For information on individual permissions please see the Asterisk Manager Documentation\")?>\n          </div>\n            <table class=\"table table-striped\">\n              <thead>\n                <th><?php echo (\"Permission\")?> </th>\n                <th><?php echo (\"Read\")?> </th>\n                <th><?php echo (\"Write\")?> </th>\n              </thead>\n              <tbody>\n                <?php\n                foreach ($permtypes as $type => $title) {\n                  $rtype = 'r'.$type;\n                  $wtype = 'w'.$type;\n                  echo '<tr>';\n                  echo '<td>';\n                  echo $title;\n                  echo '</td>';\n                  echo '<td>';\n                  echo '<div class=\"col-md-9 radioset\">';\n                  echo '<input type=\"radio\" name=\"'.$rtype.'\" id=\"'.$rtype.'yes\" value=\"1\" '.(isset($$rtype)?\"CHECKED\":\"\").'>';\n                  echo '<label for=\"'.$rtype.'yes\">'._(\"Yes\").'</label>';\n                  echo '<input type=\"radio\" name=\"'.$rtype.'\" id=\"'.$rtype.'no\" '.(isset($$rtype)?\"\":\"CHECKED\").'>';\n                  echo '<label for=\"'.$rtype.'no\">'. _(\"No\").'</label>';\n                  echo '</div>';\n                  echo '</td>';\n                  echo '<td>';\n                  echo '<div class=\"col-md-9 radioset\">';\n                  echo '<input type=\"radio\" name=\"'.$wtype.'\" id=\"'.$wtype.'yes\" value=\"1\" '.(isset($$wtype)?\"CHECKED\":\"\").'>';\n                  echo '<label for=\"'.$wtype.'yes\">'._(\"Yes\").'</label>';\n                  echo '<input type=\"radio\" name=\"'.$wtype.'\" id=\"'.$wtype.'no\" '.(isset($$wtype)?\"\":\"CHECKED\").'>';\n                  echo '<label for=\"'.$wtype.'no\">'. _(\"No\").'</label>';\n                  echo '</div>';\n                  echo '</td>';\n                  echo '</tr>';\n                }\n                ?>\n                <tr>\n                  <td><b> <?php echo _(\"Toggle All\")?> </b></td>\n                  <td>\n                    <div class=\"col-md-9 radioset\">\n                    <input type=\"radio\" name=\"rall\" id=\"rallyes\" value=\"1\">\n                    <label for=\"rallyes\"><?php echo _(\"Yes\")?></label>\n                    <input type=\"radio\" name=\"rall\" id=\"rallno\" value=\"off\">\n                    <label for=\"rallno\"><?php echo _(\"No\")?></label>\n                    </div>\n                  </td>\n                  <td>\n                    <div class=\"col-md-9 radioset\">\n                    <input type=\"radio\" name=\"wall\" id=\"wallyes\" value=\"1\">\n                    <label for=\"wallyes\"><?php echo _(\"Yes\")?></label>\n                    <input type=\"radio\" name=\"wall\" id=\"wallno\" value=\"0\">\n                    <label for=\"wallno\"><?php echo _(\"No\")?></label>\n                    </div>\n                  </td>\n                </tr>\n              <tbody>\n            </table>\n        </div>\n    </div>\n</form>\n<script language=\"javascript\">\n<!--\n\nvar theForm = document.editMan;\n\ntheForm.name.focus();\n\n$(document).ready(function(){\n  $(\"input[name='rall']\").change(function(){\n    if($(this).val() == 1){\n      $(\"input[name^='r'][type=radio]\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'rall'){\n          return;\n        }\n        $('#'+name+'yes').prop('checked',true);\n        $('#'+name+'no').prop('checked',false);\n      })\n    }else{\n      $(\"input[name^='r'][type=radio\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'rall'){\n          return;\n        }\n        $('#'+name+'no').prop('checked',true);\n        $('#'+name+'yes').prop('checked',false);\n      })\n    }\n  });\n  $(\"input[name='wall']\").change(function(){\n    if($(this).val() == 1){\n      $(\"input[name^='w']\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'wall'){\n          return;\n        }\n        $('#'+name+'yes').prop('checked',true);\n        $('#'+name+'no').prop('checked',false);\n      })\n    }else{\n      $(\"input[name^='w']\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'wall'){\n          return;\n        }\n        $('#'+name+'no').prop('checked',true);\n        $('#'+name+'yes').prop('checked',false);\n      })\n    }\n  });\n});\n\nfunction checkConf()\n{\n\tvar errName = \"<?php echo _('The manager name cannot be empty or may not have any space in it.'); ?>\";\n\tvar errSecret = \"<?php echo _('The manager secret cannot be empty.'); ?>\";\n\tvar errDeny = \"<?php echo _('The manager deny is not well formatted.'); ?>\";\n\tvar errPermit = \"<?php echo _('The manager permit is not well formatted.'); ?>\";\n\tvar errRead = \"<?php echo _('The manager read field is not well formatted.'); ?>\";\n\tvar errWrite = \"<?php echo _('The manager write field is not well formatted.'); ?>\";\n\n\tdefaultEmptyOK = false;\n\tif ((theForm.name.value.search(/\\s/) >= 0) || (theForm.name.value.length == 0))\n\t\treturn warnInvalid(theForm.name, errName);\n\tif (theForm.secret.value.length == 0)\n\t\treturn warnInvalid(theForm.name, errSecret);\n\t// Only IP/MASK format are checked\n\tif (theForm.deny.value.search(/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b(&\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b)*$/))\n\t\treturn warnInvalid(theForm.deny, errDeny);\n\tif (theForm.permit.value.search(/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b(&\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b)*$/))\n\t\treturn warnInvalid(theForm.permit, errPermit);\n\treturn true;\n}\n\n//-->\n</script>\n"], "fixing_code": ["<?php\nnamespace FreePBX\\modules;\n\nclass Manager implements \\BMO {\n\tpublic function __construct($freepbx = null) {\n\t\tif ($freepbx == null) {\n\t\t\tthrow new Exception(\"Not given a FreePBX Object\");\n\t\t}\n\t\t$this->FreePBX = $freepbx;\n\t\t$this->db = $freepbx->Database;\n\t}\n\tpublic function install() {\n\t\t$dbh = $this->db;\n\t\t$sql = \"CREATE TABLE IF NOT EXISTS manager (\n\t\t\t`manager_id` INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,\n\t\t\t`name` VARCHAR( 15 ) NOT NULL ,\n\t\t\t`secret` VARCHAR( 50 ) ,\n\t\t\t`deny` VARCHAR( 255 ) ,\n\t\t\t`permit` VARCHAR( 255 ) ,\n\t\t\t`read` VARCHAR( 255 ) ,\n\t\t\t`write` VARCHAR( 255 )\n\t\t)\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\t$stmt->execute();\n\t\t\\outn(_(\"Increasing read field size if needed..\"));\n\t\t$sql = \"ALTER TABLE `manager` CHANGE `read` `read` VARCHAR( 255 )\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t\\out(_(\"error encountered, not altered\"));\n\t\t}\n\n\t\toutn(_(\"Increasing write field size if needed..\"));\n\t\t$sql = \"ALTER TABLE `manager` CHANGE `write` `write` VARCHAR( 255 )\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t\\out(_(\"error encountered, not altered\"));\n\t\t}\n\t\toutn(_(\"Adding write timeout..\"));\n\t\t$sql = \"ALTER TABLE manager ADD writetimeout INT\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\ttry {\n\t\t\t$stmt->execute();\n\t\t\t\\out(_(\"ok\"));\n\t\t} catch (\\PDOException $e) {\n\t\t\t//We are ok with 42S21 because we are trying to add a column and it says that column is present.\n\t\t\tif($e->getCode() == '42S21'){\n\t\t\t\t\\out(_(\"Column present\"));\n\t\t\t}else{\n\t\t\t\t//All other exceptions are bad mmmk\n\t\t\t\t\\out($e->getMessage());\n\t\t\t\tthrow $e;\n\t\t\t}\n\t\t}\n\t}\n\tpublic function uninstall() {\n\t}\n\tpublic function backup() {\n\t}\n\tpublic function restore($backup) {\n\t}\n\tpublic function doConfigPageInit($page) {\n\t\t$action = isset($_REQUEST['action'])?$_REQUEST['action']:'';\n\t\t//the extension we are currently displaying\n\t\t$managerdisplay = isset($_REQUEST['managerdisplay'])?htmlentities($_REQUEST['managerdisplay'], ENT_QUOTES):'';\n\t\t$name = isset($_REQUEST['name'])?$_REQUEST['name']:'';\n\t\t$secret = isset($_REQUEST['secret'])?$_REQUEST['secret']:'';\n\t\t$deny = isset($_REQUEST['deny'])?$_REQUEST['deny']:'0.0.0.0/0.0.0.0';\n\t\t$permit = isset($_REQUEST['permit'])?$_REQUEST['permit']:'127.0.0.1/255.255.255.0';\n\t\t$engineinfo = engine_getinfo();\n\t\t$writetimeout = isset($_REQUEST['writetimeout'])?$_REQUEST['writetimeout']:'100';\n\t\t$astver =  $engineinfo['version'];\n\t\t//if submitting form, update database\n\t\tglobal $amp_conf;\n\t\tif($action == 'add' || $action == 'delete') {\n\t\t\t$ampuser = $amp_conf['AMPMGRUSER'];\n\t\t\tif($ampuser == $name) {\n\t\t\t\t$action = 'conflict';\n\t\t\t}\n\t\t}\n\t\tswitch ($action) {\n\t\tcase \"add\":\n\t\t\t$rights = manager_format_in($_REQUEST);\n\t\t\tmanager_add($name,$secret,$deny,$permit,$rights['read'],$rights['write'],$writetimeout);\n\t\t\t$_REQUEST['managerdisplay'] = $name;\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"delete\":\n\t\t\tmanager_del($managerdisplay);\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"edit\":  //just delete and re-add\n\t\t\tmanager_del($name);\n\t\t\t$rights = manager_format_in($_REQUEST);\n\t\t\tmanager_add($name,$secret,$deny,$permit,$rights['read'],$rights['write'],$writetimeout);\n\t\t\tneedreload();\n\t\t\tbreak;\n\t\tcase \"conflict\":\n\t\t\t//do nothing we are conflicting with the FreePBX Asterisk Manager User\n\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function getActionBar($request) {\n\t\t$buttons = array();\n\t\tswitch($request['display']) {\n\t\tcase 'manager':\n\t\t\t$buttons = array(\n\t\t\t\t'delete' => array(\n\t\t\t\t\t'name' => 'delete',\n\t\t\t\t\t'id' => 'delete',\n\t\t\t\t\t'value' => _('Delete')\n\t\t\t\t),\n\t\t\t\t'reset' => array(\n\t\t\t\t\t'name' => 'reset',\n\t\t\t\t\t'id' => 'reset',\n\t\t\t\t\t'value' => _('Reset')\n\t\t\t\t),\n\t\t\t\t'submit' => array(\n\t\t\t\t\t'name' => 'submit',\n\t\t\t\t\t'id' => 'submit',\n\t\t\t\t\t'value' => _('Submit')\n\t\t\t\t)\n\t\t\t);\n\t\t\tif (empty($request['managerdisplay'])) {\n\t\t\t\tunset($buttons['delete']);\n\t\t\t}\n\t\t\tif(!isset($_REQUEST['view'])){\n\t\t\t\t$buttons = array();\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\treturn $buttons;\n\t}\n\tpublic function ajaxRequest($req, &$setting) {\n\t\tswitch ($req) {\n\t\tcase 'getJSON':\n\t\t\treturn true;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function ajaxHandler(){\n\t\tswitch ($_REQUEST['command']) {\n\t\tcase 'getJSON':\n\t\t\tswitch ($_REQUEST['jdata']) {\n\t\t\tcase 'grid':\n\t\t\t\treturn $this->listManagers();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tpublic function listManagers(){\n\t\t$dbh = $this->db;\n\t\t$sql = \"SELECT manager_id, name, deny, permit FROM manager ORDER BY name\";\n\t\t$stmt = $dbh->prepare($sql);\n\t\t$stmt->execute();\n\t\t$ret = $stmt->fetchAll(\\PDO::FETCH_ASSOC);\n\t\t$res = is_array($ret)?$ret:array();\n\t\treturn $res;\n\t}\n}\n", "<?php\n\nif (isset($_REQUEST['managerdisplay'])){\n  $managerdisplay = htmlentities($_REQUEST['managerdisplay'], ENT_QUOTES);\n  $subhead = '<h2>'._(\"Manager\").' '.$managerdisplay.'</h2>';\n  $delURL = '?display=manager&amp;managerdisplay='.$managerdisplay.'&amp;action=delete';\n  //get details for this manager\n  $thisManager = manager_get($managerdisplay);\n  //create variables\n  extract(manager_format_out($thisManager));\n} else {\n  $subhead = '<h2>'._(\"Add Manager\").'</h2>';\n  $delURL = '';\n  $rall = 1;\n  $wall = 1;\n  $name = '';\n  $secret = md5(openssl_random_pseudo_bytes(16));\n  $deny = '0.0.0.0/0.0.0.0';\n  $permit = '127.0.0.1/255.255.255.0';\n}\n$permtypes = array(\n  'system' => _(\"system\"),\n  'call' => _(\"call\"),\n  'log' => _(\"log\"),\n  'verbose' => _(\"verbose\"),\n  'command' => _(\"command\"),\n  'agent' => _(\"agent\"),\n  'user' => _(\"user\"),\n  'config' => _(\"config\"),\n  'dtmf' => _(\"dtmf\"),\n  'reporting' => _(\"reporting\"),\n  'cdr' => _(\"cdr\"),\n  'dialplan' => _(\"dialplan\"),\n  'originate' => _(\"originate\"),\n\n);\nif(isset($rall)){\n  foreach ($permtypes as $key => $value) {\n    $genkey = 'r'.$key;\n    $$genkey = true;\n  }\n}\nif(isset($wall)){\n  foreach ($permtypes as $key => $value) {\n    $genkey = 'w'.$key;\n    $$genkey = true;\n  }\n}\n?>\n<?php echo $subhead; ?>\n<form class=\"fpbx-submit\" name=\"editMan\" action=\"\" onsubmit=\"return checkConf();\" method=\"post\" autocomplete=\"off\" data-fpbx-delete=\"<?php echo $delURL?>\" role=\"form\">\n  <input type=\"hidden\" name=\"display\" value=\"manager\">\n\t<input type=\"hidden\" name=\"action\" value=\"<?php echo (isset($managerdisplay) ? 'edit' : 'add') ?>\">\n  <input type=\"hidden\" name=\"view\" value=\"form\">\n    <ul class=\"nav nav-tabs\" role=\"tablist\">\n        <li data-name=\"managerset\" class=\"change-tab active\"><a href=\"#managerset\" aria-controls=\"managerset\" role=\"tab\" data-toggle=\"tab\"><?php echo _(\"General\")?></a></li>\n        <li data-name=\"managerperm\" class=\"change-tab\"><a href=\"#managerperm\" aria-controls=\"managerperm\" role=\"tab\" data-toggle=\"tab\"><?php echo _(\"Permissions\")?></a></li>\n    </ul>\n    <div class=\"tab-content display\">\n        <div id=\"managerset\" class=\"tab-pane active\">\n            <!--Manager name-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"name\"><?php echo _(\"Manager name\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"name\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"name\" name=\"name\" value=\"<?php echo isset($name)?$name:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"name-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Name of the manager without spaces.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Manager name-->\n            <!--Manager secret-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"secret\"><?php echo _(\"Manager secret\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"secret\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <div class=\"input-group\">\n                          <input type=\"password\" class=\"form-control password-meter\" id=\"secret\" name=\"secret\" value=\"<?php echo isset($secret)?$secret:''?>\">\n                          <span class=\"input-group-addon toggle-password\" id=\"pwtoggle\" data-id=\"secret\"><i class=\"fa fa-eye\"></i></a></span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"secret-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Password for the manager.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Manager secret-->\n            <!--Deny-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"deny\"><?php echo _(\"Deny\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"deny\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"deny\" name=\"deny\" value=\"<?php echo isset($deny)?$deny:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"deny-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"If you want to deny many hosts or networks, use & char as separator.<br/><br/>Example: 192.168.1.0/255.255.255.0&10.0.0.0/255.0.0.0\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Deny-->\n            <!--Permit-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"permit\"><?php echo _(\"Permit\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"permit\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <input type=\"text\" class=\"form-control\" id=\"permit\" name=\"permit\" value=\"<?php echo isset($permit)?$permit:''?>\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"permit-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"If you want to permit many hosts or networks, use & char as separator. Look at deny example.\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Permit-->\n            <!--Write Timeout-->\n            <div class=\"element-container\">\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <div class=\"row\">\n                    <div class=\"form-group\">\n                      <div class=\"col-md-3\">\n                        <label class=\"control-label\" for=\"writetimeout\"><?php echo _(\"Write Timeout\") ?></label>\n                        <i class=\"fa fa-question-circle fpbx-help-icon\" data-for=\"writetimeout\"></i>\n                      </div>\n                      <div class=\"col-md-9\">\n                        <div class=\"input-group\">\n                          <input type=\"text\" class=\"form-control\" id=\"writetimeout\" name=\"writetimeout\" value=\"<?php echo isset($writetimeout)?$writetimeout:'100'?>\">\n                          <span class=\"input-group-addon\"><?php echo _(\"milliseconds\") ?></span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-12\">\n                  <span id=\"writetimeout-help\" class=\"help-block fpbx-help-block\"><?php echo _(\"Sets the timeout used by Asterisk when writing data to the AMI connection for this user\")?></span>\n                </div>\n              </div>\n            </div>\n            <!--END Write Timeout-->\n        </div>\n        <div id=\"managerperm\" class=\"tab-pane\">\n          <div class=\"well well-info\">\n            <?php echo _(\"For information on individual permissions please see the Asterisk Manager Documentation\")?>\n          </div>\n            <table class=\"table table-striped\">\n              <thead>\n                <th><?php echo (\"Permission\")?> </th>\n                <th><?php echo (\"Read\")?> </th>\n                <th><?php echo (\"Write\")?> </th>\n              </thead>\n              <tbody>\n                <?php\n                foreach ($permtypes as $type => $title) {\n                  $rtype = 'r'.$type;\n                  $wtype = 'w'.$type;\n                  echo '<tr>';\n                  echo '<td>';\n                  echo $title;\n                  echo '</td>';\n                  echo '<td>';\n                  echo '<div class=\"col-md-9 radioset\">';\n                  echo '<input type=\"radio\" name=\"'.$rtype.'\" id=\"'.$rtype.'yes\" value=\"1\" '.(isset($$rtype)?\"CHECKED\":\"\").'>';\n                  echo '<label for=\"'.$rtype.'yes\">'._(\"Yes\").'</label>';\n                  echo '<input type=\"radio\" name=\"'.$rtype.'\" id=\"'.$rtype.'no\" '.(isset($$rtype)?\"\":\"CHECKED\").'>';\n                  echo '<label for=\"'.$rtype.'no\">'. _(\"No\").'</label>';\n                  echo '</div>';\n                  echo '</td>';\n                  echo '<td>';\n                  echo '<div class=\"col-md-9 radioset\">';\n                  echo '<input type=\"radio\" name=\"'.$wtype.'\" id=\"'.$wtype.'yes\" value=\"1\" '.(isset($$wtype)?\"CHECKED\":\"\").'>';\n                  echo '<label for=\"'.$wtype.'yes\">'._(\"Yes\").'</label>';\n                  echo '<input type=\"radio\" name=\"'.$wtype.'\" id=\"'.$wtype.'no\" '.(isset($$wtype)?\"\":\"CHECKED\").'>';\n                  echo '<label for=\"'.$wtype.'no\">'. _(\"No\").'</label>';\n                  echo '</div>';\n                  echo '</td>';\n                  echo '</tr>';\n                }\n                ?>\n                <tr>\n                  <td><b> <?php echo _(\"Toggle All\")?> </b></td>\n                  <td>\n                    <div class=\"col-md-9 radioset\">\n                    <input type=\"radio\" name=\"rall\" id=\"rallyes\" value=\"1\">\n                    <label for=\"rallyes\"><?php echo _(\"Yes\")?></label>\n                    <input type=\"radio\" name=\"rall\" id=\"rallno\" value=\"off\">\n                    <label for=\"rallno\"><?php echo _(\"No\")?></label>\n                    </div>\n                  </td>\n                  <td>\n                    <div class=\"col-md-9 radioset\">\n                    <input type=\"radio\" name=\"wall\" id=\"wallyes\" value=\"1\">\n                    <label for=\"wallyes\"><?php echo _(\"Yes\")?></label>\n                    <input type=\"radio\" name=\"wall\" id=\"wallno\" value=\"0\">\n                    <label for=\"wallno\"><?php echo _(\"No\")?></label>\n                    </div>\n                  </td>\n                </tr>\n              <tbody>\n            </table>\n        </div>\n    </div>\n</form>\n<script language=\"javascript\">\n<!--\n\nvar theForm = document.editMan;\n\ntheForm.name.focus();\n\n$(document).ready(function(){\n  $(\"input[name='rall']\").change(function(){\n    if($(this).val() == 1){\n      $(\"input[name^='r'][type=radio]\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'rall'){\n          return;\n        }\n        $('#'+name+'yes').prop('checked',true);\n        $('#'+name+'no').prop('checked',false);\n      })\n    }else{\n      $(\"input[name^='r'][type=radio\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'rall'){\n          return;\n        }\n        $('#'+name+'no').prop('checked',true);\n        $('#'+name+'yes').prop('checked',false);\n      })\n    }\n  });\n  $(\"input[name='wall']\").change(function(){\n    if($(this).val() == 1){\n      $(\"input[name^='w']\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'wall'){\n          return;\n        }\n        $('#'+name+'yes').prop('checked',true);\n        $('#'+name+'no').prop('checked',false);\n      })\n    }else{\n      $(\"input[name^='w']\").each(function(){\n        var name = $(this).prop('name');\n        if(name == 'reset'){\n          return;\n        }\n        if(name == 'wall'){\n          return;\n        }\n        $('#'+name+'no').prop('checked',true);\n        $('#'+name+'yes').prop('checked',false);\n      })\n    }\n  });\n});\n\nfunction checkConf()\n{\n\tvar errName = \"<?php echo _('The manager name cannot be empty or may not have any space in it.'); ?>\";\n\tvar errSecret = \"<?php echo _('The manager secret cannot be empty.'); ?>\";\n\tvar errDeny = \"<?php echo _('The manager deny is not well formatted.'); ?>\";\n\tvar errPermit = \"<?php echo _('The manager permit is not well formatted.'); ?>\";\n\tvar errRead = \"<?php echo _('The manager read field is not well formatted.'); ?>\";\n\tvar errWrite = \"<?php echo _('The manager write field is not well formatted.'); ?>\";\n\n\tdefaultEmptyOK = false;\n\tif ((theForm.name.value.search(/\\s/) >= 0) || (theForm.name.value.length == 0))\n\t\treturn warnInvalid(theForm.name, errName);\n\tif (theForm.secret.value.length == 0)\n\t\treturn warnInvalid(theForm.name, errSecret);\n\t// Only IP/MASK format are checked\n\tif (theForm.deny.value.search(/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b(&\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b)*$/))\n\t\treturn warnInvalid(theForm.deny, errDeny);\n\tif (theForm.permit.value.search(/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b(&\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\\/\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b)*$/))\n\t\treturn warnInvalid(theForm.permit, errPermit);\n\treturn true;\n}\n\n//-->\n</script>\n"], "filenames": ["Manager.class.php", "views/form.php"], "buggy_code_start_loc": [70, 4], "buggy_code_end_loc": [71, 5], "fixing_code_start_loc": [70, 4], "fixing_code_end_loc": [71, 5], "type": "CWE-79", "message": "An issue was discovered in Manager 13.x before 13.0.2.6 and 15.x before 15.0.6 before FreePBX 14.0.10.3. In the Manager module form (html\\admin\\modules\\manager\\views\\form.php), an unsanitized managerdisplay variable coming from the URL is reflected in HTML, leading to XSS. It can be requested via GET request to /config.php?type=tool&display=manager.", "other": {"cve": {"id": "CVE-2019-16967", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T20:15:10.883", "lastModified": "2019-12-10T17:08:11.423", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in Manager 13.x before 13.0.2.6 and 15.x before 15.0.6 before FreePBX 14.0.10.3. In the Manager module form (html\\admin\\modules\\manager\\views\\form.php), an unsanitized managerdisplay variable coming from the URL is reflected in HTML, leading to XSS. It can be requested via GET request to /config.php?type=tool&display=manager."}, {"lang": "es", "value": "Se detect\u00f3 un problema en Manager versiones 13.x anteriores a 13.0.2.6 y versiones 15.x anteriores a 15.0.6 antes del FreePBX versi\u00f3n 14.0.10.3. En el formulario module de Manager (archivo html\\admin\\modules\\manager\\views\\form.php), una variable managerdisplay no saneada que proviene de la URL es reflejada en HTML, conllevando a una vulnerabilidad de tipo XSS. Que puede ser solicitada mediante una petici\u00f3n GET en /config.php?type=tool&amp;display=manager."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:freepbx:manager:*:*:*:*:*:*:*:*", "versionStartIncluding": "13.0.2", "versionEndExcluding": "13.0.2.6", "matchCriteriaId": "2ED37131-8990-48EF-A4B1-7B612DB29C5C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:freepbx:manager:*:*:*:*:*:*:*:*", "versionStartIncluding": "15.0.2", "versionEndExcluding": "15.0.6", "matchCriteriaId": "7B589D89-2766-4650-A731-C8664ABADAC0"}, {"vulnerable": true, "criteria": "cpe:2.3:a:freepbx:manager:13.0.1:alpha1:*:*:*:*:*:*", "matchCriteriaId": "18119454-234A-476B-9145-883E13727510"}, {"vulnerable": true, "criteria": "cpe:2.3:a:sangoma:freepbx:*:*:*:*:*:*:*:*", "versionEndExcluding": "14.0.10.3", "matchCriteriaId": "0451B14C-368A-4C87-A92F-609067382EA8"}]}]}], "references": [{"url": "https://github.com/FreePBX/manager/commit/071a50983ca6a373bb2d1d3db68e9eda4667a372", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://issues.freepbx.org/browse/FREEPBX-20436", "source": "cve@mitre.org", "tags": ["Exploit", "Vendor Advisory"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/freepbx-xss-2/", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/FreePBX/manager/commit/071a50983ca6a373bb2d1d3db68e9eda4667a372"}}