{"buggy_code": ["<?php\n\nif ( ! defined( 'ABSPATH' ) ) {\n\texit;\n} // Exit if accessed directly\n\n/**\n * Class RP4WP_Settings\n *\n * @todo Make class for each input type with own sanitize method.\n */\nclass RP4WP_Settings {\n\n\tconst PREFIX = 'rp4wp_';\n\n\tconst PAGE = 'rp4wp';\n\n\tprivate $sections;\n\tprivate $defaults;\n\n\t/**\n\t * Constructor\n\t */\n\tpublic function __construct() {\n\n\t\t// CSS default\n\t\t$css_default_lines   = array();\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}';\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}';\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li>p{margin:0;padding:0;}';\n\t\t$css_default_lines[] = '.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}';\n\n\t\tif ( is_rtl() ) {\n\t\t\t$css_default_lines   = array();\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:right;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;float:right;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li>p{margin:0;padding:0;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-post-image{width:35%;padding-left:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:right;}';\n\t\t}\n\n\t\t// The fields\n\t\t$this->sections = apply_filters( 'rp4wp_settings_sections', array(\n\t\t\t'general' => array(\n\t\t\t\t'id'          => 'general',\n\t\t\t\t'label'       => __( 'General', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( 'The following options affect the general behaviour of the plugin.', 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'automatic_linking'             => array(\n\t\t\t\t\t\t'id'          => 'automatic_linking',\n\t\t\t\t\t\t'label'       => __( 'Enable', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Checking this will enable automatically linking posts to new posts', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 1,\n\t\t\t\t\t),\n\t\t\t\t\t'automatic_linking_post_amount' => array(\n\t\t\t\t\t\t'id'          => 'automatic_linking_post_amount',\n\t\t\t\t\t\t'label'       => __( 'Amount of Posts', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The amount of automatically linked post', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => '3',\n\t\t\t\t\t),\n\t\t\t\t\t'heading_text'                  => array(\n\t\t\t\t\t\t'id'          => 'heading_text',\n\t\t\t\t\t\t'label'       => __( 'Heading text', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The text that is displayed above the related posts. To disable, leave field empty.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => __( 'Related Posts', 'related-posts-for-wp' ),\n\t\t\t\t\t),\n\t\t\t\t\t'excerpt_length'                => array(\n\t\t\t\t\t\t'id'          => 'excerpt_length',\n\t\t\t\t\t\t'label'       => __( 'Excerpt length', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The amount of words to be displayed below the title on website. To disable, set value to 0.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => '15',\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\t'styling' => array(\n\t\t\t\t'id'          => 'styling',\n\t\t\t\t'label'       => __( 'Styling', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( 'The following options affect how related posts are displayed on the frontend.', 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'display_image' => array(\n\t\t\t\t\t\t'id'          => 'display_image',\n\t\t\t\t\t\t'label'       => __( 'Display Image', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Checking this will enable displaying featured images of related posts.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t\t'css'           => array(\n\t\t\t\t\t\t'id'          => 'css',\n\t\t\t\t\t\t'label'       => __( 'CSS', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Warning! This is an advanced feature! An error here will break frontend display. To disable, leave field empty.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'textarea',\n\t\t\t\t\t\t'default'     => implode( PHP_EOL, $css_default_lines ),\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\t'misc'    => array(\n\t\t\t\t'id'          => 'misc',\n\t\t\t\t'label'       => __( 'Misc', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( \"A shelter for options that just don't fit in anywhere else.\", 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'restart_wizard_button' => array(\n\t\t\t\t\t\t'id'          => 'restart_wizard_button',\n\t\t\t\t\t\t'label'       => __( 'Rebuild posts linkage?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( \"Click this button if you want to restart the wizard. Please note that this will delete all current related post links, also those you've manually added. Of course, we will never delete your actual posts.\", 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'button_link',\n\t\t\t\t\t\t'href'        => admin_url( '?page=rp4wp_install&reinstall=1&rp4wp_nonce=' . wp_create_nonce( RP4WP_Constants::NONCE_INSTALL ) ),\n\t\t\t\t\t\t'default'     => __( 'Rebuild', 'related-posts-for-wp' ),\n\t\t\t\t\t),\n\t\t\t\t\t'clean_on_uninstall'    => array(\n\t\t\t\t\t\t'id'          => 'clean_on_uninstall',\n\t\t\t\t\t\t'label'       => __( 'Remove Data on Uninstall?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Check this box if you would like to completely remove all of its data when the plugin is deleted.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t\t'show_love'             => array(\n\t\t\t\t\t\t'id'          => 'show_love',\n\t\t\t\t\t\t'label'       => __( 'Show love?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( \"Display a 'Powered by' line under your related posts. <strong>BEWARE! Only for the real fans.</strong>\", 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t),\n\t\t) );\n\n\t\t// Set defaults\n\t\tforeach ( $this->sections as $section ) {\n\t\t\tforeach ( $section['fields'] as $field ) {\n\t\t\t\t$this->defaults[$field['id']] = $field['default'];\n\t\t\t}\n\t\t}\n\n\t\t// Setup settings\n\t\tadd_action( 'admin_init', array( $this, 'setup' ) );\n\n\t}\n\n\t/**\n\t * Setup the settings\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function setup() {\n\t\tif ( count( $this->sections ) > 0 ) {\n\t\t\tforeach ( $this->sections as $section ) {\n\n\t\t\t\t// Add the section\n\t\t\t\tadd_settings_section(\n\t\t\t\t\t$section['id'],\n\t\t\t\t\t$section['label'],\n\t\t\t\t\tarray( $this, 'section_intro' ),\n\t\t\t\t\tself::PAGE\n\t\t\t\t);\n\n\t\t\t\t// Check & Loop\n\t\t\t\tif ( count( $section['fields'] ) > 0 ) {\n\t\t\t\t\tforeach ( $section['fields'] as $field ) {\n\n\t\t\t\t\t\t// Add section\n\t\t\t\t\t\tadd_settings_field(\n\t\t\t\t\t\t\t$field['id'],\n\t\t\t\t\t\t\t$field['label'],\n\t\t\t\t\t\t\tarray( $this, 'do_field' ),\n\t\t\t\t\t\t\tself::PAGE,\n\t\t\t\t\t\t\t$section['id'],\n\t\t\t\t\t\t\t$field\n\t\t\t\t\t\t);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Register section setting\n\t\t\tregister_setting( self::PAGE, self::PAGE, array( $this, 'sanitize_option' ) );\n\t\t}\n\t}\n\n\t/**\n\t * Method that is called when adding a section\n\t *\n\t * @param $section\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function section_intro( $section ) {\n\t\techo '<p>' . $this->sections[$section['id']]['description'] . '</p>' . PHP_EOL;\n\t}\n\n\t/**\n\t * Method that outputs the correct field\n\t *\n\t * @param $field\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function do_field( $field ) {\n\n\t\t// For now we just do a simple switch here, make this more OOP in future version\n\t\tswitch ( $field['type'] ) {\n\t\t\tcase 'checkbox':\n\t\t\t\techo '<input type=\"checkbox\" name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\" value=\"1\" ' . checked( 1, $this->get_option( $field['id'] ), false ) . ' />';\n\t\t\t\tbreak;\n\t\t\tcase 'text':\n\t\t\t\techo '<input type=\"text\" name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\" value=\"' . $this->get_option( $field['id'] ) . '\" class=\"rp4wp-input-text\" />';\n\t\t\t\tbreak;\n\t\t\tcase 'textarea':\n\t\t\t\techo '<textarea name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\">' . $this->get_option( $field['id'] ) . '</textarea>';\n\t\t\t\tbreak;\n\t\t\tcase 'button_link':\n\t\t\t\techo '<a href=\"' . $field['href'] . '\" class=\"button\">' . $field['default'] . '</a>';\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Description\n\t\tif ( isset( $field['description'] ) && '' != $field['description'] ) {\n\t\t\techo '<label class=\"rp4wp-description\" for=\"' . $field['id'] . '\">' . $field['description'] . '</label>';\n\t\t}\n\n\t\t// Check if this option is being filtered\n\t\tif ( has_filter( 'rp4wp_' . $field['id'] ) ) {\n\t\t\techo '<small>This option is overwritten by a filter.</small>';\n\t\t}\n\n\t\t// End of line\n\t\techo PHP_EOL;\n\n\t}\n\n\t/**\n\t * Sanitize the option value\n\t *\n\t * @param array $post_data\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t *\n\t * @return array\n\t */\n\tpublic function sanitize_option( $post_data ) {\n\n\t\t// Unset automatic_linking if not set in post\n\t\tif ( ! isset( $post_data['automatic_linking'] ) ) {\n\t\t\t$post_data['automatic_linking'] = 0;\n\t\t}\n\n\t\t// Unset display_image if not set in post\n\t\tif ( ! isset( $post_data['display_image'] ) ) {\n\t\t\t$post_data['display_image'] = 0;\n\t\t}\n\n\t\t// automatic_linking must be an integer\n\t\t$post_data['automatic_linking'] = intval( $post_data['automatic_linking'] );\n\n\t\t// automatic_linking_post_amount must be an integer\n\t\t$post_data['automatic_linking_post_amount'] = intval( $post_data['automatic_linking_post_amount'] );\n\n\t\t// Excerpt length must be an integer\n\t\t$post_data['excerpt_length'] = intval( $post_data['excerpt_length'] );\n\n\t\treturn $post_data;\n\n\t}\n\n\t/**\n\t * Get the plugin options\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t *\n\t * @return mixed|void\n\t */\n\tpublic function get_options() {\n\t\treturn apply_filters( 'rp4wp_options', wp_parse_args( get_option( self::PAGE, array() ), $this->defaults ) );\n\t}\n\n\t/**\n\t * Return a single option\n\t *\n\t * @param $option\n\t *\n\t * @since  1.0.0\n\t * @access public\n\t *\n\t * @return mixed|bool\n\t */\n\tpublic function get_option( $option ) {\n\t\t$options = $this->get_options();\n\n\t\treturn apply_filters( 'rp4wp_' . $option, isset( $options[ $option ] ) ? $options[ $option ] : false );\n\t}\n\n}"], "fixing_code": ["<?php\n\nif ( ! defined( 'ABSPATH' ) ) {\n\texit;\n} // Exit if accessed directly\n\n/**\n * Class RP4WP_Settings\n *\n * @todo Make class for each input type with own sanitize method.\n */\nclass RP4WP_Settings {\n\n\tconst PREFIX = 'rp4wp_';\n\n\tconst PAGE = 'rp4wp';\n\n\tprivate $sections;\n\tprivate $defaults;\n\n\t/**\n\t * Constructor\n\t */\n\tpublic function __construct() {\n\n\t\t// CSS default\n\t\t$css_default_lines   = array();\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}';\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}';\n\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li>p{margin:0;padding:0;}';\n\t\t$css_default_lines[] = '.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}';\n\n\t\tif ( is_rtl() ) {\n\t\t\t$css_default_lines   = array();\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:right;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;float:right;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-posts ul>li>p{margin:0;padding:0;}';\n\t\t\t$css_default_lines[] = '.rp4wp-related-post-image{width:35%;padding-left:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:right;}';\n\t\t}\n\n\t\t// The fields\n\t\t$this->sections = apply_filters( 'rp4wp_settings_sections', array(\n\t\t\t'general' => array(\n\t\t\t\t'id'          => 'general',\n\t\t\t\t'label'       => __( 'General', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( 'The following options affect the general behaviour of the plugin.', 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'automatic_linking'             => array(\n\t\t\t\t\t\t'id'          => 'automatic_linking',\n\t\t\t\t\t\t'label'       => __( 'Enable', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Checking this will enable automatically linking posts to new posts', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 1,\n\t\t\t\t\t),\n\t\t\t\t\t'automatic_linking_post_amount' => array(\n\t\t\t\t\t\t'id'          => 'automatic_linking_post_amount',\n\t\t\t\t\t\t'label'       => __( 'Amount of Posts', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The amount of automatically linked post', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => '3',\n\t\t\t\t\t),\n\t\t\t\t\t'heading_text'                  => array(\n\t\t\t\t\t\t'id'          => 'heading_text',\n\t\t\t\t\t\t'label'       => __( 'Heading text', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The text that is displayed above the related posts. To disable, leave field empty.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => __( 'Related Posts', 'related-posts-for-wp' ),\n\t\t\t\t\t),\n\t\t\t\t\t'excerpt_length'                => array(\n\t\t\t\t\t\t'id'          => 'excerpt_length',\n\t\t\t\t\t\t'label'       => __( 'Excerpt length', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'The amount of words to be displayed below the title on website. To disable, set value to 0.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'text',\n\t\t\t\t\t\t'default'     => '15',\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\t'styling' => array(\n\t\t\t\t'id'          => 'styling',\n\t\t\t\t'label'       => __( 'Styling', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( 'The following options affect how related posts are displayed on the frontend.', 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'display_image' => array(\n\t\t\t\t\t\t'id'          => 'display_image',\n\t\t\t\t\t\t'label'       => __( 'Display Image', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Checking this will enable displaying featured images of related posts.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t\t'css'           => array(\n\t\t\t\t\t\t'id'          => 'css',\n\t\t\t\t\t\t'label'       => __( 'CSS', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Warning! This is an advanced feature! An error here will break frontend display. To disable, leave field empty.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'textarea',\n\t\t\t\t\t\t'default'     => implode( PHP_EOL, $css_default_lines ),\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\t'misc'    => array(\n\t\t\t\t'id'          => 'misc',\n\t\t\t\t'label'       => __( 'Misc', 'related-posts-for-wp' ),\n\t\t\t\t'description' => __( \"A shelter for options that just don't fit in anywhere else.\", 'related-posts-for-wp' ),\n\t\t\t\t'fields'      => array(\n\t\t\t\t\t'restart_wizard_button' => array(\n\t\t\t\t\t\t'id'          => 'restart_wizard_button',\n\t\t\t\t\t\t'label'       => __( 'Rebuild posts linkage?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( \"Click this button if you want to restart the wizard. Please note that this will delete all current related post links, also those you've manually added. Of course, we will never delete your actual posts.\", 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'button_link',\n\t\t\t\t\t\t'href'        => admin_url( '?page=rp4wp_install&reinstall=1&rp4wp_nonce=' . wp_create_nonce( RP4WP_Constants::NONCE_INSTALL ) ),\n\t\t\t\t\t\t'default'     => __( 'Rebuild', 'related-posts-for-wp' ),\n\t\t\t\t\t),\n\t\t\t\t\t'clean_on_uninstall'    => array(\n\t\t\t\t\t\t'id'          => 'clean_on_uninstall',\n\t\t\t\t\t\t'label'       => __( 'Remove Data on Uninstall?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( 'Check this box if you would like to completely remove all of its data when the plugin is deleted.', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t\t'show_love'             => array(\n\t\t\t\t\t\t'id'          => 'show_love',\n\t\t\t\t\t\t'label'       => __( 'Show love?', 'related-posts-for-wp' ),\n\t\t\t\t\t\t'description' => __( \"Display a 'Powered by' line under your related posts. <strong>BEWARE! Only for the real fans.</strong>\", 'related-posts-for-wp' ),\n\t\t\t\t\t\t'type'        => 'checkbox',\n\t\t\t\t\t\t'default'     => 0,\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t),\n\t\t) );\n\n\t\t// Set defaults\n\t\tforeach ( $this->sections as $section ) {\n\t\t\tforeach ( $section['fields'] as $field ) {\n\t\t\t\t$this->defaults[$field['id']] = $field['default'];\n\t\t\t}\n\t\t}\n\n\t\t// Setup settings\n\t\tadd_action( 'admin_init', array( $this, 'setup' ) );\n\n\t}\n\n\t/**\n\t * Setup the settings\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function setup() {\n\t\tif ( count( $this->sections ) > 0 ) {\n\t\t\tforeach ( $this->sections as $section ) {\n\n\t\t\t\t// Add the section\n\t\t\t\tadd_settings_section(\n\t\t\t\t\t$section['id'],\n\t\t\t\t\t$section['label'],\n\t\t\t\t\tarray( $this, 'section_intro' ),\n\t\t\t\t\tself::PAGE\n\t\t\t\t);\n\n\t\t\t\t// Check & Loop\n\t\t\t\tif ( count( $section['fields'] ) > 0 ) {\n\t\t\t\t\tforeach ( $section['fields'] as $field ) {\n\n\t\t\t\t\t\t// Add section\n\t\t\t\t\t\tadd_settings_field(\n\t\t\t\t\t\t\t$field['id'],\n\t\t\t\t\t\t\t$field['label'],\n\t\t\t\t\t\t\tarray( $this, 'do_field' ),\n\t\t\t\t\t\t\tself::PAGE,\n\t\t\t\t\t\t\t$section['id'],\n\t\t\t\t\t\t\t$field\n\t\t\t\t\t\t);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Register section setting\n\t\t\tregister_setting( self::PAGE, self::PAGE, array( $this, 'sanitize_option' ) );\n\t\t}\n\t}\n\n\t/**\n\t * Method that is called when adding a section\n\t *\n\t * @param $section\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function section_intro( $section ) {\n\t\techo '<p>' . $this->sections[$section['id']]['description'] . '</p>' . PHP_EOL;\n\t}\n\n\t/**\n\t * Method that outputs the correct field\n\t *\n\t * @param $field\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t */\n\tpublic function do_field( $field ) {\n\n\t\t// For now we just do a simple switch here, make this more OOP in future version\n\t\tswitch ( $field['type'] ) {\n\t\t\tcase 'checkbox':\n\t\t\t\techo '<input type=\"checkbox\" name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\" value=\"1\" ' . checked( 1, $this->get_option( $field['id'] ), false ) . ' />';\n\t\t\t\tbreak;\n\t\t\tcase 'text':\n\t\t\t\techo '<input type=\"text\" name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\" value=\"' . esc_attr( $this->get_option( $field['id'] ) ) . '\" class=\"rp4wp-input-text\" />';\n\t\t\t\tbreak;\n\t\t\tcase 'textarea':\n\t\t\t\techo '<textarea name=\"' . self::PAGE . '[' . $field['id'] . ']' . '\" id=\"' . $field['id'] . '\">' . esc_html( $this->get_option( $field['id'] ) ) . '</textarea>';\n\t\t\t\tbreak;\n\t\t\tcase 'button_link':\n\t\t\t\techo '<a href=\"' . esc_attr( $field['href'] ) . '\" class=\"button\">' . esc_html( $field['default'] ) . '</a>';\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Description\n\t\tif ( isset( $field['description'] ) && '' != $field['description'] ) {\n\t\t\techo '<label class=\"rp4wp-description\" for=\"' . $field['id'] . '\">' . $field['description'] . '</label>';\n\t\t}\n\n\t\t// Check if this option is being filtered\n\t\tif ( has_filter( 'rp4wp_' . $field['id'] ) ) {\n\t\t\techo '<small>This option is overwritten by a filter.</small>';\n\t\t}\n\n\t\t// End of line\n\t\techo PHP_EOL;\n\n\t}\n\n\t/**\n\t * Sanitize the option value\n\t *\n\t * @param array $post_data\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t *\n\t * @return array\n\t */\n\tpublic function sanitize_option( $post_data ) {\n\n\t\t// Unset automatic_linking if not set in post\n\t\tif ( ! isset( $post_data['automatic_linking'] ) ) {\n\t\t\t$post_data['automatic_linking'] = 0;\n\t\t}\n\n\t\t// Unset display_image if not set in post\n\t\tif ( ! isset( $post_data['display_image'] ) ) {\n\t\t\t$post_data['display_image'] = 0;\n\t\t}\n\n\t\t// automatic_linking must be an integer\n\t\t$post_data['automatic_linking'] = intval( $post_data['automatic_linking'] );\n\n\t\t// automatic_linking_post_amount must be an integer\n\t\t$post_data['automatic_linking_post_amount'] = intval( $post_data['automatic_linking_post_amount'] );\n\n\t\t// Excerpt length must be an integer\n\t\t$post_data['excerpt_length'] = intval( $post_data['excerpt_length'] );\n\n\t\treturn $post_data;\n\n\t}\n\n\t/**\n\t * Get the plugin options\n\t *\n\t * @since  1.1.0\n\t * @access public\n\t *\n\t * @return mixed|void\n\t */\n\tpublic function get_options() {\n\t\treturn apply_filters( 'rp4wp_options', wp_parse_args( get_option( self::PAGE, array() ), $this->defaults ) );\n\t}\n\n\t/**\n\t * Return a single option\n\t *\n\t * @param $option\n\t *\n\t * @since  1.0.0\n\t * @access public\n\t *\n\t * @return mixed|bool\n\t */\n\tpublic function get_option( $option ) {\n\t\t$options = $this->get_options();\n\n\t\treturn apply_filters( 'rp4wp_' . $option, isset( $options[ $option ] ) ? $options[ $option ] : false );\n\t}\n\n}\n"], "filenames": ["classes/settings/class-settings.php"], "buggy_code_start_loc": [212], "buggy_code_end_loc": [301], "fixing_code_start_loc": [212], "fixing_code_end_loc": [301], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository barrykooij/related-posts-for-wp prior to 2.1.3.", "other": {"cve": {"id": "CVE-2022-3506", "sourceIdentifier": "security@huntr.dev", "published": "2022-10-14T14:15:10.747", "lastModified": "2023-03-06T20:56:46.283", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository barrykooij/related-posts-for-wp prior to 2.1.3."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross-site Scripting (XSS) - Almacenado en el repositorio de GitHub barrykooij/related-posts-for-wp versiones anteriores a 2.1.3"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:never5:related_posts:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "2.1.3", "matchCriteriaId": "03619F0F-87C3-458A-A6C0-9A870703B5E3"}]}]}], "references": [{"url": "https://github.com/barrykooij/related-posts-for-wp/commit/37733398dd88863fc0bdb3d6d378598429fd0b81", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/08251542-88f6-4264-9074-a89984034828", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/barrykooij/related-posts-for-wp/commit/37733398dd88863fc0bdb3d6d378598429fd0b81"}}