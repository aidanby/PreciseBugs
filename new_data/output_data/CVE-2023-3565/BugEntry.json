{"buggy_code": ["<?php\n\ndeclare(strict_types=1);\n\n/**\n * Teampass - a collaborative passwords manager.\n * ---\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * ---\n *\n * @project   Teampass\n * @file      load.js.php\n * ---\n *\n * @author    Nils Laumaill\u00e9 (nils@teampass.net)\n *\n * @copyright 2009-2023 Teampass.net\n *\n * @license   https://spdx.org/licenses/GPL-3.0-only.html#licenseText GPL-3.0\n * ---\n *\n * @see       https://www.teampass.net\n */\n\nif (isset($_SESSION['CPM']) === false || (int) $_SESSION['CPM'] !== 1) {\n    die('Hacking attempt...');\n}\n\n// Is maintenance on-going?\nif (\n    isset($SETTINGS['maintenance_mode']) === true\n    && (int) $SETTINGS['maintenance_mode'] === 1\n    && ($session_user_admin === null\n        || (int) $session_user_admin === 1)\n) {\n    ?>\n    <script type=\"text/javascript\">\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('index_maintenance_mode_admin'); ?>',\n            '<?php echo langHdl('information'); ?>', {\n                timeOut: 0\n            }\n        );\n    </script>\n<?php\n}\n?>\n\n<script type=\"text/javascript\">\n    var userScrollPosition = 0,\n        debugJavascript = true;\n    let hourInMinutes = 60;\n\n\n    $(document).ready(function() {\n        //console.log('-- PAGE LOADED --'+$(location).attr('href').includes('?')+\" -- \"+store.get('teampassUser'));\n        if ($(location).attr('href').includes('?') === true && (store.get('teampassUser') === undefined || parseInt(store.get('teampassUser').user_id) <= 0)) {\n            $(location).attr('href', 'index.php?session=expired');\n            return false;\n        }\n\n        // prevent a resubmit on refresh and back button\n        if (window.history.replaceState) {\n            window.history.replaceState(null, null, window.location.href);\n        }\n    });\n\n    /**\n    *   Add 1 hour to session duration\n    **/\n    function IncreaseSessionTime(duration)\n    {\n        duration = duration || hourInMinutes;\n        $.post(\n            'sources/main.queries.php',\n            {\n                type     : 'increase_session_time',\n                type_category: 'action_user',\n                duration : parseInt(duration, 10) * hourInMinutes,\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                if (data[0].new_value !== 'expired') {\n                    $('#temps_restant').val(data[0].new_value);\n                    $('#date_end_session').val(data[0].new_value);\n                    $('#countdown').css('color', 'white');\n                } else {\n                    $(location).attr('href', 'index.php?session=expired');\n                }\n            },\n            'json'\n        );\n    }\n\n    // Start real time\n    // get list of last items\n    if (store.get('teampassUser') !== undefined && parseInt(store.get('teampassUser').user_id) > 0\n        && String('<?php echo $_SESSION['key']; ?>') === store.get('teampassUser').sessionKey\n        && (Date.now() - store.get('teampassUser').sessionStartTimestamp) < (store.get('teampassUser').sessionDuration * 1000)\n    ) {\n        $.when(\n            // Load teampass settings\n            loadSettings()\n        ).then(function() {\n            $.when(\n                // Refresh list of last items shopwn\n                refreshListLastSeenItems()\n            ).then(function() {\n                // Check if new privatekey needs to be adapted\n                var data = {\n                    'user_id': store.get('teampassUser').user_id,\n                    'fields' : 'special, auth_type, is_ready_for_usage, ongoing_process_id, otp_provided',\n                }\n                $.post(\n                    \"sources/main.queries.php\", {\n                        type: \"get_user_info\",\n                        type_category: 'action_user',\n                        data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                        key: \"<?php echo $_SESSION['key']; ?>\"\n                    },\n                    function(data) {\n                        //decrypt data\n                        data = decodeQueryReturn(data, '<?php echo $_SESSION['key']; ?>');\n                        if (debugJavascript === true) {\n                            console.info('Get user info results:');\n                            console.log(data);\n                        }\n\n                        // update local storage\n                        store.update(\n                            'teampassUser', {},\n                            function(teampassUser) {\n                                teampassUser.special = data.queryResults.special;\n                                teampassUser.auth_type = data.queryResults.auth_type;\n                                teampassUser.is_ready_for_usage = data.queryResults.is_ready_for_usage;\n                                teampassUser.ongoing_process_id = data.queryResults.ongoing_process_id;\n                            }\n                        );\n\n                        if (data.error === false && data.queryResults.special === 'generate-keys') {\n                            // Get generation keys progress status\n                            getGenerateKeysProgress(store.get('teampassUser').user_id);\n\n                            // ----\n                        } else if (data.error === false && data.queryResults.special === 'auth-pwd-change' && data.queryResults.auth_type === 'local') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('User has to change his auth password')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show passwords inputs and form\n                            $('#dialog-user-change-password-info')\n                                .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('user_has_to_change_password_info');?>')\n                                .removeClass('hidden');\n                            $('#dialog-user-change-password').removeClass('hidden');\n\n                        // ----\n                        } else if (data.error === false && data.queryResults.special === 'auth-pwd-change' && data.queryResults.auth_type === 'ldap') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('LDAP user password has to change his auth password')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show passwords inputs and form\n                            $('#dialog-ldap-user-change-password-info')\n                                .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('ldap_user_has_changed_his_password');?>')\n                                .removeClass('hidden');\n                            $('#dialog-ldap-user-change-password').removeClass('hidden');\n                            \n                            // ----\n                        } else if (\n                            (data.error === false && data.queryResults.special === 'user_added_from_ldap' && data.queryResults.auth_type === 'ldap')\n                            || (typeof data.queryResults !== 'undefined' && data.queryResults.special === 'otc_is_required_on_next_login')\n                            || parseInt(data.queryResults.otp_provided) === 0\n                        ) {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('NEW LDAP user password - we need to encrypt items')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show form\n                            $('#dialog-ldap-user-build-keys-database').removeClass('hidden');\n                        } else if (typeof data.queryResults !== 'undefined' && data.queryResults.special === 'recrypt-private-key') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('NEW LDAP - we need to encrypt private key')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show form\n                            $('#dialog-ldap-user-change-password').removeClass('hidden');\n                        }\n                    }\n                );\n            }).then(function() {\n                if (store.get('teampassSettings') === undefined || parseInt(store.get('teampassSettings').enable_tasks_manager) === 0) {\n                    console.log('Now sending emails')\n                    setTimeout(\n                        function() {\n                            $.when(\n                                // send email\n                                $.post(\n                                    \"sources/main.queries.php\", {\n                                        type: \"send_waiting_emails\",\n                                        type_category: 'action_mail',\n                                        key: \"<?php echo $_SESSION['key']; ?>\"\n                                    }\n                                )\n                            ).then(function() {\n                                // send statistics\n                                $.post(\n                                    \"sources/main.queries.php\", {\n                                        type: \"sending_statistics\",\n                                        type_category: 'action_system',\n                                        key: \"<?php echo $_SESSION['key']; ?>\"\n                                    }\n                                );\n                            });\n                        },\n                        3000\n                    );\n                }\n\n                // Save user location\n                //console.info(\"DEBUG - Save user location -\"+store.get('teampassUser').location_stored)\n                if (store.get('teampassUser').location_stored !== 1) {\n                // Save user location\n                    $.post(\n                        \"sources/users.queries.php\", {\n                            type: 'save_user_location',\n                            step: \"perform\",\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            // update local storage\n                            store.update(\n                                'teampassUser', {},\n                                function(teampassUser) {\n                                    teampassUser.location_stored = 1;\n                                }\n                            );\n                        }\n                    );\n                }\n            });\n        });\n    }\n    //-- end\n\n\n    // Countdown\n    countdown();\n\n    $(\".show_hide_password a\").on('click', function(event) {\n        event.preventDefault();\n        if($('.how_hide_password input').attr(\"type\") === \"text\"){\n            $('.show_hide_password input').attr('type', 'password');\n            $('.show_hide_password i').addClass( \"fa-eye-slash\" );\n            $('.show_hide_password i').removeClass( \"fa-eye\" );\n        }else if($('#show_hide_password input').attr(\"type\") === \"password\"){\n            $('.show_hide_password input').attr('type', 'text');\n            $('.show_hide_password i').removeClass( \"fa-eye-slash\" );\n            $('.show_hide_password i').addClass( \"fa-eye\" );\n        }\n    });\n    \n    if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'generate-keys'\n    ) {\n        // Now we need to perform re-encryption due to LDAP password change\n        /*console.log('User has to regenerate keys')\n        // HIde\n        $('.content-header, .content').addClass('hidden');\n        $('#dialog-user-temporary-code-info').html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('renecyption_expected');?>');\n\n        // Show passwords inputs and form\n        $('#dialog-user-temporary-code').removeClass('hidden');\n        */\n        \n        // ---\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'ldap_password_has_changed_do_reencryption'\n    ) {\n        // Now we need to perform re-encryption due to LDAP password change\n        console.log('show password change')\n        // HIde\n        $('.content-header, .content, #button_do_sharekeys_reencryption').addClass('hidden');\n        $('#warning-text-reencryption').html('<i class=\"icon fa-solid fa-info mr-2\"></i>'.langHdl('ldap_password_change_warning'));\n\n        // Show passwords inputs and form\n        $('#dialog-encryption-keys, .ask-for-previous-password').removeClass('hidden');\n\n        $('#sharekeys_reencryption_target_user').val(store.get('teampassUser').user_id);\n\n        $('#button_do_sharekeys_reencryption').removeClass('hidden');\n        \n        // ---\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').shown_warning_unsuccessful_login === false\n    ) {\n        // If login attempts experimented\n        // Prepare modal\n        showModalDialogBox(\n            '#warningModal',\n            '<i class=\"fa-solid fa-user-shield fa-lg warning mr-2\"></i><?php echo langHdl('caution'); ?>',\n            '<?php echo langHdl('login_attempts_identified_since_last_connection'); ?>',\n            '<?php echo langHdl('see_detail'); ?>',\n            '<?php echo langHdl('cancel'); ?>'\n        );\n\n        // Actions on modal buttons\n        $(document).on('click', '#warningModalButtonClose', function() {\n            store.update(\n                'teampassUser', {},\n                function(teampassUser) {\n                    teampassUser.shown_warning_unsuccessful_login = true;\n                }\n            );\n        });\n        $(document).on('click', '#warningModalButtonAction', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info('<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>');\n\n            // Action\n            store.update(\n                'teampassUser', {},\n                function(teampassUser) {\n                    teampassUser.shown_warning_unsuccessful_login = true;\n                }\n            );\n            document.location.href = \"index.php?page=profile&tab=timeline\";\n        });\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'private_items_to_encrypt'\n    ) {\n        // If user has to re-encrypt his personal item passwords\n        $('#dialog-encryption-personal-items-after-upgrade').removeClass('hidden');\n        $('.content, .content-header').addClass('hidden');\n        \n        // Actions on modal buttons\n        $(document).on('click', '#button_do_personal_items_reencryption', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info('<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>');\n\n            defusePskRemoval(store.get('teampassUser').user_id, 'psk', 0);\n            \n            function defusePskRemoval(userId, step, start)\n            {\n                if (step === 'psk') {\n                    // Inform user\n                    $(\"#user-current-defuse-psk-progress\").html('<b><?php echo langHdl('encryption_keys'); ?> </b> [' + start + ' - ' + (parseInt(start) + <?php echo NUMBER_ITEMS_IN_BATCH;?>) + '] ' +\n                        '... <?php echo langHdl('please_wait'); ?><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n\n                    var data = {\n                        'userPsk' : $('#user-current-defuse-psk').val(),\n                            'start': start,\n                            'length': <?php echo NUMBER_ITEMS_IN_BATCH;?>,\n                            'user_id': userId,\n                    };\n                    // Do query\n                    $.post(\n                        \"sources/main.queries.php\", {\n                            'type': \"user_psk_reencryption\",\n                            'type_category': 'action_key',\n                            'data': prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            'key': '<?php echo $_SESSION['key']; ?>'\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, \"decode\", \"<?php echo $_SESSION['key']; ?>\");\n                            if (debugJavascript === true) console.log(data)\n                            if (data.error === true) {\n                                // error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                // Enable buttons\n                                $(\"#user-current-defuse-psk-progress\").html('<?php echo langHdl('provide_current_psk_and_click_launch'); ?>');\n                                $('#button_do_sharekeys_reencryption, #button_close_sharekeys_reencryption').removeAttr('disabled');\n                                return false;\n                            } else {\n                                // Start looping on all steps of re-encryption\n                                defusePskRemoval(data.userId, data.step, data.start);\n                            }\n                        }\n                    );\n                } else {\n                    // Finished\n                    $(\"#user-current-defuse-psk-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n\n                    toastr.remove();\n                }\n            }\n\n        });\n        $(document).on('click', '#button_close_personal_items_reencryption', function() {\n            $('#dialog-encryption-personal-items-after-upgrade').addClass('hidden');\n            $('.content, .content-header').removeClass('hidden');\n        });\n    }\n\n\n    // Show tooltips\n    $('.infotip').tooltip();\n\n    // Sidebar redirection\n    $('.nav-link').click(function() {\n        if ($(this).data('name') !== undefined) {\n            //NProgress.start();\n            document.location.href = \"index.php?page=\" + $(this).data('name');\n        }\n    });\n\n    // User menu action\n    $('.user-menu').click(function() {\n        if ($(this).data('name') !== undefined) {\n            if ($(this).data('name') === 'increase_session') {\n                showExtendSession();\n            } else if ($(this).data('name') === 'sync-new-ldap-password') {\n                // This case permits to handle a case where user has changed his password in LDAP\n                console.log('show sync-new-ldap-password')\n                \n                if (debugJavascript === true) console.log('LDAP user password has to change his auth password')\n                // HIde\n                $('.content-header, .content').addClass('hidden');\n\n                // Show passwords inputs and form\n                $('#dialog-ldap-user-change-password-info')\n                    .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('ldap_user_has_changed_his_password');?>')\n                    .removeClass('hidden');\n                $('#dialog-ldap-user-change-password').removeClass('hidden');\n\n                // ----\n            } else if ($(this).data('name') === 'password-change') {\n                //console.log('show password change')\n                // HIde\n                $('.content-header, .content, #button_do_user_change_password').addClass('hidden');\n\n                // Add DoCheck button\n                $('#button_do_user_change_password').after('<button class=\"btn btn-primary\" id=\"button_do_pwds_checks\"><?php echo langHdl('perform_checks'); ?></button>');\n\n                // Show passwords inputs and form\n                $('#dialog-user-change-password-progress').html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('change_your_password_info_message'); ?>');\n                $('#dialog-user-change-password').removeClass('hidden');\n\n                // Actions\n                $('#button_do_pwds_checks').click(function() {\n                    if ($('#profile-password').val() !== $('#profile-password-confirm').val()) {\n                        $('#button_do_user_change_password').addClass('hidden');\n                        toastr.remove();\n                        toastr.error(\n                            '<?php echo langHdl('passwords_not_the_same'); ?>',\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 3000,\n                                progressBar: true\n                            }\n                        );\n                    } else if (parseInt($('#profile-password-complex').val()) >= parseInt(store.get('teampassSettings').personal_saltkey_security_level)) {\n                        $('#button_do_user_change_password').removeClass('hidden');\n                        $('#button_do_pwds_checks').remove();\n                        toastr.remove();\n                        toastr.info(\n                            '<?php echo langHdl('hit_launch_to_start'); ?>',\n                            '<?php echo langHdl('ready_to_go'); ?>', {\n                                timeOut: 3000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        $('#button_do_user_change_password').addClass('hidden');\n                        toastr.remove();\n                        toastr.error(\n                            '<?php echo langHdl('complexity_level_not_reached'); ?>',\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    }\n                });\n                \n                // ----\n            } else if ($(this).data('name') === 'profile') {\n                // Show profile page\n                document.location.href = \"index.php?page=profile\";\n\n                // ----\n            } else if ($(this).data('name') === 'logout') {\n                // Logout directly to login form\n                window.location.href = \"./includes/core/logout.php?token=<?php echo $_SESSION['key']; ?>\";\n\n                // ----\n            } else if ($(this).data('name') === 'generate-new_keys') {\n                // User wants to generate new keys\n                console.log('show new keys generation');\n                $('#warningModalButtonAction').attr('data-button-confirm', 'false');\n\n                // SHow modal\n                showModalDialogBox(\n                    '#warningModal',\n                    '<i class=\"fa-solid fa-person-digging fa-lg warning mr-2\"></i><?php echo langHdl('generate_new_keys'); ?> <b>',\n                    '<div class=\"form-group\">'+\n                        '<?php echo langHdl('generate_new_keys_info'); ?>' +\n                    '</div>' +\n                    '<div class=\"input-group mb-2 hidden\" id=\"new-encryption-div\">' +\n                        '<div class=\"input-group-prepend\">' +\n                            '<span class=\"input-group-text\"><?php echo langHdl('confirm_password'); ?></span>' +\n                        '</div>' +\n                        '<input id=\"encryption-otp\" type=\"password\" class=\"form-control form-item-control\" value=\"'+store.get('teampassUser').pwd+'\">' +\n                        '<div class=\"input-group-append\">' +\n                            '<button class=\"btn btn-outline-secondary btn-no-click\" id=\"show-encryption-otp\" title=\"<?php echo langHdl('mask_pw'); ?>\"><i class=\"fas fa-low-vision\"></i></button>' +\n                        '</div>' +\n                    '</div>',\n                    '<?php echo langHdl('perform'); ?>',\n                    '<?php echo langHdl('close'); ?>'\n                );\n\n                // Manage show/hide password\n                $('#show-encryption-otp')\n                    .mouseup(function() {\n                        $('#encryption-otp').attr('type', 'password');\n                    })\n                    .mousedown(function() {\n                        $('#encryption-otp').attr('type', 'text');\n                    });\n                $('.btn-no-click')\n                    .click(function(e) {\n                        e.preventDefault();\n                    });\n\n                // Manage click on button PERFORM\n                $(document).on('click', '#warningModalButtonAction', function() {\n                    // On PERFORM click\n                    if ($('#warningModalButtonAction').attr('data-button-confirm') === 'false') {\n                        $(\"#new-encryption-div\").removeClass('hidden');\n                        $('#warningModalButtonAction')\n                            .html('<i class=\"fa-solid fa-triangle-exclamation warning mr-2\"></i><?php echo langHdl('confirm'); ?>')\n                            .attr('data-button-confirm', 'true');\n\n                    } else if ($('#warningModalButtonAction').attr('data-button-confirm') === 'true') {\n                        // As reencryption relies on user's password\n                        // ensure we have it\n                        if ($('#encryption-otp').val() === '') {\n                            // No user password provided\n                            $('#warningModalButtonAction')\n                                .html('<?php echo langHdl('perform'); ?>')\n                                .attr('data-button-confirm', 'false');\n\n                        } else {\n                            // We have the password, start reencryption\n                            $('#warningModalButtonAction')\n                                .addClass('disabled')\n                                .html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n                            $('#warningModalButtonClose').addClass('disabled');\n\n                            // update the process\n                            // add all tasks\n                            var parameters = {\n                                'user_id': parseInt(store.get('teampassUser').user_id),\n                                'user_pwd': $('#encryption-otp').val(),\n                                'encryption_key': '',\n                                'delete_existing_keys': true,\n                                'encrypt_with_user_pwd': true,\n                                'send_email_to_user': true,\n                                'email_body': 'email_body_user_config_4',\n                                'generate_user_new_password': false,\n                            };\n                            //console.log(parameters);\n\n                            $.post(\n                                \"sources/main.queries.php\", {\n                                    type: \"user_new_keys_generation\",\n                                    type_category: 'action_key',\n                                    data: prepareExchangedData(JSON.stringify(parameters), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                                    key: \"<?php echo $_SESSION['key']; ?>\"\n                                },\n                                function(data_next1) { \n                                    data_next1 = prepareExchangedData(data_next1, 'decode', '<?php echo $_SESSION['key']; ?>');\n                                    if (debugJavascript === true) console.log(data_next1)\n\n                                    if (data_next1.error !== false) {\n                                        // Show error\n                                        toastr.remove();\n                                        toastr.error(\n                                            data_next1.message,\n                                            '<?php echo langHdl('caution'); ?>', {\n                                                timeOut: 5000,\n                                                progressBar: true\n                                            }\n                                        );\n                                    } else {\n                                        $(\"#new-encryption-div\").after('<div><?php echo langHdl('generate_new_keys_end'); ?></div>');\n                                        // Show warning\n                                        $('#user_not_ready').removeClass('hidden');\n                                        // update local storage\n                                        store.update(\n                                            'teampassUser', {},\n                                            function(teampassUser) {\n                                                teampassUser.is_ready_for_usage = 0;\n                                            }\n                                        );\n                                        $(\"#warningModalButtonAction\").addClass('hidden');\n                                        $('#warningModalButtonClose').removeClass('disabled');\n\n                                        // Get follow up\n                                        setTimeout(\n                                            getGenerateKeysProgress,\n                                            5000,\n                                            store.get('teampassUser').user_id\n                                        );\n                                    }\n                                }\n                            );\n                        }\n                    }\n                });\n            }\n        }\n    });\n\n    $('.close-element').click(function() {\n        $(this).closest('.card').addClass('hidden');\n\n        $('.content-header, .content').removeClass('hidden');\n    });\n\n    /**\n     * When clicking save Personal saltkey\n     */\n    /*\n    $('#button_save_user_psk').click(function() {\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n\n        // Prepare data\n        var data = {\n            \"psk\": sanitizeString($(\"#user_personal_saltkey\").val()),\n            \"complexity\": $(\"#psk_strength_value\").val()\n        };\n\n        //\n        $.post(\n            \"sources/main.queries.php\", {\n                type: \"store_personal_saltkey\",\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                data = prepareExchangedData(data, '<?php echo $_SESSION['key']; ?>');\n\n                // Is there an error?\n                if (data.error === true) {\n                    toastr.remove();\n                    toastr.error(\n                        '<?php echo langHdl('warning'); ?>',\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n                } else {\n                    store.update(\n                        'teampassUser',\n                        function(teampassUser) {\n                            teampassUser.pskDefinedInDatabase = 1;\n                        }\n                    )\n\n                    store.update(\n                        'teampassUser',\n                        function(teampassUser) {\n                            teampassUser.pskSetForSession = data.encrypted_psk;\n                        }\n                    )\n\n                    toastr.remove();\n                    toastr.success(\n                        '<?php echo langHdl('alert_page_will_reload'); ?>'\n                    );\n\n                    location.reload();\n                }\n            }\n        );\n    });\n    */\n\n    // For Personal Saltkey\n    $(\"#profile-password\").simplePassMeter({\n        \"requirements\": {},\n        \"container\": \"#profile-password-strength\",\n        \"defaultText\": \"<?php echo langHdl('index_pw_level_txt'); ?>\",\n        \"ratings\": [{\n                \"minScore\": 0,\n                \"className\": \"meterFail\",\n                \"text\": \"<?php echo langHdl('complex_level0'); ?>\"\n            },\n            {\n                \"minScore\": 25,\n                \"className\": \"meterWarn\",\n                \"text\": \"<?php echo langHdl('complex_level1'); ?>\"\n            },\n            {\n                \"minScore\": 50,\n                \"className\": \"meterWarn\",\n                \"text\": \"<?php echo langHdl('complex_level2'); ?>\"\n            },\n            {\n                \"minScore\": 60,\n                \"className\": \"meterGood\",\n                \"text\": \"<?php echo langHdl('complex_level3'); ?>\"\n            },\n            {\n                \"minScore\": 70,\n                \"className\": \"meterGood\",\n                \"text\": \"<?php echo langHdl('complex_level4'); ?>\"\n            },\n            {\n                \"minScore\": 80,\n                \"className\": \"meterExcel\",\n                \"text\": \"<?php echo langHdl('complex_level5'); ?>\"\n            },\n            {\n                \"minScore\": 90,\n                \"className\": \"meterExcel\",\n                \"text\": \"<?php echo langHdl('complex_level6'); ?>\"\n            }\n        ]\n    });\n    $(\"#profile-password\").bind({\n        \"score.simplePassMeter\": function(jQEvent, score) {\n            $(\"#profile-password-complex\").val(score);\n        }\n    }).change({\n        \"score.simplePassMeter\": function(jQEvent, score) {\n            $(\"#profile-password-complex\").val(score);\n        }\n    });\n\n    // Hide sidebar footer icons when reducing sidebar\n    $('a[data-widget=\"pushmenu\"]').click(function(event) {\n        if ($('#sidebar-footer').hasClass('hidden') === true) {\n            setTimeout(function() {\n                $('#sidebar-footer').removeClass('hidden');\n            }, 300);\n        } else {\n            $('#sidebar-footer').addClass('hidden');\n        }\n    });\n\n\n    var clipboardCopy = new ClipboardJS(\".clipboard-copy\", {\n        text: function(trigger) {\n            var elementId = $(trigger).data('clipboard-text');\n            if (debugJavascript === true) console.log($('#' + elementId).val())\n            return String($('#' + elementId).val());\n        }\n    });\n\n    clipboardCopy.on('success', function(e) {\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('copy_to_clipboard'); ?>',\n            '<?php echo langHdl('information'); ?>', {\n                timeOut: 2000\n            }\n        );\n    });\n    \n    // Progress bar\n    setTimeout(\n        function() {\n            $(\".fade\").removeClass(\"out\");\n\n            // Is user not ready\n            if (typeof store.get('teampassUser') !== 'undefined' && typeof store.get('teampassUser').is_ready_for_usage !== 'undefined' && parseInt(store.get('teampassUser').is_ready_for_usage) === 0) {\n                $('#user_not_ready').removeClass('hidden');\n            }\n        },\n        5000\n    );\n\n\n    /**\n    * USER HAS DECIDED TO CHANGE HIS AUTH PASSWORD\n     */\n    $(document).on('click', '#dialog-user-change-password-do', function() {\n        // Start by changing the user password and send it by email\n        if ($('#profile-password-confirm').val() !== $('#profile-password').val()) {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('index_pw_error_identical'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n            return false;\n        }\n        if ($('#profile-current-password').val() !== \"\" && $('#profile-password').val() !== \"\" && $('#profile-password-confirm').val() !== \"\") {\n            // Case where a user is changing his authentication password\n            console.log('Reencryption based upon user decision to change his auth password');\n\n            // Show progress\n            $('#dialog-user-change-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n            \n            // Disable buttons\n            $('#dialog-user-change-password-do, #dialog-user-change-password-close').attr('disabled', 'disabled');\n            \n            data = {\n                'user_id': store.get('teampassUser').user_id,\n                'old_password': $('#profile-current-password').val(),\n                'new_password': $('#profile-password').val(),\n            }\n            if (debugJavascript === true) console.log(data);\n\n            // Check user current password\n            // and change the password\n            // and use the password to re-encrypt the privatekey\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'change_user_auth_password',\n                    type_category: 'action_password',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n\n                        $(\"#dialog-user-change-password-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                        // Enable buttons\n                        $('#dialog-user-change-password-do, #dialog-user-change-password-close').removeAttr('disabled');\n                    } else {\n                        // SUCCESS\n                        $('#dialog-user-change-password-close').removeAttr('disabled');\n                        toastr.remove();\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('success'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                        $(\"#dialog-user-change-password-progress\").html('');\n                        $('#dialog-user-change-password').addClass('hidden');\n                        $('.content-header, .content').removeClass('hidden');\n                    }\n                }\n            );\n        } else {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('password_cannot_be_empty'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-user-change-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-change-password, #dialog-user-change-password-info').addClass('hidden');\n    });\n    \n\n    /**\n    * ADMIN HAS DECIDED TO CHANGE THE USER'S AUTH PASSWORD\n     */\n    $(document).on('click', '#dialog-admin-change-user-password-do', function() {\n        // When an admin changes the user auth password\n        console.log('Reencryption based upon admin decision to change user auth password');\n\n        // Show progress\n        $('#dialog-admin-change-user-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-admin-change-user-password-do, #dialog-admin-change-user-password-close').attr('disabled', 'disabled');            \n        \n        // ENsure we have a user id\n        if ($('#admin_change_user_password_target_user').val() !== '') {\n            // Case where change is for user's account\n            // update the process\n            // add all tasks\n            var parameters = {\n                'user_id': parseInt($('#admin_change_user_password_target_user').val()),\n                'user_pwd': '',\n                'encryption_key': '',\n                'delete_existing_keys': true,\n                'send_email_to_user': true,\n                'encrypt_with_user_pwd': true,\n                'generate_user_new_password': true,\n                'email_body': 'email_body_user_config_3',\n            };\n\n            $.post(\n                \"sources/main.queries.php\", {\n                    type: \"user_new_keys_generation\",\n                    type_category: 'action_key',\n                    data: prepareExchangedData(JSON.stringify(parameters), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data_next1) { \n                    data_next1 = prepareExchangedData(data_next1, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data_next1)\n\n                    if (data_next1.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data_next1.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        // Reload table\n                        if (typeof oTable !== 'undefined') {\n                            oTable.ajax.reload();\n                        }\n                        \n                        $(\"#dialog-admin-change-user-password-progress\").html('<?php echo langHdl('generate_new_keys_end'); ?>');\n                        // Show warning\n                        // Enable buttons\n                        $('#dialog-admin-change-user-password-close').removeAttr('disabled');\n                        toastr.remove();\n                    }\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-admin-change-user-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-admin-change-user-password').addClass('hidden');\n    });\n    \n    $(document).on('click', '.temp-button', function() {\n        \n        if ($(this).data('action') === \"show-user-pwd\") {\n            // show password\n            $('#temp-user-pwd').attr('type', 'text');\n            $(this).prop( \"disabled\", true );\n            setTimeout(\n                () => {\n                    $('#temp-user-pwd').attr('type', 'hidden');\n                    $(this).prop( \"disabled\", false );\n                },\n                5000\n            );\n        } else if ($(this).data('action') === \"send-user-pwd\") {\n            // Send email\n            console.log('Preparing for email sending');\n            \n            // Prepare data\n            var data = {\n                'receipt': $('#temp-user-email').val(),\n                'subject': '[Teampass] <?php echo langHdl('your_new_password');?>',\n                'body': '<?php echo langHdl('email_body_temporary_login_password');?>',\n                'pre_replace' : {\n                    '#enc_code#' : $('#temp-user-pwd').val(),\n                }\n            }\n            if (debugJavascript === true) console.log(data);\n            // Prepare form\n            $('#dialog-admin-change-user-password-info').html('<?php echo langHdl('sending_email_message');?>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n\n            // Launch action\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'mail_me',\n                    type_category: 'action_mail',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: '<?php echo $_SESSION['key']; ?>'\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        // Fianlize UI\n\n                        $('#dialog-admin-change-user-password-info').html('');\n                        $('#dialog-admin-change-user-password-do, #dialog-admin-change-user-password-close').removeAttr('disabled');\n\n                        // HIde\n                        $('.content-header, .content').removeClass('hidden');\n\n                        // SHow form\n                        $('#dialog-admin-change-user-password').addClass('hidden');\n\n                        store.set(\n                            'teampassUser', {\n                                admin_user_password: '',\n                                admin_user_email: '',\n                            }\n                        );\n                        \n                        // Inform user\n                        toastr.remove();\n                        toastr.success(\n                            '<?php echo langHdl('done'); ?>',\n                            '', {\n                                timeOut: 1000\n                            }\n                        );\n                    }\n                }\n            );\n        }        \n    });\n    \n\n    /**\n    * USER PROVIDES HIS TEMPORARY CODE TO\n     */\n    $(document).on('click', '#dialog-user-temporary-code-do', function() {\n        // Perform a renecryption based upon a temporary code\n        console.log('Reencryption based upon users temporary code');\n\n        // Show progress\n        $('#dialog-user-temporary-code-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').attr('disabled', 'disabled');            \n        \n        // Start by testing if the temporary code is correct to decrypt an item\n        data = {\n            'user_id': store.get('teampassUser').user_id,\n            'password': $('#dialog-user-temporary-code-value').val(),\n        }\n        if (debugJavascript === true) {\n            console.log('Testing if temporary code is correct');\n            console.log(data);\n        }\n        $.post(\n            'sources/main.queries.php', {\n                type: 'test_current_user_password_is_correct',\n                type_category: 'action_password',\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) console.log(data);\n\n                if (data.error !== false) {\n                    // Show error\n                    toastr.remove();\n                    toastr.error(\n                        data.message,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n\n                    $(\"#dialog-user-temporary-code-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                    // Enable buttons\n                    $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').removeAttr('disabled');\n                } else {\n                    // Change privatekey encryption with user-s password\n                    data = {\n                        'user_id': store.get('teampassUser').user_id,\n                        'current_code': $('#dialog-user-temporary-code-current-password').val(),\n                        'new_code': $('#dialog-user-temporary-code-value').val(),\n                        'action_type' : 'encrypt_privkey_with_user_password',\n                    }\n                    if (debugJavascript === true) console.log(data);\n                    \n                    $.post(\n                        'sources/main.queries.php', {\n                            type: 'change_private_key_encryption_password',\n                            type_category: 'action_key',\n                            data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                            if (debugJavascript === true) console.log(data);\n\n                            if (data.error !== false) {\n                                // Show error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                // Enable buttons\n                                $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').removeAttr('disabled');\n                            } else {\n                                // Inform user\n                                // Enable close button\n                                $('#dialog-user-temporary-code-close').removeAttr('disabled');\n                                $('#dialog-user-temporary-code-do').attr('disabled', 'disabled');\n\n                                // Finished\n                                $(\"#dialog-user-temporary-code-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n                                toastr.remove();\n\n                                store.update(\n                                    'teampassUser', {},\n                                    function(teampassUser) {\n                                        teampassUser.special = 'none';\n                                    }\n                                );\n                            }\n                        }\n                    );\n                }\n            }\n        );\n    });\n    $(document).on('click', '#dialog-user-temporary-code-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-temporary-code').addClass('hidden');\n    });\n\n\n    /**\n    * NEW LDAP USER HAS TO BUILD THE ITEMS DATABASE\n     */\n    $(document).on('click', '#dialog-ldap-user-build-keys-database-do', function() {\n        if ($('#dialog-ldap-user-build-keys-database-code').val() === '') {\n\n            return false;\n        }\n        // Perform a renecryption based upon a temporary code\n        console.log('Building items keys database for new LDAP user');\n\n        // Show progress\n        $('#dialog-ldap-user-build-keys-database-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').attr('disabled', 'disabled');            \n        \n        // Start by testing if the temporary code is correct to decrypt an item\n        data = {\n            'user_id': store.get('teampassUser').user_id,\n            'password' : $('#dialog-ldap-user-build-keys-database-code').val(),\n        }\n        if (debugJavascript === true) {\n            console.log('Testing if temporary code is correct in LDAP user case');\n            console.log(data);\n        }\n\n        $.post(\n            'sources/main.queries.php', {\n                type: 'test_current_user_password_is_correct',\n                type_category: 'action_password',\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) console.log(data);\n\n                if (data.error !== false) {\n                    // Show error\n                    toastr.remove();\n                    toastr.error(\n                        data.message,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n\n                    $(\"#dialog-ldap-user-build-keys-database-progress\").html('<?php echo langHdl('bad_code'); ?>');\n\n                    // Enable buttons\n                    $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                } else {\n                    // Change privatekey encryption with user-s password\n                    data = {\n                        'user_id': store.get('teampassUser').user_id,\n                        'current_code': $('#dialog-ldap-user-build-keys-database-code').val(),\n                        'new_code': '',\n                        'action_type' : '',\n                    }\n                    if (debugJavascript === true) console.log(data);\n                    \n                    $.post(\n                        'sources/main.queries.php', {\n                            type: 'change_private_key_encryption_password',\n                            type_category: 'action_key',\n                            data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                            if (debugJavascript === true) console.log(data);\n\n                            if (data.error !== false) {\n                                // Show error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                \n                                $(\"#dialog-ldap-user-build-keys-database-progress\").html('<i class=\"fa-solid fa-exclamation-circle text-danger mr-3\"></i><?php echo langHdl('bad_code'); ?>');\n\n                                // Enable buttons\n                                $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                            } else {\n                                // Inform user\n                                // Enable close button\n                                $('#dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                                $('#dialog-ldap-user-build-keys-database-do').attr('disabled', 'disabled');\n\n                                // Finished\n                                $(\"#dialog-ldap-user-build-keys-database-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n                                toastr.remove();\n\n                                store.update(\n                                    'teampassUser', {},\n                                    function(teampassUser) {\n                                        teampassUser.special = 'none';\n                                        teampassUser.otp_provided = 1;\n                                    }\n                                );\n\n                                // refresh the page\n                                window.location.href = 'index.php?page=items';\n                            }\n                        }\n                    );\n                }\n            }\n        );\n    });\n    $(document).on('click', '#dialog-user-temporary-code-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-temporary-code').addClass('hidden');\n    });\n\n\n    /**\n    * USER PASSWORD IN LDAP HAS CHANGED\n    */\n    $(document).on('click', '#dialog-ldap-user-change-password-do', function() {\n        // Start by changing the user password and send it by email\n        if ($('#dialog-ldap-user-change-password-old').val() !== \"\" && $('#dialog-ldap-user-change-password-current').val() !== \"\") {\n            // Case where a user is changing his authentication password\n            console.log('Reencryption based upon user auth password changed in LDAP');\n\n            // Show progress\n            $('#dialog-ldap-user-change-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n            \n            // Disable buttons\n            $('#dialog-ldap-user-change-password-do, #dialog-ldap-user-change-password-close').attr('disabled', 'disabled');\n            \n            data = {\n                'user_id': store.get('teampassUser').user_id,\n                'previous_password': $('#dialog-ldap-user-change-password-old').val(),\n                'current_password': $('#dialog-ldap-user-change-password-current').val(),\n            }\n            if (debugJavascript === true) console.log(data);\n\n            // Check user current password\n            // and change the password\n            // and use the password to re-encrypt the privatekey\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'change_user_ldap_auth_password',\n                    type_category: 'action_password',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n\n                        $(\"#dialog-ldap-user-change-password-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                        // Enable buttons\n                        $('#dialog-ldap-user-change-password-do, #dialog-ldap-user-change-password-close').removeAttr('disabled');\n                    } else {\n                        // SUCCESS\n                        $('#dialog-ldap-user-change-password-close').removeAttr('disabled');\n                        toastr.remove();\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('success'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                        $(\"#dialog-ldap-user-change-password-progress\").html('');\n                    }\n                }\n            );\n        } else {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('password_cannot_be_empty'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-ldap-user-change-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-ldap-user-change-password, #dialog-ldap-user-change-password-info').addClass('hidden');\n    });\n    // --- END ---\n\n\n    function loadSettings() {\n        return $.post(\n            \"sources/main.queries.php\", {\n                type: \"get_teampass_settings\",\n                type_category: 'action_system',\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                try {\n                    data = prepareExchangedData(\n                        data,\n                        \"decode\",\n                        \"<?php echo $_SESSION['key']; ?>\"\n                    );\n                } catch (e) {\n                    // error\n                    toastr.remove();\n                    toastr.error(\n                        '<?php echo langHdl('server_answer_error'); ?>',\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true,\n                            positionClass: \"toast-top-right\"\n                        }\n                    );\n                    return false;\n                }\n                if (debugJavascript === true) {\n                    console.log('Loading settings result:');\n                    console.log(data);\n                }\n\n                // Test if JSON object\n                if (typeof data === 'object') {\n                    // Store settings in localstorage\n                    // except sensitive data\n                    var sensitiveData = ['ldap_hosts','ldap_username','ldap_password','ldap_bdn', 'email','bck_script_passkey'];\n\n                    store.remove(\"teampassSettings\");\n\n                    store.update(\n                        'teampassSettings', {},\n                        function(teampassSettings) {\n                            $.each(data, function(key, value) {\n                                const containsKey = sensitiveData.some(element => {\n                                    if (key.includes(element)) {\n                                        return true;\n                                    }\n                                    return false;\n                                });\n\n                                if (containsKey === false) {\n                                    teampassSettings[key] = value;\n                                }\n                            });\n                        }\n                    );\n\n                    // Store some User info\n                    store.update(\n                        'teampassUser', {},\n                        function(teampassUser) {\n                            teampassUser['user_admin'] = <?php echo isset($_SESSION['user_admin']) === true ? (int) $_SESSION['user_admin'] : 0; ?>;\n                            teampassUser['user_id'] = <?php echo isset($_SESSION['user_id']) === true ? (int) $_SESSION['user_id'] : 0; ?>;\n                            teampassUser['user_manager'] = <?php echo isset($_SESSION['user_manager']) === true ? (int) $_SESSION['user_manager'] : 0; ?>;\n                            teampassUser['user_can_manage_all_users'] = <?php echo isset($_SESSION['user_can_manage_all_users']) === true ? (int) $_SESSION['user_can_manage_all_users'] : 0; ?>;\n                            teampassUser['user_read_only'] = <?php echo isset($_SESSION['user_admin']) === true ? (int) $_SESSION['user_read_only'] : 1; ?>;\n                            teampassUser['key'] = '<?php echo isset($_SESSION['key']) === true ? $_SESSION['key'] : 0; ?>';\n                            teampassUser['login'] = \"<?php echo isset($_SESSION['login']) === true ? $_SESSION['login'] : 0; ?>\";\n                            teampassUser['lastname'] = \"<?php echo isset($_SESSION['lastname']) === true ? $_SESSION['lastname'] : 0; ?>\";\n                            teampassUser['name'] = \"<?php echo isset($_SESSION['name']) === true ? $_SESSION['name'] : 0; ?>\";\n                            teampassUser['pskDefinedInDatabase'] = <?php echo isset($_SESSION['user']['encrypted_psk']) === true ? 1 : 0; ?>;\n                            teampassUser['can_create_root_folder'] = <?php echo isset($_SESSION['can_create_root_folder']) === true ? (int) $_SESSION['can_create_root_folder'] : 0; ?>;\n                            teampassUser['pskDefinedInDatabase'] = <?php echo isset($_SESSION['user']['encrypted_psk']) === true ? 1 : 0; ?>;\n                            teampassUser['special'] = '<?php echo isset($_SESSION['user']['special']) === true ? $_SESSION['user']['special'] : 'none'; ?>';\n                        }\n                    );\n                }\n            }\n        );\n    }\n\n    /**\n     * Undocumented function\n     *\n     * @return void\n     */\n    function showExtendSession() {\n        // Prepare modal\n        showModalDialogBox(\n            '#warningModal',\n            '<i class=\"fa-solid fa-clock fa-lg warning mr-2\"></i><?php echo langHdl('index_add_one_hour'); ?>',\n            '<div class=\"form-group\">' +\n            '<label for=\"warningModal-input\" class=\"col-form-label\"><?php echo langHdl('index_session_duration') . ' (' . langHdl('minutes') . ')'; ?>:</label>' +\n            '<input type=\"text\" class=\"form-control\" id=\"warningModal-input\" value=\"<?php echo isset($_SESSION['user']['session_duration']) === true ? (int) $_SESSION['user']['session_duration'] / 60 : 60; ?>\">' +\n            '</div>',\n            '<?php echo langHdl('confirm'); ?>',\n            '<?php echo langHdl('cancel'); ?>'\n        );\n\n        // Actions on modal buttons\n        $(document).on('click', '#warningModalButtonAction', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n\n            // Perform action\n            $.when(\n                IncreaseSessionTime(\n                    $('#warningModal-input').val()\n                )\n            ).then(function() {\n                toastr.remove();\n                toastr.success(\n                    '<?php echo langHdl('done'); ?>',\n                    '', {\n                        timeOut: 1000\n                    }\n                );\n                $('#warningModal').modal('hide');\n            });\n        });\n    }\n\n    /**\n     * Undocumented function\n     *\n     * @return void\n     */\n    function showPersonalSKDialog() {\n        $('#dialog-request-psk').removeClass('hidden');\n\n        // Hide other\n        $('.content-header, .content').addClass('hidden');\n\n        $('#user_personal_saltkey').focus();\n\n        toastr.remove();\n    }\n\n    /**\n     * Loads the last seen items\n     *\n     * @return void\n     */\n    function refreshListLastSeenItems() {\n        $.post(\n            \"sources/main.queries.php\", {\n                type: 'refresh_list_items_seen',\n                type_category: 'action_user',\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                try {\n                    data = $.parseJSON(data)\n                } catch (e) {\n                    return false;\n                }\n                if (debugJavascript === true) {\n                    console.log('Refresh last item seen result');\n                    console.log(data);\n                }\n                //check if format error\n                if (data.error === '') {\n                    if (data.html_json === null || data.html_json === '') {\n                        $('#index-last-pwds').html('<li><?php echo langHdl('none'); ?></li>');\n                    } else {\n                        // Prepare HTML\n                        var html_list = '';\n                        $.each(data.html_json, function(i, value) {\n                            html_list += '<li onclick=\"showItemCard($(this).closest(\\'li\\'))\" class=\"pointer\" data-item-edition=\"0\" data-item-id=\"' + value.id + '\" data-item-sk=\"' + value.perso + '\" data-item-expired=\"0\" data-item-restricted=\"' + value.restricted + '\" data-item-display=\"1\" data-item-open-edit=\"0\" data-item-reload=\"0\" data-item-tree-id=\"' + value.tree_id + '\" data-is-search-result=\"0\">' +\n                                '<i class=\"fa fa-caret-right mr-2\"></i>' + value.label + '</li>';\n                        });\n                        $('#index-last-pwds').html(html_list);\n                    }\n\n                    // show notification\n                    if (data.existing_suggestions !== 0) {\n                        blink('#menu_button_suggestion', -1, 500, 'ui-state-error');\n                    }\n                } else {\n                    toastr.remove();\n                    toastr.error(\n                        data.error,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n                }\n            }\n        );\n    }\n\n    /**\n     * Show an item\n     *\n     * @return void\n     */\n    function showItemCard(itemDefinition) {\n        // Show circle-notch\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n\n        if (window.location.href.indexOf('page=items') === -1) {\n            location.replace('<?php echo $SETTINGS['cpassman_url']; ?>/index.php?page=items&group=' + itemDefinition.data().itemTreeId + '&id=' + itemDefinition.data().itemId);\n        } else {\n            $('#items_list').html('<ul class=\"liste_items\" id=\"full_items_list\"></ul>');\n            Details(itemDefinition, 'show');\n            if (itemDefinition.data().itemTreeId !== $('#open_folder').val()) {\n                ListerItems(itemDefinition.data().itemTreeId, '', 0);\n            }\n\n            // Hide sidebar-mini\n            $('body')\n                .removeClass('control-sidebar-slide-open');\n        }\n    }\n\n    /**\n     * Open defect report page\n     *\n     * @return void\n     */\n    function generateBugReport() {\n        $('#dialog-bug-report-text').html('');\n        $('#dialog-bug-report').removeClass('hidden');\n\n        // Scroll to top\n        $(window).scrollTop(0);\n\n        var data = {\n            'browser_name': platform.name,\n            'browser_version': platform.version,\n            'os': platform.os.family,\n            'os_archi': platform.os.architecture,\n            'current_page': window.location.href.substring(window.location.href.lastIndexOf(\"/\")+1),\n        }\n        \n        $.post(\n            \"sources/main.queries.php\", {\n                type: 'generate_bug_report',\n                type_category: 'action_system',\n                data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n\n                // Show data\n                $('#dialog-bug-report-text').html(data.html);\n\n                // Open Github\n                $('#dialog-bug-report-github-button').click(function() {\n                    window.open('https://github.com/nilsteampassnet/TeamPass/issues/new', '_blank');\n                    return false;\n                });\n            }\n        );\n    }\n\n    // This permits to manage the column width of tree/items\n    $(document).on('click', '.columns-position', function() {\n        var colLeft = $('#folders-tree-card').find('.column-left'),\n            colRight = $('#folders-tree-card').find('.column-right'),\n            counterLeft = $(colLeft).attr(\"class\").match(/col-md-[\\w-]*\\b/)[0].split('-')[2],\n            counterRight = $(colRight).attr(\"class\").match(/col-md-[\\w-]*\\b/)[0].split('-')[2];\n\n        // Toogle class\n        if ($('#folders-tree-card').hasClass('hidden') === false) {\n            if ($(this).hasClass('tree-decrease') === true && counterRight < 9) {\n                $(colLeft).toggleClass('col-md-' + counterLeft + ' col-md-' + (parseInt(counterLeft) - 1));\n                $(colRight).toggleClass('col-md-' + counterRight + ' col-md-' + (parseInt(counterRight) + 1));\n            } else if ($(this).hasClass('tree-increase') === true && counterLeft < 9) {\n                $(colLeft).toggleClass('col-md-' + counterLeft + ' col-md-' + (parseInt(counterLeft) + 1));\n                $(colRight).toggleClass('col-md-' + counterRight + ' col-md-' + (parseInt(counterRight) - 1));\n            }\n        }\n    })\n\n    $(function() {\n        // In case that session was expired and login form was reloaded\n        // Force the launchIdentify as if the user has clicked the button\n        if ($(\"#auto_log\").length > 0) {\n            $(\"#but_identify_user\").click();\n        }\n    });\n\n    // Prevent usage of browser back button\n    history.pushState(null, null, location.href);\n    window.onpopstate = function () {\n        const queryString = window.location.search\n        const urlParams = new URLSearchParams(queryString);\n        if (urlParams.get('page') === 'items') {\n            // go back to list\n            // Play with show and hide classes\n            $('.form-item, .form-item-action, .form-folder-action, .item-details-card, .columns-position, #item-details-card-categories, #form-item-upload-pickfilesList, #card-item-expired')\n                .addClass('hidden');\n            $('#folders-tree-card').removeClass('hidden');\n\n            history.go(1);\n        }\n    };\n\n    /**\n     * \n     * @param {integer} duration\n     * \n     */\n    function clearClipboardTimeout(duration) {\n        // Wait for duration\n        $(this).delay(duration * 1000).queue(function() {\n            navigator.clipboard.writeText(\"Cleared by Teampass\").then(function() {\n                // clipboard successfully set\n            }, function() {\n                // clipboard write failed\n            });\n\n            $(this).dequeue();\n        });\n    }    \n    \n    /**\n     * Perform call to get progress status\n     * \n     * @param {integer} userId\n     */\n    function getGenerateKeysProgress(userId) {\n        var data = {\n            'user_id': userId,\n        };\n\n        $.post(\n            \"sources/users.queries.php\", {\n                type: \"get_generate_keys_progress\",\n                data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                //decrypt data\n                data = decodeQueryReturn(data, '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) {\n                    console.info('Process generation keys status:');\n                    console.log(data);\n                }\n\n                if (data.error === false) {\n                    // Show progress\n                    $('#user_not_ready_progress')\n                        .text('(' + data.status + ')')\n                        .addClass('ml-1');\n                    $('#user_not_ready').removeClass('hidden');\n\n                    if (data.status !== 'finished') {\n                        // If not finished, then run again after 10 seconds\n                        setTimeout(\n                            getGenerateKeysProgress,\n                            10000,\n                            store.get('teampassUser').user_id\n                        );\n                    } else {\n                        // Progress is finished\n                        // We need to finalize user public/private keys\n                        \n                        $('#user_not_ready').addClass('hidden');\n                        $(\"#warningModalButtonAction\").removeClass('hidden');\n                        $('#user_not_ready_progress').html('');\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('done'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    }\n                }\n            }\n        );\n    }\n</script>\n", "<?php\n\ndeclare(strict_types=1);\n\n/**\n * Teampass - a collaborative passwords manager.\n * ---\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * ---\n *\n * @project   Teampass\n * @file      options.php\n * ---\n *\n * @author    Nils Laumaill\u00e9 (nils@teampass.net)\n *\n * @copyright 2009-2023 Teampass.net\n *\n * @license   https://spdx.org/licenses/GPL-3.0-only.html#licenseText GPL-3.0\n * ---\n *\n * @see       https://www.teampass.net\n */\n\nif (\n    isset($_SESSION['CPM']) === false || $_SESSION['CPM'] !== 1\n    || isset($_SESSION['user_id']) === false || empty($_SESSION['user_id']) === true\n    || isset($_SESSION['key']) === false || empty($_SESSION['key']) === true\n) {\n    die('Hacking attempt...');\n}\n\n// Load config\nif (file_exists('../includes/config/tp.config.php') === true) {\n    include_once '../includes/config/tp.config.php';\n} elseif (file_exists('./includes/config/tp.config.php') === true) {\n    include_once './includes/config/tp.config.php';\n} else {\n    throw new Exception('Error file \"/includes/config/tp.config.php\" not exists', 1);\n}\n\n/* do checks */\nrequire_once $SETTINGS['cpassman_dir'] . '/sources/checks.php';\nif (checkUser($_SESSION['user_id'], $_SESSION['key'], 'admin', $SETTINGS) === false) {\n    $_SESSION['error']['code'] = ERR_NOT_ALLOWED;\n    include $SETTINGS['cpassman_dir'] . '/error.php';\n    exit;\n}\n\n// Load template\nrequire_once $SETTINGS['cpassman_dir'] . '/sources/main.functions.php';\n// Generates zones\n$zones = timezone_list();\n?>\n\n<!-- Content Header (Page header) -->\n<div class='content-header'>\n    <div class='container-fluid'>\n        <div class='row mb-2'>\n            <div class='col-sm-6'>\n                <h1 class='m-0 text-dark'><?php echo langHdl('options'); ?></h1>\n            </div><!-- /.col -->\n            <div class='col-sm-6 text-right'>\n                <div class=\"input-group input-group-sm\">\n                    <input type=\"text\" class=\"form-control\" placeholder=\"<?php echo langHdl('find'); ?>\" id=\"find-options\">\n                    <div class=\"input-group-append\">\n                        <div class=\"btn btn-primary\" id=\"button-find-options\">\n                            <i class=\"fas fa-search\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div><!-- /.col -->\n        </div><!-- /.row -->\n    </div><!-- /.container-fluid -->\n</div>\n<!-- /.content-header -->\n\n\n<!-- Main content -->\n<div class='content'>\n    <div class='container-fluid'>\n        <div class='row'>\n            <div class='col-md-6'>\n                <div class='card card-primary'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- form start -->\n                    <form role='form-horizontal'>\n                        <div class='card-body'>\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='cpassman_dir' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_cpassman_dir'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='cpassman_dir' value='<?php echo isset($SETTINGS['cpassman_dir']) === true ? $SETTINGS['cpassman_dir'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='cpassman_url' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_cpassman_url'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='cpassman_url' value='<?php echo isset($SETTINGS['cpassman_url']) === true ? $SETTINGS['cpassman_url'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='path_to_upload_folder' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_path_to_upload_folder'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='path_to_upload_folder' value='<?php echo isset($SETTINGS['path_to_upload_folder']) === true ? $SETTINGS['path_to_upload_folder'] : ''; ?>'>\n                                    <small id='passwordHelpBlock' class='form-text text-muted'>\n                                        <?php echo langHdl('admin_path_to_upload_folder_tip'); ?>\n                                    </small>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='path_to_files_folder' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_path_to_files_folder'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='path_to_files_folder' value='<?php echo isset($SETTINGS['path_to_files_folder']) === true ? $SETTINGS['path_to_files_folder'] : ''; ?>'>\n                                    <small id='passwordHelpBlock' class='form-text text-muted'>\n                                        <?php echo langHdl('admin_path_to_files_folder_tip'); ?>\n                                    </small>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='favicon' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_favicon'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='favicon' value='<?php echo isset($SETTINGS['favicon']) === true ? $SETTINGS['favicon'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='custom_logo' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_custom_logo'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='custom_logo' value='<?php echo isset($SETTINGS['custom_logo']) === true ? $SETTINGS['custom_logo'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='custom_login_text' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_custom_login_text'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='custom_login_text' value='<?php echo isset($SETTINGS['custom_login_text']) === true ? $SETTINGS['custom_login_text'] : ''; ?>'>\n                                </div>\n                            </div>\n                        </div>\n                        <!-- /.card-body -->\n                    </form>\n                </div>\n                <!-- /.card -->\n\n                <div class='card card-primary'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- form start -->\n                    <div class='card-body'>\n                        <div class='row mb-2 option' data-keywords=\"setting maintenance mode\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_maintenance_mode'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='maintenance_mode' data-toggle-on='<?php echo isset($SETTINGS['maintenance_mode']) && (int) $SETTINGS['maintenance_mode'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='maintenance_mode_input' value='<?php echo isset($SETTINGS['maintenance_mode']) && (int) $SETTINGS['maintenance_mode'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting session expiration time\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_default_session_expiration_time'); ?>\n                            </div>\n                            <div class='col-2 mb-2'>\n                                <input type='text' class='form-control form-control-sm' id='default_session_expiration_time' value='<?php echo $SETTINGS['default_session_expiration_time'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting \">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_http_request_login'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_http_request_login' data-toggle-on='<?php echo isset($SETTINGS['enable_http_request_login']) && (int) $SETTINGS['enable_http_request_login'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_http_request_login_input' value='<?php echo isset($SETTINGS['enable_http_request_login']) && (int) $SETTINGS['enable_http_request_login'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting strict hsts sts\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_enable_sts'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_enable_sts_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_sts' data-toggle-on='<?php echo isset($SETTINGS['enable_sts']) && (int) $SETTINGS['enable_sts'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_sts_input' value='<?php echo isset($SETTINGS['enable_sts']) && (int) $SETTINGS['enable_sts'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting proxy ip\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_proxy_ip'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_proxy_ip_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='proxy_ip' value='<?php echo $SETTINGS['proxy_ip'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting proxy port\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_proxy_port'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_proxy_port_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='proxy_port' value='<?php echo $SETTINGS['proxy_port'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting login length password\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_pwd_maximum_length'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_pwd_maximum_length_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='pwd_maximum_length' value='<?php echo $SETTINGS['pwd_maximum_length'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting time date\">\n                            <div class='col-4'>\n                                <?php echo langHdl('timezone_selection'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='timezone'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <?php\n                                    // get list of all timezones\n                                    foreach ($zones as $key => $zone) {\n                                        echo '\n                                <option value=\"' . $key . '\"', isset($SETTINGS['timezone']) === true && $SETTINGS['timezone'] === $key ? ' selected' : '', '>' . $zone . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting date format\">\n                            <div class='col-4'>\n                                <?php echo langHdl('date_format'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='date_format'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <option value=\"d/m/Y\" <?php echo isset($SETTINGS['date_format']) === false || $SETTINGS['date_format'] === 'd/m/Y' ? ' selected' : ''; ?>>d/m/Y</option>\n                                    <option value=\"m/d/Y\" <?php echo $SETTINGS['date_format'] === 'm/d/Y' ? ' selected' : ''; ?>>m/d/Y</option>\n                                    <option value=\"d-M-Y\" <?php echo $SETTINGS['date_format'] === 'd-M-Y' ? ' selected' : ''; ?>>d-M-Y</option>\n                                    <option value=\"d/m/y\" <?php echo $SETTINGS['date_format'] === 'd/m/y' ? ' selected' : ''; ?>>d/m/y</option>\n                                    <option value=\"m/d/y\" <?php echo $SETTINGS['date_format'] === 'm/d/y' ? ' selected' : ''; ?>>m/d/y</option>\n                                    <option value=\"d-M-y\" <?php echo $SETTINGS['date_format'] === 'd-M-y' ? ' selected' : ''; ?>>d-M-y</option>\n                                    <option value=\"d-m-y\" <?php echo $SETTINGS['date_format'] === 'd-m-y' ? ' selected' : ''; ?>>d-m-y</option>\n                                    <option value=\"Y-m-d\" <?php echo $SETTINGS['date_format'] === 'Y-m-d' ? ' selected' : ''; ?>>Y-m-d</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting time format\">\n                            <div class='col-4'>\n                                <?php echo langHdl('time_format'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='time_format'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <option value=\"H:i:s\" <?php echo isset($SETTINGS['time_format']) === false || $SETTINGS['time_format'] === 'H:i:s' ? ' selected' : ''; ?>>H:i:s</option>\n                                    <option value=\"H:i:s a\" <?php echo $SETTINGS['time_format'] === 'H:i:s a' ? ' selected' : ''; ?>>H:i:s a</option>\n                                    <option value=\"g:i:s a\" <?php echo $SETTINGS['time_format'] === 'g:i:s a' ? ' selected' : ''; ?>>g:i:s a</option>\n                                    <option value=\"G:i:s\" <?php echo $SETTINGS['time_format'] === 'G:i:s' ? ' selected' : ''; ?>>G:i:s</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting language\">\n                            <div class='col-8'>\n                                <?php echo langHdl('settings_default_language'); ?>\n                            </div>\n                            <div class='col-4'>\n                                <select class='form-control form-control-sm' id='default_language'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <?php\n                                    foreach ($languagesList as $lang) {\n                                        echo '\n                                <option value=\"' . $lang . '\"', isset($SETTINGS['default_language']) === true && $SETTINGS['default_language'] === $lang ? ' selected' : '', '>' . $lang . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <!--\n                    <div class='row mb-2 option'>\n                        <div class='col-10'>\n                            <?php echo langHdl('number_of_used_pw'); ?>\n                        </div>\n                        <div class='col-2'>\n                            <input type='text' class='form-control form-control-sm' id='number_of_used_pw' value='<?php echo $SETTINGS['number_of_used_pw'] ?? '5'; ?>'>\n                        </div>\n                    </div>\n                    -->\n\n                        <div class='row mb-2 option' data-keywords=\"user login password duration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('pw_life_duration'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='pw_life_duration' value='<?php echo $SETTINGS['pw_life_duration'] ?? '5'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"log user login password security\">\n                            <div class='col-10'>\n                                <?php echo langHdl('nb_false_login_attempts'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='nb_bad_authentication' value='<?php echo $SETTINGS['nb_bad_authentication'] ?? '0'; ?>'>\n                            </div>\n                        </div>\n\n                        <!--\n                        <div class='row mb-2 option' data-keywords=\"log user login\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_log_connections'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='log_connections' data-toggle-on='<?php echo isset($SETTINGS['log_connections']) === true && $SETTINGS['log_connections'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='log_connections_input' value='<?php echo isset($SETTINGS['log_connections']) && $SETTINGS['log_connections'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n                        -->\n\n                        <div class='row mb-2 option' data-keywords=\"log item password log security\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_log_accessed'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='log_accessed' data-toggle-on='<?php echo isset($SETTINGS['log_accessed']) === true && $SETTINGS['log_accessed'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='log_accessed_input' value='<?php echo isset($SETTINGS['log_accessed']) && $SETTINGS['log_accessed'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder personal user\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_personal_folder_feature'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('enable_personal_folder_feature_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_pf_feature' data-toggle-on='<?php echo isset($SETTINGS['enable_pf_feature']) === true && $SETTINGS['enable_pf_feature'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_pf_feature_input' value='<?php echo isset($SETTINGS['enable_pf_feature']) && $SETTINGS['enable_pf_feature'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <!--\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('enable_personal_saltkey_cookie'); ?>\n                      </div>\n                      <div class='col-2'>\n                          <div class='toggle toggle-modern' id='enable_personal_saltkey_cookie' data-toggle-on='<?php echo isset($SETTINGS['enable_personal_saltkey_cookie']) === true && $SETTINGS['enable_personal_saltkey_cookie'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_personal_saltkey_cookie_input' value='<?php echo isset($SETTINGS['enable_personal_saltkey_cookie']) && $SETTINGS['enable_personal_saltkey_cookie'] === '1' ? '1' : '0'; ?>' />\n                      </div>\n                  </div>\n\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('personal_saltkey_cookie_duration'); ?>\n                      </div>\n                      <div class='col-2'>\n                      <input type='text' class='form-control form-control-sm' id='personal_saltkey_cookie_duration' value='<?php echo $SETTINGS['personal_saltkey_cookie_duration'] ?? '31'; ?>'>\n                      </div>\n                  </div>\n\n                    <div class='row mb-2 option'>\n                        <div class='col-8'>\n                            <?php echo langHdl('personal_saltkey_security_level'); ?>\n                        </div>\n                        <div class='col-4'>\n                            <select class='form-control form-control-sm' id='personal_saltkey_security_level'>\n                                <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                <?php\n                                foreach (TP_PW_COMPLEXITY as $complex) {\n                                    echo '\n                                <option value=\"' . $complex[0] . '\"', isset($SETTINGS['personal_saltkey_security_level']) === true && $SETTINGS['personal_saltkey_security_level'] === $complex[0] ? ' selected' : '', '>' . $complex[1] . '</option>';\n                                }\n                                ?>\n                            </select>\n                        </div>\n                    </div>\n\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('settings_attachments_encryption'); ?>\n                          <small id='passwordHelpBlock' class='form-text text-muted'>\n                              <?php echo langHdl('settings_attachments_encryption_tip'); ?>\n                          </small>\n                      </div>\n                      <div class='col-2'>\n                          <div class='toggle toggle-modern' id='enable_attachment_encryption' data-toggle-on='<?php echo isset($SETTINGS['enable_attachment_encryption']) === true && $SETTINGS['enable_attachment_encryption'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_attachment_encryption_input' value='<?php echo isset($SETTINGS['enable_attachment_encryption']) && $SETTINGS['enable_attachment_encryption'] === '1' ? '1' : '0'; ?>' />\n                      </div>\n                  </div>\n                  -->\n\n                        <div class='row mb-2 option' data-keywords=\"image\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_secure_display_image'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_secure_display_image_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='secure_display_image' data-toggle-on='<?php echo isset($SETTINGS['secure_display_image']) === true && $SETTINGS['secure_display_image'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='secure_display_image_input' value='<?php echo isset($SETTINGS['secure_display_image']) && $SETTINGS['secure_display_image'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"option\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_kb'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_kb_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_kb' data-toggle-on='<?php echo isset($SETTINGS['enable_kb']) === true && $SETTINGS['enable_kb'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_kb_input' value='<?php echo isset($SETTINGS['enable_kb']) && $SETTINGS['enable_kb'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"option\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_suggestion'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_suggestion_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_suggestion' data-toggle-on='<?php echo isset($SETTINGS['enable_suggestion']) === true && $SETTINGS['enable_suggestion'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_suggestion_input' value='<?php echo isset($SETTINGS['enable_suggestion']) && $SETTINGS['enable_suggestion'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_get_tp_info'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_get_tp_info_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='get_tp_info' data-toggle-on='<?php echo isset($SETTINGS['get_tp_info']) === true && $SETTINGS['get_tp_info'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='get_tp_info_input' value='<?php echo isset($SETTINGS['get_tp_info']) && $SETTINGS['get_tp_info'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                    </div>\n                    <!-- /.card-body -->\n                </div>\n                <!-- /.card -->\n\n            </div>\n            <!-- /.col-md-6 -->\n            <!--/.col (left) -->\n            <!-- right column -->\n            <div class='col-md-6'>\n                <!-- Horizontal Form -->\n                <div class='card card-info'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- card-body -->\n                    <div class='card-body'>\n                        <div class='row mb-2 option' data-keywords=\"item edit\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_delay_for_item_edition'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_delay_for_item_edition_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='delay_item_edition' value='<?php echo $SETTINGS['delay_item_edition'] ?? '9'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"one time\">\n                            <div class='col-10'>\n                                <?php echo langHdl('otv_is_enabled'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='otv_is_enabled' data-toggle-on='<?php echo isset($SETTINGS['otv_is_enabled']) === true && $SETTINGS['otv_is_enabled'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='otv_is_enabled_input' value='<?php echo isset($SETTINGS['otv_is_enabled']) && $SETTINGS['otv_is_enabled'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"one time period expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_otv_expiration_period'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='otv_expiration_period' value='<?php echo $SETTINGS['otv_expiration_period'] ?? '7'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"right manager item\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_manager_edit'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='manager_edit' data-toggle-on='<?php echo isset($SETTINGS['manager_edit']) === true && $SETTINGS['manager_edit'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='manager_edit_input' value='<?php echo isset($SETTINGS['manager_edit']) && $SETTINGS['manager_edit'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"right manager move item\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_manager_move_item'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='manager_move_item' data-toggle-on='<?php echo isset($SETTINGS['manager_move_item']) === true && $SETTINGS['manager_move_item'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='manager_move_item_input' value='<?php echo isset($SETTINGS['manager_move_item']) && $SETTINGS['manager_move_item'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password last\">\n                            <div class='col-10'>\n                                <?php echo langHdl('max_last_items'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='max_last_items' value='<?php echo isset($SETTINGS['max_last_items']) === true ? $SETTINGS['max_last_items'] : '7'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"create duplicate folder\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='duplicate_folder' data-toggle-on='<?php echo isset($SETTINGS['duplicate_folder']) === true && $SETTINGS['duplicate_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='duplicate_folder_input' value='<?php echo isset($SETTINGS['duplicate_folder']) && $SETTINGS['duplicate_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password duplicate\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_item'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='duplicate_item' data-toggle-on='<?php echo isset($SETTINGS['duplicate_item']) === true && $SETTINGS['duplicate_item'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='duplicate_item_input' value='<?php echo isset($SETTINGS['duplicate_item']) && $SETTINGS['duplicate_item'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password duplicate folder\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_item_in_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='item_duplicate_in_same_folder' data-toggle-on='<?php echo isset($SETTINGS['item_duplicate_in_same_folder']) === true && $SETTINGS['item_duplicate_in_same_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='item_duplicate_in_same_folder_input' value='<?php echo isset($SETTINGS['item_duplicate_in_same_folder']) && $SETTINGS['item_duplicate_in_same_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder display optimization hide\">\n                            <div class='col-10'>\n                                <?php echo langHdl('show_only_accessible_folders'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('show_only_accessible_folders_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='show_only_accessible_folders' data-toggle-on='<?php echo isset($SETTINGS['show_only_accessible_folders']) === true && $SETTINGS['show_only_accessible_folders'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='show_only_accessible_folders_input' value='<?php echo isset($SETTINGS['show_only_accessible_folders']) && $SETTINGS['show_only_accessible_folders'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('subfolder_rights_as_parent'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('subfolder_rights_as_parent_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='subfolder_rights_as_parent' data-toggle-on='<?php echo isset($SETTINGS['subfolder_rights_as_parent']) === true && $SETTINGS['subfolder_rights_as_parent'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='subfolder_rights_as_parent_input' value='<?php echo isset($SETTINGS['subfolder_rights_as_parent']) && $SETTINGS['subfolder_rights_as_parent'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('create_item_without_password'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='create_item_without_password' data-toggle-on='<?php echo isset($SETTINGS['create_item_without_password']) === true && $SETTINGS['create_item_without_password'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='create_item_without_password_input' value='<?php echo isset($SETTINGS['create_item_without_password']) && $SETTINGS['create_item_without_password'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"favorite\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_favourites'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_favourites' data-toggle-on='<?php echo isset($SETTINGS['enable_favourites']) === true && $SETTINGS['enable_favourites'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_favourites_input' value='<?php echo isset($SETTINGS['enable_favourites']) && $SETTINGS['enable_favourites'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_user_can_create_folders'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_user_can_create_folders' data-toggle-on='<?php echo isset($SETTINGS['enable_user_can_create_folders']) === true && $SETTINGS['enable_user_can_create_folders'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_user_can_create_folders_input' value='<?php echo isset($SETTINGS['enable_user_can_create_folders']) && $SETTINGS['enable_user_can_create_folders'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('can_create_root_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='can_create_root_folder' data-toggle-on='<?php echo isset($SETTINGS['can_create_root_folder']) === true && $SETTINGS['can_create_root_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='can_create_root_folder_input' value='<?php echo isset($SETTINGS['can_create_root_folder']) && $SETTINGS['can_create_root_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete massive\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_massive_move_delete'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('enable_massive_move_delete_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_massive_move_delete' data-toggle-on='<?php echo isset($SETTINGS['enable_massive_move_delete']) === true && $SETTINGS['enable_massive_move_delete'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_massive_move_delete_input' value='<?php echo isset($SETTINGS['enable_massive_move_delete']) && $SETTINGS['enable_massive_move_delete'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password display\">\n                            <div class='col-10'>\n                                <?php echo langHdl('password_overview_delay'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('password_overview_delay_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='password_overview_delay' value='<?php echo isset($SETTINGS['password_overview_delay']) === true ? $SETTINGS['password_overview_delay'] : '4'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete view expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_setting_activate_expiration'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('admin_setting_activate_expiration_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='activate_expiration' data-toggle-on='<?php echo isset($SETTINGS['activate_expiration']) === true && $SETTINGS['activate_expiration'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='activate_expiration_input' value='<?php echo isset($SETTINGS['activate_expiration']) && $SETTINGS['activate_expiration'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete view expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_setting_enable_delete_after_consultation'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('admin_setting_enable_delete_after_consultation_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_delete_after_consultation' data-toggle-on='<?php echo isset($SETTINGS['enable_delete_after_consultation']) === true && $SETTINGS['enable_delete_after_consultation'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_delete_after_consultation_input' value='<?php echo isset($SETTINGS['enable_delete_after_consultation']) && $SETTINGS['enable_delete_after_consultation'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"export print\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_printing'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_printing_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='allow_print' data-toggle-on='<?php echo isset($SETTINGS['allow_print']) === true && $SETTINGS['allow_print'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='allow_print_input' value='<?php echo isset($SETTINGS['allow_print']) && $SETTINGS['allow_print'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"export print\">\n                            <div class='col-6'>\n                                <?php echo langHdl('settings_roles_allowed_to_print'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_roles_allowed_to_print_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-6'>\n                                <select class='form-control form-control-sm select2 disabled' id='roles_allowed_to_print_select' onchange='' multiple=\"multiple\" style=\"width:100%;\">\n                                    <?php\n                                    // Get selected groups\n                                    if (isset($SETTINGS['allow_print']) === true) {\n                                        $arrRolesToPrint = json_decode($SETTINGS['roles_allowed_to_print_select'], true);\n                                        if ($arrRolesToPrint === 0 || empty($arrRolesToPrint) === true) {\n                                            $arrRolesToPrint = [];\n                                        }\n                                        // Get full list\n                                        $roles = performDBQuery(\n                                            $SETTINGS,\n                                            'id, title',\n                                            'roles_title'\n                                        );\n                                        foreach ($roles as $role) {\n                                            echo '\n                                <option value=\"' . $role['id'] . '\"', in_array($role['id'], $arrRolesToPrint) === true ? ' selected' : '', '>' . addslashes($role['title']) . '</option>';\n                                        }\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"import\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_importing'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='allow_import' data-toggle-on='<?php echo isset($SETTINGS['allow_import']) === true && $SETTINGS['allow_import'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='allow_import_input' value='<?php echo isset($SETTINGS['allow_import']) && $SETTINGS['allow_import'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"role restriction modify right\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_anyone_can_modify'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_anyone_can_modify_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='anyone_can_modify' data-toggle-on='<?php echo isset($SETTINGS['anyone_can_modify']) === true && $SETTINGS['anyone_can_modify'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='anyone_can_modify_input' value='<?php echo isset($SETTINGS['anyone_can_modify']) && $SETTINGS['anyone_can_modify'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option <?php echo isset($SETTINGS['anyone_can_modify']) === true && $SETTINGS['anyone_can_modify'] === '1' ? '' : 'hidden'; ?>' id=\"form-item-row-modify\" data-keywords=\"role restriction modify right\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_anyone_can_modify_bydefault'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='anyone_can_modify_bydefault' data-toggle-on='<?php echo isset($SETTINGS['anyone_can_modify_bydefault']) === true && $SETTINGS['anyone_can_modify_bydefault'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='anyone_can_modify_bydefault_input' value='<?php echo isset($SETTINGS['anyone_can_modify_bydefault']) && $SETTINGS['anyone_can_modify_bydefault'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"role restriction\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_restricted_to'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='restricted_to' data-toggle-on='<?php echo isset($SETTINGS['restricted_to']) === true && $SETTINGS['restricted_to'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='restricted_to_input' value='<?php echo isset($SETTINGS['restricted_to']) && $SETTINGS['restricted_to'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option <?php echo isset($SETTINGS['restricted_to']) === true && $SETTINGS['restricted_to'] === '1' ? '' : 'hidden'; ?>' id=\"form-item-row-restricted\" data-keywords=\"role restriction\">\n                            <div class='col-10'>\n                                <?php echo langHdl('restricted_to_roles'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='restricted_to_roles' data-toggle-on='<?php echo isset($SETTINGS['restricted_to_roles']) === true && $SETTINGS['restricted_to_roles'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='restricted_to_roles_input' value='<?php echo isset($SETTINGS['restricted_to_roles']) && $SETTINGS['restricted_to_roles'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization icon\">\n                            <div class='col-10'>\n                                <?php echo langHdl('copy_to_clipboard_small_icons'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('copy_to_clipboard_small_icons_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='copy_to_clipboard_small_icons' data-toggle-on='<?php echo isset($SETTINGS['copy_to_clipboard_small_icons']) === true && $SETTINGS['copy_to_clipboard_small_icons'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='copy_to_clipboard_small_icons_input' value='<?php echo isset($SETTINGS['copy_to_clipboard_small_icons']) && $SETTINGS['copy_to_clipboard_small_icons'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization icon clipboard\">\n                            <div class='col-10'>\n                                <?php echo langHdl('clipboard_password_life_duration'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('clipboard_password_life_duration_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='clipboard_life_duration' value='<?php echo isset($SETTINGS['clipboard_life_duration']) === true ? $SETTINGS['clipboard_life_duration'] : '30'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization description\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_show_description'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='show_description' data-toggle-on='<?php echo isset($SETTINGS['show_description']) === true && $SETTINGS['show_description'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='show_description_input' value='<?php echo isset($SETTINGS['show_description']) && $SETTINGS['show_description'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n<?php\nif (isset($SETTINGS['show_description']) === true && $SETTINGS['show_description'] === '1') {\n    ?>\n                        <div class='row mb-2 option' data-keywords=\"display tree counter\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_tree_counters'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_tree_counters_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='tree_counters' data-toggle-on='<?php echo isset($SETTINGS['tree_counters']) === true && $SETTINGS['tree_counters'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='tree_counters_input' value='<?php echo isset($SETTINGS['tree_counters']) && $SETTINGS['tree_counters'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n<?php\n}\n?>\n                        <div class='row mb-2 option' data-keywords=\"query display optimization\">\n                            <div class='col-10'>\n                                <?php echo langHdl('nb_items_by_query'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('nb_items_by_query_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='nb_items_by_query' value='<?php echo isset($SETTINGS['nb_items_by_query']) === true ? $SETTINGS['nb_items_by_query'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification login\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_send_email_on_user_login'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_send_email_on_user_login' data-toggle-on='<?php echo isset($SETTINGS['enable_send_email_on_user_login']) === true && $SETTINGS['enable_send_email_on_user_login'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_send_email_on_user_login_input' value='<?php echo isset($SETTINGS['enable_send_email_on_user_login']) && $SETTINGS['enable_send_email_on_user_login'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_email_notification_on_item_shown'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_email_notification_on_item_shown' data-toggle-on='<?php echo isset($SETTINGS['enable_email_notification_on_item_shown']) === true && $SETTINGS['enable_email_notification_on_item_shown'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_email_notification_on_item_shown_input' value='<?php echo isset($SETTINGS['enable_email_notification_on_item_shown']) && $SETTINGS['enable_email_notification_on_item_shown'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification password change\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_email_notification_on_user_pw_change'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_email_notification_on_user_pw_change' data-toggle-on='<?php echo isset($SETTINGS['enable_email_notification_on_user_pw_change']) === true && $SETTINGS['enable_email_notification_on_user_pw_change'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_email_notification_on_user_pw_change_input' value='<?php echo isset($SETTINGS['enable_email_notification_on_user_pw_change']) && $SETTINGS['enable_email_notification_on_user_pw_change'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"history manual\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_insert_manual_entry_item_history'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_insert_manual_entry_item_history_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='insert_manual_entry_item_history' data-toggle-on='<?php echo isset($SETTINGS['insert_manual_entry_item_history']) === true && $SETTINGS['insert_manual_entry_item_history'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='insert_manual_entry_item_history_input' value='<?php echo isset($SETTINGS['insert_manual_entry_item_history']) && $SETTINGS['insert_manual_entry_item_history'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"offline export\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_offline_mode'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_offline_mode_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='settings_offline_mode' data-toggle-on='<?php echo isset($SETTINGS['settings_offline_mode']) === true && $SETTINGS['settings_offline_mode'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='settings_offline_mode_input' value='<?php echo isset($SETTINGS['settings_offline_mode']) && $SETTINGS['settings_offline_mode'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"offline\">\n                            <div class='col-7'>\n                                <?php echo langHdl('offline_mode_key_level'); ?>\n                            </div>\n                            <div class='col-5'>\n                                <select class='form-control form-control-sm' id='offline_key_level'>\n                                    <?php\n                                    foreach (TP_PW_COMPLEXITY as $complex) {\n                                        echo '\n                                <option value=\"' . $complex[0] . '\"', isset($SETTINGS['offline_key_level']) === true && $SETTINGS['offline_key_level'] === $complex[0] ? ' selected' : '', '>' . $complex[1] . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"syslog\">\n                            <div class='col-10'>\n                                <?php echo langHdl('syslog_enable'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='syslog_enable' data-toggle-on='<?php echo isset($SETTINGS['syslog_enable']) === true && $SETTINGS['syslog_enable'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='syslog_enable_input' value='<?php echo isset($SETTINGS['syslog_enable']) && $SETTINGS['syslog_enable'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"syslog\">\n                            <div class='col-7'>\n                                <?php echo langHdl('syslog_host'); ?>\n                            </div>\n                            <div class='col-5'>\n                                <input type='text' class='form-control form-control-sm' id='syslog_host' value='<?php echo isset($SETTINGS['syslog_host']) === true ? $SETTINGS['syslog_host'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-5 option' data-keywords=\"syslog port\">\n                            <div class='col-10'>\n                                <?php echo langHdl('syslog_port'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='syslog_port' value='<?php echo isset($SETTINGS['syslog_port']) === true ? $SETTINGS['syslog_port'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password server\">\n                            <div class='col-10'>\n                                <?php echo langHdl('server_password_change_enable'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('server_password_change_enable_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern disabled' id='enable_server_password_change' data-toggle-on='<?php echo isset($SETTINGS['enable_server_password_change']) === true && $SETTINGS['enable_server_password_change'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_server_password_change_input' value='<?php echo isset($SETTINGS['enable_server_password_change']) && $SETTINGS['enable_server_password_change'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                    </div>\n                    <!-- /.card-body -->\n                </div>\n                <!-- /.card -->\n            </div>\n            <!--/.col (right) -->\n        </div>\n        <!-- /.row -->\n    </div><!-- /.container-fluid -->\n</div>\n<!-- /.content -->\n"], "fixing_code": ["<?php\n\ndeclare(strict_types=1);\n\n/**\n * Teampass - a collaborative passwords manager.\n * ---\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * ---\n *\n * @project   Teampass\n * @file      load.js.php\n * ---\n *\n * @author    Nils Laumaill\u00e9 (nils@teampass.net)\n *\n * @copyright 2009-2023 Teampass.net\n *\n * @license   https://spdx.org/licenses/GPL-3.0-only.html#licenseText GPL-3.0\n * ---\n *\n * @see       https://www.teampass.net\n */\n\nif (isset($_SESSION['CPM']) === false || (int) $_SESSION['CPM'] !== 1) {\n    die('Hacking attempt...');\n}\n\n// Is maintenance on-going?\nif (\n    isset($SETTINGS['maintenance_mode']) === true\n    && (int) $SETTINGS['maintenance_mode'] === 1\n    && ($session_user_admin === null\n        || (int) $session_user_admin === 1)\n) {\n    ?>\n    <script type=\"text/javascript\">\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('index_maintenance_mode_admin'); ?>',\n            '<?php echo langHdl('information'); ?>', {\n                timeOut: 0\n            }\n        );\n    </script>\n<?php\n}\n?>\n\n<script type=\"text/javascript\">\n    var userScrollPosition = 0,\n        debugJavascript = true;\n    let hourInMinutes = 60;\n\n\n    $(document).ready(function() {\n        //console.log('-- PAGE LOADED --'+$(location).attr('href').includes('?')+\" -- \"+store.get('teampassUser'));\n        if ($(location).attr('href').includes('?') === true && (store.get('teampassUser') === undefined || parseInt(store.get('teampassUser').user_id) <= 0)) {\n            $(location).attr('href', 'index.php?session=expired');\n            return false;\n        }\n\n        // prevent a resubmit on refresh and back button\n        if (window.history.replaceState) {\n            window.history.replaceState(null, null, window.location.href);\n        }\n    });\n\n    /**\n    *   Add 1 hour to session duration\n    **/\n    function IncreaseSessionTime(duration)\n    {\n        duration = duration || hourInMinutes;\n        $.post(\n            'sources/main.queries.php',\n            {\n                type     : 'increase_session_time',\n                type_category: 'action_user',\n                duration : parseInt(duration, 10) * hourInMinutes,\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                if (data[0].new_value !== 'expired') {\n                    $('#temps_restant').val(data[0].new_value);\n                    $('#date_end_session').val(data[0].new_value);\n                    $('#countdown').css('color', 'white');\n                } else {\n                    $(location).attr('href', 'index.php?session=expired');\n                }\n            },\n            'json'\n        );\n    }\n\n    // Start real time\n    // get list of last items\n    if (store.get('teampassUser') !== undefined && parseInt(store.get('teampassUser').user_id) > 0\n        && String('<?php echo $_SESSION['key']; ?>') === store.get('teampassUser').sessionKey\n        && (Date.now() - store.get('teampassUser').sessionStartTimestamp) < (store.get('teampassUser').sessionDuration * 1000)\n    ) {\n        $.when(\n            // Load teampass settings\n            loadSettings()\n        ).then(function() {\n            $.when(\n                // Refresh list of last items shopwn\n                refreshListLastSeenItems()\n            ).then(function() {\n                // Check if new privatekey needs to be adapted\n                var data = {\n                    'user_id': store.get('teampassUser').user_id,\n                    'fields' : 'special, auth_type, is_ready_for_usage, ongoing_process_id, otp_provided',\n                }\n                $.post(\n                    \"sources/main.queries.php\", {\n                        type: \"get_user_info\",\n                        type_category: 'action_user',\n                        data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                        key: \"<?php echo $_SESSION['key']; ?>\"\n                    },\n                    function(data) {\n                        //decrypt data\n                        data = decodeQueryReturn(data, '<?php echo $_SESSION['key']; ?>');\n                        if (debugJavascript === true) {\n                            console.info('Get user info results:');\n                            console.log(data);\n                        }\n\n                        // update local storage\n                        store.update(\n                            'teampassUser', {},\n                            function(teampassUser) {\n                                teampassUser.special = data.queryResults.special;\n                                teampassUser.auth_type = data.queryResults.auth_type;\n                                teampassUser.is_ready_for_usage = data.queryResults.is_ready_for_usage;\n                                teampassUser.ongoing_process_id = data.queryResults.ongoing_process_id;\n                            }\n                        );\n\n                        if (data.error === false && data.queryResults.special === 'generate-keys') {\n                            // Get generation keys progress status\n                            getGenerateKeysProgress(store.get('teampassUser').user_id);\n\n                            // ----\n                        } else if (data.error === false && data.queryResults.special === 'auth-pwd-change' && data.queryResults.auth_type === 'local') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('User has to change his auth password')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show passwords inputs and form\n                            $('#dialog-user-change-password-info')\n                                .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('user_has_to_change_password_info');?>')\n                                .removeClass('hidden');\n                            $('#dialog-user-change-password').removeClass('hidden');\n\n                        // ----\n                        } else if (data.error === false && data.queryResults.special === 'auth-pwd-change' && data.queryResults.auth_type === 'ldap') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('LDAP user password has to change his auth password')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show passwords inputs and form\n                            $('#dialog-ldap-user-change-password-info')\n                                .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('ldap_user_has_changed_his_password');?>')\n                                .removeClass('hidden');\n                            $('#dialog-ldap-user-change-password').removeClass('hidden');\n                            \n                            // ----\n                        } else if (\n                            (data.error === false && data.queryResults.special === 'user_added_from_ldap' && data.queryResults.auth_type === 'ldap')\n                            || (typeof data.queryResults !== 'undefined' && data.queryResults.special === 'otc_is_required_on_next_login')\n                            || parseInt(data.queryResults.otp_provided) === 0\n                        ) {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('NEW LDAP user password - we need to encrypt items')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show form\n                            $('#dialog-ldap-user-build-keys-database').removeClass('hidden');\n                        } else if (typeof data.queryResults !== 'undefined' && data.queryResults.special === 'recrypt-private-key') {\n                            // USer's password has been reseted, he shall change it\n                            if (debugJavascript === true) console.log('NEW LDAP - we need to encrypt private key')\n                            // HIde\n                            $('.content-header, .content').addClass('hidden');\n\n                            // Show form\n                            $('#dialog-ldap-user-change-password').removeClass('hidden');\n                        }\n                    }\n                );\n            }).then(function() {\n                if (store.get('teampassSettings') === undefined || parseInt(store.get('teampassSettings').enable_tasks_manager) === 0) {\n                    console.log('Now sending emails')\n                    setTimeout(\n                        function() {\n                            $.when(\n                                // send email\n                                $.post(\n                                    \"sources/main.queries.php\", {\n                                        type: \"send_waiting_emails\",\n                                        type_category: 'action_mail',\n                                        key: \"<?php echo $_SESSION['key']; ?>\"\n                                    }\n                                )\n                            ).then(function() {\n                                // send statistics\n                                $.post(\n                                    \"sources/main.queries.php\", {\n                                        type: \"sending_statistics\",\n                                        type_category: 'action_system',\n                                        key: \"<?php echo $_SESSION['key']; ?>\"\n                                    }\n                                );\n                            });\n                        },\n                        3000\n                    );\n                }\n\n                // Save user location\n                //console.info(\"DEBUG - Save user location -\"+store.get('teampassUser').location_stored)\n                if (store.get('teampassUser').location_stored !== 1) {\n                // Save user location\n                    $.post(\n                        \"sources/users.queries.php\", {\n                            type: 'save_user_location',\n                            step: \"perform\",\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            // update local storage\n                            store.update(\n                                'teampassUser', {},\n                                function(teampassUser) {\n                                    teampassUser.location_stored = 1;\n                                }\n                            );\n                        }\n                    );\n                }\n            });\n        });\n    }\n    //-- end\n\n\n    // Countdown\n    countdown();\n\n    $(\".show_hide_password a\").on('click', function(event) {\n        event.preventDefault();\n        if($('.how_hide_password input').attr(\"type\") === \"text\"){\n            $('.show_hide_password input').attr('type', 'password');\n            $('.show_hide_password i').addClass( \"fa-eye-slash\" );\n            $('.show_hide_password i').removeClass( \"fa-eye\" );\n        }else if($('#show_hide_password input').attr(\"type\") === \"password\"){\n            $('.show_hide_password input').attr('type', 'text');\n            $('.show_hide_password i').removeClass( \"fa-eye-slash\" );\n            $('.show_hide_password i').addClass( \"fa-eye\" );\n        }\n    });\n    \n    if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'generate-keys'\n    ) {\n        // Now we need to perform re-encryption due to LDAP password change\n        /*console.log('User has to regenerate keys')\n        // HIde\n        $('.content-header, .content').addClass('hidden');\n        $('#dialog-user-temporary-code-info').html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('renecyption_expected');?>');\n\n        // Show passwords inputs and form\n        $('#dialog-user-temporary-code').removeClass('hidden');\n        */\n        \n        // ---\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'ldap_password_has_changed_do_reencryption'\n    ) {\n        // Now we need to perform re-encryption due to LDAP password change\n        console.log('show password change')\n        // HIde\n        $('.content-header, .content, #button_do_sharekeys_reencryption').addClass('hidden');\n        $('#warning-text-reencryption').html('<i class=\"icon fa-solid fa-info mr-2\"></i>'.langHdl('ldap_password_change_warning'));\n\n        // Show passwords inputs and form\n        $('#dialog-encryption-keys, .ask-for-previous-password').removeClass('hidden');\n\n        $('#sharekeys_reencryption_target_user').val(store.get('teampassUser').user_id);\n\n        $('#button_do_sharekeys_reencryption').removeClass('hidden');\n        \n        // ---\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').shown_warning_unsuccessful_login === false\n    ) {\n        // If login attempts experimented\n        // Prepare modal\n        showModalDialogBox(\n            '#warningModal',\n            '<i class=\"fa-solid fa-user-shield fa-lg warning mr-2\"></i><?php echo langHdl('caution'); ?>',\n            '<?php echo langHdl('login_attempts_identified_since_last_connection'); ?>',\n            '<?php echo langHdl('see_detail'); ?>',\n            '<?php echo langHdl('cancel'); ?>'\n        );\n\n        // Actions on modal buttons\n        $(document).on('click', '#warningModalButtonClose', function() {\n            store.update(\n                'teampassUser', {},\n                function(teampassUser) {\n                    teampassUser.shown_warning_unsuccessful_login = true;\n                }\n            );\n        });\n        $(document).on('click', '#warningModalButtonAction', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info('<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>');\n\n            // Action\n            store.update(\n                'teampassUser', {},\n                function(teampassUser) {\n                    teampassUser.shown_warning_unsuccessful_login = true;\n                }\n            );\n            document.location.href = \"index.php?page=profile&tab=timeline\";\n        });\n    } else if (store.get('teampassUser') !== undefined &&\n        store.get('teampassUser').special === 'private_items_to_encrypt'\n    ) {\n        // If user has to re-encrypt his personal item passwords\n        $('#dialog-encryption-personal-items-after-upgrade').removeClass('hidden');\n        $('.content, .content-header').addClass('hidden');\n        \n        // Actions on modal buttons\n        $(document).on('click', '#button_do_personal_items_reencryption', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info('<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>');\n\n            defusePskRemoval(store.get('teampassUser').user_id, 'psk', 0);\n            \n            function defusePskRemoval(userId, step, start)\n            {\n                if (step === 'psk') {\n                    // Inform user\n                    $(\"#user-current-defuse-psk-progress\").html('<b><?php echo langHdl('encryption_keys'); ?> </b> [' + start + ' - ' + (parseInt(start) + <?php echo NUMBER_ITEMS_IN_BATCH;?>) + '] ' +\n                        '... <?php echo langHdl('please_wait'); ?><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n\n                    var data = {\n                        'userPsk' : $('#user-current-defuse-psk').val(),\n                            'start': start,\n                            'length': <?php echo NUMBER_ITEMS_IN_BATCH;?>,\n                            'user_id': userId,\n                    };\n                    // Do query\n                    $.post(\n                        \"sources/main.queries.php\", {\n                            'type': \"user_psk_reencryption\",\n                            'type_category': 'action_key',\n                            'data': prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            'key': '<?php echo $_SESSION['key']; ?>'\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, \"decode\", \"<?php echo $_SESSION['key']; ?>\");\n                            if (debugJavascript === true) console.log(data)\n                            if (data.error === true) {\n                                // error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                // Enable buttons\n                                $(\"#user-current-defuse-psk-progress\").html('<?php echo langHdl('provide_current_psk_and_click_launch'); ?>');\n                                $('#button_do_sharekeys_reencryption, #button_close_sharekeys_reencryption').removeAttr('disabled');\n                                return false;\n                            } else {\n                                // Start looping on all steps of re-encryption\n                                defusePskRemoval(data.userId, data.step, data.start);\n                            }\n                        }\n                    );\n                } else {\n                    // Finished\n                    $(\"#user-current-defuse-psk-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n\n                    toastr.remove();\n                }\n            }\n\n        });\n        $(document).on('click', '#button_close_personal_items_reencryption', function() {\n            $('#dialog-encryption-personal-items-after-upgrade').addClass('hidden');\n            $('.content, .content-header').removeClass('hidden');\n        });\n    }\n\n\n    // Show tooltips\n    $('.infotip').tooltip();\n\n    // Sidebar redirection\n    $('.nav-link').click(function() {\n        if ($(this).data('name') !== undefined) {\n            //NProgress.start();\n            document.location.href = \"index.php?page=\" + $(this).data('name');\n        }\n    });\n\n    // User menu action\n    $('.user-menu').click(function() {\n        if ($(this).data('name') !== undefined) {\n            if ($(this).data('name') === 'increase_session') {\n                showExtendSession();\n            } else if ($(this).data('name') === 'sync-new-ldap-password') {\n                // This case permits to handle a case where user has changed his password in LDAP\n                console.log('show sync-new-ldap-password')\n                \n                if (debugJavascript === true) console.log('LDAP user password has to change his auth password')\n                // HIde\n                $('.content-header, .content').addClass('hidden');\n\n                // Show passwords inputs and form\n                $('#dialog-ldap-user-change-password-info')\n                    .html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('ldap_user_has_changed_his_password');?>')\n                    .removeClass('hidden');\n                $('#dialog-ldap-user-change-password').removeClass('hidden');\n\n                // ----\n            } else if ($(this).data('name') === 'password-change') {\n                //console.log('show password change')\n                // HIde\n                $('.content-header, .content, #button_do_user_change_password').addClass('hidden');\n\n                // Add DoCheck button\n                $('#button_do_user_change_password').after('<button class=\"btn btn-primary\" id=\"button_do_pwds_checks\"><?php echo langHdl('perform_checks'); ?></button>');\n\n                // Show passwords inputs and form\n                $('#dialog-user-change-password-progress').html('<i class=\"icon fa-solid fa-info mr-2\"></i><?php echo langHdl('change_your_password_info_message'); ?>');\n                $('#dialog-user-change-password').removeClass('hidden');\n\n                // Actions\n                $('#button_do_pwds_checks').click(function() {\n                    if ($('#profile-password').val() !== $('#profile-password-confirm').val()) {\n                        $('#button_do_user_change_password').addClass('hidden');\n                        toastr.remove();\n                        toastr.error(\n                            '<?php echo langHdl('passwords_not_the_same'); ?>',\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 3000,\n                                progressBar: true\n                            }\n                        );\n                    } else if (parseInt($('#profile-password-complex').val()) >= parseInt(store.get('teampassSettings').personal_saltkey_security_level)) {\n                        $('#button_do_user_change_password').removeClass('hidden');\n                        $('#button_do_pwds_checks').remove();\n                        toastr.remove();\n                        toastr.info(\n                            '<?php echo langHdl('hit_launch_to_start'); ?>',\n                            '<?php echo langHdl('ready_to_go'); ?>', {\n                                timeOut: 3000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        $('#button_do_user_change_password').addClass('hidden');\n                        toastr.remove();\n                        toastr.error(\n                            '<?php echo langHdl('complexity_level_not_reached'); ?>',\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    }\n                });\n                \n                // ----\n            } else if ($(this).data('name') === 'profile') {\n                // Show profile page\n                document.location.href = \"index.php?page=profile\";\n\n                // ----\n            } else if ($(this).data('name') === 'logout') {\n                // Logout directly to login form\n                window.location.href = \"./includes/core/logout.php?token=<?php echo $_SESSION['key']; ?>\";\n\n                // ----\n            } else if ($(this).data('name') === 'generate-new_keys') {\n                // User wants to generate new keys\n                console.log('show new keys generation');\n                $('#warningModalButtonAction').attr('data-button-confirm', 'false');\n\n                // SHow modal\n                showModalDialogBox(\n                    '#warningModal',\n                    '<i class=\"fa-solid fa-person-digging fa-lg warning mr-2\"></i><?php echo langHdl('generate_new_keys'); ?> <b>',\n                    '<div class=\"form-group\">'+\n                        '<?php echo langHdl('generate_new_keys_info'); ?>' +\n                    '</div>' +\n                    '<div class=\"input-group mb-2 hidden\" id=\"new-encryption-div\">' +\n                        '<div class=\"input-group-prepend\">' +\n                            '<span class=\"input-group-text\"><?php echo langHdl('confirm_password'); ?></span>' +\n                        '</div>' +\n                        '<input id=\"encryption-otp\" type=\"password\" class=\"form-control form-item-control\" value=\"'+store.get('teampassUser').pwd+'\">' +\n                        '<div class=\"input-group-append\">' +\n                            '<button class=\"btn btn-outline-secondary btn-no-click\" id=\"show-encryption-otp\" title=\"<?php echo langHdl('mask_pw'); ?>\"><i class=\"fas fa-low-vision\"></i></button>' +\n                        '</div>' +\n                    '</div>',\n                    '<?php echo langHdl('perform'); ?>',\n                    '<?php echo langHdl('close'); ?>'\n                );\n\n                // Manage show/hide password\n                $('#show-encryption-otp')\n                    .mouseup(function() {\n                        $('#encryption-otp').attr('type', 'password');\n                    })\n                    .mousedown(function() {\n                        $('#encryption-otp').attr('type', 'text');\n                    });\n                $('.btn-no-click')\n                    .click(function(e) {\n                        e.preventDefault();\n                    });\n\n                // Manage click on button PERFORM\n                $(document).on('click', '#warningModalButtonAction', function() {\n                    // On PERFORM click\n                    if ($('#warningModalButtonAction').attr('data-button-confirm') === 'false') {\n                        $(\"#new-encryption-div\").removeClass('hidden');\n                        $('#warningModalButtonAction')\n                            .html('<i class=\"fa-solid fa-triangle-exclamation warning mr-2\"></i><?php echo langHdl('confirm'); ?>')\n                            .attr('data-button-confirm', 'true');\n\n                    } else if ($('#warningModalButtonAction').attr('data-button-confirm') === 'true') {\n                        // As reencryption relies on user's password\n                        // ensure we have it\n                        if ($('#encryption-otp').val() === '') {\n                            // No user password provided\n                            $('#warningModalButtonAction')\n                                .html('<?php echo langHdl('perform'); ?>')\n                                .attr('data-button-confirm', 'false');\n\n                        } else {\n                            // We have the password, start reencryption\n                            $('#warningModalButtonAction')\n                                .addClass('disabled')\n                                .html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n                            $('#warningModalButtonClose').addClass('disabled');\n\n                            // update the process\n                            // add all tasks\n                            var parameters = {\n                                'user_id': parseInt(store.get('teampassUser').user_id),\n                                'user_pwd': $('#encryption-otp').val(),\n                                'encryption_key': '',\n                                'delete_existing_keys': true,\n                                'encrypt_with_user_pwd': true,\n                                'send_email_to_user': true,\n                                'email_body': 'email_body_user_config_4',\n                                'generate_user_new_password': false,\n                            };\n                            //console.log(parameters);\n\n                            $.post(\n                                \"sources/main.queries.php\", {\n                                    type: \"user_new_keys_generation\",\n                                    type_category: 'action_key',\n                                    data: prepareExchangedData(JSON.stringify(parameters), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                                    key: \"<?php echo $_SESSION['key']; ?>\"\n                                },\n                                function(data_next1) { \n                                    data_next1 = prepareExchangedData(data_next1, 'decode', '<?php echo $_SESSION['key']; ?>');\n                                    if (debugJavascript === true) console.log(data_next1)\n\n                                    if (data_next1.error !== false) {\n                                        // Show error\n                                        toastr.remove();\n                                        toastr.error(\n                                            data_next1.message,\n                                            '<?php echo langHdl('caution'); ?>', {\n                                                timeOut: 5000,\n                                                progressBar: true\n                                            }\n                                        );\n                                    } else {\n                                        $(\"#new-encryption-div\").after('<div><?php echo langHdl('generate_new_keys_end'); ?></div>');\n                                        // Show warning\n                                        $('#user_not_ready').removeClass('hidden');\n                                        // update local storage\n                                        store.update(\n                                            'teampassUser', {},\n                                            function(teampassUser) {\n                                                teampassUser.is_ready_for_usage = 0;\n                                            }\n                                        );\n                                        $(\"#warningModalButtonAction\").addClass('hidden');\n                                        $('#warningModalButtonClose').removeClass('disabled');\n\n                                        // Get follow up\n                                        setTimeout(\n                                            getGenerateKeysProgress,\n                                            5000,\n                                            store.get('teampassUser').user_id\n                                        );\n                                    }\n                                }\n                            );\n                        }\n                    }\n                });\n            }\n        }\n    });\n\n    $('.close-element').click(function() {\n        $(this).closest('.card').addClass('hidden');\n\n        $('.content-header, .content').removeClass('hidden');\n    });\n\n    /**\n     * When clicking save Personal saltkey\n     */\n    /*\n    $('#button_save_user_psk').click(function() {\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n\n        // Prepare data\n        var data = {\n            \"psk\": sanitizeString($(\"#user_personal_saltkey\").val()),\n            \"complexity\": $(\"#psk_strength_value\").val()\n        };\n\n        //\n        $.post(\n            \"sources/main.queries.php\", {\n                type: \"store_personal_saltkey\",\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                data = prepareExchangedData(data, '<?php echo $_SESSION['key']; ?>');\n\n                // Is there an error?\n                if (data.error === true) {\n                    toastr.remove();\n                    toastr.error(\n                        '<?php echo langHdl('warning'); ?>',\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n                } else {\n                    store.update(\n                        'teampassUser',\n                        function(teampassUser) {\n                            teampassUser.pskDefinedInDatabase = 1;\n                        }\n                    )\n\n                    store.update(\n                        'teampassUser',\n                        function(teampassUser) {\n                            teampassUser.pskSetForSession = data.encrypted_psk;\n                        }\n                    )\n\n                    toastr.remove();\n                    toastr.success(\n                        '<?php echo langHdl('alert_page_will_reload'); ?>'\n                    );\n\n                    location.reload();\n                }\n            }\n        );\n    });\n    */\n\n    // For Personal Saltkey\n    $(\"#profile-password\").simplePassMeter({\n        \"requirements\": {},\n        \"container\": \"#profile-password-strength\",\n        \"defaultText\": \"<?php echo langHdl('index_pw_level_txt'); ?>\",\n        \"ratings\": [{\n                \"minScore\": 0,\n                \"className\": \"meterFail\",\n                \"text\": \"<?php echo langHdl('complex_level0'); ?>\"\n            },\n            {\n                \"minScore\": 25,\n                \"className\": \"meterWarn\",\n                \"text\": \"<?php echo langHdl('complex_level1'); ?>\"\n            },\n            {\n                \"minScore\": 50,\n                \"className\": \"meterWarn\",\n                \"text\": \"<?php echo langHdl('complex_level2'); ?>\"\n            },\n            {\n                \"minScore\": 60,\n                \"className\": \"meterGood\",\n                \"text\": \"<?php echo langHdl('complex_level3'); ?>\"\n            },\n            {\n                \"minScore\": 70,\n                \"className\": \"meterGood\",\n                \"text\": \"<?php echo langHdl('complex_level4'); ?>\"\n            },\n            {\n                \"minScore\": 80,\n                \"className\": \"meterExcel\",\n                \"text\": \"<?php echo langHdl('complex_level5'); ?>\"\n            },\n            {\n                \"minScore\": 90,\n                \"className\": \"meterExcel\",\n                \"text\": \"<?php echo langHdl('complex_level6'); ?>\"\n            }\n        ]\n    });\n    $(\"#profile-password\").bind({\n        \"score.simplePassMeter\": function(jQEvent, score) {\n            $(\"#profile-password-complex\").val(score);\n        }\n    }).change({\n        \"score.simplePassMeter\": function(jQEvent, score) {\n            $(\"#profile-password-complex\").val(score);\n        }\n    });\n\n    // Hide sidebar footer icons when reducing sidebar\n    $('a[data-widget=\"pushmenu\"]').click(function(event) {\n        if ($('#sidebar-footer').hasClass('hidden') === true) {\n            setTimeout(function() {\n                $('#sidebar-footer').removeClass('hidden');\n            }, 300);\n        } else {\n            $('#sidebar-footer').addClass('hidden');\n        }\n    });\n\n\n    var clipboardCopy = new ClipboardJS(\".clipboard-copy\", {\n        text: function(trigger) {\n            var elementId = $(trigger).data('clipboard-text');\n            if (debugJavascript === true) console.log($('#' + elementId).val())\n            return String($('#' + elementId).val());\n        }\n    });\n\n    clipboardCopy.on('success', function(e) {\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('copy_to_clipboard'); ?>',\n            '<?php echo langHdl('information'); ?>', {\n                timeOut: 2000\n            }\n        );\n    });\n    \n    // Progress bar\n    setTimeout(\n        function() {\n            $(\".fade\").removeClass(\"out\");\n\n            // Is user not ready\n            if (typeof store.get('teampassUser') !== 'undefined' && typeof store.get('teampassUser').is_ready_for_usage !== 'undefined' && parseInt(store.get('teampassUser').is_ready_for_usage) === 0) {\n                $('#user_not_ready').removeClass('hidden');\n            }\n        },\n        5000\n    );\n\n\n    /**\n    * USER HAS DECIDED TO CHANGE HIS AUTH PASSWORD\n     */\n    $(document).on('click', '#dialog-user-change-password-do', function() {\n        // Start by changing the user password and send it by email\n        if ($('#profile-password-confirm').val() !== $('#profile-password').val()) {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('index_pw_error_identical'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n            return false;\n        }\n        if ($('#profile-current-password').val() !== \"\" && $('#profile-password').val() !== \"\" && $('#profile-password-confirm').val() !== \"\") {\n            // Case where a user is changing his authentication password\n            console.log('Reencryption based upon user decision to change his auth password');\n\n            // Show progress\n            $('#dialog-user-change-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n            \n            // Disable buttons\n            $('#dialog-user-change-password-do, #dialog-user-change-password-close').attr('disabled', 'disabled');\n            \n            data = {\n                'user_id': store.get('teampassUser').user_id,\n                'old_password': $('#profile-current-password').val(),\n                'new_password': $('#profile-password').val(),\n            }\n            if (debugJavascript === true) console.log(data);\n\n            // Check user current password\n            // and change the password\n            // and use the password to re-encrypt the privatekey\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'change_user_auth_password',\n                    type_category: 'action_password',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n\n                        $(\"#dialog-user-change-password-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                        // Enable buttons\n                        $('#dialog-user-change-password-do, #dialog-user-change-password-close').removeAttr('disabled');\n                    } else {\n                        // SUCCESS\n                        $('#dialog-user-change-password-close').removeAttr('disabled');\n                        toastr.remove();\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('success'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                        $(\"#dialog-user-change-password-progress\").html('');\n                        $('#dialog-user-change-password').addClass('hidden');\n                        $('.content-header, .content').removeClass('hidden');\n                    }\n                }\n            );\n        } else {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('password_cannot_be_empty'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-user-change-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-change-password, #dialog-user-change-password-info').addClass('hidden');\n    });\n    \n\n    /**\n    * ADMIN HAS DECIDED TO CHANGE THE USER'S AUTH PASSWORD\n     */\n    $(document).on('click', '#dialog-admin-change-user-password-do', function() {\n        // When an admin changes the user auth password\n        console.log('Reencryption based upon admin decision to change user auth password');\n\n        // Show progress\n        $('#dialog-admin-change-user-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-admin-change-user-password-do, #dialog-admin-change-user-password-close').attr('disabled', 'disabled');            \n        \n        // ENsure we have a user id\n        if ($('#admin_change_user_password_target_user').val() !== '') {\n            // Case where change is for user's account\n            // update the process\n            // add all tasks\n            var parameters = {\n                'user_id': parseInt($('#admin_change_user_password_target_user').val()),\n                'user_pwd': '',\n                'encryption_key': '',\n                'delete_existing_keys': true,\n                'send_email_to_user': true,\n                'encrypt_with_user_pwd': true,\n                'generate_user_new_password': true,\n                'email_body': 'email_body_user_config_3',\n            };\n\n            $.post(\n                \"sources/main.queries.php\", {\n                    type: \"user_new_keys_generation\",\n                    type_category: 'action_key',\n                    data: prepareExchangedData(JSON.stringify(parameters), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data_next1) { \n                    data_next1 = prepareExchangedData(data_next1, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data_next1)\n\n                    if (data_next1.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data_next1.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        // Reload table\n                        if (typeof oTable !== 'undefined') {\n                            oTable.ajax.reload();\n                        }\n                        \n                        $(\"#dialog-admin-change-user-password-progress\").html('<?php echo langHdl('generate_new_keys_end'); ?>');\n                        // Show warning\n                        // Enable buttons\n                        $('#dialog-admin-change-user-password-close').removeAttr('disabled');\n                        toastr.remove();\n                    }\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-admin-change-user-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-admin-change-user-password').addClass('hidden');\n    });\n    \n    $(document).on('click', '.temp-button', function() {\n        \n        if ($(this).data('action') === \"show-user-pwd\") {\n            // show password\n            $('#temp-user-pwd').attr('type', 'text');\n            $(this).prop( \"disabled\", true );\n            setTimeout(\n                () => {\n                    $('#temp-user-pwd').attr('type', 'hidden');\n                    $(this).prop( \"disabled\", false );\n                },\n                5000\n            );\n        } else if ($(this).data('action') === \"send-user-pwd\") {\n            // Send email\n            console.log('Preparing for email sending');\n            \n            // Prepare data\n            var data = {\n                'receipt': $('#temp-user-email').val(),\n                'subject': '[Teampass] <?php echo langHdl('your_new_password');?>',\n                'body': '<?php echo langHdl('email_body_temporary_login_password');?>',\n                'pre_replace' : {\n                    '#enc_code#' : $('#temp-user-pwd').val(),\n                }\n            }\n            if (debugJavascript === true) console.log(data);\n            // Prepare form\n            $('#dialog-admin-change-user-password-info').html('<?php echo langHdl('sending_email_message');?>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n\n            // Launch action\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'mail_me',\n                    type_category: 'action_mail',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: '<?php echo $_SESSION['key']; ?>'\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    } else {\n                        // Fianlize UI\n\n                        $('#dialog-admin-change-user-password-info').html('');\n                        $('#dialog-admin-change-user-password-do, #dialog-admin-change-user-password-close').removeAttr('disabled');\n\n                        // HIde\n                        $('.content-header, .content').removeClass('hidden');\n\n                        // SHow form\n                        $('#dialog-admin-change-user-password').addClass('hidden');\n\n                        store.set(\n                            'teampassUser', {\n                                admin_user_password: '',\n                                admin_user_email: '',\n                            }\n                        );\n                        \n                        // Inform user\n                        toastr.remove();\n                        toastr.success(\n                            '<?php echo langHdl('done'); ?>',\n                            '', {\n                                timeOut: 1000\n                            }\n                        );\n                    }\n                }\n            );\n        }        \n    });\n    \n\n    /**\n    * USER PROVIDES HIS TEMPORARY CODE TO\n     */\n    $(document).on('click', '#dialog-user-temporary-code-do', function() {\n        // Perform a renecryption based upon a temporary code\n        console.log('Reencryption based upon users temporary code');\n\n        // Show progress\n        $('#dialog-user-temporary-code-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').attr('disabled', 'disabled');            \n        \n        // Start by testing if the temporary code is correct to decrypt an item\n        data = {\n            'user_id': store.get('teampassUser').user_id,\n            'password': $('#dialog-user-temporary-code-value').val(),\n        }\n        if (debugJavascript === true) {\n            console.log('Testing if temporary code is correct');\n            console.log(data);\n        }\n        $.post(\n            'sources/main.queries.php', {\n                type: 'test_current_user_password_is_correct',\n                type_category: 'action_password',\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) console.log(data);\n\n                if (data.error !== false) {\n                    // Show error\n                    toastr.remove();\n                    toastr.error(\n                        data.message,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n\n                    $(\"#dialog-user-temporary-code-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                    // Enable buttons\n                    $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').removeAttr('disabled');\n                } else {\n                    // Change privatekey encryption with user-s password\n                    data = {\n                        'user_id': store.get('teampassUser').user_id,\n                        'current_code': $('#dialog-user-temporary-code-current-password').val(),\n                        'new_code': $('#dialog-user-temporary-code-value').val(),\n                        'action_type' : 'encrypt_privkey_with_user_password',\n                    }\n                    if (debugJavascript === true) console.log(data);\n                    \n                    $.post(\n                        'sources/main.queries.php', {\n                            type: 'change_private_key_encryption_password',\n                            type_category: 'action_key',\n                            data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                            if (debugJavascript === true) console.log(data);\n\n                            if (data.error !== false) {\n                                // Show error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                // Enable buttons\n                                $('#dialog-user-temporary-code-do, #dialog-user-temporary-code-close').removeAttr('disabled');\n                            } else {\n                                // Inform user\n                                // Enable close button\n                                $('#dialog-user-temporary-code-close').removeAttr('disabled');\n                                $('#dialog-user-temporary-code-do').attr('disabled', 'disabled');\n\n                                // Finished\n                                $(\"#dialog-user-temporary-code-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n                                toastr.remove();\n\n                                store.update(\n                                    'teampassUser', {},\n                                    function(teampassUser) {\n                                        teampassUser.special = 'none';\n                                    }\n                                );\n                            }\n                        }\n                    );\n                }\n            }\n        );\n    });\n    $(document).on('click', '#dialog-user-temporary-code-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-temporary-code').addClass('hidden');\n    });\n\n\n    /**\n    * NEW LDAP USER HAS TO BUILD THE ITEMS DATABASE\n     */\n    $(document).on('click', '#dialog-ldap-user-build-keys-database-do', function() {\n        if ($('#dialog-ldap-user-build-keys-database-code').val() === '') {\n\n            return false;\n        }\n        // Perform a renecryption based upon a temporary code\n        console.log('Building items keys database for new LDAP user');\n\n        // Show progress\n        $('#dialog-ldap-user-build-keys-database-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n        \n        // Disable buttons\n        $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').attr('disabled', 'disabled');            \n        \n        // Start by testing if the temporary code is correct to decrypt an item\n        data = {\n            'user_id': store.get('teampassUser').user_id,\n            'password' : $('#dialog-ldap-user-build-keys-database-code').val(),\n        }\n        if (debugJavascript === true) {\n            console.log('Testing if temporary code is correct in LDAP user case');\n            console.log(data);\n        }\n\n        $.post(\n            'sources/main.queries.php', {\n                type: 'test_current_user_password_is_correct',\n                type_category: 'action_password',\n                data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) console.log(data);\n\n                if (data.error !== false) {\n                    // Show error\n                    toastr.remove();\n                    toastr.error(\n                        data.message,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n\n                    $(\"#dialog-ldap-user-build-keys-database-progress\").html('<?php echo langHdl('bad_code'); ?>');\n\n                    // Enable buttons\n                    $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                } else {\n                    // Change privatekey encryption with user-s password\n                    data = {\n                        'user_id': store.get('teampassUser').user_id,\n                        'current_code': $('#dialog-ldap-user-build-keys-database-code').val(),\n                        'new_code': '',\n                        'action_type' : '',\n                    }\n                    if (debugJavascript === true) console.log(data);\n                    \n                    $.post(\n                        'sources/main.queries.php', {\n                            type: 'change_private_key_encryption_password',\n                            type_category: 'action_key',\n                            data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                            key: \"<?php echo $_SESSION['key']; ?>\"\n                        },\n                        function(data) {\n                            data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                            if (debugJavascript === true) console.log(data);\n\n                            if (data.error !== false) {\n                                // Show error\n                                toastr.remove();\n                                toastr.error(\n                                    data.message,\n                                    '<?php echo langHdl('caution'); ?>', {\n                                        timeOut: 5000,\n                                        progressBar: true\n                                    }\n                                );\n\n                                \n                                $(\"#dialog-ldap-user-build-keys-database-progress\").html('<i class=\"fa-solid fa-exclamation-circle text-danger mr-3\"></i><?php echo langHdl('bad_code'); ?>');\n\n                                // Enable buttons\n                                $('#dialog-ldap-user-build-keys-database-do, #dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                            } else {\n                                // Inform user\n                                // Enable close button\n                                $('#dialog-ldap-user-build-keys-database-close').removeAttr('disabled');\n                                $('#dialog-ldap-user-build-keys-database-do').attr('disabled', 'disabled');\n\n                                // Finished\n                                $(\"#dialog-ldap-user-build-keys-database-progress\").html('<i class=\"fa-solid fa-check text-success mr-3\"></i><?php echo langHdl('done'); ?>');\n                                toastr.remove();\n\n                                store.update(\n                                    'teampassUser', {},\n                                    function(teampassUser) {\n                                        teampassUser.special = 'none';\n                                        teampassUser.otp_provided = 1;\n                                    }\n                                );\n\n                                // refresh the page\n                                window.location.href = 'index.php?page=items';\n                            }\n                        }\n                    );\n                }\n            }\n        );\n    });\n    $(document).on('click', '#dialog-user-temporary-code-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-user-temporary-code').addClass('hidden');\n    });\n\n\n    /**\n    * USER PASSWORD IN LDAP HAS CHANGED\n    */\n    $(document).on('click', '#dialog-ldap-user-change-password-do', function() {\n        // Start by changing the user password and send it by email\n        if ($('#dialog-ldap-user-change-password-old').val() !== \"\" && $('#dialog-ldap-user-change-password-current').val() !== \"\") {\n            // Case where a user is changing his authentication password\n            console.log('Reencryption based upon user auth password changed in LDAP');\n\n            // Show progress\n            $('#dialog-ldap-user-change-password-progress').html('<b><?php echo langHdl('please_wait'); ?></b><i class=\"fa-solid fa-spinner fa-pulse ml-3 text-primary\"></i>');\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n            \n            // Disable buttons\n            $('#dialog-ldap-user-change-password-do, #dialog-ldap-user-change-password-close').attr('disabled', 'disabled');\n            \n            data = {\n                'user_id': store.get('teampassUser').user_id,\n                'previous_password': $('#dialog-ldap-user-change-password-old').val(),\n                'current_password': $('#dialog-ldap-user-change-password-current').val(),\n            }\n            if (debugJavascript === true) console.log(data);\n\n            // Check user current password\n            // and change the password\n            // and use the password to re-encrypt the privatekey\n            $.post(\n                'sources/main.queries.php', {\n                    type: 'change_user_ldap_auth_password',\n                    type_category: 'action_password',\n                    data: prepareExchangedData(JSON.stringify(data), \"encode\", \"<?php echo $_SESSION['key']; ?>\"),\n                    key: \"<?php echo $_SESSION['key']; ?>\"\n                },\n                function(data) {\n                    data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n                    if (debugJavascript === true) console.log(data);\n\n                    if (data.error !== false) {\n                        // Show error\n                        toastr.remove();\n                        toastr.error(\n                            data.message,\n                            '<?php echo langHdl('caution'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n\n                        $(\"#dialog-ldap-user-change-password-progress\").html('<?php echo langHdl('fill_in_fields_and_hit_launch'); ?>');\n\n                        // Enable buttons\n                        $('#dialog-ldap-user-change-password-do, #dialog-ldap-user-change-password-close').removeAttr('disabled');\n                    } else {\n                        // SUCCESS\n                        $('#dialog-ldap-user-change-password-close').removeAttr('disabled');\n                        toastr.remove();\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('success'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                        $(\"#dialog-ldap-user-change-password-progress\").html('');\n                    }\n                }\n            );\n        } else {\n            // Show error\n            toastr.remove();\n            toastr.error(\n                '<?php echo langHdl('password_cannot_be_empty'); ?>',\n                '<?php echo langHdl('caution'); ?>', {\n                    timeOut: 5000,\n                    progressBar: true\n                }\n            );\n        }\n    });\n    $(document).on('click', '#dialog-ldap-user-change-password-close', function() {\n        // HIde\n        $('.content-header, .content').removeClass('hidden');\n\n        // SHow form\n        $('#dialog-ldap-user-change-password, #dialog-ldap-user-change-password-info').addClass('hidden');\n    });\n    // --- END ---\n\n\n    function loadSettings() {\n        return $.post(\n            \"sources/main.queries.php\", {\n                type: \"get_teampass_settings\",\n                type_category: 'action_system',\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                try {\n                    data = prepareExchangedData(\n                        data,\n                        \"decode\",\n                        \"<?php echo $_SESSION['key']; ?>\"\n                    );\n                } catch (e) {\n                    // error\n                    toastr.remove();\n                    toastr.error(\n                        '<?php echo langHdl('server_answer_error'); ?>',\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true,\n                            positionClass: \"toast-top-right\"\n                        }\n                    );\n                    return false;\n                }\n                if (debugJavascript === true) {\n                    console.log('Loading settings result:');\n                    console.log(data);\n                }\n\n                // Test if JSON object\n                if (typeof data === 'object') {\n                    // Store settings in localstorage\n                    // except sensitive data\n                    var sensitiveData = ['ldap_hosts','ldap_username','ldap_password','ldap_bdn', 'email','bck_script_passkey'];\n\n                    store.remove(\"teampassSettings\");\n\n                    store.update(\n                        'teampassSettings', {},\n                        function(teampassSettings) {\n                            $.each(data, function(key, value) {\n                                const containsKey = sensitiveData.some(element => {\n                                    if (key.includes(element)) {\n                                        return true;\n                                    }\n                                    return false;\n                                });\n\n                                if (containsKey === false) {\n                                    teampassSettings[key] = value;\n                                }\n                            });\n                        }\n                    );\n\n                    // Store some User info\n                    store.update(\n                        'teampassUser', {},\n                        function(teampassUser) {\n                            teampassUser['user_admin'] = <?php echo isset($_SESSION['user_admin']) === true ? (int) $_SESSION['user_admin'] : 0; ?>;\n                            teampassUser['user_id'] = <?php echo isset($_SESSION['user_id']) === true ? (int) $_SESSION['user_id'] : 0; ?>;\n                            teampassUser['user_manager'] = <?php echo isset($_SESSION['user_manager']) === true ? (int) $_SESSION['user_manager'] : 0; ?>;\n                            teampassUser['user_can_manage_all_users'] = <?php echo isset($_SESSION['user_can_manage_all_users']) === true ? (int) $_SESSION['user_can_manage_all_users'] : 0; ?>;\n                            teampassUser['user_read_only'] = <?php echo isset($_SESSION['user_admin']) === true ? (int) $_SESSION['user_read_only'] : 1; ?>;\n                            teampassUser['key'] = '<?php echo isset($_SESSION['key']) === true ? $_SESSION['key'] : 0; ?>';\n                            teampassUser['login'] = \"<?php echo isset($_SESSION['login']) === true ? $_SESSION['login'] : 0; ?>\";\n                            teampassUser['lastname'] = \"<?php echo isset($_SESSION['lastname']) === true ? $_SESSION['lastname'] : 0; ?>\";\n                            teampassUser['name'] = \"<?php echo isset($_SESSION['name']) === true ? $_SESSION['name'] : 0; ?>\";\n                            teampassUser['pskDefinedInDatabase'] = <?php echo isset($_SESSION['user']['encrypted_psk']) === true ? 1 : 0; ?>;\n                            teampassUser['can_create_root_folder'] = <?php echo isset($_SESSION['can_create_root_folder']) === true ? (int) $_SESSION['can_create_root_folder'] : 0; ?>;\n                            teampassUser['pskDefinedInDatabase'] = <?php echo isset($_SESSION['user']['encrypted_psk']) === true ? 1 : 0; ?>;\n                            teampassUser['special'] = '<?php echo isset($_SESSION['user']['special']) === true ? $_SESSION['user']['special'] : 'none'; ?>';\n                        }\n                    );\n                }\n            }\n        );\n    }\n\n    /**\n     * Undocumented function\n     *\n     * @return void\n     */\n    function showExtendSession() {\n        // Prepare modal\n        showModalDialogBox(\n            '#warningModal',\n            '<i class=\"fa-solid fa-clock fa-lg warning mr-2\"></i><?php echo langHdl('index_add_one_hour'); ?>',\n            '<div class=\"form-group\">' +\n            '<label for=\"warningModal-input\" class=\"col-form-label\"><?php echo langHdl('index_session_duration') . ' (' . langHdl('minutes') . ')'; ?>:</label>' +\n            '<input type=\"text\" class=\"form-control\" id=\"warningModal-input\" value=\"<?php echo isset($_SESSION['user']['session_duration']) === true ? (int) $_SESSION['user']['session_duration'] / 60 : 60; ?>\">' +\n            '</div>',\n            '<?php echo langHdl('confirm'); ?>',\n            '<?php echo langHdl('cancel'); ?>'\n        );\n\n        // Actions on modal buttons\n        $(document).on('click', '#warningModalButtonAction', function() {\n            // SHow user\n            toastr.remove();\n            toastr.info(\n                '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n            );\n\n            // Perform action\n            $.when(\n                IncreaseSessionTime(\n                    fieldDomPurifierWithWarning('#warningModal-input')\n                )\n            ).then(function() {\n                toastr.remove();\n                toastr.success(\n                    '<?php echo langHdl('done'); ?>',\n                    '', {\n                        timeOut: 1000\n                    }\n                );\n                $('#warningModal').modal('hide');\n            });\n        });\n    }\n\n    /**\n     * Undocumented function\n     *\n     * @return void\n     */\n    function showPersonalSKDialog() {\n        $('#dialog-request-psk').removeClass('hidden');\n\n        // Hide other\n        $('.content-header, .content').addClass('hidden');\n\n        $('#user_personal_saltkey').focus();\n\n        toastr.remove();\n    }\n\n    /**\n     * Loads the last seen items\n     *\n     * @return void\n     */\n    function refreshListLastSeenItems() {\n        $.post(\n            \"sources/main.queries.php\", {\n                type: 'refresh_list_items_seen',\n                type_category: 'action_user',\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                try {\n                    data = $.parseJSON(data)\n                } catch (e) {\n                    return false;\n                }\n                if (debugJavascript === true) {\n                    console.log('Refresh last item seen result');\n                    console.log(data);\n                }\n                //check if format error\n                if (data.error === '') {\n                    if (data.html_json === null || data.html_json === '') {\n                        $('#index-last-pwds').html('<li><?php echo langHdl('none'); ?></li>');\n                    } else {\n                        // Prepare HTML\n                        var html_list = '';\n                        $.each(data.html_json, function(i, value) {\n                            html_list += '<li onclick=\"showItemCard($(this).closest(\\'li\\'))\" class=\"pointer\" data-item-edition=\"0\" data-item-id=\"' + value.id + '\" data-item-sk=\"' + value.perso + '\" data-item-expired=\"0\" data-item-restricted=\"' + value.restricted + '\" data-item-display=\"1\" data-item-open-edit=\"0\" data-item-reload=\"0\" data-item-tree-id=\"' + value.tree_id + '\" data-is-search-result=\"0\">' +\n                                '<i class=\"fa fa-caret-right mr-2\"></i>' + value.label + '</li>';\n                        });\n                        $('#index-last-pwds').html(html_list);\n                    }\n\n                    // show notification\n                    if (data.existing_suggestions !== 0) {\n                        blink('#menu_button_suggestion', -1, 500, 'ui-state-error');\n                    }\n                } else {\n                    toastr.remove();\n                    toastr.error(\n                        data.error,\n                        '<?php echo langHdl('caution'); ?>', {\n                            timeOut: 5000,\n                            progressBar: true\n                        }\n                    );\n                }\n            }\n        );\n    }\n\n    /**\n     * Show an item\n     *\n     * @return void\n     */\n    function showItemCard(itemDefinition) {\n        // Show circle-notch\n        toastr.remove();\n        toastr.info(\n            '<?php echo langHdl('in_progress'); ?><i class=\"fa-solid fa-circle-notch fa-spin fa-2x ml-3\"></i>'\n        );\n\n        if (window.location.href.indexOf('page=items') === -1) {\n            location.replace('<?php echo $SETTINGS['cpassman_url']; ?>/index.php?page=items&group=' + itemDefinition.data().itemTreeId + '&id=' + itemDefinition.data().itemId);\n        } else {\n            $('#items_list').html('<ul class=\"liste_items\" id=\"full_items_list\"></ul>');\n            Details(itemDefinition, 'show');\n            if (itemDefinition.data().itemTreeId !== $('#open_folder').val()) {\n                ListerItems(itemDefinition.data().itemTreeId, '', 0);\n            }\n\n            // Hide sidebar-mini\n            $('body')\n                .removeClass('control-sidebar-slide-open');\n        }\n    }\n\n    /**\n     * Open defect report page\n     *\n     * @return void\n     */\n    function generateBugReport() {\n        $('#dialog-bug-report-text').html('');\n        $('#dialog-bug-report').removeClass('hidden');\n\n        // Scroll to top\n        $(window).scrollTop(0);\n\n        var data = {\n            'browser_name': platform.name,\n            'browser_version': platform.version,\n            'os': platform.os.family,\n            'os_archi': platform.os.architecture,\n            'current_page': window.location.href.substring(window.location.href.lastIndexOf(\"/\")+1),\n        }\n        \n        $.post(\n            \"sources/main.queries.php\", {\n                type: 'generate_bug_report',\n                type_category: 'action_system',\n                data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                key: '<?php echo $_SESSION['key']; ?>'\n            },\n            function(data) {\n                data = prepareExchangedData(data, 'decode', '<?php echo $_SESSION['key']; ?>');\n\n                // Show data\n                $('#dialog-bug-report-text').html(data.html);\n\n                // Open Github\n                $('#dialog-bug-report-github-button').click(function() {\n                    window.open('https://github.com/nilsteampassnet/TeamPass/issues/new', '_blank');\n                    return false;\n                });\n            }\n        );\n    }\n\n    // This permits to manage the column width of tree/items\n    $(document).on('click', '.columns-position', function() {\n        var colLeft = $('#folders-tree-card').find('.column-left'),\n            colRight = $('#folders-tree-card').find('.column-right'),\n            counterLeft = $(colLeft).attr(\"class\").match(/col-md-[\\w-]*\\b/)[0].split('-')[2],\n            counterRight = $(colRight).attr(\"class\").match(/col-md-[\\w-]*\\b/)[0].split('-')[2];\n\n        // Toogle class\n        if ($('#folders-tree-card').hasClass('hidden') === false) {\n            if ($(this).hasClass('tree-decrease') === true && counterRight < 9) {\n                $(colLeft).toggleClass('col-md-' + counterLeft + ' col-md-' + (parseInt(counterLeft) - 1));\n                $(colRight).toggleClass('col-md-' + counterRight + ' col-md-' + (parseInt(counterRight) + 1));\n            } else if ($(this).hasClass('tree-increase') === true && counterLeft < 9) {\n                $(colLeft).toggleClass('col-md-' + counterLeft + ' col-md-' + (parseInt(counterLeft) + 1));\n                $(colRight).toggleClass('col-md-' + counterRight + ' col-md-' + (parseInt(counterRight) - 1));\n            }\n        }\n    })\n\n    $(function() {\n        // In case that session was expired and login form was reloaded\n        // Force the launchIdentify as if the user has clicked the button\n        if ($(\"#auto_log\").length > 0) {\n            $(\"#but_identify_user\").click();\n        }\n    });\n\n    // Prevent usage of browser back button\n    history.pushState(null, null, location.href);\n    window.onpopstate = function () {\n        const queryString = window.location.search\n        const urlParams = new URLSearchParams(queryString);\n        if (urlParams.get('page') === 'items') {\n            // go back to list\n            // Play with show and hide classes\n            $('.form-item, .form-item-action, .form-folder-action, .item-details-card, .columns-position, #item-details-card-categories, #form-item-upload-pickfilesList, #card-item-expired')\n                .addClass('hidden');\n            $('#folders-tree-card').removeClass('hidden');\n\n            history.go(1);\n        }\n    };\n\n    /**\n     * \n     * @param {integer} duration\n     * \n     */\n    function clearClipboardTimeout(duration) {\n        // Wait for duration\n        $(this).delay(duration * 1000).queue(function() {\n            navigator.clipboard.writeText(\"Cleared by Teampass\").then(function() {\n                // clipboard successfully set\n            }, function() {\n                // clipboard write failed\n            });\n\n            $(this).dequeue();\n        });\n    }    \n    \n    /**\n     * Perform call to get progress status\n     * \n     * @param {integer} userId\n     */\n    function getGenerateKeysProgress(userId) {\n        var data = {\n            'user_id': userId,\n        };\n\n        $.post(\n            \"sources/users.queries.php\", {\n                type: \"get_generate_keys_progress\",\n                data: prepareExchangedData(JSON.stringify(data), 'encode', '<?php echo $_SESSION['key']; ?>'),\n                key: \"<?php echo $_SESSION['key']; ?>\"\n            },\n            function(data) {\n                //decrypt data\n                data = decodeQueryReturn(data, '<?php echo $_SESSION['key']; ?>');\n                if (debugJavascript === true) {\n                    console.info('Process generation keys status:');\n                    console.log(data);\n                }\n\n                if (data.error === false) {\n                    // Show progress\n                    $('#user_not_ready_progress')\n                        .text('(' + data.status + ')')\n                        .addClass('ml-1');\n                    $('#user_not_ready').removeClass('hidden');\n\n                    if (data.status !== 'finished') {\n                        // If not finished, then run again after 10 seconds\n                        setTimeout(\n                            getGenerateKeysProgress,\n                            10000,\n                            store.get('teampassUser').user_id\n                        );\n                    } else {\n                        // Progress is finished\n                        // We need to finalize user public/private keys\n                        \n                        $('#user_not_ready').addClass('hidden');\n                        $(\"#warningModalButtonAction\").removeClass('hidden');\n                        $('#user_not_ready_progress').html('');\n                        toastr.success(\n                            data.message,\n                            '<?php echo langHdl('done'); ?>', {\n                                timeOut: 5000,\n                                progressBar: true\n                            }\n                        );\n                    }\n                }\n            }\n        );\n    }\n</script>\n", "<?php\n\ndeclare(strict_types=1);\n\n/**\n * Teampass - a collaborative passwords manager.\n * ---\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * ---\n *\n * @project   Teampass\n * @file      options.php\n * ---\n *\n * @author    Nils Laumaill\u00e9 (nils@teampass.net)\n *\n * @copyright 2009-2023 Teampass.net\n *\n * @license   https://spdx.org/licenses/GPL-3.0-only.html#licenseText GPL-3.0\n * ---\n *\n * @see       https://www.teampass.net\n */\n\nif (\n    isset($_SESSION['CPM']) === false || $_SESSION['CPM'] !== 1\n    || isset($_SESSION['user_id']) === false || empty($_SESSION['user_id']) === true\n    || isset($_SESSION['key']) === false || empty($_SESSION['key']) === true\n) {\n    die('Hacking attempt...');\n}\n\n// Load config\nif (file_exists('../includes/config/tp.config.php') === true) {\n    include_once '../includes/config/tp.config.php';\n} elseif (file_exists('./includes/config/tp.config.php') === true) {\n    include_once './includes/config/tp.config.php';\n} else {\n    throw new Exception('Error file \"/includes/config/tp.config.php\" not exists', 1);\n}\n\n/* do checks */\nrequire_once $SETTINGS['cpassman_dir'] . '/sources/checks.php';\nif (checkUser($_SESSION['user_id'], $_SESSION['key'], 'admin', $SETTINGS) === false) {\n    $_SESSION['error']['code'] = ERR_NOT_ALLOWED;\n    include $SETTINGS['cpassman_dir'] . '/error.php';\n    exit;\n}\n\n// Load template\nrequire_once $SETTINGS['cpassman_dir'] . '/sources/main.functions.php';\n// Generates zones\n$zones = timezone_list();\n?>\n\n<!-- Content Header (Page header) -->\n<div class='content-header'>\n    <div class='container-fluid'>\n        <div class='row mb-2'>\n            <div class='col-sm-6'>\n                <h1 class='m-0 text-dark'><?php echo langHdl('options'); ?></h1>\n            </div><!-- /.col -->\n            <div class='col-sm-6 text-right'>\n                <div class=\"input-group input-group-sm\">\n                    <input type=\"text\" class=\"form-control\" placeholder=\"<?php echo langHdl('find'); ?>\" id=\"find-options\">\n                    <div class=\"input-group-append\">\n                        <div class=\"btn btn-primary\" id=\"button-find-options\">\n                            <i class=\"fas fa-search\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div><!-- /.col -->\n        </div><!-- /.row -->\n    </div><!-- /.container-fluid -->\n</div>\n<!-- /.content-header -->\n\n\n<!-- Main content -->\n<div class='content'>\n    <div class='container-fluid'>\n        <div class='row'>\n            <div class='col-md-6'>\n                <div class='card card-primary'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- form start -->\n                    <form role='form-horizontal'>\n                        <div class='card-body'>\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='cpassman_dir' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_cpassman_dir'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='cpassman_dir' value='<?php echo isset($SETTINGS['cpassman_dir']) === true ? $SETTINGS['cpassman_dir'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='cpassman_url' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_cpassman_url'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='cpassman_url' value='<?php echo isset($SETTINGS['cpassman_url']) === true ? $SETTINGS['cpassman_url'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='path_to_upload_folder' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_path_to_upload_folder'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='path_to_upload_folder' value='<?php echo isset($SETTINGS['path_to_upload_folder']) === true ? $SETTINGS['path_to_upload_folder'] : ''; ?>'>\n                                    <small id='passwordHelpBlock' class='form-text text-muted'>\n                                        <?php echo langHdl('admin_path_to_upload_folder_tip'); ?>\n                                    </small>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='path_to_files_folder' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_path_to_files_folder'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='path_to_files_folder' value='<?php echo isset($SETTINGS['path_to_files_folder']) === true ? $SETTINGS['path_to_files_folder'] : ''; ?>'>\n                                    <small id='passwordHelpBlock' class='form-text text-muted'>\n                                        <?php echo langHdl('admin_path_to_files_folder_tip'); ?>\n                                    </small>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='favicon' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_favicon'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='favicon' value='<?php echo isset($SETTINGS['favicon']) === true ? $SETTINGS['favicon'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='custom_logo' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_custom_logo'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='custom_logo' value='<?php echo isset($SETTINGS['custom_logo']) === true ? $SETTINGS['custom_logo'] : ''; ?>'>\n                                </div>\n                            </div>\n\n                            <div class='form-group option' data-keywords=\"server setting\">\n                                <label for='custom_login_text' class='col-sm-10 control-label'>\n                                    <?php echo langHdl('admin_misc_custom_login_text'); ?>\n                                </label>\n                                <div class='col-sm-12'>\n                                    <input type='text' class='form-control form-control-sm' id='custom_login_text' value='<?php echo isset($SETTINGS['custom_login_text']) === true ? $SETTINGS['custom_login_text'] : ''; ?>'>\n                                </div>\n                            </div>\n                        </div>\n                        <!-- /.card-body -->\n                    </form>\n                </div>\n                <!-- /.card -->\n\n                <div class='card card-primary'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- form start -->\n                    <div class='card-body'>\n                        <div class='row mb-2 option' data-keywords=\"setting maintenance mode\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_maintenance_mode'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='maintenance_mode' data-toggle-on='<?php echo isset($SETTINGS['maintenance_mode']) && (int) $SETTINGS['maintenance_mode'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='maintenance_mode_input' value='<?php echo isset($SETTINGS['maintenance_mode']) && (int) $SETTINGS['maintenance_mode'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting session expiration time\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_default_session_expiration_time'); ?>\n                            </div>\n                            <div class='col-2 mb-2'>\n                                <input type='number' class='form-control form-control-sm' id='default_session_expiration_time' value='<?php echo $SETTINGS['default_session_expiration_time'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting \">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_http_request_login'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_http_request_login' data-toggle-on='<?php echo isset($SETTINGS['enable_http_request_login']) && (int) $SETTINGS['enable_http_request_login'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_http_request_login_input' value='<?php echo isset($SETTINGS['enable_http_request_login']) && (int) $SETTINGS['enable_http_request_login'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting strict hsts sts\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_enable_sts'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_enable_sts_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_sts' data-toggle-on='<?php echo isset($SETTINGS['enable_sts']) && (int) $SETTINGS['enable_sts'] === 1 ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_sts_input' value='<?php echo isset($SETTINGS['enable_sts']) && (int) $SETTINGS['enable_sts'] === 1 ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting proxy ip\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_proxy_ip'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_proxy_ip_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='proxy_ip' value='<?php echo $SETTINGS['proxy_ip'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"server setting proxy port\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_proxy_port'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_proxy_port_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='proxy_port' value='<?php echo $SETTINGS['proxy_port'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting login length password\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_pwd_maximum_length'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('admin_pwd_maximum_length_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='pwd_maximum_length' value='<?php echo $SETTINGS['pwd_maximum_length'] ?? '60'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting time date\">\n                            <div class='col-4'>\n                                <?php echo langHdl('timezone_selection'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='timezone'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <?php\n                                    // get list of all timezones\n                                    foreach ($zones as $key => $zone) {\n                                        echo '\n                                <option value=\"' . $key . '\"', isset($SETTINGS['timezone']) === true && $SETTINGS['timezone'] === $key ? ' selected' : '', '>' . $zone . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting date format\">\n                            <div class='col-4'>\n                                <?php echo langHdl('date_format'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='date_format'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <option value=\"d/m/Y\" <?php echo isset($SETTINGS['date_format']) === false || $SETTINGS['date_format'] === 'd/m/Y' ? ' selected' : ''; ?>>d/m/Y</option>\n                                    <option value=\"m/d/Y\" <?php echo $SETTINGS['date_format'] === 'm/d/Y' ? ' selected' : ''; ?>>m/d/Y</option>\n                                    <option value=\"d-M-Y\" <?php echo $SETTINGS['date_format'] === 'd-M-Y' ? ' selected' : ''; ?>>d-M-Y</option>\n                                    <option value=\"d/m/y\" <?php echo $SETTINGS['date_format'] === 'd/m/y' ? ' selected' : ''; ?>>d/m/y</option>\n                                    <option value=\"m/d/y\" <?php echo $SETTINGS['date_format'] === 'm/d/y' ? ' selected' : ''; ?>>m/d/y</option>\n                                    <option value=\"d-M-y\" <?php echo $SETTINGS['date_format'] === 'd-M-y' ? ' selected' : ''; ?>>d-M-y</option>\n                                    <option value=\"d-m-y\" <?php echo $SETTINGS['date_format'] === 'd-m-y' ? ' selected' : ''; ?>>d-m-y</option>\n                                    <option value=\"Y-m-d\" <?php echo $SETTINGS['date_format'] === 'Y-m-d' ? ' selected' : ''; ?>>Y-m-d</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting time format\">\n                            <div class='col-4'>\n                                <?php echo langHdl('time_format'); ?>\n                            </div>\n                            <div class='col-8'>\n                                <select class='form-control form-control-sm' id='time_format'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <option value=\"H:i:s\" <?php echo isset($SETTINGS['time_format']) === false || $SETTINGS['time_format'] === 'H:i:s' ? ' selected' : ''; ?>>H:i:s</option>\n                                    <option value=\"H:i:s a\" <?php echo $SETTINGS['time_format'] === 'H:i:s a' ? ' selected' : ''; ?>>H:i:s a</option>\n                                    <option value=\"g:i:s a\" <?php echo $SETTINGS['time_format'] === 'g:i:s a' ? ' selected' : ''; ?>>g:i:s a</option>\n                                    <option value=\"G:i:s\" <?php echo $SETTINGS['time_format'] === 'G:i:s' ? ' selected' : ''; ?>>G:i:s</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"user ui setting language\">\n                            <div class='col-8'>\n                                <?php echo langHdl('settings_default_language'); ?>\n                            </div>\n                            <div class='col-4'>\n                                <select class='form-control form-control-sm' id='default_language'>\n                                    <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                    <?php\n                                    foreach ($languagesList as $lang) {\n                                        echo '\n                                <option value=\"' . $lang . '\"', isset($SETTINGS['default_language']) === true && $SETTINGS['default_language'] === $lang ? ' selected' : '', '>' . $lang . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <!--\n                    <div class='row mb-2 option'>\n                        <div class='col-10'>\n                            <?php echo langHdl('number_of_used_pw'); ?>\n                        </div>\n                        <div class='col-2'>\n                            <input type='text' class='form-control form-control-sm' id='number_of_used_pw' value='<?php echo $SETTINGS['number_of_used_pw'] ?? '5'; ?>'>\n                        </div>\n                    </div>\n                    -->\n\n                        <div class='row mb-2 option' data-keywords=\"user login password duration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('pw_life_duration'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='pw_life_duration' value='<?php echo $SETTINGS['pw_life_duration'] ?? '5'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"log user login password security\">\n                            <div class='col-10'>\n                                <?php echo langHdl('nb_false_login_attempts'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='nb_bad_authentication' value='<?php echo $SETTINGS['nb_bad_authentication'] ?? '0'; ?>'>\n                            </div>\n                        </div>\n\n                        <!--\n                        <div class='row mb-2 option' data-keywords=\"log user login\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_log_connections'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='log_connections' data-toggle-on='<?php echo isset($SETTINGS['log_connections']) === true && $SETTINGS['log_connections'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='log_connections_input' value='<?php echo isset($SETTINGS['log_connections']) && $SETTINGS['log_connections'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n                        -->\n\n                        <div class='row mb-2 option' data-keywords=\"log item password log security\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_log_accessed'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='log_accessed' data-toggle-on='<?php echo isset($SETTINGS['log_accessed']) === true && $SETTINGS['log_accessed'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='log_accessed_input' value='<?php echo isset($SETTINGS['log_accessed']) && $SETTINGS['log_accessed'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder personal user\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_personal_folder_feature'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('enable_personal_folder_feature_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_pf_feature' data-toggle-on='<?php echo isset($SETTINGS['enable_pf_feature']) === true && $SETTINGS['enable_pf_feature'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_pf_feature_input' value='<?php echo isset($SETTINGS['enable_pf_feature']) && $SETTINGS['enable_pf_feature'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <!--\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('enable_personal_saltkey_cookie'); ?>\n                      </div>\n                      <div class='col-2'>\n                          <div class='toggle toggle-modern' id='enable_personal_saltkey_cookie' data-toggle-on='<?php echo isset($SETTINGS['enable_personal_saltkey_cookie']) === true && $SETTINGS['enable_personal_saltkey_cookie'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_personal_saltkey_cookie_input' value='<?php echo isset($SETTINGS['enable_personal_saltkey_cookie']) && $SETTINGS['enable_personal_saltkey_cookie'] === '1' ? '1' : '0'; ?>' />\n                      </div>\n                  </div>\n\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('personal_saltkey_cookie_duration'); ?>\n                      </div>\n                      <div class='col-2'>\n                      <input type='text' class='form-control form-control-sm' id='personal_saltkey_cookie_duration' value='<?php echo $SETTINGS['personal_saltkey_cookie_duration'] ?? '31'; ?>'>\n                      </div>\n                  </div>\n\n                    <div class='row mb-2 option'>\n                        <div class='col-8'>\n                            <?php echo langHdl('personal_saltkey_security_level'); ?>\n                        </div>\n                        <div class='col-4'>\n                            <select class='form-control form-control-sm' id='personal_saltkey_security_level'>\n                                <option value=''>-- <?php echo langHdl('select'); ?> --</option>\n                                <?php\n                                foreach (TP_PW_COMPLEXITY as $complex) {\n                                    echo '\n                                <option value=\"' . $complex[0] . '\"', isset($SETTINGS['personal_saltkey_security_level']) === true && $SETTINGS['personal_saltkey_security_level'] === $complex[0] ? ' selected' : '', '>' . $complex[1] . '</option>';\n                                }\n                                ?>\n                            </select>\n                        </div>\n                    </div>\n\n                  <div class='row mb-2 option'>\n                      <div class='col-10'>\n                          <?php echo langHdl('settings_attachments_encryption'); ?>\n                          <small id='passwordHelpBlock' class='form-text text-muted'>\n                              <?php echo langHdl('settings_attachments_encryption_tip'); ?>\n                          </small>\n                      </div>\n                      <div class='col-2'>\n                          <div class='toggle toggle-modern' id='enable_attachment_encryption' data-toggle-on='<?php echo isset($SETTINGS['enable_attachment_encryption']) === true && $SETTINGS['enable_attachment_encryption'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_attachment_encryption_input' value='<?php echo isset($SETTINGS['enable_attachment_encryption']) && $SETTINGS['enable_attachment_encryption'] === '1' ? '1' : '0'; ?>' />\n                      </div>\n                  </div>\n                  -->\n\n                        <div class='row mb-2 option' data-keywords=\"image\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_secure_display_image'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_secure_display_image_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='secure_display_image' data-toggle-on='<?php echo isset($SETTINGS['secure_display_image']) === true && $SETTINGS['secure_display_image'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='secure_display_image_input' value='<?php echo isset($SETTINGS['secure_display_image']) && $SETTINGS['secure_display_image'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"option\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_kb'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_kb_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_kb' data-toggle-on='<?php echo isset($SETTINGS['enable_kb']) === true && $SETTINGS['enable_kb'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_kb_input' value='<?php echo isset($SETTINGS['enable_kb']) && $SETTINGS['enable_kb'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"option\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_suggestion'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_suggestion_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_suggestion' data-toggle-on='<?php echo isset($SETTINGS['enable_suggestion']) === true && $SETTINGS['enable_suggestion'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_suggestion_input' value='<?php echo isset($SETTINGS['enable_suggestion']) && $SETTINGS['enable_suggestion'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_get_tp_info'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_get_tp_info_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='get_tp_info' data-toggle-on='<?php echo isset($SETTINGS['get_tp_info']) === true && $SETTINGS['get_tp_info'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='get_tp_info_input' value='<?php echo isset($SETTINGS['get_tp_info']) && $SETTINGS['get_tp_info'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                    </div>\n                    <!-- /.card-body -->\n                </div>\n                <!-- /.card -->\n\n            </div>\n            <!-- /.col-md-6 -->\n            <!--/.col (left) -->\n            <!-- right column -->\n            <div class='col-md-6'>\n                <!-- Horizontal Form -->\n                <div class='card card-info'>\n                    <div class='card-header'>\n                        <h3 class='card-title'><?php echo langHdl('admin_settings_title'); ?></h3>\n                    </div>\n                    <!-- /.card-header -->\n                    <!-- card-body -->\n                    <div class='card-body'>\n                        <div class='row mb-2 option' data-keywords=\"item edit\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_delay_for_item_edition'); ?>\n                                <small id='passwordHelpBlock' class='form-text text-muted'>\n                                    <?php echo langHdl('settings_delay_for_item_edition_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='delay_item_edition' value='<?php echo $SETTINGS['delay_item_edition'] ?? '9'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"one time\">\n                            <div class='col-10'>\n                                <?php echo langHdl('otv_is_enabled'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='otv_is_enabled' data-toggle-on='<?php echo isset($SETTINGS['otv_is_enabled']) === true && $SETTINGS['otv_is_enabled'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='otv_is_enabled_input' value='<?php echo isset($SETTINGS['otv_is_enabled']) && $SETTINGS['otv_is_enabled'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"one time period expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_otv_expiration_period'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='otv_expiration_period' value='<?php echo $SETTINGS['otv_expiration_period'] ?? '7'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"right manager item\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_manager_edit'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='manager_edit' data-toggle-on='<?php echo isset($SETTINGS['manager_edit']) === true && $SETTINGS['manager_edit'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='manager_edit_input' value='<?php echo isset($SETTINGS['manager_edit']) && $SETTINGS['manager_edit'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"right manager move item\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_manager_move_item'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='manager_move_item' data-toggle-on='<?php echo isset($SETTINGS['manager_move_item']) === true && $SETTINGS['manager_move_item'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='manager_move_item_input' value='<?php echo isset($SETTINGS['manager_move_item']) && $SETTINGS['manager_move_item'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password last\">\n                            <div class='col-10'>\n                                <?php echo langHdl('max_last_items'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='max_last_items' value='<?php echo isset($SETTINGS['max_last_items']) === true ? $SETTINGS['max_last_items'] : '7'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"create duplicate folder\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='duplicate_folder' data-toggle-on='<?php echo isset($SETTINGS['duplicate_folder']) === true && $SETTINGS['duplicate_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='duplicate_folder_input' value='<?php echo isset($SETTINGS['duplicate_folder']) && $SETTINGS['duplicate_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password duplicate\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_item'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='duplicate_item' data-toggle-on='<?php echo isset($SETTINGS['duplicate_item']) === true && $SETTINGS['duplicate_item'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='duplicate_item_input' value='<?php echo isset($SETTINGS['duplicate_item']) && $SETTINGS['duplicate_item'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password duplicate folder\">\n                            <div class='col-10'>\n                                <?php echo langHdl('duplicate_item_in_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='item_duplicate_in_same_folder' data-toggle-on='<?php echo isset($SETTINGS['item_duplicate_in_same_folder']) === true && $SETTINGS['item_duplicate_in_same_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='item_duplicate_in_same_folder_input' value='<?php echo isset($SETTINGS['item_duplicate_in_same_folder']) && $SETTINGS['item_duplicate_in_same_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder display optimization hide\">\n                            <div class='col-10'>\n                                <?php echo langHdl('show_only_accessible_folders'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('show_only_accessible_folders_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='show_only_accessible_folders' data-toggle-on='<?php echo isset($SETTINGS['show_only_accessible_folders']) === true && $SETTINGS['show_only_accessible_folders'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='show_only_accessible_folders_input' value='<?php echo isset($SETTINGS['show_only_accessible_folders']) && $SETTINGS['show_only_accessible_folders'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('subfolder_rights_as_parent'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('subfolder_rights_as_parent_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='subfolder_rights_as_parent' data-toggle-on='<?php echo isset($SETTINGS['subfolder_rights_as_parent']) === true && $SETTINGS['subfolder_rights_as_parent'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='subfolder_rights_as_parent_input' value='<?php echo isset($SETTINGS['subfolder_rights_as_parent']) && $SETTINGS['subfolder_rights_as_parent'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('create_item_without_password'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='create_item_without_password' data-toggle-on='<?php echo isset($SETTINGS['create_item_without_password']) === true && $SETTINGS['create_item_without_password'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='create_item_without_password_input' value='<?php echo isset($SETTINGS['create_item_without_password']) && $SETTINGS['create_item_without_password'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"favorite\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_favourites'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_favourites' data-toggle-on='<?php echo isset($SETTINGS['enable_favourites']) === true && $SETTINGS['enable_favourites'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_favourites_input' value='<?php echo isset($SETTINGS['enable_favourites']) && $SETTINGS['enable_favourites'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_user_can_create_folders'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_user_can_create_folders' data-toggle-on='<?php echo isset($SETTINGS['enable_user_can_create_folders']) === true && $SETTINGS['enable_user_can_create_folders'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_user_can_create_folders_input' value='<?php echo isset($SETTINGS['enable_user_can_create_folders']) && $SETTINGS['enable_user_can_create_folders'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"folder creation\">\n                            <div class='col-10'>\n                                <?php echo langHdl('can_create_root_folder'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='can_create_root_folder' data-toggle-on='<?php echo isset($SETTINGS['can_create_root_folder']) === true && $SETTINGS['can_create_root_folder'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='can_create_root_folder_input' value='<?php echo isset($SETTINGS['can_create_root_folder']) && $SETTINGS['can_create_root_folder'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete massive\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_massive_move_delete'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('enable_massive_move_delete_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_massive_move_delete' data-toggle-on='<?php echo isset($SETTINGS['enable_massive_move_delete']) === true && $SETTINGS['enable_massive_move_delete'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_massive_move_delete_input' value='<?php echo isset($SETTINGS['enable_massive_move_delete']) && $SETTINGS['enable_massive_move_delete'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password display\">\n                            <div class='col-10'>\n                                <?php echo langHdl('password_overview_delay'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('password_overview_delay_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='password_overview_delay' value='<?php echo isset($SETTINGS['password_overview_delay']) === true ? $SETTINGS['password_overview_delay'] : '4'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete view expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_setting_activate_expiration'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('admin_setting_activate_expiration_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='activate_expiration' data-toggle-on='<?php echo isset($SETTINGS['activate_expiration']) === true && $SETTINGS['activate_expiration'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='activate_expiration_input' value='<?php echo isset($SETTINGS['activate_expiration']) && $SETTINGS['activate_expiration'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password delete view expiration\">\n                            <div class='col-10'>\n                                <?php echo langHdl('admin_setting_enable_delete_after_consultation'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('admin_setting_enable_delete_after_consultation_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_delete_after_consultation' data-toggle-on='<?php echo isset($SETTINGS['enable_delete_after_consultation']) === true && $SETTINGS['enable_delete_after_consultation'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_delete_after_consultation_input' value='<?php echo isset($SETTINGS['enable_delete_after_consultation']) && $SETTINGS['enable_delete_after_consultation'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"export print\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_printing'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_printing_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='allow_print' data-toggle-on='<?php echo isset($SETTINGS['allow_print']) === true && $SETTINGS['allow_print'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='allow_print_input' value='<?php echo isset($SETTINGS['allow_print']) && $SETTINGS['allow_print'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"export print\">\n                            <div class='col-6'>\n                                <?php echo langHdl('settings_roles_allowed_to_print'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_roles_allowed_to_print_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-6'>\n                                <select class='form-control form-control-sm select2 disabled' id='roles_allowed_to_print_select' onchange='' multiple=\"multiple\" style=\"width:100%;\">\n                                    <?php\n                                    // Get selected groups\n                                    if (isset($SETTINGS['allow_print']) === true) {\n                                        $arrRolesToPrint = json_decode($SETTINGS['roles_allowed_to_print_select'], true);\n                                        if ($arrRolesToPrint === 0 || empty($arrRolesToPrint) === true) {\n                                            $arrRolesToPrint = [];\n                                        }\n                                        // Get full list\n                                        $roles = performDBQuery(\n                                            $SETTINGS,\n                                            'id, title',\n                                            'roles_title'\n                                        );\n                                        foreach ($roles as $role) {\n                                            echo '\n                                <option value=\"' . $role['id'] . '\"', in_array($role['id'], $arrRolesToPrint) === true ? ' selected' : '', '>' . addslashes($role['title']) . '</option>';\n                                        }\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"import\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_importing'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='allow_import' data-toggle-on='<?php echo isset($SETTINGS['allow_import']) === true && $SETTINGS['allow_import'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='allow_import_input' value='<?php echo isset($SETTINGS['allow_import']) && $SETTINGS['allow_import'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"role restriction modify right\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_anyone_can_modify'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_anyone_can_modify_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='anyone_can_modify' data-toggle-on='<?php echo isset($SETTINGS['anyone_can_modify']) === true && $SETTINGS['anyone_can_modify'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='anyone_can_modify_input' value='<?php echo isset($SETTINGS['anyone_can_modify']) && $SETTINGS['anyone_can_modify'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option <?php echo isset($SETTINGS['anyone_can_modify']) === true && $SETTINGS['anyone_can_modify'] === '1' ? '' : 'hidden'; ?>' id=\"form-item-row-modify\" data-keywords=\"role restriction modify right\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_anyone_can_modify_bydefault'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='anyone_can_modify_bydefault' data-toggle-on='<?php echo isset($SETTINGS['anyone_can_modify_bydefault']) === true && $SETTINGS['anyone_can_modify_bydefault'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='anyone_can_modify_bydefault_input' value='<?php echo isset($SETTINGS['anyone_can_modify_bydefault']) && $SETTINGS['anyone_can_modify_bydefault'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"role restriction\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_restricted_to'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='restricted_to' data-toggle-on='<?php echo isset($SETTINGS['restricted_to']) === true && $SETTINGS['restricted_to'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='restricted_to_input' value='<?php echo isset($SETTINGS['restricted_to']) && $SETTINGS['restricted_to'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option <?php echo isset($SETTINGS['restricted_to']) === true && $SETTINGS['restricted_to'] === '1' ? '' : 'hidden'; ?>' id=\"form-item-row-restricted\" data-keywords=\"role restriction\">\n                            <div class='col-10'>\n                                <?php echo langHdl('restricted_to_roles'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='restricted_to_roles' data-toggle-on='<?php echo isset($SETTINGS['restricted_to_roles']) === true && $SETTINGS['restricted_to_roles'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='restricted_to_roles_input' value='<?php echo isset($SETTINGS['restricted_to_roles']) && $SETTINGS['restricted_to_roles'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization icon\">\n                            <div class='col-10'>\n                                <?php echo langHdl('copy_to_clipboard_small_icons'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('copy_to_clipboard_small_icons_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='copy_to_clipboard_small_icons' data-toggle-on='<?php echo isset($SETTINGS['copy_to_clipboard_small_icons']) === true && $SETTINGS['copy_to_clipboard_small_icons'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='copy_to_clipboard_small_icons_input' value='<?php echo isset($SETTINGS['copy_to_clipboard_small_icons']) && $SETTINGS['copy_to_clipboard_small_icons'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization icon clipboard\">\n                            <div class='col-10'>\n                                <?php echo langHdl('clipboard_password_life_duration'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('clipboard_password_life_duration_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='clipboard_life_duration' value='<?php echo isset($SETTINGS['clipboard_life_duration']) === true ? $SETTINGS['clipboard_life_duration'] : '30'; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"display optimization description\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_show_description'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='show_description' data-toggle-on='<?php echo isset($SETTINGS['show_description']) === true && $SETTINGS['show_description'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='show_description_input' value='<?php echo isset($SETTINGS['show_description']) && $SETTINGS['show_description'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n<?php\nif (isset($SETTINGS['show_description']) === true && $SETTINGS['show_description'] === '1') {\n    ?>\n                        <div class='row mb-2 option' data-keywords=\"display tree counter\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_tree_counters'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_tree_counters_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='tree_counters' data-toggle-on='<?php echo isset($SETTINGS['tree_counters']) === true && $SETTINGS['tree_counters'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='tree_counters_input' value='<?php echo isset($SETTINGS['tree_counters']) && $SETTINGS['tree_counters'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n<?php\n}\n?>\n                        <div class='row mb-2 option' data-keywords=\"query display optimization\">\n                            <div class='col-10'>\n                                <?php echo langHdl('nb_items_by_query'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('nb_items_by_query_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <input type='text' class='form-control form-control-sm' id='nb_items_by_query' value='<?php echo isset($SETTINGS['nb_items_by_query']) === true ? $SETTINGS['nb_items_by_query'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification login\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_send_email_on_user_login'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_send_email_on_user_login' data-toggle-on='<?php echo isset($SETTINGS['enable_send_email_on_user_login']) === true && $SETTINGS['enable_send_email_on_user_login'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_send_email_on_user_login_input' value='<?php echo isset($SETTINGS['enable_send_email_on_user_login']) && $SETTINGS['enable_send_email_on_user_login'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_email_notification_on_item_shown'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_email_notification_on_item_shown' data-toggle-on='<?php echo isset($SETTINGS['enable_email_notification_on_item_shown']) === true && $SETTINGS['enable_email_notification_on_item_shown'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_email_notification_on_item_shown_input' value='<?php echo isset($SETTINGS['enable_email_notification_on_item_shown']) && $SETTINGS['enable_email_notification_on_item_shown'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"email notification password change\">\n                            <div class='col-10'>\n                                <?php echo langHdl('enable_email_notification_on_user_pw_change'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='enable_email_notification_on_user_pw_change' data-toggle-on='<?php echo isset($SETTINGS['enable_email_notification_on_user_pw_change']) === true && $SETTINGS['enable_email_notification_on_user_pw_change'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_email_notification_on_user_pw_change_input' value='<?php echo isset($SETTINGS['enable_email_notification_on_user_pw_change']) && $SETTINGS['enable_email_notification_on_user_pw_change'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"history manual\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_insert_manual_entry_item_history'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_insert_manual_entry_item_history_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='insert_manual_entry_item_history' data-toggle-on='<?php echo isset($SETTINGS['insert_manual_entry_item_history']) === true && $SETTINGS['insert_manual_entry_item_history'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='insert_manual_entry_item_history_input' value='<?php echo isset($SETTINGS['insert_manual_entry_item_history']) && $SETTINGS['insert_manual_entry_item_history'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"offline export\">\n                            <div class='col-10'>\n                                <?php echo langHdl('settings_offline_mode'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('settings_offline_mode_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='settings_offline_mode' data-toggle-on='<?php echo isset($SETTINGS['settings_offline_mode']) === true && $SETTINGS['settings_offline_mode'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='settings_offline_mode_input' value='<?php echo isset($SETTINGS['settings_offline_mode']) && $SETTINGS['settings_offline_mode'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"offline\">\n                            <div class='col-7'>\n                                <?php echo langHdl('offline_mode_key_level'); ?>\n                            </div>\n                            <div class='col-5'>\n                                <select class='form-control form-control-sm' id='offline_key_level'>\n                                    <?php\n                                    foreach (TP_PW_COMPLEXITY as $complex) {\n                                        echo '\n                                <option value=\"' . $complex[0] . '\"', isset($SETTINGS['offline_key_level']) === true && $SETTINGS['offline_key_level'] === $complex[0] ? ' selected' : '', '>' . $complex[1] . '</option>';\n                                    }\n                                    ?>\n                                </select>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"syslog\">\n                            <div class='col-10'>\n                                <?php echo langHdl('syslog_enable'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern' id='syslog_enable' data-toggle-on='<?php echo isset($SETTINGS['syslog_enable']) === true && $SETTINGS['syslog_enable'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='syslog_enable_input' value='<?php echo isset($SETTINGS['syslog_enable']) && $SETTINGS['syslog_enable'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"syslog\">\n                            <div class='col-7'>\n                                <?php echo langHdl('syslog_host'); ?>\n                            </div>\n                            <div class='col-5'>\n                                <input type='text' class='form-control form-control-sm' id='syslog_host' value='<?php echo isset($SETTINGS['syslog_host']) === true ? $SETTINGS['syslog_host'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-5 option' data-keywords=\"syslog port\">\n                            <div class='col-10'>\n                                <?php echo langHdl('syslog_port'); ?>\n                            </div>\n                            <div class='col-2'>\n                                <input type='number' class='form-control form-control-sm' id='syslog_port' value='<?php echo isset($SETTINGS['syslog_port']) === true ? $SETTINGS['syslog_port'] : ''; ?>'>\n                            </div>\n                        </div>\n\n                        <div class='row mb-2 option' data-keywords=\"password server\">\n                            <div class='col-10'>\n                                <?php echo langHdl('server_password_change_enable'); ?>\n                                <small class='form-text text-muted'>\n                                    <?php echo langHdl('server_password_change_enable_tip'); ?>\n                                </small>\n                            </div>\n                            <div class='col-2'>\n                                <div class='toggle toggle-modern disabled' id='enable_server_password_change' data-toggle-on='<?php echo isset($SETTINGS['enable_server_password_change']) === true && $SETTINGS['enable_server_password_change'] === '1' ? 'true' : 'false'; ?>'></div><input type='hidden' id='enable_server_password_change_input' value='<?php echo isset($SETTINGS['enable_server_password_change']) && $SETTINGS['enable_server_password_change'] === '1' ? '1' : '0'; ?>' />\n                            </div>\n                        </div>\n\n                    </div>\n                    <!-- /.card-body -->\n                </div>\n                <!-- /.card -->\n            </div>\n            <!--/.col (right) -->\n        </div>\n        <!-- /.row -->\n    </div><!-- /.container-fluid -->\n</div>\n<!-- /.content -->\n"], "filenames": ["includes/core/load.js.php", "pages/options.php"], "buggy_code_start_loc": [1518, 189], "buggy_code_end_loc": [1519, 931], "fixing_code_start_loc": [1518, 189], "fixing_code_end_loc": [1519, 931], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Generic in GitHub repository nilsteampassnet/teampass prior to 3.0.10.", "other": {"cve": {"id": "CVE-2023-3565", "sourceIdentifier": "security@huntr.dev", "published": "2023-07-10T16:15:56.317", "lastModified": "2023-07-19T16:25:11.427", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Generic in GitHub repository nilsteampassnet/teampass prior to 3.0.10."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:R/S:U/C:H/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.2, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 0.9, "impactScore": 4.2}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:teampass:teampass:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.0.10", "matchCriteriaId": "6C3D28BC-A4B7-45E4-8B54-0F13DFB41437"}]}]}], "references": [{"url": "https://github.com/nilsteampassnet/teampass/commit/820bb49a362a566c9038e4a3048b26d654babb0e", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/fcf46e1f-2ab6-4057-9d25-cf493ab09530", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/nilsteampassnet/teampass/commit/820bb49a362a566c9038e4a3048b26d654babb0e"}}