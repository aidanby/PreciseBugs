{"buggy_code": ["<?php if (!count($aErrorFilesInfo) &&count($aImportedFilesInfo)): ?>\n<div class='side-body <?php echo getSideBodyClass(false); ?>'>\n    <div class=\"row welcome survey-action\">\n        <div class=\"col-sm-12 content-right\">\n            <div class=\"jumbotron message-box\">\n                <h2><?php eT(\"Import survey resources\"); ?></h2>\n                <p class=\"lead text-success\">\n                    <?php eT(\"Success\");?>\n                </p>\n                <p>\n                    <?php eT(\"Resources Import Summary\"); ?>\n                </p>\n                <p>\n                    <?php eT(\"Total Imported files\"); ?>: <?php echo count($aImportedFilesInfo); ?><br />\n                </p>\n                <p>\n                    <strong><?php eT(\"Imported Files List\") ?>:</strong>\n                </p>\n                <p>\n                    <ul>\n                        <?php\n                        foreach ($aImportedFilesInfo as $entry)\n                        {\n                            echo CHtml::tag('li', array(), gT(\"File\") . ': ' . $entry[\"filename\"]);\n                        }\n                        ?>\n                    </ul>\n                </p>\n                <p>\n                    <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                </p>\n            </div>\n        </div>\n    </div>\n</div>\n<?php elseif(count($aErrorFilesInfo) &&count($aImportedFilesInfo)): ?>\n    <div class='side-body <?php echo getSideBodyClass(false); ?>'>\n        <div class=\"row welcome survey-action\">\n            <div class=\"col-sm-12 content-right\">\n                <div class=\"jumbotron message-box message-box-warning\">\n                    <h2><?php eT(\"Import survey resources\"); ?></h2>\n                    <p class=\"lead text-warning\">\n                        <?php eT(\"Partial\");?>\n                    </p>\n                    <p>\n                        <?php eT(\"Resources Import Summary\"); ?>\n                    </p>\n                    <p>\n                        <?php eT(\"Total Imported files\"); ?>: <?php echo count($aImportedFilesInfo); ?><br />\n                        <?php eT(\"Total Errors\"); ?>: <?php echo count($aErrorFilesInfo); ?><br />\n                    </p>\n                    <p>\n                        <strong><?php eT(\"Imported Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <ul>\n                            <?php\n                            foreach ($aImportedFilesInfo as $entry)\n                            {\n                                echo CHtml::tag('li', array(), gT(\"File\") . ': ' . $entry[\"filename\"]);\n                            }\n                            ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <strong class=\"text-warning\"><?php eT(\"Error Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry)\n                            {\n                                echo CHtml::tag('li', array(), gT(\"File\") . ': ' . $entry['filename'] . \" (\" . $entry['status'] . \")\");\n                            }\n                        ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n<?php else:?>\n    <div class='side-body <?php echo getSideBodyClass(false); ?>'>\n        <div class=\"row welcome survey-action\">\n            <div class=\"col-sm-12 content-right\">\n                <div class=\"jumbotron message-box message-box-error\">\n                    <h2><?php eT(\"Import survey resources\"); ?></h2>\n                    <p class=\"lead text-danger\">\n                        <?php eT(\"Error\");?>\n                    </p>\n                    <p>\n                        <?php eT(\"Resources Import Summary\"); ?>\n                    </p>\n                    <p>\n                        <?php eT(\"Total Imported files\"); ?>: 0<br />\n                        <?php eT(\"Total Errors\"); ?>: <?php echo count($aErrorFilesInfo); ?><br />\n                    </p>\n                    <p>\n                        <strong class=\"text-warning\"><?php eT(\"Error Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry)\n                            {\n                                echo CHtml::tag('li', array(), gT(\"File\") . ': ' . $entry['filename'] . \" (\" . $entry['status'] . \")\");\n                            }\n                        ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n<?php endif; ?>\n", "<?php\n    // TODO : move all this to controller\n    $okfiles = 0;\n    $errfiles = 0;\n    if (count($aErrorFilesInfo) == 0 && count($aImportedFilesInfo) > 0)\n    {\n        $status = gT(\"Success\");\n        $class = '';\n        $statusClass = 'text-success';\n        $okfiles = count($aImportedFilesInfo);\n    }\n    elseif (count($aErrorFilesInfo) > 0 && count($aImportedFilesInfo) > 0)\n    {\n        $status = gT(\"Partial\");\n        $class = 'message-box-warning';\n        $statusClass = 'text-warning';\n        $okfiles = count($aImportedFilesInfo);\n        $errfiles = count($aErrorFilesInfo);\n    }\n    else\n    {\n        $status = gT(\"Error\");\n        $statusClass = 'text-error';\n        $class = 'message-box-error';\n        $errfiles = count($aErrorFilesInfo);\n    }\n?>\n<div class=\"row\">\n    <div class=\"col-sm-11 col-sm-offset-1 content-right\">\n        <!-- Message box from super admin -->\n        <div class=\"jumbotron message-box <?php echo $class;?>\">\n            <div class=\"h2\"><?php eT(\"Import theme result:\") ?></div>\n\n            <p class='lead <?php echo $statusClass;?>'>\n                <?php echo $status ?>\n            </p>\n\n            <p>\n                <strong><u><?php eT(\"Resources import summary\") ?></u></strong><br />\n                <?php echo gT(\"Files imported:\") . \" $okfiles\" ?><br />\n                <?php echo gT(\"Files skipped:\") . \" $errfiles\" ?><br />\n            </p>\n            <p>\n                <?php\n                    if (count($aImportedFilesInfo) > 0)\n                    {\n                    ?>\n                    <br /><strong><u><?php eT(\"Imported files:\") ?></u></strong><br />\n                    <ul style=\"max-height: 250px; overflow-y:scroll;\" class=\"list-unstyled\">\n                        <?php\n                            foreach ($aImportedFilesInfo as $entry)\n                            {\n                                if ($entry['is_folder']){\n                                ?>\n                                <li><?php echo gT(\"Folder:\") . \" \" . htmlspecialchars($entry[\"filename\"],ENT_QUOTES,'utf-8'); ?></li>\n                                <?php\n                                }\n                                else\n                                { ?>\n                                <li><?php echo gT(\"File:\") . \" \" . htmlspecialchars($entry[\"filename\"],ENT_QUOTES,'utf-8'); ?></li>\n\n\n                                <?php\n                                }\n                            }\n                        }\n                        if (count($aErrorFilesInfo) > 0)\n                        {\n                        ?>\n                    </ul>\n                    <br /><strong><u><?php eT(\"Skipped files:\") ?></u></strong><br />\n                    <ul style=\"max-height: 250px; overflow-y:scroll;\" class=\"list-unstyled\">\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry)\n                            {\n                            ?>\n                            <li><?php echo gT(\"File:\") . \" \" . $entry[\"filename\"] ?></li>\n                            <?php\n                            }\n                        }\n                    ?>\n                </ul>\n            </p>\n            <p>\n                <input type='submit' class=\"btn btn-default btn-lg\" id=\"button-open-theme\" value='<?php eT(\"Open imported theme\") ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/themes/sa/view/templatename/' . $newdir) ?>', '_top')\" />\n            </p>\n        </div>\n    </div>\n</div>\n", "<?php\nYii::app()->getClientScript()->registerPackage('jquery-ace'); \nYii::app()->getClientScript()->registerScript('editorfiletype',\"editorfiletype ='\".$sEditorFileType.\"';\",CClientScript::POS_HEAD);\n?>\n\n\n  <?php if (is_template_editable($templatename)==true) { ?>\n    <div class=\"row template-sum\">\n        <div class=\"col-lg-12\">\n            <div class=\"h4\">\n                <?php echo sprintf(gT(\"Viewing file '%s'\"),$editfile); ?>\n            </div>\n\n            <?php if (!is_writable($templates[$templatename])) { ?>\n                <div class=\"alert alert-warning alert-dismissible\" role=\"alert\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                    <?php eT(\"You can't save changes because the theme directory is not writable.\"); ?>\n                </div>\n            <?php } ?>\n        </div>\n    </div>\n\n    <div class=\"row template-sum\">\n        <div class=\"col-sm-2\" id='templateleft'>\n            <div>\n                <?php eT(\"Screen part files:\"); ?>\n                <div class=\"col-sm-12 well\" style=\"padding-left: 0;\">\n                <?php foreach ($files as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate,false) && $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) { ?>\n                                <span class=\"label label-success\"> <?php eT(\"local\"); ?> </span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"> <?php eT(\"inherited\"); ?> </span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php } ?>\n                </div>\n            </div>\n            <div>\n                <?php eT(\"JavaScript files:\"); ?>\n                <div class=\"col-sm-12 well\">\n\n                <?php foreach ($jsfiles as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) {?>\n                                <span class=\"label label-success\"><?php eT(\"local\"); ?></span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n        </div>\n        <div>\n            <?php eT(\"CSS files:\"); ?>\n            <div class=\"col-sm-12 well\">\n                <?php foreach ($cssfiles as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) { ?>\n                                <span class=\"label label-success\"><?php eT(\"local\"); ?></span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"col-lg-8 templateeditor\">\n        <?=CHtml::form(['admin/themes/sa/templatesavechanges'], 'POST', ['id'=>'editTemplate', 'name'=>'editTemplate'])?>\n            <?php\n                echo CHtml::hiddenField('templatename', $templatename, array('class'=>'templatename'));\n                echo CHtml::hiddenField('screenname', $screenname, array('class'=>'screenname'));\n                echo CHtml::hiddenField('editfile', $editfile);\n                echo CHtml::hiddenField('relativePathEditfile', $relativePathEditfile);\n                echo CHtml::hiddenField('action', 'templatesavechanges');\n                echo CHtml::textArea('changes',\n                !empty($editfile) ? file_get_contents($editfile) : '',\n                array('rows'=>'20',\n                    'cols'=>'40',\n                    'data-filetype'=>$sEditorFileType,\n                    'class'=>'ace '.$sTemplateEditorMode,\n                    'style'=>'width:100%'\n                ));\n            ?>\n            <p class='text-center'>\n                <br/>\n                <?php if (Permission::model()->hasGlobalPermission('templates','update')) {\n                    $sSaveText = ( $oEditedTemplate->getTemplateForFile($relativePathEditfile, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName)\n                        ? gT(\"Save changes\")\n                        : gT(\"Copy to local theme and save changes\");\n                    if (is_writable($templates[$templatename])) { ?>\n                        <input type='submit' class='btn btn-default' id='button-save-changes' value='<?php echo $sSaveText; ?>' <?=(!is_template_editable($templatename) ? \"disabled='disabled' alt='\".gT( \"Changes cannot be saved to a standard theme.\"). \"'\" : \"\")?> />\n                    <?php } ?>\n                <?php } ?>\n            </p>\n        </form>\n    </div>\n    <div class=\"col-lg-2\" style=\"overflow-x: hidden\">\n        <div>\n            <?php eT(\"Other files:\"); ?>\n            <br/>\n            <div class=\"col-sm-12 well other-files-list\">\n                <?php foreach ($otherfiles as $fileName => $file) { ?>\n                    <div class=\"row other-files-row\">\n                        <div class=\"col-sm-9 other-files-filename\">\n                            <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php //TODO: make it ajax and less messy ?>\n                            <?php if ( $oEditedTemplate->getTemplateForFile($fileName, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) {\n                                if (Permission::model()->hasGlobalPermission('templates','delete')) { ?>\n                                    <?=CHtml::form(array('admin/themes/sa/templatefiledelete'), 'post'); ?>\n                                        <input type='hidden' name=\"otherfile\" value=\"<?php echo $file; ?>\" />\n                                        <input type='submit' class='btn btn-default btn-xs other-files-delete-button' value='<?php eT(\"Delete\"); ?>' onclick=\"javascript:return confirm('<?php eT(\" Are you sure you want to delete this file? \", \"js\"); ?>')\"/>\n                                        <input type='hidden' name='screenname' value='<?php echo htmlspecialchars($screenname); ?>' />\n                                        <input type='hidden' name='templatename' value='<?php echo htmlspecialchars($templatename); ?>' />\n                                        <input type='hidden' name='editfile' value='<?php echo htmlspecialchars($relativePathEditfile); ?>' />\n                                        <input type='hidden' name='action' value='templatefiledelete' />\n                                    </form>\n                                <?php } ?>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n            <br>\n        </div>\n        <div style='margin-top:1em;'>\n            <?php if (Permission::model()->hasGlobalPermission('templates','update')) { ?>\n                <?php echo CHtml::form(array('admin/themes/sa/uploadfile'), 'post', array('id'=>'importtemplatefile', 'name'=>'importtemplatefile', 'enctype'=>'multipart/form-data')); ?>\n                    <?php printf(gT(\"Upload a file (maximum size: %d MB):\"),getMaximumFileUploadSize()/1024/1024); ?>\n                    <br>\n                    <input name='upload_file' id=\"upload_file\" type=\"file\" required=\"required\" />\n                    <input type='submit' value='<?php eT(\"Upload\"); ?>' class='btn btn-default' <?=(!is_template_editable($templatename) ? \"disabled='disabled'\" : '') ?> />\n                    <input type='hidden' name='editfile' value='<?php echo htmlspecialchars($relativePathEditfile); ?>' />\n                    <input type='hidden' name='screenname' value='<?php echo HTMLEscape($screenname); ?>' />\n                    <input type='hidden' name='templatename' value='<?php echo $templatename; ?>' />\n                    <input type='hidden' name='action' value='templateuploadfile' />\n                </form>\n            <?php } ?>\n        </div>\n\n        <div class=\"\">\n            <a href=\"#\" data-toggle=\"modal\" data-target=\"#fileHelp\" />\n                <?php eT('Tip: How to embed a picture in your theme?'); ?>\n            </a>\n        </div>\n    </div>\n\n    <!-- Modal -->\n    <div class=\"modal fade\" id=\"fileHelp\" tabindex=\"-1\" role=\"dialog\">\n        <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                    <div class=\"modal-title h4\" id=\"myModalLabel\">\n                        <?php eT('Tip: How to display a picture in your theme?'); ?>\n                    </div>\n                </div>\n                <div class=\"modal-body\">\n                    <?php eT('To use a picture in a .twig file:');?>\n                    <br/>\n                    <code> {{ image('./files/myfile.png', 'alt-text for my file', {\"class\": \"myclass\"}) }}</code>\n                    <br/>\n                    <br/>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">\n                        <?php eT(\"Close\");?>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<?php }?>\n<div class=\"row template-sum\" style=\"margin-bottom: 100px;\">\n    <div class=\"col-lg-12\">\n        <div class=\"h4\">\n            <?php eT(\"Preview:\"); ?>\n        </div>\n        <div class=\"jumbotron message-box\">\n            <input type='button' value='<?php eT(\"Mobile\"); ?>' id='iphone' class=\"btn btn-default\" />\n            <input type='button' value='640x480' id='x640' class=\"btn btn-default\" />\n            <input type='button' value='800x600' id='x800' class=\"btn btn-default\" />\n            <input type='button' value='1024x768' id='x1024' class=\"btn btn-default\" />\n            <input type='button' value='<?php eT(\"Full\"); ?>' id='full' class=\"btn btn-default\" />\n            <br>\n            <br>\n            <br>\n            <br>\n\n            <div style='width:90%; margin:0 auto;'>\n                <?php if(isset($filenotwritten) && $filenotwritten==true) { ?>\n                    <p>\n                        <span class='errortitle'><?php echo sprintf(gT(\"Please change the directory permissions of the folder %s in order to preview themes.\"), $tempdir); ?></span>\n                    </p>\n                <?php } else { ?>\n                    <p>\n                        <iframe id='previewiframe' title='Preview' src='<?php echo $this->createUrl('admin/themes/sa/tmp/',array('id'=>$time)); ?>' height='768' name='previewiframe' style='width:95%;background-color: white;'>Embedded Frame</iframe>\n                    </p>\n                <?php } ?>\n            </div>\n        </div>\n      </div>\n    </div>\n"], "fixing_code": ["<?php if (!count($aErrorFilesInfo) &&count($aImportedFilesInfo)): ?>\n<div class='side-body <?php echo getSideBodyClass(false); ?>'>\n    <div class=\"row welcome survey-action\">\n        <div class=\"col-sm-12 content-right\">\n            <div class=\"jumbotron message-box\">\n                <h2><?php eT(\"Import survey resources\"); ?></h2>\n                <p class=\"lead text-success\">\n                    <?php eT(\"Success\");?>\n                </p>\n                <p>\n                    <?php eT(\"Resources Import Summary\"); ?>\n                </p>\n                <p>\n                    <?php eT(\"Total Imported files\"); ?>: <?php echo count($aImportedFilesInfo); ?><br />\n                </p>\n                <p>\n                    <strong><?php eT(\"Imported Files List\") ?>:</strong>\n                </p>\n                <p>\n                    <ul>\n                        <?php\n                        foreach ($aImportedFilesInfo as $entry) {\n                            echo CHtml::tag('li', array(), sprintf(gT(\"File: %s\"),CHtml::encode($entry[\"filename\"])));\n                        }\n                        ?>\n                    </ul>\n                </p>\n                <p>\n                    <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                </p>\n            </div>\n        </div>\n    </div>\n</div>\n<?php elseif(count($aErrorFilesInfo) &&count($aImportedFilesInfo)): ?>\n    <div class='side-body <?php echo getSideBodyClass(false); ?>'>\n        <div class=\"row welcome survey-action\">\n            <div class=\"col-sm-12 content-right\">\n                <div class=\"jumbotron message-box message-box-warning\">\n                    <h2><?php eT(\"Import survey resources\"); ?></h2>\n                    <p class=\"lead text-warning\">\n                        <?php eT(\"Partial\");?>\n                    </p>\n                    <p>\n                        <?php eT(\"Resources Import Summary\"); ?>\n                    </p>\n                    <p>\n                        <?php eT(\"Total Imported files\"); ?>: <?php echo count($aImportedFilesInfo); ?><br />\n                        <?php eT(\"Total Errors\"); ?>: <?php echo count($aErrorFilesInfo); ?><br />\n                    </p>\n                    <p>\n                        <strong><?php eT(\"Imported Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <ul>\n                            <?php\n                            foreach ($aImportedFilesInfo as $entry) {\n                                echo CHtml::tag('li', array(), sprintf(gT(\"File: %s\"),CHtml::encode($entry[\"filename\"])));\n                            }\n                            ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <strong class=\"text-warning\"><?php eT(\"Error Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry) {\n                                echo CHtml::tag('li', array(), sprintf(gT(\"File: %s (%s)\"),CHtml::encode($entry[\"filename\"]),$entry['status']));\n                            }\n                        ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n<?php else:?>\n    <div class='side-body <?php echo getSideBodyClass(false); ?>'>\n        <div class=\"row welcome survey-action\">\n            <div class=\"col-sm-12 content-right\">\n                <div class=\"jumbotron message-box message-box-error\">\n                    <h2><?php eT(\"Import survey resources\"); ?></h2>\n                    <p class=\"lead text-danger\">\n                        <?php eT(\"Error\");?>\n                    </p>\n                    <p>\n                        <?php eT(\"Resources Import Summary\"); ?>\n                    </p>\n                    <p>\n                        <?php eT(\"Total Imported files\"); ?>: 0<br />\n                        <?php eT(\"Total Errors\"); ?>: <?php echo count($aErrorFilesInfo); ?><br />\n                    </p>\n                    <p>\n                        <strong class=\"text-warning\"><?php eT(\"Error Files List\"); ?>:</strong>\n                    </p>\n                    <p>\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry) {\n                                echo CHtml::tag('li', array(), sprintf(gT(\"File: %s (%s)\"),CHtml::encode($entry[\"filename\"]),$entry['status']));\n                            }\n                        ?>\n                        </ul>\n                    </p>\n                    <p>\n                        <input class=\"btn btn-default btn-lg\" type='submit' value='<?php eT(\"Back\"); ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/survey/sa/editlocalsettings/surveyid/' . $surveyid); ?>', '_top')\" />\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n<?php endif; ?>\n", "<?php\n    // TODO : move all this to controller\n    $okfiles = 0;\n    $errfiles = 0;\n    if (count($aErrorFilesInfo) == 0 && count($aImportedFilesInfo) > 0)\n    {\n        $status = gT(\"Success\");\n        $class = '';\n        $statusClass = 'text-success';\n        $okfiles = count($aImportedFilesInfo);\n    }\n    elseif (count($aErrorFilesInfo) > 0 && count($aImportedFilesInfo) > 0)\n    {\n        $status = gT(\"Partial\");\n        $class = 'message-box-warning';\n        $statusClass = 'text-warning';\n        $okfiles = count($aImportedFilesInfo);\n        $errfiles = count($aErrorFilesInfo);\n    }\n    else\n    {\n        $status = gT(\"Error\");\n        $statusClass = 'text-error';\n        $class = 'message-box-error';\n        $errfiles = count($aErrorFilesInfo);\n    }\n?>\n<div class=\"row\">\n    <div class=\"col-sm-11 col-sm-offset-1 content-right\">\n        <!-- Message box from super admin -->\n        <div class=\"jumbotron message-box <?php echo $class;?>\">\n            <div class=\"h2\"><?php eT(\"Import theme result:\") ?></div>\n\n            <p class='lead <?php echo $statusClass;?>'>\n                <?php echo $status ?>\n            </p>\n\n            <p>\n                <strong><u><?php eT(\"Resources import summary\") ?></u></strong><br />\n                <?php echo gT(\"Files imported:\") . \" $okfiles\" ?><br />\n                <?php echo gT(\"Files skipped:\") . \" $errfiles\" ?><br />\n            </p>\n            <p>\n                <?php\n                    if (count($aImportedFilesInfo) > 0)\n                    {\n                    ?>\n                    <br /><strong><u><?php eT(\"Imported files:\") ?></u></strong><br />\n                    <ul style=\"max-height: 250px; overflow-y:scroll;\" class=\"list-unstyled\">\n                        <?php\n                            foreach ($aImportedFilesInfo as $entry)\n                            {\n                                if ($entry['is_folder']){\n                                ?>\n                                <li><?php printf(gT(\"Folder: %s\"),CHtml::encode($entry[\"filename\"])); ?></li>\n                                <?php\n                                }\n                                else\n                                { ?>\n                                <li><?php printf(gT(\"File: %s\"),CHtml::encode($entry[\"filename\"])); ?></li>\n\n\n                                <?php\n                                }\n                            }\n                        }\n                        if (count($aErrorFilesInfo) > 0)\n                        {\n                        ?>\n                    </ul>\n                    <br /><strong><u><?php eT(\"Skipped files:\") ?></u></strong><br />\n                    <ul style=\"max-height: 250px; overflow-y:scroll;\" class=\"list-unstyled\">\n                        <?php\n                            foreach ($aErrorFilesInfo as $entry)\n                            {\n                            ?>\n                            <li><?php printf(gT(\"File: %s\"),CHtml::encode($entry[\"filename\"])); ?></li>\n                            <?php\n                            }\n                        }\n                    ?>\n                </ul>\n            </p>\n            <p>\n                <input type='submit' class=\"btn btn-default btn-lg\" id=\"button-open-theme\" value='<?php eT(\"Open imported theme\") ?>' onclick=\"window.open('<?php echo $this->createUrl('admin/themes/sa/view/templatename/' . $newdir) ?>', '_top')\" />\n            </p>\n        </div>\n    </div>\n</div>\n", "<?php\nYii::app()->getClientScript()->registerPackage('jquery-ace'); \nYii::app()->getClientScript()->registerScript('editorfiletype',\"editorfiletype ='\".$sEditorFileType.\"';\",CClientScript::POS_HEAD);\n?>\n\n\n  <?php if (is_template_editable($templatename)==true) { ?>\n    <div class=\"row template-sum\">\n        <div class=\"col-lg-12\">\n            <div class=\"h4\">\n                <?php echo sprintf(gT(\"Viewing file '%s'\"),$editfile); ?>\n            </div>\n\n            <?php if (!is_writable($templates[$templatename])) { ?>\n                <div class=\"alert alert-warning alert-dismissible\" role=\"alert\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                    <?php eT(\"You can't save changes because the theme directory is not writable.\"); ?>\n                </div>\n            <?php } ?>\n        </div>\n    </div>\n\n    <div class=\"row template-sum\">\n        <div class=\"col-sm-2\" id='templateleft'>\n            <div>\n                <?php eT(\"Screen part files:\"); ?>\n                <div class=\"col-sm-12 well\" style=\"padding-left: 0;\">\n                <?php foreach ($files as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate,false) && $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) { ?>\n                                <span class=\"label label-success\"> <?php eT(\"local\"); ?> </span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"> <?php eT(\"inherited\"); ?> </span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php } ?>\n                </div>\n            </div>\n            <div>\n                <?php eT(\"JavaScript files:\"); ?>\n                <div class=\"col-sm-12 well\">\n\n                <?php foreach ($jsfiles as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) {?>\n                                <span class=\"label label-success\"><?php eT(\"local\"); ?></span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n        </div>\n        <div>\n            <?php eT(\"CSS files:\"); ?>\n            <div class=\"col-sm-12 well\">\n                <?php foreach ($cssfiles as $file) { ?>\n                    <div class=\"row\">\n                        <div class=\"col-sm-9\">\n                            <a href=\"<?php echo $this->createUrl('admin/themes', array('sa'=>'view','screenname'=>$screenname,'templatename'=>$templatename, 'editfile' => $file )); ?>\" class=\"<?php if($file == $relativePathEditfile ){echo 'text-danger';}else{echo 'text-success';}; ?>\">\n                                <?php echo (empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1) ;?>\n                            </a>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php if ( $oEditedTemplate->getTemplateForFile($file, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) { ?>\n                                <span class=\"label label-success\"><?php eT(\"local\"); ?></span>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"col-lg-8 templateeditor\">\n        <?=CHtml::form(['admin/themes/sa/templatesavechanges'], 'POST', ['id'=>'editTemplate', 'name'=>'editTemplate'])?>\n            <?php\n                echo CHtml::hiddenField('templatename', $templatename, array('class'=>'templatename'));\n                echo CHtml::hiddenField('screenname', $screenname, array('class'=>'screenname'));\n                echo CHtml::hiddenField('editfile', $editfile);\n                echo CHtml::hiddenField('relativePathEditfile', $relativePathEditfile);\n                echo CHtml::hiddenField('action', 'templatesavechanges');\n                echo CHtml::textArea('changes',\n                !empty($editfile) ? file_get_contents($editfile) : '',\n                array('rows'=>'20',\n                    'cols'=>'40',\n                    'data-filetype'=>$sEditorFileType,\n                    'class'=>'ace '.$sTemplateEditorMode,\n                    'style'=>'width:100%'\n                ));\n            ?>\n            <p class='text-center'>\n                <br/>\n                <?php if (Permission::model()->hasGlobalPermission('templates','update')) {\n                    $sSaveText = ( $oEditedTemplate->getTemplateForFile($relativePathEditfile, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName)\n                        ? gT(\"Save changes\")\n                        : gT(\"Copy to local theme and save changes\");\n                    if (is_writable($templates[$templatename])) { ?>\n                        <input type='submit' class='btn btn-default' id='button-save-changes' value='<?php echo $sSaveText; ?>' <?=(!is_template_editable($templatename) ? \"disabled='disabled' alt='\".gT( \"Changes cannot be saved to a standard theme.\"). \"'\" : \"\")?> />\n                    <?php } ?>\n                <?php } ?>\n            </p>\n        </form>\n    </div>\n    <div class=\"col-lg-2\" style=\"overflow-x: hidden\">\n        <div>\n            <?php eT(\"Other files:\"); ?>\n            <br/>\n            <div class=\"col-sm-12 well other-files-list\">\n                <?php foreach ($otherfiles as $fileName => $file) { ?>\n                    <div class=\"row other-files-row\">\n                        <div class=\"col-sm-9 other-files-filename\">\n                            <?php echo CHtml::encode((empty(substr(strrchr($file, DIRECTORY_SEPARATOR), 1)))?$file:substr(strrchr($file, DIRECTORY_SEPARATOR), 1)) ;?>\n                        </div>\n                        <div class=\"col-sm-3\">\n                            <?php //TODO: make it ajax and less messy ?>\n                            <?php if ( $oEditedTemplate->getTemplateForFile($fileName, $oEditedTemplate)->sTemplateName == $oEditedTemplate->sTemplateName) {\n                                if (Permission::model()->hasGlobalPermission('templates','delete')) { ?>\n                                    <?=CHtml::form(array('admin/themes/sa/templatefiledelete'), 'post'); ?>\n                                        <input type='hidden' name=\"otherfile\" value=\"<?php echo $file; ?>\" />\n                                        <input type='submit' class='btn btn-default btn-xs other-files-delete-button' value='<?php eT(\"Delete\"); ?>' onclick=\"javascript:return confirm('<?php eT(\" Are you sure you want to delete this file? \", \"js\"); ?>')\"/>\n                                        <input type='hidden' name='screenname' value='<?php echo htmlspecialchars($screenname); ?>' />\n                                        <input type='hidden' name='templatename' value='<?php echo htmlspecialchars($templatename); ?>' />\n                                        <input type='hidden' name='editfile' value='<?php echo htmlspecialchars($relativePathEditfile); ?>' />\n                                        <input type='hidden' name='action' value='templatefiledelete' />\n                                    </form>\n                                <?php } ?>\n                            <?php } else { ?>\n                                <span class=\"label label-danger\"><?php eT(\"inherited\"); ?></span>\n                            <?php }?>\n                        </div>\n                    </div>\n                <?php }?>\n            </div>\n            <br>\n        </div>\n        <div style='margin-top:1em;'>\n            <?php if (Permission::model()->hasGlobalPermission('templates','update')) { ?>\n                <?php echo CHtml::form(array('admin/themes/sa/uploadfile'), 'post', array('id'=>'importtemplatefile', 'name'=>'importtemplatefile', 'enctype'=>'multipart/form-data')); ?>\n                    <?php printf(gT(\"Upload a file (maximum size: %d MB):\"),getMaximumFileUploadSize()/1024/1024); ?>\n                    <br>\n                    <input name='upload_file' id=\"upload_file\" type=\"file\" required=\"required\" />\n                    <input type='submit' value='<?php eT(\"Upload\"); ?>' class='btn btn-default' <?=(!is_template_editable($templatename) ? \"disabled='disabled'\" : '') ?> />\n                    <input type='hidden' name='editfile' value='<?php echo htmlspecialchars($relativePathEditfile); ?>' />\n                    <input type='hidden' name='screenname' value='<?php echo HTMLEscape($screenname); ?>' />\n                    <input type='hidden' name='templatename' value='<?php echo $templatename; ?>' />\n                    <input type='hidden' name='action' value='templateuploadfile' />\n                </form>\n            <?php } ?>\n        </div>\n\n        <div class=\"\">\n            <a href=\"#\" data-toggle=\"modal\" data-target=\"#fileHelp\" />\n                <?php eT('Tip: How to embed a picture in your theme?'); ?>\n            </a>\n        </div>\n    </div>\n\n    <!-- Modal -->\n    <div class=\"modal fade\" id=\"fileHelp\" tabindex=\"-1\" role=\"dialog\">\n        <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                    <div class=\"modal-title h4\" id=\"myModalLabel\">\n                        <?php eT('Tip: How to display a picture in your theme?'); ?>\n                    </div>\n                </div>\n                <div class=\"modal-body\">\n                    <?php eT('To use a picture in a .twig file:');?>\n                    <br/>\n                    <code> {{ image('./files/myfile.png', 'alt-text for my file', {\"class\": \"myclass\"}) }}</code>\n                    <br/>\n                    <br/>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">\n                        <?php eT(\"Close\");?>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<?php }?>\n<div class=\"row template-sum\" style=\"margin-bottom: 100px;\">\n    <div class=\"col-lg-12\">\n        <div class=\"h4\">\n            <?php eT(\"Preview:\"); ?>\n        </div>\n        <div class=\"jumbotron message-box\">\n            <input type='button' value='<?php eT(\"Mobile\"); ?>' id='iphone' class=\"btn btn-default\" />\n            <input type='button' value='640x480' id='x640' class=\"btn btn-default\" />\n            <input type='button' value='800x600' id='x800' class=\"btn btn-default\" />\n            <input type='button' value='1024x768' id='x1024' class=\"btn btn-default\" />\n            <input type='button' value='<?php eT(\"Full\"); ?>' id='full' class=\"btn btn-default\" />\n            <br>\n            <br>\n            <br>\n            <br>\n\n            <div style='width:90%; margin:0 auto;'>\n                <?php if(isset($filenotwritten) && $filenotwritten==true) { ?>\n                    <p>\n                        <span class='errortitle'><?php echo sprintf(gT(\"Please change the directory permissions of the folder %s in order to preview themes.\"), $tempdir); ?></span>\n                    </p>\n                <?php } else { ?>\n                    <p>\n                        <iframe id='previewiframe' title='Preview' src='<?php echo $this->createUrl('admin/themes/sa/tmp/',array('id'=>$time)); ?>' height='768' name='previewiframe' style='width:95%;background-color: white;'>Embedded Frame</iframe>\n                    </p>\n                <?php } ?>\n            </div>\n        </div>\n      </div>\n    </div>\n"], "filenames": ["application/views/admin/survey/importSurveyResources_view.php", "application/views/admin/themes/importuploaded_view.php", "application/views/admin/themes/templatesummary_view.php"], "buggy_code_start_loc": [22, 55, 129], "buggy_code_end_loc": [108, 78, 130], "fixing_code_start_loc": [22, 55, 129], "fixing_code_end_loc": [104, 78, 130], "type": "CWE-79", "message": "LimeSurvey version 3.15.5 contains a Cross-site scripting (XSS) vulnerability in Survey Resource zip upload, resulting in Javascript code execution against LimeSurvey administrators. Fixed in version 3.15.6.", "other": {"cve": {"id": "CVE-2018-20322", "sourceIdentifier": "cve@mitre.org", "published": "2018-12-21T23:29:00.933", "lastModified": "2019-03-18T15:25:44.567", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "LimeSurvey version 3.15.5 contains a Cross-site scripting (XSS) vulnerability in Survey Resource zip upload, resulting in Javascript code execution against LimeSurvey administrators. Fixed in version 3.15.6."}, {"lang": "es", "value": "LimeSurvey, en su versi\u00f3n 3.15.5, contiene una vulnerabilidad de Cross Site Scripting (XSS) en la subida del zip \"Survey Resource\" que puede resultar en la ejecuci\u00f3n de c\u00f3digo JavaScript contra los administradores de LimeSurvey. Esto se solucion\u00f3 en la versi\u00f3n 3.15.6."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:limesurvey:limesurvey:*:*:*:*:*:*:*:*", "versionEndIncluding": "3.15.5", "matchCriteriaId": "A0D5F867-EDEA-4930-B1F2-57FFBCDE2F14"}]}]}], "references": [{"url": "https://bugs.limesurvey.org/view.php?id=14376", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Permissions Required", "Vendor Advisory"]}, {"url": "https://github.com/LimeSurvey/LimeSurvey/commit/bfee69edaa0b90f97dc2d8fab09a87958cb32405", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/LimeSurvey/LimeSurvey/commit/bfee69edaa0b90f97dc2d8fab09a87958cb32405"}}