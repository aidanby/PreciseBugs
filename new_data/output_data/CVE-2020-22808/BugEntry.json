{"buggy_code": ["<?php\r\n/**\r\n * FecShop file.\r\n *\r\n * @link http://www.fecshop.com/\r\n * @copyright Copyright (c) 2016 FecShop Software LLC\r\n * @license http://www.fecshop.com/license/\r\n */\r\n?>\r\n<?php\r\nuse fecshop\\app\\appfront\\helper\\Format;\r\nuse fec\\helpers\\CRequest;\r\n?>\r\n<div class=\"main container one-column\">\r\n\t<div class=\"col-main\">\r\n    <?= Yii::$service->page->widget->render('base/breadcrumbs',$this); ?>\r\n    <?= Yii::$service->page->widget->render('base/flashmessage'); ?>\r\n\t<?php if(is_array($cart_info) && !empty($cart_info)):   ?>\r\n\t\t\t    \r\n\t\t<div class=\"product_page\">\r\n\t\t\t\r\n\t\t\t<div class=\"cart\">\r\n\t\t\t\t<div class=\"page-title title-buttons\">\r\n\t\t\t\t\t<div class=\"shopping-cart-img\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<?php if(is_array($cart_info['products']) && (!empty($cart_info['products']))): ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t<div class=\"shopping-cart-div\">\r\n\t\t\t\t\t\t<div class=\"shopping-cart-ab\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<table id=\"shopping-cart-table\" class=\"data-table cart-table\">\r\n\t\t\t\t\t\t\t<colgroup>\r\n                                <col width=\"1\">\r\n\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t\t<col width=\"\">\r\n\t\t\t\t\t\t\t\t<col width=\"6\">\r\n\t\t\t\t\t\t\t\t<col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"91\">\r\n                                <col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"106\">\r\n\t\t\t\t\t\t\t\t<col width=\"106\">\r\n                                <col width=\"26\">\r\n\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t<tr class=\"first last\">\r\n                                    <th rowspan=\"1\"><input type=\"checkbox\" name=\"cart_select_all\" class=\"cart_select cart_select_all\" id=\"cart_select_all\">&nbsp;<label for=\"cart_select_all\">All</label></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\">&nbsp;</th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"5\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Product Name');?></span></th>\r\n\t\t\t\t\t\t\t\t\t<th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Unit Price');?></span></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Weight');?></span></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Volume');?></span></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\" class=\"a-center\"><?= Yii::$service->page->translate->__('Qty');?></th>\r\n\t\t\t\t\t\t\t\t\t<th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Price');?></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Weight');?></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Volume');?></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\" class=\"a-right\">&nbsp;</th>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t<tfoot>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</tfoot>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<?php foreach($cart_info['products'] as $product_one): ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<tr class=\"first last odd\">\r\n                                \r\n                                    <td>\r\n                                        <input rel=\"<?= $product_one['item_id']; ?>\" <?=  ($product_one['active'] == Yii::$service->cart->quoteItem->activeStatus ) ?  'checked=\"checked\"' : '' ?> type=\"checkbox\" name=\"cart_select_item\" class=\"cart_select cart_select_item\">\r\n                                    </td>\r\n\t\t\t\t\t\t\t\t\t\r\n                                    \r\n\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?= $product_one['url'] ?>\" title=\"<?= $product_one['name'] ?>\" class=\"product-image\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->product->image->getResize($product_one['image'],[100,100],false) ?>\" alt=\"<?= $product_one['name'] ?>\" width=\"75\" height=\"75\">\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t<h2 class=\"product-name\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= $product_one['url'] ?>\"><?= $product_one['name'] ?></a>\r\n\t\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t\t<?php  if(is_array($product_one['custom_option_info'])):  ?>\r\n\t\t\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php foreach($product_one['custom_option_info'] as $label => $val):  ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li><?= Yii::$service->page->translate->__(ucwords($label)).':' ?><?= Yii::$service->page->translate->__($val) ?> </li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<?php endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif;  ?>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_price']); ?></span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_weight']); ?>Kg</span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_volume']); ?>c\u33a1</span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                \r\n\t\t\t\t   \r\n\t\t\t\t\t\t\t\t\t<td class=\"a-center\">\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"width:60px;margin:auto\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"cartqtydown changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\"></a>\r\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"cart[qty]\" size=\"4\" title=\"Qty\" class=\"input-text qty\" rel=\"<?= $product_one['item_id']; ?>\" maxlength=\"12\" value=\"<?= $product_one['qty']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"cartqtyup changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\"></a>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_row_price']); ?></span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_row_weight']); ?>Kg</span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_row_volume']); ?>c\u33a1</span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    \r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right last\">\r\n\t\t\t\t\t\t\t\t\t\t<a style=\"margin-right: 15px;float: right;\" href=\"javascript:void(0)\"  rel=\"<?= $product_one['item_id']; ?>\" title=\"Remove item\" class=\"btn-remove btn-remove2\"><?= Yii::$service->page->translate->__('Remove item');?></a>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<?php  endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<?php  endif;  ?>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div class=\"cart-collaterals\">\r\n\t\t\t\t\t<div class=\"col2-set\">\r\n\t\t\t\t\t\t<div class=\"col-1\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"col-2\">\r\n\t\t\t\t\t\t\t<form id=\"discount-coupon-form\" >\r\n\t\t\t\t\t\t\t\t<div class=\"discount\">\r\n\t\t\t\t\t\t\t\t\t<h2><?= Yii::$service->page->translate->__('Discount Codes');?></h2>\r\n\t\t\t\t\t\t\t\t\t<div class=\"discount-form\">\r\n\t\t\t\t\t\t\t\t\t\t<label for=\"coupon_code\"><?= Yii::$service->page->translate->__('Enter your coupon code if you have one.');?></label>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"input-box\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" class=\"couponType\"  value=\"<?= $cart_info['coupon_code'] ? 1 : 2 ; ?>\"  />\r\n\t\t\t\t\t\t\t\t\t\t\t<input style=\"color:#777;\" class=\"input-text\" id=\"coupon_code\" name=\"coupon_code\" value=\"<?= $cart_info['coupon_code']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"buttons-cou\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"add_coupon_submit submitbutton\"><span><span><?= Yii::$service->page->translate->__($cart_info['coupon_code'] ? 'Cancel Coupon' : 'Add Coupon') ; ?></span></span> </a>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"coupon_add_log\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"totals cart-totals\">\r\n\t\t\t\t\t\t<div class=\"process_total\">\r\n\t\t\t\t\t\t\t<table id=\"shopping-cart-totals-table\">\r\n\t\t\t\t\t\t\t\t<colgroup>\r\n\t\t\t\t\t\t\t\t\t<col>\r\n\t\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Totla');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_total']); ?>\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Weight');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?= Format::price($cart_info['product_weight']); ?> Kg\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Volume');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?= Format::price($cart_info['product_volume']); ?> c\u33a1\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Discount');?> :    </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">-<?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['coupon_cost']); ?></span>    </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t<table id=\"shopping-cart-totals-table2\">\r\n\t\t\t\t\t\t\t\t<colgroup>\r\n\t\t\t\t\t\t\t\t\t<col>\r\n\t\t\t\t\t\t\t\t\t<col width=\"90\">\r\n\t\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<strong><?= Yii::$service->page->translate->__('Grand Total');?></strong>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<strong><span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['grand_total']) ?></span></strong>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"proceed_to_checkout\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<button onclick=\"location.href='<?= Yii::$service->url->getUrl('checkout/onepage');  ?>'\" type=\"button\" title=\"Proceed to Checkout\" class=\"button btn-proceed-checkout btn-checkout\"><span><span><?= Yii::$service->page->translate->__('Proceed to Pay');?></span></span></button>\r\n\t\t\t\t\t\t\t<?php if ($enablePaypalExpress): ?>\r\n                                <span class=\"or\">- <?= Yii::$service->page->translate->__('OR');?> - </span>\r\n                                <a class=\"express_paypal\" href=\"<?= Yii::$service->url->getUrl('payment/paypal/express/start');    ?>\">\r\n                                \r\n                                </a>\r\n                            <?php endif;  ?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t<?php else: ?>\r\n\t\t<div class=\"empty_cart\">\r\n\t\t<?php\r\n\t\t\t$param = ['urlB' => '<a rel=\"nofollow\" href=\"'.Yii::$service->url->getUrl('customer/account/login').'\">','urlE' =>'</a>'];\r\n\t\t?>\t\r\n\t\t\r\n\t\t<div id=\"empty_cart_info\">\r\n\t\t\t<?= Yii::$service->page->translate->__('Your Shopping Cart is empty');?>\r\n\t\t\t<a href=\"<?= Yii::$service->url->homeUrl(); ?>\"><?= Yii::$service->page->translate->__('Start shopping now!');?></a>\r\n\t\t\t<br>\r\n\t\t\t<?= Yii::$service->page->translate->__('Please {urlB}log in{urlE} to view the products you have previously added to your Shopping Cart.',$param);?>\r\n\t\t</div>\r\n  \r\n  \r\n\t\t</div>\r\n\t<?php  endif; ?>\r\n\t</div>\r\n</div>\r\n\r\n<script>\r\n\t// add to cart js\t\r\n<?php $this->beginBlock('changeCartInfo') ?>\r\ncsrfName = \"<?= CRequest::getCsrfName() ?>\";\r\ncsrfVal = \"<?= CRequest::getCsrfValue() ?>\";\r\n$(document).ready(function(){\r\n    // set select all checkbox\r\n    selectall = \"<?= Yii::$app->request->get('selectall') ?>\";\r\n    selectAllChecked = false;\r\n    if (selectall == 1) {\r\n        selectAllChecked = true;\r\n    } else {\r\n        item_select_all = 1;\r\n        $(\".cart_select_item\").each(function(){\r\n            checked = $(this).is(':checked');\r\n            if (checked == false) {\r\n                item_select_all = 0;\r\n            }\r\n        });\r\n        if (item_select_all == 1) {\r\n            selectAllChecked = true;\r\n        }\r\n    }\r\n    $(\".cart_select_all\").attr(\"checked\",selectAllChecked);\r\n\tcurrentUrl = \"<?= Yii::$service->url->getUrl('checkout/cart') ?>\";\r\n\tupdateCartInfoUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/updateinfo') ?>\";\r\n    selectOneProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectone') ?>\";\r\n    selectAllProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectall') ?>\";\r\n\t$(\".cartqtydown\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tnum = $(this).attr(\"num\");\r\n\t\tif(num > 1){\r\n\t\t\t$data = {\r\n\t\t\t\titem_id:$item_id,\r\n\t\t\t\tup_type:\"less_one\"\r\n\t\t\t};\r\n            $data[csrfName] = csrfVal;\r\n            \r\n\t\t\tjQuery.ajax({\r\n\t\t\t\tasync:true,\r\n\t\t\t\ttimeout: 6000,\r\n\t\t\t\tdataType: 'json', \r\n\t\t\t\ttype:'post',\r\n\t\t\t\tdata: $data,\r\n\t\t\t\turl:updateCartInfoUrl,\r\n\t\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\t\tif (data.status == 'success') {\r\n\t\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t\t} else {\r\n                        alert(data.content);\r\n                    }\r\n\t\t\t\t},\r\n\t\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t\r\n\t$(\".cartqtyup\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"add_one\"\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif (data.status == 'success') {\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t} else {\r\n                    alert(data.content);\r\n                }\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n    \r\n    $(\".btn-remove\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"remove\"\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t$(\".cart_select_item\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tchecked:checked\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectOneProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n    \r\n    \r\n    $(\".cart_select_all\").click(function(){\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\tchecked:checked\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n        selectCurrentUrl = currentUrl + '?selectall=' + checked;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectAllProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = selectCurrentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n\t\r\n\t$(\".add_coupon_submit\").click(function(){\r\n\t\tcoupon_code = $(\"#coupon_code\").val();\r\n\t\tcoupon_type = $(\".couponType\").val();\r\n\t\tcoupon_url = \"\";\r\n\t\tif(coupon_type == 2){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/addcoupon'); ?>\";\r\n\t\t}else if(coupon_type == 1){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/cancelcoupon'); ?>\";\r\n\t\t}\r\n\t\tif(!coupon_code){\r\n\t\t\t//alert(\"coupon can not empty!\");\r\n\t\t}\r\n        $data = {\"coupon_code\":coupon_code};\r\n        $data[csrfName] = csrfVal;\r\n\t\t//coupon_url = $(\"#discount-coupon-form\").attr(\"action\");\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype: 'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:coupon_url,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}else if(data.content == 'nologin'){\r\n\t\t\t\t\twindow.location.href=\"<?=  Yii::$service->url->getUrl('customer/account/login'); ?>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\".coupon_add_log\").html(data.content);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t\r\n\t\r\n});\r\n\r\n<?php $this->endBlock(); ?> \r\n<?php $this->registerJs($this->blocks['changeCartInfo'],\\yii\\web\\View::POS_END);//\u5c06\u7f16\u5199\u7684js\u4ee3\u7801\u6ce8\u518c\u5230\u9875\u9762\u5e95\u90e8 ?>\r\n</script>\r\n<?php  // Yii::$service->page->trace->getTraceCartJsCode($trace_cart_info) // \u8fd9\u4e2a\u6539\u6210\u670d\u52a1\u7aef\u53d1\u9001\u52a0\u5165\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u800c\u4e0d\u662fjs\u4f20\u9012\u7684\u65b9\u5f0f ?>\r\n\r\n", "<?php\r\n/**\r\n * FecShop file.\r\n *\r\n * @link http://www.fecshop.com/\r\n * @copyright Copyright (c) 2016 FecShop Software LLC\r\n * @license http://www.fecshop.com/license/\r\n */\r\n?>\r\n<?php\r\nuse fecshop\\app\\apphtml5\\helper\\Format;\r\nuse fec\\helpers\\CRequest;\r\n?>\r\n<div class=\"main container one-column\">\r\n\t<div class=\"col-main\">\r\n     <?= Yii::$service->page->widget->render('base/flashmessage'); ?>\r\n\t<?php if(is_array($cart_info) && !empty($cart_info)):   ?>\r\n\t\t\t    \r\n\t\t<div class=\"product_page\">\r\n\t\t\t\r\n\t\t\t<div class=\"cart\">\r\n\t\t\t\t<div class=\"page-title title-buttons\">\r\n\t\t\t\t\t<div class=\"shopping-cart-img\">\r\n\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Shopping Cart'); ?>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"cart_info\">\r\n                    <div class=\"cart_select_div\">\r\n                        <input id=\"cart_select_all\" type=\"checkbox\" name=\"cart_select_all\" class=\"cart_select cart_select_all\">\r\n                        &nbsp;\r\n                        <label for=\"cart_select_all\">Select All Product</label>\r\n                    </div>\r\n\t\t\t\t\t<?php if(is_array($cart_info['products']) && (!empty($cart_info['products']))): ?>\r\n\t\t\t\t\t\t<?php foreach($cart_info['products'] as $product_one): ?>\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-33\">\r\n                                    <input rel=\"<?= $product_one['item_id']; ?>\" <?=  ($product_one['active'] == Yii::$service->cart->quoteItem->activeStatus ) ?  'checked=\"checked\"' : '' ?> type=\"checkbox\" name=\"cart_select_item\" class=\"cart_select cart_select_item\">\r\n\t\t\t\t\t\t\t\t\t<a external href=\"<?= $product_one['url'] ?>\" title=\"<?= $product_one['name'] ?>\" class=\"product-image\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->product->image->getResize($product_one['image'],[150,150],false) ?>\" alt=\"<?= $product_one['name'] ?>\" width=\"75\" height=\"75\">\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"col-66\">\r\n\t\t\t\t\t\t\t\t\t<h2 class=\"product-name\">\r\n\t\t\t\t\t\t\t\t\t\t<a external href=\"<?= $product_one['url'] ?>\"><?= $product_one['name'] ?></a>\r\n\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t<?php  if(is_array($product_one['custom_option_info'])):  ?>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"options\">\r\n\t\t\t\t\t\t\t\t\t\t<?php foreach($product_one['custom_option_info'] as $label => $val):  ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<li><?= Yii::$service->page->translate->__(ucwords($label).':') ?><?= Yii::$service->page->translate->__($val) ?> </li>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<?php endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t<?php endif;  ?>\r\n\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_price']); ?></span>                \r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<div class=\"cart_qty\">\r\n\t\t\t\t\t\t\t\t\t\t<a  externalhref=\"javascript:void(0)\" class=\"cartqtydown changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\">-</a>\r\n\t\t\t\t\t\t\t\t\t\t<input name=\"cart[qty]\" size=\"4\" title=\"Qty\" class=\"input-text qty\" rel=\"<?= $product_one['item_id']; ?>\" maxlength=\"12\" value=\"<?= $product_one['qty']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t<a externalhref=\"javascript:void(0)\" class=\"cartqtyup changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\">+</a>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<a  externalhref=\"javascript:void(0)\"  rel=\"<?= $product_one['item_id']; ?>\" title=\"Remove item\" class=\"btn-remove btn-remove2\"><span class=\"icon icon-remove\"></span></a>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"cart-collaterals\">\r\n\t\t\t\t\t<div class=\"col2-set\">\r\n\t\t\t\t\t\t<div class=\"col-1\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"col-2\">\r\n\t\t\t\t\t\t\t<form id=\"discount-coupon-form\" >\r\n\t\t\t\t\t\t\t\t<div class=\"discount\">\r\n\t\t\t\t\t\t\t\t\t<h2><?= Yii::$service->page->translate->__('Discount Codes');?></h2>\r\n\t\t\t\t\t\t\t\t\t<div class=\"discount-form\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"input-box\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" class=\"couponType\"  value=\"<?= $cart_info['coupon_code'] ? 1 : 2 ; ?>\"  />\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input style=\"color:#777;\" class=\"input-text\" id=\"coupon_code\" name=\"coupon_code\" value=\"<?= $cart_info['coupon_code']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"buttons-coupon\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a external data-role=\"button\" href=\"javascript:void(0)\"  class=\"add_coupon_submit submitbutton ui-link ui-btn ui-shadow ui-corner-all\" role=\"button\">\r\n                                                <span>\r\n                                                    <span><?= Yii::$service->page->translate->__($cart_info['coupon_code'] ? 'Cancel Coupon' : 'Add Coupon') ; ?></span>\r\n                                                </span>\r\n                                            </a>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"coupon_add_log\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"cart_cost\">\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Total');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_total']); ?></div>\r\n\t\t\t\t\t\t</div>\r\n                        <div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Weight');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_weight']); ?> Kg</div>\r\n\t\t\t\t\t\t</div>\r\n                        <div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Volume');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_volume']); ?> c\u33a1</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Shipping Cost');?>  : </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['shipping_cost']); ?></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Discount');?>  :</div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\">-<?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['coupon_cost']); ?>%</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Grand Total');?>  :</div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['grand_total']) ?></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"totals cart-totals\">\r\n\t\t\t\t\t\t<div class=\"proceed_to_checkout\">\r\n\t\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-50\">\r\n\t\t\t\t\t\t\t\t\t<button onclick=\"location.href='<?= Yii::$service->url->getUrl('checkout/onepage');  ?>'\" type=\"button\" title=\"Proceed to Checkout\" class=\"button btn-proceed-checkout btn-checkout\"><span><span><?= Yii::$service->page->translate->__('Proceed to Pay');?></span></span></button>\r\n                                </div>\r\n                                <?php if ($enablePaypalExpress): ?>\r\n\t\t\t\t\t\t\t\t<div class=\"col-50\">\r\n\t\t\t\t\t\t\t\t\t<a  external class=\"express_paypal\" href=\"<?= Yii::$service->url->getUrl('payment/paypal/express/start');    ?>\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->image->getImgUrl('/images/pay.png') ?>\"  />\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t</div>\r\n                                <?php endif;  ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t<?php else: ?>\r\n\t\t<div class=\"empty_cart \">\r\n            <?php\r\n                $param = ['urlB' => '<a  external rel=\"nofollow\" href=\"'.Yii::$service->url->getUrl('customer/account/login').'\">','urlE' =>'</a>'];\r\n            ?>\t\r\n            \r\n            <div id=\"empty_cart_info\">\r\n                <?= Yii::$service->page->translate->__('Your Shopping Cart is empty');?>\r\n                <a external href=\"<?= Yii::$service->url->homeUrl(); ?>\"><?= Yii::$service->page->translate->__('Start shopping now!');?></a>\r\n                <br>\r\n                <?= Yii::$service->page->translate->__('Please {urlB}log in{urlE} to view the products you have previously added to your Shopping Cart.',$param);?>\r\n            </div>\r\n\t\t</div>\r\n        <div class=\"empty_cart_img\">\r\n            \r\n        </div>\r\n\t<?php  endif; ?>\r\n\t</div>\r\n</div>\r\n\r\n<script>\r\n\t// add to cart js\t\r\n<?php $this->beginBlock('changeCartInfo') ?>\r\ncsrfName = \"<?= CRequest::getCsrfName() ?>\";\r\ncsrfVal = \"<?= CRequest::getCsrfValue() ?>\";\r\n$(document).ready(function(){\r\n\t// set select all checkbox\r\n    selectall = \"<?= Yii::$app->request->get('selectall') ?>\";\r\n    selectAllChecked = false;\r\n    if (selectall == 1) {\r\n        selectAllChecked = true;\r\n    } else {\r\n        item_select_all = 1;\r\n        $(\".cart_select_item\").each(function(){\r\n            checked = $(this).is(':checked');\r\n            if (checked == false) {\r\n                item_select_all = 0;\r\n            }\r\n        });\r\n        if (item_select_all == 1) {\r\n            selectAllChecked = true;\r\n        }\r\n    }\r\n    if (selectAllChecked) {\r\n        $(\".cart_select_all\").attr(\"checked\",selectAllChecked);\r\n    } else {\r\n        $(\".cart_select_all\").removeAttr(\"checked\");\r\n    }\r\n\tcurrentUrl = \"<?= Yii::$service->url->getUrl('checkout/cart') ?>\";\r\n\tupdateCartInfoUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/updateinfo') ?>\";\r\n    selectOneProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectone') ?>\";\r\n    selectAllProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectall') ?>\";\r\n\t$(\".cartqtydown\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tnum = $(this).attr(\"num\");\r\n\t\tif(num > 1){\r\n\t\t\t$data = {\r\n\t\t\t\titem_id:$item_id,\r\n\t\t\t\tup_type:\"less_one\"\r\n\t\t\t};\r\n\t\t\t$data[csrfName] = csrfVal;\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync:true,\r\n\t\t\t\ttimeout: 6000,\r\n\t\t\t\tdataType: 'json', \r\n\t\t\t\ttype:'post',\r\n\t\t\t\tdata: $data,\r\n\t\t\t\turl:updateCartInfoUrl,\r\n\t\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t\t} else {\r\n                        alert(data.content);\r\n                    }\r\n\t\t\t\t},\r\n\t\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t\r\n\t$(\".cartqtyup\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"add_one\"\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t} else {\r\n                    alert(data.content);\r\n                }\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t$(\".btn-remove\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"remove\"\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t}); \r\n\t\r\n    $(\".cart_select_item\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tchecked:checked\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectOneProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n    \r\n    \r\n    $(\".cart_select_all\").click(function(){\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\tchecked:checked\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n        selectCurrentUrl = currentUrl + '?selectall=' + checked;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectAllProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = selectCurrentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".add_coupon_submit\").click(function(){\r\n\t\tcoupon_code = $(\"#coupon_code\").val();\r\n\t\tcoupon_type = $(\".couponType\").val();\r\n\t\tcoupon_url = \"\";\r\n\t\tif(coupon_type == 2){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/addcoupon'); ?>\";\r\n\t\t}else if(coupon_type == 1){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/cancelcoupon'); ?>\";\r\n\t\t}\r\n\t\tif(!coupon_code){\r\n\t\t\t//alert(\"coupon can not empty!\");\r\n\t\t}\r\n\t\t$data = {\"coupon_code\":coupon_code};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype: 'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:coupon_url,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}else if(data.content == 'nologin'){\r\n\t\t\t\t\twindow.location.href=\"<?=  Yii::$service->url->getUrl('customer/account/login'); ?>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\".coupon_add_log\").html(data.content);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\t\r\n\t\t\r\n\t});\r\n\t\r\n\t\r\n\t\r\n});\r\n\r\n<?php $this->endBlock(); ?> \r\n<?php $this->registerJs($this->blocks['changeCartInfo'],\\yii\\web\\View::POS_END);//\u5c06\u7f16\u5199\u7684js\u4ee3\u7801\u6ce8\u518c\u5230\u9875\u9762\u5e95\u90e8 ?>\r\n</script>\r\n<?php // Yii::$service->page->trace->getTraceCartJsCode($trace_cart_info) // \u8fd9\u4e2a\u6539\u6210\u670d\u52a1\u7aef\u53d1\u9001\u52a0\u5165\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u800c\u4e0d\u662fjs\u4f20\u9012\u7684\u65b9\u5f0f  ?>"], "fixing_code": ["<?php\r\n/**\r\n * FecShop file.\r\n *\r\n * @link http://www.fecshop.com/\r\n * @copyright Copyright (c) 2016 FecShop Software LLC\r\n * @license http://www.fecshop.com/license/\r\n */\r\n?>\r\n<?php\r\nuse fecshop\\app\\appfront\\helper\\Format;\r\nuse fec\\helpers\\CRequest;\r\n?>\r\n<div class=\"main container one-column\">\r\n\t<div class=\"col-main\">\r\n    <?= Yii::$service->page->widget->render('base/breadcrumbs',$this); ?>\r\n    <?= Yii::$service->page->widget->render('base/flashmessage'); ?>\r\n\t<?php if(is_array($cart_info) && !empty($cart_info)):   ?>\r\n\t\t\t    \r\n\t\t<div class=\"product_page\">\r\n\t\t\t\r\n\t\t\t<div class=\"cart\">\r\n\t\t\t\t<div class=\"page-title title-buttons\">\r\n\t\t\t\t\t<div class=\"shopping-cart-img\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<?php if(is_array($cart_info['products']) && (!empty($cart_info['products']))): ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t<div class=\"shopping-cart-div\">\r\n\t\t\t\t\t\t<div class=\"shopping-cart-ab\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<table id=\"shopping-cart-table\" class=\"data-table cart-table\">\r\n\t\t\t\t\t\t\t<colgroup>\r\n                                <col width=\"1\">\r\n\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t\t<col width=\"\">\r\n\t\t\t\t\t\t\t\t<col width=\"6\">\r\n\t\t\t\t\t\t\t\t<col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"91\">\r\n                                <col width=\"76\">\r\n\t\t\t\t\t\t\t\t<col width=\"106\">\r\n\t\t\t\t\t\t\t\t<col width=\"106\">\r\n                                <col width=\"26\">\r\n\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t<tr class=\"first last\">\r\n                                    <th rowspan=\"1\"><input type=\"checkbox\" name=\"cart_select_all\" class=\"cart_select cart_select_all\" id=\"cart_select_all\">&nbsp;<label for=\"cart_select_all\">All</label></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\">&nbsp;</th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"5\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Product Name');?></span></th>\r\n\t\t\t\t\t\t\t\t\t<th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Unit Price');?></span></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Weight');?></span></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><span class=\"nobr\"><?= Yii::$service->page->translate->__('Volume');?></span></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\" class=\"a-center\"><?= Yii::$service->page->translate->__('Qty');?></th>\r\n\t\t\t\t\t\t\t\t\t<th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Price');?></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Weight');?></th>\r\n                                    <th class=\"a-center\" colspan=\"1\"><?= Yii::$service->page->translate->__('Sub Volume');?></th>\r\n\t\t\t\t\t\t\t\t\t<th rowspan=\"1\" class=\"a-right\">&nbsp;</th>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t<tfoot>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</tfoot>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<?php foreach($cart_info['products'] as $product_one): ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<tr class=\"first last odd\">\r\n                                \r\n                                    <td>\r\n                                        <input rel=\"<?= $product_one['item_id']; ?>\" <?=  ($product_one['active'] == Yii::$service->cart->quoteItem->activeStatus ) ?  'checked=\"checked\"' : '' ?> type=\"checkbox\" name=\"cart_select_item\" class=\"cart_select cart_select_item\">\r\n                                    </td>\r\n\t\t\t\t\t\t\t\t\t\r\n                                    \r\n\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?= $product_one['url'] ?>\" title=\"<?= $product_one['name'] ?>\" class=\"product-image\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->product->image->getResize($product_one['image'],[100,100],false) ?>\" alt=\"<?= $product_one['name'] ?>\" width=\"75\" height=\"75\">\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t<h2 class=\"product-name\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= $product_one['url'] ?>\"><?= $product_one['name'] ?></a>\r\n\t\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t\t<?php  if(is_array($product_one['custom_option_info'])):  ?>\r\n\t\t\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php foreach($product_one['custom_option_info'] as $label => $val):  ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li><?= Yii::$service->page->translate->__(ucwords($label)).':' ?><?= Yii::$service->page->translate->__($val) ?> </li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<?php endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif;  ?>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_price']); ?></span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_weight']); ?>Kg</span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_volume']); ?>c\u33a1</span>                \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                \r\n\t\t\t\t   \r\n\t\t\t\t\t\t\t\t\t<td class=\"a-center\">\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"width:60px;margin:auto\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"cartqtydown changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\"></a>\r\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"cart[qty]\" size=\"4\" title=\"Qty\" class=\"input-text qty\" rel=\"<?= $product_one['item_id']; ?>\" maxlength=\"12\" value=\"<?= $product_one['qty']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"cartqtyup changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\"></a>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_row_price']); ?></span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_row_weight']); ?>Kg</span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    \r\n                                    <td class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?= Format::price($product_one['product_row_volume']); ?>c\u33a1</span>                            \r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n                                    \r\n                                    \r\n\t\t\t\t\t\t\t\t\t<td class=\"a-right last\">\r\n\t\t\t\t\t\t\t\t\t\t<a style=\"margin-right: 15px;float: right;\" href=\"javascript:void(0)\"  rel=\"<?= $product_one['item_id']; ?>\" title=\"Remove item\" class=\"btn-remove btn-remove2\"><?= Yii::$service->page->translate->__('Remove item');?></a>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<?php  endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<?php  endif;  ?>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div class=\"cart-collaterals\">\r\n\t\t\t\t\t<div class=\"col2-set\">\r\n\t\t\t\t\t\t<div class=\"col-1\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"col-2\">\r\n\t\t\t\t\t\t\t<form id=\"discount-coupon-form\" >\r\n\t\t\t\t\t\t\t\t<div class=\"discount\">\r\n\t\t\t\t\t\t\t\t\t<h2><?= Yii::$service->page->translate->__('Discount Codes');?></h2>\r\n\t\t\t\t\t\t\t\t\t<div class=\"discount-form\">\r\n\t\t\t\t\t\t\t\t\t\t<label for=\"coupon_code\"><?= Yii::$service->page->translate->__('Enter your coupon code if you have one.');?></label>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"input-box\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" class=\"couponType\"  value=\"<?= $cart_info['coupon_code'] ? 1 : 2 ; ?>\"  />\r\n\t\t\t\t\t\t\t\t\t\t\t<input style=\"color:#777;\" class=\"input-text\" id=\"coupon_code\" name=\"coupon_code\" value=\"<?= $cart_info['coupon_code']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"buttons-cou\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"add_coupon_submit submitbutton\"><span><span><?= Yii::$service->page->translate->__($cart_info['coupon_code'] ? 'Cancel Coupon' : 'Add Coupon') ; ?></span></span> </a>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"coupon_add_log\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"totals cart-totals\">\r\n\t\t\t\t\t\t<div class=\"process_total\">\r\n\t\t\t\t\t\t\t<table id=\"shopping-cart-totals-table\">\r\n\t\t\t\t\t\t\t\t<colgroup>\r\n\t\t\t\t\t\t\t\t\t<col>\r\n\t\t\t\t\t\t\t\t\t<col width=\"1\">\r\n\t\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Totla');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_total']); ?>\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Weight');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?= Format::price($cart_info['product_weight']); ?> Kg\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Sub Volume');?> : \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">\r\n                                                <?= Format::price($cart_info['product_volume']); ?> c\u33a1\r\n                                            </span>    \r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    <tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Discount');?> :    </td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"price\">-<?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['coupon_cost']); ?></span>    </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t<table id=\"shopping-cart-totals-table2\">\r\n\t\t\t\t\t\t\t\t<colgroup>\r\n\t\t\t\t\t\t\t\t\t<col>\r\n\t\t\t\t\t\t\t\t\t<col width=\"90\">\r\n\t\t\t\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-left\" colspan=\"1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<strong><?= Yii::$service->page->translate->__('Grand Total');?></strong>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"\" class=\"a-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t<strong><span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['grand_total']) ?></span></strong>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"proceed_to_checkout\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<button onclick=\"location.href='<?= Yii::$service->url->getUrl('checkout/onepage');  ?>'\" type=\"button\" title=\"Proceed to Checkout\" class=\"button btn-proceed-checkout btn-checkout\"><span><span><?= Yii::$service->page->translate->__('Proceed to Pay');?></span></span></button>\r\n\t\t\t\t\t\t\t<?php if ($enablePaypalExpress): ?>\r\n                                <span class=\"or\">- <?= Yii::$service->page->translate->__('OR');?> - </span>\r\n                                <a class=\"express_paypal\" href=\"<?= Yii::$service->url->getUrl('payment/paypal/express/start');    ?>\">\r\n                                \r\n                                </a>\r\n                            <?php endif;  ?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t<?php else: ?>\r\n\t\t<div class=\"empty_cart\">\r\n\t\t<?php\r\n\t\t\t$param = ['urlB' => '<a rel=\"nofollow\" href=\"'.Yii::$service->url->getUrl('customer/account/login').'\">','urlE' =>'</a>'];\r\n\t\t?>\t\r\n\t\t\r\n\t\t<div id=\"empty_cart_info\">\r\n\t\t\t<?= Yii::$service->page->translate->__('Your Shopping Cart is empty');?>\r\n\t\t\t<a href=\"<?= Yii::$service->url->homeUrl(); ?>\"><?= Yii::$service->page->translate->__('Start shopping now!');?></a>\r\n\t\t\t<br>\r\n\t\t\t<?= Yii::$service->page->translate->__('Please {urlB}log in{urlE} to view the products you have previously added to your Shopping Cart.',$param);?>\r\n\t\t</div>\r\n  \r\n  \r\n\t\t</div>\r\n\t<?php  endif; ?>\r\n\t</div>\r\n</div>\r\n\r\n<script>\r\n\t// add to cart js\t\r\n<?php $this->beginBlock('changeCartInfo') ?>\r\ncsrfName = \"<?= CRequest::getCsrfName() ?>\";\r\ncsrfVal = \"<?= CRequest::getCsrfValue() ?>\";\r\n$(document).ready(function(){\r\n    // set select all checkbox\r\n    selectall = \"<?=  \\Yii::$service->helper->htmlEncode(Yii::$app->request->get('selectall')) ?>\";\r\n    selectAllChecked = false;\r\n    if (selectall == 1) {\r\n        selectAllChecked = true;\r\n    } else {\r\n        item_select_all = 1;\r\n        $(\".cart_select_item\").each(function(){\r\n            checked = $(this).is(':checked');\r\n            if (checked == false) {\r\n                item_select_all = 0;\r\n            }\r\n        });\r\n        if (item_select_all == 1) {\r\n            selectAllChecked = true;\r\n        }\r\n    }\r\n    $(\".cart_select_all\").attr(\"checked\",selectAllChecked);\r\n\tcurrentUrl = \"<?= Yii::$service->url->getUrl('checkout/cart') ?>\";\r\n\tupdateCartInfoUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/updateinfo') ?>\";\r\n    selectOneProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectone') ?>\";\r\n    selectAllProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectall') ?>\";\r\n\t$(\".cartqtydown\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tnum = $(this).attr(\"num\");\r\n\t\tif(num > 1){\r\n\t\t\t$data = {\r\n\t\t\t\titem_id:$item_id,\r\n\t\t\t\tup_type:\"less_one\"\r\n\t\t\t};\r\n            $data[csrfName] = csrfVal;\r\n            \r\n\t\t\tjQuery.ajax({\r\n\t\t\t\tasync:true,\r\n\t\t\t\ttimeout: 6000,\r\n\t\t\t\tdataType: 'json', \r\n\t\t\t\ttype:'post',\r\n\t\t\t\tdata: $data,\r\n\t\t\t\turl:updateCartInfoUrl,\r\n\t\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\t\tif (data.status == 'success') {\r\n\t\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t\t} else {\r\n                        alert(data.content);\r\n                    }\r\n\t\t\t\t},\r\n\t\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t\r\n\t$(\".cartqtyup\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"add_one\"\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif (data.status == 'success') {\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t} else {\r\n                    alert(data.content);\r\n                }\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n    \r\n    $(\".btn-remove\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"remove\"\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t$(\".cart_select_item\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tchecked:checked\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectOneProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n    \r\n    \r\n    $(\".cart_select_all\").click(function(){\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\tchecked:checked\r\n\t\t};\r\n        $data[csrfName] = csrfVal;\r\n        \r\n        selectCurrentUrl = currentUrl + '?selectall=' + checked;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectAllProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = selectCurrentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n\t\r\n\t$(\".add_coupon_submit\").click(function(){\r\n\t\tcoupon_code = $(\"#coupon_code\").val();\r\n\t\tcoupon_type = $(\".couponType\").val();\r\n\t\tcoupon_url = \"\";\r\n\t\tif(coupon_type == 2){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/addcoupon'); ?>\";\r\n\t\t}else if(coupon_type == 1){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/cancelcoupon'); ?>\";\r\n\t\t}\r\n\t\tif(!coupon_code){\r\n\t\t\t//alert(\"coupon can not empty!\");\r\n\t\t}\r\n        $data = {\"coupon_code\":coupon_code};\r\n        $data[csrfName] = csrfVal;\r\n\t\t//coupon_url = $(\"#discount-coupon-form\").attr(\"action\");\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype: 'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:coupon_url,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}else if(data.content == 'nologin'){\r\n\t\t\t\t\twindow.location.href=\"<?=  Yii::$service->url->getUrl('customer/account/login'); ?>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\".coupon_add_log\").html(data.content);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t\r\n\t\r\n});\r\n\r\n<?php $this->endBlock(); ?> \r\n<?php $this->registerJs($this->blocks['changeCartInfo'],\\yii\\web\\View::POS_END);//\u5c06\u7f16\u5199\u7684js\u4ee3\u7801\u6ce8\u518c\u5230\u9875\u9762\u5e95\u90e8 ?>\r\n</script>\r\n<?php  // Yii::$service->page->trace->getTraceCartJsCode($trace_cart_info) // \u8fd9\u4e2a\u6539\u6210\u670d\u52a1\u7aef\u53d1\u9001\u52a0\u5165\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u800c\u4e0d\u662fjs\u4f20\u9012\u7684\u65b9\u5f0f ?>\r\n\r\n", "<?php\r\n/**\r\n * FecShop file.\r\n *\r\n * @link http://www.fecshop.com/\r\n * @copyright Copyright (c) 2016 FecShop Software LLC\r\n * @license http://www.fecshop.com/license/\r\n */\r\n?>\r\n<?php\r\nuse fecshop\\app\\apphtml5\\helper\\Format;\r\nuse fec\\helpers\\CRequest;\r\n?>\r\n<div class=\"main container one-column\">\r\n\t<div class=\"col-main\">\r\n     <?= Yii::$service->page->widget->render('base/flashmessage'); ?>\r\n\t<?php if(is_array($cart_info) && !empty($cart_info)):   ?>\r\n\t\t\t    \r\n\t\t<div class=\"product_page\">\r\n\t\t\t\r\n\t\t\t<div class=\"cart\">\r\n\t\t\t\t<div class=\"page-title title-buttons\">\r\n\t\t\t\t\t<div class=\"shopping-cart-img\">\r\n\t\t\t\t\t\t<?= Yii::$service->page->translate->__('Shopping Cart'); ?>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"cart_info\">\r\n                    <div class=\"cart_select_div\">\r\n                        <input id=\"cart_select_all\" type=\"checkbox\" name=\"cart_select_all\" class=\"cart_select cart_select_all\">\r\n                        &nbsp;\r\n                        <label for=\"cart_select_all\">Select All Product</label>\r\n                    </div>\r\n\t\t\t\t\t<?php if(is_array($cart_info['products']) && (!empty($cart_info['products']))): ?>\r\n\t\t\t\t\t\t<?php foreach($cart_info['products'] as $product_one): ?>\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-33\">\r\n                                    <input rel=\"<?= $product_one['item_id']; ?>\" <?=  ($product_one['active'] == Yii::$service->cart->quoteItem->activeStatus ) ?  'checked=\"checked\"' : '' ?> type=\"checkbox\" name=\"cart_select_item\" class=\"cart_select cart_select_item\">\r\n\t\t\t\t\t\t\t\t\t<a external href=\"<?= $product_one['url'] ?>\" title=\"<?= $product_one['name'] ?>\" class=\"product-image\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->product->image->getResize($product_one['image'],[150,150],false) ?>\" alt=\"<?= $product_one['name'] ?>\" width=\"75\" height=\"75\">\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"col-66\">\r\n\t\t\t\t\t\t\t\t\t<h2 class=\"product-name\">\r\n\t\t\t\t\t\t\t\t\t\t<a external href=\"<?= $product_one['url'] ?>\"><?= $product_one['name'] ?></a>\r\n\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t<?php  if(is_array($product_one['custom_option_info'])):  ?>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"options\">\r\n\t\t\t\t\t\t\t\t\t\t<?php foreach($product_one['custom_option_info'] as $label => $val):  ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<li><?= Yii::$service->page->translate->__(ucwords($label).':') ?><?= Yii::$service->page->translate->__($val) ?> </li>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<?php endforeach;  ?>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t<?php endif;  ?>\r\n\t\t\t\t\t\t\t\t\t<span class=\"cart-price\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"price\"><?=  $currency_info['symbol'];  ?><?= Format::price($product_one['product_price']); ?></span>                \r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<div class=\"cart_qty\">\r\n\t\t\t\t\t\t\t\t\t\t<a  externalhref=\"javascript:void(0)\" class=\"cartqtydown changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\">-</a>\r\n\t\t\t\t\t\t\t\t\t\t<input name=\"cart[qty]\" size=\"4\" title=\"Qty\" class=\"input-text qty\" rel=\"<?= $product_one['item_id']; ?>\" maxlength=\"12\" value=\"<?= $product_one['qty']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t<a externalhref=\"javascript:void(0)\" class=\"cartqtyup changeitemqty\" rel=\"<?= $product_one['item_id']; ?>\" num=\"<?= $product_one['qty']; ?>\">+</a>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<a  externalhref=\"javascript:void(0)\"  rel=\"<?= $product_one['item_id']; ?>\" title=\"Remove item\" class=\"btn-remove btn-remove2\"><span class=\"icon icon-remove\"></span></a>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"cart-collaterals\">\r\n\t\t\t\t\t<div class=\"col2-set\">\r\n\t\t\t\t\t\t<div class=\"col-1\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"col-2\">\r\n\t\t\t\t\t\t\t<form id=\"discount-coupon-form\" >\r\n\t\t\t\t\t\t\t\t<div class=\"discount\">\r\n\t\t\t\t\t\t\t\t\t<h2><?= Yii::$service->page->translate->__('Discount Codes');?></h2>\r\n\t\t\t\t\t\t\t\t\t<div class=\"discount-form\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"input-box\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" class=\"couponType\"  value=\"<?= $cart_info['coupon_code'] ? 1 : 2 ; ?>\"  />\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input style=\"color:#777;\" class=\"input-text\" id=\"coupon_code\" name=\"coupon_code\" value=\"<?= $cart_info['coupon_code']; ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"buttons-coupon\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a external data-role=\"button\" href=\"javascript:void(0)\"  class=\"add_coupon_submit submitbutton ui-link ui-btn ui-shadow ui-corner-all\" role=\"button\">\r\n                                                <span>\r\n                                                    <span><?= Yii::$service->page->translate->__($cart_info['coupon_code'] ? 'Cancel Coupon' : 'Add Coupon') ; ?></span>\r\n                                                </span>\r\n                                            </a>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"coupon_add_log\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"cart_cost\">\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Total');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_total']); ?></div>\r\n\t\t\t\t\t\t</div>\r\n                        <div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Weight');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_weight']); ?> Kg</div>\r\n\t\t\t\t\t\t</div>\r\n                        <div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Sub Volume');?> :  </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['product_volume']); ?> c\u33a1</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Shipping Cost');?>  : </div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['shipping_cost']); ?></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Discount');?>  :</div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\">-<?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['coupon_cost']); ?>%</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t<div class=\"col-66\"><?= Yii::$service->page->translate->__('Grand Total');?>  :</div>\r\n\t\t\t\t\t\t\t<div class=\"col-33\"><?=  $currency_info['symbol'];  ?><?= Format::price($cart_info['grand_total']) ?></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"totals cart-totals\">\r\n\t\t\t\t\t\t<div class=\"proceed_to_checkout\">\r\n\t\t\t\t\t\t\t<div class=\"row no-gutter\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-50\">\r\n\t\t\t\t\t\t\t\t\t<button onclick=\"location.href='<?= Yii::$service->url->getUrl('checkout/onepage');  ?>'\" type=\"button\" title=\"Proceed to Checkout\" class=\"button btn-proceed-checkout btn-checkout\"><span><span><?= Yii::$service->page->translate->__('Proceed to Pay');?></span></span></button>\r\n                                </div>\r\n                                <?php if ($enablePaypalExpress): ?>\r\n\t\t\t\t\t\t\t\t<div class=\"col-50\">\r\n\t\t\t\t\t\t\t\t\t<a  external class=\"express_paypal\" href=\"<?= Yii::$service->url->getUrl('payment/paypal/express/start');    ?>\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?= Yii::$service->image->getImgUrl('/images/pay.png') ?>\"  />\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t</div>\r\n                                <?php endif;  ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"clear\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t<?php else: ?>\r\n\t\t<div class=\"empty_cart \">\r\n            <?php\r\n                $param = ['urlB' => '<a  external rel=\"nofollow\" href=\"'.Yii::$service->url->getUrl('customer/account/login').'\">','urlE' =>'</a>'];\r\n            ?>\t\r\n            \r\n            <div id=\"empty_cart_info\">\r\n                <?= Yii::$service->page->translate->__('Your Shopping Cart is empty');?>\r\n                <a external href=\"<?= Yii::$service->url->homeUrl(); ?>\"><?= Yii::$service->page->translate->__('Start shopping now!');?></a>\r\n                <br>\r\n                <?= Yii::$service->page->translate->__('Please {urlB}log in{urlE} to view the products you have previously added to your Shopping Cart.',$param);?>\r\n            </div>\r\n\t\t</div>\r\n        <div class=\"empty_cart_img\">\r\n            \r\n        </div>\r\n\t<?php  endif; ?>\r\n\t</div>\r\n</div>\r\n\r\n<script>\r\n\t// add to cart js\t\r\n<?php $this->beginBlock('changeCartInfo') ?>\r\ncsrfName = \"<?= CRequest::getCsrfName() ?>\";\r\ncsrfVal = \"<?= CRequest::getCsrfValue() ?>\";\r\n$(document).ready(function(){\r\n\t// set select all checkbox\r\n    // selectall = \"<?= Yii::$app->request->get('selectall') ?>\";\r\n    selectall = \"<?=  \\Yii::$service->helper->htmlEncode(Yii::$app->request->get('selectall')) ?>\";\r\n    selectAllChecked = false;\r\n    if (selectall == 1) {\r\n        selectAllChecked = true;\r\n    } else {\r\n        item_select_all = 1;\r\n        $(\".cart_select_item\").each(function(){\r\n            checked = $(this).is(':checked');\r\n            if (checked == false) {\r\n                item_select_all = 0;\r\n            }\r\n        });\r\n        if (item_select_all == 1) {\r\n            selectAllChecked = true;\r\n        }\r\n    }\r\n    if (selectAllChecked) {\r\n        $(\".cart_select_all\").attr(\"checked\",selectAllChecked);\r\n    } else {\r\n        $(\".cart_select_all\").removeAttr(\"checked\");\r\n    }\r\n\tcurrentUrl = \"<?= Yii::$service->url->getUrl('checkout/cart') ?>\";\r\n\tupdateCartInfoUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/updateinfo') ?>\";\r\n    selectOneProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectone') ?>\";\r\n    selectAllProductUrl = \"<?= Yii::$service->url->getUrl('checkout/cart/selectall') ?>\";\r\n\t$(\".cartqtydown\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tnum = $(this).attr(\"num\");\r\n\t\tif(num > 1){\r\n\t\t\t$data = {\r\n\t\t\t\titem_id:$item_id,\r\n\t\t\t\tup_type:\"less_one\"\r\n\t\t\t};\r\n\t\t\t$data[csrfName] = csrfVal;\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync:true,\r\n\t\t\t\ttimeout: 6000,\r\n\t\t\t\tdataType: 'json', \r\n\t\t\t\ttype:'post',\r\n\t\t\t\tdata: $data,\r\n\t\t\t\turl:updateCartInfoUrl,\r\n\t\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t\t} else {\r\n                        alert(data.content);\r\n                    }\r\n\t\t\t\t},\r\n\t\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t\r\n\t$(\".cartqtyup\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"add_one\"\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t} else {\r\n                    alert(data.content);\r\n                }\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t});\r\n\t\r\n\t$(\".btn-remove\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\t\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tup_type:\"remove\"\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:updateCartInfoUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\r\n\t}); \r\n\t\r\n    $(\".cart_select_item\").click(function(){\r\n\t\t$item_id = $(this).attr(\"rel\");\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\titem_id:$item_id,\r\n\t\t\tchecked:checked\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectOneProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = currentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n    \r\n    \r\n    $(\".cart_select_all\").click(function(){\r\n\t\tchecked = $(this).is(':checked');\r\n        checked = checked ? 1 : 0;\r\n\t\t$data = {\r\n\t\t\tchecked:checked\r\n\t\t};\r\n\t\t$data[csrfName] = csrfVal;\r\n        selectCurrentUrl = currentUrl + '?selectall=' + checked;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype:'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:selectAllProductUrl,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href = selectCurrentUrl;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".add_coupon_submit\").click(function(){\r\n\t\tcoupon_code = $(\"#coupon_code\").val();\r\n\t\tcoupon_type = $(\".couponType\").val();\r\n\t\tcoupon_url = \"\";\r\n\t\tif(coupon_type == 2){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/addcoupon'); ?>\";\r\n\t\t}else if(coupon_type == 1){\r\n\t\t\tcoupon_url = \"<?=  Yii::$service->url->getUrl('checkout/cart/cancelcoupon'); ?>\";\r\n\t\t}\r\n\t\tif(!coupon_code){\r\n\t\t\t//alert(\"coupon can not empty!\");\r\n\t\t}\r\n\t\t$data = {\"coupon_code\":coupon_code};\r\n\t\t$data[csrfName] = csrfVal;\r\n\t\t$.ajax({\r\n\t\t\tasync:true,\r\n\t\t\ttimeout: 6000,\r\n\t\t\tdataType: 'json', \r\n\t\t\ttype: 'post',\r\n\t\t\tdata: $data,\r\n\t\t\turl:coupon_url,\r\n\t\t\tsuccess:function(data, textStatus){ \r\n\t\t\t\tif(data.status == 'success'){\r\n\t\t\t\t\twindow.location.href=currentUrl;\r\n\t\t\t\t}else if(data.content == 'nologin'){\r\n\t\t\t\t\twindow.location.href=\"<?=  Yii::$service->url->getUrl('customer/account/login'); ?>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\".coupon_add_log\").html(data.content);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function (XMLHttpRequest, textStatus, errorThrown){}\r\n\t\t});\r\n\t\t\t\r\n\t\t\r\n\t});\r\n\t\r\n\t\r\n\t\r\n});\r\n\r\n<?php $this->endBlock(); ?> \r\n<?php $this->registerJs($this->blocks['changeCartInfo'],\\yii\\web\\View::POS_END);//\u5c06\u7f16\u5199\u7684js\u4ee3\u7801\u6ce8\u518c\u5230\u9875\u9762\u5e95\u90e8 ?>\r\n</script>\r\n<?php // Yii::$service->page->trace->getTraceCartJsCode($trace_cart_info) // \u8fd9\u4e2a\u6539\u6210\u670d\u52a1\u7aef\u53d1\u9001\u52a0\u5165\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u800c\u4e0d\u662fjs\u4f20\u9012\u7684\u65b9\u5f0f  ?>"], "filenames": ["app/appfront/theme/base/front/checkout/cart/index.php", "app/apphtml5/theme/base/html5/checkout/cart/index.php"], "buggy_code_start_loc": [294, 175], "buggy_code_end_loc": [295, 176], "fixing_code_start_loc": [294, 175], "fixing_code_end_loc": [295, 177], "type": "CWE-79", "message": "An issue was found in yii2_fecshop 2.x. There is a reflected XSS vulnerability in the check cart page.", "other": {"cve": {"id": "CVE-2020-22808", "sourceIdentifier": "cve@mitre.org", "published": "2021-04-29T19:15:08.863", "lastModified": "2021-05-05T17:55:01.790", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was found in yii2_fecshop 2.x. There is a reflected XSS vulnerability in the check cart page."}, {"lang": "es", "value": "Se detect\u00f3 un problema en yii2_fecshop versi\u00f3n 2.x.&#xa0;Se presenta una vulnerabilidad de tipo XSS reflejado en la comprobaci\u00f3n de la p\u00e1gina cart."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fecmall_project:fecmall:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.0.0", "versionEndIncluding": "2.13.3", "matchCriteriaId": "0D36091A-60B7-48EE-87CD-1073729E3455"}]}]}], "references": [{"url": "https://github.com/fecshop/yii2_fecshop/commit/8fac6455882333cfe3d81c4121d523813e28e31a", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/fecshop/yii2_fecshop/issues/87", "source": "cve@mitre.org", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fecshop/yii2_fecshop/commit/8fac6455882333cfe3d81c4121d523813e28e31a"}}