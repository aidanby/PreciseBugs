{"buggy_code": ["<?php\n\n/**\n * The main multi-site instances frontend.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2012-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2012-03-16\n */\n\nuse phpMyFAQ\\Core\\Exception;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Instance;\nuse phpMyFAQ\\Instance\\Client;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\System;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n?>\n  <header class=\"row\">\n    <div class=\"col-lg-12\">\n      <h2 class=\"page-header\">\n        <i aria-hidden=\"true\" class=\"fa fa-wrench fa-fw\"></i> <?= $PMF_LANG['ad_menu_instances']; ?>\n          <?php if (\n            $user->perm->hasPermission($user->getUserId(), 'addinstances') &&\n              is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite')\n) : ?>\n            <div class=\"float-right\">\n              <a class=\"btn btn-sm btn-success\" data-toggle=\"modal\" href=\"#pmf-modal-add-instance\">\n                <i aria-hidden=\"true\" class=\"fa fa-plus\"></i> <?= $PMF_LANG['ad_instance_add'] ?>\n              </a>\n            </div>\n          <?php endif; ?>\n      </h2>\n    </div>\n  </header>\n\n  <div class=\"row\">\n  <div class=\"col-lg-12\">\n<?php\nif ($user->perm->hasPermission($user->getUserId(), 'editinstances')) {\n    $instance = new Instance($faqConfig);\n    $instanceId = Filter::filterInput(INPUT_POST, 'instance_id', FILTER_VALIDATE_INT);\n\n    // Check, if /multisite is writeable\n    if (!is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite')) {\n        printf(\n            '<p class=\"alert alert-danger\">%s</p>',\n            $PMF_LANG['ad_instance_error_notwritable']\n        );\n    }\n\n    // Update client instance\n    if ('updateinstance' === $action && is_integer($instanceId)) {\n        $system = new System();\n        $originalClient = new Client($faqConfig);\n        $updatedClient = new Client($faqConfig);\n        $moveInstance = false;\n\n        // Collect updated data for database\n        $updatedData = [];\n        $updatedData['url'] = Filter::filterInput(INPUT_POST, 'url', FILTER_UNSAFE_RAW);\n        $updatedData['instance'] = Filter::filterInput(INPUT_POST, 'instance', FILTER_UNSAFE_RAW);\n        $updatedData['comment'] = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n\n        // Original data\n        $originalData = $originalClient->getInstanceById($instanceId);\n\n        if ($originalData->url !== $updatedData['url']) {\n            $moveInstance = true;\n        }\n\n        if ($updatedClient->updateInstance($instanceId, $updatedData)) {\n            if ($moveInstance) {\n                try {\n                    $updatedClient->moveClientFolder($originalData->url, $updatedData['url']);\n                    $updatedClient->deleteClientFolder($originalData->url);\n                } catch (Exception $e) {\n                    // handle exception\n                }\n            }\n            printf(\n                '<p class=\"alert alert-success\">%s%s</p>',\n                '<a class=\"close\" data-dismiss=\"alert\" href=\"#\">&times;</a>',\n                $PMF_LANG['ad_config_saved']\n            );\n        } else {\n            printf(\n                '<p class=\"alert alert-danger\">%s%s<br/>%s</p>',\n                '<a class=\"close\" data-dismiss=\"alert\" href=\"#\">&times;</a>',\n                $PMF_LANG['ad_entryins_fail'],\n                $faqConfig->getDb()->error()\n            );\n        }\n    }\n    ?>\n  <table class=\"table\">\n    <thead>\n    <tr>\n      <th>#</th>\n      <th><?= $PMF_LANG['ad_instance_url'] ?></th>\n      <th><?= $PMF_LANG['ad_instance_path'] ?></th>\n      <th colspan=\"3\"><?= $PMF_LANG['ad_instance_name'] ?></th>\n    </tr>\n    </thead>\n    <tbody>\n    <?php\n    foreach ($instance->getAllInstances() as $site) :\n        $currentInstance = new Instance($faqConfig);\n        $currentInstance->getInstanceById($site->id);\n        $currentInstance->setId($site->id);\n        ?>\n      <tr id=\"row-instance-<?= $site->id ?>\">\n        <td><?= $site->id ?></td>\n        <td>\n          <a href=\"<?= Strings::htmlentities($site->url . $site->instance, ENT_QUOTES) ?>\">\n                <?= Strings::htmlentities($site->url, ENT_QUOTES) ?>\n          </a>\n        </td>\n        <td><?= Strings::htmlentities($site->instance, ENT_QUOTES) ?></td>\n        <td><?= Strings::htmlentities($site->comment, ENT_QUOTES) ?></td>\n        <td>\n          <a href=\"?action=editinstance&instance_id=<?= $site->id ?>\" class=\"btn btn-info\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n          </a>\n        </td>\n        <td>\n            <?php if ($currentInstance->getConfig('isMaster') !== true) : ?>\n              <a href=\"javascript:;\" id=\"delete-instance-<?= $site->id ?>\"\n                 class=\"btn btn-danger pmf-instance-delete\"\n                 data-csrf-token=\"<?= $user->getCsrfTokenFromSession() ?>\">\n                <i aria-hidden=\"true\" class=\"fa fa-trash\"></i>\n              </a>\n            <?php endif; ?>\n        </td>\n      </tr>\n    <?php endforeach; ?>\n    </tbody>\n  </table>\n\n  <div class=\"modal fade\" id=\"pmf-modal-add-instance\">\n    <div class=\"modal-dialog modal-lg\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h4><?= $PMF_LANG['ad_instance_add'] ?></h4>\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n          </button>\n        </div>\n        <div class=\"modal-body\">\n          <form action=\"#\" method=\"post\" accept-charset=\"utf-8\">\n            <input type=\"hidden\" name=\"csrf\" id=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"url\">\n                  <?= $PMF_LANG['ad_instance_url'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <div class=\"input-group\">\n                  <div class=\"input-group-prepend\">\n                    <div class=\"input-group-text\">https://</div>\n                  </div>\n                  <input class=\"form-control\" type=\"text\" name=\"url\" id=\"url\" required>\n                  <div class=\"input-group-append\">\n                    <div class=\"input-group-text\">.<?= $_SERVER['SERVER_NAME'] ?></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"instance\">\n                  <?= $PMF_LANG['ad_instance_path'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"instance\" id=\"instance\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"comment\">\n                  <?= $PMF_LANG['ad_instance_name'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"comment\" id=\"comment\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"email\">\n                  <?= $PMF_LANG['ad_instance_email'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"email\" name=\"email\" id=\"email\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"admin\">\n                  <?= $PMF_LANG['ad_instance_admin'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"admin\" id=\"admin\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"password\">\n                  <?= $PMF_LANG['ad_instance_password'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"password\" autocomplete=\"off\" name=\"password\" id=\"password\" required>\n              </div>\n            </div>\n          </form>\n        </div>\n        <div class=\"modal-footer\">\n          <p><?= $PMF_LANG['ad_instance_hint'] ?></p>\n          <button class=\"btn btn-primary pmf-instance-add\">\n              <?= $PMF_LANG['ad_instance_button'] ?>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function() {\n\n      // Add instance\n      $('.pmf-instance-add').on('click', function(event) {\n        event.preventDefault();\n        const csrf = $('#csrf').val();\n        const url = $('#url').val();\n        const instance = $('#instance').val();\n        const comment = $('#comment').val();\n        const email = $('#email').val();\n        const admin = $('#admin').val();\n        const password = $('#password').val();\n\n        $.ajax({\n          url: 'index.php',\n          type: 'GET',\n          data: {\n            action: 'ajax', ajax: 'config', ajaxaction: 'add_instance', csrf: csrf, url: url,\n            instance: instance, comment: comment, email: email, admin: admin, password: password,\n          },\n          success: (data) => {\n            $('.modal').modal('hide');\n            $('.table tbody').append(\n              '<tr id=\"row-instance-' + data.added + '\">' +\n              '<td>' + data.added + '</td>' +\n              '<td><a href=\"' + data.url + '\">' + data.url + '</a></td>' +\n              '<td>' + instance + '</td>' +\n              '<td>' + comment + '</td>' +\n              '<td>' +\n              '<a href=\"?action=editinstance&instance_id=' + data.added +\n              '\" class=\"btn btn-info\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i></a>' +\n              '</td>' +\n              '<td>' +\n              '<a href=\"javascript:;\" id=\"delete-instance-' + data.added +\n              '\" class=\"btn btn-danger pmf-instance-delete\"><i aria-hidden=\"true\" class=\"fa fa-trash\"></i></a>' +\n              '</td>' +\n              '</tr>',\n            );\n          },\n          error: (data) => {\n            $('.table').after(\n              '<div class=\"alert alert-danger\">Could not add instance</div>',\n            );\n          }\n        });\n      });\n\n      // Delete instance\n      $('.pmf-instance-delete').click(function(event) {\n        event.preventDefault();\n        const targetId = event.target.id.split('-');\n        const id = targetId[2];\n        const csrf = this.getAttribute('data-csrf-token');\n\n        if (confirm('Are you sure?')) {\n          $.get('index.php',\n            { action: 'ajax', ajax: 'config', ajaxaction: 'delete_instance', instanceId: id, csrf: csrf },\n            function(data) {\n              if (typeof (data.deleted) === 'undefined') {\n                $('.table').after(\n                  '<div class=\"alert alert-danger\">' +\n                  '<?= $PMF_LANG['ad_instance_error_cannotdelete'] ?> ' + data.error +\n                  '</div>',\n                );\n              } else {\n                $('#row-instance-' + id).fadeOut('slow');\n              }\n            },\n            'json',\n          );\n        }\n      });\n\n    })();\n  </script>\n\n  </div>\n  </div>\n    <?php\n} else {\n    print $PMF_LANG['err_NotAuth'];\n}\n"], "fixing_code": ["<?php\n\n/**\n * The main multi-site instances frontend.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2012-2022 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2012-03-16\n */\n\nuse phpMyFAQ\\Core\\Exception;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Instance;\nuse phpMyFAQ\\Instance\\Client;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\System;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\n?>\n  <header class=\"row\">\n    <div class=\"col-lg-12\">\n      <h2 class=\"page-header\">\n        <i aria-hidden=\"true\" class=\"fa fa-wrench fa-fw\"></i> <?= $PMF_LANG['ad_menu_instances']; ?>\n          <?php if (\n            $user->perm->hasPermission($user->getUserId(), 'addinstances') &&\n              is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite')\n) : ?>\n            <div class=\"float-right\">\n              <a class=\"btn btn-sm btn-success\" data-toggle=\"modal\" href=\"#pmf-modal-add-instance\">\n                <i aria-hidden=\"true\" class=\"fa fa-plus\"></i> <?= $PMF_LANG['ad_instance_add'] ?>\n              </a>\n            </div>\n          <?php endif; ?>\n      </h2>\n    </div>\n  </header>\n\n  <div class=\"row\">\n  <div class=\"col-lg-12\">\n<?php\nif ($user->perm->hasPermission($user->getUserId(), 'editinstances')) {\n    $instance = new Instance($faqConfig);\n    $instanceId = Filter::filterInput(INPUT_POST, 'instance_id', FILTER_VALIDATE_INT);\n\n    // Check, if /multisite is writeable\n    if (!is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite')) {\n        printf(\n            '<p class=\"alert alert-danger\">%s</p>',\n            $PMF_LANG['ad_instance_error_notwritable']\n        );\n    }\n\n    // Update client instance\n    if ('updateinstance' === $action && is_integer($instanceId)) {\n        $system = new System();\n        $originalClient = new Client($faqConfig);\n        $updatedClient = new Client($faqConfig);\n        $moveInstance = false;\n\n        // Collect updated data for database\n        $updatedData = [];\n        $updatedData['url'] = Filter::filterInput(INPUT_POST, 'url', FILTER_UNSAFE_RAW);\n        $updatedData['instance'] = Filter::filterInput(INPUT_POST, 'instance', FILTER_UNSAFE_RAW);\n        $updatedData['comment'] = Filter::filterInput(INPUT_POST, 'comment', FILTER_UNSAFE_RAW);\n\n        // Original data\n        $originalData = $originalClient->getInstanceById($instanceId);\n\n        if ($originalData->url !== $updatedData['url']) {\n            $moveInstance = true;\n        }\n\n        if ($updatedClient->updateInstance($instanceId, $updatedData)) {\n            if ($moveInstance) {\n                try {\n                    $updatedClient->moveClientFolder($originalData->url, $updatedData['url']);\n                    $updatedClient->deleteClientFolder($originalData->url);\n                } catch (Exception $e) {\n                    // handle exception\n                }\n            }\n            printf(\n                '<p class=\"alert alert-success\">%s%s</p>',\n                '<a class=\"close\" data-dismiss=\"alert\" href=\"#\">&times;</a>',\n                $PMF_LANG['ad_config_saved']\n            );\n        } else {\n            printf(\n                '<p class=\"alert alert-danger\">%s%s<br/>%s</p>',\n                '<a class=\"close\" data-dismiss=\"alert\" href=\"#\">&times;</a>',\n                $PMF_LANG['ad_entryins_fail'],\n                $faqConfig->getDb()->error()\n            );\n        }\n    }\n    ?>\n  <table class=\"table\">\n    <thead>\n    <tr>\n      <th>#</th>\n      <th><?= $PMF_LANG['ad_instance_url'] ?></th>\n      <th><?= $PMF_LANG['ad_instance_path'] ?></th>\n      <th colspan=\"3\"><?= $PMF_LANG['ad_instance_name'] ?></th>\n    </tr>\n    </thead>\n    <tbody>\n    <?php\n    foreach ($instance->getAllInstances() as $site) :\n        $currentInstance = new Instance($faqConfig);\n        $currentInstance->getInstanceById($site->id);\n        $currentInstance->setId($site->id);\n        ?>\n      <tr id=\"row-instance-<?= $site->id ?>\">\n        <td><?= $site->id ?></td>\n        <td>\n          <a href=\"<?= Strings::htmlentities($site->url . $site->instance, ENT_QUOTES) ?>\">\n                <?= Strings::htmlentities($site->url, ENT_QUOTES) ?>\n          </a>\n        </td>\n        <td><?= Strings::htmlentities($site->instance, ENT_QUOTES) ?></td>\n        <td><?= Strings::htmlentities($site->comment, ENT_QUOTES) ?></td>\n        <td>\n          <a href=\"?action=editinstance&instance_id=<?= $site->id ?>\" class=\"btn btn-info\">\n            <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n          </a>\n        </td>\n        <td>\n            <?php if ($currentInstance->getConfig('isMaster') !== true) : ?>\n              <a href=\"javascript:;\" id=\"delete-instance-<?= $site->id ?>\"\n                 class=\"btn btn-danger pmf-instance-delete\"\n                 data-csrf-token=\"<?= $user->getCsrfTokenFromSession() ?>\">\n                <i aria-hidden=\"true\" class=\"fa fa-trash\"></i>\n              </a>\n            <?php endif; ?>\n        </td>\n      </tr>\n    <?php endforeach; ?>\n    </tbody>\n  </table>\n\n  <div class=\"modal fade\" id=\"pmf-modal-add-instance\">\n    <div class=\"modal-dialog modal-lg\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h4><?= $PMF_LANG['ad_instance_add'] ?></h4>\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n          </button>\n        </div>\n        <div class=\"modal-body\">\n          <form action=\"#\" method=\"post\" accept-charset=\"utf-8\">\n            <input type=\"hidden\" name=\"csrf\" id=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"url\">\n                  <?= $PMF_LANG['ad_instance_url'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <div class=\"input-group\">\n                  <div class=\"input-group-prepend\">\n                    <div class=\"input-group-text\">https://</div>\n                  </div>\n                  <input class=\"form-control\" type=\"text\" name=\"url\" id=\"url\" required>\n                  <div class=\"input-group-append\">\n                    <div class=\"input-group-text\">.<?= $_SERVER['SERVER_NAME'] ?></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"instance\">\n                  <?= $PMF_LANG['ad_instance_path'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"instance\" id=\"instance\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"comment\">\n                  <?= $PMF_LANG['ad_instance_name'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"comment\" id=\"comment\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"email\">\n                  <?= $PMF_LANG['ad_instance_email'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"email\" name=\"email\" id=\"email\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"admin\">\n                  <?= $PMF_LANG['ad_instance_admin'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"text\" name=\"admin\" id=\"admin\" required>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-form-label col-lg-4\" for=\"password\">\n                  <?= $PMF_LANG['ad_instance_password'] ?>:\n              </label>\n              <div class=\"col-lg-8\">\n                <input class=\"form-control\" type=\"password\" autocomplete=\"off\" name=\"password\" id=\"password\" required>\n              </div>\n            </div>\n          </form>\n        </div>\n        <div class=\"modal-footer\">\n          <p><?= $PMF_LANG['ad_instance_hint'] ?></p>\n          <button class=\"btn btn-primary pmf-instance-add\">\n              <?= $PMF_LANG['ad_instance_button'] ?>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function() {\n\n      // Add instance\n      $('.pmf-instance-add').on('click', function(event) {\n        event.preventDefault();\n        const csrf = $('#csrf').val();\n        const url = $('#url').val();\n        const instance = $('#instance').val();\n        const comment = $('#comment').val();\n        const email = $('#email').val();\n        const admin = $('#admin').val();\n        const password = $('#password').val();\n\n        const escape = (unsafe) => {\n          return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll(\"'\", '&#039;');\n        }\n\n        $.ajax({\n          url: 'index.php',\n          type: 'GET',\n          data: {\n            action: 'ajax', ajax: 'config', ajaxaction: 'add_instance', csrf: csrf, url: url,\n            instance: instance, comment: comment, email: email, admin: admin, password: password,\n          },\n          success: (data) => {\n            $('.modal').modal('hide');\n            $('.table tbody').append(\n              '<tr id=\"row-instance-' + data.added + '\">' +\n              '<td>' + data.added + '</td>' +\n              '<td><a href=\"' + data.url + '\">' + data.url + '</a></td>' +\n              '<td>' + escape(instance) + '</td>' +\n              '<td>' + escape(comment) + '</td>' +\n              '<td>' +\n              '<a href=\"?action=editinstance&instance_id=' + data.added +\n              '\" class=\"btn btn-info\"><i aria-hidden=\"true\" class=\"fa fa-pencil\"></i></a>' +\n              '</td>' +\n              '<td>' +\n              '<a href=\"javascript:;\" id=\"delete-instance-' + data.added +\n              '\" class=\"btn btn-danger pmf-instance-delete\"><i aria-hidden=\"true\" class=\"fa fa-trash\"></i></a>' +\n              '</td>' +\n              '</tr>',\n            );\n          },\n          error: (data) => {\n            $('.table').after(\n              '<div class=\"alert alert-danger\">Could not add instance</div>',\n            );\n          }\n        });\n      });\n\n      // Delete instance\n      $('.pmf-instance-delete').click(function(event) {\n        event.preventDefault();\n        const targetId = event.target.id.split('-');\n        const id = targetId[2];\n        const csrf = this.getAttribute('data-csrf-token');\n\n        if (confirm('Are you sure?')) {\n          $.get('index.php',\n            { action: 'ajax', ajax: 'config', ajaxaction: 'delete_instance', instanceId: id, csrf: csrf },\n            function(data) {\n              if (typeof (data.deleted) === 'undefined') {\n                $('.table').after(\n                  '<div class=\"alert alert-danger\">' +\n                  '<?= $PMF_LANG['ad_instance_error_cannotdelete'] ?> ' + data.error +\n                  '</div>',\n                );\n              } else {\n                $('#row-instance-' + id).fadeOut('slow');\n              }\n            },\n            'json',\n          );\n        }\n      });\n\n    })();\n  </script>\n\n  </div>\n  </div>\n    <?php\n} else {\n    print $PMF_LANG['err_NotAuth'];\n}\n"], "filenames": ["phpmyfaq/admin/instances.php"], "buggy_code_start_loc": [245], "buggy_code_end_loc": [261], "fixing_code_start_loc": [246], "fixing_code_end_loc": [265], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.11.", "other": {"cve": {"id": "CVE-2023-0791", "sourceIdentifier": "security@huntr.dev", "published": "2023-02-12T14:15:11.637", "lastModified": "2023-02-23T05:12:55.200", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.11."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.3, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.5}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.1.11", "matchCriteriaId": "0CADCF40-01A2-41DD-B454-4F5946570CA9"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/26663efcb0b67e421e4ecccad8f19e7106bb03ce", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/7152b340-c6f3-4ac8-9f62-f764a267488d", "source": "security@huntr.dev", "tags": ["Permissions Required"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/26663efcb0b67e421e4ecccad8f19e7106bb03ce"}}