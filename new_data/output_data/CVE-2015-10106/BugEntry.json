{"buggy_code": ["<?php\n/***************************************************************\n*  Copyright notice\n*\n*  (c) 2010 Marc Hoersken <info@marc-hoersken.de>\n*  All rights reserved\n*\n*  This script is part of the TYPO3 project. The TYPO3 project is\n*  free software; you can redistribute it and/or modify\n*  it under the terms of the GNU General Public License as published by\n*  the Free Software Foundation; either version 2 of the License, or\n*  (at your option) any later version.\n*\n*  The GNU General Public License can be found at\n*  http://www.gnu.org/copyleft/gpl.html.\n*\n*  This script is distributed in the hope that it will be useful,\n*  but WITHOUT ANY WARRANTY; without even the implied warranty of\n*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n*  GNU General Public License for more details.\n*\n*  This copyright notice MUST APPEAR in all copies of the script!\n***************************************************************/\n\nunset($MCONF);\n\nrequire_once('conf.php');\nrequire_once($BACK_PATH.'init.php');\nrequire_once($BACK_PATH.'template.php');\nrequire_once(PATH_t3lib.'class.t3lib_scbase.php');\n\n$LANG->includeLLFile('EXT:mh_httpbl/mod1/locallang.xml');\n$LANG->includeLLFile('EXT:mh_httpbl/locallang_db.xml');\n$BE_USER->modAccess($MCONF,1);\n$TBE_TEMPLATE->backPath = $BACK_PATH;\n\n/**\n * Module 'Honey Pot (http:BL)' for the 'mh_httpbl' extension.\n *\n * @author\tMarc Hoersken <info@marc-hoersken.de>\n * @author  Myroslav Holyak <vbhjckfd@gmail.com>\n * @package\tTYPO3\n * @subpackage\ttx_mhhttpbl\n */\nclass tx_mhhttpbl_module1 extends t3lib_SCbase {\n\tvar $pageinfo;\n\tvar $codes = array(\n\t\t0 => 'Search Engine',\n\t\t1 => 'Suspicious',\n\t\t2 => 'Harvester',\n\t\t3 => 'Suspicious &amp; Harvester',\n\t\t4 => 'Comment Spammer',\n\t\t5 => 'Suspicious &amp; Comment Spammer',\n\t\t6 => 'Harvester &amp; Comment Spammer',\n\t\t7 => 'Suspicious &amp; Harvester &amp; Comment Spammer'\n\t);\n\n\t/**\n\t * Initializes the Module\n\t * @return\tvoid\n\t */\n\tfunction init()\t{\n\t\tglobal $BE_USER,$LANG,$BACK_PATH,$TCA_DESCR,$TCA,$CLIENT,$TYPO3_CONF_VARS;\n\n\t\tparent::init();\n\t}\n\n\t/**\n\t * Adds items to the ->MOD_MENU array. Used for the function menu selector.\n\t *\n\t * @return\tvoid\n\t */\n\tfunction menuConfig()\t{\n\t\tglobal $LANG;\n\t\t$this->MOD_MENU = Array (\n\t\t\t'function' => Array (\n\t\t\t\t'1' => $LANG->getLL('function1'),\n\t\t\t\t'2' => $LANG->getLL('function2'),\n\t\t\t\t'3' => $LANG->getLL('function3'),\n\t\t\t)\n\t\t);\n\t\tparent::menuConfig();\n\t}\n\n\t/**\n\t * Main function of the module. Write the content to $this->content\n\t * If you chose \"web\" as main module, you will need to consider the $this->id parameter which will contain the uid-number of the page clicked in the page tree\n\t *\n\t * @return\t[type]\t\t...\n\t */\n\tfunction main()\t{\n\t\tglobal $BE_USER,$LANG,$BACK_PATH,$TCA_DESCR,$TCA,$CLIENT,$TYPO3_CONF_VARS;\n\n\t\t// Access check!\n\t\t// The page will show only if there is a valid page and if this page may be viewed by the user\n\t\t$this->pageinfo = t3lib_BEfunc::readPageAccess($this->id,$this->perms_clause);\n\t\t$access = is_array($this->pageinfo) ? 1 : 0;\n\n\t\tif (($this->id && $access) || ($BE_USER->user['admin'] && !$this->id))\t{\n\n\t\t\t\t// Draw the header.\n\t\t\t$this->doc = t3lib_div::makeInstance('bigDoc');\n\t\t\t$this->doc->backPath = $BACK_PATH;\n\t\t\t$this->doc->form='<form action=\"\" method=\"POST\">';\n\n\t\t\t\t// JavaScript\n\t\t\t$this->doc->JScode = '\n\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">\n\t\t\t\t\tscript_ended = 0;\n\t\t\t\t\tfunction jumpToUrl(URL)\t{\n\t\t\t\t\t\tdocument.location = URL;\n\t\t\t\t\t}\n\t\t\t\t</script>\n\t\t\t';\n\t\t\t$this->doc->postCode='\n\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">\n\t\t\t\t\tscript_ended = 1;\n\t\t\t\t\tif (top.fsMod) top.fsMod.recentIds[\"web\"] = 0;\n\t\t\t\t</script>\n\t\t\t';\n\n\t\t\t$headerSection = $this->doc->getHeader('pages',$this->pageinfo,$this->pageinfo['_thePath']).'<br />'.$LANG->sL('LLL:EXT:lang/locallang_core.xml:labels.path').': '.t3lib_div::fixed_lgd_cs($this->pageinfo['_thePath'],50);\n\n\t\t\t$this->content.=$this->doc->startPage($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->header($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->spacer(5);\n\t\t\t$this->content.=$this->doc->section('',$this->doc->funcMenu($headerSection,t3lib_BEfunc::getFuncMenu($this->id,'SET[function]',$this->MOD_SETTINGS['function'],$this->MOD_MENU['function'])));\n\t\t\t$this->content.=$this->doc->divider(5);\n\n\n\t\t\t// Render content:\n\t\t\t$this->moduleContent();\n\n\n\t\t\t// ShortCut\n\t\t\tif ($BE_USER->mayMakeShortcut())\t{\n\t\t\t\t$this->content.=$this->doc->spacer(20).$this->doc->section('',$this->doc->makeShortcutIcon('id',implode(',',array_keys($this->MOD_MENU)),$this->MCONF['name']));\n\t\t\t}\n\n\t\t\t$this->content.=$this->doc->spacer(10);\n\t\t} else {\n\t\t\t\t// If no access or if ID == zero\n\n\t\t\t$this->doc = t3lib_div::makeInstance('bigDoc');\n\t\t\t$this->doc->backPath = $BACK_PATH;\n\n\t\t\t$this->content.=$this->doc->startPage($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->header($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->spacer(5);\n\t\t\t$this->content.=$this->doc->spacer(10);\n\t\t}\n\t}\n\n\t/**\n\t * Prints out the module HTML\n\t *\n\t * @return\tvoid\n\t */\n\tfunction printContent()\t{\n\n\t\t$this->content.=$this->doc->endPage();\n\t\techo $this->content;\n\t}\n\n\t/**\n\t * Generates the module content\n\t *\n\t * @return\tvoid\n\t */\n\tfunction moduleContent()\t{\n\t\tglobal $LANG, $BACK_PATH, $BE_USER, $TYPO3_DB;\n\n\t\tif (t3lib_div::_GP('block_ip')) {\n\t\t\t$this->MOD_SETTINGS['function'] = 1;\n\t\t}\n\n\t\tswitch((string)$this->MOD_SETTINGS['function'])\t{\n\t\t\tcase 1:\n\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'tstamp < '.(time()-(60*60*24*7)));\n\n\t\t\t\tif (t3lib_div::_GP('move_whitelist')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_INSERTquery('tx_mhhttpbl_whitelist', array('cruser_id'=>$BE_USER->user['uid'], 'crdate'=>time(), 'tstamp'=>time(), 'whitelist_ip'=>t3lib_div::_GP('move_whitelist')));\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'block_ip = '.$GLOBALS['TYPO3_DB']->fullQuoteStr(t3lib_div::_GP('move_whitelist'), 'tx_mhhttpbl_blocklog'));\n\t\t\t\t} else if (t3lib_div::_GP('delete')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'block_ip = '.$GLOBALS['TYPO3_DB']->fullQuoteStr(t3lib_div::_GP('delete'), 'tx_mhhttpbl_blocklog'));\n\t\t\t\t} else if (t3lib_div::_GP('clear_log')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', '');\n\t\t\t\t}\n\n\t\t\t\t$content = '\n\t\t\t\t\t<a href=\"?clear_log=true\" title=\"'.$LANG->getLL('clear_log').'\">'.$LANG->getLL('clear_log').'</a>\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('time').' <a href=\"?sort=tstamp&amp;order=asc\">&uArr;</a><a href=\"?sort=tstamp&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_ip').' <a href=\"?sort=block_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=block_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_type').' <a href=\"?sort=block_type&amp;order=asc\">&uArr;</a><a href=\"?sort=block_type&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_score').' <a href=\"?sort=block_score&amp;order=asc\">&uArr;</a><a href=\"?sort=block_score&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\" class=\"c-headLineTable\"><b>'.$LANG->getLL('move_whitelist').' &amp; '.$LANG->getLL('delete').'</b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('block_ip')) {\n\t\t\t\t\t$where = \"block_ip = '\". t3lib_div::_GP('block_ip') .\"'\";\n\t\t\t\t} else {\n\t\t\t\t\t$where = '';\n\t\t\t\t}\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$order = t3lib_div::_GP('sort').' '.strtoupper(t3lib_div::_GP('order'));\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'tstamp DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('*', 'tx_mhhttpbl_blocklog', $where, '', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\">'.date('Y-m-d H:i:s', $row['tstamp']).'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$row['block_ip'].'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$this->codes[$row['block_type']].' ('.$row['block_type'].')</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$this->codes[$row['block_score']].' ('.$row['block_score'].')</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\"><a href=\"?move_whitelist='.$row['block_ip'].'\" title=\"'.$LANG->getLL('move_whitelist').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/move_record.gif\" alt=\"'.$LANG->getLL('move_whitelist').'\" /></a><a href=\"?delete='.$row['block_ip'].'\" title=\"'.$LANG->getLL('delete').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/garbage.gif\" alt=\"'.$LANG->getLL('delete').'\" /></a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function1'),$content,0,1);\n\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif (t3lib_div::_GP('whitelist_add')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_INSERTquery('tx_mhhttpbl_whitelist', array('cruser_id'=>$BE_USER->user['uid'], 'crdate'=>time(), 'tstamp'=>time(), 'whitelist_ip'=>implode('.', t3lib_div::_GP('whitelist_ip'))));\n\t\t\t\t} else if (t3lib_div::_GP('delete')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_whitelist', 'uid = '.intval(t3lib_div::_GP('delete')));\n\t\t\t\t}\n\n\t\t\t\t$content = '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"2\" cellpadding=\"0\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td><b>'.$LANG->getLL('tx_mhhttpbl_whitelist.whitelist_ip').'</b></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[0]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[1]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[2]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[3]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td><input type=\"submit\" name=\"whitelist_add\" value=\"+\" /></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$content .= '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('time').' <a href=\"?sort=tstamp&amp;order=asc\">&uArr;</a><a href=\"?sort=tstamp&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_whitelist.whitelist_ip').' <a href=\"?sort=whitelist_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=whitelist_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\" class=\"c-headLineTable\"><b>'.$LANG->getLL('delete').'</b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$order = t3lib_div::_GP('sort').' '.strtoupper(t3lib_div::_GP('order'));\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'tstamp DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('*', 'tx_mhhttpbl_whitelist', '', '', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\">'.date('Y-m-d H:i:s', $row['tstamp']).'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$row['whitelist_ip'].'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\"><a href=\"?delete='.$row['uid'].'\" title=\"'.$LANG->getLL('delete').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/garbage.gif\" alt=\"'.$LANG->getLL('delete').'\" /></a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function2'),$content,0,1);\n\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t$content = '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_ip').' <a href=\"?sort=block_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=block_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('count').' <a href=\"?sort=count&amp;order=asc\">&uArr;</a><a href=\"?sort=count&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$order = t3lib_div::_GP('sort').' '.strtoupper(t3lib_div::_GP('order'));\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'count DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('block_ip, COUNT(block_ip) as count', 'tx_mhhttpbl_blocklog', '', 'block_ip', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\"><a title=\"'.$LANG->getLL('lookup').'\" href=\"http://www.projecthoneypot.org/ip_'.$row['block_ip'].'\" target=\"_blank\">'.$row['block_ip'].'</a></td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\"><a title=\"'.$LANG->getLL('details').'\" href=\"?block_ip='.$row['block_ip'].'\">'.$row['count'].'</a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function3'),$content,0,1);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nif (defined('TYPO3_MODE') && $TYPO3_CONF_VARS[TYPO3_MODE]['XCLASS']['ext/mh_httpbl/mod1/index.php'])\t{\n\tinclude_once($TYPO3_CONF_VARS[TYPO3_MODE]['XCLASS']['ext/mh_httpbl/mod1/index.php']);\n}\n\n// Make instance:\n$SOBE = t3lib_div::makeInstance('tx_mhhttpbl_module1');\n$SOBE->init();\n\n// Include files?\nforeach($SOBE->include_once as $INC_FILE)\tinclude_once($INC_FILE);\n\n$SOBE->main();\n$SOBE->printContent();\n\n?>\n"], "fixing_code": ["<?php\n/***************************************************************\n*  Copyright notice\n*\n*  (c) 2010 Marc Hoersken <info@marc-hoersken.de>\n*  All rights reserved\n*\n*  This script is part of the TYPO3 project. The TYPO3 project is\n*  free software; you can redistribute it and/or modify\n*  it under the terms of the GNU General Public License as published by\n*  the Free Software Foundation; either version 2 of the License, or\n*  (at your option) any later version.\n*\n*  The GNU General Public License can be found at\n*  http://www.gnu.org/copyleft/gpl.html.\n*\n*  This script is distributed in the hope that it will be useful,\n*  but WITHOUT ANY WARRANTY; without even the implied warranty of\n*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n*  GNU General Public License for more details.\n*\n*  This copyright notice MUST APPEAR in all copies of the script!\n***************************************************************/\n\nunset($MCONF);\n\nrequire_once('conf.php');\nrequire_once($BACK_PATH.'init.php');\nrequire_once($BACK_PATH.'template.php');\nrequire_once(PATH_t3lib.'class.t3lib_scbase.php');\n\n$LANG->includeLLFile('EXT:mh_httpbl/mod1/locallang.xml');\n$LANG->includeLLFile('EXT:mh_httpbl/locallang_db.xml');\n$BE_USER->modAccess($MCONF,1);\n$TBE_TEMPLATE->backPath = $BACK_PATH;\n\n/**\n * Module 'Honey Pot (http:BL)' for the 'mh_httpbl' extension.\n *\n * @author\tMarc Hoersken <info@marc-hoersken.de>\n * @author  Myroslav Holyak <vbhjckfd@gmail.com>\n * @package\tTYPO3\n * @subpackage\ttx_mhhttpbl\n */\nclass tx_mhhttpbl_module1 extends t3lib_SCbase {\n\tvar $pageinfo;\n\tvar $codes = array(\n\t\t0 => 'Search Engine',\n\t\t1 => 'Suspicious',\n\t\t2 => 'Harvester',\n\t\t3 => 'Suspicious &amp; Harvester',\n\t\t4 => 'Comment Spammer',\n\t\t5 => 'Suspicious &amp; Comment Spammer',\n\t\t6 => 'Harvester &amp; Comment Spammer',\n\t\t7 => 'Suspicious &amp; Harvester &amp; Comment Spammer'\n\t);\n\n\t/**\n\t * Initializes the Module\n\t * @return\tvoid\n\t */\n\tfunction init()\t{\n\t\tglobal $BE_USER,$LANG,$BACK_PATH,$TCA_DESCR,$TCA,$CLIENT,$TYPO3_CONF_VARS;\n\n\t\tparent::init();\n\t}\n\n\t/**\n\t * Adds items to the ->MOD_MENU array. Used for the function menu selector.\n\t *\n\t * @return\tvoid\n\t */\n\tfunction menuConfig()\t{\n\t\tglobal $LANG;\n\t\t$this->MOD_MENU = Array (\n\t\t\t'function' => Array (\n\t\t\t\t'1' => $LANG->getLL('function1'),\n\t\t\t\t'2' => $LANG->getLL('function2'),\n\t\t\t\t'3' => $LANG->getLL('function3'),\n\t\t\t)\n\t\t);\n\t\tparent::menuConfig();\n\t}\n\n\t/**\n\t * Main function of the module. Write the content to $this->content\n\t * If you chose \"web\" as main module, you will need to consider the $this->id parameter which will contain the uid-number of the page clicked in the page tree\n\t *\n\t * @return\t[type]\t\t...\n\t */\n\tfunction main()\t{\n\t\tglobal $BE_USER,$LANG,$BACK_PATH,$TCA_DESCR,$TCA,$CLIENT,$TYPO3_CONF_VARS;\n\n\t\t// Access check!\n\t\t// The page will show only if there is a valid page and if this page may be viewed by the user\n\t\t$this->pageinfo = t3lib_BEfunc::readPageAccess($this->id,$this->perms_clause);\n\t\t$access = is_array($this->pageinfo) ? 1 : 0;\n\n\t\tif (($this->id && $access) || ($BE_USER->user['admin'] && !$this->id))\t{\n\n\t\t\t\t// Draw the header.\n\t\t\t$this->doc = t3lib_div::makeInstance('bigDoc');\n\t\t\t$this->doc->backPath = $BACK_PATH;\n\t\t\t$this->doc->form='<form action=\"\" method=\"POST\">';\n\n\t\t\t\t// JavaScript\n\t\t\t$this->doc->JScode = '\n\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">\n\t\t\t\t\tscript_ended = 0;\n\t\t\t\t\tfunction jumpToUrl(URL)\t{\n\t\t\t\t\t\tdocument.location = URL;\n\t\t\t\t\t}\n\t\t\t\t</script>\n\t\t\t';\n\t\t\t$this->doc->postCode='\n\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">\n\t\t\t\t\tscript_ended = 1;\n\t\t\t\t\tif (top.fsMod) top.fsMod.recentIds[\"web\"] = 0;\n\t\t\t\t</script>\n\t\t\t';\n\n\t\t\t$headerSection = $this->doc->getHeader('pages',$this->pageinfo,$this->pageinfo['_thePath']).'<br />'.$LANG->sL('LLL:EXT:lang/locallang_core.xml:labels.path').': '.t3lib_div::fixed_lgd_cs($this->pageinfo['_thePath'],50);\n\n\t\t\t$this->content.=$this->doc->startPage($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->header($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->spacer(5);\n\t\t\t$this->content.=$this->doc->section('',$this->doc->funcMenu($headerSection,t3lib_BEfunc::getFuncMenu($this->id,'SET[function]',$this->MOD_SETTINGS['function'],$this->MOD_MENU['function'])));\n\t\t\t$this->content.=$this->doc->divider(5);\n\n\n\t\t\t// Render content:\n\t\t\t$this->moduleContent();\n\n\n\t\t\t// ShortCut\n\t\t\tif ($BE_USER->mayMakeShortcut())\t{\n\t\t\t\t$this->content.=$this->doc->spacer(20).$this->doc->section('',$this->doc->makeShortcutIcon('id',implode(',',array_keys($this->MOD_MENU)),$this->MCONF['name']));\n\t\t\t}\n\n\t\t\t$this->content.=$this->doc->spacer(10);\n\t\t} else {\n\t\t\t\t// If no access or if ID == zero\n\n\t\t\t$this->doc = t3lib_div::makeInstance('bigDoc');\n\t\t\t$this->doc->backPath = $BACK_PATH;\n\n\t\t\t$this->content.=$this->doc->startPage($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->header($LANG->getLL('title'));\n\t\t\t$this->content.=$this->doc->spacer(5);\n\t\t\t$this->content.=$this->doc->spacer(10);\n\t\t}\n\t}\n\n\t/**\n\t * Prints out the module HTML\n\t *\n\t * @return\tvoid\n\t */\n\tfunction printContent()\t{\n\n\t\t$this->content.=$this->doc->endPage();\n\t\techo $this->content;\n\t}\n\n\t/**\n\t * Generates the module content\n\t *\n\t * @return\tvoid\n\t */\n\tfunction moduleContent()\t{\n\t\tglobal $LANG, $BACK_PATH, $BE_USER, $TYPO3_DB;\n\n\t\tif (t3lib_div::_GP('block_ip')) {\n\t\t\t$this->MOD_SETTINGS['function'] = 1;\n\t\t}\n\n\t\tswitch((string)$this->MOD_SETTINGS['function'])\t{\n\t\t\tcase 1:\n\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'tstamp < '.(time()-(60*60*24*7)));\n\n\t\t\t\tif (t3lib_div::_GP('move_whitelist')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_INSERTquery('tx_mhhttpbl_whitelist', array('cruser_id'=>$BE_USER->user['uid'], 'crdate'=>time(), 'tstamp'=>time(), 'whitelist_ip'=>t3lib_div::_GP('move_whitelist')));\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'block_ip = '.$GLOBALS['TYPO3_DB']->fullQuoteStr(t3lib_div::_GP('move_whitelist'), 'tx_mhhttpbl_blocklog'));\n\t\t\t\t} else if (t3lib_div::_GP('delete')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', 'block_ip = '.$GLOBALS['TYPO3_DB']->fullQuoteStr(t3lib_div::_GP('delete'), 'tx_mhhttpbl_blocklog'));\n\t\t\t\t} else if (t3lib_div::_GP('clear_log')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_blocklog', '');\n\t\t\t\t}\n\n\t\t\t\t$content = '\n\t\t\t\t\t<a href=\"?clear_log=true\" title=\"'.$LANG->getLL('clear_log').'\">'.$LANG->getLL('clear_log').'</a>\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('time').' <a href=\"?sort=tstamp&amp;order=asc\">&uArr;</a><a href=\"?sort=tstamp&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_ip').' <a href=\"?sort=block_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=block_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_type').' <a href=\"?sort=block_type&amp;order=asc\">&uArr;</a><a href=\"?sort=block_type&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_score').' <a href=\"?sort=block_score&amp;order=asc\">&uArr;</a><a href=\"?sort=block_score&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\" class=\"c-headLineTable\"><b>'.$LANG->getLL('move_whitelist').' &amp; '.$LANG->getLL('delete').'</b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('block_ip')) {\n\t\t\t\t\t$where = 'block_ip = '. $GLOBALS['TYPO3_DB']->fullQuoteStr(t3lib_div::_GP('block_ip'), 'tx_mhhttpbl_blocklog');\n\t\t\t\t} else {\n\t\t\t\t\t$where = '';\n\t\t\t\t}\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$sort_param = in_array(t3lib_div::_GP('sort'), array('tstamp', 'block_ip', 'block_type', 'block_score')) ? t3lib_div::_GP('sort') : 'tstamp';\n\t\t\t\t\t$order_param = strtoupper(t3lib_div::_GP('order')) == 'ASC' ? 'ASC' : 'DESC';\n\t\t\t\t\t$order = $sort_param.' '.$order_param;\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'tstamp DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('*', 'tx_mhhttpbl_blocklog', $where, '', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\">'.date('Y-m-d H:i:s', $row['tstamp']).'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$row['block_ip'].'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$this->codes[$row['block_type']].' ('.$row['block_type'].')</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$this->codes[$row['block_score']].' ('.$row['block_score'].')</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\"><a href=\"?move_whitelist='.$row['block_ip'].'\" title=\"'.$LANG->getLL('move_whitelist').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/move_record.gif\" alt=\"'.$LANG->getLL('move_whitelist').'\" /></a><a href=\"?delete='.$row['block_ip'].'\" title=\"'.$LANG->getLL('delete').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/garbage.gif\" alt=\"'.$LANG->getLL('delete').'\" /></a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function1'),$content,0,1);\n\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif (t3lib_div::_GP('whitelist_add')) {\n\t\t\t\t\t$whitelist_ip = implode('.', array_map('intval', t3lib_div::_GP('whitelist_ip')));\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_INSERTquery('tx_mhhttpbl_whitelist', array('cruser_id'=>$BE_USER->user['uid'], 'crdate'=>time(), 'tstamp'=>time(), 'whitelist_ip'=>$whitelist_ip));\n\t\t\t\t} else if (t3lib_div::_GP('delete')) {\n\t\t\t\t\t$GLOBALS['TYPO3_DB']->exec_DELETEquery('tx_mhhttpbl_whitelist', 'uid = '.intval(t3lib_div::_GP('delete')));\n\t\t\t\t}\n\n\t\t\t\t$content = '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"2\" cellpadding=\"0\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td><b>'.$LANG->getLL('tx_mhhttpbl_whitelist.whitelist_ip').'</b></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[0]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[1]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[2]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td>.</td>\n\t\t\t\t\t\t\t<td><input type=\"text\" name=\"whitelist_ip[3]\" maxlength=\"3\" size=\"3\" /></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td><input type=\"submit\" name=\"whitelist_add\" value=\"+\" /></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$content .= '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('time').' <a href=\"?sort=tstamp&amp;order=asc\">&uArr;</a><a href=\"?sort=tstamp&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_whitelist.whitelist_ip').' <a href=\"?sort=whitelist_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=whitelist_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\" class=\"c-headLineTable\"><b>'.$LANG->getLL('delete').'</b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$sort_param = in_array(t3lib_div::_GP('sort'), array('tstamp', 'whitelist_ip')) ? t3lib_div::_GP('sort') : 'tstamp';\n\t\t\t\t\t$order_param = strtoupper(t3lib_div::_GP('order')) == 'ASC' ? 'ASC' : 'DESC';\n\t\t\t\t\t$order = $sort_param.' '.$order_param;\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'tstamp DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('*', 'tx_mhhttpbl_whitelist', '', '', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\">'.date('Y-m-d H:i:s', $row['tstamp']).'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\">'.$row['whitelist_ip'].'</td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" align=\"right\"><a href=\"?delete='.$row['uid'].'\" title=\"'.$LANG->getLL('delete').'\"><img src=\"'.$BACK_PATH.'sysext/t3skin/icons/gfx/garbage.gif\" alt=\"'.$LANG->getLL('delete').'\" /></a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function2'),$content,0,1);\n\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t$content = '\n\t\t\t\t\t<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"typo3-dblist\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('tx_mhhttpbl_blocklog.block_ip').' <a href=\"?sort=block_ip&amp;order=asc\">&uArr;</a><a href=\"?sort=block_ip&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t\t<td class=\"c-headLineTable\"><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\" class=\"c-headLineTable\"><b>'.$LANG->getLL('count').' <a href=\"?sort=count&amp;order=asc\">&uArr;</a><a href=\"?sort=count&amp;order=desc\">&dArr;</a></b></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t';\n\n\t\t\t\tif (t3lib_div::_GP('sort') && t3lib_div::_GP('order')) {\n\t\t\t\t\t$sort_param = in_array(t3lib_div::_GP('sort'), array('block_ip', 'count')) ? t3lib_div::_GP('sort') : 'count';\n\t\t\t\t\t$order_param = strtoupper(t3lib_div::_GP('order')) == 'ASC' ? 'ASC' : 'DESC';\n\t\t\t\t\t$order = $sort_param.' '.$order_param;\n\t\t\t\t} else {\n\t\t\t\t\t$order = 'count DESC';\n\t\t\t\t}\n\t\t\t\t$res = $GLOBALS['TYPO3_DB']->exec_SELECTquery('block_ip, COUNT(block_ip) as count', 'tx_mhhttpbl_blocklog', '', 'block_ip', $order);\n\t\t\t\tif ($GLOBALS['TYPO3_DB']->sql_num_rows($res)) {\n\t\t\t\t\twhile($row = $GLOBALS['TYPO3_DB']->sql_fetch_assoc($res)) {\n\t\t\t\t\t\t$content .= '\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td valign=\"top\"><a title=\"'.$LANG->getLL('lookup').'\" href=\"http://www.projecthoneypot.org/ip_'.$row['block_ip'].'\" target=\"_blank\">'.$row['block_ip'].'</a></td>\n\t\t\t\t\t\t\t<td><img src=\"clear.gif\" width=\"10\" height=\"1\"></td>\n\t\t\t\t\t\t\t<td valign=\"top\"><a title=\"'.$LANG->getLL('details').'\" href=\"?block_ip='.$row['block_ip'].'\">'.$row['count'].'</a></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$content .= '\n\t\t\t\t\t</table>\n\t\t\t\t';\n\n\t\t\t\t$this->content.=$this->doc->section($LANG->getLL('function3'),$content,0,1);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nif (defined('TYPO3_MODE') && $TYPO3_CONF_VARS[TYPO3_MODE]['XCLASS']['ext/mh_httpbl/mod1/index.php'])\t{\n\tinclude_once($TYPO3_CONF_VARS[TYPO3_MODE]['XCLASS']['ext/mh_httpbl/mod1/index.php']);\n}\n\n// Make instance:\n$SOBE = t3lib_div::makeInstance('tx_mhhttpbl_module1');\n$SOBE->init();\n\n// Include files?\nforeach($SOBE->include_once as $INC_FILE)\tinclude_once($INC_FILE);\n\n$SOBE->main();\n$SOBE->printContent();\n\n?>\n"], "filenames": ["mod1/index.php"], "buggy_code_start_loc": [207], "buggy_code_end_loc": [316], "fixing_code_start_loc": [207], "fixing_code_end_loc": [323], "type": "CWE-89", "message": "** UNSUPPPORTED WHEN ASSIGNED ** ** UNSUPPORTED WHEN ASSIGNED ** A vulnerability classified as critical was found in mback2k mh_httpbl Extension up to 1.1.7 on TYPO3. This vulnerability affects the function moduleContent of the file mod1/index.php. The manipulation leads to sql injection. The attack can be initiated remotely. Upgrading to version 1.1.8 is able to address this issue. The name of the patch is 429f50f4e4795b20dae06735b41fb94f010722bf. It is recommended to upgrade the affected component. VDB-230086 is the identifier assigned to this vulnerability. NOTE: This vulnerability only affects products that are no longer supported by the maintainer.", "other": {"cve": {"id": "CVE-2015-10106", "sourceIdentifier": "cna@vuldb.com", "published": "2023-05-28T13:15:09.850", "lastModified": "2023-06-02T19:50:13.470", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "** UNSUPPPORTED WHEN ASSIGNED ** ** UNSUPPORTED WHEN ASSIGNED ** A vulnerability classified as critical was found in mback2k mh_httpbl Extension up to 1.1.7 on TYPO3. This vulnerability affects the function moduleContent of the file mod1/index.php. The manipulation leads to sql injection. The attack can be initiated remotely. Upgrading to version 1.1.8 is able to address this issue. The name of the patch is 429f50f4e4795b20dae06735b41fb94f010722bf. It is recommended to upgrade the affected component. VDB-230086 is the identifier assigned to this vulnerability. NOTE: This vulnerability only affects products that are no longer supported by the maintainer."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mh_httpbl_project:mh_httpbl:*:*:*:*:*:typo3:*:*", "versionEndExcluding": "1.1.8", "matchCriteriaId": "496EB296-734C-47B9-8E30-9135EAC83E90"}]}]}], "references": [{"url": "https://github.com/mback2k/mh_httpbl/commit/429f50f4e4795b20dae06735b41fb94f010722bf", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/mback2k/mh_httpbl/releases/tag/mh_httpbl_1.1.8_security", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://typo3.org/article/typo3-ext-sa-2015-021", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.230086", "source": "cna@vuldb.com", "tags": ["Permissions Required"]}, {"url": "https://vuldb.com/?id.230086", "source": "cna@vuldb.com", "tags": ["Permissions Required"]}]}, "github_commit_url": "https://github.com/mback2k/mh_httpbl/commit/429f50f4e4795b20dae06735b41fb94f010722bf"}}