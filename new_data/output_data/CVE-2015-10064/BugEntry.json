{"buggy_code": ["<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){    \r\n    tryAddStrike($_POST['name'], $_POST['dmg'], $_POST['type']);\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryAddStrike($name, $damage, $type){     \r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`golpes` WHERE name = '$name' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) >= 1){ //Se ja existir o golpe\r\n        $_SESSION['error'] = 1;\r\n        header(\"location:acp.php\");\r\n    } else {\r\n        $result = mysql_query(\"INSERT INTO `pokemon`.`golpes` (`name`, `damage`, `type`) VALUES ('$name', '$damage', '$type')\");            \r\n        $_SESSION['error'] = 2; //Apesar do nome da vari\u0102\u0104vel da sess\u0102\u0141o, \u0102\u0160 uma instru\u0102\u00a7\u0102\u0141o apenas\r\n        header(\"location:acp.php\");\r\n    }\r\n}\r\n?>\r\n", "<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){    \r\n    tryEditStrike($_POST['strikeid'], $_POST['newname'], $_POST['newdmg'], $_POST['newtype']);\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryEditStrike($id, $name, $damage, $type){ \r\n\r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`golpes` WHERE id = '$id' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) == 0){ //Se n\u0102\u0141o existir golpe com este ID\r\n        $_SESSION['error2'] = 3;\r\n        header(\"location:acp.php\");\r\n    } else {\r\n        $result = mysql_query(\"UPDATE `pokemon`.`golpes` SET `name` = '$name', `damage` = '$damage', `type` = '$type' WHERE `id` = '$id'\");            \r\n        $_SESSION['error2'] = 4; //Apesar do nome da vari\u0102\u0104vel da sess\u0102\u0141o, \u0102\u0160 uma instru\u0102\u00a7\u0102\u0141o apenas\r\n        header(\"location:acp.php\");\r\n    }\r\n}\r\n?>\r\n", "<?php\r\n    require 'mysqlcon.php';     \r\n    $a = $_GET[\"golpe\"];\r\n    $sth = mysql_query(\"SELECT `name` FROM `pokemon`.`golpes` where name like '\" . $a.\"%'\");\r\n    $rows = array();\r\n    while($r = mysql_fetch_assoc($sth)) {\r\n        $rows[] = $r;\r\n    }\r\n    print json_encode($rows);\r\n?>\r\n\r\n", "<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){\r\n    if(strcmp($_POST['password'], $_POST['repeatpassword'])){\r\n        $_SESSION['error'] = 1;\r\n        header(\"location:register.php\");\r\n    } else {   \r\n        $user = $_POST['user'];\r\n        $pass = hash('whirlpool', $_POST['password']);\r\n        $email = $_POST['email'];\r\n        tryRegister($user, $email, $pass);\r\n    }\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryRegister($user, $email, $pass){     \r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`usuarios` WHERE user = '$user' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) >= 1){ //Se ja existir o usu\u00e1rio\r\n        $_SESSION['error'] = 2;\r\n        header(\"location:register.php\");\r\n    } else {\r\n        $result = mysql_query(\"SELECT * FROM `pokemon`.`usuarios` WHERE email = '$email' LIMIT 1\");\r\n        if(mysql_num_rows($result) >= 1){ //Se ja existir o email\r\n            $_SESSION['error'] = 3;\r\n            header(\"location:register.php\");\r\n        } else { //Se a conta estiver 100% apta ao registro\r\n            //Inserimos a conta no banco de dados\r\n            $result = mysql_query(\"INSERT INTO `pokemon`.`usuarios` (`user`, `email`, `password`) VALUES ('$user', '$email', '$pass')\");            \r\n            $_SESSION['error'] = 2; //Apesar do nome da vari\u00e1vel da sess\u00e3o, \u00e9 uma instru\u00e7\u00e3o apenas\r\n            header(\"location:login.php\");\r\n        }\r\n    }\r\n}\r\n?>\r\n"], "fixing_code": ["<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){    \r\n    tryAddStrike($_POST['name'], $_POST['dmg'], $_POST['type']);\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryAddStrike($name, $damage, $type){   \r\n    $ename = mysql_real_escape_string($name);\r\n    $edamage = mysql_real_escape_string($damage);\r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`golpes` WHERE name = '$ename' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) >= 1){ //Se ja existir o golpe\r\n        $_SESSION['error'] = 1;\r\n        header(\"location:acp.php\");\r\n    } else {\r\n        $result = mysql_query(\"INSERT INTO `pokemon`.`golpes` (`name`, `damage`, `type`) VALUES ('$ename', '$edamage', '$type')\");            \r\n        $_SESSION['error'] = 2; //Apesar do nome da vari\u00e1vel da sess\u00e3o, \u00e9 uma instru\u00e7\u00e3o apenas\r\n        header(\"location:acp.php\");\r\n    }\r\n}\r\n?>\r\n", "<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){    \r\n    tryEditStrike($_POST['strikeid'], $_POST['newname'], $_POST['newdmg'], $_POST['newtype']);\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryEditStrike($id, $name, $damage, $type){ \r\n    $ename = mysql_real_escape_string($name);\r\n    $edamage = mysql_real_escape_string($damage);\r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`golpes` WHERE id = '$id' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) == 0){ //Se n\u00e3o existir golpe com este ID\r\n        $_SESSION['error2'] = 3;\r\n        header(\"location:acp.php\");\r\n    } else {\r\n        $result = mysql_query(\"UPDATE `pokemon`.`golpes` SET `name` = '$ename', `damage` = '$edamage', `type` = '$type' WHERE `id` = '$id'\");            \r\n        $_SESSION['error2'] = 4; //Apesar do nome da vari\u00e1vel da sess\u00e3o, \u00e9 uma instru\u00e7\u00e3o apenas\r\n        header(\"location:acp.php\");\r\n    }\r\n}\r\n?>\r\n", "<?php\r\n    require 'mysqlcon.php';       \r\n    $a = $_GET[\"golpe\"];\r\n    $ea = mysql_real_escape_string($a);\r\n    $sth = mysql_query(\"SELECT `name` FROM `pokemon`.`golpes` where name like '\" . $ea.\"%'\");\r\n    $rows = array();\r\n    while($r = mysql_fetch_assoc($sth)) {\r\n        $rows[] = $r;\r\n    }\r\n    print json_encode($rows);\r\n?>\r\n\r\n", "<?php\r\nsession_start();\r\nrequire 'mysqlcon.php';\r\n\r\nif(isset($_POST['submit'])){\r\n    if(strcmp($_POST['password'], $_POST['repeatpassword'])){\r\n        $_SESSION['error'] = 1;\r\n        header(\"location:register.php\");\r\n    } else {   \r\n        $user = $_POST['user'];\r\n        $pass = hash('whirlpool', $_POST['password']);\r\n        $email = $_POST['email'];\r\n        tryRegister($user, $email, $pass);\r\n    }\r\n}\r\nelse {\r\n    header(\"location:./\");\r\n}\r\nfunction tryRegister($user, $email, $pass){   \r\n    $euser = mysql_real_escape_string($user);\r\n    $eemail = mysql_real_escape_string($email);\r\n    $result = mysql_query(\"SELECT * FROM `pokemon`.`usuarios` WHERE user = '$euser' LIMIT 1\");    \r\n\r\n    if(mysql_num_rows($result) >= 1){ //Se ja existir o usu\u00e1rio\r\n        $_SESSION['error'] = 2;\r\n        header(\"location:register.php\");\r\n    } else {\r\n        $result = mysql_query(\"SELECT * FROM `pokemon`.`usuarios` WHERE email = '$eemail' LIMIT 1\");\r\n        if(mysql_num_rows($result) >= 1){ //Se ja existir o email\r\n            $_SESSION['error'] = 3;\r\n            header(\"location:register.php\");\r\n        } else { //Se a conta estiver 100% apta ao registro\r\n            //Inserimos a conta no banco de dados\r\n            $result = mysql_query(\"INSERT INTO `pokemon`.`usuarios` (`user`, `email`, `password`) VALUES ('$euser', '$eemail', '$pass')\");            \r\n            $_SESSION['error'] = 2; //Apesar do nome da vari\u00e1vel da sess\u00e3o, \u00e9 uma instru\u00e7\u00e3o apenas\r\n            header(\"location:login.php\");\r\n        }\r\n    }\r\n}\r\n?>\r\n"], "filenames": ["addStrike.php", "editStrike.php", "golpes.php", "validateRegister.php"], "buggy_code_start_loc": [11, 12, 2, 19], "buggy_code_end_loc": [20, 21, 5, 33], "fixing_code_start_loc": [11, 12, 2, 19], "fixing_code_end_loc": [22, 22, 6, 35], "type": "CWE-89", "message": "A vulnerability was found in VictorFerraresi pokemon-database-php. It has been declared as critical. Affected by this vulnerability is an unknown functionality. The manipulation leads to sql injection. The name of the patch is dd0e1e6cdf648d6a3deff441f515bcb1d7573d68. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218455.", "other": {"cve": {"id": "CVE-2015-10064", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-17T19:15:11.163", "lastModified": "2023-01-24T19:47:07.257", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in VictorFerraresi pokemon-database-php. It has been declared as critical. Affected by this vulnerability is an unknown functionality. The manipulation leads to sql injection. The name of the patch is dd0e1e6cdf648d6a3deff441f515bcb1d7573d68. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218455."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pokemon-database-php_project:pokemon-database-php:*:*:*:*:*:*:*:*", "versionEndExcluding": "2015-05-06", "matchCriteriaId": "A5B6861D-9905-4979-A7F9-6706ED8BEDFE"}]}]}], "references": [{"url": "https://github.com/VictorFerraresi/pokemon-database-php/commit/dd0e1e6cdf648d6a3deff441f515bcb1d7573d68", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.218455", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.218455", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/VictorFerraresi/pokemon-database-php/commit/dd0e1e6cdf648d6a3deff441f515bcb1d7573d68"}}