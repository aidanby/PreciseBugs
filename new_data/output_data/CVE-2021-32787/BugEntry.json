{"buggy_code": ["package graphqlbackend\n\nimport (\n\t\"context\"\n\t\"time\"\n\n\t\"github.com/sourcegraph/sourcegraph/cmd/frontend/internal/usagestatsdeprecated\"\n\t\"github.com/sourcegraph/sourcegraph/internal/types\"\n)\n\nfunc (r *siteResolver) UsageStatistics(ctx context.Context, args *struct {\n\tDays   *int32\n\tWeeks  *int32\n\tMonths *int32\n}) (*siteUsageStatisticsResolver, error) {\n\topt := &usagestatsdeprecated.SiteUsageStatisticsOptions{}\n\tif args.Days != nil {\n\t\td := int(*args.Days)\n\t\topt.DayPeriods = &d\n\t}\n\tif args.Weeks != nil {\n\t\tw := int(*args.Weeks)\n\t\topt.WeekPeriods = &w\n\t}\n\tif args.Months != nil {\n\t\tm := int(*args.Months)\n\t\topt.MonthPeriods = &m\n\t}\n\tactivity, err := usagestatsdeprecated.GetSiteUsageStatistics(opt)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &siteUsageStatisticsResolver{activity}, nil\n}\n\ntype siteUsageStatisticsResolver struct {\n\tsiteUsageStatistics *types.SiteUsageStatistics\n}\n\nfunc (s *siteUsageStatisticsResolver) DAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.DAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) WAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.WAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) MAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.MAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) activities(periods []*types.SiteActivityPeriod) []*siteUsagePeriodResolver {\n\tresolvers := make([]*siteUsagePeriodResolver, 0, len(periods))\n\tfor _, p := range periods {\n\t\tresolvers = append(resolvers, &siteUsagePeriodResolver{siteUsagePeriod: p})\n\t}\n\treturn resolvers\n}\n\ntype siteUsagePeriodResolver struct {\n\tsiteUsagePeriod *types.SiteActivityPeriod\n}\n\nfunc (s *siteUsagePeriodResolver) StartTime() string {\n\treturn s.siteUsagePeriod.StartTime.Format(time.RFC3339)\n}\n\nfunc (s *siteUsagePeriodResolver) UserCount() int32 {\n\treturn s.siteUsagePeriod.UserCount\n}\n\nfunc (s *siteUsagePeriodResolver) RegisteredUserCount() int32 {\n\treturn s.siteUsagePeriod.RegisteredUserCount\n}\n\nfunc (s *siteUsagePeriodResolver) AnonymousUserCount() int32 {\n\treturn s.siteUsagePeriod.AnonymousUserCount\n}\n\nfunc (s *siteUsagePeriodResolver) IntegrationUserCount() int32 {\n\treturn s.siteUsagePeriod.IntegrationUserCount\n}\n"], "fixing_code": ["package graphqlbackend\n\nimport (\n\t\"context\"\n\t\"time\"\n\n\t\"github.com/sourcegraph/sourcegraph/cmd/frontend/backend\"\n\t\"github.com/sourcegraph/sourcegraph/cmd/frontend/internal/usagestatsdeprecated\"\n\t\"github.com/sourcegraph/sourcegraph/internal/types\"\n)\n\nfunc (r *siteResolver) UsageStatistics(ctx context.Context, args *struct {\n\tDays   *int32\n\tWeeks  *int32\n\tMonths *int32\n}) (*siteUsageStatisticsResolver, error) {\n\tif err := backend.CheckCurrentUserIsSiteAdmin(ctx, r.db); err != nil {\n\t\treturn nil, err\n\t}\n\n\topt := &usagestatsdeprecated.SiteUsageStatisticsOptions{}\n\tif args.Days != nil {\n\t\td := int(*args.Days)\n\t\topt.DayPeriods = &d\n\t}\n\tif args.Weeks != nil {\n\t\tw := int(*args.Weeks)\n\t\topt.WeekPeriods = &w\n\t}\n\tif args.Months != nil {\n\t\tm := int(*args.Months)\n\t\topt.MonthPeriods = &m\n\t}\n\tactivity, err := usagestatsdeprecated.GetSiteUsageStatistics(opt)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &siteUsageStatisticsResolver{activity}, nil\n}\n\ntype siteUsageStatisticsResolver struct {\n\tsiteUsageStatistics *types.SiteUsageStatistics\n}\n\nfunc (s *siteUsageStatisticsResolver) DAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.DAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) WAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.WAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) MAUs() []*siteUsagePeriodResolver {\n\treturn s.activities(s.siteUsageStatistics.MAUs)\n}\n\nfunc (s *siteUsageStatisticsResolver) activities(periods []*types.SiteActivityPeriod) []*siteUsagePeriodResolver {\n\tresolvers := make([]*siteUsagePeriodResolver, 0, len(periods))\n\tfor _, p := range periods {\n\t\tresolvers = append(resolvers, &siteUsagePeriodResolver{siteUsagePeriod: p})\n\t}\n\treturn resolvers\n}\n\ntype siteUsagePeriodResolver struct {\n\tsiteUsagePeriod *types.SiteActivityPeriod\n}\n\nfunc (s *siteUsagePeriodResolver) StartTime() string {\n\treturn s.siteUsagePeriod.StartTime.Format(time.RFC3339)\n}\n\nfunc (s *siteUsagePeriodResolver) UserCount() int32 {\n\treturn s.siteUsagePeriod.UserCount\n}\n\nfunc (s *siteUsagePeriodResolver) RegisteredUserCount() int32 {\n\treturn s.siteUsagePeriod.RegisteredUserCount\n}\n\nfunc (s *siteUsagePeriodResolver) AnonymousUserCount() int32 {\n\treturn s.siteUsagePeriod.AnonymousUserCount\n}\n\nfunc (s *siteUsagePeriodResolver) IntegrationUserCount() int32 {\n\treturn s.siteUsagePeriod.IntegrationUserCount\n}\n"], "filenames": ["cmd/frontend/graphqlbackend/site_usage_stats.go"], "buggy_code_start_loc": [6], "buggy_code_end_loc": [15], "fixing_code_start_loc": [7], "fixing_code_end_loc": [21], "type": "NVD-CWE-noinfo", "message": "Sourcegraph is a code search and navigation engine. Sourcegraph before version 3.30.0 has two potential information leaks. The site-admin area can be accessed by regular users and all information and features are properly protected except for daily usage statistics and code intelligence uploads and indexes. It is not possible to alter the information, nor interact with any other features in the site-admin area. The issue is patched in version 3.30.0, where the information cannot be accessed by unprivileged users. There are no workarounds aside from upgrading.", "other": {"cve": {"id": "CVE-2021-32787", "sourceIdentifier": "security-advisories@github.com", "published": "2021-08-02T22:15:08.223", "lastModified": "2021-08-11T15:05:41.440", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Sourcegraph is a code search and navigation engine. Sourcegraph before version 3.30.0 has two potential information leaks. The site-admin area can be accessed by regular users and all information and features are properly protected except for daily usage statistics and code intelligence uploads and indexes. It is not possible to alter the information, nor interact with any other features in the site-admin area. The issue is patched in version 3.30.0, where the information cannot be accessed by unprivileged users. There are no workarounds aside from upgrading."}, {"lang": "es", "value": "Sourcegraph es un motor de b\u00fasqueda y navegaci\u00f3n de c\u00f3digo. Sourcegraph versiones anteriores a 3.30.0, presenta dos potenciales filtrados de informaci\u00f3n. El \u00e1rea de administraci\u00f3n del sitio puede ser accedida por usuarios normales y toda la informaci\u00f3n y funcionalidades est\u00e1n apropiadamente protegidas, excepto las estad\u00edsticas de uso diario y las cargas e \u00edndices de inteligencia de c\u00f3digo. No es posible alterar la informaci\u00f3n, ni interactuar con ninguna otra funcionalidad en el \u00e1rea de administraci\u00f3n del sitio. El problema est\u00e1 parcheado en la versi\u00f3n 3.30.0, donde la informaci\u00f3n no puede ser accedida por usuarios sin privilegios  . No hay soluciones aparte de la actualizaci\u00f3n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 3.1, "baseSeverity": "LOW"}, "exploitabilityScore": 1.6, "impactScore": 1.4}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-noinfo"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-200"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:sourcegraph:sourcegraph:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.30.0", "matchCriteriaId": "8C885D75-FFC4-4AA0-82E8-00A9391ADA09"}]}]}], "references": [{"url": "https://github.com/sourcegraph/sourcegraph/commit/6e51f4546368d959a1f9f173d16e5f20c55deb56", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/sourcegraph/sourcegraph/security/advisories/GHSA-mq5p-477h-xgwv", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/sourcegraph/sourcegraph/commit/6e51f4546368d959a1f9f173d16e5f20c55deb56"}}