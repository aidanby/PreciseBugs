{"buggy_code": ["<?php\n/**\n * Edit School\n * php version 8.1\n *\n * @category Site\n *\n * @package None\n *\n * @author Waqas <admin@waqaskanju.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once 'sand_box.php';\n$link=$LINK;\n\nif ($SCHOOL_CHANGES==\"0\") {\n    echo '<div class=\"bg-danger text-center\"> Not allowed!! </div>';\n    exit;\n}\n\n/* Rules for Naming add under score between two words. */\nif (isset($_GET['submit'])) {\n    $name=$_GET['school_name'];\n    $name=Validate_input($name);\n\n    $status=$_GET['status'];\n    $status=Validate_input($status);\n    \n    $id=$_GET['id'];\n    $id=Validate_input($id);\n\n    $q=\"Update  schools SET Name='$name', Status='$status' WHERE Id='$id'\";\n    $exe=mysqli_query($link, $q) or\n    die('Error in School Updation '. mysqli_error($link));\n    if ($exe) {\n          echo \"school updated\";\n    } else {\n          echo \"Error in Updation\";\n    }\n}\n?>\n  <?php Page_header('Edit School'); ?>\n</head>\n<body>\n<?php \n$url_id= $_GET['id'];\n$url_id=Validate_input($url_id);\n$q=\"SELECT * from schools WHERE Id='$url_id'\";\n$exe=mysqli_query($link, $q);\n$exer=mysqli_fetch_assoc($exe);\n\n$school_name=$exer['Name'];\n$status=$exer['Status'];\n$id=$exer['Id'];\n?>\n<div class=\"container-fluid\">\n  <form class=\"p-3\">\n    <div class=\"row\">\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"school_name\" class=\"form-label\">School Name:</label>\n        <input type=\"text\" placeholder=\"Type School Name\" \n                class=\"form-control\" name=\"school_name\" \n                value=\"<?php echo $school_name; ?>\" id=\"school_name\" required>\n      </div>\n    <div>\n    <div class=\"row mt-1\">\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"status\" class=\"form-label\">Status:</label>\n        <input type=\"number\" class=\"form-control\" name=\"status\" \n               value=\"<?php echo $status;?>\" min=\"0\" max=\"1\" required>\n      </div>\n      <div class=\"col-sm-6\">\n      <input type=\"hidden\" value=\"<?php echo $id;?>\" name=\"id\">\n      <input type=\"submit\" name=\"submit\" class=\"btn btn-primary mt-4\" \n            value=\"Update School Name\">\n      </div>\n    <div>\n    </form>\n  </div>\n\n  <div class=\"container-fluid\">\n  <h3>Existing Schools</h3>\n  <div id=\"existing_schools\" class=\"bg-white\">\n  </div>\n</div>\n<script type=\"text/javascript\" src=\"js/add_schools.js\">\n<?php Page_close(); ?>", "<?php\n/**\n * Add  All Subjects Marks of Students\n * php version 8.1\n *\n * @category Exam\n *\n * @package None\n *\n * @author Waqas <admin@waqaskanju.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once 'sand_box.php';\n$link=$LINK;\n$selected_class=$CLASS_NAME;\n$selected_school=$SCHOOL_NAME;\n\nif ($SCHOOL_CHANGES==\"0\") {\n    echo '<div class=\"bg-danger text-center\"> Not allowed!! </div>';\n    exit;\n}\n\n/* Rules for Naming add under score between two words. */\nif (isset($_GET['submit'])) {\n    $status=$_GET['status'];\n    $status=Validate_input($status);\n    \n    $name=$_GET['class_name'];\n    $name=Validate_input($name);\n    \n    $id=$_GET['id'];\n    $id=Validate_input($id);\n\n    $school=$_GET['school'];\n    $school=Validate_input($school);\n\n    $pass_percentage=$_GET['pass_percentage'];\n    $pass_percentage=Validate_input($pass_percentage);\n\n    $school_id=Convert_School_Name_To_id($school);\n    $q=\"Update  school_classes \n    SET Status='$status', Name='$name', School_Id='$school_id', \n    Pass_Percentage='$pass_percentage' WHERE Id='$id'\";\n    $exe=mysqli_query($link, $q) or\n    die('Error in Class Updation '. mysqli_error($link));\n    if ($exe) {\n          echo \"<div class='alert-success'>Class Updated</div>\";\n          header('refresh:1 url=add_school_class.php');\n    } else {\n          echo \"Error in Updation\";\n    }\n}\n?>\n  <?php Page_header('Edit School\\'s Class'); ?>\n</head>\n<body>\n<?php \n$url_id=$_GET['id'];\n$url_id=Validate_input($url_id);\n\n$q=\"SELECT * from school_classes WHERE Id='$url_id'\";\n$exe=mysqli_query($link, $q);\n$exer=mysqli_fetch_assoc($exe);\n$school_id=$exer['School_Id'];\n$school_name=Convert_School_Id_To_name($school_id);\n$class_name=$exer['Name'];\n$status=$exer['Status'];\n$pass_percentage=$exer['Pass_Percentage'];\n$id=$exer['Id'];\n?>\n<div class=\"container-fluid\">\n  <form class=\"p-3\">\n    <div class=\"row\">\n      <?php Select_school($school_name); ?>\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"class_name\" class=\"form-label\">Class Name:</label>\n        <input type=\"text\" placeholder=\"Type Class Name\" \n                class=\"form-control\" name=\"class_name\" \n                value=\"<?php echo $class_name; ?>\" id=\"class_name\" required>\n      </div>\n    <div>\n    <div class=\"row mt-1\">\n      <div class=\"col-sm-4 form-group\">\n        <label for=\"pass_percentage\" class=\"form-label\">Pass Percentage:</label>\n        <input type=\"number\" class=\"form-control\" name=\"pass_percentage\" \n               value=\"<?php echo $pass_percentage;?>\" \n               step=\"0.1\" min=\"0\" max=\"100\" required>\n      </div>\n      <div class=\"col-sm-4 form-group\">\n        <label for=\"status\" class=\"form-label\">Status:</label>\n        <input type=\"number\" class=\"form-control\" name=\"status\" \n               value=\"<?php echo $status;?>\" min=\"0\" max=\"1\" required>\n      </div>\n      <div class=\"col-sm-4\">\n      <input type=\"hidden\" value=\"<?php echo $id;?>\" name=\"id\">\n      <input type=\"submit\" name=\"submit\" class=\"btn btn-primary mt-4\" \n            value=\"Update Class Name\">\n      </div>\n    <div>\n    </form>\n  </div>\n\n  <div class='container-fluid'>\n    <h3>Existing School Classes</h3>\n    <div id='exiting-school-classes'>\n    </div>\n  </div>\n  <script type=\"text/javascript\" src=\"js/add_school_class.js\">\n<?php Page_close(); ?>", "<?php\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n/**\n * This function change -1 to absent.\n *\n * @param Integer $marks date of birth\n *\n * @return Makrs of A for absent.\n */\nfunction Show_absent($marks)\n{\n    if ($marks == -1) {\n            $marks =\"A\";\n    }\n    return $marks;\n}\n\n/**\n * This function change absent to zero for total marks calculation.\n *\n * @param Integer $marks_value date of birth\n *\n * @return Makrs of A for absent.\n */\nfunction Change_Absent_tozero($marks_value)\n{\n    if ($marks_value == -1) {\n            $marks_value=0;\n    }\n    return $marks_value;\n}\n\n\n\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $subject Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Change_Subject_To_Marks_col($subject)\n{\n    switch ($subject) {\n    case \"English\":\n        return \"English_Marks\";\n    break;\n    case \"Urdu\":\n        return \"Urdu_Marks\";\n    break;\n    case \"Maths\":\n        return \"Maths_Marks\";\n    break;\n    case \"Hpe\":\n        return \"Hpe_Marks\";\n    break;\n    case \"Nazira\":\n        return \"Nazira_Marks\";\n    break;\n    case \"General Science\":\n        return \"Science_Marks\";\n    break;\n    case \"Arabic\":\n        return \"Arabic_Marks\";\n    break;\n    case \"Islamyat\":\n        return \"Islamyat_Marks\";\n    break;\n    case \"History And Geography\":\n        return \"History_Marks\";\n    break;\n    case \"Computer Science\":\n        return \"Computer_Marks\";\n    break;\n    case \"Mutalia Quran\":\n        return \"Mutalia_Marks\";\n    break;\n    case \"Drawing\":\n        return \"Drawing_Marks\";\n    break;\n    case \"Social Study\":\n        return \"Social_Marks\";\n    break;\n    case \"Pak Study\":\n        return \"Social_Marks\";\n    break;\n    case \"Pashto\":\n        return \"Pashto_Marks\";\n    break;\n    case \"Biology\":\n        return \"Biology_Marks\";\n    break;\n    case \"Chemistry\":\n        return \"Chemistry_Marks\";\n    break;\n    case \"Physics\":\n        return \"Physics_Marks\";\n    break;\n    case \"Civics\":\n        return \"Civics_Marks\";\n    break;\n    case \"Economics\":\n        return \"Economics_Marks\";\n    break;\n    case \"Islamic Study\":\n        return \"Islamic_Study_Marks\";\n    break;\n    case \"Islamic Education\":\n        return \"Islamic_Education_Marks\";\n    break;\n    case \"Statistics\":\n        return \"Statistics_Marks\";\n    break;\n    default:\n        echo \"Unknown Subject\";\n    }\n\n}\n\n\n/**\n * Project Folder Name\n * \n * @return Void  show project folder used in print.\n */\nfunction Project_Folder_name()\n{\n    // return folder of the project.\n    $path=getcwd();\n    //echo  $main_dir=dirname($path, 1);\n    $chunks = explode('\\\\', $path);\n    $chunks_length=count($chunks);\n    return $my_directory=$chunks[$chunks_length-1];\n    \n}\n\n/**\n * Project Folder Name\n * \n * @param integer $status Name of class\n * \n * @return Void  show project folder used in print.\n */\nfunction Change_Status_To_word($status) \n{\n    return $status==1? \"Active\" : \"Inactive\";\n}\n\n/**\n * Project Folder Name\n * \n * @param time   $sec Time in Second\n * @param string $url Url of the page\n * \n * @return Void  show project folder used in print.\n */\nfunction redirection($sec,$url) \n{\n    header(\"refresh:$sec; url=$url\");\n}\n\n/**\n * Validate Form Input;\n *\n * @param string $data Name of the class.\n *\n * @return string return clean data.\n */\nfunction Validate_input($data)\n{\n    $data = trim($data);\n    $data = stripslashes($data);\n    $data = htmlspecialchars($data);\n    return $data;\n}\n\n/**\n * Show Alert Message\n * \n * @param string $message    Time in Second\n * @param string $alert_type Url of the page\n * \n * @return Void  show project folder used in print.\n */\nfunction Show_alert($message,$alert_type)\n{\n    echo \"<div class='alert alert-$alert_type alert-dismissible fade show' \n               role='alert'>\n                  <strong>Success!</strong> $message\n                    <button type='button' class='btn-close' data-bs-dismiss='alert' \n                            aria-label='Close'></button>\n                </div>\";\n}\n?>", "<?php\n    /**\n     * USe for testing Code\n     * php version 8.1\n     *\n     * @category Test\n     *\n     * @package None\n     *\n     * @author Waqas <waqaskanju@gmail.com>\n     *\n     * @license http://www.waqaskanju.com/license MIT\n     *\n     * @link http://www.waqaskanju.com/\n     **/\n\nrequire_once 'sand_box.php';\n$link=$LINK;\n?>\n", "<?php\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n  date_default_timezone_set(\"Asia/Karachi\");\n  require_once 'db_connection.php';\n  require_once 'config.php';\n  require_once 'functions.php';\n  $link=$LINK;\n/**\n *  For showing the title of the page\n *\n * @param string $page_name of the page\n *\n * @return void\n */\nfunction Page_header($page_name)\n{\n    echo '<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <title>'.$page_name.'</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"css/style.css\">\n    <link rel=\"stylesheet\" href=\"css/bootstrap-icons.css\">\n    <link rel=\"stylesheet\" href=\"css/print.css\" media=\"print\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"images/favicon.ico\">\n\n    ';\n}\n/**\n *  For close the html and body tag\n *\n * @return void\n */\nfunction Page_close()\n{\n    echo'\n    <script  src=\"js/bootstrap.bundle.min.js\">\n    </script>\n    <script  src=\"js/custom.js\">\n    </script>\n    </body>\n\t</html>';\n}\n/**\n * Select Single value data.\n * 6th, 7th, 8th etc\n *\n * @param string $table_name   table name\n * @param string $column_name  column of the data\n * @param string $where_column Where condition\n * @param string $where_value  where value\n *\n * @return void  save message.\n */\nfunction Select_Column_data($table_name,$column_name,$where_column,$where_value)\n{\n    global $link;\n    $query = \"SELECT $column_name from $table_name\n    WHERE $where_column='$where_value'\";\n    $query_result=mysqli_query($link, $query) or die(\"Error in this query. $query\");\n    $query_result_value=mysqli_fetch_assoc($query_result);\n    return $query_result_value;\n}\n\n/**\n *  Select one column's array data from a table\n *\n * @param string $column_name  which column data you want to get.\n * @param string $table_name   table name\n * @param string $where_column column name for where clause\n * @param string $where_value  value of the where column clause.\n *\n * @return array\n */\nfunction Select_Single_Column_Array_data(\n    $column_name,$table_name,$where_column,$where_value\n) {\n    $q=\"SELECT $column_name from $table_name WHERE $where_column=$where_value\";\n    global $link;\n    $exe=mysqli_query($link, $q);\n    $data=[];\n    while ($exer=mysqli_fetch_assoc($exe)) {\n        $value=$exer[$column_name];\n        array_push($data, $value);\n    }\n    return $data;\n}\n\n/**\n *  Showing the Combo box with Class Names\n *\n * @param string $selected_class which column data you want to get.\n *\n * @return $selected_class For example 6th 7th etc\n */\nfunction Select_class($selected_class)\n{\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n    $school_id=Convert_School_Name_To_id($school_name);\n    $class_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"school_classes\", \"School_Id\", \"$school_id\"\n    );\n    $selected=\"selected\";\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='class_exam' class='form-label'>Select Class Name: </label>\n              <select class='form-control' name='class_exam' id='class_name'\n               required onchange='view_existing_subjects()' >\n                <option value=''>Select Class </option>\";\n    for ($i=0;$i<count($class_names_array);$i++) {\n        echo \"<option value='$class_names_array[$i]'\";\n        if ($selected_class==$class_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n               echo \" selected\";\n        }\n        echo\"> $class_names_array[$i] </option> \";\n    }\n    echo \"   </select>\n      </div>\n\";\n\n}\n\n/**\n *  Showing Combo box for select\n *\n * @param string $selected_school name of school\n *\n * @return name of classes GPS Chitor Kokrai etc\n */\nfunction Select_school($selected_school)\n{\n    $selected=\"selected\";\n    $school_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"schools\", \"Status\", \"1\"\n    );\n    echo \"\n\t<div class='form-group col-md-6'>\n\t\t<label for='school' class='form-label'>Select School Name: </label>\n              <select class='form-control' name='school' id='school_name'\n               required onchange='view_existing_school_classes()'>\n                <option value=''>Select School </option>\";\n    for ($i=0;$i<count($school_names_array);$i++) {\n        echo \"<option value='$school_names_array[$i]'\";\n        if ($selected_school==$school_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n            echo\"> $school_names_array[$i] </option> \";\n    }\n        echo \"   </select>\n    </div>\n             \";\n}\n\n/**\n *  Select subject\n *\n * @param string $selected_subject name of school\n *\n * @return void of classes GPS Chitor Kokrai etc\n */\nfunction Select_subject($selected_subject)\n{\n    $selected=\"selected\";\n    $subject_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"subjects\", \"Status\", \"1\"\n    );\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='class_exam' class='form-label'>Select Subject Name: </label>\n              <select class='form-control' name='subject' id='subject_name'\n               required>\n                <option value=''>Select Subject </option>\";\n    for ($i=0;$i<count($subject_names_array);$i++) {\n        echo \"<option value='$subject_names_array[$i]'\";\n        if ($selected_subject==$subject_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n                    echo\"> $subject_names_array[$i] </option> \";\n    }\n    echo \"   </select>\n    </div>\n        \";\n}\n/**\n *  Select Teacher\n *\n * @param string $selected_teacher name of school\n *\n * @return void Print combo box with teachers\n */\nfunction Select_teacher($selected_teacher)\n{\n    $teacher_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"employees\", \"Status\", \"1\"\n    );\n    $selected=\"selected\";\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='teacher_name' class='form-label'>Select Teacher Name: </label>\n              <select class='form-control' name='teacher_name' required>\n                <option value=''>Select Teacher </option>\";\n    for ($i=0;$i<count($teacher_names_array);$i++) {\n        echo \"<option value='$teacher_names_array[$i]'\";\n        if ($selected_teacher==$teacher_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n                    echo\"> $teacher_names_array[$i] </option> \";\n    }\n    echo \"  </select>\n      </div>\n        \";\n}\n/**\n *  Calculate position but its not 100 accurate.\n * Make this function Dynamic its not flexible.\n *\n * @param string $class  name of a class\n * @param string $school name of a school\n *\n * @return int    0 or 1\n */\nfunction Calculate_position($class,$school)\n{\n    global $link;\n    $class_name=$class;\n    $school_name=$school;\n\n    $q=\"SELECT Roll_No from students_info\n\twhere Class='$class_name' AND School='$school_name' AND Status=1\";\n    $qr=mysqli_query($link, $q) or die('Error in Q 1'.mysqli_error($link));\n    while ($qra=mysqli_fetch_assoc($qr)) {\n        $q2=\"SELECT * FROM marks WHERE Roll_No=\".$qra['Roll_No'];\n        $qr2=mysqli_query($link, $q2) or die('Error in Q 2'. mysqli_error($link));\n        while ($qfa=mysqli_fetch_assoc($qr2)) {\n            $sum = 0;\n            $sum =  $qfa['English_Marks'] + $qfa['Urdu_Marks'] +\n                    $qfa['Maths_Marks'] + $qfa['Hpe_Marks'] +\n                    $qfa['Nazira_Marks'] + $qfa['Science_Marks'] +\n                    $qfa['Arabic_Marks'] + $qfa['Islamyat_Marks'] +\n                    $qfa['History_Marks'] + $qfa['Computer_Marks'] +\n                    $qfa['Mutalia_Marks'] + $qfa['Qirat_Marks'] +\n                    $qfa['Social_Marks'] + $qfa['Pashto_Marks'] +\n                    $qfa['Drawing_Marks'] + $qfa['Biology_Marks'] +\n                    $qfa['Chemistry_Marks'] + $qfa['Physics_Marks'];\n\n            $roll_no = $qfa['Roll_No'];\n            $q3=\"INSERT INTO position (Roll_No, Total_Marks )\n\t\t\tVALUES ('$roll_no', '$sum')\";\n\n            $qr3 = mysqli_query($link, $q3)\n            or\n            die('Error in Q 3 '.mysqli_error($link));\n            echo \" Roll No: \". $qfa['Roll_No']  . \" Completed <br>\";\n\n            $q4=\"Update students_info set Class_Position=''\n            where\n            Class='$class_name'\";\n            $qr4=mysqli_query($link, $q4);\n\n            if ($qr4) {\n                echo \" successfully emptyfied Class_Position of\".$class_name;\n            } else {\n                echo \"error in emptying the\".$class_name;\n            }\n        }\n    }\n    if ($qr) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n/**\n *  Add Data into Position Table\n *\n * @return void\n */\nfunction Add_Data_Into_position()\n{\n    global $link;\n    $count_row=\"SELECT COUNT(Total_Marks) as total_rows FROM position\";\n    $cqe=mysqli_query($link, $count_row)\n    or\n    die('Error Count Rows:'.mysqli_error($link));\n    $cqa=mysqli_fetch_assoc($cqe);\n    $total_entries=$cqa['total_rows'];\n    for ($i=0;$i<$total_entries;$i++) {\n        $q=\"SELECT Total_Marks,Roll_No FROM position\n        ORDER BY Total_Marks DESC LIMIT $i,1\";\n        $qr=mysqli_query($link, $q)\n        or\n        die('Error Select Distint total'. mysqli_error($link));\n        $qra=mysqli_fetch_assoc($qr);\n        $j=$i+1;\n        if ($i==0) {\n            $q=\"Update students_info\n            set Class_Position='1st   out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n             die('Error in first Position'.mysqli_error($link));\n        } else if ($i==1) {\n            $q=\"Update students_info\n            set Class_Position='2nd   out of $total_entries'\n             WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in 2nd Position'. mysqli_error($link));\n        } else if ($i==2) {\n            $q=\"Update students_info\n            set Class_Position='3rd   out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in 3rd Position'. mysqli_error($link));\n        } else if ($i>2) {\n            $q=\"Update students_info\n            set Class_Position=' $j th out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in nth Position'. mysqli_error($link));\n        } else {\n            echo \"Some thing is wrong\";\n        }\n    }\n    if ($cqe) {\n        echo \"Data is Successfully Added to Positions\";\n    }\n}\n\n/**\n *  Empty Position Table\n *\n * @return void\n */\nfunction Empty_Position_table()\n{\n    global $link;\n    $q=\"DELETE from position\";\n    $qr=mysqli_query($link, $q) or die('Error:in deletion'.mysqli_error($link));\n    if ($qr) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\n/**\n *  This function return all the subjects of a class.\n *\n * @param string $class_name name of a class\n *\n * @return void\n */\nfunction Class_subjects($class_name)\n{\n    global $link;\n    $q1=\"SELECT Id FROM School_Classes WHERE Name='$class_name'\";\n    $exe1=mysqli_query($link, $q1)\n    or\n    die('Error in class subjects function query 1');\n    $exer1= mysqli_fetch_assoc($exe1);\n    $class_id=$exer1['Id'];\n\n    $q2=\"SELECT Subject_Id FROM class_subjects\n    WHERE Class_Id=$class_id AND Status=1\";\n    $exe2=mysqli_query($link, $q2)\n    or\n    die('Error in class subjects function query 2');\n\n    $subjects=[];\n    while ($exer2=mysqli_fetch_assoc($exe2)) {\n        $subject_id = $exer2['Subject_Id'];\n\n        $q3=\"SELECT Name FROM subjects WHERE Id=$subject_id AND Status=1\";\n        $exe3=mysqli_query($link, $q3)\n         or\n         die('Error in class subjects function query 3');\n\n        while ($exer3=mysqli_fetch_assoc($exe3)) {\n              $subject_Name = $exer3['Name'];\n              $subjects[]=$subject_Name;\n        }\n    }\n    return $subjects;\n}\n\n\n\n/**\n * This function Change dob to age.\n *\n * @param string $dob date of birth\n *\n * @return year.\n */\nfunction Calculate_age($dob)\n{\n    $date = new DateTime($dob);\n    $now = new DateTime();\n    $interval = $now->diff($date);\n    return $interval->y;\n}\n\n\n/**\n * Save log of query\n *\n * @param string $msg Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Save_Log_data($msg)\n{\n    $fp = fopen('log.txt', 'a');//opens file in append mode\n    $server_name = $_SERVER['REMOTE_ADDR'];\n    $msg = $msg.\" \".$server_name.\" \".date('d-M-Y H:i:s').\"\\n\";\n    fwrite($fp, $msg);\n    fclose($fp);\n}\n\n\n\n/**\n * This function contain name of school classes like\n * 6th, 7th, 8th etc\n *\n * @return void  save message.\n */\nfunction School_classes()\n{\n    global $link;\n    $myclasses=[];\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n    $school_id =Convert_School_Name_To_id($school_name);\n    $q=\"SELECT Name from school_classes where Status=1 AND School_Id=$school_id\";\n    $exe=mysqli_query($link, $q);\n    while ($school_classes=mysqli_fetch_assoc($exe)) {\n        $myclasses[] =  $school_classes['Name'];\n    }\n    return $myclasses;\n}\n\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $class_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Class_Name_To_id($class_name)\n{\n    global $link;\n    $data1[]=Select_Column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n    return  $class_id=$data1[0]['Id'];\n\n}\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $subject_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Subject_Name_To_id($subject_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n    return  $subject_id=$data2[0]['Id'];\n\n}\n\n/**\n * This function change Teacher name to Id\n *\n * @param string $teacher_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Teacher_Name_To_id($teacher_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"employees\", \"Id\", \"Name\", $teacher_name);\n    return  $subject_id=$data2[0]['Id'];\n\n}\n\n/**\n * This function change School name to Id\n *\n * @param string $school_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_School_Name_To_id($school_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"schools\", \"Id\", \"Name\", $school_name);\n    return  $school_id=$data2[0]['Id'];\n}\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return string  Teacher Name.\n */\nfunction Subject_teacher($class_name,$subject_name)\n{\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n\n    $my_school=\"GHSS Chitor\";\n    if ($school_name!==$my_school) {\n        return \"_____\";\n\n    } else {\n\n        global $link;\n\n        // show class_id based on class name.\n        $class_id=Convert_Class_Name_To_id($class_name);\n\n        //show subject_id based on subject_name;\n        $subject_id=Convert_Subject_Name_To_id($subject_name);\n\n        // show class_subject_id based on class and subject_id.\n        $q=\"SELECT Id FROM class_subjects\n        WHERE Class_Id=$class_id AND Subject_Id=$subject_id\";\n        $exe=mysqli_query($link, $q)\n        or\n        die('Error in ID selection in Subject teacher function');\n        $exer=mysqli_fetch_assoc($exe);\n        $class_subject_id=$exer['Id'];\n\n\n        // Select teacher Id based on class subject.\n        $t_id=Select_Column_data(\n            \"subject_teacher\", \"Teacher_Id\", \"Class_Subject_Id\", $class_subject_id\n        );\n\n        // if teacher is not assigend show blank marks.\n        if (!isset($t_id)) {\n            $teacher_name=\"_____\";\n            return $teacher_name;\n        }\n        $teacher_id=$t_id['Teacher_Id'];\n\n        // Select teacher name based on teacher id.\n        $t_name=Select_Column_data(\"employees\", \"Name\", \"Id\", $teacher_id);\n        $teacher_name=$t_name['Name'];\n\n        return $teacher_name;\n    }\n}\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return bool  True or False.\n */\nfunction Check_Subject_For_class($class_name,$subject_name)\n{\n    //echo \"Class Name= $class_name Subject Name= $subject_name \";\n    global $link;\n\n    //Step 1: Change Class Name to Class ID.\n    $data1[]=select_column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n    $class_id=$data1[0]['Id'];\n\n    //Step 2: Change Subject Name to ID.\n    $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n    $subject_id=$data2[0]['Id'];\n\n    //Step 3: Determine if it is allowed or not.\n    $q=\"Select Status from class_subjects\n    WHERE Class_Id=$class_id AND Subject_Id=$subject_id\";\n\n    $exe=mysqli_query($link, $q);\n    $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n        return \"Subject Not Defined.\";\n    } else {\n        $exer=mysqli_fetch_assoc($exe);\n        $status=$exer['Status'];\n        if ($status==1) {\n            return true;\n        } else {\n            return false;\n        }\n\n    }\n}\n\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $school_name  Msg to be saved\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return Void  save message.\n */\nfunction One_Subject_Total_marks($school_name, $class_name,$subject_name)\n{\n\n    global $link;\n    $class_id=Convert_Class_Name_To_id($class_name);\n    $subject_id=Convert_Subject_Name_To_id($subject_name);\n    $school_id=Convert_School_Name_To_id($school_name);\n\n    $q=\"Select Total_Marks from class_subjects\n    WHERE Class_Id=$class_id AND Subject_Id=$subject_id And School_Id=$school_id\";\n\n    $exe=mysqli_query($link, $q);\n    $total_marks=mysqli_fetch_assoc($exe);\n    $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n        return 0;\n    } else {\n\n        return $total_marks['Total_Marks'];\n\n    }\n\n\n\n}\n/**\n * Show all the subjects of a class in index array. As $Subject[$i]['Name'];\n *\n * @param string $school_name Name of a School\n * @param string $class_name  Name of a class\n *\n * @return array  All Subjects of A Class a $subjects[$i]['Name'].\n */\nfunction Select_Subjects_Of_class($school_name,$class_name)\n{\n    global $link;\n    // convert class name to class id as table data is in Id from\n    $school_id=Convert_School_Name_To_id($school_name);\n    $class_id=Convert_Class_Name_To_id($class_name);\n    $q=\"SELECT Subject_Id from class_subjects\n    WHERE Class_Id='$class_id' AND School_Id='$school_id' AND Status='1'\";\n    $exe=mysqli_query($link, $q) or die('Not table to select subject of a class');\n    $subjects=array();\n    while ($exer=mysqli_fetch_assoc($exe)) {\n            $subject_id=$exer['Subject_Id'];\n          $subject=Select_Column_data(\"subjects\", \"Name\", \"Id\", $subject_id);\n          array_push($subjects, $subject);\n    }\n    return $subjects;\n\n}\n\n/**\n * Class Total Marks.. Sum of all subjects total marks.\n\n * @param string $school_name school name\n * @param string $class_name  Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Class_Total_marks($school_name,$class_name)\n{\n    global $link;\n    $total_marks=0;\n    $subjects=Select_Subjects_Of_class($school_name, $class_name);\n    for ($i=0;$i<count($subjects);$i++) {\n        $marks =  One_Subject_Total_marks(\n            $school_name, $class_name, $subjects[$i]['Name']\n        );\n        $total_marks = $total_marks+$marks;\n    }\n     return $total_marks;\n}\n\n/**\n * Check Lock if marks updation is allowed;\n *\n * @param string $school_name  Name of the subject.\n * @param string $class_name   Name of the class.\n * @param string $subject_name Name of the subject.\n *\n * @return int 1 or 0. one means status is on updation not allowed.\n */\nfunction Check_Subject_Update_Lock_status($school_name,$class_name,$subject_name)\n{\n     //echo \"Class Name= $class_name Subject Name= $subject_name \";\n     global $link;\n\n     $school_id=Convert_School_Name_To_id($school_name);\n\n     $data1[]=select_column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n     $class_id=$data1[0]['Id'];\n\n     $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n     $subject_id=$data2[0]['Id'];\n     $q=\"Select Lock_Status from class_subjects\n     WHERE Class_Id=$class_id AND Subject_Id=$subject_id AND School_Id=$school_id\";\n\n     $exe=mysqli_query($link, $q);\n     $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n         //echo \"False\";\n         return \"Subject Not Defined\";\n    } else {\n         $exer=mysqli_fetch_assoc($exe);\n         return $exer['Lock_Status'];\n    }\n\n}\n\n\n/**\n * Validate Form Input;\n *\n * @param string $id Id of the class.\n *\n * @return string return clean data.\n */\nfunction Convert_School_Id_To_name($id) \n{\n    // Convert school_id to school_name\n    $school_names=Select_Single_Column_Array_data(\n        \"Name\", \"schools\", \"Id\", \"$id\"\n    );\n    return $school_names[0];\n}\n\n\n/**\n * Validate Form Input;\n *\n * @param string $id Id of the class.\n *\n * @return string return Name of Class\n */\nfunction Convert_Class_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_class_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"school_classes\", \"Id\", \"$id\"\n    );\n\n    return $selected_class_id_array[0];\n}\n\n/**\n * Convert Subject Id to Name;\n *\n * @param integer $id Id of the Subject.\n *\n * @return string return Name of Subject.\n */\nfunction Convert_Subject_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_subject_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"subjects\", \"Id\", \"$id\"\n    );\n\n    return $selected_subject_id_array[0];\n}\n\n/**\n * Convert Teacher Id to Name;\n *\n * @param integer $id Id of the Subject.\n *\n * @return string return Name of Subject.\n */\nfunction Convert_Teacher_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_subject_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"employees\", \"Id\", \"$id\"\n    );\n\n    return $selected_subject_id_array[0];\n}\n\n/**\n * Pass Percentage of class;\n *\n * @param string $class Name of class.\n *\n * @return string return clean data.\n */\nfunction Pass_percentage($class) \n{\n    $percentages=Select_Single_Column_Array_data(\n        \"Pass_Percentage\", \"school_classes\", \"Name\", \"'$class'\"\n    );\n    $pass_percentage=$percentages[0];\n    return $pass_percentage;\n}\n\n/**\n * Check number of rows effected;\n *\n * @param string $column_name       Name of class.\n * @param string $table_name        Name of class.\n * @param string $where_column_name Name of class.\n * @param string $value             value of column.\n *\n * @return string return Number of rows effected.\n */\nfunction Check_Rows_effected($column_name,$table_name,$where_column_name,$value)\n{\n    global $link;\n    $q=\"SELECT $column_name FROM $table_name WHERE $where_column_name='$value'\";\n    $exe=mysqli_query($link, $q);\n    $rows_effected=mysqli_num_rows($exe);\n    return $rows_effected;\n}\n\n/**\n * Class Result page footer\n *\n * @param string  $class Name of class\n * @param integer $fail  Number of fail students\n * @param integer $pass  Number of pass students\n * @param integer $total Number of total students\n * \n * @return Void  show footer with pass fail and total with committee members.\n */\nfunction Exam_footer($class,$fail,$pass,$total)\n{\n    global $SCHOOL_FULL_NAME_ABV;\n    $pass_p_age=($pass*100)/$total;\n    $pass_p_age=number_format($pass_p_age, 2, '.', ' ');\n    echo \"<div class='row'>\n          <div class='col-sm-4'>\n            <div class='container'>\n              NOTE:\n                <ul>\n                  <li> Passing Percentage=\".Pass_percentage($class).\"%\n                  </li>\n                  \n                  <li> Repeater passing percentage=10%</li>\n                </ul>\n            </div>\n            <div class='container mt-5'>\n              <p> _____________________________ </p>\n              <p> Principal $SCHOOL_FULL_NAME_ABV </p>\n            </div>\n          </div>\n          <div class='col-sm-4 border'>\n          <table class='table table-border'>\n          <tr> <td>Failed </td> <td> $fail </td></tr>\n          <tr> <td>Passed </td> <td> $pass </td></tr>\n          <tr> <td>Passed Percentage </td> <td> $pass_p_age </td></tr>\n        </table>\n      </div>\n          <div class='col-sm-4 border'> \";\n          echo\"  <table class='table'>\n            <caption class='text-center caption-top'>\n                Examination Committee Members </caption>\";\n            $members_ids=Select_Single_Column_Array_data(\n                'Member_Id', \"exam_committee\", \"Status\", \"1\"\n            );\n          $serial_no=1;\n    foreach ($members_ids as $id) {\n        echo \"<tr><td> $serial_no </td>\";\n        echo \"<td>\";\n        echo Convert_Teacher_Id_To_name($id);\n        echo \" Sb</td><td>_____________</td></tr>\";\n        $serial_no++; \n    }\n            echo\"</table>\n            \";\n      echo   \"</div>\n    </div>\n    \";\n}\n?>\n\n\n", "<?php\n/**\n * Check If Roll No Already Exists.\n * php version 8.1\n *\n * @category Exam\n * @package  Adf\n *\n * @author Waqas Ahmad <waqaskanju@gmail.com>\n *\n * @license http://www.abc.com MIT\n *\n * @link None\n **/\nsession_start();\nrequire_once '../db_connection.php';\nrequire_once '../functions.php';\n$link=$LINK;\n\n\nif (isset($_GET['roll_no'])) {\n    $roll_no=$_GET['roll_no'];\n    $roll_no=Validate_input($roll_no);\n\n    if ($_GET['table']=='student') {\n        $q=\"SELECT * from students_info WHERE Roll_No=\".$roll_no;\n        $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n        $total_rows=mysqli_num_rows($qr);\n        if ($total_rows>0) {\n            echo \"Data already exists.\";\n        }\n    }\n\n\n    if ($_GET['table']=='marks') {\n        if ($roll_no==\"\") {\n            echo 'Type Roll No.';\n            $roll_no=1;\n        }\n        $q=\"SELECT * from marks WHERE Roll_No=\".$roll_no;\n        $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n        $total_rows=mysqli_num_rows($qr);\n        if ($total_rows>0) {\n            echo \"Data already exists.Try Editing.\";\n        }\n    }\n}\nif (isset($_GET['admission_no'])) {\n        $admission_no=$_GET['admission_no'];\n        $admission_no=Validate_input($admission_no);\n    $q=\"SELECT admission_no from students_info WHERE admission_no=$admission_no\";\n    $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n    $total_rows=mysqli_num_rows($qr);\n    if ($total_rows>0) {\n        echo \"Duplicate Admission No\";\n    } else {\n        echo \"Looks Good\";\n    }\n}\n?>\n", "<?php\n/**\n * Add Subject Marks script file consumed by ajax\n * called from add_subject_marks.php file.\n *  * php version 8.1\n *\n * @category Exam\n *\n * @package None\n *\n * @author Waqas <waqaskanju@gmail.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once '../sand_box.php';\n$link=$LINK;\n// not allow to use this file when mode=read in config file.\n$school=$SCHOOL_NAME;\n/* Roll No */\n$roll_no=$_GET['roll_no'];\n$roll_no=Validate_input($roll_no);\n/* Subject  Name Marks Column */\n$subject = $_GET['subject_name'];\n$subject=Validate_input($subject);\n/* Actual Subject  Name */\n$actual_subject=$_GET['actual_subject'];\n$actual_subject=Validate_input($actual_subject);\n/* Subject Marks */\n$marks=$_GET['marks'];\n$marks=Validate_input($marks);\n/* Class Name */\n$class=$_GET['class_name'];\n$class=Validate_input($class);\n$update_Status=Check_Subject_Update_Lock_status($school, $class, $actual_subject);\nif ($marks>100) {\n    echo \"Max Marks error\";\n    exit;\n}\n$q=\"UPDATE marks SET $subject = $marks WHERE Roll_No=$roll_no\";\n// Do this if lock=off, that means lock=0\n// Singel Marks changes=allow means 1.\nif ($SINGLE_MARKS_CHANGES==1 && $update_Status==0) {\n    $exe=mysqli_query($link, $q) or die('error'.mysqli_error($link));\n    if ($exe) {\n        echo \"<span class='alert alert-success' role='alert'> Marks Saved.\n                </span>\";\n    } else {\n        echo \"<span class='alert alert-danger' role='alert'>\n            Error in query\n        </span>\";\n    } \n} else {\n    echo \"<span class='alert alert-danger' role='alert'>\n        Marks are finalized.\n        Changes Not allowed. OR No Permission</span>\";\n}\n\n?>\n"], "fixing_code": ["<?php\n/**\n * Edit School\n * php version 8.1\n *\n * @category Site\n *\n * @package None\n *\n * @author Waqas <admin@waqaskanju.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once 'sand_box.php';\n$link=$LINK;\n\nif ($SCHOOL_CHANGES!=1) {\n    echo '<div class=\"bg-danger text-center\"> Not allowed!! </div>';\n    exit;\n}\n\n/* Rules for Naming add under score between two words. */\nif (isset($_GET['submit'])) {\n    $name=$_GET['school_name'];\n    $name=Validate_input($name);\n\n    $status=$_GET['status'];\n    $status=Validate_input($status);\n    \n    $id=$_GET['id'];\n    $id=Validate_input($id);\n\n    $q=\"Update  schools SET Name='$name', Status='$status' WHERE Id='$id'\";\n    $exe=mysqli_query($link, $q) or\n    die('Error in School Updation '. mysqli_error($link));\n    if ($exe) {\n          echo \"school updated\";\n    } else {\n          echo \"Error in Updation\";\n    }\n}\n?>\n  <?php Page_header('Edit School'); ?>\n</head>\n<body>\n<?php \n$url_id= $_GET['id'];\n$url_id=Validate_input($url_id);\n$q=\"SELECT * from schools WHERE Id='$url_id'\";\n$exe=mysqli_query($link, $q);\n$exer=mysqli_fetch_assoc($exe);\n\n$school_name=$exer['Name'];\n$status=$exer['Status'];\n$id=$exer['Id'];\n?>\n<div class=\"container-fluid\">\n  <form class=\"p-3\">\n    <div class=\"row\">\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"school_name\" class=\"form-label\">School Name:</label>\n        <input type=\"text\" placeholder=\"Type School Name\" \n                class=\"form-control\" name=\"school_name\" \n                value=\"<?php echo $school_name; ?>\" id=\"school_name\" required>\n      </div>\n    <div>\n    <div class=\"row mt-1\">\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"status\" class=\"form-label\">Status:</label>\n        <input type=\"number\" class=\"form-control\" name=\"status\" \n               value=\"<?php echo $status;?>\" min=\"0\" max=\"1\" required>\n      </div>\n      <div class=\"col-sm-6\">\n      <input type=\"hidden\" value=\"<?php echo $id;?>\" name=\"id\">\n      <input type=\"submit\" name=\"submit\" class=\"btn btn-primary mt-4\" \n            value=\"Update School Name\">\n      </div>\n    <div>\n    </form>\n  </div>\n\n  <div class=\"container-fluid\">\n  <h3>Existing Schools</h3>\n  <div id=\"existing_schools\" class=\"bg-white\">\n  </div>\n</div>\n<script type=\"text/javascript\" src=\"js/add_schools.js\">\n<?php Page_close(); ?>", "<?php\n/**\n * Add  All Subjects Marks of Students\n * php version 8.1\n *\n * @category Exam\n *\n * @package None\n *\n * @author Waqas <admin@waqaskanju.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once 'sand_box.php';\n$link=$LINK;\n$selected_class=$CLASS_NAME;\n$selected_school=$SCHOOL_NAME;\n\nif ($SCHOOL_CHANGES!=1) {\n    echo '<div class=\"bg-danger text-center\"> Not allowed!! </div>';\n    exit;\n}\n\n/* Rules for Naming add under score between two words. */\nif (isset($_GET['submit'])) {\n    $status=$_GET['status'];\n    $status=Validate_input($status);\n    \n    $name=$_GET['class_name'];\n    $name=Validate_input($name);\n    \n    $id=$_GET['id'];\n    $id=Validate_input($id);\n\n    $school=$_GET['school'];\n    $school=Validate_input($school);\n\n    $pass_percentage=$_GET['pass_percentage'];\n    $pass_percentage=Validate_input($pass_percentage);\n\n    $school_id=Convert_School_Name_To_id($school);\n    $q=\"Update  school_classes \n    SET Status='$status', Name='$name', School_Id='$school_id', \n    Pass_Percentage='$pass_percentage' WHERE Id='$id'\";\n    $exe=mysqli_query($link, $q) or\n    die('Error in Class Updation '. mysqli_error($link));\n    if ($exe) {\n          echo \"<div class='alert-success'>Class Updated</div>\";\n          header('refresh:1 url=add_school_class.php');\n    } else {\n          echo \"Error in Updation\";\n    }\n}\n?>\n  <?php Page_header('Edit School\\'s Class'); ?>\n</head>\n<body>\n<?php \n$url_id=$_GET['id'];\n$url_id=Validate_input($url_id);\n\n$q=\"SELECT * from school_classes WHERE Id='$url_id'\";\n$exe=mysqli_query($link, $q);\n$exer=mysqli_fetch_assoc($exe);\n$school_id=$exer['School_Id'];\n$school_name=Convert_School_Id_To_name($school_id);\n$class_name=$exer['Name'];\n$status=$exer['Status'];\n$pass_percentage=$exer['Pass_Percentage'];\n$id=$exer['Id'];\n?>\n<div class=\"container-fluid\">\n  <form class=\"p-3\">\n    <div class=\"row\">\n      <?php Select_school($school_name); ?>\n      <div class=\"col-sm-6 form-group\">\n        <label for=\"class_name\" class=\"form-label\">Class Name:</label>\n        <input type=\"text\" placeholder=\"Type Class Name\" \n                class=\"form-control\" name=\"class_name\" \n                value=\"<?php echo $class_name; ?>\" id=\"class_name\" required>\n      </div>\n    <div>\n    <div class=\"row mt-1\">\n      <div class=\"col-sm-4 form-group\">\n        <label for=\"pass_percentage\" class=\"form-label\">Pass Percentage:</label>\n        <input type=\"number\" class=\"form-control\" name=\"pass_percentage\" \n               value=\"<?php echo $pass_percentage;?>\" \n               step=\"0.1\" min=\"0\" max=\"100\" required>\n      </div>\n      <div class=\"col-sm-4 form-group\">\n        <label for=\"status\" class=\"form-label\">Status:</label>\n        <input type=\"number\" class=\"form-control\" name=\"status\" \n               value=\"<?php echo $status;?>\" min=\"0\" max=\"1\" required>\n      </div>\n      <div class=\"col-sm-4\">\n      <input type=\"hidden\" value=\"<?php echo $id;?>\" name=\"id\">\n      <input type=\"submit\" name=\"submit\" class=\"btn btn-primary mt-4\" \n            value=\"Update Class Name\">\n      </div>\n    <div>\n    </form>\n  </div>\n\n  <div class='container-fluid'>\n    <h3>Existing School Classes</h3>\n    <div id='exiting-school-classes'>\n    </div>\n  </div>\n  <script type=\"text/javascript\" src=\"js/add_school_class.js\">\n<?php Page_close(); ?>", "<?php\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n/**\n * This function change -1 to absent.\n *\n * @param Integer $marks date of birth\n *\n * @return Makrs of A for absent.\n */\nfunction Show_absent($marks)\n{\n    if ($marks == -1) {\n            $marks =\"A\";\n    }\n    return $marks;\n}\n\n/**\n * This function change absent to zero for total marks calculation.\n *\n * @param Integer $marks_value date of birth\n *\n * @return Makrs of A for absent.\n */\nfunction Change_Absent_tozero($marks_value)\n{\n    if ($marks_value == -1) {\n            $marks_value=0;\n    }\n    return $marks_value;\n}\n\n\n\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $subject Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Change_Subject_To_Marks_col($subject)\n{\n    switch ($subject) {\n    case \"English\":\n        return \"English_Marks\";\n    break;\n    case \"Urdu\":\n        return \"Urdu_Marks\";\n    break;\n    case \"Maths\":\n        return \"Maths_Marks\";\n    break;\n    case \"Hpe\":\n        return \"Hpe_Marks\";\n    break;\n    case \"Nazira\":\n        return \"Nazira_Marks\";\n    break;\n    case \"General Science\":\n        return \"Science_Marks\";\n    break;\n    case \"Arabic\":\n        return \"Arabic_Marks\";\n    break;\n    case \"Islamyat\":\n        return \"Islamyat_Marks\";\n    break;\n    case \"History And Geography\":\n        return \"History_Marks\";\n    break;\n    case \"Computer Science\":\n        return \"Computer_Marks\";\n    break;\n    case \"Mutalia Quran\":\n        return \"Mutalia_Marks\";\n    break;\n    case \"Drawing\":\n        return \"Drawing_Marks\";\n    break;\n    case \"Social Study\":\n        return \"Social_Marks\";\n    break;\n    case \"Pak Study\":\n        return \"Social_Marks\";\n    break;\n    case \"Pashto\":\n        return \"Pashto_Marks\";\n    break;\n    case \"Biology\":\n        return \"Biology_Marks\";\n    break;\n    case \"Chemistry\":\n        return \"Chemistry_Marks\";\n    break;\n    case \"Physics\":\n        return \"Physics_Marks\";\n    break;\n    case \"Civics\":\n        return \"Civics_Marks\";\n    break;\n    case \"Economics\":\n        return \"Economics_Marks\";\n    break;\n    case \"Islamic Study\":\n        return \"Islamic_Study_Marks\";\n    break;\n    case \"Islamic Education\":\n        return \"Islamic_Education_Marks\";\n    break;\n    case \"Statistics\":\n        return \"Statistics_Marks\";\n    break;\n    default:\n        echo \"Unknown Subject\";\n    }\n\n}\n\n\n/**\n * Project Folder Name\n * \n * @return Void  show project folder used in print.\n */\nfunction Project_Folder_name()\n{\n    // return folder of the project.\n    $path=getcwd();\n    //echo  $main_dir=dirname($path, 1);\n    $chunks = explode('\\\\', $path);\n    $chunks_length=count($chunks);\n    return $my_directory=$chunks[$chunks_length-1];\n    \n}\n\n/**\n * Project Folder Name\n * \n * @param integer $status Name of class\n * \n * @return Void  show project folder used in print.\n */\nfunction Change_Status_To_word($status) \n{\n    return $status==1? \"Active\" : \"Inactive\";\n}\n\n/**\n * Project Folder Name\n * \n * @param time   $sec Time in Second\n * @param string $url Url of the page\n * \n * @return Void  show project folder used in print.\n */\nfunction redirection($sec,$url) \n{\n    header(\"refresh:$sec; url=$url\");\n}\n\n\n/**\n * Show Alert Message\n * \n * @param string $message    Time in Second\n * @param string $alert_type Url of the page\n * \n * @return Void  show project folder used in print.\n */\nfunction Show_alert($message,$alert_type)\n{\n    echo \"<div class='alert alert-$alert_type alert-dismissible fade show' \n               role='alert'>\n                  <strong>Success!</strong> $message\n                    <button type='button' class='btn-close' data-bs-dismiss='alert' \n                            aria-label='Close'></button>\n                </div>\";\n}\n?>", "<?php\n    /**\n     * USe for testing Code\n     * php version 8.1\n     *\n     * @category Test\n     *\n     * @package None\n     *\n     * @author Waqas <waqaskanju@gmail.com>\n     *\n     * @license http://www.waqaskanju.com/license MIT\n     *\n     * @link http://www.waqaskanju.com/\n     **/\n\nrequire_once 'sand_box.php';\n$link=$LINK;\n\n\n\necho $query = 'SELECT Name,Class FROM students_info WHERE Name=? AND Class=?';\n$result = mysqli_execute_query($link, $query, ['Abdullah','5th']);\nforeach ($result as $row) {\n    printf($row[\"Name\"]. $row['Class']);\n    echo \"<br>\";\n}\n?>\n", "<?php\n  /**\n   * All the general functions of the website resides here.\n   * php version 8.1\n   *\n   * @category Functions\n   *\n   * @package Functions\n   *\n   * @author Waqas Ahmad <waqaskanju@gmail.com>\n   *\n   * @license http://www.abc.com MIT\n   *\n   * @link Adfas\n   **/\n  date_default_timezone_set(\"Asia/Karachi\");\n  require_once 'db_connection.php';\n  require_once 'config.php';\n  require_once 'functions.php';\n  $link=$LINK;\n/**\n *  For showing the title of the page\n *\n * @param string $page_name of the page\n *\n * @return void\n */\nfunction Page_header($page_name)\n{\n    echo '<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <title>'.$page_name.'</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"css/style.css\">\n    <link rel=\"stylesheet\" href=\"css/bootstrap-icons.css\">\n    <link rel=\"stylesheet\" href=\"css/print.css\" media=\"print\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"images/favicon.ico\">\n\n    ';\n}\n/**\n *  For close the html and body tag\n *\n * @return void\n */\nfunction Page_close()\n{\n    echo'\n    <script  src=\"js/bootstrap.bundle.min.js\">\n    </script>\n    <script  src=\"js/custom.js\">\n    </script>\n    </body>\n\t</html>';\n}\n/**\n * Select Single value data.\n * 6th, 7th, 8th etc\n *\n * @param string $table_name   table name\n * @param string $column_name  column of the data\n * @param string $where_column Where condition\n * @param string $where_value  where value\n *\n * @return void  save message.\n */\nfunction Select_Column_data($table_name,$column_name,$where_column,$where_value)\n{\n    global $link;\n    $query = \"SELECT $column_name from $table_name\n    WHERE $where_column='$where_value'\";\n    $query_result=mysqli_query($link, $query) or die(\"Error in this query. $query\");\n    $query_result_value=mysqli_fetch_assoc($query_result);\n    return $query_result_value;\n}\n\n/**\n *  Select one column's array data from a table\n *\n * @param string $column_name  which column data you want to get.\n * @param string $table_name   table name\n * @param string $where_column column name for where clause\n * @param string $where_value  value of the where column clause.\n *\n * @return array\n */\nfunction Select_Single_Column_Array_data(\n    $column_name,$table_name,$where_column,$where_value\n) {\n    $q=\"SELECT $column_name from $table_name WHERE $where_column=$where_value\";\n    global $link;\n    $exe=mysqli_query($link, $q);\n    $data=[];\n    while ($exer=mysqli_fetch_assoc($exe)) {\n        $value=$exer[$column_name];\n        array_push($data, $value);\n    }\n    return $data;\n}\n\n/**\n *  Showing the Combo box with Class Names\n *\n * @param string $selected_class which column data you want to get.\n *\n * @return $selected_class For example 6th 7th etc\n */\nfunction Select_class($selected_class)\n{\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n    $school_id=Convert_School_Name_To_id($school_name);\n    $class_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"school_classes\", \"School_Id\", \"$school_id\"\n    );\n    $selected=\"selected\";\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='class_exam' class='form-label'>Select Class Name: </label>\n              <select class='form-control' name='class_exam' id='class_name'\n               required onchange='view_existing_subjects()' >\n                <option value=''>Select Class </option>\";\n    for ($i=0;$i<count($class_names_array);$i++) {\n        echo \"<option value='$class_names_array[$i]'\";\n        if ($selected_class==$class_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n               echo \" selected\";\n        }\n        echo\"> $class_names_array[$i] </option> \";\n    }\n    echo \"   </select>\n      </div>\n\";\n\n}\n\n/**\n *  Showing Combo box for select\n *\n * @param string $selected_school name of school\n *\n * @return name of classes GPS Chitor Kokrai etc\n */\nfunction Select_school($selected_school)\n{\n    $selected=\"selected\";\n    $school_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"schools\", \"Status\", \"1\"\n    );\n    echo \"\n\t<div class='form-group col-md-6'>\n\t\t<label for='school' class='form-label'>Select School Name: </label>\n              <select class='form-control' name='school' id='school_name'\n               required onchange='view_existing_school_classes()'>\n                <option value=''>Select School </option>\";\n    for ($i=0;$i<count($school_names_array);$i++) {\n        echo \"<option value='$school_names_array[$i]'\";\n        if ($selected_school==$school_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n            echo\"> $school_names_array[$i] </option> \";\n    }\n        echo \"   </select>\n    </div>\n             \";\n}\n\n/**\n *  Select subject\n *\n * @param string $selected_subject name of school\n *\n * @return void of classes GPS Chitor Kokrai etc\n */\nfunction Select_subject($selected_subject)\n{\n    $selected=\"selected\";\n    $subject_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"subjects\", \"Status\", \"1\"\n    );\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='class_exam' class='form-label'>Select Subject Name: </label>\n              <select class='form-control' name='subject' id='subject_name'\n               required>\n                <option value=''>Select Subject </option>\";\n    for ($i=0;$i<count($subject_names_array);$i++) {\n        echo \"<option value='$subject_names_array[$i]'\";\n        if ($selected_subject==$subject_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n                    echo\"> $subject_names_array[$i] </option> \";\n    }\n    echo \"   </select>\n    </div>\n        \";\n}\n/**\n *  Select Teacher\n *\n * @param string $selected_teacher name of school\n *\n * @return void Print combo box with teachers\n */\nfunction Select_teacher($selected_teacher)\n{\n    $teacher_names_array=Select_Single_Column_Array_data(\n        \"Name\", \"employees\", \"Status\", \"1\"\n    );\n    $selected=\"selected\";\n    echo \"\n<div class='form-group col-md-6'>\n\t<label for='teacher_name' class='form-label'>Select Teacher Name: </label>\n              <select class='form-control' name='teacher_name' required>\n                <option value=''>Select Teacher </option>\";\n    for ($i=0;$i<count($teacher_names_array);$i++) {\n        echo \"<option value='$teacher_names_array[$i]'\";\n        if ($selected_teacher==$teacher_names_array[$i]) {\n            //space before selected is requiredfor W3C validation.\n            echo \" selected\";\n        }\n                    echo\"> $teacher_names_array[$i] </option> \";\n    }\n    echo \"  </select>\n      </div>\n        \";\n}\n/**\n *  Calculate position but its not 100 accurate.\n * Make this function Dynamic its not flexible.\n *\n * @param string $class  name of a class\n * @param string $school name of a school\n *\n * @return int    0 or 1\n */\nfunction Calculate_position($class,$school)\n{\n    global $link;\n    $class_name=$class;\n    $school_name=$school;\n\n    $q=\"SELECT Roll_No from students_info\n\twhere Class='$class_name' AND School='$school_name' AND Status=1\";\n    $qr=mysqli_query($link, $q) or die('Error in Q 1'.mysqli_error($link));\n    while ($qra=mysqli_fetch_assoc($qr)) {\n        $q2=\"SELECT * FROM marks WHERE Roll_No=\".$qra['Roll_No'];\n        $qr2=mysqli_query($link, $q2) or die('Error in Q 2'. mysqli_error($link));\n        while ($qfa=mysqli_fetch_assoc($qr2)) {\n            $sum = 0;\n            $sum =  $qfa['English_Marks'] + $qfa['Urdu_Marks'] +\n                    $qfa['Maths_Marks'] + $qfa['Hpe_Marks'] +\n                    $qfa['Nazira_Marks'] + $qfa['Science_Marks'] +\n                    $qfa['Arabic_Marks'] + $qfa['Islamyat_Marks'] +\n                    $qfa['History_Marks'] + $qfa['Computer_Marks'] +\n                    $qfa['Mutalia_Marks'] + $qfa['Qirat_Marks'] +\n                    $qfa['Social_Marks'] + $qfa['Pashto_Marks'] +\n                    $qfa['Drawing_Marks'] + $qfa['Biology_Marks'] +\n                    $qfa['Chemistry_Marks'] + $qfa['Physics_Marks'];\n\n            $roll_no = $qfa['Roll_No'];\n            $q3=\"INSERT INTO position (Roll_No, Total_Marks )\n\t\t\tVALUES ('$roll_no', '$sum')\";\n\n            $qr3 = mysqli_query($link, $q3)\n            or\n            die('Error in Q 3 '.mysqli_error($link));\n            echo \" Roll No: \". $qfa['Roll_No']  . \" Completed <br>\";\n\n            $q4=\"Update students_info set Class_Position=''\n            where\n            Class='$class_name'\";\n            $qr4=mysqli_query($link, $q4);\n\n            if ($qr4) {\n                echo \" successfully emptyfied Class_Position of\".$class_name;\n            } else {\n                echo \"error in emptying the\".$class_name;\n            }\n        }\n    }\n    if ($qr) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n/**\n *  Add Data into Position Table\n *\n * @return void\n */\nfunction Add_Data_Into_position()\n{\n    global $link;\n    $count_row=\"SELECT COUNT(Total_Marks) as total_rows FROM position\";\n    $cqe=mysqli_query($link, $count_row)\n    or\n    die('Error Count Rows:'.mysqli_error($link));\n    $cqa=mysqli_fetch_assoc($cqe);\n    $total_entries=$cqa['total_rows'];\n    for ($i=0;$i<$total_entries;$i++) {\n        $q=\"SELECT Total_Marks,Roll_No FROM position\n        ORDER BY Total_Marks DESC LIMIT $i,1\";\n        $qr=mysqli_query($link, $q)\n        or\n        die('Error Select Distint total'. mysqli_error($link));\n        $qra=mysqli_fetch_assoc($qr);\n        $j=$i+1;\n        if ($i==0) {\n            $q=\"Update students_info\n            set Class_Position='1st   out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n             die('Error in first Position'.mysqli_error($link));\n        } else if ($i==1) {\n            $q=\"Update students_info\n            set Class_Position='2nd   out of $total_entries'\n             WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in 2nd Position'. mysqli_error($link));\n        } else if ($i==2) {\n            $q=\"Update students_info\n            set Class_Position='3rd   out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in 3rd Position'. mysqli_error($link));\n        } else if ($i>2) {\n            $q=\"Update students_info\n            set Class_Position=' $j th out of $total_entries'\n            WHERE Roll_No=\".$qra['Roll_No'];\n            mysqli_query($link, $q)\n            or\n            die('Error in nth Position'. mysqli_error($link));\n        } else {\n            echo \"Some thing is wrong\";\n        }\n    }\n    if ($cqe) {\n        echo \"Data is Successfully Added to Positions\";\n    }\n}\n\n/**\n *  Empty Position Table\n *\n * @return void\n */\nfunction Empty_Position_table()\n{\n    global $link;\n    $q=\"DELETE from position\";\n    $qr=mysqli_query($link, $q) or die('Error:in deletion'.mysqli_error($link));\n    if ($qr) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\n/**\n *  This function return all the subjects of a class.\n *\n * @param string $class_name name of a class\n *\n * @return void\n */\nfunction Class_subjects($class_name)\n{\n    global $link;\n    $q1=\"SELECT Id FROM School_Classes WHERE Name='$class_name'\";\n    $exe1=mysqli_query($link, $q1)\n    or\n    die('Error in class subjects function query 1');\n    $exer1= mysqli_fetch_assoc($exe1);\n    $class_id=$exer1['Id'];\n\n    $q2=\"SELECT Subject_Id FROM class_subjects\n    WHERE Class_Id=$class_id AND Status=1\";\n    $exe2=mysqli_query($link, $q2)\n    or\n    die('Error in class subjects function query 2');\n\n    $subjects=[];\n    while ($exer2=mysqli_fetch_assoc($exe2)) {\n        $subject_id = $exer2['Subject_Id'];\n\n        $q3=\"SELECT Name FROM subjects WHERE Id=$subject_id AND Status=1\";\n        $exe3=mysqli_query($link, $q3)\n         or\n         die('Error in class subjects function query 3');\n\n        while ($exer3=mysqli_fetch_assoc($exe3)) {\n              $subject_Name = $exer3['Name'];\n              $subjects[]=$subject_Name;\n        }\n    }\n    return $subjects;\n}\n\n\n\n/**\n * This function Change dob to age.\n *\n * @param string $dob date of birth\n *\n * @return year.\n */\nfunction Calculate_age($dob)\n{\n    $date = new DateTime($dob);\n    $now = new DateTime();\n    $interval = $now->diff($date);\n    return $interval->y;\n}\n\n\n/**\n * Save log of query\n *\n * @param string $msg Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Save_Log_data($msg)\n{\n    $fp = fopen('log.txt', 'a');//opens file in append mode\n    $server_name = $_SERVER['REMOTE_ADDR'];\n    $msg = $msg.\" \".$server_name.\" \".date('d-M-Y H:i:s').\"\\n\";\n    fwrite($fp, $msg);\n    fclose($fp);\n}\n\n\n\n/**\n * This function contain name of school classes like\n * 6th, 7th, 8th etc\n *\n * @return void  save message.\n */\nfunction School_classes()\n{\n    global $link;\n    $myclasses=[];\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n    $school_id =Convert_School_Name_To_id($school_name);\n    $q=\"SELECT Name from school_classes where Status=1 AND School_Id=$school_id\";\n    $exe=mysqli_query($link, $q);\n    while ($school_classes=mysqli_fetch_assoc($exe)) {\n        $myclasses[] =  $school_classes['Name'];\n    }\n    return $myclasses;\n}\n\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $class_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Class_Name_To_id($class_name)\n{\n    global $link;\n    $data1[]=Select_Column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n    return  $class_id=$data1[0]['Id'];\n\n}\n/**\n * This function change subject name to column name where\n * marks of the subject will be added.\n *\n * @param string $subject_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Subject_Name_To_id($subject_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n    return  $subject_id=$data2[0]['Id'];\n\n}\n\n/**\n * This function change Teacher name to Id\n *\n * @param string $teacher_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_Teacher_Name_To_id($teacher_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"employees\", \"Id\", \"Name\", $teacher_name);\n    return  $subject_id=$data2[0]['Id'];\n\n}\n\n/**\n * This function change School name to Id\n *\n * @param string $school_name Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Convert_School_Name_To_id($school_name)\n{\n    global $link;\n    $data2[]=Select_Column_data(\"schools\", \"Id\", \"Name\", $school_name);\n    return  $school_id=$data2[0]['Id'];\n}\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return string  Teacher Name.\n */\nfunction Subject_teacher($class_name,$subject_name)\n{\n    global $SCHOOL_NAME;\n    $school_name=$SCHOOL_NAME;\n\n    $my_school=\"GHSS Chitor\";\n    if ($school_name!==$my_school) {\n        return \"_____\";\n\n    } else {\n\n        global $link;\n\n        // show class_id based on class name.\n        $class_id=Convert_Class_Name_To_id($class_name);\n\n        //show subject_id based on subject_name;\n        $subject_id=Convert_Subject_Name_To_id($subject_name);\n\n        // show class_subject_id based on class and subject_id.\n        $q=\"SELECT Id FROM class_subjects\n        WHERE Class_Id=$class_id AND Subject_Id=$subject_id\";\n        $exe=mysqli_query($link, $q)\n        or\n        die('Error in ID selection in Subject teacher function');\n        $exer=mysqli_fetch_assoc($exe);\n        $class_subject_id=$exer['Id'];\n\n\n        // Select teacher Id based on class subject.\n        $t_id=Select_Column_data(\n            \"subject_teacher\", \"Teacher_Id\", \"Class_Subject_Id\", $class_subject_id\n        );\n\n        // if teacher is not assigend show blank marks.\n        if (!isset($t_id)) {\n            $teacher_name=\"_____\";\n            return $teacher_name;\n        }\n        $teacher_id=$t_id['Teacher_Id'];\n\n        // Select teacher name based on teacher id.\n        $t_name=Select_Column_data(\"employees\", \"Name\", \"Id\", $teacher_id);\n        $teacher_name=$t_name['Name'];\n\n        return $teacher_name;\n    }\n}\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return bool  True or False.\n */\nfunction Check_Subject_For_class($class_name,$subject_name)\n{\n    //echo \"Class Name= $class_name Subject Name= $subject_name \";\n    global $link;\n\n    //Step 1: Change Class Name to Class ID.\n    $data1[]=select_column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n    $class_id=$data1[0]['Id'];\n\n    //Step 2: Change Subject Name to ID.\n    $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n    $subject_id=$data2[0]['Id'];\n\n    //Step 3: Determine if it is allowed or not.\n    $q=\"Select Status from class_subjects\n    WHERE Class_Id=$class_id AND Subject_Id=$subject_id\";\n\n    $exe=mysqli_query($link, $q);\n    $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n        return \"Subject Not Defined.\";\n    } else {\n        $exer=mysqli_fetch_assoc($exe);\n        $status=$exer['Status'];\n        if ($status==1) {\n            return true;\n        } else {\n            return false;\n        }\n\n    }\n}\n\n\n/**\n * Show teacher name based on subject name and class name;\n *\n * @param string $school_name  Msg to be saved\n * @param string $class_name   Msg to be saved\n * @param string $subject_name Subject name\n *\n * @return Void  save message.\n */\nfunction One_Subject_Total_marks($school_name, $class_name,$subject_name)\n{\n\n    global $link;\n    $class_id=Convert_Class_Name_To_id($class_name);\n    $subject_id=Convert_Subject_Name_To_id($subject_name);\n    $school_id=Convert_School_Name_To_id($school_name);\n\n    $q=\"Select Total_Marks from class_subjects\n    WHERE Class_Id=$class_id AND Subject_Id=$subject_id And School_Id=$school_id\";\n\n    $exe=mysqli_query($link, $q);\n    $total_marks=mysqli_fetch_assoc($exe);\n    $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n        return 0;\n    } else {\n\n        return $total_marks['Total_Marks'];\n\n    }\n\n\n\n}\n/**\n * Show all the subjects of a class in index array. As $Subject[$i]['Name'];\n *\n * @param string $school_name Name of a School\n * @param string $class_name  Name of a class\n *\n * @return array  All Subjects of A Class a $subjects[$i]['Name'].\n */\nfunction Select_Subjects_Of_class($school_name,$class_name)\n{\n    global $link;\n    // convert class name to class id as table data is in Id from\n    $school_id=Convert_School_Name_To_id($school_name);\n    $class_id=Convert_Class_Name_To_id($class_name);\n    $q=\"SELECT Subject_Id from class_subjects\n    WHERE Class_Id='$class_id' AND School_Id='$school_id' AND Status='1'\";\n    $exe=mysqli_query($link, $q) or die('Not table to select subject of a class');\n    $subjects=array();\n    while ($exer=mysqli_fetch_assoc($exe)) {\n            $subject_id=$exer['Subject_Id'];\n          $subject=Select_Column_data(\"subjects\", \"Name\", \"Id\", $subject_id);\n          array_push($subjects, $subject);\n    }\n    return $subjects;\n\n}\n\n/**\n * Class Total Marks.. Sum of all subjects total marks.\n\n * @param string $school_name school name\n * @param string $class_name  Msg to be saved\n *\n * @return Void  save message.\n */\nfunction Class_Total_marks($school_name,$class_name)\n{\n    global $link;\n    $total_marks=0;\n    $subjects=Select_Subjects_Of_class($school_name, $class_name);\n    for ($i=0;$i<count($subjects);$i++) {\n        $marks =  One_Subject_Total_marks(\n            $school_name, $class_name, $subjects[$i]['Name']\n        );\n        $total_marks = $total_marks+$marks;\n    }\n     return $total_marks;\n}\n\n/**\n * Check Lock if marks updation is allowed;\n *\n * @param string $school_name  Name of the subject.\n * @param string $class_name   Name of the class.\n * @param string $subject_name Name of the subject.\n *\n * @return int 1 or 0. one means status is on updation not allowed.\n */\nfunction Check_Subject_Update_Lock_status($school_name,$class_name,$subject_name)\n{\n     //echo \"Class Name= $class_name Subject Name= $subject_name \";\n     global $link;\n\n     $school_id=Convert_School_Name_To_id($school_name);\n\n     $data1[]=select_column_data(\"school_classes\", \"Id\", \"Name\", $class_name);\n     $class_id=$data1[0]['Id'];\n\n     $data2[]=Select_Column_data(\"subjects\", \"Id\", \"Name\", $subject_name);\n     $subject_id=$data2[0]['Id'];\n     $q=\"Select Lock_Status from class_subjects\n     WHERE Class_Id=$class_id AND Subject_Id=$subject_id AND School_Id=$school_id\";\n\n     $exe=mysqli_query($link, $q);\n     $effect=mysqli_num_rows($exe);\n    if ($effect==0) {\n         //echo \"False\";\n         return \"Subject Not Defined\";\n    } else {\n         $exer=mysqli_fetch_assoc($exe);\n         return $exer['Lock_Status'];\n    }\n\n}\n\n\n/**\n * Validate Form Input;\n *\n * @param string $id Id of the class.\n *\n * @return string return clean data.\n */\nfunction Convert_School_Id_To_name($id) \n{\n    // Convert school_id to school_name\n    $school_names=Select_Single_Column_Array_data(\n        \"Name\", \"schools\", \"Id\", \"$id\"\n    );\n    return $school_names[0];\n}\n\n\n/**\n * Validate Form Input;\n *\n * @param string $id Id of the class.\n *\n * @return string return Name of Class\n */\nfunction Convert_Class_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_class_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"school_classes\", \"Id\", \"$id\"\n    );\n\n    return $selected_class_id_array[0];\n}\n\n/**\n * Convert Subject Id to Name;\n *\n * @param integer $id Id of the Subject.\n *\n * @return string return Name of Subject.\n */\nfunction Convert_Subject_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_subject_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"subjects\", \"Id\", \"$id\"\n    );\n\n    return $selected_subject_id_array[0];\n}\n\n/**\n * Convert Teacher Id to Name;\n *\n * @param integer $id Id of the Subject.\n *\n * @return string return Name of Subject.\n */\nfunction Convert_Teacher_Id_To_name($id) \n{\n    // Convert Class Id to Class Name\n    $selected_subject_id_array=Select_Single_Column_Array_data(\n        \"Name\", \"employees\", \"Id\", \"$id\"\n    );\n\n    return $selected_subject_id_array[0];\n}\n\n/**\n * Pass Percentage of class;\n *\n * @param string $class Name of class.\n *\n * @return string return clean data.\n */\nfunction Pass_percentage($class) \n{\n    $percentages=Select_Single_Column_Array_data(\n        \"Pass_Percentage\", \"school_classes\", \"Name\", \"'$class'\"\n    );\n    $pass_percentage=$percentages[0];\n    return $pass_percentage;\n}\n\n/**\n * Check number of rows effected;\n *\n * @param string $column_name       Name of class.\n * @param string $table_name        Name of class.\n * @param string $where_column_name Name of class.\n * @param string $value             value of column.\n *\n * @return string return Number of rows effected.\n */\nfunction Check_Rows_effected($column_name,$table_name,$where_column_name,$value)\n{\n    global $link;\n    $q=\"SELECT $column_name FROM $table_name WHERE $where_column_name='$value'\";\n    $exe=mysqli_query($link, $q);\n    $rows_effected=mysqli_num_rows($exe);\n    return $rows_effected;\n}\n\n/**\n * Class Result page footer\n *\n * @param string  $class Name of class\n * @param integer $fail  Number of fail students\n * @param integer $pass  Number of pass students\n * @param integer $total Number of total students\n * \n * @return Void  show footer with pass fail and total with committee members.\n */\nfunction Exam_footer($class,$fail,$pass,$total)\n{\n    global $SCHOOL_FULL_NAME_ABV;\n    $pass_p_age=($pass*100)/$total;\n    $pass_p_age=number_format($pass_p_age, 2, '.', ' ');\n    echo \"<div class='row'>\n          <div class='col-sm-4'>\n            <div class='container'>\n              NOTE:\n                <ul>\n                  <li> Passing Percentage=\".Pass_percentage($class).\"%\n                  </li>\n                  \n                  <li> Repeater passing percentage=10%</li>\n                </ul>\n            </div>\n            <div class='container mt-5'>\n              <p> _____________________________ </p>\n              <p> Principal $SCHOOL_FULL_NAME_ABV </p>\n            </div>\n          </div>\n          <div class='col-sm-4 border'>\n          <table class='table table-border'>\n          <tr> <td>Failed </td> <td> $fail </td></tr>\n          <tr> <td>Passed </td> <td> $pass </td></tr>\n          <tr> <td>Passed Percentage </td> <td> $pass_p_age </td></tr>\n        </table>\n      </div>\n          <div class='col-sm-4 border'> \";\n          echo\"  <table class='table'>\n            <caption class='text-center caption-top'>\n                Examination Committee Members </caption>\";\n            $members_ids=Select_Single_Column_Array_data(\n                'Member_Id', \"exam_committee\", \"Status\", \"1\"\n            );\n          $serial_no=1;\n    foreach ($members_ids as $id) {\n        echo \"<tr><td> $serial_no </td>\";\n        echo \"<td>\";\n        echo Convert_Teacher_Id_To_name($id);\n        echo \" Sb</td><td>_____________</td></tr>\";\n        $serial_no++; \n    }\n            echo\"</table>\n            \";\n      echo   \"</div>\n    </div>\n    \";\n}\n\n\n/**\n * Validate Form Input;\n *\n * @param string $data Name of the class.\n *\n * @return string return clean data.\n */\nfunction Validate_input($data)\n{\n    \n    global $link;\n    $data = trim($data);\n    $data = stripslashes($data);\n    $data = htmlspecialchars($data);\n    mysqli_real_escape_string($link, $data);\n    return $data;\n}\n?>\n\n\n", "<?php\n/**\n * Check If Roll No Already Exists.\n * php version 8.1\n *\n * @category Exam\n * @package  Adf\n *\n * @author Waqas Ahmad <waqaskanju@gmail.com>\n *\n * @license http://www.abc.com MIT\n *\n * @link None\n **/\nsession_start();\nrequire_once '../db_connection.php';\nrequire_once '../sand_box.php';\n$link=$LINK;\n\n\nif (isset($_GET['roll_no'])) {\n    $roll_no=$_GET['roll_no'];\n    $roll_no=Validate_input($roll_no);\n\n    if ($_GET['table']=='student') {\n        $q=\"SELECT * from students_info WHERE Roll_No=\".$roll_no;\n        $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n        $total_rows=mysqli_num_rows($qr);\n        if ($total_rows>0) {\n            echo \"Data already exists.\";\n        }\n    }\n\n\n    if ($_GET['table']=='marks') {\n        if ($roll_no==\"\") {\n            echo 'Type Roll No.';\n            $roll_no=1;\n        }\n        $q=\"SELECT * from marks WHERE Roll_No=\".$roll_no;\n        $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n        $total_rows=mysqli_num_rows($qr);\n        if ($total_rows>0) {\n            echo \"Data already exists.Try Editing.\";\n        }\n    }\n}\nif (isset($_GET['admission_no'])) {\n        $admission_no=$_GET['admission_no'];\n        $admission_no=Validate_input($admission_no);\n    $q=\"SELECT admission_no from students_info WHERE admission_no=$admission_no\";\n    $qr=mysqli_query($link, $q) or die('Error'.mysqli_error($link));\n    $total_rows=mysqli_num_rows($qr);\n    if ($total_rows>0) {\n        echo \"Duplicate Admission No\";\n    } else {\n        echo \"Looks Good\";\n    }\n}\n?>\n", "<?php\n/**\n * Add Subject Marks script file consumed by ajax\n * called from add_subject_marks.php file.\n *  * php version 8.1\n *\n * @category Exam\n *\n * @package None\n *\n * @author Waqas <waqaskanju@gmail.com>\n *\n * @license http://www.waqaskanju.com/license MIT\n *\n * @link http://www.waqaskanju.com\n **/\nsession_start();\nrequire_once '../sand_box.php';\n$link=$LINK;\n// not allow to use this file when mode=read in config file.\n$school=$SCHOOL_NAME;\n/* Roll No */\n$roll_no=$_GET['roll_no'];\n$roll_no=Validate_input($roll_no);\n/* Subject  Name Marks Column */\n$subject = $_GET['subject_name'];\n$subject=Validate_input($subject);\n/* Actual Subject  Name */\n$actual_subject=$_GET['actual_subject'];\n$actual_subject=Validate_input($actual_subject);\n/* Subject Marks */\n$marks=$_GET['marks'];\n$marks=Validate_input($marks);\n/* Class Name */\n$class=$_GET['class_name'];\n$class=Validate_input($class);\n$update_Status=Check_Subject_Update_Lock_status($school, $class, $actual_subject);\nif ($marks>100) {\n    echo \"Max Marks error\";\n    exit;\n}\n$q=\"UPDATE marks SET $subject = $marks WHERE Roll_No=$roll_no\";\n// Do this if lock=off, that means lock=0\n// Single Marks changes=allow means 1.\nif ($SINGLE_MARKS_CHANGES==1 && $update_Status==0) {\n    $exe=mysqli_query($link, $q) or die('error'.mysqli_error($link));\n    if ($exe) {\n        echo \"<span class='alert alert-success' role='alert'> Marks Saved.\n                </span>\";\n    } else {\n        echo \"<span class='alert alert-danger' role='alert'>\n            Error in query\n        </span>\";\n    } \n} else {\n    echo \"<span class='alert alert-danger' role='alert'>\n        Marks are finalized.\n        Changes Not allowed. OR No Permission</span>\";\n}\n\n?>\n"], "filenames": ["edit_school.php", "edit_school_class.php", "functions.php", "new_code_test.php", "sand_box.php", "scripts/check_roll_no.php", "scripts/update_subject_marks.php"], "buggy_code_start_loc": [20, 22, 191, 18, 906, 17, 44], "buggy_code_end_loc": [21, 23, 205, 18, 906, 18, 45], "fixing_code_start_loc": [20, 22, 190, 19, 907, 17, 44], "fixing_code_end_loc": [21, 23, 190, 28, 926, 18, 45], "type": "CWE-89", "message": "Chitor-CMS before v1.1.2 was discovered to contain multiple SQL injection vulnerabilities.", "other": {"cve": {"id": "CVE-2023-31714", "sourceIdentifier": "cve@mitre.org", "published": "2023-08-30T22:15:08.013", "lastModified": "2023-09-05T12:29:00.033", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Chitor-CMS before v1.1.2 was discovered to contain multiple SQL injection vulnerabilities."}, {"lang": "es", "value": "Se ha descubierto que Chitor-CMS antes de la versi\u00f3n 1.1.2 contiene m\u00faltiples vulnerabilidades de inyecci\u00f3n SQL. "}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:waqaskanju:chitor-cms:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.1.2", "matchCriteriaId": "7A9BA737-3DCE-4D63-AE63-EEF6C64FE9A7"}]}]}], "references": [{"url": "https://github.com/msd0pe-1/chitor-sqli", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://github.com/waqaskanju/Chitor-CMS/commit/69d34420ad382c91b0c285432418c1b0810128c1", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/waqaskanju/Chitor-CMS/releases/tag/Chitor-cms", "source": "cve@mitre.org", "tags": ["Release Notes"]}, {"url": "https://www.exploit-db.com/exploits/51383", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/waqaskanju/Chitor-CMS/commit/69d34420ad382c91b0c285432418c1b0810128c1"}}