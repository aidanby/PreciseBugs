{"buggy_code": ["<?php\ninclude(\"init.php\");\n\n$user = (object) new user();\n\n$action = getArrayVal($_GET, \"action\");\n$id = getArrayVal($_GET, \"id\");\n$mode = getArrayVal($_GET, \"mode\");\n\nif ($action != \"login\" and $action != \"logout\" and $action != \"resetpassword\" and $action != \"loginerror\") {\n    if (!isset($_SESSION[\"userid\"])) {\n        $template->assign(\"loginerror\", 0);\n        $template->display(\"login.tpl\");\n        die();\n    }\n}\n\n$name = getArrayVal($_POST, \"name\");\n$realname = getArrayVal($_POST, \"realname\");\n$role = getArrayVal($_POST, \"role\");\n$email = getArrayVal($_POST, \"email\");\n$tel1 = getArrayVal($_POST, \"tel1\");\n$tel2 = getArrayVal($_POST, \"tel2\");\n$company = getArrayVal($_POST, \"company\");\n$address1 = getArrayVal($_POST, \"address1\");\n$address2 = getArrayVal($_POST, \"address2\");\n$state = getArrayVal($_POST, \"state\");\n$country = getArrayVal($_POST, \"country\");\n$locale = getArrayVal($_POST, \"locale\");\n$tags = getArrayVal($_POST, \"tags\");\n$oldpass = getArrayVal($_POST, \"oldpass\");\n$newpass = getArrayVal($_POST, \"newpass\");\n$repeatpass = getArrayVal($_POST, \"repeatpass\");\n$admin = getArrayVal($_POST, \"admin\");\n$turl = getArrayVal($_POST, \"web\");\n$gender = getArrayVal($_POST, \"gender\");\n$zip = getArrayVal($_POST, \"zip\");\n$taski = getArrayVal($_GET, \"task\");\n$fproject = getArrayVal($_GET, \"project\");\n\n$template->assign(\"mode\", $mode);\n// get the available languages\n$languages = getAvailableLanguages();\n$template->assign(\"languages\", $languages);\n\n$project = array();\n$project['ID'] = $id;\n$template->assign(\"project\", $project);\n// set css classes for menue buttons\n$classes = array(\"overview\" => \"overview\", \"msgs\" => \"msgs\", \"tasks\" => \"tasks\", \"miles\" => \"miles\", \"files\" => \"files\", \"users\" => \"users_active\", \"tracker\" => \"tracking\");\n\n$mainclasses = array(\"desktop\" => \"\",\n    \"profil\" => \"active\",\n    \"admin\" => \"\"\n    );\n$template->assign(\"mainclasses\", $mainclasses);\n$template->assign(\"classes\", $classes);\n\nif ($action == \"loginerror\") {\n    $template->display(\"resetpassword.tpl\");\n} elseif ($action == \"resetpassword\") {\n    $newpass = $user->resetPassword($email);\n    if ($newpass !== false) {\n        $langFile=readLangfile($newpass['locale']);\n\n        $subject = $langfile[\"projectpasswordsubject\"];\n\n        $mailcontent = $langfile[\"hello\"] . \",<br /><br/>\" .\n                       $langfile[\"projectpasswordtext\"] . \"<br /><br />\" .\n                       $langfile[\"newpass\"] . \": \" . $newpass['newpass'] .\"<br />\" .\n                       $langfile[\"login\"] . \": <a href = \\\"$url\\\">$url</a>\";\n        // Send e-mail with new password\n        $themail = new emailer($settings);\n        $themail->send_mail($email, $subject, $mailcontent);\n\n        $template->assign(\"success\", 1);\n        $template->display(\"resetpassword.tpl\");\n    } else {\n        $template->assign(\"loginerror\", 1);\n        $template->display(\"resetpassword.tpl\");\n    }\n} elseif ($action == \"login\") {\n    $openid = getArrayVal($_POST, \"openid\");\n    $username = getArrayVal($_POST, \"username\");\n    $pass = getArrayVal($_POST, \"pass\");\n    // Normal login\n    if ($user->login($username, $pass)) {\n        $loc = $url . \"index.php?mode=login\";\n        header(\"Location: $loc\");\n    }\n    // Login Error\n    else {\n        $template->assign(\"loginerror\", 1);\n        $template->assign(\"mailnotify\", $settings[\"mailnotify\"]);\n        $template->display(\"login.tpl\");\n    }\n} elseif ($action == \"logout\") {\n    if ($user->logout()) {\n        header(\"Location: index.php?mode=logout\");\n    }\n} elseif ($action == \"addform\") {\n    $title = $langfile['adduser'];\n    $template->assign(\"title\", $title);\n    $template->display(\"adduserform.tpl\");\n} elseif ($action == \"editform\") {\n    $languages_fin = array();\n    foreach($languages as $lang) {\n        $fin = countLanguageStrings($lang);\n\n        if (!($langfile[$lang] == \"\")) {\n            $lang2 = $langfile[$lang];\n        } else {\n            $lang2 = $lang;\n        }\n\n        $lang2 .= \" (\" . $fin . \"%)\";\n        $fin = array(\"val\" => $lang, \"str\" => $lang2);\n\n        array_push($languages_fin, $fin);\n    }\n    $template->assign(\"languages_fin\", $languages_fin);\n\n    $title = $langfile['edituser'];\n\n    $template->assign(\"title\", $title);\n    $euser = $user->getProfile($userid);\n    $template->assign(\"user\", $euser);\n\n    $template->display(\"edituserform.tpl\");\n} elseif ($action == \"edit\") {\n    $_SESSION['userlocale'] = $locale;\n    $_SESSION['username'] = $name;\n\n    if (!empty($_FILES['userfile']['name'])) {\n        $fname = $_FILES['userfile']['name'];\n        $typ = $_FILES['userfile']['type'];\n        $size = $_FILES['userfile']['size'];\n        $tmp_name = $_FILES['userfile']['tmp_name'];\n        $error = $_FILES['userfile']['error'];\n        $root = \"./\";\n\n        $teilnamen = explode(\".\", $fname);\n        $teile = count($teilnamen);\n        $workteile = $teile - 1;\n        $erweiterung = $teilnamen[$workteile];\n\n        $subname = \"\";\n        if ($typ != \"image/jpeg\" and $typ != \"image/png\" and $typ != \"image/gif\" and $typ != \"image/pjpeg\") {\n            $loc = $url . \"manageuser.php?action=profile&id=$userid\";\n            header(\"Location: $loc\");\n            die();\n        }\n        // don't upload php scripts\n        if ($erweiterung == \"php\" or $erweiterung == \"pl\") {\n            $loc = $url . \"manageuser.php?action=profile&id=$userid\";\n            header(\"Location: $loc\");\n            die();\n        }\n\n        for ($i = 0; $i < $workteile; $i++) {\n            $subname .= $teilnamen[$i];\n        }\n        list($usec, $sec) = explode(' ', microtime());\n        $seed = (float) $sec + ((float) $usec * 100000);\n        srand($seed);\n        $randval = rand(1, 999999);\n\n        $subname = preg_replace(\"/[^-_0-9a-zA-Z]/\", \"_\", $subname);\n        $subname = preg_replace(\"/\\W/\", \"\", $subname);\n\n        if (strlen($subname) > 200) {\n            $subname = substr($subname, 0, 200);\n        }\n\n        $fname = $subname . \"_\" . $randval . \".\" . $erweiterung;\n\n        $datei_final = CL_ROOT . \"/files/\" . CL_CONFIG . \"/avatar/\" . $fname;\n\n        if (move_uploaded_file($tmp_name, $datei_final)) {\n            $avatar = $fname;\n        }\n\n        if ($user->edit($userid, $name, $realname, $email, $tel1, $tel2, \"\", $zip, $gender, $turl, $address1, $address2, $state, $country, \"\", $locale, $avatar, 0)) {\n            if (!empty($oldpass) and !empty($newpass) and !empty($repeatpass)) {\n                $user->editpass($userid, $oldpass, $newpass, $repeatpass);\n            }\n            $loc = $url . \"manageuser.php?action=profile&id=$userid&mode=edited\";\n            header(\"Location: $loc\");\n        }\n    } else {\n        if ($user->edit($userid, $name, $realname, $email, $tel1, $tel2, $company, $zip, $gender, $turl, $address1, $address2, $state, $country, \"\", $locale, \"\", 0)) {\n            if (isset($oldpass) and isset($newpass) and isset($repeatpass)) {\n                $user->editpass($userid, $oldpass, $newpass, $repeatpass);\n            }\n            $loc = $url . \"manageuser.php?action=profile&id=$userid&mode=edited\";\n            header(\"Location: $loc\");\n        }\n    }\n} elseif ($action == \"del\") {\n    if (!$userpermissions[\"admin\"][\"add\"]) {\n        $errtxt = $langfile[\"nopermission\"];\n        $noperm = $langfile[\"accessdenied\"];\n        $template->assign(\"errortext\", \"$errtxt<br>$noperm\");\n        $template->assign(\"mode\", \"error\");\n        $template->display(\"error.tpl\");\n        die();\n    }\n    if ($user->del($id)) {\n        $loc = $url . \"admin.php?action=users&mode=deleted\";\n        header(\"Location: $loc\");\n    }\n} elseif ($action == \"profile\") {\n    $start = getArrayVal($_GET, \"start\");\n    $end = getArrayVal($_GET, \"end\");\n    $proj = (object) new project();\n    if ($userpermissions[\"admin\"][\"add\"]) {\n        $projects = $proj->getMyProjects($id);\n        $i = 0;\n        if (!empty($projects)) {\n            foreach($projects as $opro) {\n                $membs = $proj->getProjectMembers($opro[\"ID\"], 1000);\n                $projects[$i]['members'] = $membs;\n                $i = $i + 1;\n            }\n            $template->assign(\"opros\", $projects);\n        }\n    }\n    $tracker = (object) new timetracker();\n\n    $track = array();\n    if (!empty($start) and !empty($end)) {\n        $track = $tracker->getUserTrack($id, $fproject, $taski, $start, $end);\n    } elseif (is_array($fproject)) {\n        foreach ($fproject as $fpro) {\n            $ptrack = $tracker->getUserTrack($id, $fpro, $taski, $start, $end);\n            if (!empty($ptrack)) {\n                foreach ($ptrack as $mytrack) {\n                    array_push($track, $mytrack);\n                }\n            }\n        }\n    } else {\n        $track = $tracker->getUserTrack($id, $fproject, $taski);\n    }\n    if (!empty($track)) {\n        $totaltime = $tracker->getTotalTrackTime($track);\n        $template->assign(\"totaltime\", $totaltime);\n        $template->assign(\"fproject\", $fproject);\n        $template->assign(\"start\", $start);\n        $template->assign(\"end\", $end);\n    }\n    $template->assign(\"tracker\", $track);\n    SmartyPaginate::assign($template);\n    $profile = $user->getProfile($id);\n\n    $title = $langfile['userprofile'];\n    $template->assign(\"title\", $title);\n    $template->assign(\"user\", $profile);\n\n    $template->display(\"userprofile.tpl\");\n} elseif ($action == \"showproject\") {\n    if (!chkproject($userid, $id)) {\n        $errtxt = $langfile[\"notyourproject\"];\n        $noperm = $langfile[\"accessdenied\"];\n        $template->assign(\"mode\", \"error\");\n        $template->assign(\"errortext\", \"$errtxt<br>$noperm\");\n        $template->display(\"error.tpl\");\n        die();\n    }\n    $mainclasses = array(\"desktop\" => \"desktop\",\n        \"profil\" => \"profil\",\n        \"admin\" => \"admin\"\n        );\n    $template->assign(\"mainclasses\", $mainclasses);\n    $proj = (object) new project();\n    $alluser = $user->getAllUsers(10000);\n    $users = array();\n\n    foreach($alluser as $all) {\n        if (!chkproject($all['ID'], $id)) {\n            array_push($users, $all);\n        }\n    }\n    SmartyPaginate::disconnect();\n\n    $members = $proj->getProjectMembers($id, 14);\n    $pro = $proj->getProject($id);\n\n    $projectname = $pro['name'];\n    $title = $langfile['members'];\n\n    $template->assign(\"title\", $title);\n    $template->assign(\"projectname\", $projectname);\n    SmartyPaginate::assign($template);\n    $template->assign(\"members\", $members);\n    $template->assign(\"users\", $users);\n    $template->display(\"projectmembers.tpl\");\n} elseif ($action == \"onlinelist\") {\n    $onlinelist = $user->getOnlinelist();\n    if (!empty($onlinelist)) {\n        echo \"<ul>\";\n        foreach($onlinelist as $online) {\n\n            echo \"<li>\" . \"<a class=\\\"user\\\" href = \\\"manageuser.php?action=profile&id=$online[ID]\\\">$online[name]</a></li>\";\n        }\n        echo \"</ul>\";\n    }\n} elseif ($action == \"vcard\") {\n    $theuser = $user->getProfile($id);\n\n    $vCard = (object) new vCard($theuser[\"locale\"]);\n\n    $vCard->setFirstName($theuser[\"name\"]);\n    $vCard->setCompany($theuser[\"company\"]);\n    $vCard->setOrganisation($theuser[\"company\"]);\n    $vCard->setPostalStreet($theuser[\"adress\"]);\n    $vCard->setPostalZIP($theuser[\"zip\"]);\n    $vCard->setWorkZIP($theuser[\"zip\"]);\n    $vCard->setHomeZIP($theuser[\"zip\"]);\n    $vCard->setPostalCity($theuser[\"adress2\"]);\n    $vCard->setHomeCity($theuser[\"adress2\"]);\n    $vCard->setPostalRegion($theuser[\"state\"]);\n    $vCard->setPostalCountry($theuser[\"country\"]);\n    $vCard->setWorkStreet($theuser[\"adress\"]);\n    $vCard->setWorkCity($theuser[\"adress2\"]);\n    $vCard->setWorkRegion($theuser[\"state\"]);\n    $vCard->setWorkCountry($theuser[\"country\"]);\n    $vCard->setUrlWork($theuser[\"url\"]);\n    $vCard->setEMail($theuser[\"email\"]);\n\n    header('Content-Type: text/x-vcard');\n    header('Content-Disposition: inline; filename=' . $theuser[\"name\"] . '_' . date(\"d-m-Y\") . '.vcf');\n\n    echo $vCard->getCardOutput();\n}\n\n?>\n"], "fixing_code": ["<?php\ninclude(\"init.php\");\n\n$user = (object) new user();\n\n$action = getArrayVal($_GET, \"action\");\n$id = getArrayVal($_GET, \"id\");\n$mode = getArrayVal($_GET, \"mode\");\n\nif ($action != \"login\" and $action != \"logout\" and $action != \"resetpassword\" and $action != \"loginerror\") {\n    if (!isset($_SESSION[\"userid\"])) {\n        $template->assign(\"loginerror\", 0);\n        $template->display(\"login.tpl\");\n        die();\n    }\n}\n\n$name = getArrayVal($_POST, \"name\");\n$realname = getArrayVal($_POST, \"realname\");\n$role = getArrayVal($_POST, \"role\");\n$email = getArrayVal($_POST, \"email\");\n$tel1 = getArrayVal($_POST, \"tel1\");\n$tel2 = getArrayVal($_POST, \"tel2\");\n$company = getArrayVal($_POST, \"company\");\n$address1 = getArrayVal($_POST, \"address1\");\n$address2 = getArrayVal($_POST, \"address2\");\n$state = getArrayVal($_POST, \"state\");\n$country = getArrayVal($_POST, \"country\");\n$locale = getArrayVal($_POST, \"locale\");\n$tags = getArrayVal($_POST, \"tags\");\n$oldpass = getArrayVal($_POST, \"oldpass\");\n$newpass = getArrayVal($_POST, \"newpass\");\n$repeatpass = getArrayVal($_POST, \"repeatpass\");\n$admin = getArrayVal($_POST, \"admin\");\n$turl = getArrayVal($_POST, \"web\");\n$gender = getArrayVal($_POST, \"gender\");\n$zip = getArrayVal($_POST, \"zip\");\n$taski = getArrayVal($_GET, \"task\");\n$fproject = getArrayVal($_GET, \"project\");\n\n$template->assign(\"mode\", $mode);\n// get the available languages\n$languages = getAvailableLanguages();\n$template->assign(\"languages\", $languages);\n\n$project = array();\n$project['ID'] = $id;\n$template->assign(\"project\", $project);\n// set css classes for menue buttons\n$classes = array(\"overview\" => \"overview\", \"msgs\" => \"msgs\", \"tasks\" => \"tasks\", \"miles\" => \"miles\", \"files\" => \"files\", \"users\" => \"users_active\", \"tracker\" => \"tracking\");\n\n$mainclasses = array(\"desktop\" => \"\",\n    \"profil\" => \"active\",\n    \"admin\" => \"\"\n    );\n$template->assign(\"mainclasses\", $mainclasses);\n$template->assign(\"classes\", $classes);\n\nif ($action == \"loginerror\") {\n    $template->display(\"resetpassword.tpl\");\n} elseif ($action == \"resetpassword\") {\n    $newpass = $user->resetPassword($email);\n    if ($newpass !== false) {\n        $langFile=readLangfile($newpass['locale']);\n\n        $subject = $langfile[\"projectpasswordsubject\"];\n\n        $mailcontent = $langfile[\"hello\"] . \",<br /><br/>\" .\n                       $langfile[\"projectpasswordtext\"] . \"<br /><br />\" .\n                       $langfile[\"newpass\"] . \": \" . $newpass['newpass'] .\"<br />\" .\n                       $langfile[\"login\"] . \": <a href = \\\"$url\\\">$url</a>\";\n        // Send e-mail with new password\n        $themail = new emailer($settings);\n        $themail->send_mail($email, $subject, $mailcontent);\n\n        $template->assign(\"success\", 1);\n        $template->display(\"resetpassword.tpl\");\n    } else {\n        $template->assign(\"loginerror\", 1);\n        $template->display(\"resetpassword.tpl\");\n    }\n} elseif ($action == \"login\") {\n    $openid = getArrayVal($_POST, \"openid\");\n    $username = getArrayVal($_POST, \"username\");\n    $pass = getArrayVal($_POST, \"pass\");\n    // Normal login\n    if ($user->login($username, $pass)) {\n        $loc = $url . \"index.php?mode=login\";\n        header(\"Location: $loc\");\n    }\n    // Login Error\n    else {\n        $template->assign(\"loginerror\", 1);\n        $template->assign(\"mailnotify\", $settings[\"mailnotify\"]);\n        $template->display(\"login.tpl\");\n    }\n} elseif ($action == \"logout\") {\n    if ($user->logout()) {\n        header(\"Location: index.php?mode=logout\");\n    }\n} elseif ($action == \"addform\") {\n    $title = $langfile['adduser'];\n    $template->assign(\"title\", $title);\n    $template->display(\"adduserform.tpl\");\n} elseif ($action == \"editform\") {\n    $languages_fin = array();\n    foreach($languages as $lang) {\n        $fin = countLanguageStrings($lang);\n\n        if (!($langfile[$lang] == \"\")) {\n            $lang2 = $langfile[$lang];\n        } else {\n            $lang2 = $lang;\n        }\n\n        $lang2 .= \" (\" . $fin . \"%)\";\n        $fin = array(\"val\" => $lang, \"str\" => $lang2);\n\n        array_push($languages_fin, $fin);\n    }\n    $template->assign(\"languages_fin\", $languages_fin);\n\n    $title = $langfile['edituser'];\n\n    $template->assign(\"title\", $title);\n    $euser = $user->getProfile($userid);\n    $template->assign(\"user\", $euser);\n\n    $template->display(\"edituserform.tpl\");\n} elseif ($action == \"edit\") {\n    $_SESSION['userlocale'] = $locale;\n    $_SESSION['username'] = $name;\n\n    if (!empty($_FILES['userfile']['name'])) {\n        $fname = $_FILES['userfile']['name'];\n        $typ = $_FILES['userfile']['type'];\n        $size = $_FILES['userfile']['size'];\n        $tmp_name = $_FILES['userfile']['tmp_name'];\n        $error = $_FILES['userfile']['error'];\n        $root = \"./\";\n\n        $teilnamen = explode(\".\", $fname);\n        $teile = count($teilnamen);\n        $workteile = $teile - 1;\n        $erweiterung = $teilnamen[$workteile];\n\n        $subname = \"\";\n        if ($typ != \"image/jpeg\" and $typ != \"image/png\" and $typ != \"image/gif\" and $typ != \"image/pjpeg\") {\n            $loc = $url . \"manageuser.php?action=profile&id=$userid\";\n            header(\"Location: $loc\");\n            die();\n        }\n        // don't upload php scripts\n        if (stristr($erweiterung,\"php\") or $erweiterung == \"pl\") {\n            $loc = $url . \"manageuser.php?action=profile&id=$userid\";\n            header(\"Location: $loc\");\n            die();\n        }\n\n        for ($i = 0; $i < $workteile; $i++) {\n            $subname .= $teilnamen[$i];\n        }\n        list($usec, $sec) = explode(' ', microtime());\n        $seed = (float) $sec + ((float) $usec * 100000);\n        srand($seed);\n        $randval = rand(1, 999999);\n\n        $subname = preg_replace(\"/[^-_0-9a-zA-Z]/\", \"_\", $subname);\n        $subname = preg_replace(\"/\\W/\", \"\", $subname);\n\n        if (strlen($subname) > 200) {\n            $subname = substr($subname, 0, 200);\n        }\n\n        $fname = $subname . \"_\" . $randval . \".\" . $erweiterung;\n\n        $datei_final = CL_ROOT . \"/files/\" . CL_CONFIG . \"/avatar/\" . $fname;\n\n        if (move_uploaded_file($tmp_name, $datei_final)) {\n            $avatar = $fname;\n        }\n\n        if ($user->edit($userid, $name, $realname, $email, $tel1, $tel2, \"\", $zip, $gender, $turl, $address1, $address2, $state, $country, \"\", $locale, $avatar, 0)) {\n            if (!empty($oldpass) and !empty($newpass) and !empty($repeatpass)) {\n                $user->editpass($userid, $oldpass, $newpass, $repeatpass);\n            }\n            $loc = $url . \"manageuser.php?action=profile&id=$userid&mode=edited\";\n            header(\"Location: $loc\");\n        }\n    } else {\n        if ($user->edit($userid, $name, $realname, $email, $tel1, $tel2, $company, $zip, $gender, $turl, $address1, $address2, $state, $country, \"\", $locale, \"\", 0)) {\n            if (isset($oldpass) and isset($newpass) and isset($repeatpass)) {\n                $user->editpass($userid, $oldpass, $newpass, $repeatpass);\n            }\n            $loc = $url . \"manageuser.php?action=profile&id=$userid&mode=edited\";\n            header(\"Location: $loc\");\n        }\n    }\n} elseif ($action == \"del\") {\n    if (!$userpermissions[\"admin\"][\"add\"]) {\n        $errtxt = $langfile[\"nopermission\"];\n        $noperm = $langfile[\"accessdenied\"];\n        $template->assign(\"errortext\", \"$errtxt<br>$noperm\");\n        $template->assign(\"mode\", \"error\");\n        $template->display(\"error.tpl\");\n        die();\n    }\n    if ($user->del($id)) {\n        $loc = $url . \"admin.php?action=users&mode=deleted\";\n        header(\"Location: $loc\");\n    }\n} elseif ($action == \"profile\") {\n    $start = getArrayVal($_GET, \"start\");\n    $end = getArrayVal($_GET, \"end\");\n    $proj = (object) new project();\n    if ($userpermissions[\"admin\"][\"add\"]) {\n        $projects = $proj->getMyProjects($id);\n        $i = 0;\n        if (!empty($projects)) {\n            foreach($projects as $opro) {\n                $membs = $proj->getProjectMembers($opro[\"ID\"], 1000);\n                $projects[$i]['members'] = $membs;\n                $i = $i + 1;\n            }\n            $template->assign(\"opros\", $projects);\n        }\n    }\n    $tracker = (object) new timetracker();\n\n    $track = array();\n    if (!empty($start) and !empty($end)) {\n        $track = $tracker->getUserTrack($id, $fproject, $taski, $start, $end);\n    } elseif (is_array($fproject)) {\n        foreach ($fproject as $fpro) {\n            $ptrack = $tracker->getUserTrack($id, $fpro, $taski, $start, $end);\n            if (!empty($ptrack)) {\n                foreach ($ptrack as $mytrack) {\n                    array_push($track, $mytrack);\n                }\n            }\n        }\n    } else {\n        $track = $tracker->getUserTrack($id, $fproject, $taski);\n    }\n    if (!empty($track)) {\n        $totaltime = $tracker->getTotalTrackTime($track);\n        $template->assign(\"totaltime\", $totaltime);\n        $template->assign(\"fproject\", $fproject);\n        $template->assign(\"start\", $start);\n        $template->assign(\"end\", $end);\n    }\n    $template->assign(\"tracker\", $track);\n    SmartyPaginate::assign($template);\n    $profile = $user->getProfile($id);\n\n    $title = $langfile['userprofile'];\n    $template->assign(\"title\", $title);\n    $template->assign(\"user\", $profile);\n\n    $template->display(\"userprofile.tpl\");\n} elseif ($action == \"showproject\") {\n    if (!chkproject($userid, $id)) {\n        $errtxt = $langfile[\"notyourproject\"];\n        $noperm = $langfile[\"accessdenied\"];\n        $template->assign(\"mode\", \"error\");\n        $template->assign(\"errortext\", \"$errtxt<br>$noperm\");\n        $template->display(\"error.tpl\");\n        die();\n    }\n    $mainclasses = array(\"desktop\" => \"desktop\",\n        \"profil\" => \"profil\",\n        \"admin\" => \"admin\"\n        );\n    $template->assign(\"mainclasses\", $mainclasses);\n    $proj = (object) new project();\n    $alluser = $user->getAllUsers(10000);\n    $users = array();\n\n    foreach($alluser as $all) {\n        if (!chkproject($all['ID'], $id)) {\n            array_push($users, $all);\n        }\n    }\n    SmartyPaginate::disconnect();\n\n    $members = $proj->getProjectMembers($id, 14);\n    $pro = $proj->getProject($id);\n\n    $projectname = $pro['name'];\n    $title = $langfile['members'];\n\n    $template->assign(\"title\", $title);\n    $template->assign(\"projectname\", $projectname);\n    SmartyPaginate::assign($template);\n    $template->assign(\"members\", $members);\n    $template->assign(\"users\", $users);\n    $template->display(\"projectmembers.tpl\");\n} elseif ($action == \"onlinelist\") {\n    $onlinelist = $user->getOnlinelist();\n    if (!empty($onlinelist)) {\n        echo \"<ul>\";\n        foreach($onlinelist as $online) {\n\n            echo \"<li>\" . \"<a class=\\\"user\\\" href = \\\"manageuser.php?action=profile&id=$online[ID]\\\">$online[name]</a></li>\";\n        }\n        echo \"</ul>\";\n    }\n} elseif ($action == \"vcard\") {\n    $theuser = $user->getProfile($id);\n\n    $vCard = (object) new vCard($theuser[\"locale\"]);\n\n    $vCard->setFirstName($theuser[\"name\"]);\n    $vCard->setCompany($theuser[\"company\"]);\n    $vCard->setOrganisation($theuser[\"company\"]);\n    $vCard->setPostalStreet($theuser[\"adress\"]);\n    $vCard->setPostalZIP($theuser[\"zip\"]);\n    $vCard->setWorkZIP($theuser[\"zip\"]);\n    $vCard->setHomeZIP($theuser[\"zip\"]);\n    $vCard->setPostalCity($theuser[\"adress2\"]);\n    $vCard->setHomeCity($theuser[\"adress2\"]);\n    $vCard->setPostalRegion($theuser[\"state\"]);\n    $vCard->setPostalCountry($theuser[\"country\"]);\n    $vCard->setWorkStreet($theuser[\"adress\"]);\n    $vCard->setWorkCity($theuser[\"adress2\"]);\n    $vCard->setWorkRegion($theuser[\"state\"]);\n    $vCard->setWorkCountry($theuser[\"country\"]);\n    $vCard->setUrlWork($theuser[\"url\"]);\n    $vCard->setEMail($theuser[\"email\"]);\n\n    header('Content-Type: text/x-vcard');\n    header('Content-Disposition: inline; filename=' . $theuser[\"name\"] . '_' . date(\"d-m-Y\") . '.vcf');\n\n    echo $vCard->getCardOutput();\n}\n\n?>\n"], "filenames": ["manageuser.php"], "buggy_code_start_loc": [154], "buggy_code_end_loc": [155], "fixing_code_start_loc": [154], "fixing_code_end_loc": [155], "type": "CWE-434", "message": "Multiple incomplete blacklist vulnerabilities in the avatar upload functionality in manageuser.php in Collabtive before 2.1 allow remote authenticated users to execute arbitrary code by uploading a file with a (1) .php3, (2) .php4, (3) .php5, or (4) .phtml extension.", "other": {"cve": {"id": "CVE-2015-0258", "sourceIdentifier": "secalert@redhat.com", "published": "2020-02-17T18:15:11.607", "lastModified": "2022-01-01T19:54:41.480", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Multiple incomplete blacklist vulnerabilities in the avatar upload functionality in manageuser.php in Collabtive before 2.1 allow remote authenticated users to execute arbitrary code by uploading a file with a (1) .php3, (2) .php4, (3) .php5, or (4) .phtml extension."}, {"lang": "es", "value": "M\u00faltiples vulnerabilidades de lista negra incompletas en la funcionalidad de carga de avatar en el archivo manageuser.php en Collabtive versiones anteriores a 2.1, permiten a los usuarios autenticados remotos ejecutar c\u00f3digo arbitrario mediante la carga de un archivo con una extensi\u00f3n (1) .php3, (2) .php4, (3) .php5 o (4) .phtml."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-434"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:o-dyn:collabtive:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.1", "matchCriteriaId": "759F012D-91F9-488D-B671-D0193E9D70E0"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:8.0:*:*:*:*:*:*:*", "matchCriteriaId": "C11E6FB0-C8C0-4527-9AA0-CB9B316F8F43"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:canonical:ubuntu_linux:16.04:*:*:*:esm:*:*:*", "matchCriteriaId": "7A5301BF-1402-4BE0-A0F8-69FBE79BC6D6"}]}]}], "references": [{"url": "http://packetstormsecurity.com/files/133736/Collabtive-2.0-Shell-Upload.html", "source": "secalert@redhat.com", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/philippK-de/Collabtive/commit/9ce6301583669d0a8ecb4d23fb56e34b68511335", "source": "secalert@redhat.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2020/02/msg00031.html", "source": "secalert@redhat.com", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://usn.ubuntu.com/4590-1/", "source": "secalert@redhat.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/philippK-de/Collabtive/commit/9ce6301583669d0a8ecb4d23fb56e34b68511335"}}