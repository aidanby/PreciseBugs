{"buggy_code": ["<div class=\"index\">\n    <h2><?php echo h($title); ?></h2>\n    <?php $scope = !empty($proposals) ? 'proposals' : 'attributes'; ?>\n    <p><?php echo __('Below you can see the %s that are to be created. Make sure that the categories and the types are correct, often several options will be offered based on an inconclusive automatic resolution.', $scope);?></p>\n    <?php\n        if (!empty($missingTldLists)) {\n            $missingTldLists = implode(', ', $missingTldLists);\n            $missingTldLists = __('Warning: You are missing warninglist(s) that are used to recognise TLDs. Make sure your MISP has the warninglist submodule enabled and updated or else this tool might end up missing valid domains/hostnames/urls. The missing lists are: %s', $missingTldLists);\n            echo sprintf('<p class=\"bold red\">%s</p>', $missingTldLists);\n        }\n    ?>\n    <p></p>\n    <?php\n        $instanceDefault = 5;\n        if (!empty(Configure::read('MISP.default_attribute_distribution'))) {\n            if (Configure::read('MISP.default_attribute_distribution') == 'event') {\n                $instanceDefault = 5;\n            } else {\n                $instanceDefault = Configure::read('MISP.default_attribute_distribution');\n            }\n        }\n        echo $this->Form->create('Attribute', array('url' => '/events/saveFreeText/' . $event['Event']['id'], 'class' => 'mainForm'));\n        if ($isSiteAdmin) {\n            echo $this->Form->input('force', array(\n                    'checked' => false,\n                    'label' => __('Proposals instead of attributes'),\n            ));\n        }\n        echo $this->Form->input('JsonObject', array(\n                'label' => false,\n                'type' => 'text',\n                'style' => 'display:none;',\n                'value' => '',\n        ));\n        echo $this->Form->input('default_comment', array(\n                'label' => false,\n                'type' => 'text',\n                'style' => 'display:none;',\n                'value' => $importComment,\n        ));\n        echo $this->Form->end();\n    ?>\n    <table class=\"table table-striped table-hover table-condensed\">\n        <tr>\n                <th><?php echo __('Value');?></th>\n                <th><?php echo __('Similar Attributes');?></th>\n                <th><?php echo __('Category');?></th>\n                <th><?php echo __('Type');?></th>\n                <th><?php echo __('IDS');?><input type=\"checkbox\" id=\"checkAllIDS\" style=\"margin-top:23px;margin-left:3px;\"/></th>\n                <th style=\"text-align:center;\"><?php echo __('Disable Correlation');?><input type=\"checkbox\" id=\"checkAllDC\" style=\"margin:0px;\"/></th>\n                <th><?php echo __('Distribution');?></th>\n                <th><?php echo __('Comment');?></th>\n                <th><?php echo __('Tags');?></th>\n                <th><?php echo __('Actions');?></th>\n        </tr>\n        <?php\n            $options = array();\n            foreach ($resultArray as $k => $item):\n        ?>\n        <tr id=\"row_<?php echo $k; ?>\" class=\"freetext_row\">\n            <?php\n                echo $this->Form->input('Attribute' . $k . 'Save', array(\n                        'label' => false,\n                        'style' => 'display:none;',\n                        'value' => 1,\n                ));\n                echo $this->Form->input('Attribute' . $k . 'Data', array(\n                        'label' => false,\n                        'type' => 'hidden',\n                        'value' => isset($item['data']) ? $item['data'] : false,\n                ));\n                echo $this->Form->input('Attribute' . $k . 'DataIsHandled', array(\n                        'label' => false,\n                        'type' => 'hidden',\n                        'value' => isset($item['data_is_handled']) ? h($item['data_is_handled']) : false,\n                ));\n            ?>\n            <td>\n                <?php\n                    echo $this->Form->input('Attribute' . $k . 'Value', array(\n                            'label' => false,\n                            'value' => $item['value'],\n                            'style' => 'padding:0px;height:20px;margin-bottom:0px;width:90%;min-width:400px;',\n                            'div' => false\n                    ));\n                ?>\n                <input type=\"hidden\" id=\"<?php echo 'Attribute' . $k . 'Save'; ?>\" value=1 >\n            </td>\n            <td class=\"shortish\">\n                <?php\n                    foreach ($item['related'] as $relation):\n                        $popover = array(\n                            'Event ID' => $relation['Event']['id'],\n                            'Event Info' => $relation['Event']['info'],\n                            'Category' => $relation['Attribute']['category'],\n                            'Type' => $relation['Attribute']['type'],\n                            'Value' => $relation['Attribute']['value'],\n                            'Comment' => $relation['Attribute']['comment'],\n                        );\n                        $popoverHTML = '';\n                        foreach ($popover as $key => $popoverElement) {\n                            $popoverHTML .= '<span class=\\'bold\\'>' . $key . '</span>: <span class=\\'blue bold\\'>' . $popoverElement . '</span><br />';\n                        }\n                ?>\n                        <a href=\"<?php echo $baseurl; ?>/events/view/<?php echo h($relation['Event']['id']);?>\" data-toggle=\"popover\" title=\"Attribute details\" data-content=\"<?php echo h($popoverHTML); ?>\" data-trigger=\"hover\"><?php echo h($relation['Event']['id']);?></a>\n                <?php\n                    endforeach;\n                    $correlationPopover = array('<span>', );\n                ?>\n            </td>\n            <td class=\"short\">\n                <?php\n                    if (!isset($item['categories'])) {\n                        if (isset($defaultCategories[$item['default_type']])) {\n                            $default = array_search($defaultCategories[$item['default_type']], $typeCategoryMapping[$item['default_type']]);\n                        } else {\n                            reset($typeCategoryMapping[$item['default_type']]);\n                            $default = key($typeCategoryMapping[$item['default_type']]);\n                        }\n                    } else {\n                        if (isset($item['category_default'])) $default = $item['category_default'];\n                        else $default = array_search($item['categories'][0], $typeCategoryMapping[$item['default_type']]);\n\n                    }\n                ?>\n                <select id=\"<?php echo 'Attribute' . $k . 'Category'; ?>\" style='padding:0px;height:20px;margin-bottom:0px;' class=\"categoryToggle\">\n                    <?php\n                        foreach ($typeCategoryMapping[$item['default_type']] as $category) {\n                            if (isset($item['categories']) && !in_array($category, $item['categories'])) {\n                                continue;\n                            }\n                            echo '<option value=\"' . $category . '\" ';\n                            if ($category == $default) echo 'selected=\"selected\"';\n                            echo '>' . $category . '</option>';\n                        }\n                    ?>\n                </select>\n            </td>\n            <td class=\"short\">\n                <?php\n                    $divVisibility = '';\n                    $selectVisibility = '';\n                    if (count($item['types']) == 1) {\n                        $selectVisibility = 'display:none;';\n                    } else {\n                        $divVisibility = 'style=\"display:none;\"';\n                        if (!in_array(array_keys($item['types']), $options)) $options[] = array_values($item['types']);\n                    }\n                ?>\n                <div id = \"<?php echo 'Attribute' . $k . 'TypeStatic'; ?>\" <?php echo $divVisibility; ?> ><?php echo h($item['default_type']); ?></div>\n                <select id = \"<?php echo 'Attribute' . $k . 'Type'; ?>\" class='typeToggle' style='padding:0px;height:20px;margin-bottom:0px;<?php echo $selectVisibility; ?>'>\n                    <?php\n                        if (!empty($item['types'])) {\n                            foreach ($item['types'] as $type) {\n                                echo '<option value=\"' . h($type) . '\" ';\n                                echo ($type == $item['default_type'] ? 'selected=\"selected\"' : '') . '>' . h($type) . '</option>';\n                            }\n                        }\n                    ?>\n                </select>\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <input type=\"checkbox\" id=\"<?php echo 'Attribute' . $k . 'To_ids'; ?>\" <?php if ($item['to_ids']) echo 'checked'; ?> class=\"idsCheckbox\" />\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <input type=\"checkbox\" id=\"<?php echo 'Attribute' . $k . 'Disable_correlation'; ?>\" <?php if (isset($item['disable_correlation']) && $item['disable_correlation']) echo 'checked'; ?> class=\"dcCheckbox\" />\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <select id = \"<?php echo 'Attribute' . $k . 'Distribution'; ?>\" class='distributionToggle' style='padding:0px;height:20px;margin-bottom:0px;'>\n                    <?php\n                        foreach ($distributions as $distKey => $distValue) {\n                            $default = isset($item['distribution']) ? $item['distribution'] : $instanceDefault;\n                            echo '<option value=\"' . $distKey . '\" ';\n                            echo ($distKey == $default ? 'selected=\"selected\"' : '') . '>' . $distValue . '</option>';\n                        }\n                    ?>\n                </select>\n                <div style=\"display:none;\">\n                    <select id = \"<?php echo 'Attribute' . $k . 'SharingGroupId'; ?>\" class='sgToggle' style='padding:0px;height:20px;margin-top:3px;margin-bottom:0px;'>\n                        <?php\n                            foreach ($sgs as $sgKey => $sgValue) {\n                                echo '<option value=\"' . h($sgKey) . '\">' . h($sgValue) . '</option>';\n                            }\n                        ?>\n                    </select>\n                </div>\n            </td>\n            <td class=\"short\">\n                <input type=\"text\" class=\"freetextCommentField\" id=\"<?php echo 'Attribute' . $k . 'Comment'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\" placeholder=\"<?php echo h($importComment); ?>\" <?php if (isset($item['comment']) && $item['comment'] !== false) echo 'value=\"' . h($item['comment']) . '\"'?>/>\n            </td>\n            <td class=\"short\">\n                <input type=\"text\" class=\"freetextTagField\" id=\"<?php echo 'Attribute' . $k . 'Tags'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\"<?php if (isset($item['tags']) && $item['tags'] !== false) echo 'value=\"' . h(implode(\",\",$item['tags'])) . '\"'?>/>\n            </td>\n            <td class=\"action short\">\n                <span class=\"icon-remove pointer\" title=\"<?php echo __('Remove resolved attribute');?>\" role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Remove resolved attribute');?>\" onClick=\"freetextRemoveRow('<?php echo $k; ?>', '<?php echo $event['Event']['id']; ?>');\"></span>\n            </td>\n        </tr>\n    <?php\n        endforeach;\n        $optionsRearranged = array();\n        foreach ($options as $group) {\n            foreach ($group as $k => $element) {\n                $temp = $group;\n                unset($temp[$k]);\n                if (!isset($optionsRearranged[$element])) $optionsRearranged[$element] = array();\n                $optionsRearranged[$element] = array_merge($optionsRearranged[$element], $temp);\n            }\n        }\n    ?>\n    </table>\n    <span>\n        <button class=\"btn btn-primary\" style=\"float:left;\" onClick=\"freetextImportResultsSubmit('<?php echo h($event['Event']['id']); ?>', '<?php echo count($resultArray); ?>');\"><?php echo __('Submit %s', $scope);?></button>\n        <span style=\"float:right\">\n            <?php\n                if (!empty($optionsRearranged)):\n            ?>\n                <select id=\"changeFrom\" style=\"margin-left:50px;margin-top:10px;\">\n                    <?php\n                        foreach (array_keys($optionsRearranged) as $fromElement):\n                    ?>\n                            <option><?php echo h($fromElement); ?></option>\n                    <?php\n                        endforeach;\n                    ?>\n                </select>\n                <span class=\"icon-arrow-right\"></span>\n                <select id=\"changeTo\" style=\"margin-top:10px;\">\n                    <?php\n                        $keys = array_keys($optionsRearranged);\n                        foreach ($optionsRearranged[$keys[0]] as $toElement):\n                    ?>\n                            <option value=\"<?php echo $toElement; ?>\"><?php echo $toElement; ?></option>\n                    <?php\n                        endforeach;\n                    ?>\n                </select>\n                <span role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Apply changes to all applicable resolved attributes');?>\" title=\"<?php echo __('Apply changes to all applicable resolved attributes');?>\" class=\"btn btn-inverse\" onClick=\"changeFreetextImportExecute();\"><?php echo __('Change all');?></span><br />\n            <?php endif; ?>\n            <input type=\"text\" id=\"changeComments\" style=\"margin-left:50px;margin-top:10px;width:446px;\" placeholder=\"<?php echo __('Update all comment fields');?>\">\n            <span role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Change all');?>\" title=\"<?php echo __('Change all');?>\" class=\"btn btn-inverse\" onClick=\"changeFreetextImportCommentExecute();\"><?php echo __('Change all');?></span>\n        </span>\n    </span>\n</div>\n    <script>\n        var options = <?php echo json_encode($optionsRearranged);?>;\n        var typeCategoryMapping = <?php echo json_encode($typeCategoryMapping); ?>;\n        $(document).ready(function() {\n            popoverStartup();\n            $('.typeToggle').on('change', function() {\n                var currentId = $(this).attr('id');\n                var selected = $(this).val();\n                currentId = currentId.replace('Type', 'Category');\n                var currentOptions = typeCategoryMapping[selected];\n                /*\n                // Coming soon - restrict further if a list of categories is passed by the modules / freetext import tool\n                if ($('#' + currentId)).data('category-restrictions') {\n                    var category_restrictions = $('#' + currentId)).data('category-restrictions');\n                    currentOptions.forEach(function(category) {\n                        var found = False;\n                        category_restrictions.forEach(function(restricted_category) {\n\n                        });\n                    });\n                    currentOptions.forEach() {\n\n                    }\n                }\n                */\n                $('#' + currentId).empty();\n                for (var category in currentOptions) {\n                    $('#' + currentId).append($(\"<option></option>\").attr(\"value\", category).text(category));\n                }\n            });\n        <?php\n            if (!empty($optionsRearranged)):\n        ?>\n                $('#changeFrom').change(function(){\n                    changeFreetextImportFrom();\n                });\n                $('#changeFrom').trigger('change');\n        <?php\n            endif;\n        ?>\n            $('#checkAllIDS').change(function() {\n                $('.idsCheckbox').prop('checked', $('#checkAllIDS').is(':checked'));\n            });\n            $('#checkAllDC').change(function() {\n                $('.dcCheckbox').prop('checked', $('#checkAllDC').is(':checked'));\n            });\n            $('.distributionToggle').change(function() {\n                if ($(this).val() == 4) {\n                    $(this).next().show();\n                } else {\n                    $(this).next().hide();\n                }\n            });\n        });\n    </script>\n<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'event', 'menuItem' => 'freetextResults'));\n?>\n"], "fixing_code": ["<div class=\"index\">\n    <h2><?php echo h($title); ?></h2>\n    <?php $scope = !empty($proposals) ? 'proposals' : 'attributes'; ?>\n    <p><?php echo __('Below you can see the %s that are to be created. Make sure that the categories and the types are correct, often several options will be offered based on an inconclusive automatic resolution.', $scope);?></p>\n    <?php\n        if (!empty($missingTldLists)) {\n            $missingTldLists = implode(', ', $missingTldLists);\n            $missingTldLists = __('Warning: You are missing warninglist(s) that are used to recognise TLDs. Make sure your MISP has the warninglist submodule enabled and updated or else this tool might end up missing valid domains/hostnames/urls. The missing lists are: %s', $missingTldLists);\n            echo sprintf('<p class=\"bold red\">%s</p>', $missingTldLists);\n        }\n    ?>\n    <p></p>\n    <?php\n        $instanceDefault = 5;\n        if (!empty(Configure::read('MISP.default_attribute_distribution'))) {\n            if (Configure::read('MISP.default_attribute_distribution') == 'event') {\n                $instanceDefault = 5;\n            } else {\n                $instanceDefault = Configure::read('MISP.default_attribute_distribution');\n            }\n        }\n        echo $this->Form->create('Attribute', array('url' => '/events/saveFreeText/' . $event['Event']['id'], 'class' => 'mainForm'));\n        if ($isSiteAdmin) {\n            echo $this->Form->input('force', array(\n                    'checked' => false,\n                    'label' => __('Proposals instead of attributes'),\n            ));\n        }\n        echo $this->Form->input('JsonObject', array(\n                'label' => false,\n                'type' => 'text',\n                'style' => 'display:none;',\n                'value' => '',\n        ));\n        echo $this->Form->input('default_comment', array(\n                'label' => false,\n                'type' => 'text',\n                'style' => 'display:none;',\n                'value' => $importComment,\n        ));\n        echo $this->Form->end();\n    ?>\n    <table class=\"table table-striped table-hover table-condensed\">\n        <tr>\n                <th><?php echo __('Value');?></th>\n                <th><?php echo __('Similar Attributes');?></th>\n                <th><?php echo __('Category');?></th>\n                <th><?php echo __('Type');?></th>\n                <th><?php echo __('IDS');?><input type=\"checkbox\" id=\"checkAllIDS\" style=\"margin-top:23px;margin-left:3px;\"/></th>\n                <th style=\"text-align:center;\"><?php echo __('Disable Correlation');?><input type=\"checkbox\" id=\"checkAllDC\" style=\"margin:0px;\"/></th>\n                <th><?php echo __('Distribution');?></th>\n                <th><?php echo __('Comment');?></th>\n                <th><?php echo __('Tags');?></th>\n                <th><?php echo __('Actions');?></th>\n        </tr>\n        <?php\n            $options = array();\n            foreach ($resultArray as $k => $item):\n        ?>\n        <tr id=\"row_<?php echo $k; ?>\" class=\"freetext_row\">\n            <?php\n                echo $this->Form->input('Attribute' . $k . 'Save', array(\n                        'label' => false,\n                        'style' => 'display:none;',\n                        'value' => 1,\n                ));\n                echo $this->Form->input('Attribute' . $k . 'Data', array(\n                        'label' => false,\n                        'type' => 'hidden',\n                        'value' => isset($item['data']) ? $item['data'] : false,\n                ));\n                echo $this->Form->input('Attribute' . $k . 'DataIsHandled', array(\n                        'label' => false,\n                        'type' => 'hidden',\n                        'value' => isset($item['data_is_handled']) ? h($item['data_is_handled']) : false,\n                ));\n            ?>\n            <td>\n                <?php\n                    echo $this->Form->input('Attribute' . $k . 'Value', array(\n                            'label' => false,\n                            'value' => $item['value'],\n                            'style' => 'padding:0px;height:20px;margin-bottom:0px;width:90%;min-width:400px;',\n                            'div' => false\n                    ));\n                ?>\n                <input type=\"hidden\" id=\"<?php echo 'Attribute' . $k . 'Save'; ?>\" value=1 >\n            </td>\n            <td class=\"shortish\">\n                <?php\n                    foreach ($item['related'] as $relation):\n                        $popover = array(\n                            'Event ID' => $relation['Event']['id'],\n                            'Event Info' => $relation['Event']['info'],\n                            'Category' => $relation['Attribute']['category'],\n                            'Type' => $relation['Attribute']['type'],\n                            'Value' => $relation['Attribute']['value'],\n                            'Comment' => $relation['Attribute']['comment'],\n                        );\n                        $popoverHTML = '';\n                        foreach ($popover as $key => $popoverElement) {\n                            $popoverHTML .= '<span class=\\'bold\\'>' . $key . '</span>: <span class=\\'blue bold\\'>' . h($popoverElement) . '</span><br />';\n                        }\n                ?>\n                        <a href=\"<?php echo $baseurl; ?>/events/view/<?php echo h($relation['Event']['id']);?>\" data-toggle=\"popover\" title=\"Attribute details\" data-content=\"<?php echo h($popoverHTML); ?>\" data-trigger=\"hover\"><?php echo h($relation['Event']['id']);?></a>\n                <?php\n                    endforeach;\n                    $correlationPopover = array('<span>', );\n                ?>\n            </td>\n            <td class=\"short\">\n                <?php\n                    if (!isset($item['categories'])) {\n                        if (isset($defaultCategories[$item['default_type']])) {\n                            $default = array_search($defaultCategories[$item['default_type']], $typeCategoryMapping[$item['default_type']]);\n                        } else {\n                            reset($typeCategoryMapping[$item['default_type']]);\n                            $default = key($typeCategoryMapping[$item['default_type']]);\n                        }\n                    } else {\n                        if (isset($item['category_default'])) $default = $item['category_default'];\n                        else $default = array_search($item['categories'][0], $typeCategoryMapping[$item['default_type']]);\n\n                    }\n                ?>\n                <select id=\"<?php echo 'Attribute' . $k . 'Category'; ?>\" style='padding:0px;height:20px;margin-bottom:0px;' class=\"categoryToggle\">\n                    <?php\n                        foreach ($typeCategoryMapping[$item['default_type']] as $category) {\n                            if (isset($item['categories']) && !in_array($category, $item['categories'])) {\n                                continue;\n                            }\n                            echo '<option value=\"' . $category . '\" ';\n                            if ($category == $default) echo 'selected=\"selected\"';\n                            echo '>' . $category . '</option>';\n                        }\n                    ?>\n                </select>\n            </td>\n            <td class=\"short\">\n                <?php\n                    $divVisibility = '';\n                    $selectVisibility = '';\n                    if (count($item['types']) == 1) {\n                        $selectVisibility = 'display:none;';\n                    } else {\n                        $divVisibility = 'style=\"display:none;\"';\n                        if (!in_array(array_keys($item['types']), $options)) $options[] = array_values($item['types']);\n                    }\n                ?>\n                <div id = \"<?php echo 'Attribute' . $k . 'TypeStatic'; ?>\" <?php echo $divVisibility; ?> ><?php echo h($item['default_type']); ?></div>\n                <select id = \"<?php echo 'Attribute' . $k . 'Type'; ?>\" class='typeToggle' style='padding:0px;height:20px;margin-bottom:0px;<?php echo $selectVisibility; ?>'>\n                    <?php\n                        if (!empty($item['types'])) {\n                            foreach ($item['types'] as $type) {\n                                echo '<option value=\"' . h($type) . '\" ';\n                                echo ($type == $item['default_type'] ? 'selected=\"selected\"' : '') . '>' . h($type) . '</option>';\n                            }\n                        }\n                    ?>\n                </select>\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <input type=\"checkbox\" id=\"<?php echo 'Attribute' . $k . 'To_ids'; ?>\" <?php if ($item['to_ids']) echo 'checked'; ?> class=\"idsCheckbox\" />\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <input type=\"checkbox\" id=\"<?php echo 'Attribute' . $k . 'Disable_correlation'; ?>\" <?php if (isset($item['disable_correlation']) && $item['disable_correlation']) echo 'checked'; ?> class=\"dcCheckbox\" />\n            </td>\n            <td class=\"short\" style=\"width:40px;text-align:center;\">\n                <select id = \"<?php echo 'Attribute' . $k . 'Distribution'; ?>\" class='distributionToggle' style='padding:0px;height:20px;margin-bottom:0px;'>\n                    <?php\n                        foreach ($distributions as $distKey => $distValue) {\n                            $default = isset($item['distribution']) ? $item['distribution'] : $instanceDefault;\n                            echo '<option value=\"' . $distKey . '\" ';\n                            echo ($distKey == $default ? 'selected=\"selected\"' : '') . '>' . $distValue . '</option>';\n                        }\n                    ?>\n                </select>\n                <div style=\"display:none;\">\n                    <select id = \"<?php echo 'Attribute' . $k . 'SharingGroupId'; ?>\" class='sgToggle' style='padding:0px;height:20px;margin-top:3px;margin-bottom:0px;'>\n                        <?php\n                            foreach ($sgs as $sgKey => $sgValue) {\n                                echo '<option value=\"' . h($sgKey) . '\">' . h($sgValue) . '</option>';\n                            }\n                        ?>\n                    </select>\n                </div>\n            </td>\n            <td class=\"short\">\n                <input type=\"text\" class=\"freetextCommentField\" id=\"<?php echo 'Attribute' . $k . 'Comment'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\" placeholder=\"<?php echo h($importComment); ?>\" <?php if (isset($item['comment']) && $item['comment'] !== false) echo 'value=\"' . h($item['comment']) . '\"'?>/>\n            </td>\n            <td class=\"short\">\n                <input type=\"text\" class=\"freetextTagField\" id=\"<?php echo 'Attribute' . $k . 'Tags'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\"<?php if (isset($item['tags']) && $item['tags'] !== false) echo 'value=\"' . h(implode(\",\",$item['tags'])) . '\"'?>/>\n            </td>\n            <td class=\"action short\">\n                <span class=\"icon-remove pointer\" title=\"<?php echo __('Remove resolved attribute');?>\" role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Remove resolved attribute');?>\" onClick=\"freetextRemoveRow('<?php echo $k; ?>', '<?php echo $event['Event']['id']; ?>');\"></span>\n            </td>\n        </tr>\n    <?php\n        endforeach;\n        $optionsRearranged = array();\n        foreach ($options as $group) {\n            foreach ($group as $k => $element) {\n                $temp = $group;\n                unset($temp[$k]);\n                if (!isset($optionsRearranged[$element])) $optionsRearranged[$element] = array();\n                $optionsRearranged[$element] = array_merge($optionsRearranged[$element], $temp);\n            }\n        }\n    ?>\n    </table>\n    <span>\n        <button class=\"btn btn-primary\" style=\"float:left;\" onClick=\"freetextImportResultsSubmit('<?php echo h($event['Event']['id']); ?>', '<?php echo count($resultArray); ?>');\"><?php echo __('Submit %s', $scope);?></button>\n        <span style=\"float:right\">\n            <?php\n                if (!empty($optionsRearranged)):\n            ?>\n                <select id=\"changeFrom\" style=\"margin-left:50px;margin-top:10px;\">\n                    <?php\n                        foreach (array_keys($optionsRearranged) as $fromElement):\n                    ?>\n                            <option><?php echo h($fromElement); ?></option>\n                    <?php\n                        endforeach;\n                    ?>\n                </select>\n                <span class=\"icon-arrow-right\"></span>\n                <select id=\"changeTo\" style=\"margin-top:10px;\">\n                    <?php\n                        $keys = array_keys($optionsRearranged);\n                        foreach ($optionsRearranged[$keys[0]] as $toElement):\n                    ?>\n                            <option value=\"<?php echo $toElement; ?>\"><?php echo $toElement; ?></option>\n                    <?php\n                        endforeach;\n                    ?>\n                </select>\n                <span role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Apply changes to all applicable resolved attributes');?>\" title=\"<?php echo __('Apply changes to all applicable resolved attributes');?>\" class=\"btn btn-inverse\" onClick=\"changeFreetextImportExecute();\"><?php echo __('Change all');?></span><br />\n            <?php endif; ?>\n            <input type=\"text\" id=\"changeComments\" style=\"margin-left:50px;margin-top:10px;width:446px;\" placeholder=\"<?php echo __('Update all comment fields');?>\">\n            <span role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Change all');?>\" title=\"<?php echo __('Change all');?>\" class=\"btn btn-inverse\" onClick=\"changeFreetextImportCommentExecute();\"><?php echo __('Change all');?></span>\n        </span>\n    </span>\n</div>\n    <script>\n        var options = <?php echo json_encode($optionsRearranged);?>;\n        var typeCategoryMapping = <?php echo json_encode($typeCategoryMapping); ?>;\n        $(document).ready(function() {\n            popoverStartup();\n            $('.typeToggle').on('change', function() {\n                var currentId = $(this).attr('id');\n                var selected = $(this).val();\n                currentId = currentId.replace('Type', 'Category');\n                var currentOptions = typeCategoryMapping[selected];\n                /*\n                // Coming soon - restrict further if a list of categories is passed by the modules / freetext import tool\n                if ($('#' + currentId)).data('category-restrictions') {\n                    var category_restrictions = $('#' + currentId)).data('category-restrictions');\n                    currentOptions.forEach(function(category) {\n                        var found = False;\n                        category_restrictions.forEach(function(restricted_category) {\n\n                        });\n                    });\n                    currentOptions.forEach() {\n\n                    }\n                }\n                */\n                $('#' + currentId).empty();\n                for (var category in currentOptions) {\n                    $('#' + currentId).append($(\"<option></option>\").attr(\"value\", category).text(category));\n                }\n            });\n        <?php\n            if (!empty($optionsRearranged)):\n        ?>\n                $('#changeFrom').change(function(){\n                    changeFreetextImportFrom();\n                });\n                $('#changeFrom').trigger('change');\n        <?php\n            endif;\n        ?>\n            $('#checkAllIDS').change(function() {\n                $('.idsCheckbox').prop('checked', $('#checkAllIDS').is(':checked'));\n            });\n            $('#checkAllDC').change(function() {\n                $('.dcCheckbox').prop('checked', $('#checkAllDC').is(':checked'));\n            });\n            $('.distributionToggle').change(function() {\n                if ($(this).val() == 4) {\n                    $(this).next().show();\n                } else {\n                    $(this).next().hide();\n                }\n            });\n        });\n    </script>\n<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'event', 'menuItem' => 'freetextResults'));\n?>\n"], "filenames": ["app/View/Events/resolved_attributes.ctp"], "buggy_code_start_loc": [102], "buggy_code_end_loc": [103], "fixing_code_start_loc": [102], "fixing_code_end_loc": [103], "type": "CWE-79", "message": "app/View/Events/resolved_attributes.ctp in MISP before 2.4.126 has XSS in the resolved attributes view.", "other": {"cve": {"id": "CVE-2020-13153", "sourceIdentifier": "cve@mitre.org", "published": "2020-05-18T22:15:12.843", "lastModified": "2020-05-19T17:55:24.007", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "app/View/Events/resolved_attributes.ctp in MISP before 2.4.126 has XSS in the resolved attributes view."}, {"lang": "es", "value": "El archivo app/View/Events/resolved_attributes.ctp en MISP versiones anteriores a 2.4.126, presenta una vulnerabilidad de tipo XSS en la vista de atributos resueltos."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.126", "matchCriteriaId": "E73AD966-66AD-4B1C-9C80-42AF35654819"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/2989aa05225aa9b3a592ca50cbf8350ef256909c", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/MISP/MISP/compare/v2.4.125...v2.4.126", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/2989aa05225aa9b3a592ca50cbf8350ef256909c"}}