{"buggy_code": ["/* vim: set expandtab sw=4 ts=4 sts=4: */\n/**\n * @fileoverview   events handling from normalization page\n * @name            normalization\n *\n * @requires    jQuery\n */\n\n/**\n * AJAX scripts for normalization.php\n *\n */\n\nvar normalizeto = '1nf';\nvar primary_key;\nvar data_parsed = null;\nfunction appendHtmlColumnsList()\n{\n    $.get(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"getColumns\": true\n        },\n        function(data) {\n            if (data.success === true) {\n                $('select[name=makeAtomic]').html(data.message);\n            }\n        }\n    );\n}\nfunction goTo3NFStep1(newTables)\n{\n    if (Object.keys(newTables).length === 1) {\n        newTables = [PMA_commonParams.get('table')];\n    }\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"tables\": newTables,\n            \"step\": '3.1'\n        }, function(data) {\n            $(\"#page_content\").find(\"h3\").html(PMA_messages.str3NFNormalization);\n            $(\"#mainContent\").find(\"legend\").html(data.legendText);\n            $(\"#mainContent\").find(\"h4\").html(data.headText);\n            $(\"#mainContent\").find(\"p\").html(data.subText);\n            $(\"#mainContent\").find(\"#extra\").html(data.extra);\n            $(\"#extra\").find(\"form\").each(function() {\n                var form_id = $(this).attr('id');\n                var colname = $(this).data('colname');\n                $(\"#\" + form_id + \" input[value='\" + colname + \"']\").next().remove();\n                $(\"#\" + form_id + \" input[value='\" + colname + \"']\").remove();\n            });\n            $(\"#mainContent\").find(\"#newCols\").html('');\n            $('.tblFooters').html('');\n            if (data.subText !== \"\") {\n                $('.tblFooters').html('<input type=\"button\" onClick=\"processDependencies(\\'\\', true);\" value=\"' + PMA_messages.strDone + '\"/>');\n            }\n        }\n    );\n}\nfunction goTo2NFStep1() {\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step\": '2.1'\n        }, function(data) {\n            $(\"#page_content h3\").html(PMA_messages.str2NFNormalization);\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            if (data.subText !== '') {\n                $('.tblFooters').html('<input type=\"submit\" value=\"' + PMA_messages.strDone + '\" onclick=\"processDependencies(\\'' + data.primary_key + '\\');\">');\n            } else {\n                if (normalizeto === '3nf') {\n                    $(\"#mainContent #newCols\").html(PMA_messages.strToNextStep);\n                    setTimeout(function() {\n                        goTo3NFStep1([PMA_commonParams.get('table')]);\n                    }, 3000);\n                }\n            }\n        });\n}\n\nfunction goToFinish1NF()\n{\n    if (normalizeto !== '1nf') {\n        goTo2NFStep1();\n        return true;\n    }\n    $(\"#mainContent legend\").html(PMA_messages.strEndStep);\n    $(\"#mainContent h4\").html(\n        \"<h3>\" + PMA_sprintf(PMA_messages.strFinishMsg, PMA_commonParams.get('table')) + \"</h3>\"\n    );\n    $(\"#mainContent p\").html('');\n    $(\"#mainContent #extra\").html('');\n    $(\"#mainContent #newCols\").html('');\n    $('.tblFooters').html('');\n}\n\nfunction goToStep4()\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step4\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            for(var pk in primary_key) {\n                $(\"#extra input[value='\" + primary_key[pk] + \"']\").attr(\"disabled\",\"disabled\");\n            }\n        }\n    );\n}\n\nfunction goToStep3()\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step3\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            primary_key = $.parseJSON(data.primary_key);\n            for(var pk in primary_key) {\n                $(\"#extra input[value='\" + primary_key[pk] + \"']\").attr(\"disabled\",\"disabled\");\n            }\n        }\n    );\n}\n\nfunction goToStep2(extra)\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step2\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra,#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            if (data.hasPrimaryKey === \"1\") {\n                if(extra === 'goToStep3') {\n                    $(\"#mainContent h4\").html(PMA_messages.strPrimaryKeyAdded);\n                    $(\"#mainContent p\").html(PMA_messages.strToNextStep);\n                }\n                if(extra === 'goToFinish1NF') {\n                    goToFinish1NF();\n                } else {\n                    setTimeout(function() {\n                        goToStep3();\n                    }, 3000);\n                }\n            } else {\n                //form to select columns to make primary\n                $(\"#mainContent #extra\").html(data.extra);\n            }\n        }\n    );\n}\n\nfunction goTo2NFFinish(pd)\n{\n    var tables = {};\n    for (var dependson in pd) {\n        tables[dependson] = $('#extra input[name=\"' + dependson + '\"]').val();\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"pd\": JSON.stringify(pd),\n            \"newTablesName\":JSON.stringify(tables),\n            \"createNewTables2NF\":1};\n    $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    if(data.queryError === false) {\n                        if (normalizeto === '3nf') {\n                            $(\"#pma_navigation_reload\").click();\n                            goTo3NFStep1(tables);\n                            return true;\n                        }\n                        $(\"#mainContent legend\").html(data.legendText);\n                        $(\"#mainContent h4\").html(data.headText);\n                        $(\"#mainContent p\").html('');\n                        $(\"#mainContent #extra\").html('');\n                        $('.tblFooters').html('');\n                    } else {\n                        PMA_ajaxShowMessage(data.extra, false);\n                    }\n                    $(\"#pma_navigation_reload\").click();\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n}\n\nfunction goTo3NFFinish(newTables)\n{\n    for (var table in newTables) {\n        for (var newtbl in newTables[table]) {\n            var updatedname = $('#extra input[name=\"' + newtbl + '\"]').val();\n            newTables[table][updatedname] = newTables[table][newtbl];\n            if (updatedname !== newtbl) {\n                delete newTables[table][newtbl];\n            }\n        }\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"newTables\":JSON.stringify(newTables),\n            \"createNewTables3NF\":1};\n    $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    if(data.queryError === false) {\n                        $(\"#mainContent legend\").html(data.legendText);\n                        $(\"#mainContent h4\").html(data.headText);\n                        $(\"#mainContent p\").html('');\n                        $(\"#mainContent #extra\").html('');\n                        $('.tblFooters').html('');\n                    } else {\n                        PMA_ajaxShowMessage(data.extra, false);\n                    }\n                    $(\"#pma_navigation_reload\").click();\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n}\nvar backup = '';\nfunction goTo2NFStep2(pd, primary_key)\n{\n    $(\"#newCols\").html('');\n    $(\"#mainContent legend\").html(PMA_messages.strStep + ' 2.2 ' + PMA_messages.strConfirmPd);\n    $(\"#mainContent h4\").html(PMA_messages.strSelectedPd);\n    $(\"#mainContent p\").html(PMA_messages.strPdHintNote);\n    var extra = '<div class=\"dependencies_box\">';\n    var pdFound = false;\n    for (var dependson in pd) {\n        if (dependson !== primary_key) {\n            pdFound = true;\n            extra += '<p class=\"displayblock desc\">' + escapeHtml(dependson) + \" -> \" + escapeHtml(pd[dependson].toString()) + '</p>';\n        }\n    }\n    if(!pdFound) {\n        extra += '<p class=\"displayblock desc\">' + PMA_messages.strNoPdSelected + '</p>';\n        extra += '</div>';\n    } else {\n        extra += '</div>';\n        datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"pd\": JSON.stringify(pd),\n            \"getNewTables2NF\":1};\n        $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    extra += data.message;\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n    }\n    $(\"#mainContent #extra\").html(extra);\n    $('.tblFooters').html('<input type=\"button\" value=\"' + PMA_messages.strBack + '\" id=\"backEditPd\"/><input type=\"button\" id=\"goTo2NFFinish\" value=\"' + PMA_messages.strGo + '\"/>');\n    $(\"#goTo2NFFinish\").click(function(){\n        goTo2NFFinish(pd);\n    });\n}\n\nfunction goTo3NFStep2(pd, tablesTds)\n{\n    $(\"#newCols\").html('');\n    $(\"#mainContent legend\").html(PMA_messages.strStep + ' 3.2 ' + PMA_messages.strConfirmTd);\n    $(\"#mainContent h4\").html(PMA_messages.strSelectedTd);\n    $(\"#mainContent p\").html(PMA_messages.strPdHintNote);\n    var extra = '<div class=\"dependencies_box\">';\n    var pdFound = false;\n    for (var table in tablesTds) {\n        for (var i in tablesTds[table]) {\n            dependson = tablesTds[table][i];\n            if (dependson !== '' && dependson !== table) {\n                pdFound = true;\n                extra += '<p class=\"displayblock desc\">' + escapeHtml(dependson) + \" -> \" + escapeHtml(pd[dependson].toString()) + '</p>';\n            }\n        }\n    }\n    if(!pdFound) {\n        extra += '<p class=\"displayblock desc\">' + PMA_messages.strNoTdSelected + '</p>';\n        extra += '</div>';\n    } else {\n        extra += '</div>';\n        datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"tables\": JSON.stringify(tablesTds),\n            \"pd\": JSON.stringify(pd),\n            \"getNewTables3NF\":1};\n        $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                data_parsed = $.parseJSON(data.message);\n                if (data.success === true) {\n                    extra += data_parsed.html;\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n    }\n    $(\"#mainContent #extra\").html(extra);\n    $('.tblFooters').html('<input type=\"button\" value=\"' + PMA_messages.strBack + '\" id=\"backEditPd\"/><input type=\"button\" id=\"goTo3NFFinish\" value=\"' + PMA_messages.strGo + '\"/>');\n    $(\"#goTo3NFFinish\").click(function(){\n        if (!pdFound) {\n            goTo3NFFinish([]);\n        } else {\n            goTo3NFFinish(data_parsed.newTables);\n        }\n    });\n}\nfunction processDependencies(primary_key, isTransitive)\n{\n    var pd = {};\n    var tablesTds = {};\n    var dependsOn;\n    pd[primary_key] = [];\n    $(\"#extra form\").each(function() {\n        var tblname;\n        if (isTransitive === true) {\n            tblname = $(this).data('tablename');\n            primary_key = tblname;\n            if (!(tblname in tablesTds)) {\n                tablesTds[tblname] = [];\n            }\n            tablesTds[tblname].push(primary_key);\n        }\n        var form_id = $(this).attr('id');\n        $('#' + form_id + ' input[type=checkbox]:not(:checked)').removeAttr('checked');\n        dependsOn = '';\n        $('#' + form_id + ' input[type=checkbox]:checked').each(function(){\n            dependsOn += $(this).val() + ', ';\n            $(this).attr(\"checked\",\"checked\");\n        });\n        if (dependsOn === '') {\n            dependsOn = primary_key;\n        } else {\n            dependsOn = dependsOn.slice(0, -2);\n        }\n        if (! (dependsOn in pd)) {\n            pd[dependsOn] = [];\n        }\n        pd[dependsOn].push($(this).data('colname'));\n        if (isTransitive === true) {\n            if (!(tblname in tablesTds)) {\n                tablesTds[tblname] = [];\n            }\n            if ($.inArray(dependsOn, tablesTds[tblname]) === -1) {\n                tablesTds[tblname].push(dependsOn);\n            }\n        }\n    });\n    backup = $(\"#mainContent\").html();\n    if (isTransitive === true) {\n        goTo3NFStep2(pd, tablesTds);\n    } else {\n        goTo2NFStep2(pd, primary_key);\n    }\n    return false;\n}\n\nfunction moveRepeatingGroup(repeatingCols) {\n    var newTable = $(\"input[name=repeatGroupTable]\").val();\n    var newColumn = $(\"input[name=repeatGroupColumn]\").val();\n    if (!newTable) {\n        $(\"input[name=repeatGroupTable]\").focus();\n        return false;\n    }\n    if (!newColumn) {\n        $(\"input[name=repeatGroupColumn]\").focus();\n        return false;\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n        \"ajax_request\": true,\n        \"db\": PMA_commonParams.get('db'),\n        \"table\": PMA_commonParams.get('table'),\n        \"repeatingColumns\": repeatingCols,\n        \"newTable\":newTable,\n        \"newColumn\":newColumn,\n        \"primary_columns\":primary_key.toString()\n    };\n    $.ajax({\n        type: \"POST\",\n        url: \"normalization.php\",\n        data: datastring,\n        async:false,\n        success: function(data) {\n            if (data.success === true) {\n                if(data.queryError === false) {\n                    goToStep3();\n                }\n                PMA_ajaxShowMessage(data.message, false);\n                $(\"#pma_navigation_reload\").click();\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        }\n    });\n}\nAJAX.registerTeardown('normalization.js', function () {\n    $(\"#extra\").off(\"click\", \"#selectNonAtomicCol\");\n    $(\"#splitGo\").unbind('click');\n    $('.tblFooters').off(\"click\", \"#saveSplit\");\n    $(\"#extra\").off(\"click\", \"#addNewPrimary\");\n    $(\".tblFooters\").off(\"click\", \"#saveNewPrimary\");\n    $(\"#extra\").off(\"click\", \"#removeRedundant\");\n    $(\"#mainContent p\").off(\"click\", \"#createPrimaryKey\");\n    $(\"#mainContent\").off(\"click\", \"#backEditPd\");\n    $(\"#mainContent\").off(\"click\", \"#showPossiblePd\");\n    $(\"#mainContent\").off(\"click\", \".pickPd\");\n});\n\nAJAX.registerOnload('normalization.js', function() {\n    var selectedCol;\n    normalizeto = $(\"#mainContent\").data('normalizeto');\n    $(\"#extra\").on(\"click\", \"#selectNonAtomicCol\", function() {\n        if ($(this).val() === 'no_such_col') {\n            goToStep2();\n        } else {\n            selectedCol = $(this).val();\n        }\n    });\n\n    $(\"#splitGo\").click(function() {\n        if(!selectedCol || selectedCol === '') {\n            return false;\n        }\n        var numField = $(\"#numField\").val();\n        $.get(\n            \"normalization.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"splitColumn\": true,\n                \"numFields\": numField\n            },\n        function(data) {\n                if (data.success === true) {\n                    $('#newCols').html(data.message);\n                    $('.default_value').hide();\n                    $('.enum_notice').hide();\n                    $('.tblFooters').html(\"<input type='submit' id='saveSplit' value='\" + PMA_messages.strSave + \"'/>\" +\n                        \"<input type='submit' id='cancelSplit' value='\" + PMA_messages.strCancel + \"' \" +\n                        \"onclick=\\\"$('#newCols').html('');$(this).parent().html('')\\\"/>\");\n                }\n            }\n        );\n        return false;\n    });\n    $('.tblFooters').on(\"click\",\"#saveSplit\", function() {\n        central_column_list = [];\n        if ($(\"#newCols #field_0_1\").val() === '') {\n            $(\"#newCols #field_0_1\").focus();\n            return false;\n        }\n        datastring = $('#newCols :input').serialize();\n        datastring += \"&ajax_request=1&do_save_data=1&field_where=last\";\n        $.post(\"tbl_addfield.php\", datastring, function(data) {\n            if (data.success) {\n                $.get(\n                    \"sql.php\",\n                    {\n                        \"token\": PMA_commonParams.get('token'),\n                        \"ajax_request\": true,\n                        \"db\": PMA_commonParams.get('db'),\n                        \"table\": PMA_commonParams.get('table'),\n                        \"dropped_column\": selectedCol,\n                        \"purge\" : 1,\n                        \"sql_query\": 'ALTER TABLE `' + PMA_commonParams.get('table') + '` DROP `' + selectedCol + '`;',\n                        \"is_js_confirmed\": 1\n                    },\n                function(data) {\n                        if (data.success === true) {\n                            appendHtmlColumnsList();\n                            $('#newCols').html('');\n                            $('.tblFooters').html('');\n                        } else {\n                            PMA_ajaxShowMessage(data.error, false);\n                        }\n                        selectedCol = '';\n                    }\n                );\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        });\n    });\n\n    $(\"#extra\").on(\"click\", \"#addNewPrimary\", function() {\n        $.get(\n            \"normalization.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"addNewPrimary\": true\n            },\n        function(data) {\n                if (data.success === true) {\n                    $('#newCols').html(data.message);\n                    $('.default_value').hide();\n                    $('.enum_notice').hide();\n                    $('.tblFooters').html(\"<input type='submit' id='saveNewPrimary' value='\" + PMA_messages.strSave + \"'/>\" +\n                        \"<input type='submit' id='cancelSplit' value='\" + PMA_messages.strCancel + \"' \" +\n                        \"onclick=\\\"$('#newCols').html('');$(this).parent().html('')\\\"/>\");\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        );\n        return false;\n    });\n    $(\".tblFooters\").on(\"click\", \"#saveNewPrimary\", function() {\n        var datastring = $('#newCols :input').serialize();\n        datastring += \"&field_key[0]=primary_0&ajax_request=1&do_save_data=1&field_where=last\";\n        $.post(\"tbl_addfield.php\", datastring, function(data) {\n            if (data.success === true) {\n                $(\"#mainContent h4\").html(PMA_messages.strPrimaryKeyAdded);\n                $(\"#mainContent p\").html(PMA_messages.strToNextStep);\n                $(\"#mainContent #extra\").html('');\n                $(\"#mainContent #newCols\").html('');\n                $('.tblFooters').html('');\n                setTimeout(function() {\n                    goToStep3();\n                }, 2000);\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        });\n    });\n    $(\"#extra\").on(\"click\", \"#removeRedundant\", function() {\n        var dropQuery = 'ALTER TABLE `' + PMA_commonParams.get('table') + '` ';\n        $(\"#extra input[type=checkbox]:checked\").each(function() {\n            dropQuery += 'DROP `' + $(this).val() + '`, ';\n        });\n        dropQuery = dropQuery.slice(0, -2);\n        $.get(\n            \"sql.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"sql_query\": dropQuery,\n                \"is_js_confirmed\": 1\n            },\n        function(data) {\n                if (data.success === true) {\n                    goToStep2('goToFinish1NF');\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        );\n    });\n    $(\"#extra\").on(\"click\", \"#moveRepeatingGroup\", function() {\n        var repeatingCols = '';\n        $(\"#extra input[type=checkbox]:checked\").each(function() {\n            repeatingCols += $(this).val() + ', ';\n        });\n\n        if (repeatingCols !== '') {\n            var newColName = $(\"#extra input[type=checkbox]:checked:first\").val();\n            repeatingCols = repeatingCols.slice(0, -2);\n            var confirmStr = PMA_sprintf(PMA_messages.strMoveRepeatingGroup, escapeHtml(repeatingCols), escapeHtml(PMA_commonParams.get('table')));\n            confirmStr += '<input type=\"text\" name=\"repeatGroupTable\" placeholder=\"' + PMA_messages.strNewTablePlaceholder + '\"/>' +\n                '( ' + escapeHtml(primary_key.toString()) + ', <input type=\"text\" name=\"repeatGroupColumn\" placeholder=\"' + PMA_messages.strNewColumnPlaceholder + '\" value=\"' + escapeHtml(newColName) + '\">)' +\n                '</ol>';\n            $(\"#newCols\").html(confirmStr);\n            $('.tblFooters').html('<input type=\"submit\" value=\"' + PMA_messages.strCancel + '\" onclick=\"$(\\'#newCols\\').html(\\'\\');$(\\'#extra input[type=checkbox]\\').removeAttr(\\'checked\\')\"/>' +\n                '<input type=\"submit\" value=\"' + PMA_messages.strGo + '\" onclick=\"moveRepeatingGroup(\\'' + repeatingCols + '\\')\"/>');\n        }\n    });\n    $(\"#mainContent p\").on(\"click\", \"#createPrimaryKey\", function(event) {\n        event.preventDefault();\n        var url = { create_index: 1,\n            server:  PMA_commonParams.get('server'),\n            db: PMA_commonParams.get('db'),\n            table: PMA_commonParams.get('table'),\n            token: PMA_commonParams.get('token'),\n            added_fields: 1,\n            add_fields:1,\n            index: {Key_name:'PRIMARY'},\n            ajax_request: true\n        };\n        var title = PMA_messages.strAddPrimaryKey;\n        indexEditorDialog(url, title, function(){\n            //on success\n            $(\".sqlqueryresults\").remove();\n            $('.result_query').remove();\n            $('.tblFooters').html('');\n            goToStep2('goToStep3');\n        });\n        return false;\n    });\n    $(\"#mainContent\").on(\"click\", \"#backEditPd\", function(){\n        $(\"#mainContent\").html(backup);\n    });\n    $(\"#mainContent\").on(\"click\", \"#showPossiblePd\", function(){\n        if($(this).hasClass('hideList')) {\n            $(this).html('+ ' + PMA_messages.strShowPossiblePd);\n            $(this).removeClass('hideList');\n            $(\"#newCols\").slideToggle(\"slow\");\n            return false;\n        }\n        if($(\"#newCols\").html() !== '') {\n            $(\"#showPossiblePd\").html('- ' + PMA_messages.strHidePd);\n            $(\"#showPossiblePd\").addClass('hideList');\n            $(\"#newCols\").slideToggle(\"slow\");\n            return false;\n        }\n        $(\"#newCols\").insertAfter(\"#mainContent h4\");\n        $(\"#newCols\").html('<div class=\"center\">' + PMA_messages.strLoading + '<br/>' + PMA_messages.strWaitForPd + '</div>');\n        $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"findPdl\": true\n        }, function(data) {\n            $(\"#showPossiblePd\").html('- ' + PMA_messages.strHidePd);\n            $(\"#showPossiblePd\").addClass('hideList');\n            $(\"#newCols\").html(data.message);\n        });\n    });\n    $(\"#mainContent\").on(\"click\", \".pickPd\", function(){\n        var strColsLeft = $(this).next('.determinants').html();\n        var colsLeft = strColsLeft.split(',');\n        var strColsRight = $(this).next().next().html();\n        var colsRight = strColsRight.split(',');\n        for (var i in colsRight) {\n            $('form[data-colname=\"' + colsRight[i].trim() + '\"] input[type=\"checkbox\"]').prop('checked', false);\n            for (var j in colsLeft) {\n                $('form[data-colname=\"' + colsRight[i].trim() + '\"] input[value=\"' + colsLeft[j].trim() + '\"]').prop('checked', true);\n            }\n        }\n    });\n});\n"], "fixing_code": ["/* vim: set expandtab sw=4 ts=4 sts=4: */\n/**\n * @fileoverview   events handling from normalization page\n * @name            normalization\n *\n * @requires    jQuery\n */\n\n/**\n * AJAX scripts for normalization.php\n *\n */\n\nvar normalizeto = '1nf';\nvar primary_key;\nvar data_parsed = null;\nfunction appendHtmlColumnsList()\n{\n    $.get(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"getColumns\": true\n        },\n        function(data) {\n            if (data.success === true) {\n                $('select[name=makeAtomic]').html(data.message);\n            }\n        }\n    );\n}\nfunction goTo3NFStep1(newTables)\n{\n    if (Object.keys(newTables).length === 1) {\n        newTables = [PMA_commonParams.get('table')];\n    }\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"tables\": newTables,\n            \"step\": '3.1'\n        }, function(data) {\n            $(\"#page_content\").find(\"h3\").html(PMA_messages.str3NFNormalization);\n            $(\"#mainContent\").find(\"legend\").html(data.legendText);\n            $(\"#mainContent\").find(\"h4\").html(data.headText);\n            $(\"#mainContent\").find(\"p\").html(data.subText);\n            $(\"#mainContent\").find(\"#extra\").html(data.extra);\n            $(\"#extra\").find(\"form\").each(function() {\n                var form_id = $(this).attr('id');\n                var colname = $(this).data('colname');\n                $(\"#\" + form_id + \" input[value='\" + colname + \"']\").next().remove();\n                $(\"#\" + form_id + \" input[value='\" + colname + \"']\").remove();\n            });\n            $(\"#mainContent\").find(\"#newCols\").html('');\n            $('.tblFooters').html('');\n            if (data.subText !== \"\") {\n                $('.tblFooters').html('<input type=\"button\" onClick=\"processDependencies(\\'\\', true);\" value=\"' + PMA_messages.strDone + '\"/>');\n            }\n        }\n    );\n}\nfunction goTo2NFStep1() {\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step\": '2.1'\n        }, function(data) {\n            $(\"#page_content h3\").html(PMA_messages.str2NFNormalization);\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            if (data.subText !== '') {\n                $('.tblFooters').html('<input type=\"submit\" value=\"' + PMA_messages.strDone + '\" onclick=\"processDependencies(\\'' + data.primary_key + '\\');\">');\n            } else {\n                if (normalizeto === '3nf') {\n                    $(\"#mainContent #newCols\").html(PMA_messages.strToNextStep);\n                    setTimeout(function() {\n                        goTo3NFStep1([PMA_commonParams.get('table')]);\n                    }, 3000);\n                }\n            }\n        });\n}\n\nfunction goToFinish1NF()\n{\n    if (normalizeto !== '1nf') {\n        goTo2NFStep1();\n        return true;\n    }\n    $(\"#mainContent legend\").html(PMA_messages.strEndStep);\n    $(\"#mainContent h4\").html(\n        \"<h3>\" + PMA_sprintf(PMA_messages.strFinishMsg, escapeHtml(PMA_commonParams.get('table'))) + \"</h3>\"\n    );\n    $(\"#mainContent p\").html('');\n    $(\"#mainContent #extra\").html('');\n    $(\"#mainContent #newCols\").html('');\n    $('.tblFooters').html('');\n}\n\nfunction goToStep4()\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step4\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            for(var pk in primary_key) {\n                $(\"#extra input[value='\" + primary_key[pk] + \"']\").attr(\"disabled\",\"disabled\");\n            }\n        }\n    );\n}\n\nfunction goToStep3()\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step3\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra\").html(data.extra);\n            $(\"#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            primary_key = $.parseJSON(data.primary_key);\n            for(var pk in primary_key) {\n                $(\"#extra input[value='\" + primary_key[pk] + \"']\").attr(\"disabled\",\"disabled\");\n            }\n        }\n    );\n}\n\nfunction goToStep2(extra)\n{\n    $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"step2\": true\n        }, function(data) {\n            $(\"#mainContent legend\").html(data.legendText);\n            $(\"#mainContent h4\").html(data.headText);\n            $(\"#mainContent p\").html(data.subText);\n            $(\"#mainContent #extra,#mainContent #newCols\").html('');\n            $('.tblFooters').html('');\n            if (data.hasPrimaryKey === \"1\") {\n                if(extra === 'goToStep3') {\n                    $(\"#mainContent h4\").html(PMA_messages.strPrimaryKeyAdded);\n                    $(\"#mainContent p\").html(PMA_messages.strToNextStep);\n                }\n                if(extra === 'goToFinish1NF') {\n                    goToFinish1NF();\n                } else {\n                    setTimeout(function() {\n                        goToStep3();\n                    }, 3000);\n                }\n            } else {\n                //form to select columns to make primary\n                $(\"#mainContent #extra\").html(data.extra);\n            }\n        }\n    );\n}\n\nfunction goTo2NFFinish(pd)\n{\n    var tables = {};\n    for (var dependson in pd) {\n        tables[dependson] = $('#extra input[name=\"' + dependson + '\"]').val();\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"pd\": JSON.stringify(pd),\n            \"newTablesName\":JSON.stringify(tables),\n            \"createNewTables2NF\":1};\n    $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    if(data.queryError === false) {\n                        if (normalizeto === '3nf') {\n                            $(\"#pma_navigation_reload\").click();\n                            goTo3NFStep1(tables);\n                            return true;\n                        }\n                        $(\"#mainContent legend\").html(data.legendText);\n                        $(\"#mainContent h4\").html(data.headText);\n                        $(\"#mainContent p\").html('');\n                        $(\"#mainContent #extra\").html('');\n                        $('.tblFooters').html('');\n                    } else {\n                        PMA_ajaxShowMessage(data.extra, false);\n                    }\n                    $(\"#pma_navigation_reload\").click();\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n}\n\nfunction goTo3NFFinish(newTables)\n{\n    for (var table in newTables) {\n        for (var newtbl in newTables[table]) {\n            var updatedname = $('#extra input[name=\"' + newtbl + '\"]').val();\n            newTables[table][updatedname] = newTables[table][newtbl];\n            if (updatedname !== newtbl) {\n                delete newTables[table][newtbl];\n            }\n        }\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"newTables\":JSON.stringify(newTables),\n            \"createNewTables3NF\":1};\n    $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    if(data.queryError === false) {\n                        $(\"#mainContent legend\").html(data.legendText);\n                        $(\"#mainContent h4\").html(data.headText);\n                        $(\"#mainContent p\").html('');\n                        $(\"#mainContent #extra\").html('');\n                        $('.tblFooters').html('');\n                    } else {\n                        PMA_ajaxShowMessage(data.extra, false);\n                    }\n                    $(\"#pma_navigation_reload\").click();\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n}\nvar backup = '';\nfunction goTo2NFStep2(pd, primary_key)\n{\n    $(\"#newCols\").html('');\n    $(\"#mainContent legend\").html(PMA_messages.strStep + ' 2.2 ' + PMA_messages.strConfirmPd);\n    $(\"#mainContent h4\").html(PMA_messages.strSelectedPd);\n    $(\"#mainContent p\").html(PMA_messages.strPdHintNote);\n    var extra = '<div class=\"dependencies_box\">';\n    var pdFound = false;\n    for (var dependson in pd) {\n        if (dependson !== primary_key) {\n            pdFound = true;\n            extra += '<p class=\"displayblock desc\">' + escapeHtml(dependson) + \" -> \" + escapeHtml(pd[dependson].toString()) + '</p>';\n        }\n    }\n    if(!pdFound) {\n        extra += '<p class=\"displayblock desc\">' + PMA_messages.strNoPdSelected + '</p>';\n        extra += '</div>';\n    } else {\n        extra += '</div>';\n        datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"pd\": JSON.stringify(pd),\n            \"getNewTables2NF\":1};\n        $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                if (data.success === true) {\n                    extra += data.message;\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n    }\n    $(\"#mainContent #extra\").html(extra);\n    $('.tblFooters').html('<input type=\"button\" value=\"' + PMA_messages.strBack + '\" id=\"backEditPd\"/><input type=\"button\" id=\"goTo2NFFinish\" value=\"' + PMA_messages.strGo + '\"/>');\n    $(\"#goTo2NFFinish\").click(function(){\n        goTo2NFFinish(pd);\n    });\n}\n\nfunction goTo3NFStep2(pd, tablesTds)\n{\n    $(\"#newCols\").html('');\n    $(\"#mainContent legend\").html(PMA_messages.strStep + ' 3.2 ' + PMA_messages.strConfirmTd);\n    $(\"#mainContent h4\").html(PMA_messages.strSelectedTd);\n    $(\"#mainContent p\").html(PMA_messages.strPdHintNote);\n    var extra = '<div class=\"dependencies_box\">';\n    var pdFound = false;\n    for (var table in tablesTds) {\n        for (var i in tablesTds[table]) {\n            dependson = tablesTds[table][i];\n            if (dependson !== '' && dependson !== table) {\n                pdFound = true;\n                extra += '<p class=\"displayblock desc\">' + escapeHtml(dependson) + \" -> \" + escapeHtml(pd[dependson].toString()) + '</p>';\n            }\n        }\n    }\n    if(!pdFound) {\n        extra += '<p class=\"displayblock desc\">' + PMA_messages.strNoTdSelected + '</p>';\n        extra += '</div>';\n    } else {\n        extra += '</div>';\n        datastring = {\"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"tables\": JSON.stringify(tablesTds),\n            \"pd\": JSON.stringify(pd),\n            \"getNewTables3NF\":1};\n        $.ajax({\n            type: \"GET\",\n            url: \"normalization.php\",\n            data: datastring,\n            async:false,\n            success: function(data) {\n                data_parsed = $.parseJSON(data.message);\n                if (data.success === true) {\n                    extra += data_parsed.html;\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        });\n    }\n    $(\"#mainContent #extra\").html(extra);\n    $('.tblFooters').html('<input type=\"button\" value=\"' + PMA_messages.strBack + '\" id=\"backEditPd\"/><input type=\"button\" id=\"goTo3NFFinish\" value=\"' + PMA_messages.strGo + '\"/>');\n    $(\"#goTo3NFFinish\").click(function(){\n        if (!pdFound) {\n            goTo3NFFinish([]);\n        } else {\n            goTo3NFFinish(data_parsed.newTables);\n        }\n    });\n}\nfunction processDependencies(primary_key, isTransitive)\n{\n    var pd = {};\n    var tablesTds = {};\n    var dependsOn;\n    pd[primary_key] = [];\n    $(\"#extra form\").each(function() {\n        var tblname;\n        if (isTransitive === true) {\n            tblname = $(this).data('tablename');\n            primary_key = tblname;\n            if (!(tblname in tablesTds)) {\n                tablesTds[tblname] = [];\n            }\n            tablesTds[tblname].push(primary_key);\n        }\n        var form_id = $(this).attr('id');\n        $('#' + form_id + ' input[type=checkbox]:not(:checked)').removeAttr('checked');\n        dependsOn = '';\n        $('#' + form_id + ' input[type=checkbox]:checked').each(function(){\n            dependsOn += $(this).val() + ', ';\n            $(this).attr(\"checked\",\"checked\");\n        });\n        if (dependsOn === '') {\n            dependsOn = primary_key;\n        } else {\n            dependsOn = dependsOn.slice(0, -2);\n        }\n        if (! (dependsOn in pd)) {\n            pd[dependsOn] = [];\n        }\n        pd[dependsOn].push($(this).data('colname'));\n        if (isTransitive === true) {\n            if (!(tblname in tablesTds)) {\n                tablesTds[tblname] = [];\n            }\n            if ($.inArray(dependsOn, tablesTds[tblname]) === -1) {\n                tablesTds[tblname].push(dependsOn);\n            }\n        }\n    });\n    backup = $(\"#mainContent\").html();\n    if (isTransitive === true) {\n        goTo3NFStep2(pd, tablesTds);\n    } else {\n        goTo2NFStep2(pd, primary_key);\n    }\n    return false;\n}\n\nfunction moveRepeatingGroup(repeatingCols) {\n    var newTable = $(\"input[name=repeatGroupTable]\").val();\n    var newColumn = $(\"input[name=repeatGroupColumn]\").val();\n    if (!newTable) {\n        $(\"input[name=repeatGroupTable]\").focus();\n        return false;\n    }\n    if (!newColumn) {\n        $(\"input[name=repeatGroupColumn]\").focus();\n        return false;\n    }\n    datastring = {\"token\": PMA_commonParams.get('token'),\n        \"ajax_request\": true,\n        \"db\": PMA_commonParams.get('db'),\n        \"table\": PMA_commonParams.get('table'),\n        \"repeatingColumns\": repeatingCols,\n        \"newTable\":newTable,\n        \"newColumn\":newColumn,\n        \"primary_columns\":primary_key.toString()\n    };\n    $.ajax({\n        type: \"POST\",\n        url: \"normalization.php\",\n        data: datastring,\n        async:false,\n        success: function(data) {\n            if (data.success === true) {\n                if(data.queryError === false) {\n                    goToStep3();\n                }\n                PMA_ajaxShowMessage(data.message, false);\n                $(\"#pma_navigation_reload\").click();\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        }\n    });\n}\nAJAX.registerTeardown('normalization.js', function () {\n    $(\"#extra\").off(\"click\", \"#selectNonAtomicCol\");\n    $(\"#splitGo\").unbind('click');\n    $('.tblFooters').off(\"click\", \"#saveSplit\");\n    $(\"#extra\").off(\"click\", \"#addNewPrimary\");\n    $(\".tblFooters\").off(\"click\", \"#saveNewPrimary\");\n    $(\"#extra\").off(\"click\", \"#removeRedundant\");\n    $(\"#mainContent p\").off(\"click\", \"#createPrimaryKey\");\n    $(\"#mainContent\").off(\"click\", \"#backEditPd\");\n    $(\"#mainContent\").off(\"click\", \"#showPossiblePd\");\n    $(\"#mainContent\").off(\"click\", \".pickPd\");\n});\n\nAJAX.registerOnload('normalization.js', function() {\n    var selectedCol;\n    normalizeto = $(\"#mainContent\").data('normalizeto');\n    $(\"#extra\").on(\"click\", \"#selectNonAtomicCol\", function() {\n        if ($(this).val() === 'no_such_col') {\n            goToStep2();\n        } else {\n            selectedCol = $(this).val();\n        }\n    });\n\n    $(\"#splitGo\").click(function() {\n        if(!selectedCol || selectedCol === '') {\n            return false;\n        }\n        var numField = $(\"#numField\").val();\n        $.get(\n            \"normalization.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"splitColumn\": true,\n                \"numFields\": numField\n            },\n        function(data) {\n                if (data.success === true) {\n                    $('#newCols').html(data.message);\n                    $('.default_value').hide();\n                    $('.enum_notice').hide();\n                    $('.tblFooters').html(\"<input type='submit' id='saveSplit' value='\" + PMA_messages.strSave + \"'/>\" +\n                        \"<input type='submit' id='cancelSplit' value='\" + PMA_messages.strCancel + \"' \" +\n                        \"onclick=\\\"$('#newCols').html('');$(this).parent().html('')\\\"/>\");\n                }\n            }\n        );\n        return false;\n    });\n    $('.tblFooters').on(\"click\",\"#saveSplit\", function() {\n        central_column_list = [];\n        if ($(\"#newCols #field_0_1\").val() === '') {\n            $(\"#newCols #field_0_1\").focus();\n            return false;\n        }\n        datastring = $('#newCols :input').serialize();\n        datastring += \"&ajax_request=1&do_save_data=1&field_where=last\";\n        $.post(\"tbl_addfield.php\", datastring, function(data) {\n            if (data.success) {\n                $.get(\n                    \"sql.php\",\n                    {\n                        \"token\": PMA_commonParams.get('token'),\n                        \"ajax_request\": true,\n                        \"db\": PMA_commonParams.get('db'),\n                        \"table\": PMA_commonParams.get('table'),\n                        \"dropped_column\": selectedCol,\n                        \"purge\" : 1,\n                        \"sql_query\": 'ALTER TABLE `' + PMA_commonParams.get('table') + '` DROP `' + selectedCol + '`;',\n                        \"is_js_confirmed\": 1\n                    },\n                function(data) {\n                        if (data.success === true) {\n                            appendHtmlColumnsList();\n                            $('#newCols').html('');\n                            $('.tblFooters').html('');\n                        } else {\n                            PMA_ajaxShowMessage(data.error, false);\n                        }\n                        selectedCol = '';\n                    }\n                );\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        });\n    });\n\n    $(\"#extra\").on(\"click\", \"#addNewPrimary\", function() {\n        $.get(\n            \"normalization.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"addNewPrimary\": true\n            },\n        function(data) {\n                if (data.success === true) {\n                    $('#newCols').html(data.message);\n                    $('.default_value').hide();\n                    $('.enum_notice').hide();\n                    $('.tblFooters').html(\"<input type='submit' id='saveNewPrimary' value='\" + PMA_messages.strSave + \"'/>\" +\n                        \"<input type='submit' id='cancelSplit' value='\" + PMA_messages.strCancel + \"' \" +\n                        \"onclick=\\\"$('#newCols').html('');$(this).parent().html('')\\\"/>\");\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        );\n        return false;\n    });\n    $(\".tblFooters\").on(\"click\", \"#saveNewPrimary\", function() {\n        var datastring = $('#newCols :input').serialize();\n        datastring += \"&field_key[0]=primary_0&ajax_request=1&do_save_data=1&field_where=last\";\n        $.post(\"tbl_addfield.php\", datastring, function(data) {\n            if (data.success === true) {\n                $(\"#mainContent h4\").html(PMA_messages.strPrimaryKeyAdded);\n                $(\"#mainContent p\").html(PMA_messages.strToNextStep);\n                $(\"#mainContent #extra\").html('');\n                $(\"#mainContent #newCols\").html('');\n                $('.tblFooters').html('');\n                setTimeout(function() {\n                    goToStep3();\n                }, 2000);\n            } else {\n                PMA_ajaxShowMessage(data.error, false);\n            }\n        });\n    });\n    $(\"#extra\").on(\"click\", \"#removeRedundant\", function() {\n        var dropQuery = 'ALTER TABLE `' + PMA_commonParams.get('table') + '` ';\n        $(\"#extra input[type=checkbox]:checked\").each(function() {\n            dropQuery += 'DROP `' + $(this).val() + '`, ';\n        });\n        dropQuery = dropQuery.slice(0, -2);\n        $.get(\n            \"sql.php\",\n            {\n                \"token\": PMA_commonParams.get('token'),\n                \"ajax_request\": true,\n                \"db\": PMA_commonParams.get('db'),\n                \"table\": PMA_commonParams.get('table'),\n                \"sql_query\": dropQuery,\n                \"is_js_confirmed\": 1\n            },\n        function(data) {\n                if (data.success === true) {\n                    goToStep2('goToFinish1NF');\n                } else {\n                    PMA_ajaxShowMessage(data.error, false);\n                }\n            }\n        );\n    });\n    $(\"#extra\").on(\"click\", \"#moveRepeatingGroup\", function() {\n        var repeatingCols = '';\n        $(\"#extra input[type=checkbox]:checked\").each(function() {\n            repeatingCols += $(this).val() + ', ';\n        });\n\n        if (repeatingCols !== '') {\n            var newColName = $(\"#extra input[type=checkbox]:checked:first\").val();\n            repeatingCols = repeatingCols.slice(0, -2);\n            var confirmStr = PMA_sprintf(PMA_messages.strMoveRepeatingGroup, escapeHtml(repeatingCols), escapeHtml(PMA_commonParams.get('table')));\n            confirmStr += '<input type=\"text\" name=\"repeatGroupTable\" placeholder=\"' + PMA_messages.strNewTablePlaceholder + '\"/>' +\n                '( ' + escapeHtml(primary_key.toString()) + ', <input type=\"text\" name=\"repeatGroupColumn\" placeholder=\"' + PMA_messages.strNewColumnPlaceholder + '\" value=\"' + escapeHtml(newColName) + '\">)' +\n                '</ol>';\n            $(\"#newCols\").html(confirmStr);\n            $('.tblFooters').html('<input type=\"submit\" value=\"' + PMA_messages.strCancel + '\" onclick=\"$(\\'#newCols\\').html(\\'\\');$(\\'#extra input[type=checkbox]\\').removeAttr(\\'checked\\')\"/>' +\n                '<input type=\"submit\" value=\"' + PMA_messages.strGo + '\" onclick=\"moveRepeatingGroup(\\'' + repeatingCols + '\\')\"/>');\n        }\n    });\n    $(\"#mainContent p\").on(\"click\", \"#createPrimaryKey\", function(event) {\n        event.preventDefault();\n        var url = { create_index: 1,\n            server:  PMA_commonParams.get('server'),\n            db: PMA_commonParams.get('db'),\n            table: PMA_commonParams.get('table'),\n            token: PMA_commonParams.get('token'),\n            added_fields: 1,\n            add_fields:1,\n            index: {Key_name:'PRIMARY'},\n            ajax_request: true\n        };\n        var title = PMA_messages.strAddPrimaryKey;\n        indexEditorDialog(url, title, function(){\n            //on success\n            $(\".sqlqueryresults\").remove();\n            $('.result_query').remove();\n            $('.tblFooters').html('');\n            goToStep2('goToStep3');\n        });\n        return false;\n    });\n    $(\"#mainContent\").on(\"click\", \"#backEditPd\", function(){\n        $(\"#mainContent\").html(backup);\n    });\n    $(\"#mainContent\").on(\"click\", \"#showPossiblePd\", function(){\n        if($(this).hasClass('hideList')) {\n            $(this).html('+ ' + PMA_messages.strShowPossiblePd);\n            $(this).removeClass('hideList');\n            $(\"#newCols\").slideToggle(\"slow\");\n            return false;\n        }\n        if($(\"#newCols\").html() !== '') {\n            $(\"#showPossiblePd\").html('- ' + PMA_messages.strHidePd);\n            $(\"#showPossiblePd\").addClass('hideList');\n            $(\"#newCols\").slideToggle(\"slow\");\n            return false;\n        }\n        $(\"#newCols\").insertAfter(\"#mainContent h4\");\n        $(\"#newCols\").html('<div class=\"center\">' + PMA_messages.strLoading + '<br/>' + PMA_messages.strWaitForPd + '</div>');\n        $.post(\n        \"normalization.php\",\n        {\n            \"token\": PMA_commonParams.get('token'),\n            \"ajax_request\": true,\n            \"db\": PMA_commonParams.get('db'),\n            \"table\": PMA_commonParams.get('table'),\n            \"findPdl\": true\n        }, function(data) {\n            $(\"#showPossiblePd\").html('- ' + PMA_messages.strHidePd);\n            $(\"#showPossiblePd\").addClass('hideList');\n            $(\"#newCols\").html(data.message);\n        });\n    });\n    $(\"#mainContent\").on(\"click\", \".pickPd\", function(){\n        var strColsLeft = $(this).next('.determinants').html();\n        var colsLeft = strColsLeft.split(',');\n        var strColsRight = $(this).next().next().html();\n        var colsRight = strColsRight.split(',');\n        for (var i in colsRight) {\n            $('form[data-colname=\"' + colsRight[i].trim() + '\"] input[type=\"checkbox\"]').prop('checked', false);\n            for (var j in colsLeft) {\n                $('form[data-colname=\"' + colsRight[i].trim() + '\"] input[value=\"' + colsLeft[j].trim() + '\"]').prop('checked', true);\n            }\n        }\n    });\n});\n"], "filenames": ["js/normalization.js"], "buggy_code_start_loc": [105], "buggy_code_end_loc": [106], "fixing_code_start_loc": [105], "fixing_code_end_loc": [106], "type": "CWE-79", "message": "Cross-site scripting (XSS) vulnerability in the goToFinish1NF function in js/normalization.js in phpMyAdmin 4.4.x before 4.4.15.3 and 4.5.x before 4.5.4 allows remote authenticated users to inject arbitrary web script or HTML via a table name to the normalization page.", "other": {"cve": {"id": "CVE-2016-2043", "sourceIdentifier": "cve@mitre.org", "published": "2016-02-20T01:59:06.453", "lastModified": "2018-10-30T16:27:35.843", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site scripting (XSS) vulnerability in the goToFinish1NF function in js/normalization.js in phpMyAdmin 4.4.x before 4.4.15.3 and 4.5.x before 4.5.4 allows remote authenticated users to inject arbitrary web script or HTML via a table name to the normalization page."}, {"lang": "es", "value": "Vulnerabilidad de XSS en la funci\u00f3n goToFinish1NF en js/normalization.js en phpMyAdmin 4.4.x en versiones anteriores a 4.4.15.3 y 4.5.x en versiones anteriores a 4.5.4 permite a usuarios remotos autenticados inyectar secuencias de comandos web o HTML arbitrarios a trav\u00e9s de un nombre de tabla en la p\u00e1gina de normalizaci\u00f3n."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:22:*:*:*:*:*:*:*", "matchCriteriaId": "253C303A-E577-4488-93E6-68A8DD942C38"}, {"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:23:*:*:*:*:*:*:*", "matchCriteriaId": "E79AB8DD-C907-4038-A931-1A5A4CFB6A5B"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:opensuse:leap:42.1:*:*:*:*:*:*:*", "matchCriteriaId": "4863BE36-D16A-4D75-90D9-FD76DB5B48B7"}, {"vulnerable": true, "criteria": "cpe:2.3:o:opensuse:opensuse:13.1:*:*:*:*:*:*:*", "matchCriteriaId": "A10BC294-9196-425F-9FB0-B1625465B47F"}, {"vulnerable": true, "criteria": "cpe:2.3:o:opensuse:opensuse:13.2:*:*:*:*:*:*:*", "matchCriteriaId": "03117DF1-3BEC-4B8D-AD63-DBBDB2126081"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.1:*:*:*:*:*:*:*", "matchCriteriaId": "DFF55485-9892-4E7B-AEE0-017E61EAA7C0"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.1.1:*:*:*:*:*:*:*", "matchCriteriaId": "6100FE3E-0A31-4B55-90F2-90AF765A8EB7"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.2:*:*:*:*:*:*:*", "matchCriteriaId": "FBAAC8D9-AAA5-487C-B4AA-84BAE5DB109E"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.3:*:*:*:*:*:*:*", "matchCriteriaId": "5E06B1D3-29B4-45B7-B81F-C864AF579011"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.4:*:*:*:*:*:*:*", "matchCriteriaId": "6B2E3923-0E2B-411A-B091-088E6FF050D0"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.5:*:*:*:*:*:*:*", "matchCriteriaId": "1848C748-804D-4FE4-AB9C-B1BF9E58A19C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.6:*:*:*:*:*:*:*", "matchCriteriaId": "12296322-DFAD-4B36-83EC-D01BF5DF7F2A"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.6.1:*:*:*:*:*:*:*", "matchCriteriaId": "EA321C14-C8F4-41FC-B601-2F646064ABBF"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.7:*:*:*:*:*:*:*", "matchCriteriaId": "54DBCF86-0CE8-46C4-B2E7-E3224765CCFE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.8:*:*:*:*:*:*:*", "matchCriteriaId": "1BF3DBC5-7020-48D0-ADEA-E71776DB2285"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.9:*:*:*:*:*:*:*", "matchCriteriaId": "317F952E-5F12-4ED3-8FA3-FC1106B50F85"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.10:*:*:*:*:*:*:*", "matchCriteriaId": "87B97F98-C0A7-4D9E-8333-7EE9EC456A12"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.11:*:*:*:*:*:*:*", "matchCriteriaId": "7A1E753D-5653-4D7A-8E41-6C02511EBFCE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.12:*:*:*:*:*:*:*", "matchCriteriaId": "417230C7-0EC2-49F4-B810-A8AE84A302AD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.13:*:*:*:*:*:*:*", "matchCriteriaId": "103FEAB1-194E-4CEF-935A-4DBCCA298205"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.13.1:*:*:*:*:*:*:*", "matchCriteriaId": "C5814003-9FF8-4F8E-9D90-A2BBB80B8451"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.14.1:*:*:*:*:*:*:*", "matchCriteriaId": "16D28B77-9353-4259-9299-30638A78CCD4"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.15:*:*:*:*:*:*:*", "matchCriteriaId": "C022292B-6E06-4328-842F-135A872D22AF"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.15.1:*:*:*:*:*:*:*", "matchCriteriaId": "F15F00FB-BB9B-4D54-B198-0A74D418B8DE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.15.2:*:*:*:*:*:*:*", "matchCriteriaId": "DC10AF20-7B65-4FAE-A2AD-783867D60A8D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.4.15.3:*:*:*:*:*:*:*", "matchCriteriaId": "4EB7190C-0401-4E2E-B15F-4CFC79D5A4E7"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.0:*:*:*:*:*:*:*", "matchCriteriaId": "A4D7AAF1-64FF-40C9-90B2-DEC814157372"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.0.1:*:*:*:*:*:*:*", "matchCriteriaId": "96D529F5-8870-4934-BCD8-E49095D21224"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.0.2:*:*:*:*:*:*:*", "matchCriteriaId": "296EB2FA-FCAD-4BD5-A015-62765407AFE5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.1:*:*:*:*:*:*:*", "matchCriteriaId": "4DBD0DC7-64D0-42B1-8EEE-73A0214680F5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.2:*:*:*:*:*:*:*", "matchCriteriaId": "A6A15D1E-83ED-47EC-B17C-E6BCC49DE83D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:phpmyadmin:phpmyadmin:4.5.3:*:*:*:*:*:*:*", "matchCriteriaId": "4112ACFF-D40E-45BE-9307-F710E7B41ECD"}]}]}], "references": [{"url": "http://lists.fedoraproject.org/pipermail/package-announce/2016-February/176483.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "http://lists.fedoraproject.org/pipermail/package-announce/2016-February/176739.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "http://lists.opensuse.org/opensuse-updates/2016-02/msg00028.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "http://lists.opensuse.org/opensuse-updates/2016-02/msg00049.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "http://www.phpmyadmin.net/home_page/security/PMASA-2016-7.php", "source": "cve@mitre.org", "tags": ["Patch", "Vendor Advisory"]}, {"url": "https://github.com/phpmyadmin/phpmyadmin/commit/019c4f25d500ec5db9ba3b84cc961a7e4e850738", "source": "cve@mitre.org", "tags": ["Patch"]}]}, "github_commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/019c4f25d500ec5db9ba3b84cc961a7e4e850738"}}