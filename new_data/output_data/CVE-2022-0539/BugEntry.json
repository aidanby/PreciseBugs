{"buggy_code": ["<?php\r\n$servers = $console->getServers();\r\nif ($server) {\r\n    $serverKey = array_search($server, $servers);\r\n    $serverLabel = is_numeric($serverKey) || empty($serverKey) ? $server : $serverKey;\r\n}\r\n?><!DOCTYPE html>\r\n<html>\r\n\r\n    <head>\r\n        <meta charset=\"utf-8\">\r\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n\r\n        <title>\r\n            <?php if ($tube) echo $tube . ' - ' ?>\r\n            <?php echo $serverLabel ? $serverLabel : 'All servers' ?> -\r\n            Beanstalk console\r\n        </title>\r\n\r\n        <!-- Bootstrap core CSS -->\r\n        <link href=\"assets/vendor/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n        <link href=\"css/customer.css\" rel=\"stylesheet\">\r\n        <link href=\"highlight/styles/magula.css\" rel=\"stylesheet\">\r\n        <link rel=\"shortcut icon\" href=\"assets/favicon.ico\">\r\n        <script>\r\n            var url = \"./?server=<?php echo $server ?>\";\r\n            var contentType = \"<?php echo isset($contentType) ? $contentType : '' ?>\";\r\n        </script>\r\n\r\n        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->\r\n        <!--[if lt IE 9]>\r\n        <script src=\"https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js\"></script>\r\n        <script src=\"https://oss.maxcdn.com/respond/1.4.2/respond.min.js\"></script>\r\n        <![endif]-->\r\n    </head>\r\n\r\n    <?php if (!empty($servers)): ?>\r\n        <body>\r\n        <?php else: ?>\r\n        <body class=\"no-nav\">\r\n        <?php endif ?>\r\n\r\n        <?php if (!empty($servers)): ?>\r\n            <div class=\"navbar navbar-fixed-top navbar-default\" role=\"navigation\">\r\n                <div class=\"container\">\r\n                    <div class=\"navbar-header\">\r\n                        <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\r\n                            <span class=\"sr-only\">Toggle navigation</span>\r\n                            <span class=\"icon-bar\"></span>\r\n                            <span class=\"icon-bar\"></span>\r\n                            <span class=\"icon-bar\"></span>\r\n                        </button>\r\n                        <a class=\"navbar-brand\" href=\"./?\">Beanstalk console</a>\r\n                    </div>\r\n                    <div class=\"collapse navbar-collapse\">\r\n                        <ul class=\"nav navbar-nav\">\r\n\r\n                            <?php if ($server): ?>\r\n                                <!-- Server dropdown: current, then All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        <?php echo $serverLabel ?> <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a href=\"./?\">All servers</a></li>\r\n                                        <?php foreach (array_diff($servers, array($server)) as $key => $serverItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $serverItem ?>\"><?php echo empty($key) || is_numeric($key) ? $serverItem : $key ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php else: ?>\r\n                                <!-- Server dropdown: All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        All servers <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <?php foreach ($servers as $key => $serverItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $serverItem ?>\"><?php echo empty($key) || is_numeric($key) ? $serverItem : $key ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php endif ?>\r\n\r\n                            <?php if ($tube): ?>\r\n                                <!-- Tube dropdown: current, then All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        <?php echo $tube ?> <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a href=\"./?server=<?php echo $server ?>\">All Tubes</a></li>\r\n                                        <?php foreach (array_diff($tubes, array($tube)) as $tubeItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $server ?>&tube=<?php echo urlencode($tubeItem) ?>\"><?php echo $tubeItem ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php elseif (isset($tubes)): ?>\r\n                                <!-- Tube dropdown: All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        All tubes <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <?php foreach ($tubes as $tubeItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $server ?>&tube=<?php echo urlencode($tubeItem) ?>\"><?php echo $tubeItem ?></a></li>\r\n                                        <?php endforeach; ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php endif ?>\r\n                        </ul>\r\n\r\n                        <ul class=\"nav navbar-nav navbar-right\">\r\n                            <li class=\"dropdown\">\r\n                                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" style=\"padding:4px !important;\"><img src=\"assets/hamburger.png\" width=\"32px\" height=\"32px\"></a>\r\n                                <ul class=\"dropdown-menu\" role=\"menu\">\r\n                                    <?php if (!isset($_tplPage) && !$server) { ?>\r\n                                        <li><a href=\"#filterServer\" role=\"button\" data-toggle=\"modal\">Filter columns</a></li>\r\n                                        <?php\r\n                                    } elseif (!isset($_tplPage) && $server) {\r\n                                        ?>\r\n                                        <li><a href=\"#filter\" role=\"button\" data-toggle=\"modal\">Filter columns</a></li>\r\n                                        <?php\r\n                                    }\r\n                                    if ($server && !$tube) {\r\n                                        ?>\r\n                                        <li><a href=\"#clear-tubes\" role=\"button\" data-toggle=\"modal\">Clear multiple tubes</a></li>\r\n                                    <?php } ?>\r\n                                    <li><a href=\"./?action=manageSamples\" role=\"button\">Manage samples</a></li>\r\n                                    <li class=\"divider\"></li>\r\n                                    <li><a href=\"https://github.com/kr/beanstalkd\">Beanstalk (github)</a></li>\r\n                                    <li><a href=\"https://github.com/kr/beanstalkd/blob/master/doc/protocol.txt\">Protocol Specification</a></li>\r\n                                    <li><a href=\"https://github.com/ptrofimov/beanstalk_console\">Beanstalk console (github)</a></li>\r\n                                    <li class=\"divider\"></li>\r\n                                    <li><a href=\"#settings\" role=\"button\" data-toggle=\"modal\">Edit settings</a></li>\r\n                                </ul>\r\n                            </li>\r\n                            <?php if (@$config['auth']['enabled']) { ?>\r\n                                <li class=\"dropdown\">\r\n                                    <a target=\"_blank\" href=\"./?logout=true\">logout <span class=\"glyphicon glyphicon-log-out\" aria-hidden=\"true\"></span></a>\r\n                                </li>\r\n                            <?php } ?>\r\n                            <?php if ($server && !$tube) { ?>\r\n                                <li>\r\n                                    <button type=\"button\" id=\"autoRefresh\" class=\"btn btn-default btn-small\">\r\n                                        <span class=\"glyphicon glyphicon-refresh\"></span>\r\n                                    </button>\r\n                                </li>\r\n                            <?php } else if (!$tube) { ?>\r\n                                <li>\r\n                                    <button type=\"button\" id=\"autoRefreshSummary\" class=\"btn btn-default btn-small\">\r\n                                        <span class=\"glyphicon glyphicon-refresh\"></span>\r\n                                    </button>\r\n                                </li>\r\n                            <?php } ?>\r\n                        </ul>\r\n                        <?php if (isset($server, $tube) && $server && $tube) { ?>\r\n                            <form  class=\"navbar-form navbar-right\" style=\"margin-top:5px;margin-bottom:0px;\" role=\"search\" action=\"\" method=\"get\">\r\n                                <input type=\"hidden\" name=\"server\" value=\"<?php echo $server; ?>\"/>\r\n                                <input type=\"hidden\" name=\"tube\" value=\"<?php echo urlencode($tube); ?>\"/>\r\n                                <input type=\"hidden\" name=\"state\" value=\"<?php echo $state; ?>\"/>\r\n                                <input type=\"hidden\" name=\"action\" value=\"search\"/>\r\n                                <input type=\"hidden\" name=\"limit\" value=\"<?php echo empty($_COOKIE['searchResultLimit']) ? 25 : $_COOKIE['searchResultLimit']; ?>\"/>\r\n                                <div class=\"form-group\">\r\n                                    <input type=\"text\" class=\"form-control input-sm search-query\" name=\"searchStr\" placeholder=\"Search this tube\">\r\n                                </div>\r\n                            </form>\r\n                        <?php } ?>\r\n                    </div>\r\n                    <!--/.nav-collapse -->\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"container\">\r\n            <?php endif ?>\r\n\r\n            <?php if (!empty($errors)): ?>\r\n                <?php foreach ($errors as $item): ?>\r\n                    <p class=\"alert alert-error\"><span class=\"label label-important\">Error</span> <?php echo $item ?></p>\r\n                <?php endforeach; ?>\r\n            <?php else: ?>\r\n                <?php if (isset($_tplPage)): ?>\r\n                    <?php include(dirname(__FILE__) . '/' . $_tplPage . '.php') ?>\r\n                <?php elseif (!$server): ?>\r\n                    <div id=\"idServers\">\r\n                        <?php\r\n                        include(dirname(__FILE__) . '/serversList.php');\r\n                        ?>\r\n                    </div>\r\n                    <div id=\"idServersCopy\" style=\"display:none\"></div>\r\n                    <?php\r\n                    if ($tplVars['_tplMain'] != 'ajax') {\r\n                        require_once dirname(__FILE__) . '/modalAddServer.php';\r\n                        require_once dirname(__FILE__) . '/modalFilterServer.php';\r\n                    }\r\n                    ?>\r\n                <?php elseif (!$tube):\r\n                    ?>\r\n                    <div id=\"idAllTubes\">\r\n                        <?php require_once dirname(__FILE__) . '/allTubes.php'; ?>\r\n                        <?php require_once dirname(__FILE__) . '/modalClearTubes.php'; ?>\r\n                    </div>\r\n                    <div id='idAllTubesCopy' style=\"display:none\"></div>\r\n                <?php elseif (!in_array($tube, $tubes)):\r\n                    ?>\r\n                    <?php echo sprintf('Tube \"%s\" not found or it is empty', $tube) ?>\r\n                    <br><br><a href=\"./?server=<?php echo $server ?>\"> << back </a>\r\n                <?php else:\r\n                    ?>\r\n                    <?php require_once dirname(__FILE__) . '/currentTube.php'; ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalAddJob.php'; ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalAddSample.php'; ?>\r\n                <?php endif; ?>\r\n                <?php if (!isset($_tplPage)) { ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalFilterColumns.php'; ?>\r\n                <?php } ?>\r\n                <?php require_once dirname(__FILE__) . '/modalSettings.php'; ?>\r\n            <?php endif; ?>\r\n        </div>\r\n\r\n        <script src='assets/vendor/jquery/jquery.js'></script>\r\n        <script src=\"js/jquery.color.js\"></script>\r\n        <script src=\"js/jquery.cookie.js\"></script>\r\n        <script src=\"js/jquery.regexp.js\"></script>\r\n        <script src=\"assets/vendor/bootstrap/js/bootstrap.min.js\"></script>\r\n        <?php if (isset($_COOKIE['isDisabledJobDataHighlight']) and $_COOKIE['isDisabledJobDataHighlight'] != 1) { ?>\r\n            <script src=\"highlight/highlight.pack.js\"></script>\r\n            <script>hljs.initHighlightingOnLoad();</script><?php } ?>\r\n        <script src=\"js/customer.js\"></script>\r\n    </body>\r\n</html>\r\n", "<?php\r\n$servers = $console->getServers();\r\n$cookieServers = $console->getServersCookie();\r\n\r\nif (!empty($_COOKIE['filter'])) {\r\n    $visible = explode(',', $_COOKIE['filter']);\r\n} else {\r\n    $visible = array(\r\n        'current-jobs-urgent',\r\n        'current-jobs-ready',\r\n        'current-jobs-reserved',\r\n        'current-jobs-delayed',\r\n        'current-jobs-buried',\r\n        'current-tubes',\r\n        'current-connections',\r\n    );\r\n}\r\n?>\r\n<?php\r\nif (!empty($servers)):\r\n    $servers = array_filter(array_unique($servers));\r\n    ?>\r\n    <div class=\"row\">\r\n        <div class=\"col-sm-12\">\r\n            <table class=\"table table-striped table-hover\" id=\"servers-index\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>name</th>\r\n                        <?php foreach ($console->getServerStats(current($servers)) as $key => $item): ?>\r\n                            <th class=\"<?php if (!in_array($key, $visible)) echo 'hide' ?>\" name=\"<?php echo $key ?>\"\r\n                                title=\"<?php echo $item['description'] ?>\"><?php echo $key ?></th>\r\n                            <?php endforeach ?>\r\n                        <th>&nbsp;</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <?php\r\n                    foreach ($servers as $key => $server):\r\n                        $stats = $console->getServerStats($server);\r\n                        $label = $key;\r\n                        if (empty($label) || is_numeric($label)) {\r\n                            $label = $server;\r\n                        }\r\n                        ?>\r\n                        <tr>\r\n                            <?php if (empty($stats)): ?>\r\n                                <td style=\"white-space: nowrap;\"><?php echo $label ?></td>\r\n                            <?php else: ?>\r\n                                <td  style=\"white-space: nowrap;\"><a href=\"./?server=<?php echo $server ?>\"><?php echo $label; ?></a></td>\r\n                            <?php endif ?>\r\n                            <?php foreach ($stats as $key => $item): ?>\r\n                                <?php\r\n                                $classes = array(\"td-$key\");\r\n                                if (!in_array($key, $visible)) {\r\n                                    $classes[] = 'hide' ;\r\n                                }\r\n                                if (isset($stats[$key]) && $stats[$key] != '0') {\r\n                                    $classes[] = 'hasValue';\r\n                                }\r\n                                $cssClass = '' ;\r\n                                if (count($classes) > 0) {\r\n                                    $cssClass = ' class = \"' . join(' ', $classes) . '\"' ;\r\n                                }\r\n                                ?>\r\n                                <td <?php echo $cssClass; ?>\r\n                                    name=\"<?php echo $key ?>\"><?php echo htmlspecialchars($item['value']) ?></td>\r\n                                <?php endforeach ?>\r\n                                <?php if (empty($stats)): ?>\r\n                                <td colspan=\"<?php echo count($visible) ?>\" class=\"row-full\">&nbsp;</td>\r\n                            <?php endif ?>\r\n                            <td><?php if (array_intersect(array($server), $cookieServers)): ?>\r\n                                    <a class=\"btn btn-xs btn-danger\" title=\"Remove from list\" href=\"./?action=serversRemove&removeServer=<?php echo $server ?>\"><span\r\n                                            class=\"glyphicon glyphicon-minus\"></span></a>\r\n                                    <?php endif; ?>\r\n                            </td>\r\n                        </tr>\r\n                    <?php endforeach ?>\r\n                </tbody>\r\n            </table>\r\n            <a href=\"#servers-add\" role=\"button\" class=\"btn btn-info\" id=\"addServer\">Add server</a>\r\n        </div>\r\n    </div>\r\n<?php else: ?>\r\n    <div class=\"site-wrapper\">\r\n        <div class=\"site-wrapper-inner\">\r\n            <div class=\"col-sm-8 col-sm-push-2 text-center\">\r\n                <h1>Hello!</h1>\r\n\r\n                <p class=\"lead\">\r\n                    This is Beanstalk console,<br/>web-interface for\r\n                    <a href=\"http://kr.github.io/beanstalkd/\" target=\"_blank\">simple and fast work queue</a>\r\n                </p>\r\n\r\n                <p>\r\n                    Your servers' list is empty. You could fix it in two ways:\r\n                <ol class=\"inside\">\r\n                    <li>Click the button below to add server just for you and save it in cookies</li>\r\n                    <li>Edit <b>config.php</b> file and add server for everybody</li>\r\n                </ol>\r\n                </p>\r\n                <p>\r\n                    <br/><a href=\"#servers-add\" role=\"button\" class=\"btn btn-lg btn-success\" data-toggle=\"modal\">Add server</a>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n<?php\r\nendif;\r\nif ($tplVars['_tplMain'] != 'ajax') {\r\n    $url = 'https://api.github.com/repos/ptrofimov/beanstalk_console/tags';\r\n    $ctx = stream_context_create(\r\n            array('http' => array(\r\n                    'timeout' => 2,\r\n                    'header' => \"Accept-language: en\\r\\n\" .\r\n                    \"Cookie: foo=bar\\r\\n\" . // check function.stream-context-create on php.net\r\n                    \"User-Agent: \" . $_SERVER['HTTP_USER_AGENT'] . \"\\r\\n\" .\r\n                    \"Accept: application/vnd.github.v3+json\\r\\n\",\r\n                )\r\n    ));\r\n\r\n    $json = @file_get_contents($url, false, $ctx);\r\n    if ($json) {\r\n        $document = json_decode($json, true);\r\n        $latest = current($document);\r\n        $version = @$latest['name'];\r\n        if (version_compare($version, $config['version']) > 0) {\r\n            ?>\r\n            <br/>\r\n            <div class=\"alert alert-info\" style=\"position: relative;top:50px;\">\r\n                <span>A new version is available: <b><?php echo $version; ?></b> Get it from <b><a href=\"https://github.com/ptrofimov/beanstalk_console\"\r\n                                                                                                   target=\"_blank\">Github</a></b></span>\r\n            </div>\r\n            <?php\r\n        }\r\n    }\r\n}\r\n?>\r\n"], "fixing_code": ["<?php\r\n$servers = $console->getServers();\r\nif ($server) {\r\n    $serverKey = array_search($server, $servers);\r\n    $serverLabel = is_numeric($serverKey) || empty($serverKey) ? $server : $serverKey;\r\n}\r\n?><!DOCTYPE html>\r\n<html>\r\n\r\n    <head>\r\n        <meta charset=\"utf-8\">\r\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n\r\n        <title>\r\n            <?php if ($tube) echo $tube . ' - ' ?>\r\n            <?php echo $serverLabel ? $serverLabel : 'All servers' ?> -\r\n            Beanstalk console\r\n        </title>\r\n\r\n        <!-- Bootstrap core CSS -->\r\n        <link href=\"assets/vendor/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n        <link href=\"css/customer.css\" rel=\"stylesheet\">\r\n        <link href=\"highlight/styles/magula.css\" rel=\"stylesheet\">\r\n        <link rel=\"shortcut icon\" href=\"assets/favicon.ico\">\r\n        <script>\r\n            var url = \"./?server=<?php echo $server ?>\";\r\n            var contentType = \"<?php echo isset($contentType) ? $contentType : '' ?>\";\r\n        </script>\r\n\r\n        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->\r\n        <!--[if lt IE 9]>\r\n        <script src=\"https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js\"></script>\r\n        <script src=\"https://oss.maxcdn.com/respond/1.4.2/respond.min.js\"></script>\r\n        <![endif]-->\r\n    </head>\r\n\r\n    <?php if (!empty($servers)): ?>\r\n        <body>\r\n        <?php else: ?>\r\n        <body class=\"no-nav\">\r\n        <?php endif ?>\r\n\r\n        <?php if (!empty($servers)): ?>\r\n            <div class=\"navbar navbar-fixed-top navbar-default\" role=\"navigation\">\r\n                <div class=\"container\">\r\n                    <div class=\"navbar-header\">\r\n                        <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\r\n                            <span class=\"sr-only\">Toggle navigation</span>\r\n                            <span class=\"icon-bar\"></span>\r\n                            <span class=\"icon-bar\"></span>\r\n                            <span class=\"icon-bar\"></span>\r\n                        </button>\r\n                        <a class=\"navbar-brand\" href=\"./?\">Beanstalk console</a>\r\n                    </div>\r\n                    <div class=\"collapse navbar-collapse\">\r\n                        <ul class=\"nav navbar-nav\">\r\n\r\n                            <?php if ($server): ?>\r\n                                <!-- Server dropdown: current, then All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        <?php echo $serverLabel ?> <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a href=\"./?\">All servers</a></li>\r\n                                        <?php foreach (array_diff($servers, array($server)) as $key => $serverItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo htmlspecialchars($serverItem) ?>\"><?php echo empty($key) || is_numeric($key) ? htmlspecialchars($serverItem) : $key ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php else: ?>\r\n                                <!-- Server dropdown: All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        All servers <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <?php foreach ($servers as $key => $serverItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo htmlspecialchars($serverItem) ?>\"><?php echo empty($key) || is_numeric($key) ? htmlspecialchars($serverItem) : $key ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php endif ?>\r\n\r\n                            <?php if ($tube): ?>\r\n                                <!-- Tube dropdown: current, then All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        <?php echo $tube ?> <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a href=\"./?server=<?php echo $server ?>\">All Tubes</a></li>\r\n                                        <?php foreach (array_diff($tubes, array($tube)) as $tubeItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $server ?>&tube=<?php echo urlencode($tubeItem) ?>\"><?php echo $tubeItem ?></a></li>\r\n                                        <?php endforeach ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php elseif (isset($tubes)): ?>\r\n                                <!-- Tube dropdown: All, then remaining -->\r\n                                <li class=\"dropdown\">\r\n                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n                                        All tubes <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <?php foreach ($tubes as $tubeItem): ?>\r\n                                            <li><a href=\"./?server=<?php echo $server ?>&tube=<?php echo urlencode($tubeItem) ?>\"><?php echo $tubeItem ?></a></li>\r\n                                        <?php endforeach; ?>\r\n                                    </ul>\r\n                                </li>\r\n                            <?php endif ?>\r\n                        </ul>\r\n\r\n                        <ul class=\"nav navbar-nav navbar-right\">\r\n                            <li class=\"dropdown\">\r\n                                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" style=\"padding:4px !important;\"><img src=\"assets/hamburger.png\" width=\"32px\" height=\"32px\"></a>\r\n                                <ul class=\"dropdown-menu\" role=\"menu\">\r\n                                    <?php if (!isset($_tplPage) && !$server) { ?>\r\n                                        <li><a href=\"#filterServer\" role=\"button\" data-toggle=\"modal\">Filter columns</a></li>\r\n                                        <?php\r\n                                    } elseif (!isset($_tplPage) && $server) {\r\n                                        ?>\r\n                                        <li><a href=\"#filter\" role=\"button\" data-toggle=\"modal\">Filter columns</a></li>\r\n                                        <?php\r\n                                    }\r\n                                    if ($server && !$tube) {\r\n                                        ?>\r\n                                        <li><a href=\"#clear-tubes\" role=\"button\" data-toggle=\"modal\">Clear multiple tubes</a></li>\r\n                                    <?php } ?>\r\n                                    <li><a href=\"./?action=manageSamples\" role=\"button\">Manage samples</a></li>\r\n                                    <li class=\"divider\"></li>\r\n                                    <li><a href=\"https://github.com/kr/beanstalkd\">Beanstalk (github)</a></li>\r\n                                    <li><a href=\"https://github.com/kr/beanstalkd/blob/master/doc/protocol.txt\">Protocol Specification</a></li>\r\n                                    <li><a href=\"https://github.com/ptrofimov/beanstalk_console\">Beanstalk console (github)</a></li>\r\n                                    <li class=\"divider\"></li>\r\n                                    <li><a href=\"#settings\" role=\"button\" data-toggle=\"modal\">Edit settings</a></li>\r\n                                </ul>\r\n                            </li>\r\n                            <?php if (@$config['auth']['enabled']) { ?>\r\n                                <li class=\"dropdown\">\r\n                                    <a target=\"_blank\" href=\"./?logout=true\">logout <span class=\"glyphicon glyphicon-log-out\" aria-hidden=\"true\"></span></a>\r\n                                </li>\r\n                            <?php } ?>\r\n                            <?php if ($server && !$tube) { ?>\r\n                                <li>\r\n                                    <button type=\"button\" id=\"autoRefresh\" class=\"btn btn-default btn-small\">\r\n                                        <span class=\"glyphicon glyphicon-refresh\"></span>\r\n                                    </button>\r\n                                </li>\r\n                            <?php } else if (!$tube) { ?>\r\n                                <li>\r\n                                    <button type=\"button\" id=\"autoRefreshSummary\" class=\"btn btn-default btn-small\">\r\n                                        <span class=\"glyphicon glyphicon-refresh\"></span>\r\n                                    </button>\r\n                                </li>\r\n                            <?php } ?>\r\n                        </ul>\r\n                        <?php if (isset($server, $tube) && $server && $tube) { ?>\r\n                            <form  class=\"navbar-form navbar-right\" style=\"margin-top:5px;margin-bottom:0px;\" role=\"search\" action=\"\" method=\"get\">\r\n                                <input type=\"hidden\" name=\"server\" value=\"<?php echo $server; ?>\"/>\r\n                                <input type=\"hidden\" name=\"tube\" value=\"<?php echo urlencode($tube); ?>\"/>\r\n                                <input type=\"hidden\" name=\"state\" value=\"<?php echo $state; ?>\"/>\r\n                                <input type=\"hidden\" name=\"action\" value=\"search\"/>\r\n                                <input type=\"hidden\" name=\"limit\" value=\"<?php echo empty($_COOKIE['searchResultLimit']) ? 25 : $_COOKIE['searchResultLimit']; ?>\"/>\r\n                                <div class=\"form-group\">\r\n                                    <input type=\"text\" class=\"form-control input-sm search-query\" name=\"searchStr\" placeholder=\"Search this tube\">\r\n                                </div>\r\n                            </form>\r\n                        <?php } ?>\r\n                    </div>\r\n                    <!--/.nav-collapse -->\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"container\">\r\n            <?php endif ?>\r\n\r\n            <?php if (!empty($errors)): ?>\r\n                <?php foreach ($errors as $item): ?>\r\n                    <p class=\"alert alert-error\"><span class=\"label label-important\">Error</span> <?php echo $item ?></p>\r\n                <?php endforeach; ?>\r\n            <?php else: ?>\r\n                <?php if (isset($_tplPage)): ?>\r\n                    <?php include(dirname(__FILE__) . '/' . $_tplPage . '.php') ?>\r\n                <?php elseif (!$server): ?>\r\n                    <div id=\"idServers\">\r\n                        <?php\r\n                        include(dirname(__FILE__) . '/serversList.php');\r\n                        ?>\r\n                    </div>\r\n                    <div id=\"idServersCopy\" style=\"display:none\"></div>\r\n                    <?php\r\n                    if ($tplVars['_tplMain'] != 'ajax') {\r\n                        require_once dirname(__FILE__) . '/modalAddServer.php';\r\n                        require_once dirname(__FILE__) . '/modalFilterServer.php';\r\n                    }\r\n                    ?>\r\n                <?php elseif (!$tube):\r\n                    ?>\r\n                    <div id=\"idAllTubes\">\r\n                        <?php require_once dirname(__FILE__) . '/allTubes.php'; ?>\r\n                        <?php require_once dirname(__FILE__) . '/modalClearTubes.php'; ?>\r\n                    </div>\r\n                    <div id='idAllTubesCopy' style=\"display:none\"></div>\r\n                <?php elseif (!in_array($tube, $tubes)):\r\n                    ?>\r\n                    <?php echo sprintf('Tube \"%s\" not found or it is empty', $tube) ?>\r\n                    <br><br><a href=\"./?server=<?php echo $server ?>\"> << back </a>\r\n                <?php else:\r\n                    ?>\r\n                    <?php require_once dirname(__FILE__) . '/currentTube.php'; ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalAddJob.php'; ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalAddSample.php'; ?>\r\n                <?php endif; ?>\r\n                <?php if (!isset($_tplPage)) { ?>\r\n                    <?php require_once dirname(__FILE__) . '/modalFilterColumns.php'; ?>\r\n                <?php } ?>\r\n                <?php require_once dirname(__FILE__) . '/modalSettings.php'; ?>\r\n            <?php endif; ?>\r\n        </div>\r\n\r\n        <script src='assets/vendor/jquery/jquery.js'></script>\r\n        <script src=\"js/jquery.color.js\"></script>\r\n        <script src=\"js/jquery.cookie.js\"></script>\r\n        <script src=\"js/jquery.regexp.js\"></script>\r\n        <script src=\"assets/vendor/bootstrap/js/bootstrap.min.js\"></script>\r\n        <?php if (isset($_COOKIE['isDisabledJobDataHighlight']) and $_COOKIE['isDisabledJobDataHighlight'] != 1) { ?>\r\n            <script src=\"highlight/highlight.pack.js\"></script>\r\n            <script>hljs.initHighlightingOnLoad();</script><?php } ?>\r\n        <script src=\"js/customer.js\"></script>\r\n    </body>\r\n</html>\r\n", "<?php\r\n$servers = $console->getServers();\r\n$cookieServers = $console->getServersCookie();\r\n\r\nif (!empty($_COOKIE['filter'])) {\r\n    $visible = explode(',', $_COOKIE['filter']);\r\n} else {\r\n    $visible = array(\r\n        'current-jobs-urgent',\r\n        'current-jobs-ready',\r\n        'current-jobs-reserved',\r\n        'current-jobs-delayed',\r\n        'current-jobs-buried',\r\n        'current-tubes',\r\n        'current-connections',\r\n    );\r\n}\r\n?>\r\n<?php\r\nif (!empty($servers)):\r\n    $servers = array_filter(array_unique($servers));\r\n    ?>\r\n    <div class=\"row\">\r\n        <div class=\"col-sm-12\">\r\n            <table class=\"table table-striped table-hover\" id=\"servers-index\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>name</th>\r\n                        <?php foreach ($console->getServerStats(current($servers)) as $key => $item): ?>\r\n                            <th class=\"<?php if (!in_array($key, $visible)) echo 'hide' ?>\" name=\"<?php echo $key ?>\"\r\n                                title=\"<?php echo $item['description'] ?>\"><?php echo $key ?></th>\r\n                            <?php endforeach ?>\r\n                        <th>&nbsp;</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <?php\r\n                    foreach ($servers as $key => $server):\r\n                        $stats = $console->getServerStats($server);\r\n                        $label = $key;\r\n                        if (empty($label) || is_numeric($label)) {\r\n                            $label = $server;\r\n                        }\r\n                        ?>\r\n                        <tr>\r\n                            <?php if (empty($stats)): ?>\r\n                                <td style=\"white-space: nowrap;\"><?php echo htmlspecialchars($label) ?></td>\r\n                            <?php else: ?>\r\n                                <td  style=\"white-space: nowrap;\"><a href=\"./?server=<?php echo htmlspecialchars($server) ?>\"><?php echo htmlspecialchars($label); ?></a></td>\r\n                            <?php endif ?>\r\n                            <?php foreach ($stats as $key => $item): ?>\r\n                                <?php\r\n                                $classes = array(\"td-$key\");\r\n                                if (!in_array($key, $visible)) {\r\n                                    $classes[] = 'hide' ;\r\n                                }\r\n                                if (isset($stats[$key]) && $stats[$key] != '0') {\r\n                                    $classes[] = 'hasValue';\r\n                                }\r\n                                $cssClass = '' ;\r\n                                if (count($classes) > 0) {\r\n                                    $cssClass = ' class = \"' . join(' ', $classes) . '\"' ;\r\n                                }\r\n                                ?>\r\n                                <td <?php echo $cssClass; ?>\r\n                                    name=\"<?php echo $key ?>\"><?php echo htmlspecialchars($item['value']) ?></td>\r\n                                <?php endforeach ?>\r\n                                <?php if (empty($stats)): ?>\r\n                                <td colspan=\"<?php echo count($visible) ?>\" class=\"row-full\">&nbsp;</td>\r\n                            <?php endif ?>\r\n                            <td><?php if (array_intersect(array($server), $cookieServers)): ?>\r\n                                    <a class=\"btn btn-xs btn-danger\" title=\"Remove from list\" href=\"./?action=serversRemove&removeServer=<?php echo htmlspecialchars($server) ?>\"><span\r\n                                            class=\"glyphicon glyphicon-minus\"></span></a>\r\n                                    <?php endif; ?>\r\n                            </td>\r\n                        </tr>\r\n                    <?php endforeach ?>\r\n                </tbody>\r\n            </table>\r\n            <a href=\"#servers-add\" role=\"button\" class=\"btn btn-info\" id=\"addServer\">Add server</a>\r\n        </div>\r\n    </div>\r\n<?php else: ?>\r\n    <div class=\"site-wrapper\">\r\n        <div class=\"site-wrapper-inner\">\r\n            <div class=\"col-sm-8 col-sm-push-2 text-center\">\r\n                <h1>Hello!</h1>\r\n\r\n                <p class=\"lead\">\r\n                    This is Beanstalk console,<br/>web-interface for\r\n                    <a href=\"http://kr.github.io/beanstalkd/\" target=\"_blank\">simple and fast work queue</a>\r\n                </p>\r\n\r\n                <p>\r\n                    Your servers' list is empty. You could fix it in two ways:\r\n                <ol class=\"inside\">\r\n                    <li>Click the button below to add server just for you and save it in cookies</li>\r\n                    <li>Edit <b>config.php</b> file and add server for everybody</li>\r\n                </ol>\r\n                </p>\r\n                <p>\r\n                    <br/><a href=\"#servers-add\" role=\"button\" class=\"btn btn-lg btn-success\" data-toggle=\"modal\">Add server</a>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n<?php\r\nendif;\r\nif ($tplVars['_tplMain'] != 'ajax') {\r\n    $url = 'https://api.github.com/repos/ptrofimov/beanstalk_console/tags';\r\n    $ctx = stream_context_create(\r\n            array('http' => array(\r\n                    'timeout' => 2,\r\n                    'header' => \"Accept-language: en\\r\\n\" .\r\n                    \"Cookie: foo=bar\\r\\n\" . // check function.stream-context-create on php.net\r\n                    \"User-Agent: \" . $_SERVER['HTTP_USER_AGENT'] . \"\\r\\n\" .\r\n                    \"Accept: application/vnd.github.v3+json\\r\\n\",\r\n                )\r\n    ));\r\n\r\n    $json = @file_get_contents($url, false, $ctx);\r\n    if ($json) {\r\n        $document = json_decode($json, true);\r\n        $latest = current($document);\r\n        $version = @$latest['name'];\r\n        if (version_compare($version, $config['version']) > 0) {\r\n            ?>\r\n            <br/>\r\n            <div class=\"alert alert-info\" style=\"position: relative;top:50px;\">\r\n                <span>A new version is available: <b><?php echo $version; ?></b> Get it from <b><a href=\"https://github.com/ptrofimov/beanstalk_console\"\r\n                                                                                                   target=\"_blank\">Github</a></b></span>\r\n            </div>\r\n            <?php\r\n        }\r\n    }\r\n}\r\n?>\r\n"], "filenames": ["lib/tpl/main.php", "lib/tpl/serversList.php"], "buggy_code_start_loc": [68, 47], "buggy_code_end_loc": [81, 73], "fixing_code_start_loc": [68, 47], "fixing_code_end_loc": [81, 73], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in Packagist ptrofimov/beanstalk_console prior to 1.7.14.", "other": {"cve": {"id": "CVE-2022-0539", "sourceIdentifier": "security@huntr.dev", "published": "2022-02-09T14:15:07.950", "lastModified": "2022-02-11T20:12:09.090", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in Packagist ptrofimov/beanstalk_console prior to 1.7.14."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross-site Scripting (XSS) - Almacenado en Packagist ptrofimov/beanstalk_console versiones anteriores a 1.7.14"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:beanstalk_console_project:beanstalk_console:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.7.14", "matchCriteriaId": "0AEE2CC8-F7A6-4122-9EB0-EBC4A42B8A41"}]}]}], "references": [{"url": "https://github.com/ptrofimov/beanstalk_console/commit/5aea5f912f6e6d19dedb1fdfc25a29a2e1fc1694", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/5f41b182-dda2-4c6f-9668-2a9afaed53af", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ptrofimov/beanstalk_console/commit/5aea5f912f6e6d19dedb1fdfc25a29a2e1fc1694"}}