{"buggy_code": ["/**\n * The contents of this file are subject to the OpenMRS Public License\n * Version 1.0 (the \"License\"); you may not use this file except in\n * compliance with the License. You may obtain a copy of the License at\n * http://license.openmrs.org\n *\n * Software distributed under the License is distributed on an \"AS IS\"\n * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the\n * License for the specific language governing rights and limitations\n * under the License.\n *\n * Copyright (C) OpenMRS, LLC.  All Rights Reserved.\n */\npackage org.openmrs.module.referenceapplication.page.controller;\n\nimport javax.servlet.http.HttpSession;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.codehaus.jackson.map.ObjectMapper;\nimport org.openmrs.module.appframework.domain.AppDescriptor;\nimport org.openmrs.module.appframework.domain.UserApp;\nimport org.openmrs.module.appframework.service.AppFrameworkService;\nimport org.openmrs.module.uicommons.UiCommonsConstants;\nimport org.openmrs.module.uicommons.util.InfoErrorMessageUtil;\nimport org.openmrs.module.webservices.rest.SimpleObject;\nimport org.openmrs.ui.framework.UiUtils;\nimport org.openmrs.ui.framework.annotation.BindParams;\nimport org.openmrs.ui.framework.annotation.SpringBean;\nimport org.openmrs.ui.framework.page.PageModel;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.ModelAttribute;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.ResponseBody;\n\n@Controller\npublic class UserAppPageController {\n\t\n\tprotected final Log log = LogFactory.getLog(getClass());\n\t\n\tprivate ObjectMapper mapper = new ObjectMapper();\n\t\n\tpublic void get(PageModel model, @RequestParam(value = \"appId\", required = false) UserApp userApp) {\n\t\t\n\t\tif (userApp == null) {\n\t\t\tuserApp = new UserApp();\n\t\t}\n\t\tmodel.addAttribute(\"userApp\", userApp);\n\t}\n\t\n\tpublic String post(PageModel model, @ModelAttribute(value = \"appId\") @BindParams UserApp userApp,\n\t                   @RequestParam(\"action\") String action,\n\t                   @SpringBean(\"appFrameworkService\") AppFrameworkService service, HttpSession session, UiUtils ui) {\n\t\t\n\t\ttry {\n\t\t\tAppDescriptor descriptor = mapper.readValue(userApp.getJson(), AppDescriptor.class);\n\t\t\tif (!userApp.getAppId().equals(descriptor.getId())) {\n\t\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t\t    ui.message(\"referenceapplication.app.errors.IdsShouldMatch\"));\n\t\t\t} else if (\"add\".equals(action) && service.getUserApp(userApp.getAppId()) != null) {\n\t\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t\t    ui.message(\"referenceapplication.app.errors.duplicateAppId\"));\n\t\t\t} else {\n\t\t\t\tservice.saveUserApp(userApp);\n\t\t\t\t\n\t\t\t\tInfoErrorMessageUtil.flashInfoMessage(session,\n\t\t\t\t    ui.message(\"referenceapplication.app.userApp.save.success\", userApp.getAppId()));\n\t\t\t\t\n\t\t\t\treturn \"redirect:/referenceapplication/manageApps.page\";\n\t\t\t}\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t    ui.message(\"referenceapplication.app.userApp.save.fail\", userApp.getAppId()));\n\t\t}\n\t\t\n\t\tmodel.addAttribute(\"userApp\", userApp);\n\t\t\n\t\treturn null;\n\t}\n\t\n\t@ResponseBody\n\t@RequestMapping(\"/referenceapplication/verifyJson\")\n\tpublic SimpleObject verifyJson(@RequestParam(\"json\") String json) {\n\t\tSimpleObject so = new SimpleObject();\n\t\ttry {\n\t\t\tmapper.readValue(json, AppDescriptor.class);\n\t\t\tso.add(\"isValid\", true);\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tlog.warn(\"Invalid json:\", e);\n\t\t\tso.add(\"isValid\", false);\n\t\t}\n\t\t\n\t\treturn so;\n\t}\n}\n"], "fixing_code": ["/**\n * The contents of this file are subject to the OpenMRS Public License\n * Version 1.0 (the \"License\"); you may not use this file except in\n * compliance with the License. You may obtain a copy of the License at\n * http://license.openmrs.org\n *\n * Software distributed under the License is distributed on an \"AS IS\"\n * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the\n * License for the specific language governing rights and limitations\n * under the License.\n *\n * Copyright (C) OpenMRS, LLC.  All Rights Reserved.\n */\npackage org.openmrs.module.referenceapplication.page.controller;\n\nimport javax.servlet.http.HttpSession;\n\nimport org.apache.commons.lang.StringEscapeUtils;\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.codehaus.jackson.map.ObjectMapper;\nimport org.openmrs.module.appframework.domain.AppDescriptor;\nimport org.openmrs.module.appframework.domain.UserApp;\nimport org.openmrs.module.appframework.service.AppFrameworkService;\nimport org.openmrs.module.uicommons.UiCommonsConstants;\nimport org.openmrs.module.uicommons.util.InfoErrorMessageUtil;\nimport org.openmrs.module.webservices.rest.SimpleObject;\nimport org.openmrs.ui.framework.UiUtils;\nimport org.openmrs.ui.framework.annotation.BindParams;\nimport org.openmrs.ui.framework.annotation.SpringBean;\nimport org.openmrs.ui.framework.page.PageModel;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.ModelAttribute;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.ResponseBody;\n\n@Controller\npublic class UserAppPageController {\n\t\n\tprotected final Log log = LogFactory.getLog(getClass());\n\t\n\tprivate ObjectMapper mapper = new ObjectMapper();\n\t\n\tpublic void get(PageModel model, @RequestParam(value = \"appId\", required = false) UserApp userApp) {\n\t\t\n\t\tif (userApp == null) {\n\t\t\tuserApp = new UserApp();\n\t\t}\n\t\tmodel.addAttribute(\"userApp\", userApp);\n\t}\n\t\n\tpublic String post(PageModel model, @ModelAttribute(value = \"appId\") @BindParams UserApp userApp,\n\t                   @RequestParam(\"action\") String action,\n\t                   @SpringBean(\"appFrameworkService\") AppFrameworkService service, HttpSession session, UiUtils ui) {\n\n\t\ttry {\n\t\t\tAppDescriptor descriptor = mapper.readValue(userApp.getJson(), AppDescriptor.class);\n\t\t\tif (!userApp.getAppId().equals(descriptor.getId())) {\n\t\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t\t    ui.message(\"referenceapplication.app.errors.IdsShouldMatch\"));\n\t\t\t} else if (\"add\".equals(action) && service.getUserApp(userApp.getAppId()) != null) {\n\t\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t\t    ui.message(\"referenceapplication.app.errors.duplicateAppId\"));\n\t\t\t} else {\n\t\t\t\tservice.saveUserApp(userApp);\n\t\t\t\t\n\t\t\t\tInfoErrorMessageUtil.flashInfoMessage(session,\n\t\t\t\t    ui.message(\"referenceapplication.app.userApp.save.success\", StringEscapeUtils.escapeHtml(userApp.getAppId())));\n\t\t\t\t\n\t\t\t\treturn \"redirect:/referenceapplication/manageApps.page\";\n\t\t\t}\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tsession.setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_ERROR_MESSAGE,\n\t\t\t    ui.message(\"referenceapplication.app.userApp.save.fail\", StringEscapeUtils.escapeHtml(userApp.getAppId())));\n\t\t}\n\t\t\n\t\tmodel.addAttribute(\"userApp\", userApp);\n\t\t\n\t\treturn null;\n\t}\n\t\n\t@ResponseBody\n\t@RequestMapping(\"/referenceapplication/verifyJson\")\n\tpublic SimpleObject verifyJson(@RequestParam(\"json\") String json) {\n\t\tSimpleObject so = new SimpleObject();\n\t\ttry {\n\t\t\tmapper.readValue(json, AppDescriptor.class);\n\t\t\tso.add(\"isValid\", true);\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\tlog.warn(\"Invalid json:\", e);\n\t\t\tso.add(\"isValid\", false);\n\t\t}\n\t\t\n\t\treturn so;\n\t}\n}\n"], "filenames": ["omod/src/main/java/org/openmrs/module/referenceapplication/page/controller/UserAppPageController.java"], "buggy_code_start_loc": [17], "buggy_code_end_loc": [76], "fixing_code_start_loc": [18], "fixing_code_end_loc": [77], "type": "CWE-79", "message": "A vulnerability classified as problematic was found in OpenMRS openmrs-module-referenceapplication up to 2.11.x. Affected by this vulnerability is the function post of the file omod/src/main/java/org/openmrs/module/referenceapplication/page/controller/UserAppPageController.java of the component User App Page. The manipulation of the argument AppId leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.12.0 is able to address this issue. The name of the patch is 0410c091d46eed3c132fe0fcafe5964182659f74. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-216883.", "other": {"cve": {"id": "CVE-2021-4289", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-27T13:15:11.227", "lastModified": "2023-01-06T06:05:47.213", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic was found in OpenMRS openmrs-module-referenceapplication up to 2.11.x. Affected by this vulnerability is the function post of the file omod/src/main/java/org/openmrs/module/referenceapplication/page/controller/UserAppPageController.java of the component User App Page. The manipulation of the argument AppId leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.12.0 is able to address this issue. The name of the patch is 0410c091d46eed3c132fe0fcafe5964182659f74. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-216883."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:openmrs:reference_application:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.12.0", "matchCriteriaId": "1E5CB281-DDF6-4E8F-BA44-C6BDE56796E3"}]}]}], "references": [{"url": "https://github.com/openmrs/openmrs-module-referenceapplication/commit/0410c091d46eed3c132fe0fcafe5964182659f74", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/openmrs/openmrs-module-referenceapplication/pull/89", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/openmrs/openmrs-module-referenceapplication/releases/tag/referenceapplication-2.12.0", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://issues.openmrs.org/browse/RA-1875", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Vendor Advisory"]}, {"url": "https://vuldb.com/?ctiid.216883", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216883", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/openmrs/openmrs-module-referenceapplication/commit/0410c091d46eed3c132fe0fcafe5964182659f74"}}