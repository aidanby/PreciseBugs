{"buggy_code": ["# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-apcupsd\nPORTVERSION=\t0.3.91\nPORTREVISION=\t4\nCATEGORIES=\tsysutils\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package apcupsd\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\t${LOCALBASE}/sbin/apcupsd:sysutils/apcupsd\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/apcupsd.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/apcupsd_status.php \\\n\t\t${STAGEDIR}${PREFIX}/www\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd.conf.php \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd_mail.php \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/apcupsd.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * apcupsd_status.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2015 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 Danilo G. Baio <dbaio@bsd.com.br>\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nrequire(\"guiconfig.inc\");\nrequire_once(\"/usr/local/pkg/apcupsd.inc\");\n\n$pgtitle = array(gettext(\"Package\"), gettext(\"Services: Apcupsd\"), gettext(\"Status\"));\ninclude(\"head.inc\");\n\nfunction puts($arg) {\n\techo \"$arg\\n\";\n}\n\n$tab_array = array();\n$tab_array[] = array(gettext(\"General\"), false, \"/pkg_edit.php?xml=apcupsd.xml&amp;id=0\");\n$tab_array[] = array(gettext(\"Status\"), true, \"/apcupsd_status.php\");\ndisplay_top_tabs($tab_array);\n\n$nis_server = check_nis_running_apcupsd();\n\nif ( $_POST['strapcaccess'] ) {\n\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\tputs(\"<pre>\");\n\tputs(\"Running: apcaccess -h {$_POST['strapcaccess']} <br />\");\n\tputenv(\"PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\");\n\t$ph = popen(\"apcaccess -h {$_POST['strapcaccess']} 2>&1\", \"r\" );\n\twhile ($line = fgets($ph)) {\n\t\techo htmlspecialchars($line);\n\t}\n\tpclose($ph);\n\tputs(\"</pre>\");\n\tputs(\"</div>\");\n} elseif ($nis_server) {\n\t$nisip = (check_nis_ip_apcupsd() != ''? check_nis_ip_apcupsd() : \"localhost\");\n\t$nisport = (check_nis_port_apcupsd() != '' ? check_nis_port_apcupsd() : \"3551\");\n\n\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\tputs(\"<pre>\");\n\tputs(\"Running: apcaccess -h {$nisip}:{$nisport} <br />\");\n\tputenv(\"PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\");\n\t$ph = popen(\"apcaccess -h {$nisip}:{$nisport} 2>&1\", \"r\" );\n\twhile ($line = fgets($ph)) {\n\t\techo htmlspecialchars($line);\n\t}\n\tpclose($ph);\n\tputs(\"</pre>\");\n\tputs(\"</div>\");\n} else {\n\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\tputs(\"<pre>\");\n\tputs(\"Network Information Server (NIS) not running, in order to run apcaccess on localhost, you need to enable it on APCupsd General settings. <br />\");\n\tputs(\"</pre>\");\n\tputs(\"</div>\");\n}\n\n?>\n\n<form action=\"apcupsd_status.php\" method=\"post\" enctype=\"multipart/form-data\" name=\"frm_apcupsd_status\">\n\t<div class=\"panel panel-default responsive\">\n\t\t<div class=\"panel-heading\"><h2 class=\"panel-title\"><?=gettext('APC UPS Daemon Status Information')?></h2></div>\n\t\t<div class=\"panel-body\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label class=\"col-sm-2 control-label\">\n\t\t\t\t\tHost\n\t\t\t\t</label>\n\t\t\t\t<div class=\"col-sm-10\">\n\t\t\t\t\t\t<input class=\"form-control\" name=\"strapcaccess\" id=\"strapcaccess\" type=\"text\" \n\t\t\t\t\t\t\tvalue=\"<?=htmlspecialchars($_POST['strapcaccess'])?>\">\n\t\t\t\t\t<span class=\"help-block\">\n\t\t\t\t\t\tDefault: <strong>localhost</strong><br /><br />\n\t\t\t\t\t\tNote: apcaccess uses apcupsd's inbuilt Network Information Server (NIS) to obtain the current status information<br />\n\t\t\t\t\t\tfrom the UPS on the local or remote computer. It is therefore necessary to have the following configuration directives: <br />\n\t\t\t\t\t\tNETSERVER <strong>on</strong> <br />\n\t\t\t\t\t\tNISPORT <strong>3551</strong> <br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class=\"col-sm-10 col-sm-offset-2\">\n\t\t<button name=\"submit\" type=\"submit\" class=\"btn btn-warning btn-sm\" \n\t\t\tvalue=\"EXECAPCACCESS\" title=\"<?=gettext(\"Retrieve status information from apcupsd\")?>\">\n\t\t\t<i class=\"fa fa-bolt\"></i>\n\t\t\t<?=gettext(\"Execute\")?>\n\t\t</button>\n\t</div>\n</form>\n\n<?php\ninclude(\"foot.inc\");\n?>\n\n"], "fixing_code": ["# $FreeBSD$\n\nPORTNAME=\tpfSense-pkg-apcupsd\nPORTVERSION=\t0.3.91\nPORTREVISION=\t5\nCATEGORIES=\tsysutils\nMASTER_SITES=\t# empty\nDISTFILES=\t# empty\nEXTRACT_ONLY=\t# empty\n\nMAINTAINER=\tcoreteam@pfsense.org\nCOMMENT=\tpfSense package apcupsd\n\nLICENSE=\tAPACHE20\n\nRUN_DEPENDS=\t${LOCALBASE}/sbin/apcupsd:sysutils/apcupsd\n\nNO_BUILD=\tyes\nNO_MTREE=\tyes\n\nSUB_FILES=\tpkg-install pkg-deinstall\nSUB_LIST=\tPORTNAME=${PORTNAME}\n\ndo-extract:\n\t${MKDIR} ${WRKSRC}\n\ndo-install:\n\t${MKDIR} ${STAGEDIR}${PREFIX}/pkg\n\t${MKDIR} ${STAGEDIR}${PREFIX}/www\n\t${MKDIR} ${STAGEDIR}/etc/inc/priv\n\t${MKDIR} ${STAGEDIR}${DATADIR}\n\t${INSTALL_DATA} -m 0644 ${FILESDIR}${PREFIX}/pkg/apcupsd.xml \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd.inc \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/www/apcupsd_status.php \\\n\t\t${STAGEDIR}${PREFIX}/www\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd.conf.php \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}${PREFIX}/pkg/apcupsd_mail.php \\\n\t\t${STAGEDIR}${PREFIX}/pkg\n\t${INSTALL_DATA} ${FILESDIR}/etc/inc/priv/apcupsd.priv.inc \\\n\t\t${STAGEDIR}/etc/inc/priv\n\t${INSTALL_DATA} ${FILESDIR}${DATADIR}/info.xml \\\n\t\t${STAGEDIR}${DATADIR}\n\t@${REINPLACE_CMD} -i '' -e \"s|%%PKGVERSION%%|${PKGVERSION}|\" \\\n\t\t${STAGEDIR}${DATADIR}/info.xml\n\n.include <bsd.port.mk>\n", "<?php\n/*\n * apcupsd_status.php\n *\n * part of pfSense (https://www.pfsense.org)\n * Copyright (c) 2015 Rubicon Communications, LLC (Netgate)\n * Copyright (c) 2013-2016 Danilo G. Baio <dbaio@bsd.com.br>\n * All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nrequire(\"guiconfig.inc\");\nrequire_once(\"/usr/local/pkg/apcupsd.inc\");\n\n$pgtitle = array(gettext(\"Package\"), gettext(\"Services: Apcupsd\"), gettext(\"Status\"));\ninclude(\"head.inc\");\n\nfunction puts($arg) {\n\techo \"$arg\\n\";\n}\n\n$tab_array = array();\n$tab_array[] = array(gettext(\"General\"), false, \"/pkg_edit.php?xml=apcupsd.xml&amp;id=0\");\n$tab_array[] = array(gettext(\"Status\"), true, \"/apcupsd_status.php\");\ndisplay_top_tabs($tab_array);\n\n$nis_server = check_nis_running_apcupsd();\n\nif ( $_POST['strapcaccess'] ) {\n\tif (is_hostname($_POST['strapcaccess'])) {\n\t\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\t\tputs(\"<pre>\");\n\t\tputs(\"Running: apcaccess -h \" . htmlspecialchars($_POST['strapcaccess']) . \" <br />\");\n\t\tputenv(\"PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\");\n\t\t$ph = popen(\"apcaccess -h \" . escapeshellarg($_POST['strapcaccess']) . \" 2>&1\", \"r\" );\n\t\twhile ($line = fgets($ph)) {\n\t\t\techo htmlspecialchars($line);\n\t\t}\n\t\tpclose($ph);\n\t\tputs(\"</pre>\");\n\t\tputs(\"</div>\");\n\t} else {\n\t\tprint_input_errors(array(gettext(\"Invalid hostname or IP address\")));\n\t}\n} elseif ($nis_server) {\n\t$nisip = (check_nis_ip_apcupsd() != ''? check_nis_ip_apcupsd() : \"localhost\");\n\t$nisport = (check_nis_port_apcupsd() != '' ? check_nis_port_apcupsd() : \"3551\");\n\n\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\tputs(\"<pre>\");\n\tputs(\"Running: apcaccess -h {$nisip}:{$nisport} <br />\");\n\tputenv(\"PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\");\n\t$ph = popen(\"apcaccess -h {$nisip}:{$nisport} 2>&1\", \"r\" );\n\twhile ($line = fgets($ph)) {\n\t\techo htmlspecialchars($line);\n\t}\n\tpclose($ph);\n\tputs(\"</pre>\");\n\tputs(\"</div>\");\n} else {\n\tputs(\"<div class=\\\"panel panel-success responsive\\\"><div class=\\\"panel-heading\\\"><h2 class=\\\"panel-title\\\">Status information from apcupsd</h2></div>\");\n\tputs(\"<pre>\");\n\tputs(\"Network Information Server (NIS) not running, in order to run apcaccess on localhost, you need to enable it on APCupsd General settings. <br />\");\n\tputs(\"</pre>\");\n\tputs(\"</div>\");\n}\n\n?>\n\n<form action=\"apcupsd_status.php\" method=\"post\" enctype=\"multipart/form-data\" name=\"frm_apcupsd_status\">\n\t<div class=\"panel panel-default responsive\">\n\t\t<div class=\"panel-heading\"><h2 class=\"panel-title\"><?=gettext('APC UPS Daemon Status Information')?></h2></div>\n\t\t<div class=\"panel-body\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label class=\"col-sm-2 control-label\">\n\t\t\t\t\tHost\n\t\t\t\t</label>\n\t\t\t\t<div class=\"col-sm-10\">\n\t\t\t\t\t\t<input class=\"form-control\" name=\"strapcaccess\" id=\"strapcaccess\" type=\"text\" \n\t\t\t\t\t\t\tvalue=\"<?=htmlspecialchars($_POST['strapcaccess'])?>\">\n\t\t\t\t\t<span class=\"help-block\">\n\t\t\t\t\t\tDefault: <strong>localhost</strong><br /><br />\n\t\t\t\t\t\tNote: apcaccess uses apcupsd's inbuilt Network Information Server (NIS) to obtain the current status information<br />\n\t\t\t\t\t\tfrom the UPS on the local or remote computer. It is therefore necessary to have the following configuration directives: <br />\n\t\t\t\t\t\tNETSERVER <strong>on</strong> <br />\n\t\t\t\t\t\tNISPORT <strong>3551</strong> <br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class=\"col-sm-10 col-sm-offset-2\">\n\t\t<button name=\"submit\" type=\"submit\" class=\"btn btn-warning btn-sm\" \n\t\t\tvalue=\"EXECAPCACCESS\" title=\"<?=gettext(\"Retrieve status information from apcupsd\")?>\">\n\t\t\t<i class=\"fa fa-bolt\"></i>\n\t\t\t<?=gettext(\"Execute\")?>\n\t\t</button>\n\t</div>\n</form>\n\n<?php\ninclude(\"foot.inc\");\n?>\n\n"], "filenames": ["sysutils/pfSense-pkg-apcupsd/Makefile", "sysutils/pfSense-pkg-apcupsd/files/usr/local/www/apcupsd_status.php"], "buggy_code_start_loc": [5, 41], "buggy_code_end_loc": [6, 52], "fixing_code_start_loc": [5, 41], "fixing_code_end_loc": [6, 55], "type": "CWE-79", "message": "Apcupsd 0.3.91_5, as used in pfSense through 2.4.4-RELEASE-p3 and other products, has an XSS issue in apcupsd_status.php.", "other": {"cve": {"id": "CVE-2019-12584", "sourceIdentifier": "cve@mitre.org", "published": "2019-06-03T03:29:00.213", "lastModified": "2019-06-04T20:29:00.387", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Apcupsd 0.3.91_5, as used in pfSense through 2.4.4-RELEASE-p3 and other products, has an XSS issue in apcupsd_status.php."}, {"lang": "es", "value": "Apcupsd versi\u00f3n 0.3.91_5, como es usado en pfSense hasta versi\u00f3n 2.4.4-RELEASE-p3 y otros productos, tiene un problema de tipo Cross-Site Scripting (XSS) en el archivo apcupsd_status.php."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:apcupsd:apcupsd:0.3.91_5:*:*:*:*:*:*:*", "matchCriteriaId": "EBBF5E89-37CA-49B0-9C23-96B231CCA1E0"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:netgate:pfsense:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.4", "matchCriteriaId": "2829D9BD-28CA-4E27-997A-25A96ED9B868"}, {"vulnerable": true, "criteria": "cpe:2.3:a:netgate:pfsense:2.4.4:-:*:*:*:*:*:*", "matchCriteriaId": "9A0A896A-691F-442E-9CDE-0EC1393C0C1C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:netgate:pfsense:2.4.4:p1:*:*:*:*:*:*", "matchCriteriaId": "E6256A47-F8C7-4097-88D8-170E8E9AE45C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:netgate:pfsense:2.4.4:p2:*:*:*:*:*:*", "matchCriteriaId": "7F038B4C-BC0C-40A8-B547-36F0420CD800"}, {"vulnerable": true, "criteria": "cpe:2.3:a:netgate:pfsense:2.4.4:p3:*:*:*:*:*:*", "matchCriteriaId": "2FC53B2F-94B4-4985-B49E-652C6D3A9940"}]}]}], "references": [{"url": "https://ctrsec.io/index.php/2019/05/28/cve-2019-12584-12585-command-injection-vulnerability-on-pfsense-2-4-4-release-p3/", "source": "cve@mitre.org"}, {"url": "https://github.com/pfsense/FreeBSD-ports/commit/b492c0ea47aba8dde2f14183e71498ba207594e3", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://redmine.pfsense.org/issues/9556", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pfsense/FreeBSD-ports/commit/b492c0ea47aba8dde2f14183e71498ba207594e3"}}