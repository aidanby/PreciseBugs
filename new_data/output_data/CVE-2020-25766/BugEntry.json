{"buggy_code": ["<div style=\"width:100%;\">\n    <?php\n        echo $this->Session->flash('auth');\n    ?>\n<table style=\"margin-left:auto;margin-right:auto;\">\n    <tr>\n    <td style=\"text-align:right;width:250px;padding-right:50px\">\n        <?php if (Configure::read('MISP.welcome_logo')) echo $this->Html->image('custom/' . h(Configure::read('MISP.welcome_logo')), array('alt' => __('Logo'), 'onerror' => \"this.style.display='none';\")); ?>\n    </td>\n    <td style=\"width:460px\">\n        <span style=\"font-size:18px;\">\n            <?php\n                if (Configure::read('MISP.welcome_text_top')) {\n                    echo h(Configure::read('MISP.welcome_text_top'));\n                }\n            ?>\n        </span><br /><br />\n        <div>\n        <?php if (Configure::read('MISP.main_logo') && file_exists(APP . '/webroot/img/custom/' . Configure::read('MISP.main_logo'))): ?>\n            <img src=\"<?php echo $baseurl?>/img/custom/<?php echo h(Configure::read('MISP.main_logo'));?>\" style=\" display:block; margin-left: auto; margin-right: auto;\" />\n        <?php else: ?>\n            <img src=\"<?php echo $baseurl?>/img/misp-logo.png\" style=\"display:block; margin-left: auto; margin-right: auto;\"/>\n        <?php endif;?>\n        </div>\n        <?php\n            if (true == Configure::read('MISP.welcome_text_bottom')):\n        ?>\n                <div style=\"text-align:right;font-size:18px;\">\n                <?php\n                    echo h(Configure::read('MISP.welcome_text_bottom'));\n                ?>\n                </div>\n        <?php\n            endif;\n            echo $this->Form->create('User');\n        ?>\n        <legend><?php echo __('Login');?></legend>\n        <?php\n            echo $this->Form->input('email', array('autocomplete' => 'off', 'autofocus'));\n            echo $this->Form->input('password', array('autocomplete' => 'off'));\n        ?>\n            <div class=\"clear\">\n            <?php\n                echo empty(Configure::read('Security.allow_self_registration')) ? '' : sprintf(\n                    '<a href=\"%s/users/register\" title=\"%s\">%s</a>',\n                    $baseurl,\n                    __('Registration will be sent to the administrators of the instance for consideration.'),\n                    __('No account yet? Register now!')\n                );\n            ?>\n            </div>\n            <?= $this->Form->button(__('Login'), array('class' => 'btn btn-primary')); ?>\n        <?php\n            echo $this->Form->end();\n            if (Configure::read('ApacheShibbAuth') == true) {\n                echo '<div class=\"clear\"></div><a class=\"btn btn-info\" href=\"/Shibboleth.sso/Login\">Login with SAML</a>';\n            }\n        ?>\n    </td>\n    <td style=\"width:250px;padding-left:50px\">\n        <?php if (Configure::read('MISP.welcome_logo2')) echo $this->Html->image('custom/' . h(Configure::read('MISP.welcome_logo2')), array('alt' => 'Logo2', 'onerror' => \"this.style.display='none';\")); ?>\n    </td>\n    </tr>\n    </table>\n</div>\n\n<script>\n$(document).ready(function() {\n    $('#UserLoginForm').submit(function(event) {\n        event.preventDefault()\n        submitLoginForm()\n    });\n})\n\nfunction submitLoginForm() {\n    var $form = $('#UserLoginForm')\n    var url = $form.attr('action')\n    var email = $form.find('#UserEmail').val()\n    var password = $form.find('#UserPassword').val()\n    if (!$form[0].checkValidity()) {\n        $form[0].reportValidity()\n    } else {\n        fetchFormDataAjax(url, function(html) {\n            var formHTML = $(html).find('form')\n            $('body').append($('<div id=\"temp\" style=\"display: none\"/>').append(formHTML))\n            var $tmpForm = $('#temp form')\n            $tmpForm.find('#UserEmail').val(email)\n            $tmpForm.find('#UserPassword').val(password)\n            $tmpForm.submit()\n        })\n    }\n}\n</script>\n"], "fixing_code": ["<div style=\"width:100%;\">\n    <?php\n        echo $this->Session->flash('auth');\n    ?>\n<table style=\"margin-left:auto;margin-right:auto;\">\n    <tr>\n    <td style=\"text-align:right;width:250px;padding-right:50px\">\n        <?php if (Configure::read('MISP.welcome_logo')) echo $this->Html->image('custom/' . h(Configure::read('MISP.welcome_logo')), array('alt' => __('Logo'), 'onerror' => \"this.style.display='none';\")); ?>\n    </td>\n    <td style=\"width:460px\">\n        <span style=\"font-size:18px;\">\n            <?php\n                if (Configure::read('MISP.welcome_text_top')) {\n                    echo h(Configure::read('MISP.welcome_text_top'));\n                }\n            ?>\n        </span><br /><br />\n        <div>\n        <?php if (Configure::read('MISP.main_logo') && file_exists(APP . '/webroot/img/custom/' . Configure::read('MISP.main_logo'))): ?>\n            <img src=\"<?php echo $baseurl?>/img/custom/<?php echo h(Configure::read('MISP.main_logo'));?>\" style=\" display:block; margin-left: auto; margin-right: auto;\" />\n        <?php else: ?>\n            <img src=\"<?php echo $baseurl?>/img/misp-logo.png\" style=\"display:block; margin-left: auto; margin-right: auto;\"/>\n        <?php endif;?>\n        </div>\n        <?php\n            if (true == Configure::read('MISP.welcome_text_bottom')):\n        ?>\n                <div style=\"text-align:right;font-size:18px;\">\n                <?php\n                    echo h(Configure::read('MISP.welcome_text_bottom'));\n                ?>\n                </div>\n        <?php\n            endif;\n            echo $this->Form->create('User');\n        ?>\n        <legend><?php echo __('Login');?></legend>\n        <?php\n            echo $this->Form->input('email', array('autocomplete' => 'off', 'autofocus'));\n            echo $this->Form->input('password', array('autocomplete' => 'off'));\n        ?>\n            <div class=\"clear\">\n            <?php\n                echo empty(Configure::read('Security.allow_self_registration')) ? '' : sprintf(\n                    '<a href=\"%s/users/register\" title=\"%s\">%s</a>',\n                    $baseurl,\n                    __('Registration will be sent to the administrators of the instance for consideration.'),\n                    __('No account yet? Register now!')\n                );\n            ?>\n            </div>\n            <?= $this->Form->button(__('Login'), array('class' => 'btn btn-primary')); ?>\n        <?php\n            echo $this->Form->end();\n            if (Configure::read('ApacheShibbAuth') == true) {\n                echo '<div class=\"clear\"></div><a class=\"btn btn-info\" href=\"/Shibboleth.sso/Login\">Login with SAML</a>';\n            }\n        ?>\n    </td>\n    <td style=\"width:250px;padding-left:50px\">\n        <?php if (Configure::read('MISP.welcome_logo2')) echo $this->Html->image('custom/' . h(Configure::read('MISP.welcome_logo2')), array('alt' => 'Logo2', 'onerror' => \"this.style.display='none';\")); ?>\n    </td>\n    </tr>\n    </table>\n</div>\n\n<script>\n$(document).ready(function() {\n    $('#UserLoginForm').submit(function(event) {\n        event.preventDefault()\n        submitLoginForm()\n    });\n})\n\nfunction submitLoginForm() {\n    var $form = $('#UserLoginForm')\n    var url = $form.attr('action')\n    var email = $form.find('#UserEmail').val()\n    var password = $form.find('#UserPassword').val()\n    if (!$form[0].checkValidity()) {\n        $form[0].reportValidity()\n    } else {\n        fetchFormDataAjax(url, function(html) {\n            var formHTML = $(html).find('form#UserLoginForm')\n            if (!formHTML.length) {\n                window.location = baseurl + '/users/login'\n            }\n            $('body').append($('<div id=\"temp\" style=\"display: none\"/>').append(formHTML))\n            var $tmpForm = $('#temp form')\n            $tmpForm.find('#UserEmail').val(email)\n            $tmpForm.find('#UserPassword').val(password)\n            $tmpForm.submit()\n        })\n    }\n}\n</script>\n"], "filenames": ["app/View/Users/login.ctp"], "buggy_code_start_loc": [84], "buggy_code_end_loc": [85], "fixing_code_start_loc": [84], "fixing_code_end_loc": [88], "type": "NVD-CWE-noinfo", "message": "An issue was discovered in MISP before 2.4.132. It can perform an unwanted action because of a POST operation on a form that is not linked to the login page.", "other": {"cve": {"id": "CVE-2020-25766", "sourceIdentifier": "cve@mitre.org", "published": "2020-09-18T18:15:17.347", "lastModified": "2020-09-27T23:57:04.177", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in MISP before 2.4.132. It can perform an unwanted action because of a POST operation on a form that is not linked to the login page."}, {"lang": "es", "value": "Se detect\u00f3 un problema en MISP versiones anteriores a 2.4.132.&#xa0;Puede llevar a cabo una acci\u00f3n no deseada debido a una operaci\u00f3n POST en un formulario que no est\u00e1 vinculado a la p\u00e1gina de inicio de sesi\u00f3n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-noinfo"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.132", "matchCriteriaId": "63E968F3-B32D-4878-BAC9-CFF6E4A35953"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/164963100a830234744a6004d5eda55d24e97b2a", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/MISP/MISP/compare/v2.4.131...v2.4.132", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/164963100a830234744a6004d5eda55d24e97b2a"}}