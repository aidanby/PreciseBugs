{"buggy_code": ["<?php\n\nrequire 'ImageUploader.php';\n\n/**\n * Wordpress Auto Upload Images\n * @link http://wordpress.org/plugins/auto-upload-images/\n * @link https://github.com/airani/wp-auto-upload\n * @author Ali Irani <ali@irani.im>\n */\nclass WpAutoUpload\n{\n    const WP_OPTIONS_KEY = 'aui-setting';\n\n    private static $_options;\n\n    /**\n     * WP_Auto_Upload Run.\n     * Set default variables and options\n     * Add wordpress actions\n     */\n    public function run()\n    {\n        add_action('plugins_loaded', array($this, 'initTextdomain'));\n        add_action('admin_menu', array($this, 'addAdminMenu'));\n\n        add_filter('wp_insert_post_data', array($this, 'savePost'), 10, 2);\n    }\n\n    /**\n     * Initial plugin textdomain for translation files\n     */\n    public function initTextdomain()\n    {\n        load_plugin_textdomain('auto-upload-images', false, basename(WPAUI_DIR) . '/src/lang');\n    }\n\n    /**\n     * Automatically upload external images of a post to Wordpress upload directory\n     * call by wp_insert_post_data filter\n     * @param array data An array of slashed post data\n     * @param array $postarr An array of sanitized, but otherwise unmodified post data\n     * @return array $data\n     */\n    public function savePost($data, $postarr)\n    {\n        if (wp_is_post_revision($postarr['ID']) ||\n            wp_is_post_autosave($postarr['ID']) ||\n            (defined('DOING_AJAX') && DOING_AJAX) ||\n            (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)) {\n            return $data;\n        }\n\n        if ($content = $this->save($postarr)) {\n            $data['post_content'] = $content;\n        }\n        return $data;\n    }\n\n    /**\n     * Upload images and save new urls\n     * @return string filtered content\n     */\n    public function save($postarr)\n    {\n        $excludePostTypes = self::getOption('exclude_post_types');\n        if (is_array($excludePostTypes) && in_array($postarr['post_type'], $excludePostTypes, true)) {\n            return false;\n        }\n\n        $content = $postarr['post_content'];\n        $images = $this->findAllImageUrls(stripslashes($content));\n\n        if (count($images) == 0) {\n            return false;\n        }\n\n        foreach ($images as $image) {\n            $uploader = new ImageUploader($image['url'], $image['alt'], $postarr);\n            if ($uploadedImage = $uploader->save()) {\n                $urlParts = parse_url($uploadedImage['url']);\n                $base_url = $uploader::getHostUrl(null, true, true);\n                $image_url = $base_url . $urlParts['path'];\n                $content = preg_replace('/'. preg_quote($image['url'], '/') .'/', $image_url, $content);\n                $content = preg_replace('/alt=[\"\\']'. preg_quote($image['alt'], '/') .'[\"\\']/', \"alt='{$uploader->getAlt()}'\", $content);\n            }\n        }\n        return $content;\n    }\n\n    /**\n     * Find image urls in content and retrieve urls by array\n     * @param $content\n     * @return array\n     */\n    public function findAllImageUrls($content)\n    {\n        $urls1 = array();\n        preg_match_all('/<img[^>]*srcset=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $content, $srcsets, PREG_SET_ORDER);\n        if (count($srcsets) > 0) {\n            $count = 0;\n            foreach ($srcsets as $key => $srcset) {\n                preg_match_all('/(https?:)?\\/\\/[^\\s,]+/i', $srcset[1], $srcsetUrls, PREG_SET_ORDER);\n                if (count($srcsetUrls) == 0) {\n                    continue;\n                }\n                foreach ($srcsetUrls as $srcsetUrl) {\n                    $urls1[$count][] = $srcset[0];\n                    $urls1[$count][] = $srcsetUrl[0];\n                    $count++;\n                }\n            }\n        }\n\n        preg_match_all('/<img[^>]*src=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $content, $urls, PREG_SET_ORDER);\n        $urls = array_merge($urls, $urls1);\n\n        if (count($urls) == 0) {\n            return array();\n        }\n        foreach ($urls as $index => &$url) {\n            $images[$index]['alt'] = preg_match('/<img[^>]*alt=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $url[0], $alt) ? $alt[1] : null;\n            $images[$index]['url'] = $url = $url[1];\n        }\n        foreach (array_unique($urls) as $index => $url) {\n            $unique_array[] = $images[$index];\n        }\n        return $unique_array;\n    }\n\n    /**\n     * Add settings page under options menu\n     */\n    public function addAdminMenu()\n    {\n        add_options_page(\n            __('Auto Upload Images Settings', 'auto-upload-images'),\n            __('Auto Upload Images', 'auto-upload-images'),\n            'manage_options',\n            'auto-upload',\n            array($this, 'settingPage')\n        );\n    }\n\n    /**\n     * Returns options in an array\n     * @return array\n     */\n    public static function getOptions()\n    {\n        if (static::$_options) {\n            return static::$_options;\n        }\n        $defaults = array(\n            'base_url' => get_bloginfo('url'),\n            'image_name' => '%filename%',\n            'alt_name' => '%image_alt%',\n        );\n        return static::$_options = wp_parse_args(get_option(self::WP_OPTIONS_KEY), $defaults);\n    }\n\n    /**\n     * Reset options to default options\n     * @return bool\n     */\n    public static function resetOptionsToDefaults()\n    {\n        $defaults = array(\n            'base_url' => get_bloginfo('url'),\n            'image_name' => '%filename%',\n            'alt_name' => '%image_alt%',\n        );\n        static::$_options = $defaults;\n        return update_option(self::WP_OPTIONS_KEY, $defaults);\n    }\n\n    /**\n     * Return an option with specific key\n     * @param $key\n     * @return mixed\n     */\n    public static function getOption($key, $default = null)\n    {\n        $options = static::getOptions();\n        if (isset($options[$key]) === false) {\n            return $default;\n        }\n        return $options[$key];\n    }\n\n    /**\n     * Settings page contents\n     */\n    public function settingPage()\n    {\n        if (isset($_POST['submit'])) {\n            $fields = array('base_url', 'image_name', 'alt_name', 'exclude_urls', 'max_width', 'max_height', 'exclude_post_types');\n            foreach ($fields as $field) {\n                if (array_key_exists($field, $_POST) && $_POST[$field]) {\n                    static::$_options[$field] = $_POST[$field];\n                }\n            }\n            update_option(self::WP_OPTIONS_KEY, static::$_options);\n            $message = __('Settings Saved.', 'auto-upload-images');\n        }\n\n        if (isset($_POST['reset']) && self::resetOptionsToDefaults()) {\n            $message = __('Successfully settings reset to defaults.', 'auto-upload-images');\n        }\n\n        include_once('setting-page.php');\n    }\n}\n", "<?php if (!defined('ABSPATH')) exit(); ?>\n\n<div class=\"wrap\">\n    <h2><?php _e('Auto Upload Images Settings', 'auto-upload-images'); ?></h2>\n\n    <?php if (isset($message)) : ?>\n    <div id=\"setting-error-settings_updated\" class=\"updated settings-error\">\n        <p><strong><?php echo $message; ?></strong></p>\n    </div>\n    <?php endif; ?>\n\n    <div id=\"poststuff\">\n        <div id=\"post-body\" class=\"metabox-holder columns-2\">\n            <div id=\"post-body-content\" style=\"position: relative\">\n                <div class=\"stuffbox\" style=\"padding: 0 20px\">\n                    <form method=\"POST\">\n                        <table class=\"form-table\">\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"base_url\">\n                                        <?php _e('Base URL:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"base_url\" value=\"<?php echo self::getOption('base_url'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\"><?php _e('If you need to choose a new base URL for the images that will be automatically uploaded. Ex:', 'auto-upload-images'); ?> <code>https://irani.im</code>, <code>https://cdn.irani.im</code>, <code>/</code></p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"image_name\">\n                                        <?php _e('Image Name:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"image_name\" value=\"<?php echo self::getOption('image_name'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\">\n                                        <?php printf(__('Choose a custom filename for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                    </p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"alt_name\">\n                                        <?php _e('Alt Name:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"alt_name\" value=\"<?php echo self::getOption('alt_name'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\">\n                                        <?php printf(__('Choose a custom alt name for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                    </p>\n                                </td>\n                            </tr>\n                            <?php if (function_exists('image_make_intermediate_size')) : ?>\n                                <?php $editor_supports = wp_image_editor_supports(); ?>\n                                <tr valign=\"top\" <?= !$editor_supports ? 'style=\"background-color:#dedede;color:#6d6d6d;opacity:.8;\"' : '' ?>>\n                                    <th scope=\"row\">\n                                        <label <?= !$editor_supports ? 'style=\"color:#6d6d6d;\"' : '' ?>><?php _e('Image Size:', 'auto-upload-images'); ?></label>\n                                        <?php if (!$editor_supports) : ?>\n                                        <small style=\"color:#6d6d6d;\"><?php _e('(Inactive)', 'auto-upload-images') ?></small>\n                                        <?php endif; ?>\n                                    </th>\n                                    <td>\n                                        <label for=\"max_width\"><?php _e('Max Width', 'auto-upload-images'); ?></label>\n                                        <input name=\"max_width\" type=\"number\" step=\"5\" min=\"0\" id=\"max_width\" placeholder=\"600\" class=\"small-text\" value=\"<?php echo self::getOption('max_width'); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                        <label for=\"max_height\"><?php _e('Max Height', 'auto-upload-images'); ?></label>\n                                        <input name=\"max_height\" type=\"number\" step=\"5\" min=\"0\" id=\"max_height\" placeholder=\"400\" class=\"small-text\" value=\"<?php echo self::getOption('max_height'); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                        <p class=\"description\"><?php _e('You can choose max width and height for images uploaded by this plugin on your site. If you leave empty each one of fields by default use the original size of the image.', 'auto-upload-images'); ?></p>\n                                        <?php if (!$editor_supports) : ?>\n                                        <p style=\"color:#535353;font-weight: bold;\"><?php _e('To activate this feature please enable Gd or Imagick extensions of PHP.', 'auto-upload-images') ?></p>\n                                        <?php endif; ?>\n                                    </td>\n                                </tr>\n                            <?php endif; ?>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"exclude_post_types\">\n                                        <?php _e('Exclude Post Types:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <p>\n                                        <?php $excludePostTypes = self::getOption('exclude_post_types'); ?>\n                                        <?php foreach (get_post_types() as $post_type): ?>\n                                            <label>\n                                                <input type=\"checkbox\" name=\"exclude_post_types[]\" value=\"<?php echo $post_type ?>\" <?php echo is_array($excludePostTypes) && in_array($post_type, $excludePostTypes, true) ? 'checked' : ''; ?>> <?php echo $post_type ?>\n                                                <br>\n                                            </label>\n                                        <?php endforeach; ?>\n                                    </p>\n                                    <p class=\"description\"><?php _e('Select the Post Types that you want exclude from automatic uploading', 'auto-upload-images'); ?></p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"exclude_urls\">\n                                        <?php _e('Exclude Domains:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <p><?php _e('Enter the domains you wish to be excluded from uploading images: (One domain per line)', 'auto-upload-images'); ?></p>\n                                    <p><textarea name=\"exclude_urls\" rows=\"10\" cols=\"50\" id=\"exclude_urls\" class=\"large-text code\" placeholder=\"https://irani.im\"><?php echo self::getOption('exclude_urls'); ?></textarea></p>\n                                </td>\n                            </tr>\n                        </table>\n                        <p class=\"submit\">\n                            <?php submit_button(null, 'primary', 'submit', false); ?>\n                            <?php submit_button(__('Reset Options', 'auto-upload-images'), 'small', 'reset', false, array(\n                                'onclick' => 'return confirm(\"'. __('Are you sure to reset all options to defaults?', 'auto-upload-images') .'\");'\n                            )) ?>\n                        </p>\n                    </form>\n                </div>\n            </div>\n            <div id=\"postbox-container-1\" class=\"postbox-container\">\n                <div class=\"postbox\">\n                    <h2 class=\"hndle ui-sortable-handle\"><strong><?php _e('Information', 'auto-upload-images'); ?></strong></h2>\n                    <div class=\"inside\">\n                        <div class=\"main\">\n                            <ul>\n                                <li class=\"dashicons-before dashicons-heart\" style=\"color: #82878c\">\n                                    <a href=\"https://irani.im/wp-auto-upload-images.html#donate\" title=\"Support & Donate\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Support and Donate to the Plugin', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-flag\" style=\"color: #82878c\">\n                                    <a href=\"https://github.com/airani/wp-auto-upload/issues/new\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Report Bug and Issues', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-admin-plugins\" style=\"color: #82878c\">\n                                    <a href=\"https://github.com/airani/wp-auto-upload\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Github Repository', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-wordpress\" style=\"color: #82878c\">\n                                    <a href=\"https://wordpress.org/plugins/auto-upload-images/\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Plugin Page in WP', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-star-filled\" style=\"color: #82878c\">\n                                    <a href=https://wordpress.org/support/plugin/auto-upload-images/reviews/?rate=5#new-post\" style=\"text-decoration: none\" target=\"_blank\">\n                                        <?php _e('Rate to this plugin', 'auto-upload-images'); ?>\n                                    </a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-admin-links\" style=\"color: #82878c\">\n                                    <a href=\"https://irani.im/wp-auto-upload-images.html\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Official Page', 'auto-upload-images'); ?></a>\n                                </li>\n                            </ul>\n                            <hr>\n                            <p><i class=\"dashicons-before dashicons-heart\" style=\"color: #de0000\"></i> <?php _e('If you want to help to plugin development and if you can do so please make a donation to the project and encourage others to do so, for more updates and more features.', 'auto-upload-images'); ?> <a href=\"https://irani.im/wp-auto-upload-images.html#donate\" title=\"Support & Donate\" target=\"_blank\"><?php _e('Make a Donation', 'auto-upload-images') ?></a></p>\n                            <hr>\n                            <p><?php _e('If you are a wp developer and like to contribute to this plugin development or you are a translator and want to have this plugin in your language you can start from <a href=\"https://github.com/airani/wp-auto-upload\" target=\"_blank\">plugin Github repository</a>.', 'auto-upload-images') ?></p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <br class=\"clear\">\n    </div>\n</div>\n"], "fixing_code": ["<?php\n\nrequire 'ImageUploader.php';\n\n/**\n * Wordpress Auto Upload Images\n * @link http://wordpress.org/plugins/auto-upload-images/\n * @link https://github.com/airani/wp-auto-upload\n * @author Ali Irani <ali@irani.im>\n */\nclass WpAutoUpload\n{\n    const WP_OPTIONS_KEY = 'aui-setting';\n\n    private static $_options;\n\n    /**\n     * WP_Auto_Upload Run.\n     * Set default variables and options\n     * Add wordpress actions\n     */\n    public function run()\n    {\n        add_action('plugins_loaded', array($this, 'initTextdomain'));\n        add_action('admin_menu', array($this, 'addAdminMenu'));\n\n        add_filter('wp_insert_post_data', array($this, 'savePost'), 10, 2);\n    }\n\n    /**\n     * Initial plugin textdomain for translation files\n     */\n    public function initTextdomain()\n    {\n        load_plugin_textdomain('auto-upload-images', false, basename(WPAUI_DIR) . '/src/lang');\n    }\n\n    /**\n     * Automatically upload external images of a post to Wordpress upload directory\n     * call by wp_insert_post_data filter\n     * @param array data An array of slashed post data\n     * @param array $postarr An array of sanitized, but otherwise unmodified post data\n     * @return array $data\n     */\n    public function savePost($data, $postarr)\n    {\n        if (wp_is_post_revision($postarr['ID']) ||\n            wp_is_post_autosave($postarr['ID']) ||\n            (defined('DOING_AJAX') && DOING_AJAX) ||\n            (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)) {\n            return $data;\n        }\n\n        if ($content = $this->save($postarr)) {\n            $data['post_content'] = $content;\n        }\n        return $data;\n    }\n\n    /**\n     * Upload images and save new urls\n     * @return string filtered content\n     */\n    public function save($postarr)\n    {\n        $excludePostTypes = self::getOption('exclude_post_types');\n        if (is_array($excludePostTypes) && in_array($postarr['post_type'], $excludePostTypes, true)) {\n            return false;\n        }\n\n        $content = $postarr['post_content'];\n        $images = $this->findAllImageUrls(stripslashes($content));\n\n        if (count($images) == 0) {\n            return false;\n        }\n\n        foreach ($images as $image) {\n            $uploader = new ImageUploader($image['url'], $image['alt'], $postarr);\n            if ($uploadedImage = $uploader->save()) {\n                $urlParts = parse_url($uploadedImage['url']);\n                $base_url = $uploader::getHostUrl(null, true, true);\n                $image_url = $base_url . $urlParts['path'];\n                $content = preg_replace('/'. preg_quote($image['url'], '/') .'/', $image_url, $content);\n                $content = preg_replace('/alt=[\"\\']'. preg_quote($image['alt'], '/') .'[\"\\']/', \"alt='{$uploader->getAlt()}'\", $content);\n            }\n        }\n        return $content;\n    }\n\n    /**\n     * Find image urls in content and retrieve urls by array\n     * @param $content\n     * @return array\n     */\n    public function findAllImageUrls($content)\n    {\n        $urls1 = array();\n        preg_match_all('/<img[^>]*srcset=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $content, $srcsets, PREG_SET_ORDER);\n        if (count($srcsets) > 0) {\n            $count = 0;\n            foreach ($srcsets as $key => $srcset) {\n                preg_match_all('/(https?:)?\\/\\/[^\\s,]+/i', $srcset[1], $srcsetUrls, PREG_SET_ORDER);\n                if (count($srcsetUrls) == 0) {\n                    continue;\n                }\n                foreach ($srcsetUrls as $srcsetUrl) {\n                    $urls1[$count][] = $srcset[0];\n                    $urls1[$count][] = $srcsetUrl[0];\n                    $count++;\n                }\n            }\n        }\n\n        preg_match_all('/<img[^>]*src=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $content, $urls, PREG_SET_ORDER);\n        $urls = array_merge($urls, $urls1);\n\n        if (count($urls) == 0) {\n            return array();\n        }\n        foreach ($urls as $index => &$url) {\n            $images[$index]['alt'] = preg_match('/<img[^>]*alt=[\"\\']([^\"\\']*)[^\"\\']*[\"\\'][^>]*>/i', $url[0], $alt) ? $alt[1] : null;\n            $images[$index]['url'] = $url = $url[1];\n        }\n        foreach (array_unique($urls) as $index => $url) {\n            $unique_array[] = $images[$index];\n        }\n        return $unique_array;\n    }\n\n    /**\n     * Add settings page under options menu\n     */\n    public function addAdminMenu()\n    {\n        add_options_page(\n            __('Auto Upload Images Settings', 'auto-upload-images'),\n            __('Auto Upload Images', 'auto-upload-images'),\n            'manage_options',\n            'auto-upload',\n            array($this, 'settingPage')\n        );\n    }\n\n    /**\n     * Returns options in an array\n     * @return array\n     */\n    public static function getOptions()\n    {\n        if (static::$_options) {\n            return static::$_options;\n        }\n        $defaults = array(\n            'base_url' => get_bloginfo('url'),\n            'image_name' => '%filename%',\n            'alt_name' => '%image_alt%',\n        );\n        return static::$_options = wp_parse_args(get_option(self::WP_OPTIONS_KEY), $defaults);\n    }\n\n    /**\n     * Reset options to default options\n     * @return bool\n     */\n    public static function resetOptionsToDefaults()\n    {\n        $defaults = array(\n            'base_url' => get_bloginfo('url'),\n            'image_name' => '%filename%',\n            'alt_name' => '%image_alt%',\n        );\n        static::$_options = $defaults;\n        return update_option(self::WP_OPTIONS_KEY, $defaults);\n    }\n\n    /**\n     * Return an option with specific key\n     * @param $key\n     * @return mixed\n     */\n    public static function getOption($key, $default = null)\n    {\n        $options = static::getOptions();\n        if (isset($options[$key]) === false) {\n            return $default;\n        }\n        return $options[$key];\n    }\n\n    /**\n     * Settings page contents\n     */\n    public function settingPage()\n    {\n        if (isset($_POST['submit']) && check_admin_referer('aui_settings')) {\n            $fields = array('base_url', 'image_name', 'alt_name', 'exclude_urls', 'max_width', 'max_height', 'exclude_post_types');\n            foreach ($fields as $field) {\n                if (array_key_exists($field, $_POST) && $_POST[$field]) {\n                    static::$_options[$field] = esc_attr($_POST[$field]);\n                }\n            }\n            update_option(self::WP_OPTIONS_KEY, static::$_options);\n            $message = __('Settings Saved.', 'auto-upload-images');\n        }\n\n        if (isset($_POST['reset']) && self::resetOptionsToDefaults()) {\n            $message = __('Successfully settings reset to defaults.', 'auto-upload-images');\n        }\n\n        include_once('setting-page.php');\n    }\n}\n", "<?php if (!defined('ABSPATH')) exit(); ?>\n\n<div class=\"wrap\">\n    <h2><?php _e('Auto Upload Images Settings', 'auto-upload-images'); ?></h2>\n\n    <?php if (isset($message)) : ?>\n    <div id=\"setting-error-settings_updated\" class=\"updated settings-error\">\n        <p><strong><?php echo $message; ?></strong></p>\n    </div>\n    <?php endif; ?>\n\n    <div id=\"poststuff\">\n        <div id=\"post-body\" class=\"metabox-holder columns-2\">\n            <div id=\"post-body-content\" style=\"position: relative\">\n                <div class=\"stuffbox\" style=\"padding: 0 20px\">\n                    <form method=\"POST\">\n                        <?php echo wp_nonce_field('aui_settings'); ?>\n                        <table class=\"form-table\">\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"base_url\">\n                                        <?php _e('Base URL:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"base_url\" value=\"<?php echo esc_attr(self::getOption('base_url')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\"><?php _e('If you need to choose a new base URL for the images that will be automatically uploaded. Ex:', 'auto-upload-images'); ?> <code>https://irani.im</code>, <code>https://cdn.irani.im</code>, <code>/</code></p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"image_name\">\n                                        <?php _e('Image Name:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"image_name\" value=\"<?php echo esc_attr(self::getOption('image_name')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\">\n                                        <?php printf(__('Choose a custom filename for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                    </p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"alt_name\">\n                                        <?php _e('Alt Name:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <input type=\"text\" name=\"alt_name\" value=\"<?php echo esc_attr(self::getOption('alt_name')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                    <p class=\"description\">\n                                        <?php printf(__('Choose a custom alt name for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                    </p>\n                                </td>\n                            </tr>\n                            <?php if (function_exists('image_make_intermediate_size')) : ?>\n                                <?php $editor_supports = wp_image_editor_supports(); ?>\n                                <tr valign=\"top\" <?= !$editor_supports ? 'style=\"background-color:#dedede;color:#6d6d6d;opacity:.8;\"' : '' ?>>\n                                    <th scope=\"row\">\n                                        <label <?= !$editor_supports ? 'style=\"color:#6d6d6d;\"' : '' ?>><?php _e('Image Size:', 'auto-upload-images'); ?></label>\n                                        <?php if (!$editor_supports) : ?>\n                                        <small style=\"color:#6d6d6d;\"><?php _e('(Inactive)', 'auto-upload-images') ?></small>\n                                        <?php endif; ?>\n                                    </th>\n                                    <td>\n                                        <label for=\"max_width\"><?php _e('Max Width', 'auto-upload-images'); ?></label>\n                                        <input name=\"max_width\" type=\"number\" step=\"5\" min=\"0\" id=\"max_width\" placeholder=\"600\" class=\"small-text\" value=\"<?php echo esc_attr(self::getOption('max_width')); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                        <label for=\"max_height\"><?php _e('Max Height', 'auto-upload-images'); ?></label>\n                                        <input name=\"max_height\" type=\"number\" step=\"5\" min=\"0\" id=\"max_height\" placeholder=\"400\" class=\"small-text\" value=\"<?php echo esc_attr(self::getOption('max_height')); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                        <p class=\"description\"><?php _e('You can choose max width and height for images uploaded by this plugin on your site. If you leave empty each one of fields by default use the original size of the image.', 'auto-upload-images'); ?></p>\n                                        <?php if (!$editor_supports) : ?>\n                                        <p style=\"color:#535353;font-weight: bold;\"><?php _e('To activate this feature please enable Gd or Imagick extensions of PHP.', 'auto-upload-images') ?></p>\n                                        <?php endif; ?>\n                                    </td>\n                                </tr>\n                            <?php endif; ?>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"exclude_post_types\">\n                                        <?php _e('Exclude Post Types:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <p>\n                                        <?php $excludePostTypes = self::getOption('exclude_post_types'); ?>\n                                        <?php foreach (get_post_types() as $post_type): ?>\n                                            <label>\n                                                <input type=\"checkbox\" name=\"exclude_post_types[]\" value=\"<?php echo esc_attr($post_type) ?>\" <?php echo is_array($excludePostTypes) && in_array($post_type, $excludePostTypes, true) ? 'checked' : ''; ?>> <?php echo esc_attr($post_type) ?>\n                                                <br>\n                                            </label>\n                                        <?php endforeach; ?>\n                                    </p>\n                                    <p class=\"description\"><?php _e('Select the Post Types that you want exclude from automatic uploading', 'auto-upload-images'); ?></p>\n                                </td>\n                            </tr>\n                            <tr valign=\"top\">\n                                <th scope=\"row\">\n                                    <label for=\"exclude_urls\">\n                                        <?php _e('Exclude Domains:', 'auto-upload-images'); ?>\n                                    </label>\n                                </th>\n                                <td>\n                                    <p><?php _e('Enter the domains you wish to be excluded from uploading images: (One domain per line)', 'auto-upload-images'); ?></p>\n                                    <p><textarea name=\"exclude_urls\" rows=\"10\" cols=\"50\" id=\"exclude_urls\" class=\"large-text code\" placeholder=\"https://irani.im\"><?php echo esc_textarea(self::getOption('exclude_urls')); ?></textarea></p>\n                                </td>\n                            </tr>\n                        </table>\n                        <p class=\"submit\">\n                            <?php submit_button(null, 'primary', 'submit', false); ?>\n                            <?php submit_button(__('Reset Options', 'auto-upload-images'), 'small', 'reset', false, array(\n                                'onclick' => 'return confirm(\"'. __('Are you sure to reset all options to defaults?', 'auto-upload-images') .'\");'\n                            )) ?>\n                        </p>\n                    </form>\n                </div>\n            </div>\n            <div id=\"postbox-container-1\" class=\"postbox-container\">\n                <div class=\"postbox\">\n                    <h2 class=\"hndle ui-sortable-handle\"><strong><?php _e('Information', 'auto-upload-images'); ?></strong></h2>\n                    <div class=\"inside\">\n                        <div class=\"main\">\n                            <ul>\n                                <li class=\"dashicons-before dashicons-heart\" style=\"color: #82878c\">\n                                    <a href=\"https://irani.im/wp-auto-upload-images.html#donate\" title=\"Support & Donate\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Support and Donate to the Plugin', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-flag\" style=\"color: #82878c\">\n                                    <a href=\"https://github.com/airani/wp-auto-upload/issues/new\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Report Bug and Issues', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-admin-plugins\" style=\"color: #82878c\">\n                                    <a href=\"https://github.com/airani/wp-auto-upload\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Github Repository', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-wordpress\" style=\"color: #82878c\">\n                                    <a href=\"https://wordpress.org/plugins/auto-upload-images/\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Plugin Page in WP', 'auto-upload-images'); ?></a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-star-filled\" style=\"color: #82878c\">\n                                    <a href=https://wordpress.org/support/plugin/auto-upload-images/reviews/?rate=5#new-post\" style=\"text-decoration: none\" target=\"_blank\">\n                                        <?php _e('Rate to this plugin', 'auto-upload-images'); ?>\n                                    </a>\n                                </li>\n                                <li class=\"dashicons-before dashicons-admin-links\" style=\"color: #82878c\">\n                                    <a href=\"https://irani.im/wp-auto-upload-images.html\" style=\"text-decoration: none\" target=\"_blank\"><?php _e('Official Page', 'auto-upload-images'); ?></a>\n                                </li>\n                            </ul>\n                            <hr>\n                            <p><i class=\"dashicons-before dashicons-heart\" style=\"color: #de0000\"></i> <?php _e('If you want to help to plugin development and if you can do so please make a donation to the project and encourage others to do so, for more updates and more features.', 'auto-upload-images'); ?> <a href=\"https://irani.im/wp-auto-upload-images.html#donate\" title=\"Support & Donate\" target=\"_blank\"><?php _e('Make a Donation', 'auto-upload-images') ?></a></p>\n                            <hr>\n                            <p><?php _e('If you are a wp developer and like to contribute to this plugin development or you are a translator and want to have this plugin in your language you can start from <a href=\"https://github.com/airani/wp-auto-upload\" target=\"_blank\">plugin Github repository</a>.', 'auto-upload-images') ?></p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <br class=\"clear\">\n    </div>\n</div>\n"], "filenames": ["src/WpAutoUpload.php", "src/setting-page.php"], "buggy_code_start_loc": [196, 16], "buggy_code_end_loc": [201, 104], "fixing_code_start_loc": [196, 17], "fixing_code_end_loc": [201, 105], "type": "CWE-79", "message": "A vulnerability has been found in Auto Upload Images up to 3.3.0 and classified as problematic. Affected by this vulnerability is an unknown functionality. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 3.3.1 is able to address this issue. The name of the patch is 895770ee93887ec78429c78ffdfb865bee6f9436. It is recommended to upgrade the affected component. The identifier VDB-216481 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2022-4632", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-21T19:15:15.207", "lastModified": "2022-12-30T21:52:08.867", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability has been found in Auto Upload Images up to 3.3.0 and classified as problematic. Affected by this vulnerability is an unknown functionality. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 3.3.1 is able to address this issue. The name of the patch is 895770ee93887ec78429c78ffdfb865bee6f9436. It is recommended to upgrade the affected component. The identifier VDB-216481 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:auto_upload_images_project:auto_upload_images:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "3.3.1", "matchCriteriaId": "7CBA2610-4EAC-4717-8A61-860CF1B3336B"}]}]}], "references": [{"url": "https://github.com/airani/wp-auto-upload/commit/895770ee93887ec78429c78ffdfb865bee6f9436", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/airani/wp-auto-upload/releases/tag/v3.3.1", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216481", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/airani/wp-auto-upload/commit/895770ee93887ec78429c78ffdfb865bee6f9436"}}