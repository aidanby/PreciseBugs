{"buggy_code": ["<?php\n/*\n * This file is part of pluck, the easy content management system\n * Copyright (c) pluck team\n * http://www.pluck-cms.org\n\n * Pluck is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * See docs/COPYING for the complete license.\n*/\n\n//Make sure the file isn't accessed directly.\ndefined('IN_PLUCK') or exit('Access denied!');\n\n//Introduction text.\n?>\n<p>\n\t<strong><?php echo $lang['images']['message']; ?></strong>\n</p>\n<?php run_hook('admin_images_before'); ?>\n<div class=\"menudiv\" style=\"display: inline-block; margin-top: 0;\">\n\t<span>\n\t\t<img src=\"data/image/image.png\" alt=\"\" />\n\t</span>\n\t<form name=\"form1\" method=\"post\" action=\"\" enctype=\"multipart/form-data\" style=\"display: inline-block;\">\n\t\t<input type=\"file\" name=\"imagefile\" />\n\t\t<input type=\"submit\" name=\"submit\" value=\"<?php echo $lang['general']['upload']; ?>\" />\n\t</form>\n</div>\n<?php\nif (isset($_POST['submit'])) {\n\t//Check if the file is JPG, PNG or GIF.\n\tif (in_array($_FILES['imagefile']['type'], array('image/pjpeg', 'image/jpeg','image/png', 'image/gif'))) {\n\t\tif (!copy($_FILES['imagefile']['tmp_name'], 'images/'.$_FILES['imagefile']['name']))\n\t\t\tshow_error($lang['general']['upload_failed'], 1);\n\n\t\telse {\n\t\t\tchmod('images/'.$_FILES['imagefile']['name'], 0666);\n\t\t\t?>\n\t\t\t\t<div class=\"menudiv\">\n\t\t\t\t\t<strong><?php echo $lang['images']['name']; ?></strong> <?php echo $_FILES['imagefile']['name']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['size']; ?></strong> <?php echo $_FILES['imagefile']['size'].' '.$lang['images']['bytes']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['type']; ?></strong> <?php echo $_FILES['imagefile']['type']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['success']; //TODO: Need to show this message another place, and with show_error(). ?></strong>\n\t\t\t\t</div>\n\t\t\t<?php\n\t\t}\n\t}\n}\n\n//Display list of uploaded pictures.\n?>\n<span class=\"kop2\"><?php echo $lang['images']['uploaded']; ?></span>\n<?php\n//Show the uploaded images\n$images = read_dir_contents('images', 'files');\n\tif ($images) {\n\t\tnatcasesort($images);\n\t\tforeach ($images as $image) {\n\t\t?>\n\t\t\t<div class=\"menudiv\">\n\t\t\t\t<span>\n\t\t\t\t\t<img src=\"data/image/image.png\" alt=\"\" />\n\t\t\t\t</span>\n\t\t\t\t<span class=\"title-page\"><?php echo $image; ?></span>\n\t\t\t\t<span>\n\t\t\t\t\t<a href=\"images/<?php echo $image; ?>\" target=\"_blank\">\n\t\t\t\t\t\t<img src=\"data/image/view.png\" alt=\"\" />\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t\t<span>\n\t\t\t\t\t<a href=\"?action=deleteimage&amp;var1=<?php echo $image; ?>\">\n\t\t\t\t\t\t<img src=\"data/image/delete.png\" title=\"<?php echo $lang['trashcan']['move_to_trash']; ?>\" alt=\"<?php echo $lang['trashcan']['move_to_trash']; ?>\" />\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<?php\n\t\t}\n\t\tunset($images);\n\t}\n\telse\n\t\techo '<span class=\"kop4\">'.$lang['general']['nothing_yet'].'</span>';\n?>\n<p style=\"margin-top: 10px;\">\n\t<a href=\"?action=page\">&lt;&lt;&lt; <?php echo $lang['general']['back']; ?></a>\n</p>"], "fixing_code": ["<?php\n/*\n * This file is part of pluck, the easy content management system\n * Copyright (c) pluck team\n * http://www.pluck-cms.org\n\n * Pluck is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * See docs/COPYING for the complete license.\n*/\n\n//Make sure the file isn't accessed directly.\ndefined('IN_PLUCK') or exit('Access denied!');\n\n//Introduction text.\n?>\n<p>\n\t<strong><?php echo $lang['images']['message']; ?></strong>\n</p>\n<?php run_hook('admin_images_before'); ?>\n<div class=\"menudiv\" style=\"display: inline-block; margin-top: 0;\">\n\t<span>\n\t\t<img src=\"data/image/image.png\" alt=\"\" />\n\t</span>\n\t<form name=\"form1\" method=\"post\" action=\"\" enctype=\"multipart/form-data\" style=\"display: inline-block;\">\n\t\t<input type=\"file\" name=\"imagefile\" />\n\t\t<input type=\"submit\" name=\"submit\" value=\"<?php echo $lang['general']['upload']; ?>\" />\n\t</form>\n</div>\n<?php\nif (isset($_POST['submit'])) {\n\t//Check if the file is JPG, PNG or GIF.\n\tif (in_array($_FILES['imagefile']['type'], array('image/pjpeg', 'image/jpeg','image/png', 'image/gif'))) {\n\t\t/* fix issue 44. Thanks to Klaus.  */\n        $imagewhitelist = array('jfif', '.png', '.jpg', '.gif', 'jpeg');  \n        if (!in_array(strtolower(substr($_FILES['imagefile']['name'], -4)), $imagewhitelist))\n\t\t\tshow_error($lang['general']['upload_failed'], 1);\n\t\t/* end of fix issue 44. Thanks to Klaus.  */\n\t\tif (!copy($_FILES['imagefile']['tmp_name'], 'images/'.$_FILES['imagefile']['name']))\n\t\t\tshow_error($lang['general']['upload_failed'], 1);\n\t\telse {\n\t\t\tchmod('images/'.$_FILES['imagefile']['name'], 0666);\n\t\t\t?>\n\t\t\t\t<div class=\"menudiv\">\n\t\t\t\t\t<strong><?php echo $lang['images']['name']; ?></strong> <?php echo $_FILES['imagefile']['name']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['size']; ?></strong> <?php echo $_FILES['imagefile']['size'].' '.$lang['images']['bytes']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['type']; ?></strong> <?php echo $_FILES['imagefile']['type']; ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<strong><?php echo $lang['images']['success']; //TODO: Need to show this message another place, and with show_error(). ?></strong>\n\t\t\t\t</div>\n\t\t\t<?php\n\t\t}\n\t}\n}\n\n//Display list of uploaded pictures.\n?>\n<span class=\"kop2\"><?php echo $lang['images']['uploaded']; ?></span>\n<?php\n//Show the uploaded images\n$images = read_dir_contents('images', 'files');\n\tif ($images) {\n\t\tnatcasesort($images);\n\t\tforeach ($images as $image) {\n\t\t?>\n\t\t\t<div class=\"menudiv\">\n\t\t\t\t<span>\n\t\t\t\t\t<img src=\"data/image/image.png\" alt=\"\" />\n\t\t\t\t</span>\n\t\t\t\t<span class=\"title-page\"><?php echo $image; ?></span>\n\t\t\t\t<span>\n\t\t\t\t\t<a href=\"images/<?php echo $image; ?>\" target=\"_blank\">\n\t\t\t\t\t\t<img src=\"data/image/view.png\" alt=\"\" />\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t\t<span>\n\t\t\t\t\t<a href=\"?action=deleteimage&amp;var1=<?php echo $image; ?>\">\n\t\t\t\t\t\t<img src=\"data/image/delete.png\" title=\"<?php echo $lang['trashcan']['move_to_trash']; ?>\" alt=\"<?php echo $lang['trashcan']['move_to_trash']; ?>\" />\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<?php\n\t\t}\n\t\tunset($images);\n\t}\n\telse\n\t\techo '<span class=\"kop4\">'.$lang['general']['nothing_yet'].'</span>';\n?>\n<p style=\"margin-top: 10px;\">\n\t<a href=\"?action=page\">&lt;&lt;&lt; <?php echo $lang['general']['back']; ?></a>\n</p>"], "filenames": ["data/inc/images.php"], "buggy_code_start_loc": [36], "buggy_code_end_loc": [40], "fixing_code_start_loc": [37], "fixing_code_end_loc": [43], "type": "CWE-434", "message": "PluckCMS 4.7.4 and earlier is affected by: CWE-434 Unrestricted Upload of File with Dangerous Type. The impact is: get webshell. The component is: data/inc/images.php line36. The attack vector is: modify the MIME TYPE on HTTP request to upload a php file. The fixed version is: after commit 09f0ab871bf633973cfd9fc4fe59d4a912397cf8.", "other": {"cve": {"id": "CVE-2019-1010062", "sourceIdentifier": "josh@bress.net", "published": "2019-07-16T13:15:11.410", "lastModified": "2019-10-09T23:44:13.773", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "PluckCMS 4.7.4 and earlier is affected by: CWE-434 Unrestricted Upload of File with Dangerous Type. The impact is: get webshell. The component is: data/inc/images.php line36. The attack vector is: modify the MIME TYPE on HTTP request to upload a php file. The fixed version is: after commit 09f0ab871bf633973cfd9fc4fe59d4a912397cf8."}, {"lang": "es", "value": "PluckCMS versiones 4.7.4 y anteriores, est\u00e1n afectados por: CWE-434 Carga de Archivos de Tipo Dangerous Sin Restricciones. El impacto es: obtener webshell. El componente es: el archivo data/inc/images.php line36. El vector de ataque es: modificar el TIPO MIME  en la petici\u00f3n HTTP para cargar un archivo php. La versi\u00f3n corregida es: despu\u00e9s del commit 09f0ab871bf633973cfd9fc4fe59d4a912397cf8."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-434"}]}, {"source": "josh@bress.net", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-434"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pluck-cms:pluckcms:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.7.4", "matchCriteriaId": "864B3716-962D-4BC2-8A56-E483D47AB4B7"}]}]}], "references": [{"url": "https://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8", "source": "josh@bress.net", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/pluck-cms/pluck/issues/44", "source": "josh@bress.net", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8"}}