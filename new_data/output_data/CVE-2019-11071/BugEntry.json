{"buggy_code": ["<?php\n\n/*\n * ecran_securite.php\n * ------------------\n */\n\ndefine('_ECRAN_SECURITE', '1.3.10'); // 2019-02-12\n\n/*\n * Documentation : http://www.spip.net/fr_article4200.html\n */\n\n/*\n * Test utilisateur\n */\nif (isset($_GET['test_ecran_securite']))\n\t$ecran_securite_raison = 'test '._ECRAN_SECURITE;\n\n/*\n * Monitoring\n * var_isbot=0 peut etre utilise par un bot de monitoring pour surveiller la disponibilite d'un site vu par les users\n * var_isbot=1 peut etre utilise pour monitorer la disponibilite pour les bots (sujets a 503 de delestage si\n * le load depasse ECRAN_SECURITE_LOAD)\n */\nif (!defined('_IS_BOT') and isset($_GET['var_isbot'])){\n\tdefine('_IS_BOT', $_GET['var_isbot'] ? true : false);\n}\n\n/*\n * D\u00e9tecteur de robot d'indexation\n */\nif (!defined('_IS_BOT')){\n\tdefine('_IS_BOT',\n\t\tisset($_SERVER['HTTP_USER_AGENT'])\n\t\tand preg_match(','\n\t\t. implode ('|', array(\n\t\t\t// mots generiques\n\t\t\t'bot',\n\t\t\t'slurp',\n\t\t\t'crawler',\n\t\t\t'crwlr',\n\t\t\t'java',\n\t\t\t'monitoring',\n\t\t\t'spider',\n\t\t\t'webvac',\n\t\t\t'yandex',\n\t\t\t'MSIE 6\\.0', // botnet 99,9% du temps\n\t\t\t// UA plus cibles \n\t\t\t'200please',\n\t\t\t'80legs',\n\t\t\t'a6-indexer',\n\t\t\t'aboundex',\n\t\t\t'accoona',\n\t\t\t'acrylicapps',\n\t\t\t'addthis',\n\t\t\t'adressendeutschland',\n\t\t\t'alexa',\n\t\t\t'altavista',\n\t\t\t'analyticsseo',\n\t\t\t'antennapod',\n\t\t\t'arachnys',\n\t\t\t'archive',\n\t\t\t'argclrint',\n\t\t\t'aspseek',\n\t\t\t'baidu',\n\t\t\t'begunadvertising',\n\t\t\t'bing',\n\t\t\t'bloglines',\n\t\t\t'buck',\n\t\t\t'browsershots',\n\t\t\t'bubing',\n\t\t\t'butterfly',\n\t\t\t'changedetection',\n\t\t\t'charlotte',\n\t\t\t'chilkat',\n\t\t\t'china',\n\t\t\t'coccoc',\n\t\t\t'crowsnest',\n\t\t\t'dataminr',\n\t\t\t'daumoa',\n\t\t\t'dlvr\\.it',\n\t\t\t'dlweb',\n\t\t\t'drupal',\n\t\t\t'ec2linkfinder',\n\t\t\t'eset\\.com',\n\t\t\t'estyle',\n\t\t\t'exalead',\n\t\t\t'ezooms',\n\t\t\t'facebookexternalhit',\n\t\t\t'facebookplatform',\n\t\t\t'fairshare',\n\t\t\t'feedfetcher',\n\t\t\t'feedfetcher-google',\n\t\t\t'feedly',\n\t\t\t'fetch',\n\t\t\t'flipboardproxy',\n\t\t\t'genieo',\n\t\t\t'google',\n\t\t\t'go-http-client',\n\t\t\t'grapeshot',\n\t\t\t'hatena-useragent',\n\t\t\t'head',\n\t\t\t'hosttracker',\n\t\t\t'hubspot',\n\t\t\t'ia_archiver',\n\t\t\t'ichiro',\n\t\t\t'iltrovatore-setaccio',\n\t\t\t'immediatenet',\n\t\t\t'ina',\n\t\t\t'inoreader',\n\t\t\t'infegyatlas',\n\t\t\t'infohelfer',\n\t\t\t'instapaper',\n\t\t\t'jabse',\n\t\t\t'james',\n\t\t\t'jersey',\n\t\t\t'kumkie',\n\t\t\t'linkdex',\n\t\t\t'linkfluence',\n\t\t\t'linkwalker',\n\t\t\t'litefinder',\n\t\t\t'loadimpactpageanalyzer',\n\t\t\t'ltx71',\n\t\t\t'luminate',\n\t\t\t'lycos',\n\t\t\t'lycosa',\n\t\t\t'mediapartners-google',\n\t\t\t'msai',\n\t\t\t'myapp',\n\t\t\t'nativehost',\n\t\t\t'najdi',\n\t\t\t'netcraftsurveyagent',\n\t\t\t'netestate',\n\t\t\t'netseer',\n\t\t\t'netnewswire',\n\t\t\t'newspaper',\n\t\t\t'newsblur',\n\t\t\t'nuhk',\n\t\t\t'nuzzel',\n\t\t\t'okhttp',\n\t\t\t'otmedia',\n\t\t\t'owlin',\n\t\t\t'owncloud',\n\t\t\t'panscient',\n\t\t\t'paper\\.li',\n\t\t\t'parsijoo',\n\t\t\t'protopage',\n\t\t\t'plukkie',\n\t\t\t'proximic',\n\t\t\t'pubsub',\n\t\t\t'python',\n\t\t\t'qirina',\n\t\t\t'qoshe',\n\t\t\t'qualidator',\n\t\t\t'qwantify',\n\t\t\t'rambler',\n\t\t\t'readability',\n\t\t\t'ruby',\n\t\t\t'sbsearch',\n\t\t\t'scoop\\.it',\n\t\t\t'scooter',\n\t\t\t'scoutjet',\n\t\t\t'scrapy',\n\t\t\t'scrubby',\n\t\t\t'scrubbybloglines',\n\t\t\t'shareaholic',\n\t\t\t'shopwiki',\n\t\t\t'simplepie',\n\t\t\t'sistrix',\n\t\t\t'sitechecker',\n\t\t\t'siteexplorer',\n\t\t\t'snapshot',\n\t\t\t'sogou',\n\t\t\t'special_archiver',\n\t\t\t'speedy',\n\t\t\t'spinn3r',\n\t\t\t'spreadtrum',\n\t\t\t'steeler',\n\t\t\t'subscriber',\n\t\t\t'suma',\n\t\t\t'superdownloads',\n\t\t\t'svenska-webbsido',\n\t\t\t'teoma',\n\t\t\t'the knowledge AI',\n\t\t\t'thumbshots',\n\t\t\t'tineye',\n\t\t\t'traackr',\n\t\t\t'trendiction',\n\t\t\t'trendsmap',\n\t\t\t'tweetedtimes',\n\t\t\t'tweetmeme',\n\t\t\t'universalfeedparser',\n\t\t\t'uaslinkchecker',\n\t\t\t'undrip',\n\t\t\t'unwindfetchor',\n\t\t\t'upday',\n\t\t\t'vedma',\n\t\t\t'vkshare',\n\t\t\t'vm',\n\t\t\t'wch',\n\t\t\t'webalta',\n\t\t\t'webcookies',\n\t\t\t'webparser',\n\t\t\t'webthumbnail',\n\t\t\t'wesee',\n\t\t\t'wise-guys',\n\t\t\t'woko',\n\t\t\t'wordpress',\n\t\t\t'wotbox',\n\t\t\t'y!j-bri',\n\t\t\t'y!j-bro',\n\t\t\t'y!j-brw',\n\t\t\t'y!j-bsc',\n\t\t\t'yahoo',\n\t\t\t'yahoo!',\n\t\t\t'yahooysmcm',\n\t\t\t'ymobactus',\n\t\t\t'yats',\n\t\t\t'yeti',\n\t\t\t'zeerch'\n\t\t)) . ',i',\n\t\t(string)$_SERVER['HTTP_USER_AGENT'])\n\t);\n}\nif (!defined('_IS_BOT_FRIEND')){\n\tdefine('_IS_BOT_FRIEND',\n\t\tisset($_SERVER['HTTP_USER_AGENT'])\n\t\tand preg_match(',' . implode ('|', array(\n\t\t\t'facebookexternalhit',\n\t\t\t'flipboardproxy',\n\t\t\t'wordpress'\n\t\t)) . ',i',\n\t\t(string)$_SERVER['HTTP_USER_AGENT'])\n\t);\n}\n\n/*\n * Interdit de passer une variable id_article (ou id_xxx) qui ne\n * soit pas num\u00e9rique (ce qui bloque l'exploitation de divers trous\n * de s\u00e9curit\u00e9, dont celui de toutes les versions < 1.8.2f)\n * (sauf pour id_table, qui n'est pas num\u00e9rique jusqu'\u00e0 [5743])\n * (id_base est une variable de la config des widgets de WordPress)\n */\n$_exceptions = array('id_table','id_base','id_parent','id_article_pdf');\nforeach ($_GET as $var => $val)\n\tif ($_GET[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$_GET[$var] = is_array($_GET[$var])?@array_map('intval', $_GET[$var]):intval($_GET[$var]);\nforeach ($_POST as $var => $val)\n\tif ($_POST[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$_POST[$var] = is_array($_POST[$var])?@array_map('intval', $_POST[$var]):intval($_POST[$var]);\nforeach ($GLOBALS as $var => $val)\n\tif ($GLOBALS[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$GLOBALS[$var] = is_array($GLOBALS[$var])?@array_map('intval', $GLOBALS[$var]):intval($GLOBALS[$var]);\n\n/*\n * Interdit la variable $cjpeg_command, qui \u00e9tait utilis\u00e9e sans\n * pr\u00e9caution dans certaines versions de dev (1.8b2 -> 1.8b5)\n */\n$cjpeg_command = '';\n\n/*\n * Contr\u00f4le de quelques variables (XSS)\n */\nforeach(array('lang', 'var_recherche', 'aide', 'var_lang_r', 'lang_r', 'var_ajax_ancre', 'nom_fichier') as $var) {\n\tif (isset($_GET[$var]))\n\t\t$_REQUEST[$var] = $GLOBALS[$var] = $_GET[$var] = preg_replace(',[^\\w\\,/#&;-]+,', ' ', (string)$_GET[$var]);\n\tif (isset($_POST[$var]))\n\t\t$_REQUEST[$var] = $GLOBALS[$var] = $_POST[$var] = preg_replace(',[^\\w\\,/#&;-]+,', ' ', (string)$_POST[$var]);\n}\n\n/*\n * Filtre l'acc\u00e8s \u00e0 spip_acces_doc (injection SQL en 1.8.2x)\n */\nif (preg_match(',^(.*/)?spip_acces_doc\\.,', (string)$_SERVER['REQUEST_URI'])) {\n\t$file = addslashes((string)$_GET['file']);\n}\n\n/*\n * Pas d'inscription abusive\n */\nif (isset($_REQUEST['mode']) and isset($_REQUEST['page'])\nand !in_array($_REQUEST['mode'], array(\"6forum\", \"1comite\"))\nand $_REQUEST['page'] == \"identifiants\")\n\t$ecran_securite_raison = \"identifiants\";\n\n/*\n * Agenda joue \u00e0 l'injection php\n */\nif (isset($_REQUEST['partie_cal'])\nand $_REQUEST['partie_cal'] !== htmlentities((string)$_REQUEST['partie_cal']))\n\t$ecran_securite_raison = \"partie_cal\";\nif (isset($_REQUEST['echelle'])\nand $_REQUEST['echelle'] !== htmlentities((string)$_REQUEST['echelle']))\n\t$ecran_securite_raison = \"echelle\";\n\n/*\n * Espace priv\u00e9\n */\nif (isset($_REQUEST['exec'])\nand !preg_match(',^[\\w-]+$,', (string)$_REQUEST['exec']))\n\t$ecran_securite_raison = \"exec\";\nif (isset($_REQUEST['cherche_auteur'])\nand preg_match(',[<],', (string)$_REQUEST['cherche_auteur']))\n\t$ecran_securite_raison = \"cherche_auteur\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'auteurs'\nand preg_match(',[<],', (string)$_REQUEST['recherche']))\n\t$ecran_securite_raison = \"recherche\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'info_plugin'\nand preg_match(',[<],', (string)$_REQUEST['plugin']))\n\t$ecran_securite_raison = \"plugin\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'puce_statut'\nand isset($_REQUEST['id'])\nand !intval($_REQUEST['id']))\n\t$ecran_securite_raison = \"puce_statut\";\nif (isset($_REQUEST['action'])\nand $_REQUEST['action'] == 'configurer') {\n\tif (@file_exists('inc_version.php')\n\tor @file_exists('ecrire/inc_version.php')) {\n\t\tfunction action_configurer() {\n\t\t\tinclude_spip('inc/autoriser');\n\t\t\tif(!autoriser('configurer', _request('configuration'))) {\n\t\t\t\tinclude_spip('inc/minipres');\n\t\t\t\techo minipres(_T('info_acces_interdit'));\n\t\t\t\texit;\n\t\t\t}\n\t\t\trequire _DIR_RESTREINT.'action/configurer.php';\n\t\t\taction_configurer_dist();\n\t\t}\n\t}\n}\n\n/*\n * Bloque les requ\u00eates contenant %00 (manipulation d'include)\n */\nif (strpos(\n\t@get_magic_quotes_gpc() ?\n\t\tstripslashes(serialize($_REQUEST)) : serialize($_REQUEST),\n\tchr(0)\n) !== false)\n\t$ecran_securite_raison = \"%00\";\n\n/*\n * Bloque les requ\u00eates fond=formulaire_\n */\nif (isset($_REQUEST['fond'])\nand preg_match(',^formulaire_,i', $_REQUEST['fond']))\n\t$ecran_securite_raison = \"fond=formulaire_\";\n\n/*\n * Bloque les requ\u00eates du type ?GLOBALS[type_urls]=toto (bug vieux php)\n */\nif (isset($_REQUEST['GLOBALS']))\n\t$ecran_securite_raison = \"GLOBALS[GLOBALS]\";\n\n/*\n * Bloque les requ\u00eates des bots sur:\n * les agenda\n * les paginations entrem\u00e9l\u00e9es\n */\nif (_IS_BOT and (\n\t(isset($_REQUEST['echelle']) and isset($_REQUEST['partie_cal']) and isset($_REQUEST['type']))\n\tor (strpos((string)$_SERVER['REQUEST_URI'], 'debut_') and preg_match(',[?&]debut_.*&debut_,', (string)$_SERVER['REQUEST_URI']))\n\t\tor (isset($_REQUEST['calendrier_annee']) and strpos((string)$_SERVER['REQUEST_URI'], 'debut_') )\n\t\tor (isset($_REQUEST['calendrier_annee']) and preg_match(',[?&]calendrier_annee=.*&calendrier_annee=,', (string)$_SERVER['REQUEST_URI']))\n)\n)\n\t$ecran_securite_raison = \"robot agenda/double pagination\";\n\n/*\n * Bloque une vieille page de tests de CFG (<1.11)\n * Bloque un XSS sur une page inexistante\n */\nif (isset($_REQUEST['page'])) {\n\tif ($_REQUEST['page'] == 'test_cfg')\n\t\t$ecran_securite_raison = \"test_cfg\";\n\tif ($_REQUEST['page'] !== htmlspecialchars((string)$_REQUEST['page']))\n\t\t$ecran_securite_raison = \"xsspage\";\n\tif ($_REQUEST['page'] == '404'\n\tand isset($_REQUEST['erreur']))\n\t\t$ecran_securite_raison = \"xss404\";\n}\n\n/*\n * XSS par array\n */\nforeach (array('var_login') as $var)\nif (isset($_REQUEST[$var]) and is_array($_REQUEST[$var]))\n\t$ecran_securite_raison = \"xss \".$var;\n\n/*\n * Parade antivirale contre un cheval de troie\n */\nif (!function_exists('tmp_lkojfghx')) {\n\tfunction tmp_lkojfghx() {}\n\tfunction tmp_lkojfghx2($a = 0, $b = 0, $c = 0, $d = 0) {\n\t\t// si jamais on est arriv\u00e9 ici sur une erreur php\n\t\t// et qu'un autre gestionnaire d'erreur est d\u00e9fini, l'appeller\n\t\tif ($b && $GLOBALS['tmp_xhgfjokl'])\n\t\t\tcall_user_func($GLOBALS['tmp_xhgfjokl'], $a, $b, $c, $d);\n\t}\n}\nif (isset($_POST['tmp_lkojfghx3']))\n\t$ecran_securite_raison = \"gumblar\";\n\n/*\n * Outils XML mal s\u00e9curis\u00e9s < 2.0.9\n */\nif (isset($_REQUEST['transformer_xml']))\n\t$ecran_securite_raison = \"transformer_xml\";\n\n/*\n * Outils XML mal s\u00e9curis\u00e9s again\n */\nif (isset($_REQUEST['var_url']) and $_REQUEST['var_url'] and isset($_REQUEST['exec']) and $_REQUEST['exec']=='valider_xml'){\n\t$url = trim($_REQUEST['var_url']);\n\tif (strncmp($url,'/',1)==0\n\t  or (($p=strpos($url,'..'))!==false AND strpos($url,'..',$p+3)!==false)\n\t  or (($p=strpos($url,'..'))!==false AND strpos($url,'IMG',$p+3)!==false)\n\t\tor (strpos($url,'://')!==false or strpos($url,':\\\\')!==false)) {\n\t\t$ecran_securite_raison = 'URL interdite pour var_url';\n\t}\n}\n\n/*\n * Sauvegarde mal securis\u00e9e < 2.0.9\n */\nif (isset($_REQUEST['nom_sauvegarde'])\nand strstr((string)$_REQUEST['nom_sauvegarde'], '/'))\n\t$ecran_securite_raison = 'nom_sauvegarde manipulee';\nif (isset($_REQUEST['znom_sauvegarde'])\nand strstr((string)$_REQUEST['znom_sauvegarde'], '/'))\n\t$ecran_securite_raison = 'znom_sauvegarde manipulee';\n\n\n/*\n * op permet des inclusions arbitraires ;\n * on v\u00e9rifie 'page' pour ne pas bloquer ... drupal\n */\nif (isset($_REQUEST['op']) and isset($_REQUEST['page'])\nand $_REQUEST['op'] !== preg_replace('/[^\\-\\w]/', '', $_REQUEST['op']))\n\t$ecran_securite_raison = 'op';\n\n/*\n * Forms & Table ne se m\u00e9fiait pas assez des uploads de fichiers\n */\nif (count($_FILES)){\n\tforeach($_FILES as $k => $v){\n\t\t if (preg_match(',^fichier_\\d+$,', $k)\n\t\t and preg_match(',\\.php,i', $v['name']))\n\t\t \tunset($_FILES[$k]);\n\t}\n}\n/*\n * et Contact trop laxiste avec une variable externe\n * on bloque pas le post pour eviter de perdre des donnees mais on unset la variable et c'est tout\n */\nif (isset($_REQUEST['pj_enregistrees_nom']) and $_REQUEST['pj_enregistrees_nom']){\n\tunset($_REQUEST['pj_enregistrees_nom']);\n\tunset($_GET['pj_enregistrees_nom']);\n\tunset($_POST['pj_enregistrees_nom']);\n}\n\n/*\n * reinstall=oui un peu trop permissif\n */\nif (isset($_REQUEST['reinstall'])\nand $_REQUEST['reinstall'] == 'oui')\n\t$ecran_securite_raison = 'reinstall=oui';\n\n/*\n * \u00c9chappement xss referer\n */\nif (isset($_SERVER['HTTP_REFERER']))\n\t$_SERVER['HTTP_REFERER'] = strtr($_SERVER['HTTP_REFERER'], '<>\"\\'', '[]##');\n\n\n/*\n * Echappement HTTP_X_FORWARDED_HOST\n */\nif (isset($_SERVER['HTTP_X_FORWARDED_HOST']))\n\t$_SERVER['HTTP_X_FORWARDED_HOST'] = strtr($_SERVER['HTTP_X_FORWARDED_HOST'], \"<>?\\\"\\{\\}\\$'` \\r\\n\", '____________');\n\n\n/*\n * R\u00e9injection des cl\u00e9s en html dans l'admin r19561\n */\nif (strpos($_SERVER['REQUEST_URI'], \"ecrire/\") !== false){\n\t$zzzz = implode(\"\", array_keys($_REQUEST));\n\tif (strlen($zzzz) != strcspn($zzzz, '<>\"\\''))\n\t\t$ecran_securite_raison = 'Cle incorrecte en $_REQUEST';\n}\n\n/*\n * Injection par connect\n */\nif (isset($_REQUEST['connect'])\n\tand\n\t// cas qui permettent de sortir d'un commentaire PHP\n\t(strpos($_REQUEST['connect'], \"?\") !== false\n\t or strpos($_REQUEST['connect'], \"<\") !== false\n\t or strpos($_REQUEST['connect'], \">\") !== false\n\t or strpos($_REQUEST['connect'], \"\\n\") !== false\n\t or strpos($_REQUEST['connect'], \"\\r\") !== false)\n\t) {\n\t$ecran_securite_raison = \"malformed connect argument\";\n}\n\n/*\n * S'il y a une raison de mourir, mourons\n */\nif (isset($ecran_securite_raison)) {\n\theader(\"HTTP/1.0 403 Forbidden\");\n\theader(\"Expires: Wed, 11 Jan 1984 05:00:00 GMT\");\n\theader(\"Cache-Control: no-cache, must-revalidate\");\n\theader(\"Pragma: no-cache\");\n\theader(\"Content-Type: text/html\");\n\tdie(\"<html><title>Error 403: Forbidden</title><body><h1>Error 403</h1><p>You are not authorized to view this page ($ecran_securite_raison)</p></body></html>\");\n}\n\n/*\n * Un filtre filtrer_entites securise\n */\nif (!function_exists('filtre_filtrer_entites_dist')) {\n\tfunction filtre_filtrer_entites_dist($t) {\n\t\tinclude_spip('inc/texte');\n\t\treturn interdire_scripts(filtrer_entites($t));\n\t}\n}\n\n\n/*\n * Fin s\u00e9curit\u00e9\n */\n\n\n\n/*\n * Bloque les bots quand le load d\u00e9borde\n */\nif (!defined('_ECRAN_SECURITE_LOAD'))\n\tdefine('_ECRAN_SECURITE_LOAD', 4);\n\nif (\n\tdefined('_ECRAN_SECURITE_LOAD')\n\tand _ECRAN_SECURITE_LOAD > 0\n\tand _IS_BOT\n\tand !_IS_BOT_FRIEND\n\tand $_SERVER['REQUEST_METHOD'] === 'GET'\n\tand (\n\t\t(function_exists('sys_getloadavg')\n\t\t  and $load = sys_getloadavg()\n\t\t  and is_array($load)\n\t\t  and $load = array_shift($load)\n\t\t)\n\t\tor\n\t\t(@is_readable('/proc/loadavg')\n\t\t  and $load = file_get_contents('/proc/loadavg')\n\t\t  and $load = floatval($load)\n\t\t)\n\t)\n\tand $load > _ECRAN_SECURITE_LOAD // eviter l'evaluation suivante si de toute facon le load est inferieur a la limite\n\tand rand(0, $load * $load) > _ECRAN_SECURITE_LOAD * _ECRAN_SECURITE_LOAD\n) {\n\t//https://webmasters.stackexchange.com/questions/65674/should-i-return-a-429-or-503-status-code-to-a-bot\n\theader(\"HTTP/1.0 429 Too Many Requests\");\n\theader(\"Retry-After: 300\");\n\theader(\"Expires: Wed, 11 Jan 1984 05:00:00 GMT\");\n\theader(\"Cache-Control: no-cache, must-revalidate\");\n\theader(\"Pragma: no-cache\");\n\theader(\"Content-Type: text/html\");\n\tdie(\"<html><title>Status 429: Too Many Requests</title><body><h1>Status 429</h1><p>Too Many Requests (try again soon)</p></body></html>\");\n}\n"], "fixing_code": ["<?php\n\n/*\n * ecran_securite.php\n * ------------------\n */\n\ndefine('_ECRAN_SECURITE', '1.3.11'); // 2019-04-08\n\n/*\n * Documentation : http://www.spip.net/fr_article4200.html\n */\n\n/*\n * Test utilisateur\n */\nif (isset($_GET['test_ecran_securite']))\n\t$ecran_securite_raison = 'test '._ECRAN_SECURITE;\n\n/*\n * Monitoring\n * var_isbot=0 peut etre utilise par un bot de monitoring pour surveiller la disponibilite d'un site vu par les users\n * var_isbot=1 peut etre utilise pour monitorer la disponibilite pour les bots (sujets a 503 de delestage si\n * le load depasse ECRAN_SECURITE_LOAD)\n */\nif (!defined('_IS_BOT') and isset($_GET['var_isbot'])){\n\tdefine('_IS_BOT', $_GET['var_isbot'] ? true : false);\n}\n\n/*\n * D\u00e9tecteur de robot d'indexation\n */\nif (!defined('_IS_BOT')){\n\tdefine('_IS_BOT',\n\t\tisset($_SERVER['HTTP_USER_AGENT'])\n\t\tand preg_match(','\n\t\t. implode ('|', array(\n\t\t\t// mots generiques\n\t\t\t'bot',\n\t\t\t'slurp',\n\t\t\t'crawler',\n\t\t\t'crwlr',\n\t\t\t'java',\n\t\t\t'monitoring',\n\t\t\t'spider',\n\t\t\t'webvac',\n\t\t\t'yandex',\n\t\t\t'MSIE 6\\.0', // botnet 99,9% du temps\n\t\t\t// UA plus cibles \n\t\t\t'200please',\n\t\t\t'80legs',\n\t\t\t'a6-indexer',\n\t\t\t'aboundex',\n\t\t\t'accoona',\n\t\t\t'acrylicapps',\n\t\t\t'addthis',\n\t\t\t'adressendeutschland',\n\t\t\t'alexa',\n\t\t\t'altavista',\n\t\t\t'analyticsseo',\n\t\t\t'antennapod',\n\t\t\t'arachnys',\n\t\t\t'archive',\n\t\t\t'argclrint',\n\t\t\t'aspseek',\n\t\t\t'baidu',\n\t\t\t'begunadvertising',\n\t\t\t'bing',\n\t\t\t'bloglines',\n\t\t\t'buck',\n\t\t\t'browsershots',\n\t\t\t'bubing',\n\t\t\t'butterfly',\n\t\t\t'changedetection',\n\t\t\t'charlotte',\n\t\t\t'chilkat',\n\t\t\t'china',\n\t\t\t'coccoc',\n\t\t\t'crowsnest',\n\t\t\t'dataminr',\n\t\t\t'daumoa',\n\t\t\t'dlvr\\.it',\n\t\t\t'dlweb',\n\t\t\t'drupal',\n\t\t\t'ec2linkfinder',\n\t\t\t'eset\\.com',\n\t\t\t'estyle',\n\t\t\t'exalead',\n\t\t\t'ezooms',\n\t\t\t'facebookexternalhit',\n\t\t\t'facebookplatform',\n\t\t\t'fairshare',\n\t\t\t'feedfetcher',\n\t\t\t'feedfetcher-google',\n\t\t\t'feedly',\n\t\t\t'fetch',\n\t\t\t'flipboardproxy',\n\t\t\t'genieo',\n\t\t\t'google',\n\t\t\t'go-http-client',\n\t\t\t'grapeshot',\n\t\t\t'hatena-useragent',\n\t\t\t'head',\n\t\t\t'hosttracker',\n\t\t\t'hubspot',\n\t\t\t'ia_archiver',\n\t\t\t'ichiro',\n\t\t\t'iltrovatore-setaccio',\n\t\t\t'immediatenet',\n\t\t\t'ina',\n\t\t\t'inoreader',\n\t\t\t'infegyatlas',\n\t\t\t'infohelfer',\n\t\t\t'instapaper',\n\t\t\t'jabse',\n\t\t\t'james',\n\t\t\t'jersey',\n\t\t\t'kumkie',\n\t\t\t'linkdex',\n\t\t\t'linkfluence',\n\t\t\t'linkwalker',\n\t\t\t'litefinder',\n\t\t\t'loadimpactpageanalyzer',\n\t\t\t'ltx71',\n\t\t\t'luminate',\n\t\t\t'lycos',\n\t\t\t'lycosa',\n\t\t\t'mediapartners-google',\n\t\t\t'msai',\n\t\t\t'myapp',\n\t\t\t'nativehost',\n\t\t\t'najdi',\n\t\t\t'netcraftsurveyagent',\n\t\t\t'netestate',\n\t\t\t'netseer',\n\t\t\t'netnewswire',\n\t\t\t'newspaper',\n\t\t\t'newsblur',\n\t\t\t'nuhk',\n\t\t\t'nuzzel',\n\t\t\t'okhttp',\n\t\t\t'otmedia',\n\t\t\t'owlin',\n\t\t\t'owncloud',\n\t\t\t'panscient',\n\t\t\t'paper\\.li',\n\t\t\t'parsijoo',\n\t\t\t'protopage',\n\t\t\t'plukkie',\n\t\t\t'proximic',\n\t\t\t'pubsub',\n\t\t\t'python',\n\t\t\t'qirina',\n\t\t\t'qoshe',\n\t\t\t'qualidator',\n\t\t\t'qwantify',\n\t\t\t'rambler',\n\t\t\t'readability',\n\t\t\t'ruby',\n\t\t\t'sbsearch',\n\t\t\t'scoop\\.it',\n\t\t\t'scooter',\n\t\t\t'scoutjet',\n\t\t\t'scrapy',\n\t\t\t'scrubby',\n\t\t\t'scrubbybloglines',\n\t\t\t'shareaholic',\n\t\t\t'shopwiki',\n\t\t\t'simplepie',\n\t\t\t'sistrix',\n\t\t\t'sitechecker',\n\t\t\t'siteexplorer',\n\t\t\t'snapshot',\n\t\t\t'sogou',\n\t\t\t'special_archiver',\n\t\t\t'speedy',\n\t\t\t'spinn3r',\n\t\t\t'spreadtrum',\n\t\t\t'steeler',\n\t\t\t'subscriber',\n\t\t\t'suma',\n\t\t\t'superdownloads',\n\t\t\t'svenska-webbsido',\n\t\t\t'teoma',\n\t\t\t'the knowledge AI',\n\t\t\t'thumbshots',\n\t\t\t'tineye',\n\t\t\t'traackr',\n\t\t\t'trendiction',\n\t\t\t'trendsmap',\n\t\t\t'tweetedtimes',\n\t\t\t'tweetmeme',\n\t\t\t'universalfeedparser',\n\t\t\t'uaslinkchecker',\n\t\t\t'undrip',\n\t\t\t'unwindfetchor',\n\t\t\t'upday',\n\t\t\t'vedma',\n\t\t\t'vkshare',\n\t\t\t'vm',\n\t\t\t'wch',\n\t\t\t'webalta',\n\t\t\t'webcookies',\n\t\t\t'webparser',\n\t\t\t'webthumbnail',\n\t\t\t'wesee',\n\t\t\t'wise-guys',\n\t\t\t'woko',\n\t\t\t'wordpress',\n\t\t\t'wotbox',\n\t\t\t'y!j-bri',\n\t\t\t'y!j-bro',\n\t\t\t'y!j-brw',\n\t\t\t'y!j-bsc',\n\t\t\t'yahoo',\n\t\t\t'yahoo!',\n\t\t\t'yahooysmcm',\n\t\t\t'ymobactus',\n\t\t\t'yats',\n\t\t\t'yeti',\n\t\t\t'zeerch'\n\t\t)) . ',i',\n\t\t(string)$_SERVER['HTTP_USER_AGENT'])\n\t);\n}\nif (!defined('_IS_BOT_FRIEND')){\n\tdefine('_IS_BOT_FRIEND',\n\t\tisset($_SERVER['HTTP_USER_AGENT'])\n\t\tand preg_match(',' . implode ('|', array(\n\t\t\t'facebookexternalhit',\n\t\t\t'flipboardproxy',\n\t\t\t'wordpress'\n\t\t)) . ',i',\n\t\t(string)$_SERVER['HTTP_USER_AGENT'])\n\t);\n}\n\n/*\n * Interdit de passer une variable id_article (ou id_xxx) qui ne\n * soit pas num\u00e9rique (ce qui bloque l'exploitation de divers trous\n * de s\u00e9curit\u00e9, dont celui de toutes les versions < 1.8.2f)\n * (sauf pour id_table, qui n'est pas num\u00e9rique jusqu'\u00e0 [5743])\n * (id_base est une variable de la config des widgets de WordPress)\n */\n$_exceptions = array('id_table','id_base','id_parent','id_article_pdf');\nforeach ($_GET as $var => $val)\n\tif ($_GET[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$_GET[$var] = is_array($_GET[$var])?@array_map('intval', $_GET[$var]):intval($_GET[$var]);\nforeach ($_POST as $var => $val)\n\tif ($_POST[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$_POST[$var] = is_array($_POST[$var])?@array_map('intval', $_POST[$var]):intval($_POST[$var]);\nforeach ($GLOBALS as $var => $val)\n\tif ($GLOBALS[$var] and strncmp($var, \"id_\", 3) == 0\n\t\tand !in_array($var, $_exceptions))\n\t\t$GLOBALS[$var] = is_array($GLOBALS[$var])?@array_map('intval', $GLOBALS[$var]):intval($GLOBALS[$var]);\n\n/*\n * Interdit la variable $cjpeg_command, qui \u00e9tait utilis\u00e9e sans\n * pr\u00e9caution dans certaines versions de dev (1.8b2 -> 1.8b5)\n */\n$cjpeg_command = '';\n\n/*\n * Contr\u00f4le de quelques variables (XSS)\n */\nforeach(array('lang', 'var_recherche', 'aide', 'var_lang_r', 'lang_r', 'var_ajax_ancre', 'nom_fichier') as $var) {\n\tif (isset($_GET[$var]))\n\t\t$_REQUEST[$var] = $GLOBALS[$var] = $_GET[$var] = preg_replace(',[^\\w\\,/#&;-]+,', ' ', (string)$_GET[$var]);\n\tif (isset($_POST[$var]))\n\t\t$_REQUEST[$var] = $GLOBALS[$var] = $_POST[$var] = preg_replace(',[^\\w\\,/#&;-]+,', ' ', (string)$_POST[$var]);\n}\n\n/*\n * Filtre l'acc\u00e8s \u00e0 spip_acces_doc (injection SQL en 1.8.2x)\n */\nif (preg_match(',^(.*/)?spip_acces_doc\\.,', (string)$_SERVER['REQUEST_URI'])) {\n\t$file = addslashes((string)$_GET['file']);\n}\n\n/*\n * Pas d'inscription abusive\n */\nif (isset($_REQUEST['mode']) and isset($_REQUEST['page'])\nand !in_array($_REQUEST['mode'], array(\"6forum\", \"1comite\"))\nand $_REQUEST['page'] == \"identifiants\")\n\t$ecran_securite_raison = \"identifiants\";\n\n/*\n * Agenda joue \u00e0 l'injection php\n */\nif (isset($_REQUEST['partie_cal'])\nand $_REQUEST['partie_cal'] !== htmlentities((string)$_REQUEST['partie_cal']))\n\t$ecran_securite_raison = \"partie_cal\";\nif (isset($_REQUEST['echelle'])\nand $_REQUEST['echelle'] !== htmlentities((string)$_REQUEST['echelle']))\n\t$ecran_securite_raison = \"echelle\";\n\n/*\n * Espace priv\u00e9\n */\nif (isset($_REQUEST['exec'])\nand !preg_match(',^[\\w-]+$,', (string)$_REQUEST['exec']))\n\t$ecran_securite_raison = \"exec\";\nif (isset($_REQUEST['cherche_auteur'])\nand preg_match(',[<],', (string)$_REQUEST['cherche_auteur']))\n\t$ecran_securite_raison = \"cherche_auteur\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'auteurs'\nand preg_match(',[<],', (string)$_REQUEST['recherche']))\n\t$ecran_securite_raison = \"recherche\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'info_plugin'\nand preg_match(',[<],', (string)$_REQUEST['plugin']))\n\t$ecran_securite_raison = \"plugin\";\nif (isset($_REQUEST['exec'])\nand $_REQUEST['exec'] == 'puce_statut'\nand isset($_REQUEST['id'])\nand !intval($_REQUEST['id']))\n\t$ecran_securite_raison = \"puce_statut\";\nif (isset($_REQUEST['action'])\nand $_REQUEST['action'] == 'configurer') {\n\tif (@file_exists('inc_version.php')\n\tor @file_exists('ecrire/inc_version.php')) {\n\t\tfunction action_configurer() {\n\t\t\tinclude_spip('inc/autoriser');\n\t\t\tif(!autoriser('configurer', _request('configuration'))) {\n\t\t\t\tinclude_spip('inc/minipres');\n\t\t\t\techo minipres(_T('info_acces_interdit'));\n\t\t\t\texit;\n\t\t\t}\n\t\t\trequire _DIR_RESTREINT.'action/configurer.php';\n\t\t\taction_configurer_dist();\n\t\t}\n\t}\n}\n\n/*\n * Bloque les requ\u00eates contenant %00 (manipulation d'include)\n */\nif (strpos(\n\t@get_magic_quotes_gpc() ?\n\t\tstripslashes(serialize($_REQUEST)) : serialize($_REQUEST),\n\tchr(0)\n) !== false)\n\t$ecran_securite_raison = \"%00\";\n\n/*\n * Bloque les requ\u00eates fond=formulaire_\n */\nif (isset($_REQUEST['fond'])\nand preg_match(',^formulaire_,i', $_REQUEST['fond']))\n\t$ecran_securite_raison = \"fond=formulaire_\";\n\n/*\n * Bloque les requ\u00eates du type ?GLOBALS[type_urls]=toto (bug vieux php)\n */\nif (isset($_REQUEST['GLOBALS']))\n\t$ecran_securite_raison = \"GLOBALS[GLOBALS]\";\n\n/*\n * Bloque les requ\u00eates des bots sur:\n * les agenda\n * les paginations entrem\u00e9l\u00e9es\n */\nif (_IS_BOT and (\n\t(isset($_REQUEST['echelle']) and isset($_REQUEST['partie_cal']) and isset($_REQUEST['type']))\n\tor (strpos((string)$_SERVER['REQUEST_URI'], 'debut_') and preg_match(',[?&]debut_.*&debut_,', (string)$_SERVER['REQUEST_URI']))\n\t\tor (isset($_REQUEST['calendrier_annee']) and strpos((string)$_SERVER['REQUEST_URI'], 'debut_') )\n\t\tor (isset($_REQUEST['calendrier_annee']) and preg_match(',[?&]calendrier_annee=.*&calendrier_annee=,', (string)$_SERVER['REQUEST_URI']))\n)\n)\n\t$ecran_securite_raison = \"robot agenda/double pagination\";\n\n/*\n * Bloque une vieille page de tests de CFG (<1.11)\n * Bloque un XSS sur une page inexistante\n */\nif (isset($_REQUEST['page'])) {\n\tif ($_REQUEST['page'] == 'test_cfg')\n\t\t$ecran_securite_raison = \"test_cfg\";\n\tif ($_REQUEST['page'] !== htmlspecialchars((string)$_REQUEST['page']))\n\t\t$ecran_securite_raison = \"xsspage\";\n\tif ($_REQUEST['page'] == '404'\n\tand isset($_REQUEST['erreur']))\n\t\t$ecran_securite_raison = \"xss404\";\n}\n\n/*\n * XSS par array\n */\nforeach (array('var_login') as $var)\nif (isset($_REQUEST[$var]) and is_array($_REQUEST[$var]))\n\t$ecran_securite_raison = \"xss \".$var;\n\n/*\n * Parade antivirale contre un cheval de troie\n */\nif (!function_exists('tmp_lkojfghx')) {\n\tfunction tmp_lkojfghx() {}\n\tfunction tmp_lkojfghx2($a = 0, $b = 0, $c = 0, $d = 0) {\n\t\t// si jamais on est arriv\u00e9 ici sur une erreur php\n\t\t// et qu'un autre gestionnaire d'erreur est d\u00e9fini, l'appeller\n\t\tif ($b && $GLOBALS['tmp_xhgfjokl'])\n\t\t\tcall_user_func($GLOBALS['tmp_xhgfjokl'], $a, $b, $c, $d);\n\t}\n}\nif (isset($_POST['tmp_lkojfghx3']))\n\t$ecran_securite_raison = \"gumblar\";\n\n/*\n * Outils XML mal s\u00e9curis\u00e9s < 2.0.9\n */\nif (isset($_REQUEST['transformer_xml']))\n\t$ecran_securite_raison = \"transformer_xml\";\n\n/*\n * Outils XML mal s\u00e9curis\u00e9s again\n */\nif (isset($_REQUEST['var_url']) and $_REQUEST['var_url'] and isset($_REQUEST['exec']) and $_REQUEST['exec']=='valider_xml'){\n\t$url = trim($_REQUEST['var_url']);\n\tif (strncmp($url,'/',1)==0\n\t  or (($p=strpos($url,'..'))!==false AND strpos($url,'..',$p+3)!==false)\n\t  or (($p=strpos($url,'..'))!==false AND strpos($url,'IMG',$p+3)!==false)\n\t\tor (strpos($url,'://')!==false or strpos($url,':\\\\')!==false)) {\n\t\t$ecran_securite_raison = 'URL interdite pour var_url';\n\t}\n}\n\n/*\n * Sauvegarde mal securis\u00e9e < 2.0.9\n */\nif (isset($_REQUEST['nom_sauvegarde'])\nand strstr((string)$_REQUEST['nom_sauvegarde'], '/'))\n\t$ecran_securite_raison = 'nom_sauvegarde manipulee';\nif (isset($_REQUEST['znom_sauvegarde'])\nand strstr((string)$_REQUEST['znom_sauvegarde'], '/'))\n\t$ecran_securite_raison = 'znom_sauvegarde manipulee';\n\n\n/*\n * op permet des inclusions arbitraires ;\n * on v\u00e9rifie 'page' pour ne pas bloquer ... drupal\n */\nif (isset($_REQUEST['op']) and isset($_REQUEST['page'])\nand $_REQUEST['op'] !== preg_replace('/[^\\-\\w]/', '', $_REQUEST['op']))\n\t$ecran_securite_raison = 'op';\n\n/*\n * Forms & Table ne se m\u00e9fiait pas assez des uploads de fichiers\n */\nif (count($_FILES)){\n\tforeach($_FILES as $k => $v){\n\t\t if (preg_match(',^fichier_\\d+$,', $k)\n\t\t and preg_match(',\\.php,i', $v['name']))\n\t\t \tunset($_FILES[$k]);\n\t}\n}\n/*\n * et Contact trop laxiste avec une variable externe\n * on bloque pas le post pour eviter de perdre des donnees mais on unset la variable et c'est tout\n */\nif (isset($_REQUEST['pj_enregistrees_nom']) and $_REQUEST['pj_enregistrees_nom']){\n\tunset($_REQUEST['pj_enregistrees_nom']);\n\tunset($_GET['pj_enregistrees_nom']);\n\tunset($_POST['pj_enregistrees_nom']);\n}\n\n/*\n * reinstall=oui un peu trop permissif\n */\nif (isset($_REQUEST['reinstall'])\nand $_REQUEST['reinstall'] == 'oui')\n\t$ecran_securite_raison = 'reinstall=oui';\n\n/*\n * \u00c9chappement xss referer\n */\nif (isset($_SERVER['HTTP_REFERER']))\n\t$_SERVER['HTTP_REFERER'] = strtr($_SERVER['HTTP_REFERER'], '<>\"\\'', '[]##');\n\n\n/*\n * Echappement HTTP_X_FORWARDED_HOST\n */\nif (isset($_SERVER['HTTP_X_FORWARDED_HOST']))\n\t$_SERVER['HTTP_X_FORWARDED_HOST'] = strtr($_SERVER['HTTP_X_FORWARDED_HOST'], \"<>?\\\"\\{\\}\\$'` \\r\\n\", '____________');\n\n\n/*\n * R\u00e9injection des cl\u00e9s en html dans l'admin r19561\n */\nif (strpos($_SERVER['REQUEST_URI'], \"ecrire/\") !== false or isset($_REQUEST['var_memotri'])){\n\t$zzzz = implode(\"\", array_keys($_REQUEST));\n\tif (strlen($zzzz) != strcspn($zzzz, '<>\"\\''))\n\t\t$ecran_securite_raison = 'Cle incorrecte en $_REQUEST';\n}\n\n/*\n * Injection par connect\n */\nif (isset($_REQUEST['connect'])\n\tand\n\t// cas qui permettent de sortir d'un commentaire PHP\n\t(strpos($_REQUEST['connect'], \"?\") !== false\n\t or strpos($_REQUEST['connect'], \"<\") !== false\n\t or strpos($_REQUEST['connect'], \">\") !== false\n\t or strpos($_REQUEST['connect'], \"\\n\") !== false\n\t or strpos($_REQUEST['connect'], \"\\r\") !== false)\n\t) {\n\t$ecran_securite_raison = \"malformed connect argument\";\n}\n\n/*\n * S'il y a une raison de mourir, mourons\n */\nif (isset($ecran_securite_raison)) {\n\theader(\"HTTP/1.0 403 Forbidden\");\n\theader(\"Expires: Wed, 11 Jan 1984 05:00:00 GMT\");\n\theader(\"Cache-Control: no-cache, must-revalidate\");\n\theader(\"Pragma: no-cache\");\n\theader(\"Content-Type: text/html\");\n\tdie(\"<html><title>Error 403: Forbidden</title><body><h1>Error 403</h1><p>You are not authorized to view this page ($ecran_securite_raison)</p></body></html>\");\n}\n\n/*\n * Un filtre filtrer_entites securise\n */\nif (!function_exists('filtre_filtrer_entites_dist')) {\n\tfunction filtre_filtrer_entites_dist($t) {\n\t\tinclude_spip('inc/texte');\n\t\treturn interdire_scripts(filtrer_entites($t));\n\t}\n}\n\n\n/*\n * Fin s\u00e9curit\u00e9\n */\n\n\n\n/*\n * Bloque les bots quand le load d\u00e9borde\n */\nif (!defined('_ECRAN_SECURITE_LOAD'))\n\tdefine('_ECRAN_SECURITE_LOAD', 4);\n\nif (\n\tdefined('_ECRAN_SECURITE_LOAD')\n\tand _ECRAN_SECURITE_LOAD > 0\n\tand _IS_BOT\n\tand !_IS_BOT_FRIEND\n\tand $_SERVER['REQUEST_METHOD'] === 'GET'\n\tand (\n\t\t(function_exists('sys_getloadavg')\n\t\t  and $load = sys_getloadavg()\n\t\t  and is_array($load)\n\t\t  and $load = array_shift($load)\n\t\t)\n\t\tor\n\t\t(@is_readable('/proc/loadavg')\n\t\t  and $load = file_get_contents('/proc/loadavg')\n\t\t  and $load = floatval($load)\n\t\t)\n\t)\n\tand $load > _ECRAN_SECURITE_LOAD // eviter l'evaluation suivante si de toute facon le load est inferieur a la limite\n\tand rand(0, $load * $load) > _ECRAN_SECURITE_LOAD * _ECRAN_SECURITE_LOAD\n) {\n\t//https://webmasters.stackexchange.com/questions/65674/should-i-return-a-429-or-503-status-code-to-a-bot\n\theader(\"HTTP/1.0 429 Too Many Requests\");\n\theader(\"Retry-After: 300\");\n\theader(\"Expires: Wed, 11 Jan 1984 05:00:00 GMT\");\n\theader(\"Cache-Control: no-cache, must-revalidate\");\n\theader(\"Pragma: no-cache\");\n\theader(\"Content-Type: text/html\");\n\tdie(\"<html><title>Status 429: Too Many Requests</title><body><h1>Status 429</h1><p>Too Many Requests (try again soon)</p></body></html>\");\n}\n"], "filenames": ["config/ecran_securite.php"], "buggy_code_start_loc": [8], "buggy_code_end_loc": [495], "fixing_code_start_loc": [8], "fixing_code_end_loc": [495], "type": "CWE-20", "message": "SPIP 3.1 before 3.1.10 and 3.2 before 3.2.4 allows authenticated visitors to execute arbitrary code on the host server because var_memotri is mishandled.", "other": {"cve": {"id": "CVE-2019-11071", "sourceIdentifier": "cve@mitre.org", "published": "2019-04-10T21:29:01.730", "lastModified": "2020-09-28T18:15:12.833", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "SPIP 3.1 before 3.1.10 and 3.2 before 3.2.4 allows authenticated visitors to execute arbitrary code on the host server because var_memotri is mishandled."}, {"lang": "es", "value": "SPIP 3.1 versiones anteriores a 3.1.10 y 3.2 versiones anteriores a 3.2.4 permite a los visitantes autentificados ejecutar c\u00f3digo arbitrario en el servidor host porque var_memotri se maneja de forma inadecuada."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-20"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:spip:spip:*:*:*:*:*:*:*:*", "versionStartIncluding": "3.1.0", "versionEndExcluding": "3.1.10", "matchCriteriaId": "5F25A18D-321C-41CC-9FBC-F55F4B97E6CA"}, {"vulnerable": true, "criteria": "cpe:2.3:a:spip:spip:*:*:*:*:*:*:*:*", "versionStartIncluding": "3.2.0", "versionEndExcluding": "3.2.4", "matchCriteriaId": "9D60F81C-1902-43F9-B9E6-C7C503336007"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:9.0:*:*:*:*:*:*:*", "matchCriteriaId": "DEECE5FC-CACF-4496-A3E7-164736409252"}]}]}], "references": [{"url": "https://blog.spip.net/Mise-a-jour-CRITIQUE-de-securite-Sortie-de-SPIP-3-1-10-et-SPIP-3-2-4.html", "source": "cve@mitre.org", "tags": ["Patch", "Vendor Advisory"]}, {"url": "https://github.com/spip/SPIP/commit/3ef87c525bc0768c926646f999a54222b37b5d36", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/spip/SPIP/commit/824d17f424bf77d17af89c18c3dc807a3199567e", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/spip/SPIP/compare/1e3872c...9861a47", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://usn.ubuntu.com/4536-1/", "source": "cve@mitre.org"}, {"url": "https://www.debian.org/security/2019/dsa-4429", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/spip/SPIP/commit/3ef87c525bc0768c926646f999a54222b37b5d36"}}