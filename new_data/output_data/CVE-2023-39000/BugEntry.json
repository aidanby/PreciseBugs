{"buggy_code": ["<?php\n\n/*\n * Copyright (C) 2019 Deciso B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n *    this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,\n * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY\n * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n * AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nnamespace OPNsense\\Diagnostics;\n\nuse OPNsense\\Base\\IndexController;\n\n/**\n * @inherit\n */\nclass LogController extends IndexController\n{\n    public function renderPage($module, $scope)\n    {\n        $this->view->pick('OPNsense/Diagnostics/log');\n        $this->view->module = $module;\n        $this->view->scope = $scope;\n        $this->view->service = '';\n        $this->view->default_log_severity = 'Warning';\n\n        $service = $module == 'core' ? $scope : $module;\n\n        /* XXX manually hook up known services and log severities for now */\n        switch ($service) {\n            case 'filter':\n                $this->view->default_log_severity = 'Informational';\n                break;\n            case 'ipsec':\n                $this->view->service = 'ipsec';\n                break;\n            case 'resolver':\n                $this->view->service = 'unbound';\n                break;\n            case 'suricata':\n                $this->view->service = 'ids';\n                break;\n            case 'squid':\n                $this->view->service = 'proxy';\n                break;\n            case 'system':\n                $this->view->default_log_severity = 'Notice';\n                break;\n            default:\n                /* no service API at the moment */\n                break;\n        }\n    }\n\n    public function __call($name, $arguments)\n    {\n        if (substr($name, -6) == 'Action') {\n            $scope = count($arguments) > 0 ? $arguments[0] : \"core\";\n            $module = substr($name, 0, strlen($name) - 6);\n            return $this->renderPage($module, $scope);\n        }\n    }\n}\n"], "fixing_code": ["<?php\n\n/*\n * Copyright (C) 2019 Deciso B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n *    this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,\n * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY\n * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n * AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nnamespace OPNsense\\Diagnostics;\n\nuse OPNsense\\Base\\IndexController;\n\n/**\n * @inherit\n */\nclass LogController extends IndexController\n{\n    public function renderPage($module, $scope)\n    {\n        $this->view->pick('OPNsense/Diagnostics/log');\n        $this->view->module = htmlspecialchars($module, ENT_QUOTES | ENT_HTML401);\n        $this->view->scope = htmlspecialchars($scope, ENT_QUOTES | ENT_HTML401);\n        $this->view->service = '';\n        $this->view->default_log_severity = 'Warning';\n\n        $service = $module == 'core' ? $scope : $module;\n\n        /* XXX manually hook up known services and log severities for now */\n        switch ($service) {\n            case 'filter':\n                $this->view->default_log_severity = 'Informational';\n                break;\n            case 'ipsec':\n                $this->view->service = 'ipsec';\n                break;\n            case 'resolver':\n                $this->view->service = 'unbound';\n                break;\n            case 'suricata':\n                $this->view->service = 'ids';\n                break;\n            case 'squid':\n                $this->view->service = 'proxy';\n                break;\n            case 'system':\n                $this->view->default_log_severity = 'Notice';\n                break;\n            default:\n                /* no service API at the moment */\n                break;\n        }\n    }\n\n    public function __call($name, $arguments)\n    {\n        if (substr($name, -6) == 'Action') {\n            $scope = count($arguments) > 0 ? $arguments[0] : \"core\";\n            $module = substr($name, 0, strlen($name) - 6);\n            return $this->renderPage($module, $scope);\n        }\n    }\n}\n"], "filenames": ["src/opnsense/mvc/app/controllers/OPNsense/Diagnostics/LogController.php"], "buggy_code_start_loc": [41], "buggy_code_end_loc": [43], "fixing_code_start_loc": [41], "fixing_code_end_loc": [43], "type": "CWE-79", "message": "A reflected cross-site scripting (XSS) vulnerability in the component /ui/diagnostics/log/core/ of OPNsense Community Edition before 23.7 and Business Edition before 23.4.2 allows attackers to inject arbitrary JavaScript via the URL path.", "other": {"cve": {"id": "CVE-2023-39000", "sourceIdentifier": "cve@mitre.org", "published": "2023-08-09T19:15:14.787", "lastModified": "2023-10-10T23:15:10.240", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A reflected cross-site scripting (XSS) vulnerability in the component /ui/diagnostics/log/core/ of OPNsense Community Edition before 23.7 and Business Edition before 23.4.2 allows attackers to inject arbitrary JavaScript via the URL path."}, {"lang": "es", "value": "Una vulnerabilidad de Cross Site Scripting (XSS) Reflejada en el componente /ui/diagnostics/log/core/ de OPNsense Community Edition antes de 23.7 y Business Edition antes de 23.4.2 permite a los atacantes inyectar JavaScript arbitrario a trav\u00e9s de la ruta URL.\n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:opnsense:opnsense:*:*:*:*:*:*:*:*", "versionEndExcluding": "23.7", "matchCriteriaId": "E4C1BDFF-B6E1-4F82-9957-1FFA069E2EDC"}]}]}], "references": [{"url": "https://github.com/opnsense/core/commit/d1f350ce70e477adc86d445f5cda9b24f9ff0168", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://logicaltrust.net/blog/2023/08/opnsense.html", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/opnsense/core/commit/d1f350ce70e477adc86d445f5cda9b24f9ff0168"}}