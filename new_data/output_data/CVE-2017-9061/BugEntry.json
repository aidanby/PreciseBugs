{"buggy_code": ["/* global plupload, pluploadL10n, ajaxurl, post_id, wpUploaderInit, deleteUserSetting, setUserSetting, getUserSetting, shortform */\nvar topWin = window.dialogArguments || opener || parent || top, uploader, uploader_init;\n\n// progress and success handlers for media multi uploads\nfunction fileQueued(fileObj) {\n\t// Get rid of unused form\n\tjQuery('.media-blank').remove();\n\n\tvar items = jQuery('#media-items').children(), postid = post_id || 0;\n\n\t// Collapse a single item\n\tif ( items.length == 1 ) {\n\t\titems.removeClass('open').find('.slidetoggle').slideUp(200);\n\t}\n\t// Create a progress bar containing the filename\n\tjQuery('<div class=\"media-item\">')\n\t\t.attr( 'id', 'media-item-' + fileObj.id )\n\t\t.addClass('child-of-' + postid)\n\t\t.append('<div class=\"progress\"><div class=\"percent\">0%</div><div class=\"bar\"></div></div>',\n\t\t\tjQuery('<div class=\"filename original\">').text( ' ' + fileObj.name ))\n\t\t.appendTo( jQuery('#media-items' ) );\n\n\t// Disable submit\n\tjQuery('#insert-gallery').prop('disabled', true);\n}\n\nfunction uploadStart() {\n\ttry {\n\t\tif ( typeof topWin.tb_remove != 'undefined' )\n\t\t\ttopWin.jQuery('#TB_overlay').unbind('click', topWin.tb_remove);\n\t} catch(e){}\n\n\treturn true;\n}\n\nfunction uploadProgress(up, file) {\n\tvar item = jQuery('#media-item-' + file.id);\n\n\tjQuery('.bar', item).width( (200 * file.loaded) / file.size );\n\tjQuery('.percent', item).html( file.percent + '%' );\n}\n\n// check to see if a large file failed to upload\nfunction fileUploading( up, file ) {\n\tvar hundredmb = 100 * 1024 * 1024,\n\t\tmax = parseInt( up.settings.max_file_size, 10 );\n\n\tif ( max > hundredmb && file.size > hundredmb ) {\n\t\tsetTimeout( function() {\n\t\t\tif ( file.status < 3 && file.loaded === 0 ) { // not uploading\n\t\t\t\twpFileError( file, pluploadL10n.big_upload_failed.replace( '%1$s', '<a class=\"uploader-html\" href=\"#\">' ).replace( '%2$s', '</a>' ) );\n\t\t\t\tup.stop(); // stops the whole queue\n\t\t\t\tup.removeFile( file );\n\t\t\t\tup.start(); // restart the queue\n\t\t\t}\n\t\t}, 10000 ); // wait for 10 sec. for the file to start uploading\n\t}\n}\n\nfunction updateMediaForm() {\n\tvar items = jQuery('#media-items').children();\n\n\t// Just one file, no need for collapsible part\n\tif ( items.length == 1 ) {\n\t\titems.addClass('open').find('.slidetoggle').show();\n\t\tjQuery('.insert-gallery').hide();\n\t} else if ( items.length > 1 ) {\n\t\titems.removeClass('open');\n\t\t// Only show Gallery/Playlist buttons when there are at least two files.\n\t\tjQuery('.insert-gallery').show();\n\t}\n\n\t// Only show Save buttons when there is at least one file.\n\tif ( items.not('.media-blank').length > 0 )\n\t\tjQuery('.savebutton').show();\n\telse\n\t\tjQuery('.savebutton').hide();\n}\n\nfunction uploadSuccess(fileObj, serverData) {\n\tvar item = jQuery('#media-item-' + fileObj.id);\n\n\t// on success serverData should be numeric, fix bug in html4 runtime returning the serverData wrapped in a <pre> tag\n\tserverData = serverData.replace(/^<pre>(\\d+)<\\/pre>$/, '$1');\n\n\t// if async-upload returned an error message, place it in the media item div and return\n\tif ( serverData.match(/media-upload-error|error-div/) ) {\n\t\titem.html(serverData);\n\t\treturn;\n\t} else {\n\t\tjQuery('.percent', item).html( pluploadL10n.crunching );\n\t}\n\n\tprepareMediaItem(fileObj, serverData);\n\tupdateMediaForm();\n\n\t// Increment the counter.\n\tif ( post_id && item.hasClass('child-of-' + post_id) )\n\t\tjQuery('#attachments-count').text(1 * jQuery('#attachments-count').text() + 1);\n}\n\nfunction setResize( arg ) {\n\tif ( arg ) {\n\t\tif ( window.resize_width && window.resize_height ) {\n\t\t\tuploader.settings.resize = {\n\t\t\t\tenabled: true,\n\t\t\t\twidth: window.resize_width,\n\t\t\t\theight: window.resize_height,\n\t\t\t\tquality: 100\n\t\t\t};\n\t\t} else {\n\t\t\tuploader.settings.multipart_params.image_resize = true;\n\t\t}\n\t} else {\n\t\tdelete( uploader.settings.multipart_params.image_resize );\n\t}\n}\n\nfunction prepareMediaItem(fileObj, serverData) {\n\tvar f = ( typeof shortform == 'undefined' ) ? 1 : 2, item = jQuery('#media-item-' + fileObj.id);\n\tif ( f == 2 && shortform > 2 )\n\t\tf = shortform;\n\n\ttry {\n\t\tif ( typeof topWin.tb_remove != 'undefined' )\n\t\t\ttopWin.jQuery('#TB_overlay').click(topWin.tb_remove);\n\t} catch(e){}\n\n\tif ( isNaN(serverData) || !serverData ) { // Old style: Append the HTML returned by the server -- thumbnail and form inputs\n\t\titem.append(serverData);\n\t\tprepareMediaItemInit(fileObj);\n\t} else { // New style: server data is just the attachment ID, fetch the thumbnail and form html from the server\n\t\titem.load('async-upload.php', {attachment_id:serverData, fetch:f}, function(){prepareMediaItemInit(fileObj);updateMediaForm();});\n\t}\n}\n\nfunction prepareMediaItemInit(fileObj) {\n\tvar item = jQuery('#media-item-' + fileObj.id);\n\t// Clone the thumbnail as a \"pinkynail\" -- a tiny image to the left of the filename\n\tjQuery('.thumbnail', item).clone().attr('class', 'pinkynail toggle').prependTo(item);\n\n\t// Replace the original filename with the new (unique) one assigned during upload\n\tjQuery('.filename.original', item).replaceWith( jQuery('.filename.new', item) );\n\n\t// Bind AJAX to the new Delete button\n\tjQuery('a.delete', item).click(function(){\n\t\t// Tell the server to delete it. TODO: handle exceptions\n\t\tjQuery.ajax({\n\t\t\turl: ajaxurl,\n\t\t\ttype: 'post',\n\t\t\tsuccess: deleteSuccess,\n\t\t\terror: deleteError,\n\t\t\tid: fileObj.id,\n\t\t\tdata: {\n\t\t\t\tid : this.id.replace(/[^0-9]/g, ''),\n\t\t\t\taction : 'trash-post',\n\t\t\t\t_ajax_nonce : this.href.replace(/^.*wpnonce=/,'')\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n\n\t// Bind AJAX to the new Undo button\n\tjQuery('a.undo', item).click(function(){\n\t\t// Tell the server to untrash it. TODO: handle exceptions\n\t\tjQuery.ajax({\n\t\t\turl: ajaxurl,\n\t\t\ttype: 'post',\n\t\t\tid: fileObj.id,\n\t\t\tdata: {\n\t\t\t\tid : this.id.replace(/[^0-9]/g,''),\n\t\t\t\taction: 'untrash-post',\n\t\t\t\t_ajax_nonce: this.href.replace(/^.*wpnonce=/,'')\n\t\t\t},\n\t\t\tsuccess: function( ){\n\t\t\t\tvar type,\n\t\t\t\t\titem = jQuery('#media-item-' + fileObj.id);\n\n\t\t\t\tif ( type = jQuery('#type-of-' + fileObj.id).val() )\n\t\t\t\t\tjQuery('#' + type + '-counter').text(jQuery('#' + type + '-counter').text()-0+1);\n\n\t\t\t\tif ( post_id && item.hasClass('child-of-'+post_id) )\n\t\t\t\t\tjQuery('#attachments-count').text(jQuery('#attachments-count').text()-0+1);\n\n\t\t\t\tjQuery('.filename .trashnotice', item).remove();\n\t\t\t\tjQuery('.filename .title', item).css('font-weight','normal');\n\t\t\t\tjQuery('a.undo', item).addClass('hidden');\n\t\t\t\tjQuery('.menu_order_input', item).show();\n\t\t\t\titem.css( {backgroundColor:'#ceb'} ).animate( {backgroundColor: '#fff'}, { queue: false, duration: 500, complete: function(){ jQuery(this).css({backgroundColor:''}); } }).removeClass('undo');\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n\n\t// Open this item if it says to start open (e.g. to display an error)\n\tjQuery('#media-item-' + fileObj.id + '.startopen').removeClass('startopen').addClass('open').find('slidetoggle').fadeIn();\n}\n\n// generic error message\nfunction wpQueueError(message) {\n\tjQuery('#media-upload-error').show().html( '<div class=\"error\"><p>' + message + '</p></div>' );\n}\n\n// file-specific error messages\nfunction wpFileError(fileObj, message) {\n\titemAjaxError(fileObj.id, message);\n}\n\nfunction itemAjaxError(id, message) {\n\tvar item = jQuery('#media-item-' + id), filename = item.find('.filename').text(), last_err = item.data('last-err');\n\n\tif ( last_err == id ) // prevent firing an error for the same file twice\n\t\treturn;\n\n\titem.html('<div class=\"error-div\">' +\n\t\t\t\t'<a class=\"dismiss\" href=\"#\">' + pluploadL10n.dismiss + '</a>' +\n\t\t\t\t'<strong>' + pluploadL10n.error_uploading.replace('%s', jQuery.trim(filename)) + '</strong> ' +\n\t\t\t\tmessage +\n\t\t\t\t'</div>').data('last-err', id);\n}\n\nfunction deleteSuccess(data) {\n\tvar type, id, item;\n\tif ( data == '-1' )\n\t\treturn itemAjaxError(this.id, 'You do not have permission. Has your session expired?');\n\n\tif ( data == '0' )\n\t\treturn itemAjaxError(this.id, 'Could not be deleted. Has it been deleted already?');\n\n\tid = this.id;\n\titem = jQuery('#media-item-' + id);\n\n\t// Decrement the counters.\n\tif ( type = jQuery('#type-of-' + id).val() )\n\t\tjQuery('#' + type + '-counter').text( jQuery('#' + type + '-counter').text() - 1 );\n\n\tif ( post_id && item.hasClass('child-of-'+post_id) )\n\t\tjQuery('#attachments-count').text( jQuery('#attachments-count').text() - 1 );\n\n\tif ( jQuery('form.type-form #media-items').children().length == 1 && jQuery('.hidden', '#media-items').length > 0 ) {\n\t\tjQuery('.toggle').toggle();\n\t\tjQuery('.slidetoggle').slideUp(200).siblings().removeClass('hidden');\n\t}\n\n\t// Vanish it.\n\tjQuery('.toggle', item).toggle();\n\tjQuery('.slidetoggle', item).slideUp(200).siblings().removeClass('hidden');\n\titem.css( {backgroundColor:'#faa'} ).animate( {backgroundColor:'#f4f4f4'}, {queue:false, duration:500} ).addClass('undo');\n\n\tjQuery('.filename:empty', item).remove();\n\tjQuery('.filename .title', item).css('font-weight','bold');\n\tjQuery('.filename', item).append('<span class=\"trashnotice\"> ' + pluploadL10n.deleted + ' </span>').siblings('a.toggle').hide();\n\tjQuery('.filename', item).append( jQuery('a.undo', item).removeClass('hidden') );\n\tjQuery('.menu_order_input', item).hide();\n\n\treturn;\n}\n\nfunction deleteError() {\n\t// TODO\n}\n\nfunction uploadComplete() {\n\tjQuery('#insert-gallery').prop('disabled', false);\n}\n\nfunction switchUploader(s) {\n\tif ( s ) {\n\t\tdeleteUserSetting('uploader');\n\t\tjQuery('.media-upload-form').removeClass('html-uploader');\n\n\t\tif ( typeof(uploader) == 'object' )\n\t\t\tuploader.refresh();\n\t} else {\n\t\tsetUserSetting('uploader', '1'); // 1 == html uploader\n\t\tjQuery('.media-upload-form').addClass('html-uploader');\n\t}\n}\n\nfunction uploadError(fileObj, errorCode, message, uploader) {\n\tvar hundredmb = 100 * 1024 * 1024, max;\n\n\tswitch (errorCode) {\n\t\tcase plupload.FAILED:\n\t\t\twpFileError(fileObj, pluploadL10n.upload_failed);\n\t\t\tbreak;\n\t\tcase plupload.FILE_EXTENSION_ERROR:\n\t\t\twpFileExtensionError( uploader, fileObj, pluploadL10n.invalid_filetype );\n\t\t\tbreak;\n\t\tcase plupload.FILE_SIZE_ERROR:\n\t\t\tuploadSizeError(uploader, fileObj);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_FORMAT_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.not_an_image);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_MEMORY_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.image_memory_exceeded);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_DIMENSIONS_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.image_dimensions_exceeded);\n\t\t\tbreak;\n\t\tcase plupload.GENERIC_ERROR:\n\t\t\twpQueueError(pluploadL10n.upload_failed);\n\t\t\tbreak;\n\t\tcase plupload.IO_ERROR:\n\t\t\tmax = parseInt( uploader.settings.filters.max_file_size, 10 );\n\n\t\t\tif ( max > hundredmb && fileObj.size > hundredmb )\n\t\t\t\twpFileError( fileObj, pluploadL10n.big_upload_failed.replace('%1$s', '<a class=\"uploader-html\" href=\"#\">').replace('%2$s', '</a>') );\n\t\t\telse\n\t\t\t\twpQueueError(pluploadL10n.io_error);\n\t\t\tbreak;\n\t\tcase plupload.HTTP_ERROR:\n\t\t\twpQueueError(pluploadL10n.http_error);\n\t\t\tbreak;\n\t\tcase plupload.INIT_ERROR:\n\t\t\tjQuery('.media-upload-form').addClass('html-uploader');\n\t\t\tbreak;\n\t\tcase plupload.SECURITY_ERROR:\n\t\t\twpQueueError(pluploadL10n.security_error);\n\t\t\tbreak;\n/*\t\tcase plupload.UPLOAD_ERROR.UPLOAD_STOPPED:\n\t\tcase plupload.UPLOAD_ERROR.FILE_CANCELLED:\n\t\t\tjQuery('#media-item-' + fileObj.id).remove();\n\t\t\tbreak;*/\n\t\tdefault:\n\t\t\twpFileError(fileObj, pluploadL10n.default_error);\n\t}\n}\n\nfunction uploadSizeError( up, file, over100mb ) {\n\tvar message;\n\n\tif ( over100mb )\n\t\tmessage = pluploadL10n.big_upload_queued.replace('%s', file.name) + ' ' + pluploadL10n.big_upload_failed.replace('%1$s', '<a class=\"uploader-html\" href=\"#\">').replace('%2$s', '</a>');\n\telse\n\t\tmessage = pluploadL10n.file_exceeds_size_limit.replace('%s', file.name);\n\n\tjQuery('#media-items').append('<div id=\"media-item-' + file.id + '\" class=\"media-item error\"><p>' + message + '</p></div>');\n\tup.removeFile(file);\n}\n\nfunction wpFileExtensionError( up, file, message ) {\n\tjQuery('#media-items').append('<div id=\"media-item-' + file.id + '\" class=\"media-item error\"><p>' + message + '</p></div>');\n\tup.removeFile(file);\n}\n\njQuery(document).ready(function($){\n\t$('.media-upload-form').bind('click.uploader', function(e) {\n\t\tvar target = $(e.target), tr, c;\n\n\t\tif ( target.is('input[type=\"radio\"]') ) { // remember the last used image size and alignment\n\t\t\ttr = target.closest('tr');\n\n\t\t\tif ( tr.hasClass('align') )\n\t\t\t\tsetUserSetting('align', target.val());\n\t\t\telse if ( tr.hasClass('image-size') )\n\t\t\t\tsetUserSetting('imgsize', target.val());\n\n\t\t} else if ( target.is('button.button') ) { // remember the last used image link url\n\t\t\tc = e.target.className || '';\n\t\t\tc = c.match(/url([^ '\"]+)/);\n\n\t\t\tif ( c && c[1] ) {\n\t\t\t\tsetUserSetting('urlbutton', c[1]);\n\t\t\t\ttarget.siblings('.urlfield').val( target.data('link-url') );\n\t\t\t}\n\t\t} else if ( target.is('a.dismiss') ) {\n\t\t\ttarget.parents('.media-item').fadeOut(200, function(){\n\t\t\t\t$(this).remove();\n\t\t\t});\n\t\t} else if ( target.is('.upload-flash-bypass a') || target.is('a.uploader-html') ) { // switch uploader to html4\n\t\t\t$('#media-items, p.submit, span.big-file-warning').css('display', 'none');\n\t\t\tswitchUploader(0);\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('.upload-html-bypass a') ) { // switch uploader to multi-file\n\t\t\t$('#media-items, p.submit, span.big-file-warning').css('display', '');\n\t\t\tswitchUploader(1);\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('a.describe-toggle-on') ) { // Show\n\t\t\ttarget.parent().addClass('open');\n\t\t\ttarget.siblings('.slidetoggle').fadeIn(250, function(){\n\t\t\t\tvar S = $(window).scrollTop(), H = $(window).height(), top = $(this).offset().top, h = $(this).height(), b, B;\n\n\t\t\t\tif ( H && top && h ) {\n\t\t\t\t\tb = top + h;\n\t\t\t\t\tB = S + H;\n\n\t\t\t\t\tif ( b > B ) {\n\t\t\t\t\t\tif ( b - B < top - S )\n\t\t\t\t\t\t\twindow.scrollBy(0, (b - B) + 10);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\twindow.scrollBy(0, top - S - 40);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('a.describe-toggle-off') ) { // Hide\n\t\t\ttarget.siblings('.slidetoggle').fadeOut(250, function(){\n\t\t\t\ttarget.parent().removeClass('open');\n\t\t\t});\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n\t// init and set the uploader\n\tuploader_init = function() {\n\t\tvar isIE = navigator.userAgent.indexOf('Trident/') != -1 || navigator.userAgent.indexOf('MSIE ') != -1;\n\n\t\t// Make sure flash sends cookies (seems in IE it does whitout switching to urlstream mode)\n\t\tif ( ! isIE && 'flash' === plupload.predictRuntime( wpUploaderInit ) &&\n\t\t\t( ! wpUploaderInit.required_features || ! wpUploaderInit.required_features.hasOwnProperty( 'send_binary_string' ) ) ) {\n\n\t\t\twpUploaderInit.required_features = wpUploaderInit.required_features || {};\n\t\t\twpUploaderInit.required_features.send_binary_string = true;\n\t\t}\n\n\t\tuploader = new plupload.Uploader(wpUploaderInit);\n\n\t\t$('#image_resize').bind('change', function() {\n\t\t\tvar arg = $(this).prop('checked');\n\n\t\t\tsetResize( arg );\n\n\t\t\tif ( arg )\n\t\t\t\tsetUserSetting('upload_resize', '1');\n\t\t\telse\n\t\t\t\tdeleteUserSetting('upload_resize');\n\t\t});\n\n\t\tuploader.bind('Init', function(up) {\n\t\t\tvar uploaddiv = $('#plupload-upload-ui');\n\n\t\t\tsetResize( getUserSetting('upload_resize', false) );\n\n\t\t\tif ( up.features.dragdrop && ! $(document.body).hasClass('mobile') ) {\n\t\t\t\tuploaddiv.addClass('drag-drop');\n\t\t\t\t$('#drag-drop-area').on('dragover.wp-uploader', function(){ // dragenter doesn't fire right :(\n\t\t\t\t\tuploaddiv.addClass('drag-over');\n\t\t\t\t}).on('dragleave.wp-uploader, drop.wp-uploader', function(){\n\t\t\t\t\tuploaddiv.removeClass('drag-over');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tuploaddiv.removeClass('drag-drop');\n\t\t\t\t$('#drag-drop-area').off('.wp-uploader');\n\t\t\t}\n\n\t\t\tif ( up.runtime === 'html4' ) {\n\t\t\t\t$('.upload-flash-bypass').hide();\n\t\t\t}\n\t\t});\n\n\t\tuploader.bind( 'postinit', function( up ) {\n\t\t\tup.refresh();\n\t\t});\n\n\t\tuploader.init();\n\n\t\tuploader.bind('FilesAdded', function( up, files ) {\n\t\t\t$('#media-upload-error').empty();\n\t\t\tuploadStart();\n\n\t\t\tplupload.each( files, function( file ) {\n\t\t\t\tfileQueued( file );\n\t\t\t});\n\n\t\t\tup.refresh();\n\t\t\tup.start();\n\t\t});\n\n\t\tuploader.bind('UploadFile', function(up, file) {\n\t\t\tfileUploading(up, file);\n\t\t});\n\n\t\tuploader.bind('UploadProgress', function(up, file) {\n\t\t\tuploadProgress(up, file);\n\t\t});\n\n\t\tuploader.bind('Error', function(up, err) {\n\t\t\tuploadError(err.file, err.code, err.message, up);\n\t\t\tup.refresh();\n\t\t});\n\n\t\tuploader.bind('FileUploaded', function(up, file, response) {\n\t\t\tuploadSuccess(file, response.response);\n\t\t});\n\n\t\tuploader.bind('UploadComplete', function() {\n\t\t\tuploadComplete();\n\t\t});\n\t};\n\n\tif ( typeof(wpUploaderInit) == 'object' ) {\n\t\tuploader_init();\n\t}\n\n});\n", "function fileQueued(a){jQuery(\".media-blank\").remove();var b=jQuery(\"#media-items\").children(),c=post_id||0;1==b.length&&b.removeClass(\"open\").find(\".slidetoggle\").slideUp(200),jQuery('<div class=\"media-item\">').attr(\"id\",\"media-item-\"+a.id).addClass(\"child-of-\"+c).append('<div class=\"progress\"><div class=\"percent\">0%</div><div class=\"bar\"></div></div>',jQuery('<div class=\"filename original\">').text(\" \"+a.name)).appendTo(jQuery(\"#media-items\")),jQuery(\"#insert-gallery\").prop(\"disabled\",!0)}function uploadStart(){try{\"undefined\"!=typeof topWin.tb_remove&&topWin.jQuery(\"#TB_overlay\").unbind(\"click\",topWin.tb_remove)}catch(a){}return!0}function uploadProgress(a,b){var c=jQuery(\"#media-item-\"+b.id);jQuery(\".bar\",c).width(200*b.loaded/b.size),jQuery(\".percent\",c).html(b.percent+\"%\")}function fileUploading(a,b){var c=104857600,d=parseInt(a.settings.max_file_size,10);d>c&&b.size>c&&setTimeout(function(){b.status<3&&0===b.loaded&&(wpFileError(b,pluploadL10n.big_upload_failed.replace(\"%1$s\",'<a class=\"uploader-html\" href=\"#\">').replace(\"%2$s\",\"</a>\")),a.stop(),a.removeFile(b),a.start())},1e4)}function updateMediaForm(){var a=jQuery(\"#media-items\").children();1==a.length?(a.addClass(\"open\").find(\".slidetoggle\").show(),jQuery(\".insert-gallery\").hide()):a.length>1&&(a.removeClass(\"open\"),jQuery(\".insert-gallery\").show()),a.not(\".media-blank\").length>0?jQuery(\".savebutton\").show():jQuery(\".savebutton\").hide()}function uploadSuccess(a,b){var c=jQuery(\"#media-item-\"+a.id);return b=b.replace(/^<pre>(\\d+)<\\/pre>$/,\"$1\"),b.match(/media-upload-error|error-div/)?void c.html(b):(jQuery(\".percent\",c).html(pluploadL10n.crunching),prepareMediaItem(a,b),updateMediaForm(),void(post_id&&c.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(1*jQuery(\"#attachments-count\").text()+1)))}function setResize(a){a?window.resize_width&&window.resize_height?uploader.settings.resize={enabled:!0,width:window.resize_width,height:window.resize_height,quality:100}:uploader.settings.multipart_params.image_resize=!0:delete uploader.settings.multipart_params.image_resize}function prepareMediaItem(a,b){var c=\"undefined\"==typeof shortform?1:2,d=jQuery(\"#media-item-\"+a.id);2==c&&shortform>2&&(c=shortform);try{\"undefined\"!=typeof topWin.tb_remove&&topWin.jQuery(\"#TB_overlay\").click(topWin.tb_remove)}catch(e){}isNaN(b)||!b?(d.append(b),prepareMediaItemInit(a)):d.load(\"async-upload.php\",{attachment_id:b,fetch:c},function(){prepareMediaItemInit(a),updateMediaForm()})}function prepareMediaItemInit(a){var b=jQuery(\"#media-item-\"+a.id);jQuery(\".thumbnail\",b).clone().attr(\"class\",\"pinkynail toggle\").prependTo(b),jQuery(\".filename.original\",b).replaceWith(jQuery(\".filename.new\",b)),jQuery(\"a.delete\",b).click(function(){return jQuery.ajax({url:ajaxurl,type:\"post\",success:deleteSuccess,error:deleteError,id:a.id,data:{id:this.id.replace(/[^0-9]/g,\"\"),action:\"trash-post\",_ajax_nonce:this.href.replace(/^.*wpnonce=/,\"\")}}),!1}),jQuery(\"a.undo\",b).click(function(){return jQuery.ajax({url:ajaxurl,type:\"post\",id:a.id,data:{id:this.id.replace(/[^0-9]/g,\"\"),action:\"untrash-post\",_ajax_nonce:this.href.replace(/^.*wpnonce=/,\"\")},success:function(){var b,c=jQuery(\"#media-item-\"+a.id);(b=jQuery(\"#type-of-\"+a.id).val())&&jQuery(\"#\"+b+\"-counter\").text(jQuery(\"#\"+b+\"-counter\").text()-0+1),post_id&&c.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(jQuery(\"#attachments-count\").text()-0+1),jQuery(\".filename .trashnotice\",c).remove(),jQuery(\".filename .title\",c).css(\"font-weight\",\"normal\"),jQuery(\"a.undo\",c).addClass(\"hidden\"),jQuery(\".menu_order_input\",c).show(),c.css({backgroundColor:\"#ceb\"}).animate({backgroundColor:\"#fff\"},{queue:!1,duration:500,complete:function(){jQuery(this).css({backgroundColor:\"\"})}}).removeClass(\"undo\")}}),!1}),jQuery(\"#media-item-\"+a.id+\".startopen\").removeClass(\"startopen\").addClass(\"open\").find(\"slidetoggle\").fadeIn()}function wpQueueError(a){jQuery(\"#media-upload-error\").show().html('<div class=\"error\"><p>'+a+\"</p></div>\")}function wpFileError(a,b){itemAjaxError(a.id,b)}function itemAjaxError(a,b){var c=jQuery(\"#media-item-\"+a),d=c.find(\".filename\").text(),e=c.data(\"last-err\");e!=a&&c.html('<div class=\"error-div\"><a class=\"dismiss\" href=\"#\">'+pluploadL10n.dismiss+\"</a><strong>\"+pluploadL10n.error_uploading.replace(\"%s\",jQuery.trim(d))+\"</strong> \"+b+\"</div>\").data(\"last-err\",a)}function deleteSuccess(a){var b,c,d;return\"-1\"==a?itemAjaxError(this.id,\"You do not have permission. Has your session expired?\"):\"0\"==a?itemAjaxError(this.id,\"Could not be deleted. Has it been deleted already?\"):(c=this.id,d=jQuery(\"#media-item-\"+c),(b=jQuery(\"#type-of-\"+c).val())&&jQuery(\"#\"+b+\"-counter\").text(jQuery(\"#\"+b+\"-counter\").text()-1),post_id&&d.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(jQuery(\"#attachments-count\").text()-1),1==jQuery(\"form.type-form #media-items\").children().length&&jQuery(\".hidden\",\"#media-items\").length>0&&(jQuery(\".toggle\").toggle(),jQuery(\".slidetoggle\").slideUp(200).siblings().removeClass(\"hidden\")),jQuery(\".toggle\",d).toggle(),jQuery(\".slidetoggle\",d).slideUp(200).siblings().removeClass(\"hidden\"),d.css({backgroundColor:\"#faa\"}).animate({backgroundColor:\"#f4f4f4\"},{queue:!1,duration:500}).addClass(\"undo\"),jQuery(\".filename:empty\",d).remove(),jQuery(\".filename .title\",d).css(\"font-weight\",\"bold\"),jQuery(\".filename\",d).append('<span class=\"trashnotice\"> '+pluploadL10n.deleted+\" </span>\").siblings(\"a.toggle\").hide(),jQuery(\".filename\",d).append(jQuery(\"a.undo\",d).removeClass(\"hidden\")),void jQuery(\".menu_order_input\",d).hide())}function deleteError(){}function uploadComplete(){jQuery(\"#insert-gallery\").prop(\"disabled\",!1)}function switchUploader(a){a?(deleteUserSetting(\"uploader\"),jQuery(\".media-upload-form\").removeClass(\"html-uploader\"),\"object\"==typeof uploader&&uploader.refresh()):(setUserSetting(\"uploader\",\"1\"),jQuery(\".media-upload-form\").addClass(\"html-uploader\"))}function uploadError(a,b,c,d){var e,f=104857600;switch(b){case plupload.FAILED:wpFileError(a,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:wpFileExtensionError(d,a,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(d,a);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(a,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(a,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(a,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:e=parseInt(d.settings.filters.max_file_size,10),e>f&&a.size>f?wpFileError(a,pluploadL10n.big_upload_failed.replace(\"%1$s\",'<a class=\"uploader-html\" href=\"#\">').replace(\"%2$s\",\"</a>\")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(\".media-upload-form\").addClass(\"html-uploader\");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(a,pluploadL10n.default_error)}}function uploadSizeError(a,b,c){var d;d=c?pluploadL10n.big_upload_queued.replace(\"%s\",b.name)+\" \"+pluploadL10n.big_upload_failed.replace(\"%1$s\",'<a class=\"uploader-html\" href=\"#\">').replace(\"%2$s\",\"</a>\"):pluploadL10n.file_exceeds_size_limit.replace(\"%s\",b.name),jQuery(\"#media-items\").append('<div id=\"media-item-'+b.id+'\" class=\"media-item error\"><p>'+d+\"</p></div>\"),a.removeFile(b)}function wpFileExtensionError(a,b,c){jQuery(\"#media-items\").append('<div id=\"media-item-'+b.id+'\" class=\"media-item error\"><p>'+c+\"</p></div>\"),a.removeFile(b)}var topWin=window.dialogArguments||opener||parent||top,uploader,uploader_init;jQuery(document).ready(function(a){a(\".media-upload-form\").bind(\"click.uploader\",function(b){var c,d,e=a(b.target);e.is('input[type=\"radio\"]')?(c=e.closest(\"tr\"),c.hasClass(\"align\")?setUserSetting(\"align\",e.val()):c.hasClass(\"image-size\")&&setUserSetting(\"imgsize\",e.val())):e.is(\"button.button\")?(d=b.target.className||\"\",d=d.match(/url([^ '\"]+)/),d&&d[1]&&(setUserSetting(\"urlbutton\",d[1]),e.siblings(\".urlfield\").val(e.data(\"link-url\")))):e.is(\"a.dismiss\")?e.parents(\".media-item\").fadeOut(200,function(){a(this).remove()}):e.is(\".upload-flash-bypass a\")||e.is(\"a.uploader-html\")?(a(\"#media-items, p.submit, span.big-file-warning\").css(\"display\",\"none\"),switchUploader(0),b.preventDefault()):e.is(\".upload-html-bypass a\")?(a(\"#media-items, p.submit, span.big-file-warning\").css(\"display\",\"\"),switchUploader(1),b.preventDefault()):e.is(\"a.describe-toggle-on\")?(e.parent().addClass(\"open\"),e.siblings(\".slidetoggle\").fadeIn(250,function(){var b,c,d=a(window).scrollTop(),e=a(window).height(),f=a(this).offset().top,g=a(this).height();e&&f&&g&&(b=f+g,c=d+e,b>c&&(b-c<f-d?window.scrollBy(0,b-c+10):window.scrollBy(0,f-d-40)))}),b.preventDefault()):e.is(\"a.describe-toggle-off\")&&(e.siblings(\".slidetoggle\").fadeOut(250,function(){e.parent().removeClass(\"open\")}),b.preventDefault())}),uploader_init=function(){var b=navigator.userAgent.indexOf(\"Trident/\")!=-1||navigator.userAgent.indexOf(\"MSIE \")!=-1;b||\"flash\"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty(\"send_binary_string\")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),uploader=new plupload.Uploader(wpUploaderInit),a(\"#image_resize\").bind(\"change\",function(){var b=a(this).prop(\"checked\");setResize(b),b?setUserSetting(\"upload_resize\",\"1\"):deleteUserSetting(\"upload_resize\")}),uploader.bind(\"Init\",function(b){var c=a(\"#plupload-upload-ui\");setResize(getUserSetting(\"upload_resize\",!1)),b.features.dragdrop&&!a(document.body).hasClass(\"mobile\")?(c.addClass(\"drag-drop\"),a(\"#drag-drop-area\").on(\"dragover.wp-uploader\",function(){c.addClass(\"drag-over\")}).on(\"dragleave.wp-uploader, drop.wp-uploader\",function(){c.removeClass(\"drag-over\")})):(c.removeClass(\"drag-drop\"),a(\"#drag-drop-area\").off(\".wp-uploader\")),\"html4\"===b.runtime&&a(\".upload-flash-bypass\").hide()}),uploader.bind(\"postinit\",function(a){a.refresh()}),uploader.init(),uploader.bind(\"FilesAdded\",function(b,c){a(\"#media-upload-error\").empty(),uploadStart(),plupload.each(c,function(a){fileQueued(a)}),b.refresh(),b.start()}),uploader.bind(\"UploadFile\",function(a,b){fileUploading(a,b)}),uploader.bind(\"UploadProgress\",function(a,b){uploadProgress(a,b)}),uploader.bind(\"Error\",function(a,b){uploadError(b.file,b.code,b.message,a),a.refresh()}),uploader.bind(\"FileUploaded\",function(a,b,c){uploadSuccess(b,c.response)}),uploader.bind(\"UploadComplete\",function(){uploadComplete()})},\"object\"==typeof wpUploaderInit&&uploader_init()});", "<?php\n/**\n * The WordPress version string\n *\n * @global string $wp_version\n */\n$wp_version = '4.8-beta1-40723';\n\n/**\n * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.\n *\n * @global int $wp_db_version\n */\n$wp_db_version = 38590;\n\n/**\n * Holds the TinyMCE version\n *\n * @global string $tinymce_version\n */\n$tinymce_version = '4601-20170510';\n\n/**\n * Holds the required PHP version\n *\n * @global string $required_php_version\n */\n$required_php_version = '5.2.4';\n\n/**\n * Holds the required MySQL version\n *\n * @global string $required_mysql_version\n */\n$required_mysql_version = '5.0';\n"], "fixing_code": ["/* global plupload, pluploadL10n, ajaxurl, post_id, wpUploaderInit, deleteUserSetting, setUserSetting, getUserSetting, shortform */\nvar topWin = window.dialogArguments || opener || parent || top, uploader, uploader_init;\n\n// progress and success handlers for media multi uploads\nfunction fileQueued(fileObj) {\n\t// Get rid of unused form\n\tjQuery('.media-blank').remove();\n\n\tvar items = jQuery('#media-items').children(), postid = post_id || 0;\n\n\t// Collapse a single item\n\tif ( items.length == 1 ) {\n\t\titems.removeClass('open').find('.slidetoggle').slideUp(200);\n\t}\n\t// Create a progress bar containing the filename\n\tjQuery('<div class=\"media-item\">')\n\t\t.attr( 'id', 'media-item-' + fileObj.id )\n\t\t.addClass('child-of-' + postid)\n\t\t.append('<div class=\"progress\"><div class=\"percent\">0%</div><div class=\"bar\"></div></div>',\n\t\t\tjQuery('<div class=\"filename original\">').text( ' ' + fileObj.name ))\n\t\t.appendTo( jQuery('#media-items' ) );\n\n\t// Disable submit\n\tjQuery('#insert-gallery').prop('disabled', true);\n}\n\nfunction uploadStart() {\n\ttry {\n\t\tif ( typeof topWin.tb_remove != 'undefined' )\n\t\t\ttopWin.jQuery('#TB_overlay').unbind('click', topWin.tb_remove);\n\t} catch(e){}\n\n\treturn true;\n}\n\nfunction uploadProgress(up, file) {\n\tvar item = jQuery('#media-item-' + file.id);\n\n\tjQuery('.bar', item).width( (200 * file.loaded) / file.size );\n\tjQuery('.percent', item).html( file.percent + '%' );\n}\n\n// check to see if a large file failed to upload\nfunction fileUploading( up, file ) {\n\tvar hundredmb = 100 * 1024 * 1024,\n\t\tmax = parseInt( up.settings.max_file_size, 10 );\n\n\tif ( max > hundredmb && file.size > hundredmb ) {\n\t\tsetTimeout( function() {\n\t\t\tif ( file.status < 3 && file.loaded === 0 ) { // not uploading\n\t\t\t\twpFileError( file, pluploadL10n.big_upload_failed.replace( '%1$s', '<a class=\"uploader-html\" href=\"#\">' ).replace( '%2$s', '</a>' ) );\n\t\t\t\tup.stop(); // stops the whole queue\n\t\t\t\tup.removeFile( file );\n\t\t\t\tup.start(); // restart the queue\n\t\t\t}\n\t\t}, 10000 ); // wait for 10 sec. for the file to start uploading\n\t}\n}\n\nfunction updateMediaForm() {\n\tvar items = jQuery('#media-items').children();\n\n\t// Just one file, no need for collapsible part\n\tif ( items.length == 1 ) {\n\t\titems.addClass('open').find('.slidetoggle').show();\n\t\tjQuery('.insert-gallery').hide();\n\t} else if ( items.length > 1 ) {\n\t\titems.removeClass('open');\n\t\t// Only show Gallery/Playlist buttons when there are at least two files.\n\t\tjQuery('.insert-gallery').show();\n\t}\n\n\t// Only show Save buttons when there is at least one file.\n\tif ( items.not('.media-blank').length > 0 )\n\t\tjQuery('.savebutton').show();\n\telse\n\t\tjQuery('.savebutton').hide();\n}\n\nfunction uploadSuccess(fileObj, serverData) {\n\tvar item = jQuery('#media-item-' + fileObj.id);\n\n\t// on success serverData should be numeric, fix bug in html4 runtime returning the serverData wrapped in a <pre> tag\n\tserverData = serverData.replace(/^<pre>(\\d+)<\\/pre>$/, '$1');\n\n\t// if async-upload returned an error message, place it in the media item div and return\n\tif ( serverData.match(/media-upload-error|error-div/) ) {\n\t\titem.html(serverData);\n\t\treturn;\n\t} else {\n\t\tjQuery('.percent', item).html( pluploadL10n.crunching );\n\t}\n\n\tprepareMediaItem(fileObj, serverData);\n\tupdateMediaForm();\n\n\t// Increment the counter.\n\tif ( post_id && item.hasClass('child-of-' + post_id) )\n\t\tjQuery('#attachments-count').text(1 * jQuery('#attachments-count').text() + 1);\n}\n\nfunction setResize( arg ) {\n\tif ( arg ) {\n\t\tif ( window.resize_width && window.resize_height ) {\n\t\t\tuploader.settings.resize = {\n\t\t\t\tenabled: true,\n\t\t\t\twidth: window.resize_width,\n\t\t\t\theight: window.resize_height,\n\t\t\t\tquality: 100\n\t\t\t};\n\t\t} else {\n\t\t\tuploader.settings.multipart_params.image_resize = true;\n\t\t}\n\t} else {\n\t\tdelete( uploader.settings.multipart_params.image_resize );\n\t}\n}\n\nfunction prepareMediaItem(fileObj, serverData) {\n\tvar f = ( typeof shortform == 'undefined' ) ? 1 : 2, item = jQuery('#media-item-' + fileObj.id);\n\tif ( f == 2 && shortform > 2 )\n\t\tf = shortform;\n\n\ttry {\n\t\tif ( typeof topWin.tb_remove != 'undefined' )\n\t\t\ttopWin.jQuery('#TB_overlay').click(topWin.tb_remove);\n\t} catch(e){}\n\n\tif ( isNaN(serverData) || !serverData ) { // Old style: Append the HTML returned by the server -- thumbnail and form inputs\n\t\titem.append(serverData);\n\t\tprepareMediaItemInit(fileObj);\n\t} else { // New style: server data is just the attachment ID, fetch the thumbnail and form html from the server\n\t\titem.load('async-upload.php', {attachment_id:serverData, fetch:f}, function(){prepareMediaItemInit(fileObj);updateMediaForm();});\n\t}\n}\n\nfunction prepareMediaItemInit(fileObj) {\n\tvar item = jQuery('#media-item-' + fileObj.id);\n\t// Clone the thumbnail as a \"pinkynail\" -- a tiny image to the left of the filename\n\tjQuery('.thumbnail', item).clone().attr('class', 'pinkynail toggle').prependTo(item);\n\n\t// Replace the original filename with the new (unique) one assigned during upload\n\tjQuery('.filename.original', item).replaceWith( jQuery('.filename.new', item) );\n\n\t// Bind AJAX to the new Delete button\n\tjQuery('a.delete', item).click(function(){\n\t\t// Tell the server to delete it. TODO: handle exceptions\n\t\tjQuery.ajax({\n\t\t\turl: ajaxurl,\n\t\t\ttype: 'post',\n\t\t\tsuccess: deleteSuccess,\n\t\t\terror: deleteError,\n\t\t\tid: fileObj.id,\n\t\t\tdata: {\n\t\t\t\tid : this.id.replace(/[^0-9]/g, ''),\n\t\t\t\taction : 'trash-post',\n\t\t\t\t_ajax_nonce : this.href.replace(/^.*wpnonce=/,'')\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n\n\t// Bind AJAX to the new Undo button\n\tjQuery('a.undo', item).click(function(){\n\t\t// Tell the server to untrash it. TODO: handle exceptions\n\t\tjQuery.ajax({\n\t\t\turl: ajaxurl,\n\t\t\ttype: 'post',\n\t\t\tid: fileObj.id,\n\t\t\tdata: {\n\t\t\t\tid : this.id.replace(/[^0-9]/g,''),\n\t\t\t\taction: 'untrash-post',\n\t\t\t\t_ajax_nonce: this.href.replace(/^.*wpnonce=/,'')\n\t\t\t},\n\t\t\tsuccess: function( ){\n\t\t\t\tvar type,\n\t\t\t\t\titem = jQuery('#media-item-' + fileObj.id);\n\n\t\t\t\tif ( type = jQuery('#type-of-' + fileObj.id).val() )\n\t\t\t\t\tjQuery('#' + type + '-counter').text(jQuery('#' + type + '-counter').text()-0+1);\n\n\t\t\t\tif ( post_id && item.hasClass('child-of-'+post_id) )\n\t\t\t\t\tjQuery('#attachments-count').text(jQuery('#attachments-count').text()-0+1);\n\n\t\t\t\tjQuery('.filename .trashnotice', item).remove();\n\t\t\t\tjQuery('.filename .title', item).css('font-weight','normal');\n\t\t\t\tjQuery('a.undo', item).addClass('hidden');\n\t\t\t\tjQuery('.menu_order_input', item).show();\n\t\t\t\titem.css( {backgroundColor:'#ceb'} ).animate( {backgroundColor: '#fff'}, { queue: false, duration: 500, complete: function(){ jQuery(this).css({backgroundColor:''}); } }).removeClass('undo');\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n\n\t// Open this item if it says to start open (e.g. to display an error)\n\tjQuery('#media-item-' + fileObj.id + '.startopen').removeClass('startopen').addClass('open').find('slidetoggle').fadeIn();\n}\n\n// generic error message\nfunction wpQueueError(message) {\n\tjQuery('#media-upload-error').show().html( '<div class=\"error\"><p>' + message + '</p></div>' );\n}\n\n// file-specific error messages\nfunction wpFileError(fileObj, message) {\n\titemAjaxError(fileObj.id, message);\n}\n\nfunction itemAjaxError(id, message) {\n\tvar item = jQuery('#media-item-' + id), filename = item.find('.filename').text(), last_err = item.data('last-err');\n\n\tif ( last_err == id ) // prevent firing an error for the same file twice\n\t\treturn;\n\n\titem.html('<div class=\"error-div\">' +\n\t\t\t\t'<a class=\"dismiss\" href=\"#\">' + pluploadL10n.dismiss + '</a>' +\n\t\t\t\t'<strong>' + pluploadL10n.error_uploading.replace('%s', jQuery.trim(filename)) + '</strong> ' +\n\t\t\t\tmessage +\n\t\t\t\t'</div>').data('last-err', id);\n}\n\nfunction deleteSuccess(data) {\n\tvar type, id, item;\n\tif ( data == '-1' )\n\t\treturn itemAjaxError(this.id, 'You do not have permission. Has your session expired?');\n\n\tif ( data == '0' )\n\t\treturn itemAjaxError(this.id, 'Could not be deleted. Has it been deleted already?');\n\n\tid = this.id;\n\titem = jQuery('#media-item-' + id);\n\n\t// Decrement the counters.\n\tif ( type = jQuery('#type-of-' + id).val() )\n\t\tjQuery('#' + type + '-counter').text( jQuery('#' + type + '-counter').text() - 1 );\n\n\tif ( post_id && item.hasClass('child-of-'+post_id) )\n\t\tjQuery('#attachments-count').text( jQuery('#attachments-count').text() - 1 );\n\n\tif ( jQuery('form.type-form #media-items').children().length == 1 && jQuery('.hidden', '#media-items').length > 0 ) {\n\t\tjQuery('.toggle').toggle();\n\t\tjQuery('.slidetoggle').slideUp(200).siblings().removeClass('hidden');\n\t}\n\n\t// Vanish it.\n\tjQuery('.toggle', item).toggle();\n\tjQuery('.slidetoggle', item).slideUp(200).siblings().removeClass('hidden');\n\titem.css( {backgroundColor:'#faa'} ).animate( {backgroundColor:'#f4f4f4'}, {queue:false, duration:500} ).addClass('undo');\n\n\tjQuery('.filename:empty', item).remove();\n\tjQuery('.filename .title', item).css('font-weight','bold');\n\tjQuery('.filename', item).append('<span class=\"trashnotice\"> ' + pluploadL10n.deleted + ' </span>').siblings('a.toggle').hide();\n\tjQuery('.filename', item).append( jQuery('a.undo', item).removeClass('hidden') );\n\tjQuery('.menu_order_input', item).hide();\n\n\treturn;\n}\n\nfunction deleteError() {\n\t// TODO\n}\n\nfunction uploadComplete() {\n\tjQuery('#insert-gallery').prop('disabled', false);\n}\n\nfunction switchUploader(s) {\n\tif ( s ) {\n\t\tdeleteUserSetting('uploader');\n\t\tjQuery('.media-upload-form').removeClass('html-uploader');\n\n\t\tif ( typeof(uploader) == 'object' )\n\t\t\tuploader.refresh();\n\t} else {\n\t\tsetUserSetting('uploader', '1'); // 1 == html uploader\n\t\tjQuery('.media-upload-form').addClass('html-uploader');\n\t}\n}\n\nfunction uploadError(fileObj, errorCode, message, uploader) {\n\tvar hundredmb = 100 * 1024 * 1024, max;\n\n\tswitch (errorCode) {\n\t\tcase plupload.FAILED:\n\t\t\twpFileError(fileObj, pluploadL10n.upload_failed);\n\t\t\tbreak;\n\t\tcase plupload.FILE_EXTENSION_ERROR:\n\t\t\twpFileExtensionError( uploader, fileObj, pluploadL10n.invalid_filetype );\n\t\t\tbreak;\n\t\tcase plupload.FILE_SIZE_ERROR:\n\t\t\tuploadSizeError(uploader, fileObj);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_FORMAT_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.not_an_image);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_MEMORY_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.image_memory_exceeded);\n\t\t\tbreak;\n\t\tcase plupload.IMAGE_DIMENSIONS_ERROR:\n\t\t\twpFileError(fileObj, pluploadL10n.image_dimensions_exceeded);\n\t\t\tbreak;\n\t\tcase plupload.GENERIC_ERROR:\n\t\t\twpQueueError(pluploadL10n.upload_failed);\n\t\t\tbreak;\n\t\tcase plupload.IO_ERROR:\n\t\t\tmax = parseInt( uploader.settings.filters.max_file_size, 10 );\n\n\t\t\tif ( max > hundredmb && fileObj.size > hundredmb )\n\t\t\t\twpFileError( fileObj, pluploadL10n.big_upload_failed.replace('%1$s', '<a class=\"uploader-html\" href=\"#\">').replace('%2$s', '</a>') );\n\t\t\telse\n\t\t\t\twpQueueError(pluploadL10n.io_error);\n\t\t\tbreak;\n\t\tcase plupload.HTTP_ERROR:\n\t\t\twpQueueError(pluploadL10n.http_error);\n\t\t\tbreak;\n\t\tcase plupload.INIT_ERROR:\n\t\t\tjQuery('.media-upload-form').addClass('html-uploader');\n\t\t\tbreak;\n\t\tcase plupload.SECURITY_ERROR:\n\t\t\twpQueueError(pluploadL10n.security_error);\n\t\t\tbreak;\n/*\t\tcase plupload.UPLOAD_ERROR.UPLOAD_STOPPED:\n\t\tcase plupload.UPLOAD_ERROR.FILE_CANCELLED:\n\t\t\tjQuery('#media-item-' + fileObj.id).remove();\n\t\t\tbreak;*/\n\t\tdefault:\n\t\t\twpFileError(fileObj, pluploadL10n.default_error);\n\t}\n}\n\nfunction uploadSizeError( up, file ) {\n\tvar message, errorDiv;\n\n\tmessage = pluploadL10n.file_exceeds_size_limit.replace('%s', file.name);\n\n\t// Construct the error div.\n\terrorDiv = jQuery( '<div />' )\n\t\t.attr( {\n\t\t\t'id':    'media-item-' + file.id,\n\t\t\t'class': 'media-item error'\n\t\t} )\n\t\t.append(\n\t\t\tjQuery( '<p />' )\n\t\t\t\t.text( message )\n\t\t);\n\n\t// Append the error.\n\tjQuery('#media-items').append( errorDiv );\n\tup.removeFile(file);\n}\n\nfunction wpFileExtensionError( up, file, message ) {\n\tjQuery('#media-items').append('<div id=\"media-item-' + file.id + '\" class=\"media-item error\"><p>' + message + '</p></div>');\n\tup.removeFile(file);\n}\n\njQuery(document).ready(function($){\n\t$('.media-upload-form').bind('click.uploader', function(e) {\n\t\tvar target = $(e.target), tr, c;\n\n\t\tif ( target.is('input[type=\"radio\"]') ) { // remember the last used image size and alignment\n\t\t\ttr = target.closest('tr');\n\n\t\t\tif ( tr.hasClass('align') )\n\t\t\t\tsetUserSetting('align', target.val());\n\t\t\telse if ( tr.hasClass('image-size') )\n\t\t\t\tsetUserSetting('imgsize', target.val());\n\n\t\t} else if ( target.is('button.button') ) { // remember the last used image link url\n\t\t\tc = e.target.className || '';\n\t\t\tc = c.match(/url([^ '\"]+)/);\n\n\t\t\tif ( c && c[1] ) {\n\t\t\t\tsetUserSetting('urlbutton', c[1]);\n\t\t\t\ttarget.siblings('.urlfield').val( target.data('link-url') );\n\t\t\t}\n\t\t} else if ( target.is('a.dismiss') ) {\n\t\t\ttarget.parents('.media-item').fadeOut(200, function(){\n\t\t\t\t$(this).remove();\n\t\t\t});\n\t\t} else if ( target.is('.upload-flash-bypass a') || target.is('a.uploader-html') ) { // switch uploader to html4\n\t\t\t$('#media-items, p.submit, span.big-file-warning').css('display', 'none');\n\t\t\tswitchUploader(0);\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('.upload-html-bypass a') ) { // switch uploader to multi-file\n\t\t\t$('#media-items, p.submit, span.big-file-warning').css('display', '');\n\t\t\tswitchUploader(1);\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('a.describe-toggle-on') ) { // Show\n\t\t\ttarget.parent().addClass('open');\n\t\t\ttarget.siblings('.slidetoggle').fadeIn(250, function(){\n\t\t\t\tvar S = $(window).scrollTop(), H = $(window).height(), top = $(this).offset().top, h = $(this).height(), b, B;\n\n\t\t\t\tif ( H && top && h ) {\n\t\t\t\t\tb = top + h;\n\t\t\t\t\tB = S + H;\n\n\t\t\t\t\tif ( b > B ) {\n\t\t\t\t\t\tif ( b - B < top - S )\n\t\t\t\t\t\t\twindow.scrollBy(0, (b - B) + 10);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\twindow.scrollBy(0, top - S - 40);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\te.preventDefault();\n\t\t} else if ( target.is('a.describe-toggle-off') ) { // Hide\n\t\t\ttarget.siblings('.slidetoggle').fadeOut(250, function(){\n\t\t\t\ttarget.parent().removeClass('open');\n\t\t\t});\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n\t// init and set the uploader\n\tuploader_init = function() {\n\t\tvar isIE = navigator.userAgent.indexOf('Trident/') != -1 || navigator.userAgent.indexOf('MSIE ') != -1;\n\n\t\t// Make sure flash sends cookies (seems in IE it does whitout switching to urlstream mode)\n\t\tif ( ! isIE && 'flash' === plupload.predictRuntime( wpUploaderInit ) &&\n\t\t\t( ! wpUploaderInit.required_features || ! wpUploaderInit.required_features.hasOwnProperty( 'send_binary_string' ) ) ) {\n\n\t\t\twpUploaderInit.required_features = wpUploaderInit.required_features || {};\n\t\t\twpUploaderInit.required_features.send_binary_string = true;\n\t\t}\n\n\t\tuploader = new plupload.Uploader(wpUploaderInit);\n\n\t\t$('#image_resize').bind('change', function() {\n\t\t\tvar arg = $(this).prop('checked');\n\n\t\t\tsetResize( arg );\n\n\t\t\tif ( arg )\n\t\t\t\tsetUserSetting('upload_resize', '1');\n\t\t\telse\n\t\t\t\tdeleteUserSetting('upload_resize');\n\t\t});\n\n\t\tuploader.bind('Init', function(up) {\n\t\t\tvar uploaddiv = $('#plupload-upload-ui');\n\n\t\t\tsetResize( getUserSetting('upload_resize', false) );\n\n\t\t\tif ( up.features.dragdrop && ! $(document.body).hasClass('mobile') ) {\n\t\t\t\tuploaddiv.addClass('drag-drop');\n\t\t\t\t$('#drag-drop-area').on('dragover.wp-uploader', function(){ // dragenter doesn't fire right :(\n\t\t\t\t\tuploaddiv.addClass('drag-over');\n\t\t\t\t}).on('dragleave.wp-uploader, drop.wp-uploader', function(){\n\t\t\t\t\tuploaddiv.removeClass('drag-over');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tuploaddiv.removeClass('drag-drop');\n\t\t\t\t$('#drag-drop-area').off('.wp-uploader');\n\t\t\t}\n\n\t\t\tif ( up.runtime === 'html4' ) {\n\t\t\t\t$('.upload-flash-bypass').hide();\n\t\t\t}\n\t\t});\n\n\t\tuploader.bind( 'postinit', function( up ) {\n\t\t\tup.refresh();\n\t\t});\n\n\t\tuploader.init();\n\n\t\tuploader.bind('FilesAdded', function( up, files ) {\n\t\t\t$('#media-upload-error').empty();\n\t\t\tuploadStart();\n\n\t\t\tplupload.each( files, function( file ) {\n\t\t\t\tfileQueued( file );\n\t\t\t});\n\n\t\t\tup.refresh();\n\t\t\tup.start();\n\t\t});\n\n\t\tuploader.bind('UploadFile', function(up, file) {\n\t\t\tfileUploading(up, file);\n\t\t});\n\n\t\tuploader.bind('UploadProgress', function(up, file) {\n\t\t\tuploadProgress(up, file);\n\t\t});\n\n\t\tuploader.bind('Error', function(up, err) {\n\t\t\tuploadError(err.file, err.code, err.message, up);\n\t\t\tup.refresh();\n\t\t});\n\n\t\tuploader.bind('FileUploaded', function(up, file, response) {\n\t\t\tuploadSuccess(file, response.response);\n\t\t});\n\n\t\tuploader.bind('UploadComplete', function() {\n\t\t\tuploadComplete();\n\t\t});\n\t};\n\n\tif ( typeof(wpUploaderInit) == 'object' ) {\n\t\tuploader_init();\n\t}\n\n});\n", "function fileQueued(a){jQuery(\".media-blank\").remove();var b=jQuery(\"#media-items\").children(),c=post_id||0;1==b.length&&b.removeClass(\"open\").find(\".slidetoggle\").slideUp(200),jQuery('<div class=\"media-item\">').attr(\"id\",\"media-item-\"+a.id).addClass(\"child-of-\"+c).append('<div class=\"progress\"><div class=\"percent\">0%</div><div class=\"bar\"></div></div>',jQuery('<div class=\"filename original\">').text(\" \"+a.name)).appendTo(jQuery(\"#media-items\")),jQuery(\"#insert-gallery\").prop(\"disabled\",!0)}function uploadStart(){try{\"undefined\"!=typeof topWin.tb_remove&&topWin.jQuery(\"#TB_overlay\").unbind(\"click\",topWin.tb_remove)}catch(a){}return!0}function uploadProgress(a,b){var c=jQuery(\"#media-item-\"+b.id);jQuery(\".bar\",c).width(200*b.loaded/b.size),jQuery(\".percent\",c).html(b.percent+\"%\")}function fileUploading(a,b){var c=104857600,d=parseInt(a.settings.max_file_size,10);d>c&&b.size>c&&setTimeout(function(){b.status<3&&0===b.loaded&&(wpFileError(b,pluploadL10n.big_upload_failed.replace(\"%1$s\",'<a class=\"uploader-html\" href=\"#\">').replace(\"%2$s\",\"</a>\")),a.stop(),a.removeFile(b),a.start())},1e4)}function updateMediaForm(){var a=jQuery(\"#media-items\").children();1==a.length?(a.addClass(\"open\").find(\".slidetoggle\").show(),jQuery(\".insert-gallery\").hide()):a.length>1&&(a.removeClass(\"open\"),jQuery(\".insert-gallery\").show()),a.not(\".media-blank\").length>0?jQuery(\".savebutton\").show():jQuery(\".savebutton\").hide()}function uploadSuccess(a,b){var c=jQuery(\"#media-item-\"+a.id);return b=b.replace(/^<pre>(\\d+)<\\/pre>$/,\"$1\"),b.match(/media-upload-error|error-div/)?void c.html(b):(jQuery(\".percent\",c).html(pluploadL10n.crunching),prepareMediaItem(a,b),updateMediaForm(),void(post_id&&c.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(1*jQuery(\"#attachments-count\").text()+1)))}function setResize(a){a?window.resize_width&&window.resize_height?uploader.settings.resize={enabled:!0,width:window.resize_width,height:window.resize_height,quality:100}:uploader.settings.multipart_params.image_resize=!0:delete uploader.settings.multipart_params.image_resize}function prepareMediaItem(a,b){var c=\"undefined\"==typeof shortform?1:2,d=jQuery(\"#media-item-\"+a.id);2==c&&shortform>2&&(c=shortform);try{\"undefined\"!=typeof topWin.tb_remove&&topWin.jQuery(\"#TB_overlay\").click(topWin.tb_remove)}catch(e){}isNaN(b)||!b?(d.append(b),prepareMediaItemInit(a)):d.load(\"async-upload.php\",{attachment_id:b,fetch:c},function(){prepareMediaItemInit(a),updateMediaForm()})}function prepareMediaItemInit(a){var b=jQuery(\"#media-item-\"+a.id);jQuery(\".thumbnail\",b).clone().attr(\"class\",\"pinkynail toggle\").prependTo(b),jQuery(\".filename.original\",b).replaceWith(jQuery(\".filename.new\",b)),jQuery(\"a.delete\",b).click(function(){return jQuery.ajax({url:ajaxurl,type:\"post\",success:deleteSuccess,error:deleteError,id:a.id,data:{id:this.id.replace(/[^0-9]/g,\"\"),action:\"trash-post\",_ajax_nonce:this.href.replace(/^.*wpnonce=/,\"\")}}),!1}),jQuery(\"a.undo\",b).click(function(){return jQuery.ajax({url:ajaxurl,type:\"post\",id:a.id,data:{id:this.id.replace(/[^0-9]/g,\"\"),action:\"untrash-post\",_ajax_nonce:this.href.replace(/^.*wpnonce=/,\"\")},success:function(){var b,c=jQuery(\"#media-item-\"+a.id);(b=jQuery(\"#type-of-\"+a.id).val())&&jQuery(\"#\"+b+\"-counter\").text(jQuery(\"#\"+b+\"-counter\").text()-0+1),post_id&&c.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(jQuery(\"#attachments-count\").text()-0+1),jQuery(\".filename .trashnotice\",c).remove(),jQuery(\".filename .title\",c).css(\"font-weight\",\"normal\"),jQuery(\"a.undo\",c).addClass(\"hidden\"),jQuery(\".menu_order_input\",c).show(),c.css({backgroundColor:\"#ceb\"}).animate({backgroundColor:\"#fff\"},{queue:!1,duration:500,complete:function(){jQuery(this).css({backgroundColor:\"\"})}}).removeClass(\"undo\")}}),!1}),jQuery(\"#media-item-\"+a.id+\".startopen\").removeClass(\"startopen\").addClass(\"open\").find(\"slidetoggle\").fadeIn()}function wpQueueError(a){jQuery(\"#media-upload-error\").show().html('<div class=\"error\"><p>'+a+\"</p></div>\")}function wpFileError(a,b){itemAjaxError(a.id,b)}function itemAjaxError(a,b){var c=jQuery(\"#media-item-\"+a),d=c.find(\".filename\").text(),e=c.data(\"last-err\");e!=a&&c.html('<div class=\"error-div\"><a class=\"dismiss\" href=\"#\">'+pluploadL10n.dismiss+\"</a><strong>\"+pluploadL10n.error_uploading.replace(\"%s\",jQuery.trim(d))+\"</strong> \"+b+\"</div>\").data(\"last-err\",a)}function deleteSuccess(a){var b,c,d;return\"-1\"==a?itemAjaxError(this.id,\"You do not have permission. Has your session expired?\"):\"0\"==a?itemAjaxError(this.id,\"Could not be deleted. Has it been deleted already?\"):(c=this.id,d=jQuery(\"#media-item-\"+c),(b=jQuery(\"#type-of-\"+c).val())&&jQuery(\"#\"+b+\"-counter\").text(jQuery(\"#\"+b+\"-counter\").text()-1),post_id&&d.hasClass(\"child-of-\"+post_id)&&jQuery(\"#attachments-count\").text(jQuery(\"#attachments-count\").text()-1),1==jQuery(\"form.type-form #media-items\").children().length&&jQuery(\".hidden\",\"#media-items\").length>0&&(jQuery(\".toggle\").toggle(),jQuery(\".slidetoggle\").slideUp(200).siblings().removeClass(\"hidden\")),jQuery(\".toggle\",d).toggle(),jQuery(\".slidetoggle\",d).slideUp(200).siblings().removeClass(\"hidden\"),d.css({backgroundColor:\"#faa\"}).animate({backgroundColor:\"#f4f4f4\"},{queue:!1,duration:500}).addClass(\"undo\"),jQuery(\".filename:empty\",d).remove(),jQuery(\".filename .title\",d).css(\"font-weight\",\"bold\"),jQuery(\".filename\",d).append('<span class=\"trashnotice\"> '+pluploadL10n.deleted+\" </span>\").siblings(\"a.toggle\").hide(),jQuery(\".filename\",d).append(jQuery(\"a.undo\",d).removeClass(\"hidden\")),void jQuery(\".menu_order_input\",d).hide())}function deleteError(){}function uploadComplete(){jQuery(\"#insert-gallery\").prop(\"disabled\",!1)}function switchUploader(a){a?(deleteUserSetting(\"uploader\"),jQuery(\".media-upload-form\").removeClass(\"html-uploader\"),\"object\"==typeof uploader&&uploader.refresh()):(setUserSetting(\"uploader\",\"1\"),jQuery(\".media-upload-form\").addClass(\"html-uploader\"))}function uploadError(a,b,c,d){var e,f=104857600;switch(b){case plupload.FAILED:wpFileError(a,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:wpFileExtensionError(d,a,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(d,a);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(a,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(a,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(a,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:e=parseInt(d.settings.filters.max_file_size,10),e>f&&a.size>f?wpFileError(a,pluploadL10n.big_upload_failed.replace(\"%1$s\",'<a class=\"uploader-html\" href=\"#\">').replace(\"%2$s\",\"</a>\")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(\".media-upload-form\").addClass(\"html-uploader\");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(a,pluploadL10n.default_error)}}function uploadSizeError(a,b){var c,d;c=pluploadL10n.file_exceeds_size_limit.replace(\"%s\",b.name),d=jQuery(\"<div />\").attr({id:\"media-item-\"+b.id,\"class\":\"media-item error\"}).append(jQuery(\"<p />\").text(c)),jQuery(\"#media-items\").append(d),a.removeFile(b)}function wpFileExtensionError(a,b,c){jQuery(\"#media-items\").append('<div id=\"media-item-'+b.id+'\" class=\"media-item error\"><p>'+c+\"</p></div>\"),a.removeFile(b)}var topWin=window.dialogArguments||opener||parent||top,uploader,uploader_init;jQuery(document).ready(function(a){a(\".media-upload-form\").bind(\"click.uploader\",function(b){var c,d,e=a(b.target);e.is('input[type=\"radio\"]')?(c=e.closest(\"tr\"),c.hasClass(\"align\")?setUserSetting(\"align\",e.val()):c.hasClass(\"image-size\")&&setUserSetting(\"imgsize\",e.val())):e.is(\"button.button\")?(d=b.target.className||\"\",d=d.match(/url([^ '\"]+)/),d&&d[1]&&(setUserSetting(\"urlbutton\",d[1]),e.siblings(\".urlfield\").val(e.data(\"link-url\")))):e.is(\"a.dismiss\")?e.parents(\".media-item\").fadeOut(200,function(){a(this).remove()}):e.is(\".upload-flash-bypass a\")||e.is(\"a.uploader-html\")?(a(\"#media-items, p.submit, span.big-file-warning\").css(\"display\",\"none\"),switchUploader(0),b.preventDefault()):e.is(\".upload-html-bypass a\")?(a(\"#media-items, p.submit, span.big-file-warning\").css(\"display\",\"\"),switchUploader(1),b.preventDefault()):e.is(\"a.describe-toggle-on\")?(e.parent().addClass(\"open\"),e.siblings(\".slidetoggle\").fadeIn(250,function(){var b,c,d=a(window).scrollTop(),e=a(window).height(),f=a(this).offset().top,g=a(this).height();e&&f&&g&&(b=f+g,c=d+e,b>c&&(b-c<f-d?window.scrollBy(0,b-c+10):window.scrollBy(0,f-d-40)))}),b.preventDefault()):e.is(\"a.describe-toggle-off\")&&(e.siblings(\".slidetoggle\").fadeOut(250,function(){e.parent().removeClass(\"open\")}),b.preventDefault())}),uploader_init=function(){var b=navigator.userAgent.indexOf(\"Trident/\")!=-1||navigator.userAgent.indexOf(\"MSIE \")!=-1;b||\"flash\"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty(\"send_binary_string\")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),uploader=new plupload.Uploader(wpUploaderInit),a(\"#image_resize\").bind(\"change\",function(){var b=a(this).prop(\"checked\");setResize(b),b?setUserSetting(\"upload_resize\",\"1\"):deleteUserSetting(\"upload_resize\")}),uploader.bind(\"Init\",function(b){var c=a(\"#plupload-upload-ui\");setResize(getUserSetting(\"upload_resize\",!1)),b.features.dragdrop&&!a(document.body).hasClass(\"mobile\")?(c.addClass(\"drag-drop\"),a(\"#drag-drop-area\").on(\"dragover.wp-uploader\",function(){c.addClass(\"drag-over\")}).on(\"dragleave.wp-uploader, drop.wp-uploader\",function(){c.removeClass(\"drag-over\")})):(c.removeClass(\"drag-drop\"),a(\"#drag-drop-area\").off(\".wp-uploader\")),\"html4\"===b.runtime&&a(\".upload-flash-bypass\").hide()}),uploader.bind(\"postinit\",function(a){a.refresh()}),uploader.init(),uploader.bind(\"FilesAdded\",function(b,c){a(\"#media-upload-error\").empty(),uploadStart(),plupload.each(c,function(a){fileQueued(a)}),b.refresh(),b.start()}),uploader.bind(\"UploadFile\",function(a,b){fileUploading(a,b)}),uploader.bind(\"UploadProgress\",function(a,b){uploadProgress(a,b)}),uploader.bind(\"Error\",function(a,b){uploadError(b.file,b.code,b.message,a),a.refresh()}),uploader.bind(\"FileUploaded\",function(a,b,c){uploadSuccess(b,c.response)}),uploader.bind(\"UploadComplete\",function(){uploadComplete()})},\"object\"==typeof wpUploaderInit&&uploader_init()});", "<?php\n/**\n * The WordPress version string\n *\n * @global string $wp_version\n */\n$wp_version = '4.8-beta1-40736';\n\n/**\n * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.\n *\n * @global int $wp_db_version\n */\n$wp_db_version = 38590;\n\n/**\n * Holds the TinyMCE version\n *\n * @global string $tinymce_version\n */\n$tinymce_version = '4601-20170510';\n\n/**\n * Holds the required PHP version\n *\n * @global string $required_php_version\n */\n$required_php_version = '5.2.4';\n\n/**\n * Holds the required MySQL version\n *\n * @global string $required_mysql_version\n */\n$required_mysql_version = '5.0';\n"], "filenames": ["wp-includes/js/plupload/handlers.js", "wp-includes/js/plupload/handlers.min.js", "wp-includes/version.php"], "buggy_code_start_loc": [331, 1, 7], "buggy_code_end_loc": [340, 2, 8], "fixing_code_start_loc": [331, 1, 7], "fixing_code_end_loc": [349, 2, 8], "type": "CWE-79", "message": "In WordPress before 4.7.5, a cross-site scripting (XSS) vulnerability exists when attempting to upload very large files, because the error message does not properly restrict presentation of the filename.", "other": {"cve": {"id": "CVE-2017-9061", "sourceIdentifier": "cve@mitre.org", "published": "2017-05-18T14:29:00.200", "lastModified": "2019-03-15T13:12:51.320", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In WordPress before 4.7.5, a cross-site scripting (XSS) vulnerability exists when attempting to upload very large files, because the error message does not properly restrict presentation of the filename."}, {"lang": "es", "value": "En WordPress anteriores a 4.7.5, existe una vulnerabilidad XSS (cross-site scripting) al intentar cargar archivos muy grandes, porque el mensaje de error no restringe adecuadamente la presentaci\u00f3n del nombre de archivo."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wordpress:wordpress:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.7.4", "matchCriteriaId": "0F07CF70-A29C-490E-8728-C51AED224D76"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:8.0:*:*:*:*:*:*:*", "matchCriteriaId": "C11E6FB0-C8C0-4527-9AA0-CB9B316F8F43"}, {"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:9.0:*:*:*:*:*:*:*", "matchCriteriaId": "DEECE5FC-CACF-4496-A3E7-164736409252"}]}]}], "references": [{"url": "http://www.debian.org/security/2017/dsa-3870", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "http://www.securityfocus.com/bid/98509", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "http://www.securitytracker.com/id/1038520", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://codex.wordpress.org/Version_4.7.5", "source": "cve@mitre.org", "tags": ["Patch", "Release Notes", "Vendor Advisory"]}, {"url": "https://github.com/WordPress/WordPress/commit/8c7ea71edbbffca5d9766b7bea7c7f3722ffafa6", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://wordpress.org/news/2017/05/wordpress-4-7-5/", "source": "cve@mitre.org", "tags": ["Patch", "Vendor Advisory"]}, {"url": "https://wpvulndb.com/vulnerabilities/8819", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/WordPress/WordPress/commit/8c7ea71edbbffca5d9766b7bea7c7f3722ffafa6"}}