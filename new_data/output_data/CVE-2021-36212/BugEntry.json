{"buggy_code": ["<div class=\"roles view\">\n<h2><?= __('Sharing Group %s', $sg['SharingGroup']['name']);?></h2>\n<div class=\"row-fluid\"><div class=\"span8\" style=\"margin:0\">\n<?php\n$tableData = [\n    ['key' => __('ID'), 'value' => $sg['SharingGroup']['id']],\n    ['key' => __('UUID'), 'value' => $sg['SharingGroup']['uuid'], 'value_class' => 'quickSelect'],\n    ['key' => __('Name'), 'value' => $sg['SharingGroup']['name']],\n    ['key' => __('Releasability'), 'value' => $sg['SharingGroup']['releasability']],\n    ['key' => __('Description'), 'value' => $sg['SharingGroup']['description']],\n    ['key' => __('Selectable'), 'boolean' => $sg['SharingGroup']['active']],\n    [\n        'key' => __('Created by'),\n        'html' => isset($sg['Organisation']['id']) ? $this->OrgImg->getNameWithImg($sg) : __('Unknown'),\n    ],\n];\nif ($sg['SharingGroup']['sync_user_id']) {\n    $tableData[] = [\n        'key' => __('Synced by'),\n        'html' => isset($sg['SharingGroup']['sync_org']) ? $this->OrgImg->getNameWithImg($sg['SharingGroup']['sync_org']) : __('Unknown'),\n    ];\n}\n$eventsLink = $baseurl . '/events/index/searchsharinggroup:' . $sg['SharingGroup']['id'];\n$tableData[] = [\n    'key' => __('Events'),\n    'html' => '<a href=\"' . $eventsLink . '\">' . __n('%s event', '%s events', $sg['SharingGroup']['event_count'], $sg['SharingGroup']['event_count']) . '</a>',\n];\nif (isset($sg['SharingGroup']['org_count'])) {\n    $tableData[] = [\n        'key' => __('Organisations'),\n        'html' => __n('%s organisation', '%s organisations', $sg['SharingGroup']['org_count'], $sg['SharingGroup']['org_count']),\n    ];\n}\necho $this->element('genericElements/viewMetaTable', ['table_data' => $tableData]);\n?>\n</div></div>\n    <br />\n    <div class=\"row\" style=\"width:100%;\">\n    <?php\n        if (isset($sg['SharingGroupOrg'])):\n    ?>\n        <div class=\"span6\">\n            <b><?php echo __('Organisations');?></b>\n            <table class=\"table table-striped table-hover table-condensed\">\n                <tr>\n                    <th><?= __('Name') ?></th>\n                    <th><?= __('Is local') ?></th>\n                    <th><?= __('Can extend') ?></th>\n                </tr>\n                <?php\n                    foreach ($sg['SharingGroupOrg'] as $sgo):\n                ?>\n                <tr>\n                    <td><?= $this->OrgImg->getNameWithImg($sgo) ?></td>\n                    <td><span class=\"<?= $sgo['Organisation']['local'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                    <td><span class=\"<?= $sgo['extend'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                </tr>\n                <?php\n                    endforeach;\n                ?>\n            </table>\n        </div>\n    <?php\n        endif;\n        if (!$sg['SharingGroup']['roaming'] && isset($sg['SharingGroupServer'])):\n    ?>\n        <div class=\"span6\">\n            <b>Instances</b>\n            <table class=\"table table-striped table-hover table-condensed\">\n                <tr>\n                    <th><?= __('Name') ?></th>\n                    <th><?= __('URL') ?></th>\n                    <th><?= __('All orgs') ?></th>\n                </tr>\n                <?php\n                        foreach ($sg['SharingGroupServer'] as $sgs): ?>\n                <tr>\n                    <td><?= h($sgs['Server']['name']) ?></td>\n                    <td><?= h($sgs['Server']['url']) ?></td>\n                    <td><span class=\"<?= $sgs['all_orgs'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                </tr>\n                <?php\n                        endforeach;\n                ?>\n            </table>\n        </div>\n    <?php\n        endif;\n    ?>\n    </div>\n</div>\n<?= $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'globalActions', 'menuItem' => 'viewSG'));\n"], "fixing_code": ["<div class=\"roles view\">\n<h2><?= __('Sharing Group %s', h($sg['SharingGroup']['name']));?></h2>\n<div class=\"row-fluid\"><div class=\"span8\" style=\"margin:0\">\n<?php\n$tableData = [\n    ['key' => __('ID'), 'value' => $sg['SharingGroup']['id']],\n    ['key' => __('UUID'), 'value' => $sg['SharingGroup']['uuid'], 'value_class' => 'quickSelect'],\n    ['key' => __('Name'), 'value' => $sg['SharingGroup']['name']],\n    ['key' => __('Releasability'), 'value' => $sg['SharingGroup']['releasability']],\n    ['key' => __('Description'), 'value' => $sg['SharingGroup']['description']],\n    ['key' => __('Selectable'), 'boolean' => $sg['SharingGroup']['active']],\n    [\n        'key' => __('Created by'),\n        'html' => isset($sg['Organisation']['id']) ? $this->OrgImg->getNameWithImg($sg) : __('Unknown'),\n    ],\n];\nif ($sg['SharingGroup']['sync_user_id']) {\n    $tableData[] = [\n        'key' => __('Synced by'),\n        'html' => isset($sg['SharingGroup']['sync_org']) ? $this->OrgImg->getNameWithImg($sg['SharingGroup']['sync_org']) : __('Unknown'),\n    ];\n}\n$eventsLink = $baseurl . '/events/index/searchsharinggroup:' . $sg['SharingGroup']['id'];\n$tableData[] = [\n    'key' => __('Events'),\n    'html' => '<a href=\"' . $eventsLink . '\">' . __n('%s event', '%s events', $sg['SharingGroup']['event_count'], $sg['SharingGroup']['event_count']) . '</a>',\n];\nif (isset($sg['SharingGroup']['org_count'])) {\n    $tableData[] = [\n        'key' => __('Organisations'),\n        'html' => __n('%s organisation', '%s organisations', $sg['SharingGroup']['org_count'], $sg['SharingGroup']['org_count']),\n    ];\n}\necho $this->element('genericElements/viewMetaTable', ['table_data' => $tableData]);\n?>\n</div></div>\n    <br />\n    <div class=\"row\" style=\"width:100%;\">\n    <?php\n        if (isset($sg['SharingGroupOrg'])):\n    ?>\n        <div class=\"span6\">\n            <b><?php echo __('Organisations');?></b>\n            <table class=\"table table-striped table-hover table-condensed\">\n                <tr>\n                    <th><?= __('Name') ?></th>\n                    <th><?= __('Is local') ?></th>\n                    <th><?= __('Can extend') ?></th>\n                </tr>\n                <?php\n                    foreach ($sg['SharingGroupOrg'] as $sgo):\n                ?>\n                <tr>\n                    <td><?= $this->OrgImg->getNameWithImg($sgo) ?></td>\n                    <td><span class=\"<?= $sgo['Organisation']['local'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                    <td><span class=\"<?= $sgo['extend'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                </tr>\n                <?php\n                    endforeach;\n                ?>\n            </table>\n        </div>\n    <?php\n        endif;\n        if (!$sg['SharingGroup']['roaming'] && isset($sg['SharingGroupServer'])):\n    ?>\n        <div class=\"span6\">\n            <b>Instances</b>\n            <table class=\"table table-striped table-hover table-condensed\">\n                <tr>\n                    <th><?= __('Name') ?></th>\n                    <th><?= __('URL') ?></th>\n                    <th><?= __('All orgs') ?></th>\n                </tr>\n                <?php\n                        foreach ($sg['SharingGroupServer'] as $sgs): ?>\n                <tr>\n                    <td><?= h($sgs['Server']['name']) ?></td>\n                    <td><?= h($sgs['Server']['url']) ?></td>\n                    <td><span class=\"<?= $sgs['all_orgs'] ? 'fas fa-check' : 'fas fa-times' ?>\"></span></td>\n                </tr>\n                <?php\n                        endforeach;\n                ?>\n            </table>\n        </div>\n    <?php\n        endif;\n    ?>\n    </div>\n</div>\n<?= $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'globalActions', 'menuItem' => 'viewSG'));\n"], "filenames": ["app/View/SharingGroups/view.ctp"], "buggy_code_start_loc": [2], "buggy_code_end_loc": [3], "fixing_code_start_loc": [2], "fixing_code_end_loc": [3], "type": "CWE-79", "message": "app/View/SharingGroups/view.ctp in MISP before 2.4.146 allows stored XSS in the sharing groups view.", "other": {"cve": {"id": "CVE-2021-36212", "sourceIdentifier": "cve@mitre.org", "published": "2021-07-07T13:15:08.950", "lastModified": "2021-07-08T19:23:08.627", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "app/View/SharingGroups/view.ctp in MISP before 2.4.146 allows stored XSS in the sharing groups view."}, {"lang": "es", "value": "Un archivo app/View/SharingGroups/view.ctp en MISP versiones anteriores a 2.4.146, permite un ataque de tipo XSS almacenado en la vista de grupos compartidos"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.146", "matchCriteriaId": "CE8430D1-36A7-49AF-A7C2-135FAEA99180"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/01521d614cb578de75a406394b4f0426f6036ba7", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/MISP/MISP/compare/v2.4.145...v2.4.146", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/01521d614cb578de75a406394b4f0426f6036ba7"}}