{"buggy_code": ["<?php\nif (!defined('FLUX_ROOT')) exit;\n$this->loginRequired(); \n?>\n<?php if($ticketlist): ?>\n<h2><?php echo Flux::message('SDHeaderID') ?><?php echo htmlspecialchars($trow->ticket_id) ?> - <?php echo htmlspecialchars($trow->subject) ?></h2>\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th>Account</th>\n\t\t\t\t<td><?php echo $this->linkToAccount($trow->account_id,$session->account->userid . ' ('.$session->account->account_id.')') ?></td>\n\t\t\t<th>Characters Affected</th>\n\t\t\t\t<?php if($trow->char_id=='0'):?>\n\t\t\t\t<td><i>All Characters</i></td>\n\t\t\t\t<?php elseif($trow->char_id=='-1'):?>\n\t\t\t\t<td><i>None on account</i></td>\n\t\t\t\t<?php else:?>\n\t\t\t\t<td><?php echo $this->linkToCharacter($trow->char_id,$char->name) ?></td>\n\t\t\t\t<?php endif ?>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Category</th>\n\t\t\t<td><?php echo $catname ?></td>\n\t\t\t<th>Current Status</th>\n\t\t\t<td><?php echo htmlspecialchars($trow->status) ?></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Date/Time Submitted</th>\n\t\t\t\t<td><?php echo htmlspecialchars($trow->timestamp) ?></td>\n\t\t\t<th>Team</th>\n\t\t\t\t<td><?php if($trow->team=='1'): ?><?php echo Flux::message('SDGroup1') ?>\n\t\t\t\t<?php elseif($trow->team=='2'): ?><?php echo Flux::message('SDGroup2') ?>\n\t\t\t\t<?php elseif($trow->team=='3'): ?><?php echo Flux::message('SDGroup3') ?>\n\t\t\t\t<?php endif ?></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Subject</th>\n\t\t\t\t<td colspan=\"3\"><?php echo htmlspecialchars($trow->subject) ?></td>\n\t\t</tr>\n\t\t<?php if($trow->chatlink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Chat Logs</th>\n\t\t\t<td colspan=\"3\"><a href=\"<?php echo htmlspecialchars($trow->chatlink) ?>\" target=\"_blank\"><?php echo htmlspecialchars($trow->chatlink) ?></a></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<?php if($trow->sslink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Screenshots</th>\n\t\t\t<td colspan=\"3\"><a href=\"<?php echo $trow->sslink ?>\" target=\"_blank\"><img src=\"<?php echo $trow->sslink ?>\" width=\"100px\" height=\"100\"></a></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<?php if($trow->videolink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Video Capture</th>\n\t\t\t<td colspan=\"3\"><?php echo htmlspecialchars($trow->videolink) ?></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<tr>\n\t\t\t<th>Body<br />&nbsp;<br />&nbsp;<br />&nbsp;</th>\n\t\t\t<td colspan=\"3\"><?php echo nl2br($trow->text) ?></td></tr>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<br />\n\n\t<?php if($replylist): ?>\n\t<?php foreach($replylist as $rrow): ?>\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th width=\"100\">Reply By</th>\n\t\t\t<td>\n\t\t\t\t<?php if($rrow->isstaff==1): ?>\n\t\t\t\t\t<font color=\"<?php echo Flux::config('StaffReplyColour') ?>\"><?php echo $rrow->author ?></font>\n\t\t\t\t<?php elseif($rrow->isstaff==0): ?>\n\t\t\t\t\t<?php echo $rrow->author ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php if($rrow->text!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Response</th>\n\t\t\t<td><?php echo nl2br(stripslashes($rrow->text)) ?></td>\n\t\t</tr>\n\t\t\n\t\t<?php endif ?>\n\t\t<?php if($rrow->action!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Action</th>\n\t\t\t<td><?php echo $rrow->action ?></td>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<tr>\n\t\t\t<th>Timestamp</th>\n\t\t\t<td><?php echo $rrow->timestamp ?></td>\n\t\t</tr>\n\t\t</tbody>\n\t</table><br />\n\t<?php endforeach ?>\n\t<?php else: ?>\n\t\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th>There are no replies to this ticket.</th>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<?php endif ?>\n\t<br />\n\t<?php if($trow->status!='Resolved' || $trow->status!='Closed'): ?>\n\t<form action=\"<?php echo $this->urlWithQs ?>\" method=\"post\">\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th width=\"100\">Response</th>\n\t\t\t<td><textarea cols=\"30\" rows=\"10\" name=\"response\" placeholder=\"Click here to enter a response.\"></textarea></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Actions</th>\n\t\t\t<td><table class=\"generic-form-table\">\n\t\t\t<?php if($trow->status==\"Resolved\" || $trow->status==\"Closed\"): ?>\n\t\t\t\t<tr><td><?php echo Flux::message('SDRespTable6') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"6\" checked=\"checked\" /></td></tr>\n\t\t\t<?php else: ?>\n\t\t\t<tr><td><?php echo Flux::message('SDRespTable2') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"2\" checked=\"checked\" /></td></tr>\n\t\t\t<tr><td><?php echo Flux::message('SDRespTable3') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"3\" /></td></tr>\n\t\t\t<?php endif ?>\n\t\t\t</table></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td colspan=\"2\">\n\t\t\t<input type=\"hidden\" name=\"postreply\" value=\"gogolol\" />\n\t\t\t<input type=\"submit\" name=\"submit\" value=\"Add Reply\" /></td>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t</form>\n\t<?php endif ?>\n\t\n\t\n<?php else: ?>\n\t<p>\n\t\t<?php echo htmlspecialchars(Flux::message('SDHuh')) ?>\n\t</p>\n<?php endif ?>\n"], "fixing_code": ["<?php\nif (!defined('FLUX_ROOT')) exit;\n$this->loginRequired(); \n?>\n<?php if($ticketlist): ?>\n<h2><?php echo Flux::message('SDHeaderID') ?><?php echo htmlspecialchars($trow->ticket_id) ?> - <?php echo htmlspecialchars($trow->subject) ?></h2>\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th>Account</th>\n\t\t\t\t<td><?php echo $this->linkToAccount($trow->account_id,$session->account->userid . ' ('.$session->account->account_id.')') ?></td>\n\t\t\t<th>Characters Affected</th>\n\t\t\t\t<?php if($trow->char_id=='0'):?>\n\t\t\t\t<td><i>All Characters</i></td>\n\t\t\t\t<?php elseif($trow->char_id=='-1'):?>\n\t\t\t\t<td><i>None on account</i></td>\n\t\t\t\t<?php else:?>\n\t\t\t\t<td><?php echo $this->linkToCharacter($trow->char_id,$char->name) ?></td>\n\t\t\t\t<?php endif ?>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Category</th>\n\t\t\t<td><?php echo $catname ?></td>\n\t\t\t<th>Current Status</th>\n\t\t\t<td><?php echo htmlspecialchars($trow->status) ?></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Date/Time Submitted</th>\n\t\t\t\t<td><?php echo htmlspecialchars($trow->timestamp) ?></td>\n\t\t\t<th>Team</th>\n\t\t\t\t<td><?php if($trow->team=='1'): ?><?php echo Flux::message('SDGroup1') ?>\n\t\t\t\t<?php elseif($trow->team=='2'): ?><?php echo Flux::message('SDGroup2') ?>\n\t\t\t\t<?php elseif($trow->team=='3'): ?><?php echo Flux::message('SDGroup3') ?>\n\t\t\t\t<?php endif ?></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Subject</th>\n\t\t\t\t<td colspan=\"3\"><?php echo htmlspecialchars($trow->subject) ?></td>\n\t\t</tr>\n\t\t<?php if($trow->chatlink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Chat Logs</th>\n\t\t\t<td colspan=\"3\"><a href=\"<?php echo htmlspecialchars($trow->chatlink) ?>\" target=\"_blank\"><?php echo htmlspecialchars($trow->chatlink) ?></a></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<?php if($trow->sslink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Screenshots</th>\n\t\t\t<td colspan=\"3\"><a href=\"<?php echo htmlspecialchars($trow->sslink) ?>\" target=\"_blank\"><img src=\"<?php echo htmlspecialchars($trow->sslink) ?>\" width=\"100px\" height=\"100\"></a></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<?php if($trow->videolink!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Video Capture</th>\n\t\t\t<td colspan=\"3\"><?php echo htmlspecialchars($trow->videolink) ?></td></tr>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<tr>\n\t\t\t<th>Body<br />&nbsp;<br />&nbsp;<br />&nbsp;</th>\n\t\t\t<td colspan=\"3\"><?php echo nl2br($trow->text) ?></td></tr>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<br />\n\n\t<?php if($replylist): ?>\n\t<?php foreach($replylist as $rrow): ?>\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th width=\"100\">Reply By</th>\n\t\t\t<td>\n\t\t\t\t<?php if($rrow->isstaff==1): ?>\n\t\t\t\t\t<font color=\"<?php echo Flux::config('StaffReplyColour') ?>\"><?php echo $rrow->author ?></font>\n\t\t\t\t<?php elseif($rrow->isstaff==0): ?>\n\t\t\t\t\t<?php echo $rrow->author ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php if($rrow->text!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Response</th>\n\t\t\t<td><?php echo nl2br(stripslashes($rrow->text)) ?></td>\n\t\t</tr>\n\t\t\n\t\t<?php endif ?>\n\t\t<?php if($rrow->action!='0'): ?>\n\t\t<tr>\n\t\t\t<th>Action</th>\n\t\t\t<td><?php echo $rrow->action ?></td>\n\t\t</tr>\n\t\t<?php endif ?>\n\t\t<tr>\n\t\t\t<th>Timestamp</th>\n\t\t\t<td><?php echo $rrow->timestamp ?></td>\n\t\t</tr>\n\t\t</tbody>\n\t</table><br />\n\t<?php endforeach ?>\n\t<?php else: ?>\n\t\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th>There are no replies to this ticket.</th>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<?php endif ?>\n\t<br />\n\t<?php if($trow->status!='Resolved' || $trow->status!='Closed'): ?>\n\t<form action=\"<?php echo $this->urlWithQs ?>\" method=\"post\">\n\t<table class=\"vertical-table\" width=\"100%\"> \n\t\t<tbody>\n\t\t<tr>\n\t\t\t<th width=\"100\">Response</th>\n\t\t\t<td><textarea cols=\"30\" rows=\"10\" name=\"response\" placeholder=\"Click here to enter a response.\"></textarea></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Actions</th>\n\t\t\t<td><table class=\"generic-form-table\">\n\t\t\t<?php if($trow->status==\"Resolved\" || $trow->status==\"Closed\"): ?>\n\t\t\t\t<tr><td><?php echo Flux::message('SDRespTable6') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"6\" checked=\"checked\" /></td></tr>\n\t\t\t<?php else: ?>\n\t\t\t<tr><td><?php echo Flux::message('SDRespTable2') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"2\" checked=\"checked\" /></td></tr>\n\t\t\t<tr><td><?php echo Flux::message('SDRespTable3') ?>:</td><td><input type=\"radio\" name=\"secact\" value=\"3\" /></td></tr>\n\t\t\t<?php endif ?>\n\t\t\t</table></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td colspan=\"2\">\n\t\t\t<input type=\"hidden\" name=\"postreply\" value=\"gogolol\" />\n\t\t\t<input type=\"submit\" name=\"submit\" value=\"Add Reply\" /></td>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t</form>\n\t<?php endif ?>\n\t\n\t\n<?php else: ?>\n\t<p>\n\t\t<?php echo htmlspecialchars(Flux::message('SDHuh')) ?>\n\t</p>\n<?php endif ?>\n"], "filenames": ["themes/default/servicedesk/view.php"], "buggy_code_start_loc": [49], "buggy_code_end_loc": [50], "fixing_code_start_loc": [49], "fixing_code_end_loc": [50], "type": "CWE-79", "message": "A vulnerability was found in rAthena FluxCP. It has been classified as problematic. Affected is an unknown function of the file themes/default/servicedesk/view.php of the component Service Desk Image URL Handler. The manipulation of the argument sslink leads to cross site scripting. It is possible to launch the attack remotely. The name of the patch is 8a39b2b2bf28353b3503ff1421862393db15aa7e. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-215304.", "other": {"cve": {"id": "CVE-2022-4421", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-12T14:15:10.607", "lastModified": "2022-12-15T19:48:43.040", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in rAthena FluxCP. It has been classified as problematic. Affected is an unknown function of the file themes/default/servicedesk/view.php of the component Service Desk Image URL Handler. The manipulation of the argument sslink leads to cross site scripting. It is possible to launch the attack remotely. The name of the patch is 8a39b2b2bf28353b3503ff1421862393db15aa7e. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-215304."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rathena:fluxcp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2022-02-11", "matchCriteriaId": "88838D01-92F1-4F55-BC89-ED07017CC7DF"}]}]}], "references": [{"url": "https://github.com/rathena/FluxCP/commit/8a39b2b2bf28353b3503ff1421862393db15aa7e", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215304", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/rathena/FluxCP/commit/8a39b2b2bf28353b3503ff1421862393db15aa7e"}}