{"buggy_code": ["name: comment\n\non:\n  issue_comment:\n    types: [created]\n\nenv:\n  IMAGE: collection-instrument\n  SPINNAKER_TOPIC: ${{ secrets.SPINNAKER_TOPIC }}\n  ARTIFACT_BUCKET: ${{ secrets.ARTIFACT_BUCKET }}\n  HOST: ${{ secrets.GOOGLE_PROJECT_ID }}\n\njobs:\n  comment:\n    runs-on: ubuntu-latest\n    if: contains(github.event.comment.body, '/deploy')\n    steps:\n      - name: set namespace\n        run: |\n          echo NAMESPACE=$(echo ${{ github.event.comment.body }} | cut -d' ' -f2) >> $GITHUB_ENV\n\n      - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n        with:\n          version: '270.0.0'\n          service_account_key: ${{ secrets.GCR_KEY }}\n      - run: |\n          gcloud auth configure-docker\n\n      - uses: actions/checkout@v1\n      - name: Add commit comment\n        run: |\n          jq -nc \"{\\\"body\\\": \\\"@${{ github.event.comment.user.login }}, Spinnaker is deploying the PR to your environment\\\"}\" | \\\n          curl -sL  -X POST -d @- \\\n            -H \"Content-Type: application/json\" \\\n            -H \"Authorization: token ${{ secrets.BOT_TOKEN }}\" \\\n            \"https://api.github.com/repos/$GITHUB_REPOSITORY/issues/${{ github.event.issue.number }}/comments\"\n\n      - name: Trigger spinnaker\n        run: |\n          gcloud pubsub topics publish $SPINNAKER_TOPIC --project $HOST \\\n          --message \"{ \\\"kind\\\": \\\"storage#object\\\", \\\"name\\\": \\\"$IMAGE/$IMAGE-latest.tgz\\\", \\\"bucket\\\": \\\"$ARTIFACT_BUCKET\\\", \\\"parameters\\\": { \\\"tag\\\": \\\"pr-${{ github.event.issue.number }}\\\", \\\"namespace\\\": \\\"${{ env.NAMESPACE }}\\\", \\\"cluster\\\": \\\"dev\\\", \\\"actor\\\": \\\"$GITHUB_ACTOR\\\" } }\" \\\n          --attribute ci=\"actions\"\n", "apiVersion: v2\nname: collection-instrument\ndescription: A Helm chart for Kubernetes\n\n# A chart can be either an 'application' or a 'library' chart.\n#\n# Application charts are a collection of templates that can be packaged into versioned archives\n# to be deployed.\n#\n# Library charts provide useful utilities or functions for the chart developer. They're included as\n# a dependency of application charts to inject those utilities and functions into the rendering\n# pipeline. Library charts do not define any templates and therefore cannot be deployed.\ntype: application\n\n# This is the chart version. This version number should be incremented each time you make changes\n# to the chart and its templates, including the app version.\nversion: 1.1.2\n\n# This is the version number of the application being deployed. This version number should be\n# incremented each time you make changes to the application.\nappVersion: 2.0.27\n"], "fixing_code": ["name: comment\n\non:\n  issue_comment:\n    types: [created]\n\nenv:\n  IMAGE: collection-instrument\n  SPINNAKER_TOPIC: ${{ secrets.SPINNAKER_TOPIC }}\n  ARTIFACT_BUCKET: ${{ secrets.ARTIFACT_BUCKET }}\n  HOST: ${{ secrets.GOOGLE_PROJECT_ID }}\n\njobs:\n  comment:\n    runs-on: ubuntu-latest\n    if: contains(github.event.comment.body, '/deploy')\n    steps:\n      - name: set namespace\n        env:\n          COMMENT_BODY: ${{ github.event.comment.body }}\n        run: |\n          echo NAMESPACE=$(echo $COMMENT_BODY | cut -d' ' -f2) >> $GITHUB_ENV\n\n      - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n        with:\n          version: '270.0.0'\n          service_account_key: ${{ secrets.GCR_KEY }}\n      - run: |\n          gcloud auth configure-docker\n\n      - uses: actions/checkout@v1\n      - name: Add commit comment\n        run: |\n          jq -nc \"{\\\"body\\\": \\\"@${{ github.event.comment.user.login }}, Spinnaker is deploying the PR to your environment\\\"}\" | \\\n          curl -sL  -X POST -d @- \\\n            -H \"Content-Type: application/json\" \\\n            -H \"Authorization: token ${{ secrets.BOT_TOKEN }}\" \\\n            \"https://api.github.com/repos/$GITHUB_REPOSITORY/issues/${{ github.event.issue.number }}/comments\"\n\n      - name: Trigger spinnaker\n        run: |\n          gcloud pubsub topics publish $SPINNAKER_TOPIC --project $HOST \\\n          --message \"{ \\\"kind\\\": \\\"storage#object\\\", \\\"name\\\": \\\"$IMAGE/$IMAGE-latest.tgz\\\", \\\"bucket\\\": \\\"$ARTIFACT_BUCKET\\\", \\\"parameters\\\": { \\\"tag\\\": \\\"pr-${{ github.event.issue.number }}\\\", \\\"namespace\\\": \\\"${{ env.NAMESPACE }}\\\", \\\"cluster\\\": \\\"dev\\\", \\\"actor\\\": \\\"$GITHUB_ACTOR\\\" } }\" \\\n          --attribute ci=\"actions\"\n", "apiVersion: v2\nname: collection-instrument\ndescription: A Helm chart for Kubernetes\n\n# A chart can be either an 'application' or a 'library' chart.\n#\n# Application charts are a collection of templates that can be packaged into versioned archives\n# to be deployed.\n#\n# Library charts provide useful utilities or functions for the chart developer. They're included as\n# a dependency of application charts to inject those utilities and functions into the rendering\n# pipeline. Library charts do not define any templates and therefore cannot be deployed.\ntype: application\n\n# This is the chart version. This version number should be incremented each time you make changes\n# to the chart and its templates, including the app version.\nversion: 1.1.2\n\n# This is the version number of the application being deployed. This version number should be\n# incremented each time you make changes to the application.\nappVersion: 2.0.28\n"], "filenames": [".github/workflows/comment.yml", "_infra/helm/collection-instrument/Chart.yaml"], "buggy_code_start_loc": [18, 21], "buggy_code_end_loc": [21, 22], "fixing_code_start_loc": [19, 21], "fixing_code_end_loc": [23, 22], "type": "CWE-78", "message": "A vulnerability was found in ONS Digital RAS Collection Instrument up to 2.0.27 and classified as critical. Affected by this issue is the function jobs of the file .github/workflows/comment.yml. The manipulation of the argument $COMMENT_BODY leads to os command injection. Upgrading to version 2.0.28 is able to address this issue. The name of the patch is dcaad2540f7d50c512ff2e031d3778dd9337db2b. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-234248.", "other": {"cve": {"id": "CVE-2020-36762", "sourceIdentifier": "cna@vuldb.com", "published": "2023-07-18T15:15:11.133", "lastModified": "2024-02-29T01:28:46.110", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability was found in ONS Digital RAS Collection Instrument up to 2.0.27 and classified as critical. Affected by this issue is the function jobs of the file .github/workflows/comment.yml. The manipulation of the argument $COMMENT_BODY leads to os command injection. Upgrading to version 2.0.28 is able to address this issue. The name of the patch is dcaad2540f7d50c512ff2e031d3778dd9337db2b. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-234248."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:ons:ras_collection_instrument:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.0.28", "matchCriteriaId": "6C0367BF-0E98-42C7-9FF1-50E3076030AE"}]}]}], "references": [{"url": "https://github.com/ONSdigital/ras-collection-instrument/commit/dcaad2540f7d50c512ff2e031d3778dd9337db2b", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/ONSdigital/ras-collection-instrument/pull/199", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/ONSdigital/ras-collection-instrument/releases/tag/2.0.28", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.234248", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.234248", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/ONSdigital/ras-collection-instrument/commit/dcaad2540f7d50c512ff2e031d3778dd9337db2b"}}