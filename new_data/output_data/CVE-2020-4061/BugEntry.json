{"buggy_code": ["/*\n * MediaFinder plugin\n *\n * Data attributes:\n * - data-control=\"mediafinder\" - enables the plugin on an element\n * - data-option=\"value\" - an option with a value\n *\n * JavaScript API:\n * $('a#someElement').recordFinder({ option: 'value' })\n *\n * Dependences:\n * - Some other plugin (filename.js)\n */\n\n+function ($) { \"use strict\";\n    var Base = $.oc.foundation.base,\n        BaseProto = Base.prototype\n\n    var MediaFinder = function (element, options) {\n        this.$el = $(element)\n        this.options = options || {}\n\n        $.oc.foundation.controlUtils.markDisposable(element)\n        Base.call(this)\n        this.init()\n    }\n\n    MediaFinder.prototype = Object.create(BaseProto)\n    MediaFinder.prototype.constructor = MediaFinder\n\n    MediaFinder.prototype.init = function() {\n        if (this.options.isMulti === null) {\n            this.options.isMulti = this.$el.hasClass('is-multi')\n        }\n\n        if (this.options.isPreview === null) {\n            this.options.isPreview = this.$el.hasClass('is-preview')\n        }\n\n        if (this.options.isImage === null) {\n            this.options.isImage = this.$el.hasClass('is-image')\n        }\n\n        this.$el.one('dispose-control', this.proxy(this.dispose))\n\n        if (this.options.thumbnailWidth > 0) {\n            this.$el.css('maxWidth', this.options.thumbnailWidth + 'px')\n        }\n\n        else if (this.options.thumbnailHeight > 0) {\n            this.$el.css('maxHeight', this.options.thumbnailHeight + 'px')\n        }\n\n        // Stop here for preview mode\n        if (this.options.isPreview) {\n            return\n        }\n\n        this.$el.on('click', '.find-button', this.proxy(this.onClickFindButton))\n        this.$el.on('click', '.find-remove-button', this.proxy(this.onClickRemoveButton))\n\n        this.$findValue = $('[data-find-value]', this.$el)\n    }\n\n    MediaFinder.prototype.dispose = function() {\n        this.$el.off('click', '.find-button', this.proxy(this.onClickFindButton))\n        this.$el.off('click', '.find-remove-button', this.proxy(this.onClickRemoveButton))\n        this.$el.off('dispose-control', this.proxy(this.dispose))\n        this.$el.removeData('oc.mediaFinder')\n\n        this.$findValue = null\n        this.$el = null\n\n        // In some cases options could contain callbacks, \n        // so it's better to clean them up too.\n        this.options = null\n\n        BaseProto.dispose.call(this)\n    }\n\n    MediaFinder.prototype.setValue = function(value) {\n        // set value and trigger change event, so that wrapping implementations\n        // like mlmediafinder can listen for changes.\n        this.$findValue.val(value).trigger('change')\n    }\n\n    MediaFinder.prototype.onClickRemoveButton = function() {\n        this.setValue('')\n\n        this.evalIsPopulated()\n    }\n\n    MediaFinder.prototype.onClickFindButton = function() {\n        var self = this\n\n        new $.oc.mediaManager.popup({\n            alias: 'ocmediamanager',\n            cropAndInsertButton: true,\n            onInsert: function(items) {\n                if (!items.length) {\n                    alert('Please select image(s) to insert.')\n                    return\n                }\n\n                if (items.length > 1) {\n                    alert('Please select a single item.')\n                    return\n                }\n\n                var path, publicUrl\n                for (var i=0, len=items.length; i<len; i++) {\n                    path = items[i].path\n                    publicUrl = items[i].publicUrl\n                }\n\n                self.setValue(path)\n\n                if (self.options.isImage) {\n                    $('[data-find-image]', self.$el).attr('src', publicUrl)\n                    $('[data-find-error]', self.$el).hide()\n                }\n\n                self.evalIsPopulated()\n\n                this.hide()\n            }\n        })\n    }\n\n    MediaFinder.prototype.evalIsPopulated = function() {\n        var isPopulated = !!this.$findValue.val()\n        this.$el.toggleClass('is-populated', isPopulated)\n        $('[data-find-file-name]', this.$el).text(this.$findValue.val().substring(1))\n    }\n\n    MediaFinder.DEFAULTS = {\n        isMulti: null,\n        isPreview: null,\n        isImage: null\n    }\n\n    // PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.mediaFinder\n\n    $.fn.mediaFinder = function(option) {\n        var args = arguments;\n\n        return this.each(function() {\n            var $this   = $(this)\n            var data    = $this.data('oc.mediaFinder')\n            var options = $.extend({}, MediaFinder.DEFAULTS, $this.data(), typeof option == 'object' && option)\n            if (!data) $this.data('oc.mediaFinder', (data = new MediaFinder(this, options)))\n            if (typeof option == 'string') data[option].apply(data, args)\n        })\n      }\n\n    $.fn.mediaFinder.Constructor = MediaFinder\n\n    $.fn.mediaFinder.noConflict = function() {\n        $.fn.mediaFinder = old\n        return this\n    }\n\n    $(document).render(function() {\n        $('[data-control=\"mediafinder\"]').mediaFinder()\n    })\n\n}(window.jQuery);\n", "\n(function($){$.FroalaEditor.PLUGINS.mediaManager=function(editor){function onInsertFile(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar link,text=editor.selection.text(),textIsEmpty=$.trim(text)===''\nfor(var i=0,len=items.length;i<len;i++){var text=textIsEmpty?items[i].title:text\nlink=items[i].publicUrl}\neditor.events.focus(true);editor.selection.restore();editor.html.insert('<a href=\"'+link+'\" id=\"fr-inserted-file\" class=\"fr-file\">'+text+'</a>');var $file=editor.$el.find('#fr-inserted-file');$file.removeAttr('id');editor.undo.saveStep()\nthis.hide()}})}\nfunction onInsertImage(){var $currentImage=editor.image.get(),selection=editor.selection.get(),range=editor.selection.ranges(0);new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:true,onInsert:function(items){editor.selection.clear();selection.addRange(range);if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_image_empty_insert'))\nreturn}\nvar imagesInserted=0\nfor(var i=0,len=items.length;i<len;i++){if(items[i].documentType!=='image'){$.oc.alert($.oc.lang.get('mediamanager.invalid_image_invalid_insert','The file \"'+items[i].title+'\" is not an image.'))\ncontinue}\neditor.image.insert(items[i].publicUrl,false,{},$currentImage)\nimagesInserted++\nif(imagesInserted==1){$currentImage=null}}\nif(imagesInserted!==0){this.hide()\neditor.undo.saveStep()}}})}\nfunction onInsertVideo(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_video_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar item=items[0]\nif(item.documentType!=='video'){$.oc.alert($.oc.lang.get('mediamanager.invalid_video_invalid_insert','The file \"'+item.title+'\" is not a video.'))\nreturn}\nvar $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\n$richEditorNode.richEditor('insertVideo',item.publicUrl,item.title)\nthis.hide()}})}\nfunction onInsertAudio(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_audio_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar item=items[0]\nif(item.documentType!=='audio'){$.oc.alert($.oc.lang.get('mediamanager.invalid_audio_invalid_insert','The file \"'+item.title+'\" is not an audio file.'))\nreturn}\nvar $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\n$richEditorNode.richEditor('insertAudio',item.publicUrl,item.title)\nthis.hide()}})}\nfunction _insertVideoFallback(link){var $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\nvar title=link.substring(link.lastIndexOf('/')+1)\n$richEditorNode.richEditor('insertVideo',link,title)\neditor.popups.hide('video.insert')}\nfunction _insertAudioFallback(link){var $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\nvar title=link.substring(link.lastIndexOf('/')+1)\n$richEditorNode.richEditor('insertAudio',link,title)\neditor.popups.hide('audio.insert')}\nfunction _init(){editor.events.on('destroy',_destroy,true)\neditor.events.on('video.linkError',_insertVideoFallback)\neditor.events.on('audio.linkError',_insertAudioFallback)}\nfunction _destroy(){}\nreturn{_init:_init,insertFile:onInsertFile,insertImage:onInsertImage,insertVideo:onInsertVideo,insertAudio:onInsertAudio}}\nif(!$.FE.PLUGINS.link||!$.FE.PLUGINS.file||!$.FE.PLUGINS.image||!$.FE.PLUGINS.video){throw new Error('Media manager plugin requires link, file, image and video plugin.');}\n$.FE.DEFAULTS.imageInsertButtons.push('mmImageManager');$.FE.RegisterCommand('mmImageManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertImage();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmImageManager',{NAME:'folder'});$.FE.DEFAULTS.fileInsertButtons.push('mmFileManager');$.FE.RegisterCommand('mmFileManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertFile();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmFileManager',{NAME:'folder'});$.FE.DEFAULTS.videoInsertButtons.push('mmVideoManager');$.FE.RegisterCommand('mmVideoManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertVideo();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmVideoManager',{NAME:'folder'});$.FE.DEFAULTS.audioInsertButtons.push('mmAudioManager');$.FE.RegisterCommand('mmAudioManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertAudio();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmAudioManager',{NAME:'folder'});})(jQuery);var richeditorPageLinksPlugin\nfunction richeditorPageLinksSelectPage($form){richeditorPageLinksPlugin.setLinkValueFromPopup($form)}\n$.FroalaEditor.DEFAULTS=$.extend($.FroalaEditor.DEFAULTS,{pageLinksHandler:'onLoadPageLinksForm'});$.FroalaEditor.DEFAULTS.key='JA6B2B5A1qB1F1F4D3I1A15A11D3E6B5dVh1VCQWa1EOQFe1NCb1==';(function($){$.FroalaEditor.PLUGINS.pageLinks=function(editor){function setLinkValueFromPopup($form){var $select=$('select[name=pagelink]',$form)\nvar link={text:$('option:selected',$select).text().trim(),href:$select.val()}\nsetTimeout(function(){editor.popups.show('link.insert')\nsetLinkValue(link)},300)}\nfunction setLinkValue(link){var $popup=editor.popups.get('link.insert');var text_inputs=$popup.find('input.fr-link-attr[type=\"text\"]');var check_inputs=$popup.find('input.fr-link-attr[type=\"checkbox\"]');var $input;var i;for(i=0;i<text_inputs.length;i++){$input=$(text_inputs[i]);if(link[$input.attr('name')]){$input.val(link[$input.attr('name')]);}\nelse if($input.attr('name')!='text'){$input.val('');}}\nfor(i=0;i<check_inputs.length;i++){$input=$(check_inputs[i]);$input.prop('checked',$input.data('checked')==link[$input.attr('name')]);}}\nfunction insertLink(){richeditorPageLinksPlugin=this\neditor.$el.popup({handler:editor.opts.pageLinksHandler})}\nfunction _init(){}\nreturn{_init:_init,setLinkValueFromPopup:setLinkValueFromPopup,setLinkValue:setLinkValue,insertLink:insertLink}}\n$.FE.DEFAULTS.linkInsertButtons=['linkBack','|','linkPageLinks']\n$.FE.RegisterCommand('linkPageLinks',{title:'Choose Link',undo:false,focus:false,callback:function(){this.pageLinks.insertLink()},plugin:'pageLinks'})\n$.FE.DefineIcon('linkPageLinks',{NAME:'search'});})(jQuery);(function($){$.FroalaEditor.PLUGINS.figures=function(editor){function insertElement($el){var html=$('<div />').append($el.clone()).remove().html()\neditor.events.focus(true)\neditor.selection.restore()\neditor.html.insert(html)\neditor.html.cleanEmptyTags()\n$('figure',editor.$el).each(function(){var $this=$(this),$parent=$this.parent('p'),$next=$this.next('p')\nif(!!$parent.length){$this.insertAfter($parent)}\nif(!!$next.length&&$.trim($next.text()).length==0){$next.remove()}})\neditor.undo.saveStep()}\nfunction _makeUiBlockElement(){var $node=$('<figure contenteditable=\"false\" tabindex=\"0\" data-ui-block=\"true\">&nbsp;</figure>')\n$node.get(0).contentEditable=false\nreturn $node}\nfunction insertVideo(url,text){var $node=_makeUiBlockElement()\n$node.attr('data-video',url)\n$node.attr('data-label',text)\ninsertElement($node)}\nfunction insertAudio(url,text){var $node=_makeUiBlockElement()\n$node.attr('data-audio',url)\n$node.attr('data-label',text)\ninsertElement($node)}\nfunction _initUiBlocks(){$('[data-video], [data-audio]',editor.$el).each(function(){$(this).addClass('fr-draggable').attr({'data-ui-block':'true','draggable':'true','tabindex':'0'}).html('&nbsp;')\nthis.contentEditable=false})}\nfunction _handleUiBlocksKeydown(ev){if(ev.key==='ArrowDown'||ev.key==='ArrowUp'||ev.key==='Backspace'||ev.key==='Delete'){var $block=$(editor.selection.element())\nif($block.is('br')){$block=$block.parent()}\nif(!!$block.length){switch(ev.key){case'ArrowUp':_handleUiBlockCaretIn($block.prev())\nbreak\ncase'ArrowDown':_handleUiBlockCaretIn($block.next())\nbreak\ncase'Delete':_handleUiBlockCaretClearEmpty($block.next(),$block)\nbreak\ncase'Backspace':_handleUiBlockCaretClearEmpty($block.prev(),$block)\nbreak}}}}\nfunction _handleUiBlockCaretClearEmpty($block,$p){if($block.attr('data-ui-block')!==undefined&&$.trim($p.text()).length==0){$p.remove()\n_handleUiBlockCaretIn($block)\neditor.undo.saveStep()}}\nfunction _handleUiBlockCaretIn($block){if($block.attr('data-ui-block')!==undefined){$block.focus()\neditor.selection.clear()\nreturn true}\nreturn false}\nfunction _uiBlockKeyDown(ev,block){if(ev.key==='ArrowDown'||ev.key==='ArrowUp'||ev.key==='Enter'||ev.key==='Backspace'||ev.key==='Delete'){switch(ev.key){case'ArrowDown':_focusUiBlockOrText($(block).next(),true)\nbreak\ncase'ArrowUp':_focusUiBlockOrText($(block).prev(),false)\nbreak\ncase'Enter':var $paragraph=$('<p><br/></p>')\n$paragraph.insertAfter(block)\neditor.selection.setAfter(block)\neditor.selection.restore()\neditor.undo.saveStep()\nbreak\ncase'Backspace':case'Delete':var $nextFocus=$(block).next(),gotoStart=true\nif($nextFocus.length==0){$nextFocus=$(block).prev()\ngotoStart=false}\n_focusUiBlockOrText($nextFocus,gotoStart)\n$(block).remove()\neditor.undo.saveStep()\nbreak}\nev.preventDefault()}}\nfunction _focusUiBlockOrText($block,gotoStart){if(!!$block.length){if(!_handleUiBlockCaretIn($block)){if(gotoStart){editor.selection.setAtStart($block.get(0))\neditor.selection.restore()}\nelse{editor.selection.setAtEnd($block.get(0))\neditor.selection.restore()}}}}\nfunction _onKeydown(ev){_handleUiBlocksKeydown(ev)\nif(ev.isDefaultPrevented()){return false}}\nfunction _onFigureKeydown(ev){if(ev.target&&$(ev.target).attr('data-ui-block')!==undefined){_uiBlockKeyDown(ev,ev.target)}\nif(ev.isDefaultPrevented()){return false}}\nfunction _onSync(html){var $domTree=$('<div>'+html+'</div>')\n$domTree.find('[data-video], [data-audio]').each(function(){$(this).removeAttr('contenteditable data-ui-block tabindex draggable').removeClass('fr-draggable fr-dragging')})\nreturn $domTree.html()}\nfunction _init(){editor.events.on('initialized',_initUiBlocks)\neditor.events.on('html.set',_initUiBlocks)\neditor.events.on('html.get',_onSync)\neditor.events.on('keydown',_onKeydown)\neditor.events.on('destroy',_destroy,true)\neditor.$el.on('keydown','figure',_onFigureKeydown)}\nfunction _destroy(){editor.$el.off('keydown','figure',_onFigureKeydown)}\nreturn{_init:_init,insert:insertElement,insertVideo:insertVideo,insertAudio:insertAudio}}})(jQuery);+function($){\"use strict\";var Base=$.oc.foundation.base,BaseProto=Base.prototype\nvar RichEditor=function(element,options){this.options=options\nthis.$el=$(element)\nthis.$textarea=this.$el.find('>textarea:first')\nthis.$form=this.$el.closest('form')\nthis.editor=null\n$.oc.foundation.controlUtils.markDisposable(element)\nBase.call(this)\nthis.init()}\nRichEditor.prototype=Object.create(BaseProto)\nRichEditor.prototype.constructor=RichEditor\nRichEditor.DEFAULTS={linksHandler:null,uploadHandler:null,stylesheet:null,fullpage:false,editorLang:'en',useMediaManager:false,toolbarButtons:null,allowEmptyTags:null,allowTags:null,noWrapTags:null,removeTags:null,lineBreakerTags:null,imageStyles:null,linkStyles:null,paragraphStyles:null,tableStyles:null,tableCellStyles:null,aceVendorPath:'/',readOnly:false}\nRichEditor.prototype.init=function(){var self=this;this.$el.one('dispose-control',this.proxy(this.dispose))\nif(!this.$textarea.attr('id')){this.$textarea.attr('id','element-'+Math.random().toString(36).substring(7))}\nthis.initFroala()}\nRichEditor.prototype.initFroala=function(){var froalaOptions={editorClass:'control-richeditor',language:this.options.editorLang,fullPage:this.options.fullpage,pageLinksHandler:this.options.linksHandler,uploadHandler:this.options.uploadHandler,aceEditorVendorPath:this.options.aceVendorPath,toolbarSticky:false}\nif(this.options.toolbarButtons){froalaOptions.toolbarButtons=this.options.toolbarButtons.split(',')}\nelse{froalaOptions.toolbarButtons=$.oc.richEditorButtons}\nfroalaOptions.imageStyles=this.options.imageStyles?this.options.imageStyles:{'oc-img-rounded':'Rounded','oc-img-bordered':'Bordered'}\nfroalaOptions.linkStyles=this.options.linkStyles?this.options.linkStyles:{'oc-link-green':'Green','oc-link-strong':'Thick'}\nfroalaOptions.paragraphStyles=this.options.paragraphStyles?this.options.paragraphStyles:{'oc-text-gray':'Gray','oc-text-bordered':'Bordered','oc-text-spaced':'Spaced','oc-text-uppercase':'Uppercase'}\nfroalaOptions.tableStyles=this.options.tableStyles?this.options.tableStyles:{'oc-dashed-borders':'Dashed Borders','oc-alternate-rows':'Alternate Rows'}\nfroalaOptions.tableCellStyles=this.options.tableCellStyles?this.options.tableCellStyles:{'oc-cell-highlighted':'Highlighted','oc-cell-thick-border':'Thick'}\nfroalaOptions.toolbarButtonsMD=froalaOptions.toolbarButtons\nfroalaOptions.toolbarButtonsSM=froalaOptions.toolbarButtons\nfroalaOptions.toolbarButtonsXS=froalaOptions.toolbarButtons\nif(this.options.allowEmptyTags){froalaOptions.htmlAllowedEmptyTags=[];this.options.allowEmptyTags.split(/[\\s,]+/).forEach(function(selector){var tag=selector.split('.',2)\nif(froalaOptions.htmlAllowedEmptyTags.indexOf(tag[0])===-1){froalaOptions.htmlAllowedEmptyTags.push(selector)}})}else{froalaOptions.htmlAllowedEmptyTags=['textarea','a','iframe','object','video','style','script','.fa','.fr-emoticon','.fr-inner','path','line','hr','i']}\nfroalaOptions.htmlAllowedTags=this.options.allowTags?this.options.allowTags.split(/[\\s,]+/):['a','abbr','address','area','article','aside','audio','b','bdi','bdo','blockquote','br','button','canvas','caption','cite','code','col','colgroup','datalist','dd','del','details','dfn','dialog','div','dl','dt','em','embed','fieldset','figcaption','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meter','nav','noscript','object','ol','optgroup','option','output','p','param','pre','progress','queue','rp','rt','ruby','s','samp','script','style','section','select','small','source','span','strike','strong','sub','summary','sup','table','tbody','td','textarea','tfoot','th','thead','time','title','tr','track','u','ul','var','video','wbr']\nfroalaOptions.htmlDoNotWrapTags=this.options.noWrapTags?this.options.noWrapTags.split(/[\\s,]+/):['figure','script','style']\nfroalaOptions.htmlRemoveTags=this.options.removeTags?this.options.removeTags.split(/[\\s,]+/):['script','style','base']\nfroalaOptions.lineBreakerTags=this.options.lineBreakerTags?this.options.lineBreakerTags.split(/[\\s,]+/):['figure, table, hr, iframe, form, dl']\nfroalaOptions.shortcutsEnabled=['show','bold','italic','underline','indent','outdent','undo','redo']\nfroalaOptions.requestHeaders={'X-CSRF-TOKEN':$('meta[name=\"csrf-token\"]').attr('content'),'X-Requested-With':'XMLHttpRequest'}\nvar $form=this.$el.closest('form')\nvar formData={};if($form.length>0){$.each($form.serializeArray(),function(index,field){formData[field.name]=field.value;})}\nfroalaOptions.imageUploadURL=froalaOptions.fileUploadURL=window.location\nfroalaOptions.imageUploadParam=froalaOptions.fileUploadParam='file_data'\nfroalaOptions.imageUploadParams=froalaOptions.fileUploadParams=$.extend(formData,{_handler:froalaOptions.uploadHandler,})\nvar placeholder=this.$textarea.attr('placeholder')\nfroalaOptions.placeholderText=placeholder?placeholder:''\nfroalaOptions.height=this.$el.hasClass('stretch')?Infinity:$('.height-indicator',this.$el).height()\nif(!this.options.useMediaManager){delete $.FroalaEditor.PLUGINS.mediaManager}\n$.FroalaEditor.ICON_TEMPLATES={font_awesome:'<i class=\"icon-[NAME]\"></i>',text:'<span style=\"text-align: center;\">[NAME]</span>',image:'<img src=[SRC] alt=[ALT] />'}\nthis.$textarea.on('froalaEditor.initialized',this.proxy(this.build))\nthis.$textarea.on('froalaEditor.contentChanged',this.proxy(this.onChange))\nthis.$textarea.on('froalaEditor.html.get',this.proxy(this.onSyncContent))\nthis.$textarea.on('froalaEditor.html.set',this.proxy(this.onSetContent))\nthis.$form.on('oc.beforeRequest',this.proxy(this.onFormBeforeRequest))\nthis.$textarea.froalaEditor(froalaOptions)\nthis.editor=this.$textarea.data('froala.editor')\nif(this.options.readOnly){this.editor.edit.off()}\nthis.$el.on('keydown','.fr-view figure',this.proxy(this.onFigureKeydown))}\nRichEditor.prototype.dispose=function(){this.unregisterHandlers()\nthis.$textarea.froalaEditor('destroy')\nthis.$el.removeData('oc.richEditor')\nthis.options=null\nthis.$el=null\nthis.$textarea=null\nthis.$form=null\nthis.editor=null\nBaseProto.dispose.call(this)}\nRichEditor.prototype.unregisterHandlers=function(){this.$el.off('keydown','.fr-view figure',this.proxy(this.onFigureKeydown))\nthis.$textarea.off('froalaEditor.initialized',this.proxy(this.build))\nthis.$textarea.off('froalaEditor.contentChanged',this.proxy(this.onChange))\nthis.$textarea.off('froalaEditor.html.get',this.proxy(this.onSyncContent))\nthis.$textarea.off('froalaEditor.html.set',this.proxy(this.onSetContent))\nthis.$form.off('oc.beforeRequest',this.proxy(this.onFormBeforeRequest))\n$(window).off('resize',this.proxy(this.updateLayout))\n$(window).off('oc.updateUi',this.proxy(this.updateLayout))\nthis.$el.off('dispose-control',this.proxy(this.dispose))}\nRichEditor.prototype.build=function(event,editor){this.updateLayout()\n$(window).on('resize',this.proxy(this.updateLayout))\n$(window).on('oc.updateUi',this.proxy(this.updateLayout))\neditor.events.on('keydown',this.proxy(this.onKeydown),true)\nthis.$textarea.trigger('init.oc.richeditor',[this])}\nRichEditor.prototype.isCodeViewActive=function(){return this.editor&&this.editor.codeView&&this.editor.codeView.isActive()}\nRichEditor.prototype.getElement=function(){return this.$el}\nRichEditor.prototype.getEditor=function(){return this.editor}\nRichEditor.prototype.getTextarea=function(){return this.$textarea}\nRichEditor.prototype.getContent=function(){return this.editor.html.get()}\nRichEditor.prototype.setContent=function(html){this.editor.html.set(html)}\nRichEditor.prototype.syncContent=function(){this.editor.events.trigger('contentChanged')}\nRichEditor.prototype.updateLayout=function(){var $editor=$('.fr-wrapper',this.$el),$codeEditor=$('.fr-code',this.$el),$toolbar=$('.fr-toolbar',this.$el),$box=$('.fr-box',this.$el)\nif(!$editor.length){return}\nif(this.$el.hasClass('stretch')&&!$box.hasClass('fr-fullscreen')){var height=$toolbar.outerHeight(true)\n$editor.css('top',height+1)\n$codeEditor.css('top',height)}\nelse{$editor.css('top','')\n$codeEditor.css('top','')}}\nRichEditor.prototype.insertHtml=function(html){this.editor.html.insert(html)\nthis.editor.selection.restore()}\nRichEditor.prototype.insertElement=function($el){this.insertHtml($('<div />').append($el.clone()).remove().html())}\nRichEditor.prototype.insertUiBlock=function($node){this.$textarea.froalaEditor('figures.insert',$node)}\nRichEditor.prototype.insertVideo=function(url,title){this.$textarea.froalaEditor('figures.insertVideo',url,title)}\nRichEditor.prototype.insertAudio=function(url,title){this.$textarea.froalaEditor('figures.insertAudio',url,title)}\nRichEditor.prototype.onSetContent=function(ev,editor){this.$textarea.trigger('setContent.oc.richeditor',[this])}\nRichEditor.prototype.onSyncContent=function(ev,editor,html){if(editor.codeBeautifier){html=editor.codeBeautifier.run(html,editor.opts.codeBeautifierOptions)}\nvar container={html:html}\nthis.$textarea.trigger('syncContent.oc.richeditor',[this,container])\nreturn container.html}\nRichEditor.prototype.onFocus=function(){this.$el.addClass('editor-focus')}\nRichEditor.prototype.onBlur=function(){this.$el.removeClass('editor-focus')}\nRichEditor.prototype.onFigureKeydown=function(ev){this.$textarea.trigger('figureKeydown.oc.richeditor',[ev,this])}\nRichEditor.prototype.onKeydown=function(ev,editor,keyEv){this.$textarea.trigger('keydown.oc.richeditor',[keyEv,this])\nif(ev.isDefaultPrevented()){return false}}\nRichEditor.prototype.onChange=function(ev){this.$form.trigger('change')}\nRichEditor.prototype.onFormBeforeRequest=function(ev){if(!this.editor){return}\nif(this.isCodeViewActive()){this.editor.html.set(this.editor.codeView.get())}\nthis.$textarea.val(this.editor.html.get())}\nvar old=$.fn.richEditor\n$.fn.richEditor=function(option){var args=Array.prototype.slice.call(arguments,1),result\nthis.each(function(){var $this=$(this)\nvar data=$this.data('oc.richEditor')\nvar options=$.extend({},RichEditor.DEFAULTS,$this.data(),typeof option=='object'&&option)\nif(!data)$this.data('oc.richEditor',(data=new RichEditor(this,options)))\nif(typeof option=='string')result=data[option].apply(data,args)\nif(typeof result!='undefined')return false})\nreturn result?result:this}\n$.fn.richEditor.Constructor=RichEditor\n$.fn.richEditor.noConflict=function(){$.fn.richEditor=old\nreturn this}\n$(document).render(function(){$('[data-control=\"richeditor\"]').richEditor()})\nif($.oc===undefined)\n$.oc={}\n$.oc.richEditorButtons=['paragraphFormat','paragraphStyle','quote','bold','italic','align','formatOL','formatUL','insertTable','insertLink','insertImage','insertVideo','insertAudio','insertFile','insertHR','fullscreen','html']}(window.jQuery);", "/*\n * Rich text editor form field control (WYSIWYG)\n *\n * Data attributes:\n * - data-control=\"richeditor\" - enables the rich editor plugin\n *\n * JavaScript API:\n * $('textarea').richEditor()\n *\n * Dependancies:\n * - Froala Editor (froala_editor.js)\n */\n+function ($) { \"use strict\";\n    var Base = $.oc.foundation.base,\n        BaseProto = Base.prototype\n\n    // RICHEDITOR CLASS DEFINITION\n    // ============================\n\n    var RichEditor = function(element, options) {\n        this.options     = options\n        this.$el         = $(element)\n        this.$textarea   = this.$el.find('>textarea:first')\n        this.$form       = this.$el.closest('form')\n        this.editor      = null\n\n        $.oc.foundation.controlUtils.markDisposable(element)\n\n        Base.call(this)\n\n        this.init()\n    }\n\n    RichEditor.prototype = Object.create(BaseProto)\n    RichEditor.prototype.constructor = RichEditor\n\n    RichEditor.DEFAULTS = {\n        linksHandler: null,\n        uploadHandler: null,\n        stylesheet: null,\n        fullpage: false,\n        editorLang: 'en',\n        useMediaManager: false,\n        toolbarButtons: null,\n        allowEmptyTags: null,\n        allowTags: null,\n        noWrapTags: null,\n        removeTags: null,\n        lineBreakerTags: null,\n        imageStyles: null,\n        linkStyles: null,\n        paragraphStyles: null,\n        tableStyles: null,\n        tableCellStyles: null,\n        aceVendorPath: '/',\n        readOnly: false\n    }\n\n    RichEditor.prototype.init = function() {\n        var self = this;\n\n        this.$el.one('dispose-control', this.proxy(this.dispose))\n\n        /*\n         * Textarea must have an identifier\n         */\n        if (!this.$textarea.attr('id')) {\n            this.$textarea.attr('id', 'element-' + Math.random().toString(36).substring(7))\n        }\n\n        /*\n         * Initialize Froala editor\n         */\n        this.initFroala()\n    }\n\n    RichEditor.prototype.initFroala = function() {\n        var froalaOptions = {\n            editorClass: 'control-richeditor',\n            language: this.options.editorLang,\n            fullPage: this.options.fullpage,\n            pageLinksHandler: this.options.linksHandler,\n            uploadHandler: this.options.uploadHandler,\n            aceEditorVendorPath: this.options.aceVendorPath,\n            toolbarSticky: false\n        }\n\n        if (this.options.toolbarButtons) {\n            froalaOptions.toolbarButtons = this.options.toolbarButtons.split(',')\n        }\n        else {\n            froalaOptions.toolbarButtons = $.oc.richEditorButtons\n        }\n\n        froalaOptions.imageStyles = this.options.imageStyles\n            ? this.options.imageStyles\n            : {\n                'oc-img-rounded': 'Rounded',\n                'oc-img-bordered': 'Bordered'\n            }\n\n        froalaOptions.linkStyles = this.options.linkStyles\n            ? this.options.linkStyles\n            : {\n                'oc-link-green': 'Green',\n                'oc-link-strong': 'Thick'\n            }\n\n        froalaOptions.paragraphStyles = this.options.paragraphStyles\n            ? this.options.paragraphStyles\n            : {\n                'oc-text-gray': 'Gray',\n                'oc-text-bordered': 'Bordered',\n                'oc-text-spaced': 'Spaced',\n                'oc-text-uppercase': 'Uppercase'\n            }\n\n        froalaOptions.tableStyles = this.options.tableStyles\n            ? this.options.tableStyles\n            : {\n                'oc-dashed-borders': 'Dashed Borders',\n                'oc-alternate-rows': 'Alternate Rows'\n            }\n\n        froalaOptions.tableCellStyles = this.options.tableCellStyles\n            ? this.options.tableCellStyles\n            : {\n                'oc-cell-highlighted': 'Highlighted',\n                'oc-cell-thick-border': 'Thick'\n            }\n\n        froalaOptions.toolbarButtonsMD = froalaOptions.toolbarButtons\n        froalaOptions.toolbarButtonsSM = froalaOptions.toolbarButtons\n        froalaOptions.toolbarButtonsXS = froalaOptions.toolbarButtons\n\n        if (this.options.allowEmptyTags) {\n            froalaOptions.htmlAllowedEmptyTags = [];\n\n            this.options.allowEmptyTags.split(/[\\s,]+/).forEach(\n                function (selector) {\n                    var tag = selector.split('.', 2)\n                    if (froalaOptions.htmlAllowedEmptyTags.indexOf(tag[0]) === -1) {\n                        froalaOptions.htmlAllowedEmptyTags.push(selector)\n                    }\n                }\n            )\n        } else {\n            froalaOptions.htmlAllowedEmptyTags = ['textarea', 'a', 'iframe', 'object', 'video', 'style', 'script', '.fa', '.fr-emoticon', '.fr-inner', 'path', 'line', 'hr', 'i']\n        }\n\n        froalaOptions.htmlAllowedTags = this.options.allowTags\n            ? this.options.allowTags.split(/[\\s,]+/)\n            : ['a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'blockquote', 'br', 'button', 'canvas', 'caption', 'cite', 'code', 'col', 'colgroup', 'datalist', 'dd', 'del', 'details', 'dfn', 'dialog', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset', 'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'hgroup', 'hr', 'i', 'iframe', 'img', 'input', 'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'menu', 'menuitem', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option', 'output', 'p', 'param', 'pre', 'progress', 'queue', 'rp', 'rt', 'ruby', 's', 'samp', 'script', 'style', 'section', 'select', 'small', 'source', 'span', 'strike', 'strong', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'textarea', 'tfoot', 'th', 'thead', 'time', 'title', 'tr', 'track', 'u', 'ul', 'var', 'video', 'wbr']\n\n        froalaOptions.htmlDoNotWrapTags = this.options.noWrapTags\n            ? this.options.noWrapTags.split(/[\\s,]+/)\n            : ['figure', 'script', 'style']\n\n        froalaOptions.htmlRemoveTags = this.options.removeTags\n            ? this.options.removeTags.split(/[\\s,]+/)\n            : ['script', 'style', 'base']\n\n        froalaOptions.lineBreakerTags = this.options.lineBreakerTags\n            ? this.options.lineBreakerTags.split(/[\\s,]+/)\n            : ['figure, table, hr, iframe, form, dl']\n\n        froalaOptions.shortcutsEnabled = ['show', 'bold', 'italic', 'underline', 'indent', 'outdent', 'undo', 'redo']\n\n        // Ensure that October recognizes AJAX requests from Froala\n        froalaOptions.requestHeaders = {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n            'X-Requested-With': 'XMLHttpRequest'\n        }\n\n        // Get the data from the parent form for including in the request\n        var $form = this.$el.closest('form')\n        var formData = {};\n        if ($form.length > 0) {\n            $.each($form.serializeArray(), function (index, field) {\n                formData[field.name] = field.value;\n            })\n        }\n\n        // File upload\n        froalaOptions.imageUploadURL = froalaOptions.fileUploadURL = window.location\n        froalaOptions.imageUploadParam = froalaOptions.fileUploadParam = 'file_data'\n        froalaOptions.imageUploadParams = froalaOptions.fileUploadParams = $.extend(formData, {\n            _handler: froalaOptions.uploadHandler,\n        })\n\n        var placeholder = this.$textarea.attr('placeholder')\n        froalaOptions.placeholderText = placeholder ? placeholder : ''\n\n        froalaOptions.height = this.$el.hasClass('stretch')\n            ? Infinity\n            : $('.height-indicator', this.$el).height()\n\n        if (!this.options.useMediaManager) {\n            delete $.FroalaEditor.PLUGINS.mediaManager\n        }\n\n        $.FroalaEditor.ICON_TEMPLATES = {\n            font_awesome: '<i class=\"icon-[NAME]\"></i>',\n            text: '<span style=\"text-align: center;\">[NAME]</span>',\n            image: '<img src=[SRC] alt=[ALT] />'\n        }\n\n        this.$textarea.on('froalaEditor.initialized', this.proxy(this.build))\n        this.$textarea.on('froalaEditor.contentChanged', this.proxy(this.onChange))\n        this.$textarea.on('froalaEditor.html.get', this.proxy(this.onSyncContent))\n        this.$textarea.on('froalaEditor.html.set', this.proxy(this.onSetContent))\n        this.$form.on('oc.beforeRequest', this.proxy(this.onFormBeforeRequest))\n\n        this.$textarea.froalaEditor(froalaOptions)\n\n        this.editor = this.$textarea.data('froala.editor')\n\n        if (this.options.readOnly) {\n            this.editor.edit.off()\n        }\n\n        this.$el.on('keydown', '.fr-view figure', this.proxy(this.onFigureKeydown))\n    }\n\n    RichEditor.prototype.dispose = function() {\n        this.unregisterHandlers()\n\n        this.$textarea.froalaEditor('destroy')\n\n        this.$el.removeData('oc.richEditor')\n\n        this.options = null\n        this.$el = null\n        this.$textarea = null\n        this.$form = null\n        this.editor = null\n\n        BaseProto.dispose.call(this)\n    }\n\n    RichEditor.prototype.unregisterHandlers = function() {\n        this.$el.off('keydown', '.fr-view figure', this.proxy(this.onFigureKeydown))\n\n        this.$textarea.off('froalaEditor.initialized', this.proxy(this.build))\n        this.$textarea.off('froalaEditor.contentChanged', this.proxy(this.onChange))\n        this.$textarea.off('froalaEditor.html.get', this.proxy(this.onSyncContent))\n        this.$textarea.off('froalaEditor.html.set', this.proxy(this.onSetContent))\n        this.$form.off('oc.beforeRequest', this.proxy(this.onFormBeforeRequest))\n\n        $(window).off('resize', this.proxy(this.updateLayout))\n        $(window).off('oc.updateUi', this.proxy(this.updateLayout))\n        this.$el.off('dispose-control', this.proxy(this.dispose))\n    }\n\n    RichEditor.prototype.build = function(event, editor) {\n        this.updateLayout()\n\n        $(window).on('resize', this.proxy(this.updateLayout))\n        $(window).on('oc.updateUi', this.proxy(this.updateLayout))\n\n        // Bind the keydown listener here to ensure it gets handled before the Froala handlers\n        editor.events.on('keydown', this.proxy(this.onKeydown), true)\n\n        this.$textarea.trigger('init.oc.richeditor', [this])\n    }\n\n    RichEditor.prototype.isCodeViewActive = function() {\n        return this.editor && this.editor.codeView && this.editor.codeView.isActive()\n    }\n\n    RichEditor.prototype.getElement = function() {\n        return this.$el\n    }\n\n    RichEditor.prototype.getEditor = function() {\n        return this.editor\n    }\n\n    RichEditor.prototype.getTextarea = function() {\n        return this.$textarea\n    }\n\n    RichEditor.prototype.getContent = function() {\n        return this.editor.html.get()\n    }\n\n    RichEditor.prototype.setContent = function(html) {\n        this.editor.html.set(html)\n    }\n\n    RichEditor.prototype.syncContent = function() {\n        this.editor.events.trigger('contentChanged')\n    }\n\n    RichEditor.prototype.updateLayout = function() {\n        var $editor = $('.fr-wrapper', this.$el),\n            $codeEditor = $('.fr-code', this.$el),\n            $toolbar = $('.fr-toolbar', this.$el),\n            $box = $('.fr-box', this.$el)\n\n        if (!$editor.length) {\n            return\n        }\n\n        if (this.$el.hasClass('stretch') && !$box.hasClass('fr-fullscreen')) {\n            var height = $toolbar.outerHeight(true)\n            $editor.css('top', height+1)\n            $codeEditor.css('top', height)\n        }\n        else {\n            $editor.css('top', '')\n            $codeEditor.css('top', '')\n        }\n    }\n\n    RichEditor.prototype.insertHtml = function(html) {\n        this.editor.html.insert(html)\n        this.editor.selection.restore()\n    }\n\n    RichEditor.prototype.insertElement = function($el) {\n        this.insertHtml($('<div />').append($el.clone()).remove().html())\n    }\n\n    /*\n     * Inserts non-editable block (used for snippets, audio and video)\n     */\n    RichEditor.prototype.insertUiBlock = function($node) {\n        this.$textarea.froalaEditor('figures.insert', $node)\n    }\n\n    RichEditor.prototype.insertVideo = function(url, title) {\n        this.$textarea.froalaEditor('figures.insertVideo', url, title)\n    }\n\n    RichEditor.prototype.insertAudio = function(url, title) {\n        this.$textarea.froalaEditor('figures.insertAudio', url, title)\n    }\n\n    // EVENT HANDLERS\n    // ============================\n\n    RichEditor.prototype.onSetContent = function(ev, editor) {\n        this.$textarea.trigger('setContent.oc.richeditor', [this])\n    }\n\n    RichEditor.prototype.onSyncContent = function(ev, editor, html) {\n        // Beautify HTML.\n        if (editor.codeBeautifier) {\n            html = editor.codeBeautifier.run(html, editor.opts.codeBeautifierOptions)\n        }\n\n        var container = {\n            html: html\n        }\n\n        this.$textarea.trigger('syncContent.oc.richeditor', [this, container])\n\n        return container.html\n    }\n\n    RichEditor.prototype.onFocus = function() {\n        this.$el.addClass('editor-focus')\n    }\n\n    RichEditor.prototype.onBlur = function() {\n        this.$el.removeClass('editor-focus')\n    }\n\n    RichEditor.prototype.onFigureKeydown = function(ev) {\n        this.$textarea.trigger('figureKeydown.oc.richeditor', [ev, this])\n    }\n\n    RichEditor.prototype.onKeydown = function(ev, editor, keyEv) {\n        this.$textarea.trigger('keydown.oc.richeditor', [keyEv, this])\n\n        if (ev.isDefaultPrevented()) {\n            return false\n        }\n    }\n\n    RichEditor.prototype.onChange = function(ev) {\n        this.$form.trigger('change')\n    }\n\n    /*\n     * Instantly synchronizes HTML content.\n     * The onSyncContent() method (above) is involved into this call,\n     * so the resulting HTML is (optionally) beautified.\n     */\n    RichEditor.prototype.onFormBeforeRequest = function(ev) {\n        if (!this.editor) {\n            return\n        }\n\n        if (this.isCodeViewActive()) {\n            this.editor.html.set(this.editor.codeView.get())\n        }\n\n        this.$textarea.val(this.editor.html.get())\n    }\n\n    // RICHEDITOR PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.richEditor\n\n    $.fn.richEditor = function (option) {\n        var args = Array.prototype.slice.call(arguments, 1), result\n        this.each(function () {\n            var $this   = $(this)\n            var data    = $this.data('oc.richEditor')\n            var options = $.extend({}, RichEditor.DEFAULTS, $this.data(), typeof option == 'object' && option)\n            if (!data) $this.data('oc.richEditor', (data = new RichEditor(this, options)))\n            if (typeof option == 'string') result = data[option].apply(data, args)\n            if (typeof result != 'undefined') return false\n        })\n\n        return result ? result : this\n    }\n\n    $.fn.richEditor.Constructor = RichEditor\n\n    // RICHEDITOR NO CONFLICT\n    // =================\n\n    $.fn.richEditor.noConflict = function() {\n        $.fn.richEditor = old\n        return this\n    }\n\n    // RICHEDITOR DATA-API\n    // ===============\n    $(document).render(function() {\n        $('[data-control=\"richeditor\"]').richEditor()\n    })\n\n\n    // BUTTON DEFINITIONS\n    // =================\n\n    if ($.oc === undefined)\n        $.oc = {}\n\n    $.oc.richEditorButtons = [\n        'paragraphFormat',\n        'paragraphStyle',\n        'quote',\n        'bold',\n        'italic',\n        'align',\n        'formatOL',\n        'formatUL',\n        'insertTable',\n        'insertLink',\n        'insertImage',\n        'insertVideo',\n        'insertAudio',\n        'insertFile',\n        'insertHR',\n        'fullscreen',\n        'html'\n    ]\n\n}(window.jQuery);\n", "\nif(window.jQuery===undefined){throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');}\nif(window.jQuery.request!==undefined){throw new Error('The OctoberCMS framework is already loaded.');}\n+function($){\"use strict\";var Request=function(element,handler,options){var $el=this.$el=$(element);this.options=options||{};if(handler===undefined){throw new Error('The request handler name is not specified.')}\nif(!handler.match(/^(?:\\w+\\:{2})?on*/)){throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')}\nvar $form=options.form?$(options.form):$el.closest('form'),$triggerEl=!!$form.length?$form:$el,context={handler:handler,options:options}\nif((options.browserValidate!==undefined)&&typeof document.createElement('input').reportValidity=='function'&&$form&&$form[0]&&!$form[0].checkValidity()){$form[0].reportValidity();return false;}\n$el.trigger('ajaxSetup',[context])\nvar _event=jQuery.Event('oc.beforeRequest')\n$triggerEl.trigger(_event,context)\nif(_event.isDefaultPrevented())return\nvar loading=options.loading!==undefined?options.loading:null,url=options.url!==undefined?options.url:window.location.href,isRedirect=options.redirect!==undefined&&options.redirect.length,useFlash=options.flash!==undefined,useFiles=options.files!==undefined\nif(useFiles&&typeof FormData==='undefined'){console.warn('This browser does not support file uploads via FormData')\nuseFiles=false}\nif($.type(loading)=='string'){loading=$(loading)}\nvar requestHeaders={'X-OCTOBER-REQUEST-HANDLER':handler,'X-OCTOBER-REQUEST-PARTIALS':this.extractPartials(options.update)}\nif(useFlash){requestHeaders['X-OCTOBER-REQUEST-FLASH']=1}\nvar csrfToken=getXSRFToken()\nif(csrfToken){requestHeaders['X-XSRF-TOKEN']=csrfToken}\nvar requestData,inputName,data={}\n$.each($el.parents('[data-request-data]').toArray().reverse(),function extendRequest(){$.extend(data,paramToObj('data-request-data',$(this).data('request-data')))})\nif($el.is(':input')&&!$form.length){inputName=$el.attr('name')\nif(inputName!==undefined&&options.data[inputName]===undefined){options.data[inputName]=$el.val()}}\nif(options.data!==undefined&&!$.isEmptyObject(options.data)){$.extend(data,options.data)}\nif(useFiles){requestData=new FormData($form.length?$form.get(0):undefined)\nif($el.is(':file')&&inputName){$.each($el.prop('files'),function(){requestData.append(inputName,this)})\ndelete data[inputName]}\n$.each(data,function(key){if(typeof Blob!==\"undefined\"&&this instanceof Blob&&this.filename){requestData.append(key,this,this.filename)}else{requestData.append(key,this)}})}\nelse{requestData=[$form.serialize(),$.param(data)].filter(Boolean).join('&')}\nvar requestOptions={url:url,crossDomain:false,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])===false)return\nif(options.evalBeforeUpdate&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')===false)return\nvar _event=jQuery.Event('ajaxBeforeUpdate')\n$triggerEl.trigger(_event,[context,data,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(useFlash&&data['X_OCTOBER_FLASH_MESSAGES']){$.each(data['X_OCTOBER_FLASH_MESSAGES'],function(type,message){requestOptions.handleFlashMessage(message,type)})}\nvar updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR)\nupdatePromise.done(function(){$triggerEl.trigger('ajaxSuccess',[context,data,textStatus,jqXHR])\noptions.evalSuccess&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')})\nreturn updatePromise},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred()\nif((window.ocUnloading!==undefined&&window.ocUnloading)||errorThrown=='abort')\nreturn\nisRedirect=false\noptions.redirect=null\nif(jqXHR.status==406&&jqXHR.responseJSON){errorMsg=jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\nupdatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)}\nelse{errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText\nupdatePromise.resolve()}\nupdatePromise.done(function(){$el.data('error-message',errorMsg)\nvar _event=jQuery.Event('ajaxError')\n$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(options.evalError&&eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))')===false)\nreturn\nrequestOptions.handleErrorMessage(errorMsg)})\nreturn updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger('ajaxComplete',[context,data,textStatus,jqXHR])\noptions.evalComplete&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')},handleConfirmMessage:function(message){var _event=jQuery.Event('ajaxConfirmMessage')\n_event.promise=$.Deferred()\nif($(window).triggerHandler(_event,[message])!==undefined){_event.promise.done(function(){options.confirm=null\nnew Request(element,handler,options)})\nreturn false}\nif(_event.isDefaultPrevented())return\nif(message)return confirm(message)},handleErrorMessage:function(message){var _event=jQuery.Event('ajaxErrorMessage')\n$(window).trigger(_event,[message])\nif(_event.isDefaultPrevented())return\nif(message)alert(message)},handleValidationMessage:function(message,fields){$triggerEl.trigger('ajaxValidation',[context,message,fields])\nvar isFirstInvalidField=true\n$.each(fields,function focusErrorField(fieldName,fieldMessages){fieldName=fieldName.replace(/\\.(\\w+)/g,'[$1]')\nvar fieldElement=$form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\nif(fieldElement.length>0){var _event=jQuery.Event('ajaxInvalidField')\n$(window).trigger(_event,[fieldElement.get(0),fieldName,fieldMessages,isFirstInvalidField])\nif(isFirstInvalidField){if(!_event.isDefaultPrevented())fieldElement.focus()\nisFirstInvalidField=false}}})},handleFlashMessage:function(message,type){},handleRedirectResponse:function(url){window.location.assign(url)},handleUpdateResponse:function(data,textStatus,jqXHR){var updatePromise=$.Deferred().done(function(){for(var partial in data){var selector=(options.update[partial])?options.update[partial]:partial\nif($.type(selector)=='string'&&selector.charAt(0)=='@'){$(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse if($.type(selector)=='string'&&selector.charAt(0)=='^'){$(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse{$(selector).trigger('ajaxBeforeReplace')\n$(selector).html(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}}\nsetTimeout(function(){$(window).trigger('ajaxUpdateComplete',[context,data,textStatus,jqXHR]).trigger('resize')},0)})\nif(data['X_OCTOBER_REDIRECT']){options.redirect=data['X_OCTOBER_REDIRECT']\nisRedirect=true}\nif(isRedirect){requestOptions.handleRedirectResponse(options.redirect)}\nif(data['X_OCTOBER_ERROR_FIELDS']){requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'],data['X_OCTOBER_ERROR_FIELDS'])}\nif(data['X_OCTOBER_ASSETS']){assetManager.load(data['X_OCTOBER_ASSETS'],$.proxy(updatePromise.resolve,updatePromise))}\nelse{updatePromise.resolve()}\nreturn updatePromise}}\nif(useFiles){requestOptions.processData=requestOptions.contentType=false}\ncontext.success=requestOptions.success\ncontext.error=requestOptions.error\ncontext.complete=requestOptions.complete\nrequestOptions=$.extend(requestOptions,options)\nrequestOptions.data=requestData\nif(options.confirm&&!requestOptions.handleConfirmMessage(options.confirm)){return}\nif(loading)loading.show()\n$(window).trigger('ajaxBeforeSend',[context])\n$el.trigger('ajaxPromise',[context])\nreturn $.ajax(requestOptions).fail(function(jqXHR,textStatus,errorThrown){if(!isRedirect){$el.trigger('ajaxFail',[context,textStatus,jqXHR])}\nif(loading)loading.hide()}).done(function(data,textStatus,jqXHR){if(!isRedirect){$el.trigger('ajaxDone',[context,data,textStatus,jqXHR])}\nif(loading)loading.hide()}).always(function(dataOrXhr,textStatus,xhrOrError){$el.trigger('ajaxAlways',[context,dataOrXhr,textStatus,xhrOrError])})}\nRequest.DEFAULTS={update:{},type:'POST',beforeUpdate:function(data,textStatus,jqXHR){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:false}\nRequest.prototype.extractPartials=function(update){var result=[]\nfor(var partial in update)\nresult.push(partial)\nreturn result.join('&')}\nvar old=$.fn.request\n$.fn.request=function(handler,option){var args=arguments\nvar $this=$(this).first()\nvar data={evalBeforeUpdate:$this.data('request-before-update'),evalSuccess:$this.data('request-success'),evalError:$this.data('request-error'),evalComplete:$this.data('request-complete'),ajaxGlobal:$this.data('request-ajax-global'),confirm:$this.data('request-confirm'),redirect:$this.data('request-redirect'),loading:$this.data('request-loading'),flash:$this.data('request-flash'),files:$this.data('request-files'),browserValidate:$this.data('browser-validate'),form:$this.data('request-form'),url:$this.data('request-url'),update:paramToObj('data-request-update',$this.data('request-update')),data:paramToObj('data-request-data',$this.data('request-data'))}\nif(!handler)handler=$this.data('request')\nvar options=$.extend(true,{},Request.DEFAULTS,data,typeof option=='object'&&option)\nreturn new Request($this,handler,options)}\n$.fn.request.Constructor=Request\n$.request=function(handler,option){return $(document).request(handler,option)}\n$.fn.request.noConflict=function(){$.fn.request=old\nreturn this}\nfunction paramToObj(name,value){if(value===undefined)value=''\nif(typeof value=='object')return value\ntry{return ocJSON(\"{\"+value+\"}\")}\ncatch(e){throw new Error('Error parsing the '+name+' attribute value. '+e)}}\nfunction getXSRFToken(){var cookieValue=null\nif(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';')\nfor(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i])\nif(cookie.substring(0,11)==('XSRF-TOKEN'+'=')){cookieValue=decodeURIComponent(cookie.substring(11))\nbreak}}}\nreturn cookieValue}\n$(document).on('change','select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]',function documentOnChange(){$(this).request()})\n$(document).on('click','a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]',function documentOnClick(e){e.preventDefault()\n$(this).request()\nif($(this).is('[type=submit]'))\nreturn false})\n$(document).on('keydown','input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]',function documentOnKeydown(e){if(e.key==='Enter'){if(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\n$(this).request()\nreturn false}})\n$(document).on('input','input[data-request][data-track-input]',function documentOnKeyup(e){var\n$el=$(this),lastValue=$el.data('oc.lastvalue')\nif(!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\nreturn\nif(lastValue!==undefined&&lastValue==this.value)\nreturn\n$el.data('oc.lastvalue',this.value)\nif(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\nvar interval=$(this).data('track-input')\nif(!interval)\ninterval=300\nvar self=this\nthis.dataTrackInputTimer=window.setTimeout(function(){if(self.lastDataTrackInputRequest){self.lastDataTrackInputRequest.abort();}\nself.lastDataTrackInputRequest=$(self).request();},interval)})\n$(document).on('submit','[data-request]',function documentOnSubmit(){$(this).request()\nreturn false})\n$(window).on('beforeunload',function documentOnBeforeUnload(){window.ocUnloading=true})\n$(document).ready(function triggerRenderOnReady(){$(document).trigger('render')})\n$(window).on('ajaxUpdateComplete',function triggerRenderOnAjaxUpdateComplete(){$(document).trigger('render')})\n$.fn.render=function(callback){$(document).on('render',callback)}}(window.jQuery);+function(window){\"use strict\";function parseKey(str,pos,quote){var key=\"\";for(var i=pos;i<str.length;i++){if(quote&&quote===str[i]){return key;}else if(!quote&&(str[i]===\" \"||str[i]===\":\")){return key;}\nkey+=str[i];if(str[i]===\"\\\\\"&&i+1<str.length){key+=str[i+1];i++;}}\nthrow new Error(\"Broken JSON syntax near \"+key);}\nfunction getBody(str,pos){if(str[pos]===\"\\\"\"||str[pos]===\"'\"){var body=str[pos];for(var i=pos+1;i<str.length;i++){if(str[i]===\"\\\\\"){body+=str[i];if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===str[pos]){body+=str[pos];return{originLength:body.length,body:body};}else body+=str[i];}\nthrow new Error(\"Broken JSON string body near \"+body);}\nif(str[pos]===\"t\"){if(str.indexOf(\"true\",pos)===pos){return{originLength:\"true\".length,body:\"true\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"f\"){if(str.indexOf(\"f\",pos)===pos){return{originLength:\"false\".length,body:\"false\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"n\"){if(str.indexOf(\"null\",pos)===pos){return{originLength:\"null\".length,body:\"null\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"-\"||str[pos]===\"+\"||str[pos]===\".\"||(str[pos]>=\"0\"&&str[pos]<=\"9\")){var body=\"\";for(var i=pos;i<str.length;i++){if(str[i]===\"-\"||str[i]===\"+\"||str[i]===\".\"||(str[i]>=\"0\"&&str[i]<=\"9\")){body+=str[i];}else{return{originLength:body.length,body:body};}}\nthrow new Error(\"Broken JSON number body near \"+body);}\nif(str[pos]===\"{\"||str[pos]===\"[\"){var stack=[str[pos]];var body=str[pos];for(var i=pos+1;i<str.length;i++){body+=str[i];if(str[i]===\"\\\\\"){if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===\"\\\"\"){if(stack[stack.length-1]===\"\\\"\"){stack.pop();}else if(stack[stack.length-1]!==\"'\"){stack.push(str[i]);}}else if(str[i]===\"'\"){if(stack[stack.length-1]===\"'\"){stack.pop();}else if(stack[stack.length-1]!==\"\\\"\"){stack.push(str[i]);}}else if(stack[stack.length-1]!==\"\\\"\"&&stack[stack.length-1]!==\"'\"){if(str[i]===\"{\"){stack.push(\"{\");}else if(str[i]===\"}\"){if(stack[stack.length-1]===\"{\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}else if(str[i]===\"[\"){stack.push(\"[\");}else if(str[i]===\"]\"){if(stack[stack.length-1]===\"[\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}}\nif(!stack.length){return{originLength:i-pos,body:body};}}\nthrow new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}\nthrow new Error(\"Broken JSON body near \"+str.substr((pos-5>=0)?pos-5:0,50));}\nfunction canBeKeyHead(ch){if(ch[0]===\"\\\\\")return false;if((ch[0]>='a'&&ch[0]<='z')||(ch[0]>='A'&&ch[0]<='Z')||ch[0]==='_')return true;if(ch[0]>='0'&&ch[0]<='9')return true;if(ch[0]==='$')return true;if(ch.charCodeAt(0)>255)return true;return false;}\nfunction isBlankChar(ch){return ch===\" \"||ch===\"\\n\"||ch===\"\\t\";}\nfunction parse(str){str=str.trim();if(!str.length)throw new Error(\"Broken JSON object.\");var result=\"\";while(str&&str[0]===\",\"){str=str.substr(1);}\nif(str[0]===\"\\\"\"||str[0]===\"'\"){if(str[str.length-1]!==str[0]){throw new Error(\"Invalid string JSON object.\");}\nvar body=\"\\\"\";for(var i=1;i<str.length;i++){if(str[i]===\"\\\\\"){if(str[i+1]===\"'\"){body+=str[i+1]}else{body+=str[i];body+=str[i+1];}\ni++;}else if(str[i]===str[0]){body+=\"\\\"\";return body}else if(str[i]===\"\\\"\"){body+=\"\\\\\\\"\"}else body+=str[i];}\nthrow new Error(\"Invalid string JSON object.\");}\nif(str===\"true\"||str===\"false\"){return str;}\nif(str===\"null\"){return\"null\";}\nvar num=parseFloat(str);if(!isNaN(num)){return num.toString();}\nif(str[0]===\"{\"){var type=\"needKey\";var result=\"{\";for(var i=1;i<str.length;i++){if(isBlankChar(str[i])){continue;}else if(type===\"needKey\"&&(str[i]===\"\\\"\"||str[i]===\"'\")){var key=parseKey(str,i+1,str[i]);result+=\"\\\"\"+key+\"\\\"\";i+=key.length;i+=1;type=\"afterKey\";}else if(type===\"needKey\"&&canBeKeyHead(str[i])){var key=parseKey(str,i);result+=\"\\\"\";result+=key;result+=\"\\\"\";i+=key.length-1;type=\"afterKey\";}else if(type===\"afterKey\"&&str[i]===\":\"){result+=\":\";type=\":\";}else if(type===\":\"){var body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"||type===\"needKey\"){var last=i;while(str[last]===\",\"||isBlankChar(str[last])){last++;}\nif(str[last]===\"}\"&&last===str.length-1){while(result[result.length-1]===\",\"){result=result.substr(0,result.length-1);}\nresult+=\"}\";return result;}else if(last!==i&&result!==\"{\"){result+=\",\";type=\"needKey\";i=last-1;}}}\nthrow new Error(\"Broken JSON object near \"+result);}\nif(str[0]===\"[\"){var result=\"[\";var type=\"needBody\";for(var i=1;i<str.length;i++){if(\" \"===str[i]||\"\\n\"===str[i]||\"\\t\"===str[i]){continue;}else if(type===\"needBody\"){if(str[i]===\",\"){result+=\"null,\";continue;}\nif(str[i]===\"]\"&&i===str.length-1){if(result[result.length-1]===\",\")result=result.substr(0,result.length-1);result+=\"]\";return result;}\nvar body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"){if(str[i]===\",\"){result+=\",\";type=\"needBody\";while(str[i+1]===\",\"||isBlankChar(str[i+1])){if(str[i+1]===\",\")result+=\"null,\";i++;}}else if(str[i]===\"]\"&&i===str.length-1){result+=\"]\";return result;}}}\nthrow new Error(\"Broken JSON array near \"+result);}}\nwindow.ocJSON=function(json){var jsonString=parse(json);return JSON.parse(jsonString);};}(window);", "\nif(window.jQuery===undefined){throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');}\nif(window.jQuery.request!==undefined){throw new Error('The OctoberCMS framework is already loaded.');}\n+function($){\"use strict\";var Request=function(element,handler,options){var $el=this.$el=$(element);this.options=options||{};if(handler===undefined){throw new Error('The request handler name is not specified.')}\nif(!handler.match(/^(?:\\w+\\:{2})?on*/)){throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')}\nvar $form=options.form?$(options.form):$el.closest('form'),$triggerEl=!!$form.length?$form:$el,context={handler:handler,options:options}\nif((options.browserValidate!==undefined)&&typeof document.createElement('input').reportValidity=='function'&&$form&&$form[0]&&!$form[0].checkValidity()){$form[0].reportValidity();return false;}\n$el.trigger('ajaxSetup',[context])\nvar _event=jQuery.Event('oc.beforeRequest')\n$triggerEl.trigger(_event,context)\nif(_event.isDefaultPrevented())return\nvar loading=options.loading!==undefined?options.loading:null,url=options.url!==undefined?options.url:window.location.href,isRedirect=options.redirect!==undefined&&options.redirect.length,useFlash=options.flash!==undefined,useFiles=options.files!==undefined\nif(useFiles&&typeof FormData==='undefined'){console.warn('This browser does not support file uploads via FormData')\nuseFiles=false}\nif($.type(loading)=='string'){loading=$(loading)}\nvar requestHeaders={'X-OCTOBER-REQUEST-HANDLER':handler,'X-OCTOBER-REQUEST-PARTIALS':this.extractPartials(options.update)}\nif(useFlash){requestHeaders['X-OCTOBER-REQUEST-FLASH']=1}\nvar csrfToken=getXSRFToken()\nif(csrfToken){requestHeaders['X-XSRF-TOKEN']=csrfToken}\nvar requestData,inputName,data={}\n$.each($el.parents('[data-request-data]').toArray().reverse(),function extendRequest(){$.extend(data,paramToObj('data-request-data',$(this).data('request-data')))})\nif($el.is(':input')&&!$form.length){inputName=$el.attr('name')\nif(inputName!==undefined&&options.data[inputName]===undefined){options.data[inputName]=$el.val()}}\nif(options.data!==undefined&&!$.isEmptyObject(options.data)){$.extend(data,options.data)}\nif(useFiles){requestData=new FormData($form.length?$form.get(0):undefined)\nif($el.is(':file')&&inputName){$.each($el.prop('files'),function(){requestData.append(inputName,this)})\ndelete data[inputName]}\n$.each(data,function(key){if(typeof Blob!==\"undefined\"&&this instanceof Blob&&this.filename){requestData.append(key,this,this.filename)}else{requestData.append(key,this)}})}\nelse{requestData=[$form.serialize(),$.param(data)].filter(Boolean).join('&')}\nvar requestOptions={url:url,crossDomain:false,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])===false)return\nif(options.evalBeforeUpdate&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')===false)return\nvar _event=jQuery.Event('ajaxBeforeUpdate')\n$triggerEl.trigger(_event,[context,data,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(useFlash&&data['X_OCTOBER_FLASH_MESSAGES']){$.each(data['X_OCTOBER_FLASH_MESSAGES'],function(type,message){requestOptions.handleFlashMessage(message,type)})}\nvar updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR)\nupdatePromise.done(function(){$triggerEl.trigger('ajaxSuccess',[context,data,textStatus,jqXHR])\noptions.evalSuccess&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')})\nreturn updatePromise},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred()\nif((window.ocUnloading!==undefined&&window.ocUnloading)||errorThrown=='abort')\nreturn\nisRedirect=false\noptions.redirect=null\nif(jqXHR.status==406&&jqXHR.responseJSON){errorMsg=jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\nupdatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)}\nelse{errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText\nupdatePromise.resolve()}\nupdatePromise.done(function(){$el.data('error-message',errorMsg)\nvar _event=jQuery.Event('ajaxError')\n$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(options.evalError&&eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))')===false)\nreturn\nrequestOptions.handleErrorMessage(errorMsg)})\nreturn updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger('ajaxComplete',[context,data,textStatus,jqXHR])\noptions.evalComplete&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')},handleConfirmMessage:function(message){var _event=jQuery.Event('ajaxConfirmMessage')\n_event.promise=$.Deferred()\nif($(window).triggerHandler(_event,[message])!==undefined){_event.promise.done(function(){options.confirm=null\nnew Request(element,handler,options)})\nreturn false}\nif(_event.isDefaultPrevented())return\nif(message)return confirm(message)},handleErrorMessage:function(message){var _event=jQuery.Event('ajaxErrorMessage')\n$(window).trigger(_event,[message])\nif(_event.isDefaultPrevented())return\nif(message)alert(message)},handleValidationMessage:function(message,fields){$triggerEl.trigger('ajaxValidation',[context,message,fields])\nvar isFirstInvalidField=true\n$.each(fields,function focusErrorField(fieldName,fieldMessages){fieldName=fieldName.replace(/\\.(\\w+)/g,'[$1]')\nvar fieldElement=$form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\nif(fieldElement.length>0){var _event=jQuery.Event('ajaxInvalidField')\n$(window).trigger(_event,[fieldElement.get(0),fieldName,fieldMessages,isFirstInvalidField])\nif(isFirstInvalidField){if(!_event.isDefaultPrevented())fieldElement.focus()\nisFirstInvalidField=false}}})},handleFlashMessage:function(message,type){},handleRedirectResponse:function(url){window.location.assign(url)},handleUpdateResponse:function(data,textStatus,jqXHR){var updatePromise=$.Deferred().done(function(){for(var partial in data){var selector=(options.update[partial])?options.update[partial]:partial\nif($.type(selector)=='string'&&selector.charAt(0)=='@'){$(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse if($.type(selector)=='string'&&selector.charAt(0)=='^'){$(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse{$(selector).trigger('ajaxBeforeReplace')\n$(selector).html(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}}\nsetTimeout(function(){$(window).trigger('ajaxUpdateComplete',[context,data,textStatus,jqXHR]).trigger('resize')},0)})\nif(data['X_OCTOBER_REDIRECT']){options.redirect=data['X_OCTOBER_REDIRECT']\nisRedirect=true}\nif(isRedirect){requestOptions.handleRedirectResponse(options.redirect)}\nif(data['X_OCTOBER_ERROR_FIELDS']){requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'],data['X_OCTOBER_ERROR_FIELDS'])}\nif(data['X_OCTOBER_ASSETS']){assetManager.load(data['X_OCTOBER_ASSETS'],$.proxy(updatePromise.resolve,updatePromise))}\nelse{updatePromise.resolve()}\nreturn updatePromise}}\nif(useFiles){requestOptions.processData=requestOptions.contentType=false}\ncontext.success=requestOptions.success\ncontext.error=requestOptions.error\ncontext.complete=requestOptions.complete\nrequestOptions=$.extend(requestOptions,options)\nrequestOptions.data=requestData\nif(options.confirm&&!requestOptions.handleConfirmMessage(options.confirm)){return}\nif(loading)loading.show()\n$(window).trigger('ajaxBeforeSend',[context])\n$el.trigger('ajaxPromise',[context])\nreturn $.ajax(requestOptions).fail(function(jqXHR,textStatus,errorThrown){if(!isRedirect){$el.trigger('ajaxFail',[context,textStatus,jqXHR])}\nif(loading)loading.hide()}).done(function(data,textStatus,jqXHR){if(!isRedirect){$el.trigger('ajaxDone',[context,data,textStatus,jqXHR])}\nif(loading)loading.hide()}).always(function(dataOrXhr,textStatus,xhrOrError){$el.trigger('ajaxAlways',[context,dataOrXhr,textStatus,xhrOrError])})}\nRequest.DEFAULTS={update:{},type:'POST',beforeUpdate:function(data,textStatus,jqXHR){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:false}\nRequest.prototype.extractPartials=function(update){var result=[]\nfor(var partial in update)\nresult.push(partial)\nreturn result.join('&')}\nvar old=$.fn.request\n$.fn.request=function(handler,option){var args=arguments\nvar $this=$(this).first()\nvar data={evalBeforeUpdate:$this.data('request-before-update'),evalSuccess:$this.data('request-success'),evalError:$this.data('request-error'),evalComplete:$this.data('request-complete'),ajaxGlobal:$this.data('request-ajax-global'),confirm:$this.data('request-confirm'),redirect:$this.data('request-redirect'),loading:$this.data('request-loading'),flash:$this.data('request-flash'),files:$this.data('request-files'),browserValidate:$this.data('browser-validate'),form:$this.data('request-form'),url:$this.data('request-url'),update:paramToObj('data-request-update',$this.data('request-update')),data:paramToObj('data-request-data',$this.data('request-data'))}\nif(!handler)handler=$this.data('request')\nvar options=$.extend(true,{},Request.DEFAULTS,data,typeof option=='object'&&option)\nreturn new Request($this,handler,options)}\n$.fn.request.Constructor=Request\n$.request=function(handler,option){return $(document).request(handler,option)}\n$.fn.request.noConflict=function(){$.fn.request=old\nreturn this}\nfunction paramToObj(name,value){if(value===undefined)value=''\nif(typeof value=='object')return value\ntry{return ocJSON(\"{\"+value+\"}\")}\ncatch(e){throw new Error('Error parsing the '+name+' attribute value. '+e)}}\nfunction getXSRFToken(){var cookieValue=null\nif(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';')\nfor(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i])\nif(cookie.substring(0,11)==('XSRF-TOKEN'+'=')){cookieValue=decodeURIComponent(cookie.substring(11))\nbreak}}}\nreturn cookieValue}\n$(document).on('change','select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]',function documentOnChange(){$(this).request()})\n$(document).on('click','a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]',function documentOnClick(e){e.preventDefault()\n$(this).request()\nif($(this).is('[type=submit]'))\nreturn false})\n$(document).on('keydown','input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]',function documentOnKeydown(e){if(e.key==='Enter'){if(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\n$(this).request()\nreturn false}})\n$(document).on('input','input[data-request][data-track-input]',function documentOnKeyup(e){var\n$el=$(this),lastValue=$el.data('oc.lastvalue')\nif(!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\nreturn\nif(lastValue!==undefined&&lastValue==this.value)\nreturn\n$el.data('oc.lastvalue',this.value)\nif(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\nvar interval=$(this).data('track-input')\nif(!interval)\ninterval=300\nvar self=this\nthis.dataTrackInputTimer=window.setTimeout(function(){if(self.lastDataTrackInputRequest){self.lastDataTrackInputRequest.abort();}\nself.lastDataTrackInputRequest=$(self).request();},interval)})\n$(document).on('submit','[data-request]',function documentOnSubmit(){$(this).request()\nreturn false})\n$(window).on('beforeunload',function documentOnBeforeUnload(){window.ocUnloading=true})\n$(document).ready(function triggerRenderOnReady(){$(document).trigger('render')})\n$(window).on('ajaxUpdateComplete',function triggerRenderOnAjaxUpdateComplete(){$(document).trigger('render')})\n$.fn.render=function(callback){$(document).on('render',callback)}}(window.jQuery);+function(window){\"use strict\";function parseKey(str,pos,quote){var key=\"\";for(var i=pos;i<str.length;i++){if(quote&&quote===str[i]){return key;}else if(!quote&&(str[i]===\" \"||str[i]===\":\")){return key;}\nkey+=str[i];if(str[i]===\"\\\\\"&&i+1<str.length){key+=str[i+1];i++;}}\nthrow new Error(\"Broken JSON syntax near \"+key);}\nfunction getBody(str,pos){if(str[pos]===\"\\\"\"||str[pos]===\"'\"){var body=str[pos];for(var i=pos+1;i<str.length;i++){if(str[i]===\"\\\\\"){body+=str[i];if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===str[pos]){body+=str[pos];return{originLength:body.length,body:body};}else body+=str[i];}\nthrow new Error(\"Broken JSON string body near \"+body);}\nif(str[pos]===\"t\"){if(str.indexOf(\"true\",pos)===pos){return{originLength:\"true\".length,body:\"true\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"f\"){if(str.indexOf(\"f\",pos)===pos){return{originLength:\"false\".length,body:\"false\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"n\"){if(str.indexOf(\"null\",pos)===pos){return{originLength:\"null\".length,body:\"null\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"-\"||str[pos]===\"+\"||str[pos]===\".\"||(str[pos]>=\"0\"&&str[pos]<=\"9\")){var body=\"\";for(var i=pos;i<str.length;i++){if(str[i]===\"-\"||str[i]===\"+\"||str[i]===\".\"||(str[i]>=\"0\"&&str[i]<=\"9\")){body+=str[i];}else{return{originLength:body.length,body:body};}}\nthrow new Error(\"Broken JSON number body near \"+body);}\nif(str[pos]===\"{\"||str[pos]===\"[\"){var stack=[str[pos]];var body=str[pos];for(var i=pos+1;i<str.length;i++){body+=str[i];if(str[i]===\"\\\\\"){if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===\"\\\"\"){if(stack[stack.length-1]===\"\\\"\"){stack.pop();}else if(stack[stack.length-1]!==\"'\"){stack.push(str[i]);}}else if(str[i]===\"'\"){if(stack[stack.length-1]===\"'\"){stack.pop();}else if(stack[stack.length-1]!==\"\\\"\"){stack.push(str[i]);}}else if(stack[stack.length-1]!==\"\\\"\"&&stack[stack.length-1]!==\"'\"){if(str[i]===\"{\"){stack.push(\"{\");}else if(str[i]===\"}\"){if(stack[stack.length-1]===\"{\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}else if(str[i]===\"[\"){stack.push(\"[\");}else if(str[i]===\"]\"){if(stack[stack.length-1]===\"[\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}}\nif(!stack.length){return{originLength:i-pos,body:body};}}\nthrow new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}\nthrow new Error(\"Broken JSON body near \"+str.substr((pos-5>=0)?pos-5:0,50));}\nfunction canBeKeyHead(ch){if(ch[0]===\"\\\\\")return false;if((ch[0]>='a'&&ch[0]<='z')||(ch[0]>='A'&&ch[0]<='Z')||ch[0]==='_')return true;if(ch[0]>='0'&&ch[0]<='9')return true;if(ch[0]==='$')return true;if(ch.charCodeAt(0)>255)return true;return false;}\nfunction isBlankChar(ch){return ch===\" \"||ch===\"\\n\"||ch===\"\\t\";}\nfunction parse(str){str=str.trim();if(!str.length)throw new Error(\"Broken JSON object.\");var result=\"\";while(str&&str[0]===\",\"){str=str.substr(1);}\nif(str[0]===\"\\\"\"||str[0]===\"'\"){if(str[str.length-1]!==str[0]){throw new Error(\"Invalid string JSON object.\");}\nvar body=\"\\\"\";for(var i=1;i<str.length;i++){if(str[i]===\"\\\\\"){if(str[i+1]===\"'\"){body+=str[i+1]}else{body+=str[i];body+=str[i+1];}\ni++;}else if(str[i]===str[0]){body+=\"\\\"\";return body}else if(str[i]===\"\\\"\"){body+=\"\\\\\\\"\"}else body+=str[i];}\nthrow new Error(\"Invalid string JSON object.\");}\nif(str===\"true\"||str===\"false\"){return str;}\nif(str===\"null\"){return\"null\";}\nvar num=parseFloat(str);if(!isNaN(num)){return num.toString();}\nif(str[0]===\"{\"){var type=\"needKey\";var result=\"{\";for(var i=1;i<str.length;i++){if(isBlankChar(str[i])){continue;}else if(type===\"needKey\"&&(str[i]===\"\\\"\"||str[i]===\"'\")){var key=parseKey(str,i+1,str[i]);result+=\"\\\"\"+key+\"\\\"\";i+=key.length;i+=1;type=\"afterKey\";}else if(type===\"needKey\"&&canBeKeyHead(str[i])){var key=parseKey(str,i);result+=\"\\\"\";result+=key;result+=\"\\\"\";i+=key.length-1;type=\"afterKey\";}else if(type===\"afterKey\"&&str[i]===\":\"){result+=\":\";type=\":\";}else if(type===\":\"){var body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"||type===\"needKey\"){var last=i;while(str[last]===\",\"||isBlankChar(str[last])){last++;}\nif(str[last]===\"}\"&&last===str.length-1){while(result[result.length-1]===\",\"){result=result.substr(0,result.length-1);}\nresult+=\"}\";return result;}else if(last!==i&&result!==\"{\"){result+=\",\";type=\"needKey\";i=last-1;}}}\nthrow new Error(\"Broken JSON object near \"+result);}\nif(str[0]===\"[\"){var result=\"[\";var type=\"needBody\";for(var i=1;i<str.length;i++){if(\" \"===str[i]||\"\\n\"===str[i]||\"\\t\"===str[i]){continue;}else if(type===\"needBody\"){if(str[i]===\",\"){result+=\"null,\";continue;}\nif(str[i]===\"]\"&&i===str.length-1){if(result[result.length-1]===\",\")result=result.substr(0,result.length-1);result+=\"]\";return result;}\nvar body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"){if(str[i]===\",\"){result+=\",\";type=\"needBody\";while(str[i+1]===\",\"||isBlankChar(str[i+1])){if(str[i+1]===\",\")result+=\"null,\";i++;}}else if(str[i]===\"]\"&&i===str.length-1){result+=\"]\";return result;}}}\nthrow new Error(\"Broken JSON array near \"+result);}}\nwindow.ocJSON=function(json){var jsonString=parse(json);return JSON.parse(jsonString);};}(window);+function($){\"use strict\";if($.oc===undefined)\n$.oc={}\nvar LOADER_CLASS='oc-loading';$(document).on('ajaxSetup','[data-request][data-request-flash]',function(event,context){context.options.handleErrorMessage=function(message){$.oc.flashMsg({text:message,class:'error'})}\ncontext.options.handleFlashMessage=function(message,type){$.oc.flashMsg({text:message,class:type})}})\n$(document).on('ajaxValidation','[data-request][data-request-validate]',function(event,context,errorMsg,fields){var $this=$(this).closest('form'),$container=$('[data-validate-error]',$this),messages=[],$field\n$.each(fields,function(fieldName,fieldMessages){$field=$('[data-validate-for=\"'+fieldName+'\"]',$this)\nmessages=$.merge(messages,fieldMessages)\nif(!!$field.length){if(!$field.text().length||$field.data('emptyMode')==true){$field.data('emptyMode',true).text(fieldMessages.join(', '))}\n$field.addClass('visible')}})\nif(!!$container.length){$container=$('[data-validate-error]',$this)}\nif(!!$container.length){var $oldMessages=$('[data-message]',$container)\n$container.addClass('visible')\nif(!!$oldMessages.length){var $clone=$oldMessages.first()\n$.each(messages,function(key,message){$clone.clone().text(message).insertAfter($clone)})\n$oldMessages.remove()}\nelse{$container.text(errorMsg)}}\n$this.one('ajaxError',function(event){event.preventDefault()})})\n$(document).on('ajaxPromise','[data-request][data-request-validate]',function(){var $this=$(this).closest('form')\n$('[data-validate-for]',$this).removeClass('visible')\n$('[data-validate-error]',$this).removeClass('visible')})\n$(document).on('ajaxPromise','[data-request]',function(){var $target=$(this)\nif($target.data('attach-loading')!==undefined){$target.addClass(LOADER_CLASS).prop('disabled',true)}\nif($target.is('form')){$('[data-attach-loading]',$target).addClass(LOADER_CLASS).prop('disabled',true)}}).on('ajaxFail ajaxDone','[data-request]',function(){var $target=$(this)\nif($target.data('attach-loading')!==undefined){$target.removeClass(LOADER_CLASS).prop('disabled',false)}\nif($target.is('form')){$('[data-attach-loading]',$target).removeClass(LOADER_CLASS).prop('disabled',false)}})\nvar StripeLoadIndicator=function(){var self=this\nthis.counter=0\nthis.indicator=$('<div/>').addClass('stripe-loading-indicator loaded').append($('<div />').addClass('stripe')).append($('<div />').addClass('stripe-loaded'))\nthis.stripe=this.indicator.find('.stripe')\n$(document).ready(function(){$(document.body).append(self.indicator)})}\nStripeLoadIndicator.prototype.show=function(){this.counter++\nthis.stripe.after(this.stripe=this.stripe.clone()).remove()\nif(this.counter>1){return}\nthis.indicator.removeClass('loaded')\n$(document.body).addClass('oc-loading')}\nStripeLoadIndicator.prototype.hide=function(force){this.counter--\nif(force!==undefined&&force){this.counter=0}\nif(this.counter<=0){this.indicator.addClass('loaded')\n$(document.body).removeClass('oc-loading')}}\n$.oc.stripeLoadIndicator=new StripeLoadIndicator()\n$(document).on('ajaxPromise','[data-request]',function(event){event.stopPropagation()\n$.oc.stripeLoadIndicator.show()\nvar $el=$(this)\n$(window).one('ajaxUpdateComplete',function(){if($el.closest('html').length===0)\n$.oc.stripeLoadIndicator.hide()})}).on('ajaxFail ajaxDone','[data-request]',function(event){event.stopPropagation()\n$.oc.stripeLoadIndicator.hide()})\nvar FlashMessage=function(options,el){var\noptions=$.extend({},FlashMessage.DEFAULTS,options),$element=$(el)\n$('body > p.flash-message').remove()\nif($element.length==0){$element=$('<p />').addClass(options.class).html(options.text)}\n$element.addClass('flash-message fade').attr('data-control',null).on('click','button',remove).on('click',remove).append('<button type=\"button\" class=\"close\" aria-hidden=\"true\">&times;</button>')\n$(document.body).append($element)\nsetTimeout(function(){$element.addClass('in')},100)\nvar timer=window.setTimeout(remove,options.interval*1000)\nfunction removeElement(){$element.remove()}\nfunction remove(){window.clearInterval(timer)\n$element.removeClass('in')\n$.support.transition&&$element.hasClass('fade')?$element.one($.support.transition.end,removeElement).emulateTransitionEnd(500):removeElement()}}\nFlashMessage.DEFAULTS={class:'success',text:'Default text',interval:5}\nif($.oc===undefined)\n$.oc={}\n$.oc.flashMsg=FlashMessage\n$(document).render(function(){$('[data-control=flash-message]').each(function(){$.oc.flashMsg($(this).data(),this)})})}(window.jQuery);", "/* ========================================================================\n * OctoberCMS: front-end JavaScript framework\n * http://octobercms.com\n * ========================================================================\n * Copyright 2016-2020 Alexey Bobkov, Samuel Georges\n * ======================================================================== */\n\nif (window.jQuery === undefined) {\n    throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');\n}\nif (window.jQuery.request !== undefined) {\n    throw new Error('The OctoberCMS framework is already loaded.');\n}\n\n+function ($) { \"use strict\";\n\n    var Request = function (element, handler, options) {\n        var $el = this.$el = $(element);\n        this.options = options || {};\n\n        /*\n         * Validate handler name\n         */\n        if (handler === undefined) {\n            throw new Error('The request handler name is not specified.')\n        }\n\n        if (!handler.match(/^(?:\\w+\\:{2})?on*/)) {\n            throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')\n        }\n\n        /*\n         * Prepare the options\n         */\n        var $form = options.form ? $(options.form) : $el.closest('form'),\n            $triggerEl = !!$form.length ? $form : $el,\n            context = { handler: handler, options: options }\n\n        /*\n         * Validate the form client-side\n         */\n        if ((options.browserValidate !== undefined) && typeof document.createElement('input').reportValidity == 'function' && $form && $form[0] && !$form[0].checkValidity()) {\n            $form[0].reportValidity();\n            return false;\n        }\n\n        /*\n         * Execute the request\n         */\n        $el.trigger('ajaxSetup', [context])\n        var _event = jQuery.Event('oc.beforeRequest')\n        $triggerEl.trigger(_event, context)\n        if (_event.isDefaultPrevented()) return\n\n        var loading = options.loading !== undefined ? options.loading : null,\n            url = options.url !== undefined ? options.url : window.location.href,\n            isRedirect = options.redirect !== undefined && options.redirect.length,\n            useFlash = options.flash !== undefined,\n            useFiles = options.files !== undefined\n\n        if (useFiles && typeof FormData === 'undefined') {\n            console.warn('This browser does not support file uploads via FormData')\n            useFiles = false\n        }\n\n        if ($.type(loading) == 'string') {\n            loading = $(loading)\n        }\n\n        /*\n         * Request headers\n         */\n        var requestHeaders = {\n            'X-OCTOBER-REQUEST-HANDLER': handler,\n            'X-OCTOBER-REQUEST-PARTIALS': this.extractPartials(options.update)\n        }\n\n        if (useFlash) {\n            requestHeaders['X-OCTOBER-REQUEST-FLASH'] = 1\n        }\n\n        var csrfToken = getXSRFToken()\n        if (csrfToken) {\n            requestHeaders['X-XSRF-TOKEN'] = csrfToken\n        }\n\n        /*\n         * Request data\n         */\n        var requestData,\n            inputName,\n            data = {}\n\n        $.each($el.parents('[data-request-data]').toArray().reverse(), function extendRequest() {\n            $.extend(data, paramToObj('data-request-data', $(this).data('request-data')))\n        })\n\n        if ($el.is(':input') && !$form.length) {\n            inputName = $el.attr('name')\n            if (inputName !== undefined && options.data[inputName] === undefined) {\n                options.data[inputName] = $el.val()\n            }\n        }\n\n        if (options.data !== undefined && !$.isEmptyObject(options.data)) {\n            $.extend(data, options.data)\n        }\n\n        if (useFiles) {\n            requestData = new FormData($form.length ? $form.get(0) : undefined)\n\n            if ($el.is(':file') && inputName) {\n                $.each($el.prop('files'), function() {\n                    requestData.append(inputName, this)\n                })\n\n                delete data[inputName]\n            }\n\n            $.each(data, function(key) {\n                if (typeof Blob !== \"undefined\" && this instanceof Blob && this.filename) {\n                    requestData.append(key, this, this.filename)\n                } else {\n                    requestData.append(key, this)\n                }\n            })\n        }\n        else {\n            requestData = [$form.serialize(), $.param(data)].filter(Boolean).join('&')\n        }\n\n        /*\n         * Request options\n         */\n        var requestOptions = {\n            url: url,\n            crossDomain: false,\n            global: options.ajaxGlobal,\n            context: context,\n            headers: requestHeaders,\n            success: function(data, textStatus, jqXHR) {\n                /*\n                 * Halt here if beforeUpdate() or data-request-before-update returns false\n                 */\n                if (this.options.beforeUpdate.apply(this, [data, textStatus, jqXHR]) === false) return\n                if (options.evalBeforeUpdate && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))') === false) return\n\n                /*\n                 * Trigger 'ajaxBeforeUpdate' on the form, halt if event.preventDefault() is called\n                 */\n                var _event = jQuery.Event('ajaxBeforeUpdate')\n                $triggerEl.trigger(_event, [context, data, textStatus, jqXHR])\n                if (_event.isDefaultPrevented()) return\n\n                if (useFlash && data['X_OCTOBER_FLASH_MESSAGES']) {\n                    $.each(data['X_OCTOBER_FLASH_MESSAGES'], function(type, message) {\n                        requestOptions.handleFlashMessage(message, type)\n                    })\n                }\n\n                /*\n                 * Proceed with the update process\n                 */\n                var updatePromise = requestOptions.handleUpdateResponse(data, textStatus, jqXHR)\n\n                updatePromise.done(function() {\n                    $triggerEl.trigger('ajaxSuccess', [context, data, textStatus, jqXHR])\n                    options.evalSuccess && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')\n                })\n\n                return updatePromise\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n                var errorMsg,\n                    updatePromise = $.Deferred()\n\n                if ((window.ocUnloading !== undefined && window.ocUnloading) || errorThrown == 'abort')\n                    return\n\n                /*\n                 * Disable redirects\n                 */\n                isRedirect = false\n                options.redirect = null\n\n                /*\n                 * Error 406 is a \"smart error\" that returns response object that is\n                 * processed in the same fashion as a successful response.\n                 */\n                if (jqXHR.status == 406 && jqXHR.responseJSON) {\n                    errorMsg = jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\n                    updatePromise = requestOptions.handleUpdateResponse(jqXHR.responseJSON, textStatus, jqXHR)\n                }\n                /*\n                 * Standard error with standard response text\n                 */\n                else {\n                    errorMsg = jqXHR.responseText ? jqXHR.responseText : jqXHR.statusText\n                    updatePromise.resolve()\n                }\n\n                updatePromise.done(function() {\n                    $el.data('error-message', errorMsg)\n\n                    /*\n                     * Trigger 'ajaxError' on the form, halt if event.preventDefault() is called\n                     */\n                    var _event = jQuery.Event('ajaxError')\n                    $triggerEl.trigger(_event, [context, errorMsg, textStatus, jqXHR])\n                    if (_event.isDefaultPrevented()) return\n\n                    /*\n                     * Halt here if the data-request-error attribute returns false\n                     */\n                    if (options.evalError && eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))') === false)\n                        return\n\n                    requestOptions.handleErrorMessage(errorMsg)\n                })\n\n                return updatePromise\n            },\n            complete: function(data, textStatus, jqXHR) {\n                $triggerEl.trigger('ajaxComplete', [context, data, textStatus, jqXHR])\n                options.evalComplete && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')\n            },\n\n            /*\n             * Custom function, requests confirmation from the user\n             */\n            handleConfirmMessage: function(message) {\n                var _event = jQuery.Event('ajaxConfirmMessage')\n\n                _event.promise = $.Deferred()\n                if ($(window).triggerHandler(_event, [message]) !== undefined) {\n                    _event.promise.done(function() {\n                        options.confirm = null\n                        new Request(element, handler, options)\n                    })\n                    return false\n                }\n\n                if (_event.isDefaultPrevented()) return\n                if (message) return confirm(message)\n            },\n\n            /*\n             * Custom function, display an error message to the user\n             */\n            handleErrorMessage: function(message) {\n                var _event = jQuery.Event('ajaxErrorMessage')\n                $(window).trigger(_event, [message])\n                if (_event.isDefaultPrevented()) return\n                if (message) alert(message)\n            },\n\n            /*\n             * Custom function, focus fields with errors\n             */\n            handleValidationMessage: function(message, fields) {\n                $triggerEl.trigger('ajaxValidation', [context, message, fields])\n\n                var isFirstInvalidField = true\n                $.each(fields, function focusErrorField(fieldName, fieldMessages) {\n                    fieldName = fieldName.replace(/\\.(\\w+)/g, '[$1]')\n\n                    var fieldElement = $form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\n                    if (fieldElement.length > 0) {\n\n                        var _event = jQuery.Event('ajaxInvalidField')\n                        $(window).trigger(_event, [fieldElement.get(0), fieldName, fieldMessages, isFirstInvalidField])\n\n                        if (isFirstInvalidField) {\n                            if (!_event.isDefaultPrevented()) fieldElement.focus()\n                            isFirstInvalidField = false\n                        }\n                    }\n                })\n            },\n\n            /*\n             * Custom function, display a flash message to the user\n             */\n            handleFlashMessage: function(message, type) {},\n\n            /*\n             * Custom function, redirect the browser to another location\n             */\n            handleRedirectResponse: function(url) {\n                window.location.assign(url)\n            },\n\n            /*\n             * Custom function, handle any application specific response values\n             * Using a promisary object here in case injected assets need time to load\n             */\n            handleUpdateResponse: function(data, textStatus, jqXHR) {\n\n                /*\n                 * Update partials and finish request\n                 */\n                var updatePromise = $.Deferred().done(function() {\n                    for (var partial in data) {\n                        /*\n                         * If a partial has been supplied on the client side that matches the server supplied key, look up\n                         * it's selector and use that. If not, we assume it is an explicit selector reference.\n                         */\n                        var selector = (options.update[partial]) ? options.update[partial] : partial\n                        if ($.type(selector) == 'string' && selector.charAt(0) == '@') {\n                            $(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                        else if ($.type(selector) == 'string' && selector.charAt(0) == '^') {\n                            $(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                        else {\n                            $(selector).trigger('ajaxBeforeReplace')\n                            $(selector).html(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                    }\n\n                    /*\n                     * Wait for .html() method to finish rendering from partial updates\n                     */\n                    setTimeout(function() {\n                        $(window)\n                            .trigger('ajaxUpdateComplete', [context, data, textStatus, jqXHR])\n                            .trigger('resize')\n                    }, 0)\n                })\n\n                /*\n                 * Handle redirect\n                 */\n                if (data['X_OCTOBER_REDIRECT']) {\n                    options.redirect = data['X_OCTOBER_REDIRECT']\n                    isRedirect = true\n                }\n\n                if (isRedirect) {\n                    requestOptions.handleRedirectResponse(options.redirect)\n                }\n\n                /*\n                 * Handle validation\n                 */\n                if (data['X_OCTOBER_ERROR_FIELDS']) {\n                    requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'], data['X_OCTOBER_ERROR_FIELDS'])\n                }\n\n                /*\n                 * Handle asset injection\n                 */\n                 if (data['X_OCTOBER_ASSETS']) {\n                    assetManager.load(data['X_OCTOBER_ASSETS'], $.proxy(updatePromise.resolve, updatePromise))\n                 }\n                 else {\n                    updatePromise.resolve()\n                }\n\n                return updatePromise\n            }\n        }\n\n        if (useFiles) {\n            requestOptions.processData = requestOptions.contentType = false\n        }\n\n        /*\n         * Allow default business logic to be called from user functions\n         */\n        context.success = requestOptions.success\n        context.error = requestOptions.error\n        context.complete = requestOptions.complete\n        requestOptions = $.extend(requestOptions, options)\n        requestOptions.data = requestData\n\n        /*\n         * Initiate request\n         */\n        if (options.confirm && !requestOptions.handleConfirmMessage(options.confirm)) {\n            return\n        }\n\n        if (loading) loading.show()\n        $(window).trigger('ajaxBeforeSend', [context])\n        $el.trigger('ajaxPromise', [context])\n\n        return $.ajax(requestOptions)\n            .fail(function(jqXHR, textStatus, errorThrown) {\n                if (!isRedirect) {\n                    $el.trigger('ajaxFail', [context, textStatus, jqXHR])\n                }\n                if (loading) loading.hide()\n            })\n            .done(function(data, textStatus, jqXHR) {\n                if (!isRedirect) {\n                    $el.trigger('ajaxDone', [context, data, textStatus, jqXHR])\n                }\n                if (loading) loading.hide()\n            })\n            .always(function(dataOrXhr, textStatus, xhrOrError) {\n                $el.trigger('ajaxAlways', [context, dataOrXhr, textStatus, xhrOrError])\n            })\n    }\n\n    Request.DEFAULTS = {\n        update: {},\n        type : 'POST',\n        beforeUpdate: function(data, textStatus, jqXHR) {},\n        evalBeforeUpdate: null,\n        evalSuccess: null,\n        evalError: null,\n        evalComplete: null,\n        ajaxGlobal: false\n    }\n\n    /*\n     * Internal function, build a string of partials and their update elements.\n     */\n    Request.prototype.extractPartials = function(update) {\n        var result = []\n\n        for (var partial in update)\n            result.push(partial)\n\n        return result.join('&')\n    }\n\n    // REQUEST PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.request\n\n    $.fn.request = function(handler, option) {\n        var args = arguments\n\n        var $this = $(this).first()\n        var data  = {\n            evalBeforeUpdate: $this.data('request-before-update'),\n            evalSuccess: $this.data('request-success'),\n            evalError: $this.data('request-error'),\n            evalComplete: $this.data('request-complete'),\n            ajaxGlobal: $this.data('request-ajax-global'),\n            confirm: $this.data('request-confirm'),\n            redirect: $this.data('request-redirect'),\n            loading: $this.data('request-loading'),\n            flash: $this.data('request-flash'),\n            files: $this.data('request-files'),\n            browserValidate: $this.data('browser-validate'),\n            form: $this.data('request-form'),\n            url: $this.data('request-url'),\n            update: paramToObj('data-request-update', $this.data('request-update')),\n            data: paramToObj('data-request-data', $this.data('request-data'))\n        }\n        if (!handler) handler = $this.data('request')\n        var options = $.extend(true, {}, Request.DEFAULTS, data, typeof option == 'object' && option)\n        return new Request($this, handler, options)\n    }\n\n    $.fn.request.Constructor = Request\n\n    $.request = function(handler, option) {\n        return $(document).request(handler, option)\n    }\n\n    // REQUEST NO CONFLICT\n    // =================\n\n    $.fn.request.noConflict = function() {\n        $.fn.request = old\n        return this\n    }\n\n    // REQUEST DATA-API\n    // ==============\n\n    function paramToObj(name, value) {\n        if (value === undefined) value = ''\n        if (typeof value == 'object') return value\n\n        try {\n            return ocJSON(\"{\" + value + \"}\")\n        }\n        catch (e) {\n            throw new Error('Error parsing the '+name+' attribute value. '+e)\n        }\n    }\n\n    function getXSRFToken() {\n        var cookieValue = null\n        if (document.cookie && document.cookie != '') {\n            var cookies = document.cookie.split(';')\n            for (var i = 0; i < cookies.length; i++) {\n                var cookie = jQuery.trim(cookies[i])\n                if (cookie.substring(0, 11) == ('XSRF-TOKEN' + '=')) {\n                    cookieValue = decodeURIComponent(cookie.substring(11))\n                    break\n                }\n            }\n        }\n        return cookieValue\n    }\n\n    $(document).on('change', 'select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]', function documentOnChange() {\n        $(this).request()\n    })\n\n    $(document).on('click', 'a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]', function documentOnClick(e) {\n        e.preventDefault()\n\n        $(this).request()\n\n        if ($(this).is('[type=submit]'))\n            return false\n    })\n\n    $(document).on('keydown', 'input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]', function documentOnKeydown(e) {\n        if (e.key === 'Enter') {\n            if (this.dataTrackInputTimer !== undefined)\n                window.clearTimeout(this.dataTrackInputTimer)\n\n            $(this).request()\n            return false\n        }\n    })\n\n    $(document).on('input', 'input[data-request][data-track-input]', function documentOnKeyup(e) {\n        var\n            $el = $(this),\n            lastValue = $el.data('oc.lastvalue')\n\n        if (!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\n            return\n\n        if (lastValue !== undefined && lastValue == this.value)\n            return\n\n        $el.data('oc.lastvalue', this.value)\n\n        if (this.dataTrackInputTimer !== undefined)\n            window.clearTimeout(this.dataTrackInputTimer)\n\n        var interval = $(this).data('track-input')\n        if (!interval)\n            interval = 300\n\n        var self = this\n        this.dataTrackInputTimer = window.setTimeout(function() {\n            if (self.lastDataTrackInputRequest) {\n                self.lastDataTrackInputRequest.abort();\n            }\n            self.lastDataTrackInputRequest = $(self).request();\n        }, interval)\n    })\n\n    $(document).on('submit', '[data-request]', function documentOnSubmit() {\n        $(this).request()\n        return false\n    })\n\n    $(window).on('beforeunload', function documentOnBeforeUnload() {\n        window.ocUnloading = true\n    })\n\n    /*\n     * Invent our own event that unifies document.ready with window.ajaxUpdateComplete\n     *\n     * $(document).render(function() { })\n     * $(document).on('render', function() { })\n     */\n\n    $(document).ready(function triggerRenderOnReady() {\n        $(document).trigger('render')\n    })\n\n    $(window).on('ajaxUpdateComplete', function triggerRenderOnAjaxUpdateComplete() {\n        $(document).trigger('render')\n    })\n\n    $.fn.render = function(callback) {\n        $(document).on('render', callback)\n    }\n\n}(window.jQuery);\n\n/*\n * October CMS JSON Parser\n */\n+function(window) { \"use strict\";\n    function parseKey(str, pos, quote) {\n        var key = \"\";\n        for (var i = pos; i < str.length; i++) {\n            if (quote && quote === str[i]) {\n                return key;\n            } else if (!quote && (str[i] === \" \" || str[i] === \":\")) {\n                return key;\n            }\n\n            key += str[i];\n\n            if (str[i] === \"\\\\\" && i + 1 < str.length) {\n                key += str[i + 1];\n                i++;\n            }\n        }\n        throw new Error(\"Broken JSON syntax near \" + key);\n    }\n\n    function getBody(str, pos) {\n        // parse string body\n        if (str[pos] === \"\\\"\" || str[pos] === \"'\") {\n            var body = str[pos];\n            for (var i = pos + 1; i < str.length; i++) {\n                if (str[i] === \"\\\\\") {\n                    body += str[i];\n                    if (i + 1 < str.length) body += str[i + 1];\n                    i++;\n                } else if (str[i] === str[pos]) {\n                    body += str[pos];\n                    return {\n                        originLength: body.length,\n                        body: body\n                    };\n                } else body += str[i];\n            }\n            throw new Error(\"Broken JSON string body near \" + body);\n        }\n\n        // parse true / false\n        if (str[pos] === \"t\") {\n            if (str.indexOf(\"true\", pos) === pos) {\n                return {\n                    originLength: \"true\".length,\n                    body: \"true\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n        if (str[pos] === \"f\") {\n            if (str.indexOf(\"f\", pos) === pos) {\n                return {\n                    originLength: \"false\".length,\n                    body: \"false\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n\n        // parse null\n        if (str[pos] === \"n\") {\n            if (str.indexOf(\"null\", pos) === pos) {\n                return {\n                    originLength: \"null\".length,\n                    body: \"null\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n\n        // parse number\n        if (str[pos] === \"-\" || str[pos] === \"+\" || str[pos] === \".\" || (str[pos] >= \"0\" && str[pos] <= \"9\")) {\n            var body = \"\";\n            for (var i = pos; i < str.length; i++) {\n                if (str[i] === \"-\" || str[i] === \"+\" || str[i] === \".\" || (str[i] >= \"0\" && str[i] <= \"9\")) {\n                    body += str[i];\n                } else {\n                    return {\n                        originLength: body.length,\n                        body: body\n                    };\n                }\n            }\n            throw new Error(\"Broken JSON number body near \" + body);\n        }\n\n        // parse object\n        if (str[pos] === \"{\" || str[pos] === \"[\") {\n            var stack = [str[pos]];\n            var body = str[pos];\n            for (var i = pos + 1; i < str.length; i++) {\n                body += str[i];\n                if (str[i] === \"\\\\\") {\n                    if (i + 1 < str.length) body += str[i + 1];\n                    i++;\n                } else if (str[i] === \"\\\"\") {\n                    if (stack[stack.length - 1] === \"\\\"\") {\n                        stack.pop();\n                    } else if (stack[stack.length - 1] !== \"'\") {\n                        stack.push(str[i]);\n                    }\n                } else if (str[i] === \"'\") {\n                    if (stack[stack.length - 1] === \"'\") {\n                        stack.pop();\n                    } else if (stack[stack.length - 1] !== \"\\\"\") {\n                        stack.push(str[i]);\n                    }\n                } else if (stack[stack.length - 1] !== \"\\\"\" && stack[stack.length - 1] !== \"'\") {\n                    if (str[i] === \"{\") {\n                        stack.push(\"{\");\n                    } else if (str[i] === \"}\") {\n                        if (stack[stack.length - 1] === \"{\") {\n                            stack.pop();\n                        } else {\n                            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n                        }\n                    } else if (str[i] === \"[\") {\n                        stack.push(\"[\");\n                    } else if (str[i] === \"]\") {\n                        if (stack[stack.length - 1] === \"[\") {\n                            stack.pop();\n                        } else {\n                            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n                        }\n                    }\n                }\n                if (!stack.length) {\n                    return {\n                        originLength: i - pos,\n                        body: body\n                    };\n                }\n            }\n            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n        }\n        throw new Error(\"Broken JSON body near \" + str.substr((pos - 5 >= 0) ? pos - 5 : 0, 50));\n    }\n\n    function canBeKeyHead(ch) {\n        if (ch[0] === \"\\\\\") return false;\n        if ((ch[0] >= 'a' && ch[0] <= 'z') || (ch[0] >= 'A' && ch[0] <= 'Z') || ch[0] === '_') return true;\n        if (ch[0] >= '0' && ch[0] <= '9') return true;\n        if (ch[0] === '$') return true;\n        if (ch.charCodeAt(0) > 255) return true;\n        return false;\n    }\n\n    function isBlankChar(ch) {\n        return ch === \" \" || ch === \"\\n\" || ch === \"\\t\";\n    }\n\n    function parse(str) {\n        str = str.trim();\n        if (!str.length) throw new Error(\"Broken JSON object.\");\n        var result = \"\";\n\n        /*\n         * the mistake ','\n         */\n        while (str && str[0] === \",\") {\n            str = str.substr(1);\n        }\n\n        /*\n         * string\n         */\n        if (str[0] === \"\\\"\" || str[0] === \"'\") {\n            if (str[str.length - 1] !== str[0]) {\n                throw new Error(\"Invalid string JSON object.\");\n            }\n\n            var body = \"\\\"\";\n            for (var i = 1; i < str.length; i++) {\n                if (str[i] === \"\\\\\") {\n                    if (str[i + 1] === \"'\") {\n                        body += str[i + 1]\n                    } else {\n                        body += str[i];\n                        body += str[i + 1];\n                    }\n                    i++;\n                } else if (str[i] === str[0]) {\n                    body += \"\\\"\";\n                    return body\n                } else if (str[i] === \"\\\"\") {\n                    body += \"\\\\\\\"\"\n                } else body += str[i];\n            }\n            throw new Error(\"Invalid string JSON object.\");\n        }\n\n        /*\n         * boolean\n         */\n        if (str === \"true\" || str === \"false\") {\n            return str;\n        }\n\n        /*\n         * null\n         */\n        if (str === \"null\") {\n            return \"null\";\n        }\n\n        /*\n         * number\n         */\n        var num = parseFloat(str);\n        if (!isNaN(num)) {\n            return num.toString();\n        }\n\n        /*\n         * object\n         */\n        if (str[0] === \"{\") {\n            var type = \"needKey\";\n            var result = \"{\";\n\n            for (var i = 1; i < str.length; i++) {\n                if (isBlankChar(str[i])) {\n                    continue;\n                } else if (type === \"needKey\" && (str[i] === \"\\\"\" || str[i] === \"'\")) {\n                    var key = parseKey(str, i + 1, str[i]);\n                    result += \"\\\"\" + key + \"\\\"\";\n                    i += key.length;\n                    i += 1;\n                    type = \"afterKey\";\n                } else if (type === \"needKey\" && canBeKeyHead(str[i])) {\n                    var key = parseKey(str, i);\n                    result += \"\\\"\";\n                    result += key;\n                    result += \"\\\"\";\n                    i += key.length - 1;\n                    type = \"afterKey\";\n                } else if (type === \"afterKey\" && str[i] === \":\") {\n                    result += \":\";\n                    type = \":\";\n                } else if (type === \":\") {\n                    var body = getBody(str, i);\n\n                    i = i + body.originLength - 1;\n                    result += parse(body.body);\n\n                    type = \"afterBody\";\n                } else if (type === \"afterBody\" || type === \"needKey\") {\n                    var last = i;\n                    while (str[last] === \",\" || isBlankChar(str[last])) {\n                        last++;\n                    }\n                    if (str[last] === \"}\" && last === str.length - 1) {\n                        while (result[result.length - 1] === \",\") {\n                            result = result.substr(0, result.length - 1);\n                        }\n                        result += \"}\";\n                        return result;\n                    } else if (last !== i && result !== \"{\") {\n                        result += \",\";\n                        type = \"needKey\";\n                        i = last - 1;\n                    }\n                }\n            }\n            throw new Error(\"Broken JSON object near \" + result);\n        }\n\n        /*\n         * array\n         */\n        if (str[0] === \"[\") {\n            var result = \"[\";\n            var type = \"needBody\";\n            for (var i = 1; i < str.length; i++) {\n                if (\" \" === str[i] || \"\\n\" === str[i] || \"\\t\" === str[i]) {\n                    continue;\n                } else if (type === \"needBody\") {\n                    if (str[i] === \",\") {\n                        result += \"null,\";\n                        continue;\n                    }\n                    if (str[i] === \"]\" && i === str.length - 1) {\n                        if (result[result.length - 1] === \",\") result = result.substr(0, result.length - 1);\n                        result += \"]\";\n                        return result;\n                    }\n\n                    var body = getBody(str, i);\n\n                    i = i + body.originLength - 1;\n                    result += parse(body.body);\n\n                    type = \"afterBody\";\n                } else if (type === \"afterBody\") {\n                    if (str[i] === \",\") {\n                        result += \",\";\n                        type = \"needBody\";\n\n                        // deal with mistake \",\"\n                        while (str[i + 1] === \",\" || isBlankChar(str[i + 1])) {\n                            if (str[i + 1] === \",\") result += \"null,\";\n                            i++;\n                        }\n                    } else if (str[i] === \"]\" && i === str.length - 1) {\n                        result += \"]\";\n                        return result;\n                    }\n                }\n            }\n            throw new Error(\"Broken JSON array near \" + result);\n        }\n    }\n\n    // Global function\n    window.ocJSON = function(json) {\n        var jsonString = parse(json);\n        return JSON.parse(jsonString);\n    };\n\n}(window);\n"], "fixing_code": ["/*\n * MediaFinder plugin\n *\n * Data attributes:\n * - data-control=\"mediafinder\" - enables the plugin on an element\n * - data-option=\"value\" - an option with a value\n *\n * JavaScript API:\n * $('a#someElement').mediaFinder({ option: 'value' })\n *\n * Dependences:\n * - Some other plugin (filename.js)\n */\n\n+function ($) { \"use strict\";\n    var Base = $.oc.foundation.base,\n        BaseProto = Base.prototype\n\n    var MediaFinder = function (element, options) {\n        this.$el = $(element)\n        this.options = options || {}\n\n        $.oc.foundation.controlUtils.markDisposable(element)\n        Base.call(this)\n        this.init()\n    }\n\n    MediaFinder.prototype = Object.create(BaseProto)\n    MediaFinder.prototype.constructor = MediaFinder\n\n    MediaFinder.prototype.init = function() {\n        if (this.options.isMulti === null) {\n            this.options.isMulti = this.$el.hasClass('is-multi')\n        }\n\n        if (this.options.isPreview === null) {\n            this.options.isPreview = this.$el.hasClass('is-preview')\n        }\n\n        if (this.options.isImage === null) {\n            this.options.isImage = this.$el.hasClass('is-image')\n        }\n\n        this.$el.one('dispose-control', this.proxy(this.dispose))\n\n        if (this.options.thumbnailWidth > 0) {\n            this.$el.css('maxWidth', this.options.thumbnailWidth + 'px')\n        }\n\n        else if (this.options.thumbnailHeight > 0) {\n            this.$el.css('maxHeight', this.options.thumbnailHeight + 'px')\n        }\n\n        // Stop here for preview mode\n        if (this.options.isPreview) {\n            return\n        }\n\n        this.$el.on('click', '.find-button', this.proxy(this.onClickFindButton))\n        this.$el.on('click', '.find-remove-button', this.proxy(this.onClickRemoveButton))\n\n        this.$findValue = $('[data-find-value]', this.$el)\n    }\n\n    MediaFinder.prototype.dispose = function() {\n        this.$el.off('click', '.find-button', this.proxy(this.onClickFindButton))\n        this.$el.off('click', '.find-remove-button', this.proxy(this.onClickRemoveButton))\n        this.$el.off('dispose-control', this.proxy(this.dispose))\n        this.$el.removeData('oc.mediaFinder')\n\n        this.$findValue = null\n        this.$el = null\n\n        // In some cases options could contain callbacks,\n        // so it's better to clean them up too.\n        this.options = null\n\n        BaseProto.dispose.call(this)\n    }\n\n    MediaFinder.prototype.setValue = function(value) {\n        // set value and trigger change event, so that wrapping implementations\n        // like mlmediafinder can listen for changes.\n        this.$findValue.val(value).trigger('change')\n    }\n\n    MediaFinder.prototype.onClickRemoveButton = function() {\n        this.setValue('')\n\n        this.evalIsPopulated()\n    }\n\n    MediaFinder.prototype.onClickFindButton = function() {\n        var self = this\n\n        new $.oc.mediaManager.popup({\n            alias: 'ocmediamanager',\n            cropAndInsertButton: true,\n            onInsert: function(items) {\n                if (!items.length) {\n                    alert('Please select image(s) to insert.')\n                    return\n                }\n\n                if (items.length > 1) {\n                    alert('Please select a single item.')\n                    return\n                }\n\n                var path, publicUrl\n                for (var i=0, len=items.length; i<len; i++) {\n                    path = items[i].path\n                    publicUrl = items[i].publicUrl\n                }\n\n                self.setValue(path)\n\n                if (self.options.isImage) {\n                    $('[data-find-image]', self.$el).attr('src', publicUrl)\n                    $('[data-find-error]', self.$el).hide()\n                }\n\n                self.evalIsPopulated()\n\n                this.hide()\n            }\n        })\n    }\n\n    MediaFinder.prototype.evalIsPopulated = function() {\n        var isPopulated = !!this.$findValue.val()\n        this.$el.toggleClass('is-populated', isPopulated)\n        $('[data-find-file-name]', this.$el).text(this.$findValue.val().substring(1))\n    }\n\n    MediaFinder.DEFAULTS = {\n        isMulti: null,\n        isPreview: null,\n        isImage: null\n    }\n\n    // PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.mediaFinder\n\n    $.fn.mediaFinder = function(option) {\n        var args = arguments;\n\n        return this.each(function() {\n            var $this   = $(this)\n            var data    = $this.data('oc.mediaFinder')\n            var options = $.extend({}, MediaFinder.DEFAULTS, $this.data(), typeof option == 'object' && option)\n            if (!data) $this.data('oc.mediaFinder', (data = new MediaFinder(this, options)))\n            if (typeof option == 'string') data[option].apply(data, args)\n        })\n      }\n\n    $.fn.mediaFinder.Constructor = MediaFinder\n\n    $.fn.mediaFinder.noConflict = function() {\n        $.fn.mediaFinder = old\n        return this\n    }\n\n    $(document).render(function() {\n        $('[data-control=\"mediafinder\"]').mediaFinder()\n    })\n\n}(window.jQuery);\n", "\n(function($){$.FroalaEditor.PLUGINS.mediaManager=function(editor){function onInsertFile(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar link,text=editor.selection.text(),textIsEmpty=$.trim(text)===''\nfor(var i=0,len=items.length;i<len;i++){var text=textIsEmpty?items[i].title:text\nlink=items[i].publicUrl}\neditor.events.focus(true);editor.selection.restore();editor.html.insert('<a href=\"'+link+'\" id=\"fr-inserted-file\" class=\"fr-file\">'+text+'</a>');var $file=editor.$el.find('#fr-inserted-file');$file.removeAttr('id');editor.undo.saveStep()\nthis.hide()}})}\nfunction onInsertImage(){var $currentImage=editor.image.get(),selection=editor.selection.get(),range=editor.selection.ranges(0);new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:true,onInsert:function(items){editor.selection.clear();selection.addRange(range);if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_image_empty_insert'))\nreturn}\nvar imagesInserted=0\nfor(var i=0,len=items.length;i<len;i++){if(items[i].documentType!=='image'){$.oc.alert($.oc.lang.get('mediamanager.invalid_image_invalid_insert','The file \"'+items[i].title+'\" is not an image.'))\ncontinue}\neditor.image.insert(items[i].publicUrl,false,{},$currentImage)\nimagesInserted++\nif(imagesInserted==1){$currentImage=null}}\nif(imagesInserted!==0){this.hide()\neditor.undo.saveStep()}}})}\nfunction onInsertVideo(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_video_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar item=items[0]\nif(item.documentType!=='video'){$.oc.alert($.oc.lang.get('mediamanager.invalid_video_invalid_insert','The file \"'+item.title+'\" is not a video.'))\nreturn}\nvar $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\n$richEditorNode.richEditor('insertVideo',item.publicUrl,item.title)\nthis.hide()}})}\nfunction onInsertAudio(){new $.oc.mediaManager.popup({alias:'ocmediamanager',cropAndInsertButton:false,onInsert:function(items){if(!items.length){$.oc.alert($.oc.lang.get('mediamanager.invalid_audio_empty_insert'))\nreturn}\nif(items.length>1){$.oc.alert($.oc.lang.get('mediamanager.invalid_file_single_insert'))\nreturn}\nvar item=items[0]\nif(item.documentType!=='audio'){$.oc.alert($.oc.lang.get('mediamanager.invalid_audio_invalid_insert','The file \"'+item.title+'\" is not an audio file.'))\nreturn}\nvar $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\n$richEditorNode.richEditor('insertAudio',item.publicUrl,item.title)\nthis.hide()}})}\nfunction _insertVideoFallback(link){var $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\nvar title=link.substring(link.lastIndexOf('/')+1)\n$richEditorNode.richEditor('insertVideo',link,title)\neditor.popups.hide('video.insert')}\nfunction _insertAudioFallback(link){var $richEditorNode=editor.$el.closest('[data-control=\"richeditor\"]')\nvar title=link.substring(link.lastIndexOf('/')+1)\n$richEditorNode.richEditor('insertAudio',link,title)\neditor.popups.hide('audio.insert')}\nfunction _init(){editor.events.on('destroy',_destroy,true)\neditor.events.on('video.linkError',_insertVideoFallback)\neditor.events.on('audio.linkError',_insertAudioFallback)}\nfunction _destroy(){}\nreturn{_init:_init,insertFile:onInsertFile,insertImage:onInsertImage,insertVideo:onInsertVideo,insertAudio:onInsertAudio}}\nif(!$.FE.PLUGINS.link||!$.FE.PLUGINS.file||!$.FE.PLUGINS.image||!$.FE.PLUGINS.video){throw new Error('Media manager plugin requires link, file, image and video plugin.');}\n$.FE.DEFAULTS.imageInsertButtons.push('mmImageManager');$.FE.RegisterCommand('mmImageManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertImage();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmImageManager',{NAME:'folder'});$.FE.DEFAULTS.fileInsertButtons.push('mmFileManager');$.FE.RegisterCommand('mmFileManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertFile();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmFileManager',{NAME:'folder'});$.FE.DEFAULTS.videoInsertButtons.push('mmVideoManager');$.FE.RegisterCommand('mmVideoManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertVideo();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmVideoManager',{NAME:'folder'});$.FE.DEFAULTS.audioInsertButtons.push('mmAudioManager');$.FE.RegisterCommand('mmAudioManager',{title:'Browse',undo:false,focus:false,callback:function(){this.mediaManager.insertAudio();},plugin:'mediaManager'})\n$.FE.DefineIcon('mmAudioManager',{NAME:'folder'});})(jQuery);var richeditorPageLinksPlugin\nfunction richeditorPageLinksSelectPage($form){richeditorPageLinksPlugin.setLinkValueFromPopup($form)}\n$.FroalaEditor.DEFAULTS=$.extend($.FroalaEditor.DEFAULTS,{pageLinksHandler:'onLoadPageLinksForm'});$.FroalaEditor.DEFAULTS.key='JA6B2B5A1qB1F1F4D3I1A15A11D3E6B5dVh1VCQWa1EOQFe1NCb1==';(function($){$.FroalaEditor.PLUGINS.pageLinks=function(editor){function setLinkValueFromPopup($form){var $select=$('select[name=pagelink]',$form)\nvar link={text:$('option:selected',$select).text().trim(),href:$select.val()}\nsetTimeout(function(){editor.popups.show('link.insert')\nsetLinkValue(link)},300)}\nfunction setLinkValue(link){var $popup=editor.popups.get('link.insert');var text_inputs=$popup.find('input.fr-link-attr[type=\"text\"]');var check_inputs=$popup.find('input.fr-link-attr[type=\"checkbox\"]');var $input;var i;for(i=0;i<text_inputs.length;i++){$input=$(text_inputs[i]);if(link[$input.attr('name')]){$input.val(link[$input.attr('name')]);}\nelse if($input.attr('name')!='text'){$input.val('');}}\nfor(i=0;i<check_inputs.length;i++){$input=$(check_inputs[i]);$input.prop('checked',$input.data('checked')==link[$input.attr('name')]);}}\nfunction insertLink(){richeditorPageLinksPlugin=this\neditor.$el.popup({handler:editor.opts.pageLinksHandler})}\nfunction _init(){}\nreturn{_init:_init,setLinkValueFromPopup:setLinkValueFromPopup,setLinkValue:setLinkValue,insertLink:insertLink}}\n$.FE.DEFAULTS.linkInsertButtons=['linkBack','|','linkPageLinks']\n$.FE.RegisterCommand('linkPageLinks',{title:'Choose Link',undo:false,focus:false,callback:function(){this.pageLinks.insertLink()},plugin:'pageLinks'})\n$.FE.DefineIcon('linkPageLinks',{NAME:'search'});})(jQuery);(function($){$.FroalaEditor.PLUGINS.figures=function(editor){function insertElement($el){var html=$('<div />').append($el.clone()).remove().html()\neditor.events.focus(true)\neditor.selection.restore()\neditor.html.insert(html)\neditor.html.cleanEmptyTags()\n$('figure',editor.$el).each(function(){var $this=$(this),$parent=$this.parent('p'),$next=$this.next('p')\nif(!!$parent.length){$this.insertAfter($parent)}\nif(!!$next.length&&$.trim($next.text()).length==0){$next.remove()}})\neditor.undo.saveStep()}\nfunction _makeUiBlockElement(){var $node=$('<figure contenteditable=\"false\" tabindex=\"0\" data-ui-block=\"true\">&nbsp;</figure>')\n$node.get(0).contentEditable=false\nreturn $node}\nfunction insertVideo(url,text){var $node=_makeUiBlockElement()\n$node.attr('data-video',url)\n$node.attr('data-label',text)\ninsertElement($node)}\nfunction insertAudio(url,text){var $node=_makeUiBlockElement()\n$node.attr('data-audio',url)\n$node.attr('data-label',text)\ninsertElement($node)}\nfunction _initUiBlocks(){$('[data-video], [data-audio]',editor.$el).each(function(){$(this).addClass('fr-draggable').attr({'data-ui-block':'true','draggable':'true','tabindex':'0'}).html('&nbsp;')\nthis.contentEditable=false})}\nfunction _handleUiBlocksKeydown(ev){if(ev.key==='ArrowDown'||ev.key==='ArrowUp'||ev.key==='Backspace'||ev.key==='Delete'){var $block=$(editor.selection.element())\nif($block.is('br')){$block=$block.parent()}\nif(!!$block.length){switch(ev.key){case'ArrowUp':_handleUiBlockCaretIn($block.prev())\nbreak\ncase'ArrowDown':_handleUiBlockCaretIn($block.next())\nbreak\ncase'Delete':_handleUiBlockCaretClearEmpty($block.next(),$block)\nbreak\ncase'Backspace':_handleUiBlockCaretClearEmpty($block.prev(),$block)\nbreak}}}}\nfunction _handleUiBlockCaretClearEmpty($block,$p){if($block.attr('data-ui-block')!==undefined&&$.trim($p.text()).length==0){$p.remove()\n_handleUiBlockCaretIn($block)\neditor.undo.saveStep()}}\nfunction _handleUiBlockCaretIn($block){if($block.attr('data-ui-block')!==undefined){$block.focus()\neditor.selection.clear()\nreturn true}\nreturn false}\nfunction _uiBlockKeyDown(ev,block){if(ev.key==='ArrowDown'||ev.key==='ArrowUp'||ev.key==='Enter'||ev.key==='Backspace'||ev.key==='Delete'){switch(ev.key){case'ArrowDown':_focusUiBlockOrText($(block).next(),true)\nbreak\ncase'ArrowUp':_focusUiBlockOrText($(block).prev(),false)\nbreak\ncase'Enter':var $paragraph=$('<p><br/></p>')\n$paragraph.insertAfter(block)\neditor.selection.setAfter(block)\neditor.selection.restore()\neditor.undo.saveStep()\nbreak\ncase'Backspace':case'Delete':var $nextFocus=$(block).next(),gotoStart=true\nif($nextFocus.length==0){$nextFocus=$(block).prev()\ngotoStart=false}\n_focusUiBlockOrText($nextFocus,gotoStart)\n$(block).remove()\neditor.undo.saveStep()\nbreak}\nev.preventDefault()}}\nfunction _focusUiBlockOrText($block,gotoStart){if(!!$block.length){if(!_handleUiBlockCaretIn($block)){if(gotoStart){editor.selection.setAtStart($block.get(0))\neditor.selection.restore()}\nelse{editor.selection.setAtEnd($block.get(0))\neditor.selection.restore()}}}}\nfunction _onKeydown(ev){_handleUiBlocksKeydown(ev)\nif(ev.isDefaultPrevented()){return false}}\nfunction _onFigureKeydown(ev){if(ev.target&&$(ev.target).attr('data-ui-block')!==undefined){_uiBlockKeyDown(ev,ev.target)}\nif(ev.isDefaultPrevented()){return false}}\nfunction _onSync(html){var $domTree=$('<div>'+html+'</div>')\n$domTree.find('[data-video], [data-audio]').each(function(){$(this).removeAttr('contenteditable data-ui-block tabindex draggable').removeClass('fr-draggable fr-dragging')})\nreturn $domTree.html()}\nfunction _init(){editor.events.on('initialized',_initUiBlocks)\neditor.events.on('html.set',_initUiBlocks)\neditor.events.on('html.get',_onSync)\neditor.events.on('keydown',_onKeydown)\neditor.events.on('destroy',_destroy,true)\neditor.$el.on('keydown','figure',_onFigureKeydown)}\nfunction _destroy(){editor.$el.off('keydown','figure',_onFigureKeydown)}\nreturn{_init:_init,insert:insertElement,insertVideo:insertVideo,insertAudio:insertAudio}}})(jQuery);+function($){\"use strict\";var Base=$.oc.foundation.base,BaseProto=Base.prototype\nvar RichEditor=function(element,options){this.options=options\nthis.$el=$(element)\nthis.$textarea=this.$el.find('>textarea:first')\nthis.$form=this.$el.closest('form')\nthis.editor=null\n$.oc.foundation.controlUtils.markDisposable(element)\nBase.call(this)\nthis.init()}\nRichEditor.prototype=Object.create(BaseProto)\nRichEditor.prototype.constructor=RichEditor\nRichEditor.DEFAULTS={linksHandler:null,uploadHandler:null,stylesheet:null,fullpage:false,editorLang:'en',useMediaManager:false,toolbarButtons:null,allowEmptyTags:null,allowTags:null,noWrapTags:null,removeTags:null,lineBreakerTags:null,imageStyles:null,linkStyles:null,paragraphStyles:null,tableStyles:null,tableCellStyles:null,aceVendorPath:'/',readOnly:false}\nRichEditor.prototype.init=function(){var self=this;this.$el.one('dispose-control',this.proxy(this.dispose))\nif(!this.$textarea.attr('id')){this.$textarea.attr('id','element-'+Math.random().toString(36).substring(7))}\nthis.initFroala()}\nRichEditor.prototype.initFroala=function(){var froalaOptions={editorClass:'control-richeditor',language:this.options.editorLang,fullPage:this.options.fullpage,pageLinksHandler:this.options.linksHandler,uploadHandler:this.options.uploadHandler,aceEditorVendorPath:this.options.aceVendorPath,toolbarSticky:false}\nif(this.options.toolbarButtons){froalaOptions.toolbarButtons=this.options.toolbarButtons.split(',')}\nelse{froalaOptions.toolbarButtons=$.oc.richEditorButtons}\nfroalaOptions.imageStyles=this.options.imageStyles?this.options.imageStyles:{'oc-img-rounded':'Rounded','oc-img-bordered':'Bordered'}\nfroalaOptions.linkStyles=this.options.linkStyles?this.options.linkStyles:{'oc-link-green':'Green','oc-link-strong':'Thick'}\nfroalaOptions.paragraphStyles=this.options.paragraphStyles?this.options.paragraphStyles:{'oc-text-gray':'Gray','oc-text-bordered':'Bordered','oc-text-spaced':'Spaced','oc-text-uppercase':'Uppercase'}\nfroalaOptions.tableStyles=this.options.tableStyles?this.options.tableStyles:{'oc-dashed-borders':'Dashed Borders','oc-alternate-rows':'Alternate Rows'}\nfroalaOptions.tableCellStyles=this.options.tableCellStyles?this.options.tableCellStyles:{'oc-cell-highlighted':'Highlighted','oc-cell-thick-border':'Thick'}\nfroalaOptions.toolbarButtonsMD=froalaOptions.toolbarButtons\nfroalaOptions.toolbarButtonsSM=froalaOptions.toolbarButtons\nfroalaOptions.toolbarButtonsXS=froalaOptions.toolbarButtons\nif(this.options.allowEmptyTags){froalaOptions.htmlAllowedEmptyTags=[];this.options.allowEmptyTags.split(/[\\s,]+/).forEach(function(selector){var tag=selector.split('.',2)\nif(froalaOptions.htmlAllowedEmptyTags.indexOf(tag[0])===-1){froalaOptions.htmlAllowedEmptyTags.push(selector)}})}else{froalaOptions.htmlAllowedEmptyTags=['textarea','a','iframe','object','video','style','script','.fa','.fr-emoticon','.fr-inner','path','line','hr','i']}\nfroalaOptions.htmlAllowedTags=this.options.allowTags?this.options.allowTags.split(/[\\s,]+/):['a','abbr','address','area','article','aside','audio','b','bdi','bdo','blockquote','br','button','canvas','caption','cite','code','col','colgroup','datalist','dd','del','details','dfn','dialog','div','dl','dt','em','embed','fieldset','figcaption','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meter','nav','noscript','object','ol','optgroup','option','output','p','param','pre','progress','queue','rp','rt','ruby','s','samp','script','style','section','select','small','source','span','strike','strong','sub','summary','sup','table','tbody','td','textarea','tfoot','th','thead','time','title','tr','track','u','ul','var','video','wbr']\nfroalaOptions.htmlDoNotWrapTags=this.options.noWrapTags?this.options.noWrapTags.split(/[\\s,]+/):['figure','script','style']\nfroalaOptions.htmlRemoveTags=this.options.removeTags?this.options.removeTags.split(/[\\s,]+/):['script','style','base']\nfroalaOptions.lineBreakerTags=this.options.lineBreakerTags?this.options.lineBreakerTags.split(/[\\s,]+/):['figure, table, hr, iframe, form, dl']\nfroalaOptions.shortcutsEnabled=['show','bold','italic','underline','indent','outdent','undo','redo']\nfroalaOptions.requestHeaders={'X-CSRF-TOKEN':$('meta[name=\"csrf-token\"]').attr('content'),'X-Requested-With':'XMLHttpRequest'}\nvar $form=this.$el.closest('form')\nvar formData={};if($form.length>0){$.each($form.serializeArray(),function(index,field){formData[field.name]=field.value;})}\nfroalaOptions.imageUploadURL=froalaOptions.fileUploadURL=window.location\nfroalaOptions.imageUploadParam=froalaOptions.fileUploadParam='file_data'\nfroalaOptions.imageUploadParams=froalaOptions.fileUploadParams=$.extend(formData,{_handler:froalaOptions.uploadHandler,})\nvar placeholder=this.$textarea.attr('placeholder')\nfroalaOptions.placeholderText=placeholder?placeholder:''\nfroalaOptions.height=this.$el.hasClass('stretch')?Infinity:$('.height-indicator',this.$el).height()\nif(!this.options.useMediaManager){delete $.FroalaEditor.PLUGINS.mediaManager}\n$.FroalaEditor.ICON_TEMPLATES={font_awesome:'<i class=\"icon-[NAME]\"></i>',text:'<span style=\"text-align: center;\">[NAME]</span>',image:'<img src=[SRC] alt=[ALT] />'}\nthis.$textarea.on('froalaEditor.initialized',this.proxy(this.build))\nthis.$textarea.on('froalaEditor.contentChanged',this.proxy(this.onChange))\nthis.$textarea.on('froalaEditor.html.get',this.proxy(this.onSyncContent))\nthis.$textarea.on('froalaEditor.html.set',this.proxy(this.onSetContent))\nthis.$textarea.on('froalaEditor.paste.beforeCleanup',this.proxy(this.beforeCleanupPaste))\nthis.$form.on('oc.beforeRequest',this.proxy(this.onFormBeforeRequest))\nthis.$textarea.froalaEditor(froalaOptions)\nthis.editor=this.$textarea.data('froala.editor')\nif(this.options.readOnly){this.editor.edit.off()}\nthis.$el.on('keydown','.fr-view figure',this.proxy(this.onFigureKeydown))}\nRichEditor.prototype.dispose=function(){this.unregisterHandlers()\nthis.$textarea.froalaEditor('destroy')\nthis.$el.removeData('oc.richEditor')\nthis.options=null\nthis.$el=null\nthis.$textarea=null\nthis.$form=null\nthis.editor=null\nBaseProto.dispose.call(this)}\nRichEditor.prototype.unregisterHandlers=function(){this.$el.off('keydown','.fr-view figure',this.proxy(this.onFigureKeydown))\nthis.$textarea.off('froalaEditor.initialized',this.proxy(this.build))\nthis.$textarea.off('froalaEditor.contentChanged',this.proxy(this.onChange))\nthis.$textarea.off('froalaEditor.html.get',this.proxy(this.onSyncContent))\nthis.$textarea.off('froalaEditor.html.set',this.proxy(this.onSetContent))\nthis.$textarea.off('froalaEditor.paste.beforeCleanup',this.proxy(this.beforeCleanupPaste))\nthis.$form.off('oc.beforeRequest',this.proxy(this.onFormBeforeRequest))\n$(window).off('resize',this.proxy(this.updateLayout))\n$(window).off('oc.updateUi',this.proxy(this.updateLayout))\nthis.$el.off('dispose-control',this.proxy(this.dispose))}\nRichEditor.prototype.build=function(event,editor){this.updateLayout()\n$(window).on('resize',this.proxy(this.updateLayout))\n$(window).on('oc.updateUi',this.proxy(this.updateLayout))\neditor.events.on('keydown',this.proxy(this.onKeydown),true)\nthis.$textarea.trigger('init.oc.richeditor',[this])}\nRichEditor.prototype.isCodeViewActive=function(){return this.editor&&this.editor.codeView&&this.editor.codeView.isActive()}\nRichEditor.prototype.getElement=function(){return this.$el}\nRichEditor.prototype.getEditor=function(){return this.editor}\nRichEditor.prototype.getTextarea=function(){return this.$textarea}\nRichEditor.prototype.getContent=function(){return this.editor.html.get()}\nRichEditor.prototype.setContent=function(html){this.editor.html.set(html)}\nRichEditor.prototype.syncContent=function(){this.editor.events.trigger('contentChanged')}\nRichEditor.prototype.updateLayout=function(){var $editor=$('.fr-wrapper',this.$el),$codeEditor=$('.fr-code',this.$el),$toolbar=$('.fr-toolbar',this.$el),$box=$('.fr-box',this.$el)\nif(!$editor.length){return}\nif(this.$el.hasClass('stretch')&&!$box.hasClass('fr-fullscreen')){var height=$toolbar.outerHeight(true)\n$editor.css('top',height+1)\n$codeEditor.css('top',height)}\nelse{$editor.css('top','')\n$codeEditor.css('top','')}}\nRichEditor.prototype.insertHtml=function(html){this.editor.html.insert(html)\nthis.editor.selection.restore()}\nRichEditor.prototype.insertElement=function($el){this.insertHtml($('<div />').append($el.clone()).remove().html())}\nRichEditor.prototype.insertUiBlock=function($node){this.$textarea.froalaEditor('figures.insert',$node)}\nRichEditor.prototype.insertVideo=function(url,title){this.$textarea.froalaEditor('figures.insertVideo',url,title)}\nRichEditor.prototype.insertAudio=function(url,title){this.$textarea.froalaEditor('figures.insertAudio',url,title)}\nRichEditor.prototype.onSetContent=function(ev,editor){this.$textarea.trigger('setContent.oc.richeditor',[this])}\nRichEditor.prototype.beforeCleanupPaste=function(ev,editor,clipboard_html){return ocSanitize(clipboard_html)}\nRichEditor.prototype.onSyncContent=function(ev,editor,html){if(editor.codeBeautifier){html=editor.codeBeautifier.run(html,editor.opts.codeBeautifierOptions)}\nvar container={html:html}\nthis.$textarea.trigger('syncContent.oc.richeditor',[this,container])\nreturn container.html}\nRichEditor.prototype.onFocus=function(){this.$el.addClass('editor-focus')}\nRichEditor.prototype.onBlur=function(){this.$el.removeClass('editor-focus')}\nRichEditor.prototype.onFigureKeydown=function(ev){this.$textarea.trigger('figureKeydown.oc.richeditor',[ev,this])}\nRichEditor.prototype.onKeydown=function(ev,editor,keyEv){this.$textarea.trigger('keydown.oc.richeditor',[keyEv,this])\nif(ev.isDefaultPrevented()){return false}}\nRichEditor.prototype.onChange=function(ev){this.$form.trigger('change')}\nRichEditor.prototype.onFormBeforeRequest=function(ev){if(!this.editor){return}\nif(this.isCodeViewActive()){this.editor.html.set(this.editor.codeView.get())}\nthis.$textarea.val(this.editor.html.get())}\nvar old=$.fn.richEditor\n$.fn.richEditor=function(option){var args=Array.prototype.slice.call(arguments,1),result\nthis.each(function(){var $this=$(this)\nvar data=$this.data('oc.richEditor')\nvar options=$.extend({},RichEditor.DEFAULTS,$this.data(),typeof option=='object'&&option)\nif(!data)$this.data('oc.richEditor',(data=new RichEditor(this,options)))\nif(typeof option=='string')result=data[option].apply(data,args)\nif(typeof result!='undefined')return false})\nreturn result?result:this}\n$.fn.richEditor.Constructor=RichEditor\n$.fn.richEditor.noConflict=function(){$.fn.richEditor=old\nreturn this}\n$(document).render(function(){$('[data-control=\"richeditor\"]').richEditor()})\nif($.oc===undefined)\n$.oc={}\n$.oc.richEditorButtons=['paragraphFormat','paragraphStyle','quote','bold','italic','align','formatOL','formatUL','insertTable','insertLink','insertImage','insertVideo','insertAudio','insertFile','insertHR','fullscreen','html']}(window.jQuery);", "/*\n * Rich text editor form field control (WYSIWYG)\n *\n * Data attributes:\n * - data-control=\"richeditor\" - enables the rich editor plugin\n *\n * JavaScript API:\n * $('textarea').richEditor()\n *\n * Dependancies:\n * - Froala Editor (froala_editor.js)\n */\n+function ($) { \"use strict\";\n    var Base = $.oc.foundation.base,\n        BaseProto = Base.prototype\n\n    // RICHEDITOR CLASS DEFINITION\n    // ============================\n\n    var RichEditor = function(element, options) {\n        this.options     = options\n        this.$el         = $(element)\n        this.$textarea   = this.$el.find('>textarea:first')\n        this.$form       = this.$el.closest('form')\n        this.editor      = null\n\n        $.oc.foundation.controlUtils.markDisposable(element)\n\n        Base.call(this)\n\n        this.init()\n    }\n\n    RichEditor.prototype = Object.create(BaseProto)\n    RichEditor.prototype.constructor = RichEditor\n\n    RichEditor.DEFAULTS = {\n        linksHandler: null,\n        uploadHandler: null,\n        stylesheet: null,\n        fullpage: false,\n        editorLang: 'en',\n        useMediaManager: false,\n        toolbarButtons: null,\n        allowEmptyTags: null,\n        allowTags: null,\n        noWrapTags: null,\n        removeTags: null,\n        lineBreakerTags: null,\n        imageStyles: null,\n        linkStyles: null,\n        paragraphStyles: null,\n        tableStyles: null,\n        tableCellStyles: null,\n        aceVendorPath: '/',\n        readOnly: false\n    }\n\n    RichEditor.prototype.init = function() {\n        var self = this;\n\n        this.$el.one('dispose-control', this.proxy(this.dispose))\n\n        /*\n         * Textarea must have an identifier\n         */\n        if (!this.$textarea.attr('id')) {\n            this.$textarea.attr('id', 'element-' + Math.random().toString(36).substring(7))\n        }\n\n        /*\n         * Initialize Froala editor\n         */\n        this.initFroala()\n    }\n\n    RichEditor.prototype.initFroala = function() {\n        var froalaOptions = {\n            editorClass: 'control-richeditor',\n            language: this.options.editorLang,\n            fullPage: this.options.fullpage,\n            pageLinksHandler: this.options.linksHandler,\n            uploadHandler: this.options.uploadHandler,\n            aceEditorVendorPath: this.options.aceVendorPath,\n            toolbarSticky: false\n        }\n\n        if (this.options.toolbarButtons) {\n            froalaOptions.toolbarButtons = this.options.toolbarButtons.split(',')\n        }\n        else {\n            froalaOptions.toolbarButtons = $.oc.richEditorButtons\n        }\n\n        froalaOptions.imageStyles = this.options.imageStyles\n            ? this.options.imageStyles\n            : {\n                'oc-img-rounded': 'Rounded',\n                'oc-img-bordered': 'Bordered'\n            }\n\n        froalaOptions.linkStyles = this.options.linkStyles\n            ? this.options.linkStyles\n            : {\n                'oc-link-green': 'Green',\n                'oc-link-strong': 'Thick'\n            }\n\n        froalaOptions.paragraphStyles = this.options.paragraphStyles\n            ? this.options.paragraphStyles\n            : {\n                'oc-text-gray': 'Gray',\n                'oc-text-bordered': 'Bordered',\n                'oc-text-spaced': 'Spaced',\n                'oc-text-uppercase': 'Uppercase'\n            }\n\n        froalaOptions.tableStyles = this.options.tableStyles\n            ? this.options.tableStyles\n            : {\n                'oc-dashed-borders': 'Dashed Borders',\n                'oc-alternate-rows': 'Alternate Rows'\n            }\n\n        froalaOptions.tableCellStyles = this.options.tableCellStyles\n            ? this.options.tableCellStyles\n            : {\n                'oc-cell-highlighted': 'Highlighted',\n                'oc-cell-thick-border': 'Thick'\n            }\n\n        froalaOptions.toolbarButtonsMD = froalaOptions.toolbarButtons\n        froalaOptions.toolbarButtonsSM = froalaOptions.toolbarButtons\n        froalaOptions.toolbarButtonsXS = froalaOptions.toolbarButtons\n\n        if (this.options.allowEmptyTags) {\n            froalaOptions.htmlAllowedEmptyTags = [];\n\n            this.options.allowEmptyTags.split(/[\\s,]+/).forEach(\n                function (selector) {\n                    var tag = selector.split('.', 2)\n                    if (froalaOptions.htmlAllowedEmptyTags.indexOf(tag[0]) === -1) {\n                        froalaOptions.htmlAllowedEmptyTags.push(selector)\n                    }\n                }\n            )\n        } else {\n            froalaOptions.htmlAllowedEmptyTags = ['textarea', 'a', 'iframe', 'object', 'video', 'style', 'script', '.fa', '.fr-emoticon', '.fr-inner', 'path', 'line', 'hr', 'i']\n        }\n\n        froalaOptions.htmlAllowedTags = this.options.allowTags\n            ? this.options.allowTags.split(/[\\s,]+/)\n            : ['a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'blockquote', 'br', 'button', 'canvas', 'caption', 'cite', 'code', 'col', 'colgroup', 'datalist', 'dd', 'del', 'details', 'dfn', 'dialog', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset', 'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'hgroup', 'hr', 'i', 'iframe', 'img', 'input', 'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'menu', 'menuitem', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option', 'output', 'p', 'param', 'pre', 'progress', 'queue', 'rp', 'rt', 'ruby', 's', 'samp', 'script', 'style', 'section', 'select', 'small', 'source', 'span', 'strike', 'strong', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'textarea', 'tfoot', 'th', 'thead', 'time', 'title', 'tr', 'track', 'u', 'ul', 'var', 'video', 'wbr']\n\n        froalaOptions.htmlDoNotWrapTags = this.options.noWrapTags\n            ? this.options.noWrapTags.split(/[\\s,]+/)\n            : ['figure', 'script', 'style']\n\n        froalaOptions.htmlRemoveTags = this.options.removeTags\n            ? this.options.removeTags.split(/[\\s,]+/)\n            : ['script', 'style', 'base']\n\n        froalaOptions.lineBreakerTags = this.options.lineBreakerTags\n            ? this.options.lineBreakerTags.split(/[\\s,]+/)\n            : ['figure, table, hr, iframe, form, dl']\n\n        froalaOptions.shortcutsEnabled = ['show', 'bold', 'italic', 'underline', 'indent', 'outdent', 'undo', 'redo']\n\n        // Ensure that October recognizes AJAX requests from Froala\n        froalaOptions.requestHeaders = {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n            'X-Requested-With': 'XMLHttpRequest'\n        }\n\n        // Get the data from the parent form for including in the request\n        var $form = this.$el.closest('form')\n        var formData = {};\n        if ($form.length > 0) {\n            $.each($form.serializeArray(), function (index, field) {\n                formData[field.name] = field.value;\n            })\n        }\n\n        // File upload\n        froalaOptions.imageUploadURL = froalaOptions.fileUploadURL = window.location\n        froalaOptions.imageUploadParam = froalaOptions.fileUploadParam = 'file_data'\n        froalaOptions.imageUploadParams = froalaOptions.fileUploadParams = $.extend(formData, {\n            _handler: froalaOptions.uploadHandler,\n        })\n\n        var placeholder = this.$textarea.attr('placeholder')\n        froalaOptions.placeholderText = placeholder ? placeholder : ''\n\n        froalaOptions.height = this.$el.hasClass('stretch')\n            ? Infinity\n            : $('.height-indicator', this.$el).height()\n\n        if (!this.options.useMediaManager) {\n            delete $.FroalaEditor.PLUGINS.mediaManager\n        }\n\n        $.FroalaEditor.ICON_TEMPLATES = {\n            font_awesome: '<i class=\"icon-[NAME]\"></i>',\n            text: '<span style=\"text-align: center;\">[NAME]</span>',\n            image: '<img src=[SRC] alt=[ALT] />'\n        }\n\n        this.$textarea.on('froalaEditor.initialized', this.proxy(this.build))\n        this.$textarea.on('froalaEditor.contentChanged', this.proxy(this.onChange))\n        this.$textarea.on('froalaEditor.html.get', this.proxy(this.onSyncContent))\n        this.$textarea.on('froalaEditor.html.set', this.proxy(this.onSetContent))\n        this.$textarea.on('froalaEditor.paste.beforeCleanup', this.proxy(this.beforeCleanupPaste))\n        this.$form.on('oc.beforeRequest', this.proxy(this.onFormBeforeRequest))\n\n        this.$textarea.froalaEditor(froalaOptions)\n\n        this.editor = this.$textarea.data('froala.editor')\n\n        if (this.options.readOnly) {\n            this.editor.edit.off()\n        }\n\n        this.$el.on('keydown', '.fr-view figure', this.proxy(this.onFigureKeydown))\n    }\n\n    RichEditor.prototype.dispose = function() {\n        this.unregisterHandlers()\n\n        this.$textarea.froalaEditor('destroy')\n\n        this.$el.removeData('oc.richEditor')\n\n        this.options = null\n        this.$el = null\n        this.$textarea = null\n        this.$form = null\n        this.editor = null\n\n        BaseProto.dispose.call(this)\n    }\n\n    RichEditor.prototype.unregisterHandlers = function() {\n        this.$el.off('keydown', '.fr-view figure', this.proxy(this.onFigureKeydown))\n\n        this.$textarea.off('froalaEditor.initialized', this.proxy(this.build))\n        this.$textarea.off('froalaEditor.contentChanged', this.proxy(this.onChange))\n        this.$textarea.off('froalaEditor.html.get', this.proxy(this.onSyncContent))\n        this.$textarea.off('froalaEditor.html.set', this.proxy(this.onSetContent))\n        this.$textarea.off('froalaEditor.paste.beforeCleanup', this.proxy(this.beforeCleanupPaste))\n        this.$form.off('oc.beforeRequest', this.proxy(this.onFormBeforeRequest))\n\n        $(window).off('resize', this.proxy(this.updateLayout))\n        $(window).off('oc.updateUi', this.proxy(this.updateLayout))\n        this.$el.off('dispose-control', this.proxy(this.dispose))\n    }\n\n    RichEditor.prototype.build = function(event, editor) {\n        this.updateLayout()\n\n        $(window).on('resize', this.proxy(this.updateLayout))\n        $(window).on('oc.updateUi', this.proxy(this.updateLayout))\n\n        // Bind the keydown listener here to ensure it gets handled before the Froala handlers\n        editor.events.on('keydown', this.proxy(this.onKeydown), true)\n\n        this.$textarea.trigger('init.oc.richeditor', [this])\n    }\n\n    RichEditor.prototype.isCodeViewActive = function() {\n        return this.editor && this.editor.codeView && this.editor.codeView.isActive()\n    }\n\n    RichEditor.prototype.getElement = function() {\n        return this.$el\n    }\n\n    RichEditor.prototype.getEditor = function() {\n        return this.editor\n    }\n\n    RichEditor.prototype.getTextarea = function() {\n        return this.$textarea\n    }\n\n    RichEditor.prototype.getContent = function() {\n        return this.editor.html.get()\n    }\n\n    RichEditor.prototype.setContent = function(html) {\n        this.editor.html.set(html)\n    }\n\n    RichEditor.prototype.syncContent = function() {\n        this.editor.events.trigger('contentChanged')\n    }\n\n    RichEditor.prototype.updateLayout = function() {\n        var $editor = $('.fr-wrapper', this.$el),\n            $codeEditor = $('.fr-code', this.$el),\n            $toolbar = $('.fr-toolbar', this.$el),\n            $box = $('.fr-box', this.$el)\n\n        if (!$editor.length) {\n            return\n        }\n\n        if (this.$el.hasClass('stretch') && !$box.hasClass('fr-fullscreen')) {\n            var height = $toolbar.outerHeight(true)\n            $editor.css('top', height+1)\n            $codeEditor.css('top', height)\n        }\n        else {\n            $editor.css('top', '')\n            $codeEditor.css('top', '')\n        }\n    }\n\n    RichEditor.prototype.insertHtml = function(html) {\n        this.editor.html.insert(html)\n        this.editor.selection.restore()\n    }\n\n    RichEditor.prototype.insertElement = function($el) {\n        this.insertHtml($('<div />').append($el.clone()).remove().html())\n    }\n\n    /*\n     * Inserts non-editable block (used for snippets, audio and video)\n     */\n    RichEditor.prototype.insertUiBlock = function($node) {\n        this.$textarea.froalaEditor('figures.insert', $node)\n    }\n\n    RichEditor.prototype.insertVideo = function(url, title) {\n        this.$textarea.froalaEditor('figures.insertVideo', url, title)\n    }\n\n    RichEditor.prototype.insertAudio = function(url, title) {\n        this.$textarea.froalaEditor('figures.insertAudio', url, title)\n    }\n\n    // EVENT HANDLERS\n    // ============================\n\n    RichEditor.prototype.onSetContent = function(ev, editor) {\n        this.$textarea.trigger('setContent.oc.richeditor', [this])\n    }\n\n    RichEditor.prototype.beforeCleanupPaste = function (ev, editor, clipboard_html) {\n        return ocSanitize(clipboard_html)\n    }\n\n    RichEditor.prototype.onSyncContent = function(ev, editor, html) {\n        // Beautify HTML.\n        if (editor.codeBeautifier) {\n            html = editor.codeBeautifier.run(html, editor.opts.codeBeautifierOptions)\n        }\n\n        var container = {\n            html: html\n        }\n\n        this.$textarea.trigger('syncContent.oc.richeditor', [this, container])\n\n        return container.html\n    }\n\n    RichEditor.prototype.onFocus = function() {\n        this.$el.addClass('editor-focus')\n    }\n\n    RichEditor.prototype.onBlur = function() {\n        this.$el.removeClass('editor-focus')\n    }\n\n    RichEditor.prototype.onFigureKeydown = function(ev) {\n        this.$textarea.trigger('figureKeydown.oc.richeditor', [ev, this])\n    }\n\n    RichEditor.prototype.onKeydown = function(ev, editor, keyEv) {\n        this.$textarea.trigger('keydown.oc.richeditor', [keyEv, this])\n\n        if (ev.isDefaultPrevented()) {\n            return false\n        }\n    }\n\n    RichEditor.prototype.onChange = function(ev) {\n        this.$form.trigger('change')\n    }\n\n    /*\n     * Instantly synchronizes HTML content.\n     * The onSyncContent() method (above) is involved into this call,\n     * so the resulting HTML is (optionally) beautified.\n     */\n    RichEditor.prototype.onFormBeforeRequest = function(ev) {\n        if (!this.editor) {\n            return\n        }\n\n        if (this.isCodeViewActive()) {\n            this.editor.html.set(this.editor.codeView.get())\n        }\n\n        this.$textarea.val(this.editor.html.get())\n    }\n\n    // RICHEDITOR PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.richEditor\n\n    $.fn.richEditor = function (option) {\n        var args = Array.prototype.slice.call(arguments, 1), result\n        this.each(function () {\n            var $this   = $(this)\n            var data    = $this.data('oc.richEditor')\n            var options = $.extend({}, RichEditor.DEFAULTS, $this.data(), typeof option == 'object' && option)\n            if (!data) $this.data('oc.richEditor', (data = new RichEditor(this, options)))\n            if (typeof option == 'string') result = data[option].apply(data, args)\n            if (typeof result != 'undefined') return false\n        })\n\n        return result ? result : this\n    }\n\n    $.fn.richEditor.Constructor = RichEditor\n\n    // RICHEDITOR NO CONFLICT\n    // =================\n\n    $.fn.richEditor.noConflict = function() {\n        $.fn.richEditor = old\n        return this\n    }\n\n    // RICHEDITOR DATA-API\n    // ===============\n    $(document).render(function() {\n        $('[data-control=\"richeditor\"]').richEditor()\n    })\n\n\n    // BUTTON DEFINITIONS\n    // =================\n\n    if ($.oc === undefined)\n        $.oc = {}\n\n    $.oc.richEditorButtons = [\n        'paragraphFormat',\n        'paragraphStyle',\n        'quote',\n        'bold',\n        'italic',\n        'align',\n        'formatOL',\n        'formatUL',\n        'insertTable',\n        'insertLink',\n        'insertImage',\n        'insertVideo',\n        'insertAudio',\n        'insertFile',\n        'insertHR',\n        'fullscreen',\n        'html'\n    ]\n\n}(window.jQuery);\n", "\nif(window.jQuery===undefined){throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');}\nif(window.jQuery.request!==undefined){throw new Error('The OctoberCMS framework is already loaded.');}\n+function($){\"use strict\";var Request=function(element,handler,options){var $el=this.$el=$(element);this.options=options||{};if(handler===undefined){throw new Error('The request handler name is not specified.')}\nif(!handler.match(/^(?:\\w+\\:{2})?on*/)){throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')}\nvar $form=options.form?$(options.form):$el.closest('form'),$triggerEl=!!$form.length?$form:$el,context={handler:handler,options:options}\nif((options.browserValidate!==undefined)&&typeof document.createElement('input').reportValidity=='function'&&$form&&$form[0]&&!$form[0].checkValidity()){$form[0].reportValidity();return false;}\n$el.trigger('ajaxSetup',[context])\nvar _event=jQuery.Event('oc.beforeRequest')\n$triggerEl.trigger(_event,context)\nif(_event.isDefaultPrevented())return\nvar loading=options.loading!==undefined?options.loading:null,url=options.url!==undefined?options.url:window.location.href,isRedirect=options.redirect!==undefined&&options.redirect.length,useFlash=options.flash!==undefined,useFiles=options.files!==undefined\nif(useFiles&&typeof FormData==='undefined'){console.warn('This browser does not support file uploads via FormData')\nuseFiles=false}\nif($.type(loading)=='string'){loading=$(loading)}\nvar requestHeaders={'X-OCTOBER-REQUEST-HANDLER':handler,'X-OCTOBER-REQUEST-PARTIALS':this.extractPartials(options.update)}\nif(useFlash){requestHeaders['X-OCTOBER-REQUEST-FLASH']=1}\nvar csrfToken=getXSRFToken()\nif(csrfToken){requestHeaders['X-XSRF-TOKEN']=csrfToken}\nvar requestData,inputName,data={}\n$.each($el.parents('[data-request-data]').toArray().reverse(),function extendRequest(){$.extend(data,paramToObj('data-request-data',$(this).data('request-data')))})\nif($el.is(':input')&&!$form.length){inputName=$el.attr('name')\nif(inputName!==undefined&&options.data[inputName]===undefined){options.data[inputName]=$el.val()}}\nif(options.data!==undefined&&!$.isEmptyObject(options.data)){$.extend(data,options.data)}\nif(useFiles){requestData=new FormData($form.length?$form.get(0):undefined)\nif($el.is(':file')&&inputName){$.each($el.prop('files'),function(){requestData.append(inputName,this)})\ndelete data[inputName]}\n$.each(data,function(key){if(typeof Blob!==\"undefined\"&&this instanceof Blob&&this.filename){requestData.append(key,this,this.filename)}else{requestData.append(key,this)}})}\nelse{requestData=[$form.serialize(),$.param(data)].filter(Boolean).join('&')}\nvar requestOptions={url:url,crossDomain:false,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])===false)return\nif(options.evalBeforeUpdate&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')===false)return\nvar _event=jQuery.Event('ajaxBeforeUpdate')\n$triggerEl.trigger(_event,[context,data,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(useFlash&&data['X_OCTOBER_FLASH_MESSAGES']){$.each(data['X_OCTOBER_FLASH_MESSAGES'],function(type,message){requestOptions.handleFlashMessage(message,type)})}\nvar updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR)\nupdatePromise.done(function(){$triggerEl.trigger('ajaxSuccess',[context,data,textStatus,jqXHR])\noptions.evalSuccess&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')})\nreturn updatePromise},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred()\nif((window.ocUnloading!==undefined&&window.ocUnloading)||errorThrown=='abort')\nreturn\nisRedirect=false\noptions.redirect=null\nif(jqXHR.status==406&&jqXHR.responseJSON){errorMsg=jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\nupdatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)}\nelse{errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText\nupdatePromise.resolve()}\nupdatePromise.done(function(){$el.data('error-message',errorMsg)\nvar _event=jQuery.Event('ajaxError')\n$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(options.evalError&&eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))')===false)\nreturn\nrequestOptions.handleErrorMessage(errorMsg)})\nreturn updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger('ajaxComplete',[context,data,textStatus,jqXHR])\noptions.evalComplete&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')},handleConfirmMessage:function(message){var _event=jQuery.Event('ajaxConfirmMessage')\n_event.promise=$.Deferred()\nif($(window).triggerHandler(_event,[message])!==undefined){_event.promise.done(function(){options.confirm=null\nnew Request(element,handler,options)})\nreturn false}\nif(_event.isDefaultPrevented())return\nif(message)return confirm(message)},handleErrorMessage:function(message){var _event=jQuery.Event('ajaxErrorMessage')\n$(window).trigger(_event,[message])\nif(_event.isDefaultPrevented())return\nif(message)alert(message)},handleValidationMessage:function(message,fields){$triggerEl.trigger('ajaxValidation',[context,message,fields])\nvar isFirstInvalidField=true\n$.each(fields,function focusErrorField(fieldName,fieldMessages){fieldName=fieldName.replace(/\\.(\\w+)/g,'[$1]')\nvar fieldElement=$form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\nif(fieldElement.length>0){var _event=jQuery.Event('ajaxInvalidField')\n$(window).trigger(_event,[fieldElement.get(0),fieldName,fieldMessages,isFirstInvalidField])\nif(isFirstInvalidField){if(!_event.isDefaultPrevented())fieldElement.focus()\nisFirstInvalidField=false}}})},handleFlashMessage:function(message,type){},handleRedirectResponse:function(url){window.location.assign(url)},handleUpdateResponse:function(data,textStatus,jqXHR){var updatePromise=$.Deferred().done(function(){for(var partial in data){var selector=(options.update[partial])?options.update[partial]:partial\nif($.type(selector)=='string'&&selector.charAt(0)=='@'){$(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse if($.type(selector)=='string'&&selector.charAt(0)=='^'){$(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse{$(selector).trigger('ajaxBeforeReplace')\n$(selector).html(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}}\nsetTimeout(function(){$(window).trigger('ajaxUpdateComplete',[context,data,textStatus,jqXHR]).trigger('resize')},0)})\nif(data['X_OCTOBER_REDIRECT']){options.redirect=data['X_OCTOBER_REDIRECT']\nisRedirect=true}\nif(isRedirect){requestOptions.handleRedirectResponse(options.redirect)}\nif(data['X_OCTOBER_ERROR_FIELDS']){requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'],data['X_OCTOBER_ERROR_FIELDS'])}\nif(data['X_OCTOBER_ASSETS']){assetManager.load(data['X_OCTOBER_ASSETS'],$.proxy(updatePromise.resolve,updatePromise))}\nelse{updatePromise.resolve()}\nreturn updatePromise}}\nif(useFiles){requestOptions.processData=requestOptions.contentType=false}\ncontext.success=requestOptions.success\ncontext.error=requestOptions.error\ncontext.complete=requestOptions.complete\nrequestOptions=$.extend(requestOptions,options)\nrequestOptions.data=requestData\nif(options.confirm&&!requestOptions.handleConfirmMessage(options.confirm)){return}\nif(loading)loading.show()\n$(window).trigger('ajaxBeforeSend',[context])\n$el.trigger('ajaxPromise',[context])\nreturn $.ajax(requestOptions).fail(function(jqXHR,textStatus,errorThrown){if(!isRedirect){$el.trigger('ajaxFail',[context,textStatus,jqXHR])}\nif(loading)loading.hide()}).done(function(data,textStatus,jqXHR){if(!isRedirect){$el.trigger('ajaxDone',[context,data,textStatus,jqXHR])}\nif(loading)loading.hide()}).always(function(dataOrXhr,textStatus,xhrOrError){$el.trigger('ajaxAlways',[context,dataOrXhr,textStatus,xhrOrError])})}\nRequest.DEFAULTS={update:{},type:'POST',beforeUpdate:function(data,textStatus,jqXHR){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:false}\nRequest.prototype.extractPartials=function(update){var result=[]\nfor(var partial in update)\nresult.push(partial)\nreturn result.join('&')}\nvar old=$.fn.request\n$.fn.request=function(handler,option){var args=arguments\nvar $this=$(this).first()\nvar data={evalBeforeUpdate:$this.data('request-before-update'),evalSuccess:$this.data('request-success'),evalError:$this.data('request-error'),evalComplete:$this.data('request-complete'),ajaxGlobal:$this.data('request-ajax-global'),confirm:$this.data('request-confirm'),redirect:$this.data('request-redirect'),loading:$this.data('request-loading'),flash:$this.data('request-flash'),files:$this.data('request-files'),browserValidate:$this.data('browser-validate'),form:$this.data('request-form'),url:$this.data('request-url'),update:paramToObj('data-request-update',$this.data('request-update')),data:paramToObj('data-request-data',$this.data('request-data'))}\nif(!handler)handler=$this.data('request')\nvar options=$.extend(true,{},Request.DEFAULTS,data,typeof option=='object'&&option)\nreturn new Request($this,handler,options)}\n$.fn.request.Constructor=Request\n$.request=function(handler,option){return $(document).request(handler,option)}\n$.fn.request.noConflict=function(){$.fn.request=old\nreturn this}\nfunction paramToObj(name,value){if(value===undefined)value=''\nif(typeof value=='object')return value\ntry{return ocJSON(\"{\"+value+\"}\")}\ncatch(e){throw new Error('Error parsing the '+name+' attribute value. '+e)}}\nfunction getXSRFToken(){var cookieValue=null\nif(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';')\nfor(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i])\nif(cookie.substring(0,11)==('XSRF-TOKEN'+'=')){cookieValue=decodeURIComponent(cookie.substring(11))\nbreak}}}\nreturn cookieValue}\n$(document).on('change','select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]',function documentOnChange(){$(this).request()})\n$(document).on('click','a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]',function documentOnClick(e){e.preventDefault()\n$(this).request()\nif($(this).is('[type=submit]'))\nreturn false})\n$(document).on('keydown','input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]',function documentOnKeydown(e){if(e.key==='Enter'){if(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\n$(this).request()\nreturn false}})\n$(document).on('input','input[data-request][data-track-input]',function documentOnKeyup(e){var\n$el=$(this),lastValue=$el.data('oc.lastvalue')\nif(!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\nreturn\nif(lastValue!==undefined&&lastValue==this.value)\nreturn\n$el.data('oc.lastvalue',this.value)\nif(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\nvar interval=$(this).data('track-input')\nif(!interval)\ninterval=300\nvar self=this\nthis.dataTrackInputTimer=window.setTimeout(function(){if(self.lastDataTrackInputRequest){self.lastDataTrackInputRequest.abort();}\nself.lastDataTrackInputRequest=$(self).request();},interval)})\n$(document).on('submit','[data-request]',function documentOnSubmit(){$(this).request()\nreturn false})\n$(window).on('beforeunload',function documentOnBeforeUnload(){window.ocUnloading=true})\n$(document).ready(function triggerRenderOnReady(){$(document).trigger('render')})\n$(window).on('ajaxUpdateComplete',function triggerRenderOnAjaxUpdateComplete(){$(document).trigger('render')})\n$.fn.render=function(callback){$(document).on('render',callback)}}(window.jQuery);+function(window){\"use strict\";function parseKey(str,pos,quote){var key=\"\";for(var i=pos;i<str.length;i++){if(quote&&quote===str[i]){return key;}else if(!quote&&(str[i]===\" \"||str[i]===\":\")){return key;}\nkey+=str[i];if(str[i]===\"\\\\\"&&i+1<str.length){key+=str[i+1];i++;}}\nthrow new Error(\"Broken JSON syntax near \"+key);}\nfunction getBody(str,pos){if(str[pos]===\"\\\"\"||str[pos]===\"'\"){var body=str[pos];for(var i=pos+1;i<str.length;i++){if(str[i]===\"\\\\\"){body+=str[i];if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===str[pos]){body+=str[pos];return{originLength:body.length,body:body};}else body+=str[i];}\nthrow new Error(\"Broken JSON string body near \"+body);}\nif(str[pos]===\"t\"){if(str.indexOf(\"true\",pos)===pos){return{originLength:\"true\".length,body:\"true\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"f\"){if(str.indexOf(\"f\",pos)===pos){return{originLength:\"false\".length,body:\"false\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"n\"){if(str.indexOf(\"null\",pos)===pos){return{originLength:\"null\".length,body:\"null\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"-\"||str[pos]===\"+\"||str[pos]===\".\"||(str[pos]>=\"0\"&&str[pos]<=\"9\")){var body=\"\";for(var i=pos;i<str.length;i++){if(str[i]===\"-\"||str[i]===\"+\"||str[i]===\".\"||(str[i]>=\"0\"&&str[i]<=\"9\")){body+=str[i];}else{return{originLength:body.length,body:body};}}\nthrow new Error(\"Broken JSON number body near \"+body);}\nif(str[pos]===\"{\"||str[pos]===\"[\"){var stack=[str[pos]];var body=str[pos];for(var i=pos+1;i<str.length;i++){body+=str[i];if(str[i]===\"\\\\\"){if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===\"\\\"\"){if(stack[stack.length-1]===\"\\\"\"){stack.pop();}else if(stack[stack.length-1]!==\"'\"){stack.push(str[i]);}}else if(str[i]===\"'\"){if(stack[stack.length-1]===\"'\"){stack.pop();}else if(stack[stack.length-1]!==\"\\\"\"){stack.push(str[i]);}}else if(stack[stack.length-1]!==\"\\\"\"&&stack[stack.length-1]!==\"'\"){if(str[i]===\"{\"){stack.push(\"{\");}else if(str[i]===\"}\"){if(stack[stack.length-1]===\"{\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}else if(str[i]===\"[\"){stack.push(\"[\");}else if(str[i]===\"]\"){if(stack[stack.length-1]===\"[\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}}\nif(!stack.length){return{originLength:i-pos,body:body};}}\nthrow new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}\nthrow new Error(\"Broken JSON body near \"+str.substr((pos-5>=0)?pos-5:0,50));}\nfunction canBeKeyHead(ch){if(ch[0]===\"\\\\\")return false;if((ch[0]>='a'&&ch[0]<='z')||(ch[0]>='A'&&ch[0]<='Z')||ch[0]==='_')return true;if(ch[0]>='0'&&ch[0]<='9')return true;if(ch[0]==='$')return true;if(ch.charCodeAt(0)>255)return true;return false;}\nfunction isBlankChar(ch){return ch===\" \"||ch===\"\\n\"||ch===\"\\t\";}\nfunction parse(str){str=str.trim();if(!str.length)throw new Error(\"Broken JSON object.\");var result=\"\";while(str&&str[0]===\",\"){str=str.substr(1);}\nif(str[0]===\"\\\"\"||str[0]===\"'\"){if(str[str.length-1]!==str[0]){throw new Error(\"Invalid string JSON object.\");}\nvar body=\"\\\"\";for(var i=1;i<str.length;i++){if(str[i]===\"\\\\\"){if(str[i+1]===\"'\"){body+=str[i+1]}else{body+=str[i];body+=str[i+1];}\ni++;}else if(str[i]===str[0]){body+=\"\\\"\";return body}else if(str[i]===\"\\\"\"){body+=\"\\\\\\\"\"}else body+=str[i];}\nthrow new Error(\"Invalid string JSON object.\");}\nif(str===\"true\"||str===\"false\"){return str;}\nif(str===\"null\"){return\"null\";}\nvar num=parseFloat(str);if(!isNaN(num)){return num.toString();}\nif(str[0]===\"{\"){var type=\"needKey\";var result=\"{\";for(var i=1;i<str.length;i++){if(isBlankChar(str[i])){continue;}else if(type===\"needKey\"&&(str[i]===\"\\\"\"||str[i]===\"'\")){var key=parseKey(str,i+1,str[i]);result+=\"\\\"\"+key+\"\\\"\";i+=key.length;i+=1;type=\"afterKey\";}else if(type===\"needKey\"&&canBeKeyHead(str[i])){var key=parseKey(str,i);result+=\"\\\"\";result+=key;result+=\"\\\"\";i+=key.length-1;type=\"afterKey\";}else if(type===\"afterKey\"&&str[i]===\":\"){result+=\":\";type=\":\";}else if(type===\":\"){var body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"||type===\"needKey\"){var last=i;while(str[last]===\",\"||isBlankChar(str[last])){last++;}\nif(str[last]===\"}\"&&last===str.length-1){while(result[result.length-1]===\",\"){result=result.substr(0,result.length-1);}\nresult+=\"}\";return result;}else if(last!==i&&result!==\"{\"){result+=\",\";type=\"needKey\";i=last-1;}}}\nthrow new Error(\"Broken JSON object near \"+result);}\nif(str[0]===\"[\"){var result=\"[\";var type=\"needBody\";for(var i=1;i<str.length;i++){if(\" \"===str[i]||\"\\n\"===str[i]||\"\\t\"===str[i]){continue;}else if(type===\"needBody\"){if(str[i]===\",\"){result+=\"null,\";continue;}\nif(str[i]===\"]\"&&i===str.length-1){if(result[result.length-1]===\",\")result=result.substr(0,result.length-1);result+=\"]\";return result;}\nvar body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"){if(str[i]===\",\"){result+=\",\";type=\"needBody\";while(str[i+1]===\",\"||isBlankChar(str[i+1])){if(str[i+1]===\",\")result+=\"null,\";i++;}}else if(str[i]===\"]\"&&i===str.length-1){result+=\"]\";return result;}}}\nthrow new Error(\"Broken JSON array near \"+result);}}\nwindow.ocJSON=function(json){var jsonString=parse(json);return JSON.parse(jsonString);};}(window);+function(window){\"use strict\";function trimAttributes(node){$.each(node.attributes,function(){var attrName=this.name;var attrValue=this.value;if(attrName.indexOf('on')==0||attrValue.indexOf('javascript:')==0){$(node).removeAttr(attrName);}});}\nfunction sanitize(html){var output=$($.parseHTML('<div>'+html+'</div>',null,false));output.find('*').each(function(){trimAttributes(this);});return output.html();}\nwindow.ocSanitize=function(html){return sanitize(html)};}(window);", "\nif(window.jQuery===undefined){throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');}\nif(window.jQuery.request!==undefined){throw new Error('The OctoberCMS framework is already loaded.');}\n+function($){\"use strict\";var Request=function(element,handler,options){var $el=this.$el=$(element);this.options=options||{};if(handler===undefined){throw new Error('The request handler name is not specified.')}\nif(!handler.match(/^(?:\\w+\\:{2})?on*/)){throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')}\nvar $form=options.form?$(options.form):$el.closest('form'),$triggerEl=!!$form.length?$form:$el,context={handler:handler,options:options}\nif((options.browserValidate!==undefined)&&typeof document.createElement('input').reportValidity=='function'&&$form&&$form[0]&&!$form[0].checkValidity()){$form[0].reportValidity();return false;}\n$el.trigger('ajaxSetup',[context])\nvar _event=jQuery.Event('oc.beforeRequest')\n$triggerEl.trigger(_event,context)\nif(_event.isDefaultPrevented())return\nvar loading=options.loading!==undefined?options.loading:null,url=options.url!==undefined?options.url:window.location.href,isRedirect=options.redirect!==undefined&&options.redirect.length,useFlash=options.flash!==undefined,useFiles=options.files!==undefined\nif(useFiles&&typeof FormData==='undefined'){console.warn('This browser does not support file uploads via FormData')\nuseFiles=false}\nif($.type(loading)=='string'){loading=$(loading)}\nvar requestHeaders={'X-OCTOBER-REQUEST-HANDLER':handler,'X-OCTOBER-REQUEST-PARTIALS':this.extractPartials(options.update)}\nif(useFlash){requestHeaders['X-OCTOBER-REQUEST-FLASH']=1}\nvar csrfToken=getXSRFToken()\nif(csrfToken){requestHeaders['X-XSRF-TOKEN']=csrfToken}\nvar requestData,inputName,data={}\n$.each($el.parents('[data-request-data]').toArray().reverse(),function extendRequest(){$.extend(data,paramToObj('data-request-data',$(this).data('request-data')))})\nif($el.is(':input')&&!$form.length){inputName=$el.attr('name')\nif(inputName!==undefined&&options.data[inputName]===undefined){options.data[inputName]=$el.val()}}\nif(options.data!==undefined&&!$.isEmptyObject(options.data)){$.extend(data,options.data)}\nif(useFiles){requestData=new FormData($form.length?$form.get(0):undefined)\nif($el.is(':file')&&inputName){$.each($el.prop('files'),function(){requestData.append(inputName,this)})\ndelete data[inputName]}\n$.each(data,function(key){if(typeof Blob!==\"undefined\"&&this instanceof Blob&&this.filename){requestData.append(key,this,this.filename)}else{requestData.append(key,this)}})}\nelse{requestData=[$form.serialize(),$.param(data)].filter(Boolean).join('&')}\nvar requestOptions={url:url,crossDomain:false,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])===false)return\nif(options.evalBeforeUpdate&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')===false)return\nvar _event=jQuery.Event('ajaxBeforeUpdate')\n$triggerEl.trigger(_event,[context,data,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(useFlash&&data['X_OCTOBER_FLASH_MESSAGES']){$.each(data['X_OCTOBER_FLASH_MESSAGES'],function(type,message){requestOptions.handleFlashMessage(message,type)})}\nvar updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR)\nupdatePromise.done(function(){$triggerEl.trigger('ajaxSuccess',[context,data,textStatus,jqXHR])\noptions.evalSuccess&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')})\nreturn updatePromise},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred()\nif((window.ocUnloading!==undefined&&window.ocUnloading)||errorThrown=='abort')\nreturn\nisRedirect=false\noptions.redirect=null\nif(jqXHR.status==406&&jqXHR.responseJSON){errorMsg=jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\nupdatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)}\nelse{errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText\nupdatePromise.resolve()}\nupdatePromise.done(function(){$el.data('error-message',errorMsg)\nvar _event=jQuery.Event('ajaxError')\n$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR])\nif(_event.isDefaultPrevented())return\nif(options.evalError&&eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))')===false)\nreturn\nrequestOptions.handleErrorMessage(errorMsg)})\nreturn updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger('ajaxComplete',[context,data,textStatus,jqXHR])\noptions.evalComplete&&eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')},handleConfirmMessage:function(message){var _event=jQuery.Event('ajaxConfirmMessage')\n_event.promise=$.Deferred()\nif($(window).triggerHandler(_event,[message])!==undefined){_event.promise.done(function(){options.confirm=null\nnew Request(element,handler,options)})\nreturn false}\nif(_event.isDefaultPrevented())return\nif(message)return confirm(message)},handleErrorMessage:function(message){var _event=jQuery.Event('ajaxErrorMessage')\n$(window).trigger(_event,[message])\nif(_event.isDefaultPrevented())return\nif(message)alert(message)},handleValidationMessage:function(message,fields){$triggerEl.trigger('ajaxValidation',[context,message,fields])\nvar isFirstInvalidField=true\n$.each(fields,function focusErrorField(fieldName,fieldMessages){fieldName=fieldName.replace(/\\.(\\w+)/g,'[$1]')\nvar fieldElement=$form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\nif(fieldElement.length>0){var _event=jQuery.Event('ajaxInvalidField')\n$(window).trigger(_event,[fieldElement.get(0),fieldName,fieldMessages,isFirstInvalidField])\nif(isFirstInvalidField){if(!_event.isDefaultPrevented())fieldElement.focus()\nisFirstInvalidField=false}}})},handleFlashMessage:function(message,type){},handleRedirectResponse:function(url){window.location.assign(url)},handleUpdateResponse:function(data,textStatus,jqXHR){var updatePromise=$.Deferred().done(function(){for(var partial in data){var selector=(options.update[partial])?options.update[partial]:partial\nif($.type(selector)=='string'&&selector.charAt(0)=='@'){$(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse if($.type(selector)=='string'&&selector.charAt(0)=='^'){$(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}\nelse{$(selector).trigger('ajaxBeforeReplace')\n$(selector).html(data[partial]).trigger('ajaxUpdate',[context,data,textStatus,jqXHR])}}\nsetTimeout(function(){$(window).trigger('ajaxUpdateComplete',[context,data,textStatus,jqXHR]).trigger('resize')},0)})\nif(data['X_OCTOBER_REDIRECT']){options.redirect=data['X_OCTOBER_REDIRECT']\nisRedirect=true}\nif(isRedirect){requestOptions.handleRedirectResponse(options.redirect)}\nif(data['X_OCTOBER_ERROR_FIELDS']){requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'],data['X_OCTOBER_ERROR_FIELDS'])}\nif(data['X_OCTOBER_ASSETS']){assetManager.load(data['X_OCTOBER_ASSETS'],$.proxy(updatePromise.resolve,updatePromise))}\nelse{updatePromise.resolve()}\nreturn updatePromise}}\nif(useFiles){requestOptions.processData=requestOptions.contentType=false}\ncontext.success=requestOptions.success\ncontext.error=requestOptions.error\ncontext.complete=requestOptions.complete\nrequestOptions=$.extend(requestOptions,options)\nrequestOptions.data=requestData\nif(options.confirm&&!requestOptions.handleConfirmMessage(options.confirm)){return}\nif(loading)loading.show()\n$(window).trigger('ajaxBeforeSend',[context])\n$el.trigger('ajaxPromise',[context])\nreturn $.ajax(requestOptions).fail(function(jqXHR,textStatus,errorThrown){if(!isRedirect){$el.trigger('ajaxFail',[context,textStatus,jqXHR])}\nif(loading)loading.hide()}).done(function(data,textStatus,jqXHR){if(!isRedirect){$el.trigger('ajaxDone',[context,data,textStatus,jqXHR])}\nif(loading)loading.hide()}).always(function(dataOrXhr,textStatus,xhrOrError){$el.trigger('ajaxAlways',[context,dataOrXhr,textStatus,xhrOrError])})}\nRequest.DEFAULTS={update:{},type:'POST',beforeUpdate:function(data,textStatus,jqXHR){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:false}\nRequest.prototype.extractPartials=function(update){var result=[]\nfor(var partial in update)\nresult.push(partial)\nreturn result.join('&')}\nvar old=$.fn.request\n$.fn.request=function(handler,option){var args=arguments\nvar $this=$(this).first()\nvar data={evalBeforeUpdate:$this.data('request-before-update'),evalSuccess:$this.data('request-success'),evalError:$this.data('request-error'),evalComplete:$this.data('request-complete'),ajaxGlobal:$this.data('request-ajax-global'),confirm:$this.data('request-confirm'),redirect:$this.data('request-redirect'),loading:$this.data('request-loading'),flash:$this.data('request-flash'),files:$this.data('request-files'),browserValidate:$this.data('browser-validate'),form:$this.data('request-form'),url:$this.data('request-url'),update:paramToObj('data-request-update',$this.data('request-update')),data:paramToObj('data-request-data',$this.data('request-data'))}\nif(!handler)handler=$this.data('request')\nvar options=$.extend(true,{},Request.DEFAULTS,data,typeof option=='object'&&option)\nreturn new Request($this,handler,options)}\n$.fn.request.Constructor=Request\n$.request=function(handler,option){return $(document).request(handler,option)}\n$.fn.request.noConflict=function(){$.fn.request=old\nreturn this}\nfunction paramToObj(name,value){if(value===undefined)value=''\nif(typeof value=='object')return value\ntry{return ocJSON(\"{\"+value+\"}\")}\ncatch(e){throw new Error('Error parsing the '+name+' attribute value. '+e)}}\nfunction getXSRFToken(){var cookieValue=null\nif(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';')\nfor(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i])\nif(cookie.substring(0,11)==('XSRF-TOKEN'+'=')){cookieValue=decodeURIComponent(cookie.substring(11))\nbreak}}}\nreturn cookieValue}\n$(document).on('change','select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]',function documentOnChange(){$(this).request()})\n$(document).on('click','a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]',function documentOnClick(e){e.preventDefault()\n$(this).request()\nif($(this).is('[type=submit]'))\nreturn false})\n$(document).on('keydown','input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]',function documentOnKeydown(e){if(e.key==='Enter'){if(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\n$(this).request()\nreturn false}})\n$(document).on('input','input[data-request][data-track-input]',function documentOnKeyup(e){var\n$el=$(this),lastValue=$el.data('oc.lastvalue')\nif(!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\nreturn\nif(lastValue!==undefined&&lastValue==this.value)\nreturn\n$el.data('oc.lastvalue',this.value)\nif(this.dataTrackInputTimer!==undefined)\nwindow.clearTimeout(this.dataTrackInputTimer)\nvar interval=$(this).data('track-input')\nif(!interval)\ninterval=300\nvar self=this\nthis.dataTrackInputTimer=window.setTimeout(function(){if(self.lastDataTrackInputRequest){self.lastDataTrackInputRequest.abort();}\nself.lastDataTrackInputRequest=$(self).request();},interval)})\n$(document).on('submit','[data-request]',function documentOnSubmit(){$(this).request()\nreturn false})\n$(window).on('beforeunload',function documentOnBeforeUnload(){window.ocUnloading=true})\n$(document).ready(function triggerRenderOnReady(){$(document).trigger('render')})\n$(window).on('ajaxUpdateComplete',function triggerRenderOnAjaxUpdateComplete(){$(document).trigger('render')})\n$.fn.render=function(callback){$(document).on('render',callback)}}(window.jQuery);+function(window){\"use strict\";function parseKey(str,pos,quote){var key=\"\";for(var i=pos;i<str.length;i++){if(quote&&quote===str[i]){return key;}else if(!quote&&(str[i]===\" \"||str[i]===\":\")){return key;}\nkey+=str[i];if(str[i]===\"\\\\\"&&i+1<str.length){key+=str[i+1];i++;}}\nthrow new Error(\"Broken JSON syntax near \"+key);}\nfunction getBody(str,pos){if(str[pos]===\"\\\"\"||str[pos]===\"'\"){var body=str[pos];for(var i=pos+1;i<str.length;i++){if(str[i]===\"\\\\\"){body+=str[i];if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===str[pos]){body+=str[pos];return{originLength:body.length,body:body};}else body+=str[i];}\nthrow new Error(\"Broken JSON string body near \"+body);}\nif(str[pos]===\"t\"){if(str.indexOf(\"true\",pos)===pos){return{originLength:\"true\".length,body:\"true\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"f\"){if(str.indexOf(\"f\",pos)===pos){return{originLength:\"false\".length,body:\"false\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"n\"){if(str.indexOf(\"null\",pos)===pos){return{originLength:\"null\".length,body:\"null\"};}\nthrow new Error(\"Broken JSON boolean body near \"+str.substr(0,pos+10));}\nif(str[pos]===\"-\"||str[pos]===\"+\"||str[pos]===\".\"||(str[pos]>=\"0\"&&str[pos]<=\"9\")){var body=\"\";for(var i=pos;i<str.length;i++){if(str[i]===\"-\"||str[i]===\"+\"||str[i]===\".\"||(str[i]>=\"0\"&&str[i]<=\"9\")){body+=str[i];}else{return{originLength:body.length,body:body};}}\nthrow new Error(\"Broken JSON number body near \"+body);}\nif(str[pos]===\"{\"||str[pos]===\"[\"){var stack=[str[pos]];var body=str[pos];for(var i=pos+1;i<str.length;i++){body+=str[i];if(str[i]===\"\\\\\"){if(i+1<str.length)body+=str[i+1];i++;}else if(str[i]===\"\\\"\"){if(stack[stack.length-1]===\"\\\"\"){stack.pop();}else if(stack[stack.length-1]!==\"'\"){stack.push(str[i]);}}else if(str[i]===\"'\"){if(stack[stack.length-1]===\"'\"){stack.pop();}else if(stack[stack.length-1]!==\"\\\"\"){stack.push(str[i]);}}else if(stack[stack.length-1]!==\"\\\"\"&&stack[stack.length-1]!==\"'\"){if(str[i]===\"{\"){stack.push(\"{\");}else if(str[i]===\"}\"){if(stack[stack.length-1]===\"{\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}else if(str[i]===\"[\"){stack.push(\"[\");}else if(str[i]===\"]\"){if(stack[stack.length-1]===\"[\"){stack.pop();}else{throw new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}}}\nif(!stack.length){return{originLength:i-pos,body:body};}}\nthrow new Error(\"Broken JSON \"+(str[pos]===\"{\"?\"object\":\"array\")+\" body near \"+body);}\nthrow new Error(\"Broken JSON body near \"+str.substr((pos-5>=0)?pos-5:0,50));}\nfunction canBeKeyHead(ch){if(ch[0]===\"\\\\\")return false;if((ch[0]>='a'&&ch[0]<='z')||(ch[0]>='A'&&ch[0]<='Z')||ch[0]==='_')return true;if(ch[0]>='0'&&ch[0]<='9')return true;if(ch[0]==='$')return true;if(ch.charCodeAt(0)>255)return true;return false;}\nfunction isBlankChar(ch){return ch===\" \"||ch===\"\\n\"||ch===\"\\t\";}\nfunction parse(str){str=str.trim();if(!str.length)throw new Error(\"Broken JSON object.\");var result=\"\";while(str&&str[0]===\",\"){str=str.substr(1);}\nif(str[0]===\"\\\"\"||str[0]===\"'\"){if(str[str.length-1]!==str[0]){throw new Error(\"Invalid string JSON object.\");}\nvar body=\"\\\"\";for(var i=1;i<str.length;i++){if(str[i]===\"\\\\\"){if(str[i+1]===\"'\"){body+=str[i+1]}else{body+=str[i];body+=str[i+1];}\ni++;}else if(str[i]===str[0]){body+=\"\\\"\";return body}else if(str[i]===\"\\\"\"){body+=\"\\\\\\\"\"}else body+=str[i];}\nthrow new Error(\"Invalid string JSON object.\");}\nif(str===\"true\"||str===\"false\"){return str;}\nif(str===\"null\"){return\"null\";}\nvar num=parseFloat(str);if(!isNaN(num)){return num.toString();}\nif(str[0]===\"{\"){var type=\"needKey\";var result=\"{\";for(var i=1;i<str.length;i++){if(isBlankChar(str[i])){continue;}else if(type===\"needKey\"&&(str[i]===\"\\\"\"||str[i]===\"'\")){var key=parseKey(str,i+1,str[i]);result+=\"\\\"\"+key+\"\\\"\";i+=key.length;i+=1;type=\"afterKey\";}else if(type===\"needKey\"&&canBeKeyHead(str[i])){var key=parseKey(str,i);result+=\"\\\"\";result+=key;result+=\"\\\"\";i+=key.length-1;type=\"afterKey\";}else if(type===\"afterKey\"&&str[i]===\":\"){result+=\":\";type=\":\";}else if(type===\":\"){var body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"||type===\"needKey\"){var last=i;while(str[last]===\",\"||isBlankChar(str[last])){last++;}\nif(str[last]===\"}\"&&last===str.length-1){while(result[result.length-1]===\",\"){result=result.substr(0,result.length-1);}\nresult+=\"}\";return result;}else if(last!==i&&result!==\"{\"){result+=\",\";type=\"needKey\";i=last-1;}}}\nthrow new Error(\"Broken JSON object near \"+result);}\nif(str[0]===\"[\"){var result=\"[\";var type=\"needBody\";for(var i=1;i<str.length;i++){if(\" \"===str[i]||\"\\n\"===str[i]||\"\\t\"===str[i]){continue;}else if(type===\"needBody\"){if(str[i]===\",\"){result+=\"null,\";continue;}\nif(str[i]===\"]\"&&i===str.length-1){if(result[result.length-1]===\",\")result=result.substr(0,result.length-1);result+=\"]\";return result;}\nvar body=getBody(str,i);i=i+body.originLength-1;result+=parse(body.body);type=\"afterBody\";}else if(type===\"afterBody\"){if(str[i]===\",\"){result+=\",\";type=\"needBody\";while(str[i+1]===\",\"||isBlankChar(str[i+1])){if(str[i+1]===\",\")result+=\"null,\";i++;}}else if(str[i]===\"]\"&&i===str.length-1){result+=\"]\";return result;}}}\nthrow new Error(\"Broken JSON array near \"+result);}}\nwindow.ocJSON=function(json){var jsonString=parse(json);return JSON.parse(jsonString);};}(window);+function(window){\"use strict\";function trimAttributes(node){$.each(node.attributes,function(){var attrName=this.name;var attrValue=this.value;if(attrName.indexOf('on')==0||attrValue.indexOf('javascript:')==0){$(node).removeAttr(attrName);}});}\nfunction sanitize(html){var output=$($.parseHTML('<div>'+html+'</div>',null,false));output.find('*').each(function(){trimAttributes(this);});return output.html();}\nwindow.ocSanitize=function(html){return sanitize(html)};}(window);+function($){\"use strict\";if($.oc===undefined)\n$.oc={}\nvar LOADER_CLASS='oc-loading';$(document).on('ajaxSetup','[data-request][data-request-flash]',function(event,context){context.options.handleErrorMessage=function(message){$.oc.flashMsg({text:message,class:'error'})}\ncontext.options.handleFlashMessage=function(message,type){$.oc.flashMsg({text:message,class:type})}})\n$(document).on('ajaxValidation','[data-request][data-request-validate]',function(event,context,errorMsg,fields){var $this=$(this).closest('form'),$container=$('[data-validate-error]',$this),messages=[],$field\n$.each(fields,function(fieldName,fieldMessages){$field=$('[data-validate-for=\"'+fieldName+'\"]',$this)\nmessages=$.merge(messages,fieldMessages)\nif(!!$field.length){if(!$field.text().length||$field.data('emptyMode')==true){$field.data('emptyMode',true).text(fieldMessages.join(', '))}\n$field.addClass('visible')}})\nif(!!$container.length){$container=$('[data-validate-error]',$this)}\nif(!!$container.length){var $oldMessages=$('[data-message]',$container)\n$container.addClass('visible')\nif(!!$oldMessages.length){var $clone=$oldMessages.first()\n$.each(messages,function(key,message){$clone.clone().text(message).insertAfter($clone)})\n$oldMessages.remove()}\nelse{$container.text(errorMsg)}}\n$this.one('ajaxError',function(event){event.preventDefault()})})\n$(document).on('ajaxPromise','[data-request][data-request-validate]',function(){var $this=$(this).closest('form')\n$('[data-validate-for]',$this).removeClass('visible')\n$('[data-validate-error]',$this).removeClass('visible')})\n$(document).on('ajaxPromise','[data-request]',function(){var $target=$(this)\nif($target.data('attach-loading')!==undefined){$target.addClass(LOADER_CLASS).prop('disabled',true)}\nif($target.is('form')){$('[data-attach-loading]',$target).addClass(LOADER_CLASS).prop('disabled',true)}}).on('ajaxFail ajaxDone','[data-request]',function(){var $target=$(this)\nif($target.data('attach-loading')!==undefined){$target.removeClass(LOADER_CLASS).prop('disabled',false)}\nif($target.is('form')){$('[data-attach-loading]',$target).removeClass(LOADER_CLASS).prop('disabled',false)}})\nvar StripeLoadIndicator=function(){var self=this\nthis.counter=0\nthis.indicator=$('<div/>').addClass('stripe-loading-indicator loaded').append($('<div />').addClass('stripe')).append($('<div />').addClass('stripe-loaded'))\nthis.stripe=this.indicator.find('.stripe')\n$(document).ready(function(){$(document.body).append(self.indicator)})}\nStripeLoadIndicator.prototype.show=function(){this.counter++\nthis.stripe.after(this.stripe=this.stripe.clone()).remove()\nif(this.counter>1){return}\nthis.indicator.removeClass('loaded')\n$(document.body).addClass('oc-loading')}\nStripeLoadIndicator.prototype.hide=function(force){this.counter--\nif(force!==undefined&&force){this.counter=0}\nif(this.counter<=0){this.indicator.addClass('loaded')\n$(document.body).removeClass('oc-loading')}}\n$.oc.stripeLoadIndicator=new StripeLoadIndicator()\n$(document).on('ajaxPromise','[data-request]',function(event){event.stopPropagation()\n$.oc.stripeLoadIndicator.show()\nvar $el=$(this)\n$(window).one('ajaxUpdateComplete',function(){if($el.closest('html').length===0)\n$.oc.stripeLoadIndicator.hide()})}).on('ajaxFail ajaxDone','[data-request]',function(event){event.stopPropagation()\n$.oc.stripeLoadIndicator.hide()})\nvar FlashMessage=function(options,el){var\noptions=$.extend({},FlashMessage.DEFAULTS,options),$element=$(el)\n$('body > p.flash-message').remove()\nif($element.length==0){$element=$('<p />').addClass(options.class).html(options.text)}\n$element.addClass('flash-message fade').attr('data-control',null).on('click','button',remove).on('click',remove).append('<button type=\"button\" class=\"close\" aria-hidden=\"true\">&times;</button>')\n$(document.body).append($element)\nsetTimeout(function(){$element.addClass('in')},100)\nvar timer=window.setTimeout(remove,options.interval*1000)\nfunction removeElement(){$element.remove()}\nfunction remove(){window.clearInterval(timer)\n$element.removeClass('in')\n$.support.transition&&$element.hasClass('fade')?$element.one($.support.transition.end,removeElement).emulateTransitionEnd(500):removeElement()}}\nFlashMessage.DEFAULTS={class:'success',text:'Default text',interval:5}\nif($.oc===undefined)\n$.oc={}\n$.oc.flashMsg=FlashMessage\n$(document).render(function(){$('[data-control=flash-message]').each(function(){$.oc.flashMsg($(this).data(),this)})})}(window.jQuery);", "/* ========================================================================\n * OctoberCMS: front-end JavaScript framework\n * http://octobercms.com\n * ========================================================================\n * Copyright 2016-2020 Alexey Bobkov, Samuel Georges\n * ======================================================================== */\n\nif (window.jQuery === undefined) {\n    throw new Error('The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.');\n}\nif (window.jQuery.request !== undefined) {\n    throw new Error('The OctoberCMS framework is already loaded.');\n}\n\n+function ($) { \"use strict\";\n\n    var Request = function (element, handler, options) {\n        var $el = this.$el = $(element);\n        this.options = options || {};\n\n        /*\n         * Validate handler name\n         */\n        if (handler === undefined) {\n            throw new Error('The request handler name is not specified.')\n        }\n\n        if (!handler.match(/^(?:\\w+\\:{2})?on*/)) {\n            throw new Error('Invalid handler name. The correct handler name format is: \"onEvent\".')\n        }\n\n        /*\n         * Prepare the options\n         */\n        var $form = options.form ? $(options.form) : $el.closest('form'),\n            $triggerEl = !!$form.length ? $form : $el,\n            context = { handler: handler, options: options }\n\n        /*\n         * Validate the form client-side\n         */\n        if ((options.browserValidate !== undefined) && typeof document.createElement('input').reportValidity == 'function' && $form && $form[0] && !$form[0].checkValidity()) {\n            $form[0].reportValidity();\n            return false;\n        }\n\n        /*\n         * Execute the request\n         */\n        $el.trigger('ajaxSetup', [context])\n        var _event = jQuery.Event('oc.beforeRequest')\n        $triggerEl.trigger(_event, context)\n        if (_event.isDefaultPrevented()) return\n\n        var loading = options.loading !== undefined ? options.loading : null,\n            url = options.url !== undefined ? options.url : window.location.href,\n            isRedirect = options.redirect !== undefined && options.redirect.length,\n            useFlash = options.flash !== undefined,\n            useFiles = options.files !== undefined\n\n        if (useFiles && typeof FormData === 'undefined') {\n            console.warn('This browser does not support file uploads via FormData')\n            useFiles = false\n        }\n\n        if ($.type(loading) == 'string') {\n            loading = $(loading)\n        }\n\n        /*\n         * Request headers\n         */\n        var requestHeaders = {\n            'X-OCTOBER-REQUEST-HANDLER': handler,\n            'X-OCTOBER-REQUEST-PARTIALS': this.extractPartials(options.update)\n        }\n\n        if (useFlash) {\n            requestHeaders['X-OCTOBER-REQUEST-FLASH'] = 1\n        }\n\n        var csrfToken = getXSRFToken()\n        if (csrfToken) {\n            requestHeaders['X-XSRF-TOKEN'] = csrfToken\n        }\n\n        /*\n         * Request data\n         */\n        var requestData,\n            inputName,\n            data = {}\n\n        $.each($el.parents('[data-request-data]').toArray().reverse(), function extendRequest() {\n            $.extend(data, paramToObj('data-request-data', $(this).data('request-data')))\n        })\n\n        if ($el.is(':input') && !$form.length) {\n            inputName = $el.attr('name')\n            if (inputName !== undefined && options.data[inputName] === undefined) {\n                options.data[inputName] = $el.val()\n            }\n        }\n\n        if (options.data !== undefined && !$.isEmptyObject(options.data)) {\n            $.extend(data, options.data)\n        }\n\n        if (useFiles) {\n            requestData = new FormData($form.length ? $form.get(0) : undefined)\n\n            if ($el.is(':file') && inputName) {\n                $.each($el.prop('files'), function() {\n                    requestData.append(inputName, this)\n                })\n\n                delete data[inputName]\n            }\n\n            $.each(data, function(key) {\n                if (typeof Blob !== \"undefined\" && this instanceof Blob && this.filename) {\n                    requestData.append(key, this, this.filename)\n                } else {\n                    requestData.append(key, this)\n                }\n            })\n        }\n        else {\n            requestData = [$form.serialize(), $.param(data)].filter(Boolean).join('&')\n        }\n\n        /*\n         * Request options\n         */\n        var requestOptions = {\n            url: url,\n            crossDomain: false,\n            global: options.ajaxGlobal,\n            context: context,\n            headers: requestHeaders,\n            success: function(data, textStatus, jqXHR) {\n                /*\n                 * Halt here if beforeUpdate() or data-request-before-update returns false\n                 */\n                if (this.options.beforeUpdate.apply(this, [data, textStatus, jqXHR]) === false) return\n                if (options.evalBeforeUpdate && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalBeforeUpdate+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))') === false) return\n\n                /*\n                 * Trigger 'ajaxBeforeUpdate' on the form, halt if event.preventDefault() is called\n                 */\n                var _event = jQuery.Event('ajaxBeforeUpdate')\n                $triggerEl.trigger(_event, [context, data, textStatus, jqXHR])\n                if (_event.isDefaultPrevented()) return\n\n                if (useFlash && data['X_OCTOBER_FLASH_MESSAGES']) {\n                    $.each(data['X_OCTOBER_FLASH_MESSAGES'], function(type, message) {\n                        requestOptions.handleFlashMessage(message, type)\n                    })\n                }\n\n                /*\n                 * Proceed with the update process\n                 */\n                var updatePromise = requestOptions.handleUpdateResponse(data, textStatus, jqXHR)\n\n                updatePromise.done(function() {\n                    $triggerEl.trigger('ajaxSuccess', [context, data, textStatus, jqXHR])\n                    options.evalSuccess && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalSuccess+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')\n                })\n\n                return updatePromise\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n                var errorMsg,\n                    updatePromise = $.Deferred()\n\n                if ((window.ocUnloading !== undefined && window.ocUnloading) || errorThrown == 'abort')\n                    return\n\n                /*\n                 * Disable redirects\n                 */\n                isRedirect = false\n                options.redirect = null\n\n                /*\n                 * Error 406 is a \"smart error\" that returns response object that is\n                 * processed in the same fashion as a successful response.\n                 */\n                if (jqXHR.status == 406 && jqXHR.responseJSON) {\n                    errorMsg = jqXHR.responseJSON['X_OCTOBER_ERROR_MESSAGE']\n                    updatePromise = requestOptions.handleUpdateResponse(jqXHR.responseJSON, textStatus, jqXHR)\n                }\n                /*\n                 * Standard error with standard response text\n                 */\n                else {\n                    errorMsg = jqXHR.responseText ? jqXHR.responseText : jqXHR.statusText\n                    updatePromise.resolve()\n                }\n\n                updatePromise.done(function() {\n                    $el.data('error-message', errorMsg)\n\n                    /*\n                     * Trigger 'ajaxError' on the form, halt if event.preventDefault() is called\n                     */\n                    var _event = jQuery.Event('ajaxError')\n                    $triggerEl.trigger(_event, [context, errorMsg, textStatus, jqXHR])\n                    if (_event.isDefaultPrevented()) return\n\n                    /*\n                     * Halt here if the data-request-error attribute returns false\n                     */\n                    if (options.evalError && eval('(function($el, context, errorMsg, textStatus, jqXHR) {'+options.evalError+'}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))') === false)\n                        return\n\n                    requestOptions.handleErrorMessage(errorMsg)\n                })\n\n                return updatePromise\n            },\n            complete: function(data, textStatus, jqXHR) {\n                $triggerEl.trigger('ajaxComplete', [context, data, textStatus, jqXHR])\n                options.evalComplete && eval('(function($el, context, data, textStatus, jqXHR) {'+options.evalComplete+'}.call($el.get(0), $el, context, data, textStatus, jqXHR))')\n            },\n\n            /*\n             * Custom function, requests confirmation from the user\n             */\n            handleConfirmMessage: function(message) {\n                var _event = jQuery.Event('ajaxConfirmMessage')\n\n                _event.promise = $.Deferred()\n                if ($(window).triggerHandler(_event, [message]) !== undefined) {\n                    _event.promise.done(function() {\n                        options.confirm = null\n                        new Request(element, handler, options)\n                    })\n                    return false\n                }\n\n                if (_event.isDefaultPrevented()) return\n                if (message) return confirm(message)\n            },\n\n            /*\n             * Custom function, display an error message to the user\n             */\n            handleErrorMessage: function(message) {\n                var _event = jQuery.Event('ajaxErrorMessage')\n                $(window).trigger(_event, [message])\n                if (_event.isDefaultPrevented()) return\n                if (message) alert(message)\n            },\n\n            /*\n             * Custom function, focus fields with errors\n             */\n            handleValidationMessage: function(message, fields) {\n                $triggerEl.trigger('ajaxValidation', [context, message, fields])\n\n                var isFirstInvalidField = true\n                $.each(fields, function focusErrorField(fieldName, fieldMessages) {\n                    fieldName = fieldName.replace(/\\.(\\w+)/g, '[$1]')\n\n                    var fieldElement = $form.find('[name=\"'+fieldName+'\"], [name=\"'+fieldName+'[]\"], [name$=\"['+fieldName+']\"], [name$=\"['+fieldName+'][]\"]').filter(':enabled').first()\n                    if (fieldElement.length > 0) {\n\n                        var _event = jQuery.Event('ajaxInvalidField')\n                        $(window).trigger(_event, [fieldElement.get(0), fieldName, fieldMessages, isFirstInvalidField])\n\n                        if (isFirstInvalidField) {\n                            if (!_event.isDefaultPrevented()) fieldElement.focus()\n                            isFirstInvalidField = false\n                        }\n                    }\n                })\n            },\n\n            /*\n             * Custom function, display a flash message to the user\n             */\n            handleFlashMessage: function(message, type) {},\n\n            /*\n             * Custom function, redirect the browser to another location\n             */\n            handleRedirectResponse: function(url) {\n                window.location.assign(url)\n            },\n\n            /*\n             * Custom function, handle any application specific response values\n             * Using a promisary object here in case injected assets need time to load\n             */\n            handleUpdateResponse: function(data, textStatus, jqXHR) {\n\n                /*\n                 * Update partials and finish request\n                 */\n                var updatePromise = $.Deferred().done(function() {\n                    for (var partial in data) {\n                        /*\n                         * If a partial has been supplied on the client side that matches the server supplied key, look up\n                         * it's selector and use that. If not, we assume it is an explicit selector reference.\n                         */\n                        var selector = (options.update[partial]) ? options.update[partial] : partial\n                        if ($.type(selector) == 'string' && selector.charAt(0) == '@') {\n                            $(selector.substring(1)).append(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                        else if ($.type(selector) == 'string' && selector.charAt(0) == '^') {\n                            $(selector.substring(1)).prepend(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                        else {\n                            $(selector).trigger('ajaxBeforeReplace')\n                            $(selector).html(data[partial]).trigger('ajaxUpdate', [context, data, textStatus, jqXHR])\n                        }\n                    }\n\n                    /*\n                     * Wait for .html() method to finish rendering from partial updates\n                     */\n                    setTimeout(function() {\n                        $(window)\n                            .trigger('ajaxUpdateComplete', [context, data, textStatus, jqXHR])\n                            .trigger('resize')\n                    }, 0)\n                })\n\n                /*\n                 * Handle redirect\n                 */\n                if (data['X_OCTOBER_REDIRECT']) {\n                    options.redirect = data['X_OCTOBER_REDIRECT']\n                    isRedirect = true\n                }\n\n                if (isRedirect) {\n                    requestOptions.handleRedirectResponse(options.redirect)\n                }\n\n                /*\n                 * Handle validation\n                 */\n                if (data['X_OCTOBER_ERROR_FIELDS']) {\n                    requestOptions.handleValidationMessage(data['X_OCTOBER_ERROR_MESSAGE'], data['X_OCTOBER_ERROR_FIELDS'])\n                }\n\n                /*\n                 * Handle asset injection\n                 */\n                 if (data['X_OCTOBER_ASSETS']) {\n                    assetManager.load(data['X_OCTOBER_ASSETS'], $.proxy(updatePromise.resolve, updatePromise))\n                 }\n                 else {\n                    updatePromise.resolve()\n                }\n\n                return updatePromise\n            }\n        }\n\n        if (useFiles) {\n            requestOptions.processData = requestOptions.contentType = false\n        }\n\n        /*\n         * Allow default business logic to be called from user functions\n         */\n        context.success = requestOptions.success\n        context.error = requestOptions.error\n        context.complete = requestOptions.complete\n        requestOptions = $.extend(requestOptions, options)\n        requestOptions.data = requestData\n\n        /*\n         * Initiate request\n         */\n        if (options.confirm && !requestOptions.handleConfirmMessage(options.confirm)) {\n            return\n        }\n\n        if (loading) loading.show()\n        $(window).trigger('ajaxBeforeSend', [context])\n        $el.trigger('ajaxPromise', [context])\n\n        return $.ajax(requestOptions)\n            .fail(function(jqXHR, textStatus, errorThrown) {\n                if (!isRedirect) {\n                    $el.trigger('ajaxFail', [context, textStatus, jqXHR])\n                }\n                if (loading) loading.hide()\n            })\n            .done(function(data, textStatus, jqXHR) {\n                if (!isRedirect) {\n                    $el.trigger('ajaxDone', [context, data, textStatus, jqXHR])\n                }\n                if (loading) loading.hide()\n            })\n            .always(function(dataOrXhr, textStatus, xhrOrError) {\n                $el.trigger('ajaxAlways', [context, dataOrXhr, textStatus, xhrOrError])\n            })\n    }\n\n    Request.DEFAULTS = {\n        update: {},\n        type : 'POST',\n        beforeUpdate: function(data, textStatus, jqXHR) {},\n        evalBeforeUpdate: null,\n        evalSuccess: null,\n        evalError: null,\n        evalComplete: null,\n        ajaxGlobal: false\n    }\n\n    /*\n     * Internal function, build a string of partials and their update elements.\n     */\n    Request.prototype.extractPartials = function(update) {\n        var result = []\n\n        for (var partial in update)\n            result.push(partial)\n\n        return result.join('&')\n    }\n\n    // REQUEST PLUGIN DEFINITION\n    // ============================\n\n    var old = $.fn.request\n\n    $.fn.request = function(handler, option) {\n        var args = arguments\n\n        var $this = $(this).first()\n        var data  = {\n            evalBeforeUpdate: $this.data('request-before-update'),\n            evalSuccess: $this.data('request-success'),\n            evalError: $this.data('request-error'),\n            evalComplete: $this.data('request-complete'),\n            ajaxGlobal: $this.data('request-ajax-global'),\n            confirm: $this.data('request-confirm'),\n            redirect: $this.data('request-redirect'),\n            loading: $this.data('request-loading'),\n            flash: $this.data('request-flash'),\n            files: $this.data('request-files'),\n            browserValidate: $this.data('browser-validate'),\n            form: $this.data('request-form'),\n            url: $this.data('request-url'),\n            update: paramToObj('data-request-update', $this.data('request-update')),\n            data: paramToObj('data-request-data', $this.data('request-data'))\n        }\n        if (!handler) handler = $this.data('request')\n        var options = $.extend(true, {}, Request.DEFAULTS, data, typeof option == 'object' && option)\n        return new Request($this, handler, options)\n    }\n\n    $.fn.request.Constructor = Request\n\n    $.request = function(handler, option) {\n        return $(document).request(handler, option)\n    }\n\n    // REQUEST NO CONFLICT\n    // =================\n\n    $.fn.request.noConflict = function() {\n        $.fn.request = old\n        return this\n    }\n\n    // REQUEST DATA-API\n    // ==============\n\n    function paramToObj(name, value) {\n        if (value === undefined) value = ''\n        if (typeof value == 'object') return value\n\n        try {\n            return ocJSON(\"{\" + value + \"}\")\n        }\n        catch (e) {\n            throw new Error('Error parsing the '+name+' attribute value. '+e)\n        }\n    }\n\n    function getXSRFToken() {\n        var cookieValue = null\n        if (document.cookie && document.cookie != '') {\n            var cookies = document.cookie.split(';')\n            for (var i = 0; i < cookies.length; i++) {\n                var cookie = jQuery.trim(cookies[i])\n                if (cookie.substring(0, 11) == ('XSRF-TOKEN' + '=')) {\n                    cookieValue = decodeURIComponent(cookie.substring(11))\n                    break\n                }\n            }\n        }\n        return cookieValue\n    }\n\n    $(document).on('change', 'select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]', function documentOnChange() {\n        $(this).request()\n    })\n\n    $(document).on('click', 'a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]', function documentOnClick(e) {\n        e.preventDefault()\n\n        $(this).request()\n\n        if ($(this).is('[type=submit]'))\n            return false\n    })\n\n    $(document).on('keydown', 'input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]', function documentOnKeydown(e) {\n        if (e.key === 'Enter') {\n            if (this.dataTrackInputTimer !== undefined)\n                window.clearTimeout(this.dataTrackInputTimer)\n\n            $(this).request()\n            return false\n        }\n    })\n\n    $(document).on('input', 'input[data-request][data-track-input]', function documentOnKeyup(e) {\n        var\n            $el = $(this),\n            lastValue = $el.data('oc.lastvalue')\n\n        if (!$el.is('[type=email],[type=number],[type=password],[type=search],[type=text]'))\n            return\n\n        if (lastValue !== undefined && lastValue == this.value)\n            return\n\n        $el.data('oc.lastvalue', this.value)\n\n        if (this.dataTrackInputTimer !== undefined)\n            window.clearTimeout(this.dataTrackInputTimer)\n\n        var interval = $(this).data('track-input')\n        if (!interval)\n            interval = 300\n\n        var self = this\n        this.dataTrackInputTimer = window.setTimeout(function() {\n            if (self.lastDataTrackInputRequest) {\n                self.lastDataTrackInputRequest.abort();\n            }\n            self.lastDataTrackInputRequest = $(self).request();\n        }, interval)\n    })\n\n    $(document).on('submit', '[data-request]', function documentOnSubmit() {\n        $(this).request()\n        return false\n    })\n\n    $(window).on('beforeunload', function documentOnBeforeUnload() {\n        window.ocUnloading = true\n    })\n\n    /*\n     * Invent our own event that unifies document.ready with window.ajaxUpdateComplete\n     *\n     * $(document).render(function() { })\n     * $(document).on('render', function() { })\n     */\n\n    $(document).ready(function triggerRenderOnReady() {\n        $(document).trigger('render')\n    })\n\n    $(window).on('ajaxUpdateComplete', function triggerRenderOnAjaxUpdateComplete() {\n        $(document).trigger('render')\n    })\n\n    $.fn.render = function(callback) {\n        $(document).on('render', callback)\n    }\n\n}(window.jQuery);\n\n/*\n * October CMS JSON Parser\n */\n+function(window) { \"use strict\";\n    function parseKey(str, pos, quote) {\n        var key = \"\";\n        for (var i = pos; i < str.length; i++) {\n            if (quote && quote === str[i]) {\n                return key;\n            } else if (!quote && (str[i] === \" \" || str[i] === \":\")) {\n                return key;\n            }\n\n            key += str[i];\n\n            if (str[i] === \"\\\\\" && i + 1 < str.length) {\n                key += str[i + 1];\n                i++;\n            }\n        }\n        throw new Error(\"Broken JSON syntax near \" + key);\n    }\n\n    function getBody(str, pos) {\n        // parse string body\n        if (str[pos] === \"\\\"\" || str[pos] === \"'\") {\n            var body = str[pos];\n            for (var i = pos + 1; i < str.length; i++) {\n                if (str[i] === \"\\\\\") {\n                    body += str[i];\n                    if (i + 1 < str.length) body += str[i + 1];\n                    i++;\n                } else if (str[i] === str[pos]) {\n                    body += str[pos];\n                    return {\n                        originLength: body.length,\n                        body: body\n                    };\n                } else body += str[i];\n            }\n            throw new Error(\"Broken JSON string body near \" + body);\n        }\n\n        // parse true / false\n        if (str[pos] === \"t\") {\n            if (str.indexOf(\"true\", pos) === pos) {\n                return {\n                    originLength: \"true\".length,\n                    body: \"true\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n        if (str[pos] === \"f\") {\n            if (str.indexOf(\"f\", pos) === pos) {\n                return {\n                    originLength: \"false\".length,\n                    body: \"false\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n\n        // parse null\n        if (str[pos] === \"n\") {\n            if (str.indexOf(\"null\", pos) === pos) {\n                return {\n                    originLength: \"null\".length,\n                    body: \"null\"\n                };\n            }\n            throw new Error(\"Broken JSON boolean body near \" + str.substr(0, pos + 10));\n        }\n\n        // parse number\n        if (str[pos] === \"-\" || str[pos] === \"+\" || str[pos] === \".\" || (str[pos] >= \"0\" && str[pos] <= \"9\")) {\n            var body = \"\";\n            for (var i = pos; i < str.length; i++) {\n                if (str[i] === \"-\" || str[i] === \"+\" || str[i] === \".\" || (str[i] >= \"0\" && str[i] <= \"9\")) {\n                    body += str[i];\n                } else {\n                    return {\n                        originLength: body.length,\n                        body: body\n                    };\n                }\n            }\n            throw new Error(\"Broken JSON number body near \" + body);\n        }\n\n        // parse object\n        if (str[pos] === \"{\" || str[pos] === \"[\") {\n            var stack = [str[pos]];\n            var body = str[pos];\n            for (var i = pos + 1; i < str.length; i++) {\n                body += str[i];\n                if (str[i] === \"\\\\\") {\n                    if (i + 1 < str.length) body += str[i + 1];\n                    i++;\n                } else if (str[i] === \"\\\"\") {\n                    if (stack[stack.length - 1] === \"\\\"\") {\n                        stack.pop();\n                    } else if (stack[stack.length - 1] !== \"'\") {\n                        stack.push(str[i]);\n                    }\n                } else if (str[i] === \"'\") {\n                    if (stack[stack.length - 1] === \"'\") {\n                        stack.pop();\n                    } else if (stack[stack.length - 1] !== \"\\\"\") {\n                        stack.push(str[i]);\n                    }\n                } else if (stack[stack.length - 1] !== \"\\\"\" && stack[stack.length - 1] !== \"'\") {\n                    if (str[i] === \"{\") {\n                        stack.push(\"{\");\n                    } else if (str[i] === \"}\") {\n                        if (stack[stack.length - 1] === \"{\") {\n                            stack.pop();\n                        } else {\n                            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n                        }\n                    } else if (str[i] === \"[\") {\n                        stack.push(\"[\");\n                    } else if (str[i] === \"]\") {\n                        if (stack[stack.length - 1] === \"[\") {\n                            stack.pop();\n                        } else {\n                            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n                        }\n                    }\n                }\n                if (!stack.length) {\n                    return {\n                        originLength: i - pos,\n                        body: body\n                    };\n                }\n            }\n            throw new Error(\"Broken JSON \" + (str[pos] === \"{\" ? \"object\" : \"array\") + \" body near \" + body);\n        }\n        throw new Error(\"Broken JSON body near \" + str.substr((pos - 5 >= 0) ? pos - 5 : 0, 50));\n    }\n\n    function canBeKeyHead(ch) {\n        if (ch[0] === \"\\\\\") return false;\n        if ((ch[0] >= 'a' && ch[0] <= 'z') || (ch[0] >= 'A' && ch[0] <= 'Z') || ch[0] === '_') return true;\n        if (ch[0] >= '0' && ch[0] <= '9') return true;\n        if (ch[0] === '$') return true;\n        if (ch.charCodeAt(0) > 255) return true;\n        return false;\n    }\n\n    function isBlankChar(ch) {\n        return ch === \" \" || ch === \"\\n\" || ch === \"\\t\";\n    }\n\n    function parse(str) {\n        str = str.trim();\n        if (!str.length) throw new Error(\"Broken JSON object.\");\n        var result = \"\";\n\n        /*\n         * the mistake ','\n         */\n        while (str && str[0] === \",\") {\n            str = str.substr(1);\n        }\n\n        /*\n         * string\n         */\n        if (str[0] === \"\\\"\" || str[0] === \"'\") {\n            if (str[str.length - 1] !== str[0]) {\n                throw new Error(\"Invalid string JSON object.\");\n            }\n\n            var body = \"\\\"\";\n            for (var i = 1; i < str.length; i++) {\n                if (str[i] === \"\\\\\") {\n                    if (str[i + 1] === \"'\") {\n                        body += str[i + 1]\n                    } else {\n                        body += str[i];\n                        body += str[i + 1];\n                    }\n                    i++;\n                } else if (str[i] === str[0]) {\n                    body += \"\\\"\";\n                    return body\n                } else if (str[i] === \"\\\"\") {\n                    body += \"\\\\\\\"\"\n                } else body += str[i];\n            }\n            throw new Error(\"Invalid string JSON object.\");\n        }\n\n        /*\n         * boolean\n         */\n        if (str === \"true\" || str === \"false\") {\n            return str;\n        }\n\n        /*\n         * null\n         */\n        if (str === \"null\") {\n            return \"null\";\n        }\n\n        /*\n         * number\n         */\n        var num = parseFloat(str);\n        if (!isNaN(num)) {\n            return num.toString();\n        }\n\n        /*\n         * object\n         */\n        if (str[0] === \"{\") {\n            var type = \"needKey\";\n            var result = \"{\";\n\n            for (var i = 1; i < str.length; i++) {\n                if (isBlankChar(str[i])) {\n                    continue;\n                } else if (type === \"needKey\" && (str[i] === \"\\\"\" || str[i] === \"'\")) {\n                    var key = parseKey(str, i + 1, str[i]);\n                    result += \"\\\"\" + key + \"\\\"\";\n                    i += key.length;\n                    i += 1;\n                    type = \"afterKey\";\n                } else if (type === \"needKey\" && canBeKeyHead(str[i])) {\n                    var key = parseKey(str, i);\n                    result += \"\\\"\";\n                    result += key;\n                    result += \"\\\"\";\n                    i += key.length - 1;\n                    type = \"afterKey\";\n                } else if (type === \"afterKey\" && str[i] === \":\") {\n                    result += \":\";\n                    type = \":\";\n                } else if (type === \":\") {\n                    var body = getBody(str, i);\n\n                    i = i + body.originLength - 1;\n                    result += parse(body.body);\n\n                    type = \"afterBody\";\n                } else if (type === \"afterBody\" || type === \"needKey\") {\n                    var last = i;\n                    while (str[last] === \",\" || isBlankChar(str[last])) {\n                        last++;\n                    }\n                    if (str[last] === \"}\" && last === str.length - 1) {\n                        while (result[result.length - 1] === \",\") {\n                            result = result.substr(0, result.length - 1);\n                        }\n                        result += \"}\";\n                        return result;\n                    } else if (last !== i && result !== \"{\") {\n                        result += \",\";\n                        type = \"needKey\";\n                        i = last - 1;\n                    }\n                }\n            }\n            throw new Error(\"Broken JSON object near \" + result);\n        }\n\n        /*\n         * array\n         */\n        if (str[0] === \"[\") {\n            var result = \"[\";\n            var type = \"needBody\";\n            for (var i = 1; i < str.length; i++) {\n                if (\" \" === str[i] || \"\\n\" === str[i] || \"\\t\" === str[i]) {\n                    continue;\n                } else if (type === \"needBody\") {\n                    if (str[i] === \",\") {\n                        result += \"null,\";\n                        continue;\n                    }\n                    if (str[i] === \"]\" && i === str.length - 1) {\n                        if (result[result.length - 1] === \",\") result = result.substr(0, result.length - 1);\n                        result += \"]\";\n                        return result;\n                    }\n\n                    var body = getBody(str, i);\n\n                    i = i + body.originLength - 1;\n                    result += parse(body.body);\n\n                    type = \"afterBody\";\n                } else if (type === \"afterBody\") {\n                    if (str[i] === \",\") {\n                        result += \",\";\n                        type = \"needBody\";\n\n                        // deal with mistake \",\"\n                        while (str[i + 1] === \",\" || isBlankChar(str[i + 1])) {\n                            if (str[i + 1] === \",\") result += \"null,\";\n                            i++;\n                        }\n                    } else if (str[i] === \"]\" && i === str.length - 1) {\n                        result += \"]\";\n                        return result;\n                    }\n                }\n            }\n            throw new Error(\"Broken JSON array near \" + result);\n        }\n    }\n\n    // Global function\n    window.ocJSON = function(json) {\n        var jsonString = parse(json);\n        return JSON.parse(jsonString);\n    };\n\n}(window);\n\n/*\n * October CMS jQuery HTML Sanitizer\n * @see https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n */\n+function(window) { \"use strict\";\n\n    function trimAttributes(node) {\n        $.each(node.attributes, function() {\n            var attrName = this.name;\n            var attrValue = this.value;\n\n            /*\n             * remove attributes where the names start with \"on\" (for example: onload, onerror...)\n             * remove attributes where the value starts with the \"javascript:\" pseudo protocol (for example href=\"javascript:alert(1)\")\n             */\n            if (attrName.indexOf('on') == 0 || attrValue.indexOf('javascript:') == 0) {\n                $(node).removeAttr(attrName);\n            }\n        });\n    }\n\n    function sanitize(html) {\n        /*\n         * [jQuery.parseHTML(data [, context ] [, keepScripts ])](http://api.jquery.com/jQuery.parseHTML/) added: 1.8\n         * Parses a string into an array of DOM nodes.\n         *\n         * By default, the context is the current document if not specified or given as null or undefined. If the HTML was to be used\n         * in another document such as an iframe, that frame's document could be used.\n         *\n         * As of 3.0 the default behavior is changed.\n         *\n         * If the context is not specified or given as null or undefined, a new document is used.\n         * This can potentially improve security because inline events will not execute when the HTML is parsed. Once the parsed HTML\n         * is injected into a document it does execute, but this gives tools a chance to traverse the created DOM and remove anything\n         * deemed unsafe. This improvement does not apply to internal uses of jQuery.parseHTML as they usually pass in the current\n         * document. Therefore, a statement like $( \"#log\" ).append( $( htmlString ) ) is still subject to the injection of malicious code.\n         *\n         * without context do not execute script\n         * $.parseHTML('<div><img src=1 onerror=alert(1)></div>');\n         * $.parseHTML('<div><img src=1 onerror=alert(2)></div>', null);\n         *\n         * with context document execute script!\n         * $.parseHTML('<div><img src=1 onerror=alert(3)></div>', document);\n         *\n         * Most jQuery APIs that accept HTML strings will run scripts that are included in the HTML. jQuery.parseHTML does not run scripts\n         * in the parsed HTML unless keepScripts is explicitly true. However, it is still possible in most environments to execute scripts\n         * indirectly, for example via the <img onerror> attribute.\n         *\n         * will return []\n         * $.parseHTML('<script>alert(1)<\\/script>', null, false);\n         *\n         * will return [script DOM element]\n         * $.parseHTML('<script>alert(1)<\\/script>', null, true);\n         */\n        var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n        output.find('*').each(function() {\n            trimAttributes(this);\n        });\n        return output.html();\n    }\n\n    // Global function\n    window.ocSanitize = function(html) {\n        return sanitize(html)\n    };\n\n}(window);"], "filenames": ["modules/backend/formwidgets/mediafinder/assets/js/mediafinder.js", "modules/backend/formwidgets/richeditor/assets/js/build-plugins-min.js", "modules/backend/formwidgets/richeditor/assets/js/richeditor.js", "modules/system/assets/js/framework-min.js", "modules/system/assets/js/framework.combined-min.js", "modules/system/assets/js/framework.js"], "buggy_code_start_loc": [9, 196, 211, 188, 188, 909], "buggy_code_end_loc": [75, 245, 344, 189, 189, 909], "fixing_code_start_loc": [9, 197, 212, 188, 188, 910], "fixing_code_end_loc": [75, 249, 351, 191, 191, 978], "type": "CWE-79", "message": "In October from version 1.0.319 and before version 1.0.467, pasting content copied from malicious websites into the Froala richeditor could result in a successful self-XSS attack. This has been fixed in 1.0.467.", "other": {"cve": {"id": "CVE-2020-4061", "sourceIdentifier": "security-advisories@github.com", "published": "2020-07-02T17:15:12.670", "lastModified": "2020-07-06T18:43:05.490", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In October from version 1.0.319 and before version 1.0.467, pasting content copied from malicious websites into the Froala richeditor could result in a successful self-XSS attack. This has been fixed in 1.0.467."}, {"lang": "es", "value": "En October desde versi\u00f3n 1.0.319 y anteriores a versi\u00f3n 1.0.467, al pegar contenido copiado desde sitios web maliciosos en el Froala richeditor podr\u00eda resultar en un ataque con \u00e9xito de tipo auto-XSS. Esto ha sido corregido en versi\u00f3n 1.0.467"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.7, "baseSeverity": "LOW"}, "exploitabilityScore": 1.2, "impactScore": 2.5}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:octobercms:october:*:*:*:*:*:*:*:*", "versionStartIncluding": "1.0.319", "versionEndExcluding": "1.0.467", "matchCriteriaId": "985DC513-C82D-4216-BB17-1E0E4E85AEBB"}]}]}], "references": [{"url": "https://github.com/octobercms/october/commit/b384954a29b89117e1c0d6035b3ede4f46df67c5", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/octobercms/october/security/advisories/GHSA-3pc2-fm7p-q2vg", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://research.securitum.com/the-curious-case-of-copy-paste/", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/octobercms/october/commit/b384954a29b89117e1c0d6035b3ede4f46df67c5"}}