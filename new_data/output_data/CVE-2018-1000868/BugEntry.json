{"buggy_code": ["<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\nif (isset($_GET['user_id']) && !empty($_GET['user_id'])) {\n    $user_id = intval($_GET['user_id']);\n    // check trying to access valid user id\n    $user->checkUserValid($user_id);\n} elseif ($user->logged_in) {\n    $user_id = $user->user_data['id'];\n} else {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'active_auctions.php';\n    header('location: user_login.php');\n    exit;\n}\n\n// get number of active auctions for this user\n$query = \"SELECT count(id) AS auctions FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 0\n\t\tAND suspended = 0\n\t\tAND starts <= CURRENT_TIMESTAMP\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$num_auctions = $db->result('auctions');\n\n// Handle pagination\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == '' || $_GET['PAGE'] < 1) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ceil($num_auctions / $system->SETTINGS['perpage']);\nif (!isset($PAGES) || $PAGES < 1) {\n    $PAGES = 1;\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 0\n\t\tAND suspended = 0\n\t\tAND starts <= CURRENT_TIMESTAMP\n\t\tORDER BY ends ASC LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$k = 0;\nwhile ($row = $db->fetch()) {\n    if (strlen($row['pict_url']) > 0) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&fromfile=' . UPLOAD_FOLDER . $row['id'] . '/' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n\n    $template->assign_block_vars('auctions', array(\n            'BGCOLOUR' => (!($k % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $row['id'],\n            'PIC_URL' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'BNIMG' => get_lang_img(($row['bn_only'] == 0) ? 'buy_it_now.gif' : 'bn_only.png'),\n            'BNVALUE' => $row['buy_now'],\n            'BNFORMAT' => $system->print_money($row['buy_now']),\n            'BIDVALUE' => $row['current_bid'],\n            'BIDFORMAT' => $system->print_money($row['current_bid']),\n            'NUM_BIDS' => $row['num_bids'],\n            'TIMELEFT' => $dt->formatTimeLeft($difference),\n\n            'B_BUY_NOW' => ($row['buy_now'] > 0 && ($row['bn_only'] || $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price'])))),\n            'B_BNONLY' => ($row['bn_only'])\n            ));\n    $k++;\n}\n\n// get this user's nick\n$query = \"SELECT nick FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TPL_user_nick = $db->result('nick');\n$page_title = $MSG['219'] . ': ' . $TPL_user_nick;\n\n$LOW = $PAGE - 5;\nif ($LOW <= 0) {\n    $LOW = 1;\n}\n$COUNTER = $LOW;\n$pagenation = '';\nwhile ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n    if ($PAGE == $COUNTER) {\n        $pagenation .= '<b>' . $COUNTER . '</b>&nbsp;&nbsp;';\n    } else {\n        $pagenation .= '<a href=\"active_auctions.php?PAGE=' . $COUNTER . '&user_id=' . $user_id . '\"><u>' . $COUNTER . '</u></a>&nbsp;&nbsp;';\n    }\n    $COUNTER++;\n}\n\n$template->assign_vars(array(\n        'B_MULPAG' => ($PAGES > 1),\n        'B_NOTLAST' => ($PAGE < $PAGES),\n        'B_NOTFIRST' => ($PAGE > 1),\n\n        'USER_RSSFEED' => sprintf($MSG['932'], $TPL_user_nick),\n        'USER_ID' => $user_id,\n        'USERNAME' => $TPL_user_nick,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'NEXT' => intval($PAGE + 1),\n        'PREV' => intval($PAGE - 1),\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n        'PAGENA' => $pagenation\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'active_auctions.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ndefine('InAdmin', 1);\n$current_page = 'auctions';\ninclude '../common.php';\ninclude INCLUDE_PATH . 'functions_admin.php';\ninclude 'loggedin.inc.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\ninclude PACKAGE_PATH . 'ckeditor/ckeditor.php';\n\n$catscontrol = new MPTTcategories();\n\n// Data check\nif (!isset($_REQUEST['id'])) {\n    $URL = $_SESSION['RETURN_LIST'];\n    header('location: ' . $URL);\n    exit;\n}\n\nfunction load_gallery($auc_id)\n{\n    $UPLOADED_PICTURES = array();\n    if (is_dir(UPLOAD_PATH . $auc_id)) {\n        if ($dir = opendir(UPLOAD_PATH . $auc_id)) {\n            while ($file = @readdir($dir)) {\n                if ($file != '.' && $file != '..' && strpos($file, 'thumb-') === false) {\n                    $UPLOADED_PICTURES[] = UPLOAD_FOLDER . $auc_id . '/' . $file;\n                }\n            }\n            closedir($dir);\n        }\n    }\n    return $UPLOADED_PICTURES;\n}\n\nif (isset($_POST['action'])) {\n    // Check that all the fields are not NULL\n    if (!empty($_POST['id']) && !empty($_POST['title']) && !empty($_POST['duration']) && !empty($_POST['category']) && !empty($_POST['description']) && !empty($_POST['min_bid'])) {\n        // fix values\n        $_POST['quantity'] = (empty($_POST['quantity'])) ? 1 : $_POST['quantity'];\n        $_POST['customincrement'] = (empty($_POST['customincrement'])) ? 0 : $_POST['customincrement'];\n        // Check the input values for validity.\n        if ($_POST['quantity'] < 1) { // 1 or more items being sold\n            $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $ERR_601));\n        } elseif (isset($_POST['current_bid']) && $_POST['current_bid'] < $_POST['min_bid'] && $_POST['current_bid'] != 0) { // bid > min_bid\n            $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $MSG['error_current_bid_too_low']));\n        } else {\n            // Retrieve auction data\n            $query = \"SELECT * from \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $_POST['id'], 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n\n            if ($AUCTION['category'] != $_POST['category']) {\n                // and increase new category counters\n                $ct = intval($_POST['category']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $ct, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $ct) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter + 1, sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n\n                // and decrease old category counters\n                $cta = intval($AUCTION['category']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $cta, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $cta) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter - 1, sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n            }\n\n            if ($AUCTION['secondcat'] != $_POST['secondcat']) {\n                // and increase new category counters\n                $ct = intval($_POST['secondcat']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $ct, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $ct) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter + 1, sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n\n                // and decrease old category counters\n                $cta = intval($AUCTION['secondcat']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $cta, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $cta) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter - 1, sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n            }\n\n            // clean unwanted images\n            if (isset($_POST['gallery']) && is_array($_POST['gallery'])) {\n                $uploaded = load_gallery($_POST['id']);\n                foreach ($uploaded as $img) {\n                    if (in_array($img, $_POST['gallery'])) {\n                        unlink(MAIN_PATH . $img);\n                    }\n                }\n            }\n\n            $start_date = new DateTime($AUCTION['starts'], $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($_POST['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET\n                      title = :title,\n                      subtitle = :subtitle,\n                      ends = :ends,\n                      duration = :duration,\n                      category = :category,\n                      secondcat = :secondcat,\n                      description = :description,\n                      quantity = :quantity,\n                      minimum_bid = :minimum_bid,\n                      shipping_cost = :shipping_cost,\n                      buy_now = :buy_now,\n                      bn_only = :bn_only,\n                      reserve_price = :reserve_price,\n                      increment = :increment,\n                      shipping = :shipping,\n                      payment = :payment,\n                      international = :international,\n                      shipping_terms = :shipping_terms,\n                      bold = :bold,\n                      highlighted = :highlighted,\n                      featured = :featured\n                      WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':title', $system->cleanvars($_POST['title']), 'str');\n            $params[] = array(':subtitle', $system->cleanvars($_POST['subtitle']), 'str');\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':duration', $_POST['duration'], 'int');\n            $params[] = array(':category', $_POST['category'], 'int');\n            $params[] = array(':secondcat', $_POST['secondcat'], 'int');\n            $params[] = array(':description', $_POST['description'], 'str');\n            $params[] = array(':quantity', $_POST['quantity'], 'int');\n            $params[] = array(':minimum_bid', $system->input_money($_POST['min_bid']), 'float');\n            $params[] = array(':shipping_cost', $system->input_money($_POST['shipping_cost']), 'float');\n            $params[] = array(':buy_now', $system->input_money($_POST['buy_now']), 'float');\n            $params[] = array(':bn_only', $_POST['buy_now_only'], 'bool');\n            $params[] = array(':reserve_price', $system->input_money($_POST['reserve_price']), 'float');\n            $params[] = array(':increment', $system->input_money($_POST['customincrement']), 'float');\n            $params[] = array(':shipping', $_POST['shipping'], 'str');\n            $params[] = array(':payment', implode(', ', $_POST['payment']), 'str');\n            $params[] = array(':international', (isset($_POST['international'])), 'bool');\n            $params[] = array(':shipping_terms', $system->cleanvars($_POST['shipping_terms']), 'str');\n            $params[] = array(':bold', (isset($_POST['is_bold'])), 'bool');\n            $params[] = array(':highlighted', (isset($_POST['is_highlighted'])), 'bool');\n            $params[] = array(':featured', (isset($_POST['is_featured'])), 'bool');\n            $params[] = array(':auc_id', $_POST['id'], 'int');\n            $db->query($query, $params);\n\n            $URL = $_SESSION['RETURN_LIST'];\n            header('location: ' . $URL);\n            exit;\n        }\n    } else {\n        $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $ERR_112));\n    }\n}\n\n$auc_id = intval($_REQUEST['id']);\n$query = \"SELECT u.nick, a.* FROM \" . $DBPrefix . \"auctions a\n          LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = a.user)\n          WHERE a.id = :auc_id\";\n$params = array();\n$params[] = array(':auc_id', $auc_id, 'int');\n$db->query($query, $params);\n\nif ($db->numrows() == 0) {\n    $URL = $_SESSION['RETURN_LIST'];\n    header('location: ' . $URL);\n    exit;\n}\n\n$auction_data = $db->result();\n\n// DURATIONS\n$query = \"SELECT days, description FROM \" . $DBPrefix . \"durations\";\n$db->direct_query($query);\n\nwhile ($row = $db->fetch()) {\n  $template->assign_block_vars('dur', array(\n      'DAYS' => $row['days'],\n      'SELECTED' => ($row['days'] == $auction_data['duration']),\n      'DESC' => $row['description']\n      ));\n}\n\n// CATEGORIES\nif (isset($category_plain) && count($category_plain) > 0) {\n  foreach ($category_plain as $cat_id => $cat_name) {\n    $template->assign_block_vars('cats1', array(\n        'CAT_ID' => $cat_id,\n        'CAT_NAME' => $cat_name,\n        'SELECTED' => ($cat_id == $auction_data['category'])\n        ));\n    $template->assign_block_vars('cats2', array(\n        'CAT_ID' => $cat_id,\n        'CAT_NAME' => $cat_name,$cat_name,\n        'SELECTED' => ($cat_id == $auction_data['secondcat'])\n        ));\n  }\n}\n\n// Pictures Gellery\n$K = 0;\n$UPLOADED_PICTURES = array();\nif (file_exists(UPLOAD_PATH . $auc_id)) {\n    // load dem pictures\n    $UPLOADED_PICTURES = load_gallery($auc_id);\n\n    if (is_array($UPLOADED_PICTURES)) {\n        foreach ($UPLOADED_PICTURES as $k => $v) {\n            $TMP = @getimagesize('../' . $v);\n            if ($TMP[2] >= 1 && $TMP[2] <= 3) {\n                $template->assign_block_vars('gallery', array(\n                    'V' => $v\n                    ));\n            }\n        }\n    }\n}\n\n// payments\n$payment = explode(', ', strtolower($auction_data['payment']));\n$payment_methods = '';\n$query = \"SELECT * FROM \" . $DBPrefix . \"payment_options\";\n$db->direct_query($query);\nwhile ($payment_method = $db->fetch()) {\n    if ($payment_method['gateway_active'] == 1 || $payment_method['is_gateway'] == 0) {\n        $checked = (in_array($payment_method['name'], $payment)) ? 'checked' : '';\n        $payment_methods .= '<p><input type=\"checkbox\" name=\"payment[]\" value=\"' . $payment_method['name'] . '\" ' . $checked . '> ' . $payment_method['displayname'] . '</p>';\n    }\n}\n\n$CKEditor = new CKEditor();\n$CKEditor->basePath = $system->SETTINGS['siteurl'] . '/js/ckeditor/';\n$CKEditor->returnOutput = true;\n$CKEditor->config['width'] = 550;\n$CKEditor->config['height'] = 400;\n\n$template->assign_vars(array(\n        'ID' => intval($_REQUEST['id']),\n        'USER' => $auction_data['nick'],\n        'TITLE' => $auction_data['title'],\n        'SUBTITLE' => $auction_data['subtitle'],\n        'EDITOR' => $CKEditor->editor('description', $auction_data['description']),\n        'CURRENT_BID' => $system->print_money_nosymbol($auction_data['current_bid']),\n        'MIN_BID' => $system->print_money_nosymbol($auction_data['minimum_bid']),\n        'QTY' => $auction_data['quantity'],\n        'PAYMENTS' => $payment_methods,\n        'ATYPE' => $system->SETTINGS['auction_types'][$auction_data['auction_type']],\n\n        'SHIPPING_COST' => $system->print_money_nosymbol($auction_data['shipping_cost']),\n        'RESERVE' => $system->print_money_nosymbol($auction_data['reserve_price']),\n        'BN_ONLY_Y' => ($auction_data['bn_only']) ? 'checked' : '',\n        'BN_ONLY_N' => ($auction_data['bn_only']) ? '' : 'checked',\n        'BN_PRICE' => $system->print_money_nosymbol($auction_data['buy_now']),\n        'CUSTOM_INC' => ($auction_data['increment'] > 0) ? $system->print_money_nosymbol($auction_data['increment']) : '',\n        'SHIPPING1' => ($auction_data['shipping'] == 1 || empty($auction_data['shipping'])) ? 'checked' : '',\n        'SHIPPING2' => ($auction_data['shipping'] == 2) ? 'checked' : '',\n        'INTERNATIONAL' => (!empty($auction_data['international'])) ? 'checked' : '',\n        'SHIPPING_TERMS' => $auction_data['shipping_terms'],\n        'IS_BOLD' => ($auction_data['bold']) ? 'checked' : '',\n        'IS_HIGHLIGHTED' => ($auction_data['highlighted']) ? 'checked' : '',\n        'IS_FEATURED' => ($auction_data['featured']) ? 'checked' : '',\n        'SUSPENDED' => ($auction_data['suspended'] == 0) ? $MSG['no'] : $MSG['yes'],\n\n        'B_MKFEATURED' => ($system->SETTINGS['ao_hpf_enabled'] == 'y'),\n        'B_MKBOLD' => ($system->SETTINGS['ao_bi_enabled'] == 'y'),\n        'B_MKHIGHLIGHT' => ($system->SETTINGS['ao_hi_enabled'] == 'y')\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'editauction.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude INCLUDE_PATH . 'datacheck.inc.php';\n\n$id = intval($_REQUEST['id']);\n$bid = (isset($_POST['bid'])) ? $_POST['bid'] : 0;\n$qty = (isset($_POST['qty'])) ? intval($_POST['qty']) : 1;\n$bidding_ended = false;\n\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5002'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'bid.php?id=' . $id;\n    header('location: user_login.php');\n    exit;\n}\n\n$bidder_id = $user->user_data['id'];\nif (in_array($user->user_data['suspended'], array(5, 6, 7))) {\n    header('location: message.php');\n    exit;\n}\n\nif (!$user->permissions['can_buy']) {\n    $_SESSION['TMP_MSG'] = $MSG['819'];\n    header('location: user_menu.php');\n    exit;\n}\n\nfunction get_increment($val, $input_check = true)\n{\n    global $db, $DBPrefix, $system;\n\n    if ($input_check) {\n        $val = $system->input_money($val);\n    }\n    // Get bid increment for current bid and calculate minimum bid\n    $query = \"SELECT increment FROM \" . $DBPrefix . \"increments WHERE\n              ((low <= :val0 AND high >= :val1) OR\n              (low < :val2 AND high < :val3)) ORDER BY increment DESC\";\n    $params = array();\n    $params[] = array(':val0', $val, 'float');\n    $params[] = array(':val1', $val, 'float');\n    $params[] = array(':val2', $val, 'float');\n    $params[] = array(':val3', $val, 'float');\n    $db->query($query, $params);\n    if ($db->numrows() != 0) {\n        $increment = $db->result('increment');\n    }\n    return $increment;\n}\n\nfunction extend_auction($id, $ends)\n{\n    global $system, $db, $DBPrefix;\n\n    if ($system->SETTINGS['ae_status'] == 'y' && (strtotime($ends) - $system->SETTINGS['ae_timebefore']) < time()) {\n        $query = \"UPDATE \" . $DBPrefix . \"auctions SET ends = DATE_ADD(ends, INTERVAL \" . $system->SETTINGS['ae_extend'] . \" SECOND) WHERE id = :auc_id\";\n        $params = array();\n        $params[] = array(':auc_id', $id, 'int');\n        $db->query($query, $params);\n    }\n}\n\n// first check if valid auction ID passed\n$query = \"SELECT a.*, u.nick, u.email, u.id AS uId FROM \" . $DBPrefix . \"auctions a\n          LEFT JOIN \" . $DBPrefix . \"users u ON (a.user = u.id)\n          WHERE a.id = :auc_id\";\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n// such auction does not exist\nif ($db->numrows() == 0) {\n    $template->assign_vars(array(\n            'TITLE_MESSAGE' => $MSG['415'],\n            'BODY_MESSAGE' => $ERR_606\n            ));\n    include 'header.php';\n    $template->set_filenames(array(\n            'body' => 'message.tpl'\n            ));\n    $template->display('body');\n    include 'footer.php';\n    exit; // kill the page\n}\n\n// check user entered a bid\nif (empty($bid) && !isset($errmsg)) {\n    $errmsg = $ERR_072;\n}\n\n// check the bid is valid\nif (!$system->CheckMoney($bid) && !isset($errmsg)) {\n    $errmsg = $ERR_058;\n} else {\n    // reformat bid to valid number\n    $bid = round($system->input_money($bid), 2);\n}\n\n$Data = $db->result();\n$item_title = htmlspecialchars($Data['title']);\n$item_id = $Data['id'];\n$seller_name = $Data['nick'];\n$seller_email = $Data['email'];\n$atype = $Data['auction_type'];\n$aquantity = $Data['quantity'];\n$minimum_bid = $Data['minimum_bid'];\n$customincrement = $Data['increment'];\n$current_bid = $Data['current_bid'];\n$pict_url_plain = $Data['pict_url'];\n$reserve = $Data['reserve_price'];\n$cbid = ($current_bid == 0) ? $minimum_bid : $current_bid;\n\nif ((strtotime($Data['ends']) <= time() || $Data['closed']) && !isset($errmsg)) {\n    $errmsg = $ERR_614;\n}\nif ((strtotime($Data['starts']) > time()) && !isset($errmsg)) {\n    $errmsg = $ERR_073;\n}\nif ($aquantity < $qty) {\n    $errmsg = $ERR_608;\n}\n\n$query = \"SELECT bid, bidder FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id ORDER BY bid DESC, id DESC LIMIT 1\";\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n$last_highest_bid = array();\nif ($db->numrows() > 0) {\n    $last_highest_bid = $db->result();\n    $high_bid = $last_highest_bid['bid'];\n    $WINNING_BIDDER = $last_highest_bid['bidder'];\n    $ARETHEREBIDS = ' | <a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '&history=view#history\">' . $MSG['105'] . '</a>';\n} else {\n    $high_bid = $current_bid;\n    $WINNING_BIDDER = 0;\n}\n\nif ($customincrement > 0) {\n    $increment = $customincrement;\n} else {\n    $increment = get_increment($high_bid, false);\n}\n\nif (ceil($high_bid) == 0 || $atype == 2) {\n    $next_bid = $minimum_bid;\n} else {\n    $next_bid = $high_bid + $increment;\n}\n\n$tmpmsg = CheckBidData();\nif ($tmpmsg != 0 && !isset($errmsg)) {\n    $errmsg = ${'ERR_' . $tmpmsg};\n}\n\nif (isset($_POST['action']) && !isset($errmsg)) {\n    if ($system->SETTINGS['usersauth'] == 'y') {\n        if (strlen($_POST['password']) == 0) {\n            $errmsg = $ERR_004;\n        }\n        include PACKAGE_PATH . 'PasswordHash.php';\n        $phpass = new PasswordHash(8, false);\n        if (!($phpass->CheckPassword($_POST['password'], $user->user_data['password']))) {\n            $errmsg = $ERR_611;\n        }\n    }\n    $send_email = false;\n    // make the bid\n    if ($atype == 1 && !isset($errmsg)) { // normal auction\n        if ($system->SETTINGS['proxy_bidding'] == 'n') {\n            // is it the highest bid?\n            if ($current_bid < $bid) {\n                // did you outbid someone?\n                $query = \"SELECT u.id FROM \" . $DBPrefix . \"bids b, \" . $DBPrefix . \"users u WHERE b.auction = :auc_id AND b.bidder = u.id and u.suspended = 0 ORDER BY bid DESC\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $db->query($query, $params);\n                // send outbid email if there are previous bidders and they where not you\n                if ($db->numrows() > 0 && $db->result('id') != $bidder_id) {\n                    $send_email = true;\n                }\n                // Also update bids table\n                $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                          VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                $params = array();\n                $params[] = array(':bid', $bid, 'float');\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':qty', $qty, 'int');\n                $db->query($query, $params);\n                $current_bid_id = $db->lastInsertId();\n                $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                $params = array();\n                $params[] = array(':bid', $bid, 'float');\n                $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                $params[] = array(':auc_id', $id, 'int');\n                $db->query($query, $params);\n                extend_auction($item_id, $Data['ends']);\n                $bidding_ended = true;\n            }\n        } elseif ($WINNING_BIDDER == $bidder_id) {\n            $query = \"SELECT bid FROM \" . $DBPrefix . \"proxybid p\n                      LEFT JOIN \" . $DBPrefix . \"users u ON (p.userid = u.id)\n                      WHERE userid = :user_id AND itemid = :item_id ORDER BY bid DESC\";\n            $params = array();\n            $params[] = array(':user_id', $user->user_data['id'], 'int');\n            $params[] = array(':item_id', $id, 'int');\n            $db->query($query, $params);\n            if ($db->numrows() > 0) {\n                $WINNER_PROXYBID = $db->result('bid');\n                if ($WINNER_PROXYBID >= $bid) {\n                    $errmsg = $ERR_040;\n                } else {\n                    // Just update proxy_bid\n                    $query = \"UPDATE \" . $DBPrefix . \"proxybid SET bid = :newbid\n                              WHERE userid = :user_id\n                              AND itemid = :item_id AND bid = :oldbid\";\n                    $params = array();\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $params[] = array(':item_id', $id, 'int');\n                    $params[] = array(':oldbid', $WINNER_PROXYBID, 'float');\n                    $params[] = array(':newbid', $bid, 'float');\n                    $db->query($query, $params);\n\n                    if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                        // Also update bids table\n                        $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                                  VALUES (:auc_id, :bidder_id, :reserve, :qty)\";\n                        $params = array();\n                        $params[] = array(':reserve', $reserve, 'float');\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':qty', $qty, 'int');\n                        $db->query($query, $params);\n                        $current_bid_id = $db->lastInsertId();\n                        $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :reserve, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                        $params = array();\n                        $params[] = array(':reserve', $reserve, 'float');\n                        $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                        $params[] = array(':auc_id', $id, 'int');\n                        $db->query($query, $params);\n                    }\n                    extend_auction($item_id, $Data['ends']);\n                    $bidding_ended = true;\n                }\n            }\n        }\n        if (!$bidding_ended && !isset($errmsg) && $system->SETTINGS['proxy_bidding'] == 'y') {\n            $query = \"SELECT p.userid, p.bid FROM \" . $DBPrefix . \"proxybid p, \" . $DBPrefix . \"users u WHERE itemid = :item_id AND p.userid = u.id and u.suspended = 0 ORDER by bid DESC LIMIT 1\";\n            $params = array();\n            $params[] = array(':item_id', $id, 'int');\n            $db->query($query, $params);\n            if ($db->numrows() == 0) { // First bid\n                $query = \"INSERT INTO \" . $DBPrefix . \"proxybid VALUES (:auc_id, :bidder_id, :bid)\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':bid', $bid, 'float');\n                $db->query($query, $params);\n\n                if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                    $next_bid = $reserve;\n                }\n                // Also update bids table\n                $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                          VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':bid', $next_bid, 'float');\n                $params[] = array(':qty', $qty, 'int');\n                $db->query($query, $params);\n                $current_bid_id = $db->lastInsertId();\n                // Only updates current bid if it is a new bidder, not the current one\n                $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                $params[] = array(':bid', $next_bid, 'float');\n                $db->query($query, $params);\n                $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 1)\";\n                $db->direct_query($query);\n            } else { // This is not the first bid\n                $proxy_bid_data = $db->result();\n                $proxy_bidder_id = $proxy_bid_data['userid'];\n                $proxy_max_bid = $proxy_bid_data['bid'];\n\n                if ($proxy_max_bid < $bid) {\n                    if ($proxy_bidder_id != $bidder_id) {\n                        $send_email = true;\n                    }\n                    $next_bid = $proxy_max_bid + $increment;\n                    if (($proxy_max_bid + $increment) > $bid) {\n                        $next_bid = $bid;\n                    }\n\n                    $query = \"SELECT userid, itemid FROM \" . $DBPrefix . \"proxybid WHERE itemid = :item_id AND userid = :bidder_id\";\n                    $params = array();\n                    $params[] = array(':item_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $db->query($query, $params);\n                    if ($db->numrows() == 0) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"proxybid VALUES (:auc_id, :bidder_id, :bid)\";\n                        $params = array();\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':bid', $bid, 'float');\n                        $db->query($query, $params);\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"proxybid SET bid = :newbid WHERE userid = :bidder_id AND itemid = :item_id\";\n                        $params = array();\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':item_id', $id, 'int');\n                        $params[] = array(':newbid', $bid, 'float');\n                        $db->query($query, $params);\n                    }\n\n                    if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                        $next_bid = $reserve;\n                    }\n                    // Fake bid to maintain a coherent history\n                    if ($current_bid < $proxy_max_bid) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                                  VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                        $params = array();\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                        $params[] = array(':bid', $proxy_max_bid, 'float');\n                        $params[] = array(':qty', $qty, 'int');\n                        $db->query($query, $params);\n                        $fakebids = 1;\n                    } else {\n                        $fakebids = 0;\n                    }\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $next_bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + (1 + :fakebids))\";\n                    $params = array();\n                    $params[] = array(':fakebids', $fakebids, 'int');\n                    $db->query($query, $params);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = (num_bids + 1 + :fakebids) WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':bid', $next_bid, 'float');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':fakebids', $fakebids, 'int');\n                    $params[] = array(':auc_id', $id, 'int');\n                    $db->query($query, $params);\n                } elseif ($proxy_max_bid == $bid) {\n                    echo 0;\n                    $cbid = $proxy_max_bid;\n                    $errmsg = $MSG['701'];\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 2)\";\n                    $db->direct_query($query);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 2 WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($cbid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    $next_bid = $cbid + $increment;\n                } elseif ($proxy_max_bid > $bid) {\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($bid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    if ($bid + $increment - $proxy_max_bid >= 0) {\n                        $cbid = $proxy_max_bid;\n                    } else {\n                        $cbid = $bid + $increment;\n                    }\n                    $errmsg = $MSG['701'];\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 2)\";\n                    $db->direct_query($query);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 2 WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($cbid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    $next_bid = $cbid + $increment;\n                }\n            }\n            extend_auction($item_id, $Data['ends']);\n        }\n    } elseif ($atype == 2 && !isset($errmsg)) { // dutch auction\n        // If the bidder already bid on this auction there new bbid must be higher\n        $query = \"SELECT bid, quantity FROM \" . $DBPrefix . \"bids WHERE bidder = :bidder_id AND auction = :auc_id ORDER BY bid DESC LIMIT 1\";\n        $params = array();\n        $params[] = array(':auc_id', $id, 'int');\n        $params[] = array(':bidder_id', $bidder_id, 'int');\n        $db->query($query, $params);\n        if ($db->numrows() > 0) {\n            $PREVIOUSBID = $db->result();\n            if (($bid * $qty) <= ($PREVIOUSBID['bid'] * $PREVIOUSBID['quantity'])) {\n                $errmsg = $ERR_059;\n            }\n        }\n        if (!isset($errmsg)) {\n            $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                      VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $params[] = array(':bidder_id', $bidder_id, 'int');\n            $params[] = array(':bid', $bid, 'float');\n            $params[] = array(':qty', $qty, 'int');\n            $db->query($query, $params);\n            $current_bid_id = $db->lastInsertId();\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 1)\";\n            $db->direct_query($query);\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $params[] = array(':current_bid_id', $current_bid_id, 'int');\n            $params[] = array(':bid', $bid, 'float');\n            $db->query($query, $params);\n            extend_auction($item_id, $Data['ends']);\n        }\n    }\n\n    // if there was a previous bidder tell them they have been outbid\n    if (count($last_highest_bid) > 0) {\n        $OldWinner_id = $last_highest_bid['bidder'];\n\n        $query = \"SELECT nick, name, email FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n        $params = array();\n        $params[] = array(':user_id', $OldWinner_id, 'int');\n        $db->query($query, $params);\n        $OldWinner = $db->result();\n\n        $OldWinner_nick = $OldWinner['nick'];\n        $OldWinner_name = $OldWinner['name'];\n        $OldWinner_email = $OldWinner['email'];\n    }\n    // Update counters table with the new bid\n    // Send notification if auction id matches (Item Watch)\n    $query = \"SELECT name, email, item_watch, id FROM \" . $DBPrefix . \"users WHERE item_watch LIKE :auc_id AND id != :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $bidder_id, 'int');\n    $params[] = array(':auc_id', '%' . $id . '%', 'str');\n    $db->query($query, $params);\n\n    $fetch = $db->fetchall();\n    foreach ($fetch as $row) {\n        // double check there is a match\n        $watch_values = explode(' ', $row['item_watch']);\n        if (in_array(strval($id), $watch_values)) {\n            // Get data about the auction\n            $query = \"SELECT title, current_bid FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $db->query($query, $params);\n            $auction_data = $db->result();\n            $emailer = new email_handler();\n            $emailer->assign_vars(array(\n                    'REALNAME' => $row['name'],\n                    'TITLE' => $auction_data['title'],\n                    'BID' => $system->print_money($bid, false),\n                    'AUCTION_URL' => $system->SETTINGS['siteurl'] . 'item.php?id=' . $id\n                    ));\n            $emailer->email_uid = $row['id'];\n            $emailer->email_sender($row['email'], 'item_watch.inc.php', $system->SETTINGS['sitename'] . ' - ' . $MSG['472']);\n        }\n    }\n    // End of Item watch\n    if ($send_email) {\n        $ends_string = $dt->printDateTz($Data['ends']);\n        $new_bid = $system->print_money($next_bid);\n        // Send e-mail message\n        include INCLUDE_PATH . 'email/outbid.php';\n    }\n\n    if (defined('TrackUserIPs')) {\n        // log auction bid IP\n        $system->log('user', 'Bid $' . $bid . '(previous bid was $' . $current_bid . ') on Item', $bidder_id, $id);\n    }\n    $template->assign_vars(array(\n            'PAGE' => 2,\n            'BID_HISTORY' => (isset($ARETHEREBIDS)) ? $ARETHEREBIDS : '',\n            'TITLE' => $item_title,\n            'ID' => $id,\n            'BID' => $system->print_money($bid),\n            'TQTY' => 0\n            ));\n}\n\nif (!isset($_POST['action']) || isset($errmsg)) {\n    // just set the needed template variables\n    $template->assign_vars(array(\n            'PAGE' => 1,\n            'ERROR' => (isset($errmsg)) ? $errmsg : '',\n            'BID_HISTORY' => (isset($ARETHEREBIDS)) ? $ARETHEREBIDS : '',\n            'ID' => $id,\n            'IMAGE' => (!empty($pict_url_plain)) ? '<img src=\"getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&fromfile=' . UPLOAD_FOLDER . $id . '/' . $pict_url_plain . '\" border=\"0\" align=\"center\">' : '&nbsp;',\n            'TITLE' => $item_title,\n            'CURRENT_BID' => $system->print_money($cbid),\n            'ATYPE' => $atype,\n            'BID' => $system->print_money_nosymbol($bid),\n            'NEXT_BID' => $system->print_money($next_bid),\n            'QTY' => $qty,\n            'TQTY' => $aquantity,\n            'AGREEMENT' => sprintf($MSG['25_0086'], $system->print_money($qty * $bid)),\n            'CURRENCY' => $system->SETTINGS['currency'],\n\n            'B_USERAUTH' => ($system->SETTINGS['usersauth'] == 'y')\n            ));\n}\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'bid.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\nif (!empty($_GET['user_id'])) {\n    $user_id = intval($_GET['user_id']);\n    // check trying to access valid user id\n    $user->checkUserValid($user_id);\n} elseif ($user->logged_in) {\n    $user_id = $user->user_data['id'];\n} else {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'closed_auctions.php';\n    header('location: user_login.php');\n    exit;\n}\n\n// get number of closed auctions for this user\n$query = \"SELECT count(id) AS auctions FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 1\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('auctions');\n\n// Handle pagination\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == 1 || $_GET['PAGE'] == '') {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\nif ($PAGES < 1) {\n    $PAGES = 1;\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 1\n\t\tORDER BY ends ASC LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n$auction_data = $db->fetchall();\n\nforeach ($auction_data as $row) {\n    $bid = $row['current_bid'];\n    $starting_price = $row['current_bid'];\n\n    if (strlen($row['pict_url']) > 0) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&fromfile=' . UPLOAD_FOLDER . $row['id'] . '/' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    // number of bids for this auction\n    $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $row['id'], 'int');\n    $db->query($query, $params);\n    $num_bids = $db->numrows();\n\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n\n    $template->assign_block_vars('auctions', array(\n            'BGCOLOUR' => (!($TOTALAUCTIONS % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $row['id'],\n            'PIC_URL' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'BNIMG' => get_lang_img(($row['bn_only'] == 0) ? 'buy_it_now.gif' : 'bn_only.png'),\n            'BNVALUE' => $row['buy_now'],\n            'BNFORMAT' => $system->print_money($row['buy_now']),\n            'BIDVALUE' => $row['minimum_bid'],\n            'BIDFORMAT' => $system->print_money($row['minimum_bid']),\n            'NUM_BIDS' => $num_bids,\n            'TIMELEFT' => $difference->format('%a') . ' ' . $MSG['126'],\n\n            'B_BUY_NOW' => ($row['buy_now'] > 0 && ($row['bn_only'] || $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price'])))),\n            'B_BNONLY' => ($row['bn_only'])\n            ));\n}\n\nif ($TOTALAUCTIONS == 0) {\n    $template->assign_block_vars('no_auctions', array());\n}\n\n// get this user's nick\n$query = \"SELECT nick FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TPL_user_nick = $db->result('nick');\n\n$LOW = $PAGE - 5;\nif ($LOW <= 0) {\n    $LOW = 1;\n}\n$COUNTER = $LOW;\n$pagenation = '';\nwhile ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n    if ($PAGE == $COUNTER) {\n        $pagenation .= '<b>' . $COUNTER . '</b>&nbsp;&nbsp;';\n    } else {\n        $pagenation .= '<a href=\"closed_auctions.php?PAGE=' . $COUNTER . '&user_id=' . $user_id . '\"><u>' . $COUNTER . '</u></a>&nbsp;&nbsp;';\n    }\n    $COUNTER++;\n}\n\n$template->assign_vars(array(\n        'B_MULPAG' => ($PAGES > 1),\n        'B_NOTLAST' => ($PAGE < $PAGES),\n        'B_NOTFIRST' => ($PAGE > 1),\n\n        'USER_ID' => $user_id,\n        'USERNAME' => $TPL_user_nick,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'NEXT' => intval($PAGE + 1),\n        'PREV' => intval($PAGE - 1),\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n        'PAGENA' => $pagenation\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'auctions_closed.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright              : (C) 2008 - 2017 WeBid\n *   site                   : http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n$w = (isset($_GET['w'])) ? intval($_GET['w']) : '';\n$_w = $w;\n$fromfile = (isset($_GET['fromfile'])) ? $_GET['fromfile'] : '';\n$nomanage = false;\n$accepted_widths = array(\n    $system->SETTINGS['thumb_show'],\n    $system->SETTINGS['thumb_list'],\n    430,\n    '' // load default image\n);\n$w = (in_array($w, $accepted_widths)) ? $w : '';\n\nfunction ErrorPNG($err)\n{\n    header('Content-type: image/png');\n    $im = imagecreate(100, 30);\n    $bgc = imagecolorallocate($im, 255, 255, 255);\n    $tc = imagecolorallocate($im, 0, 0, 0);\n    imagefilledrectangle($im, 0, 0, 100, 30, $bgc);\n    imagestring($im, 1, 5, 5, $err, $tc);\n    imagepng($im);\n}\n\nfunction load_image($file, $mime, $image_type, $output_type)\n{\n    header('Content-Type: ' . $mime);\n    $funcall = \"imagecreatefrom$image_type\";\n    $image = $funcall($file);\n    $funcall = \"image$output_type\";\n    $funcall($image);\n    exit;\n}\n\n// control parameters and file existence\nif (!isset($_GET['fromfile']) || $fromfile == '') {\n    ErrorPNG($ERR_716);\n    exit;\n} elseif (!file_exists($_GET['fromfile']) && !fopen($_GET['fromfile'], 'r')) {\n    ErrorPNG($ERR_716);\n    exit;\n}\n\nif (file_exists(UPLOAD_PATH . 'cache/' . $w . '-' . md5($fromfile))) {\n    $img = getimagesize($fromfile);\n    switch ($img[2]) {\n        case IMAGETYPE_GIF:\n            if (!(imagetypes() &IMG_GIF)) {\n                if (!function_exists('imagecreatefromgif')) {\n                    $nomanage = true;\n                } else {\n                    $img['mime'] = 'image/png';\n                }\n            } else {\n                $img['mime'] = 'image/gif';\n            }\n            break;\n        case IMAGETYPE_JPEG:\n            if (!(imagetypes() &IMG_JPG)) {\n                $nomanage = true;\n            }\n            $img['mime'] = 'image/jpeg';\n            break;\n        case IMAGETYPE_PNG:\n            if (!(imagetypes() &IMG_PNG)) {\n                $nomanage = true;\n            }\n            $img['mime'] = 'image/png';\n            break;\n        default:\n            $nomanage = true;\n            break;\n    }\n    if ($nomanage) {\n        ErrorPNG($ERR_710);\n        exit;\n    }\n    header('Content-type: ' . $img['mime']);\n    echo file_get_contents(UPLOAD_PATH . 'cache/' . $w . '-' . md5($fromfile));\n} else {\n    if (function_exists('imagetypes')) {\n        if (!is_dir(UPLOAD_PATH . 'cache')) {\n            mkdir(UPLOAD_PATH . 'cache', 0777);\n        }\n\n        $img = @getimagesize($fromfile);\n        if (is_array($img)) {\n            switch ($img[2]) {\n                case IMAGETYPE_GIF:\n                    if (!(imagetypes() &IMG_GIF)) {\n                        if (!function_exists('imagecreatefromgif')) {\n                            $nomanage = true;\n                        } else {\n                            $output_type = 'png';\n                            $img['mime'] = 'image/png';\n                        }\n                    } else {\n                        $output_type = 'gif';\n                        $img['mime'] = 'image/gif';\n                    }\n                    $image_type = 'gif';\n                    break;\n                case IMAGETYPE_JPEG:\n                    if (!(imagetypes() &IMG_JPG)) {\n                        $nomanage = true;\n                    }\n                    $output_type = 'jpeg';\n                    $img['mime'] = 'image/jpeg';\n                    $image_type = 'jpeg';\n                    break;\n                case IMAGETYPE_PNG:\n                    if (!(imagetypes() &IMG_PNG)) {\n                        $nomanage = true;\n                    }\n                    $image_type = 'png';\n                    $img['mime'] = 'image/png';\n                    $output_type = 'png';\n                    break;\n                default:\n                    ErrorPNG($ERR_710);\n                    exit;\n            }\n        } else {\n            ErrorPNG($ERR_710);\n            exit;\n        }\n        if ($w == '') {\n            // just load the image\n            load_image($fromfile, $img['mime'], $image_type, $output_type);\n        } else {\n            // check image orientation\n            if ($img[0] < $img[1]) {\n                $h = $w;\n                $ratio = floatval($img[1] / $h);\n                $w = ceil($img[0] / $ratio);\n            } else {\n                $ratio = floatval($img[0] / $w);\n                $h = ceil($img[1] / $ratio);\n            }\n        \n            $ou = imagecreatetruecolor($w, $h);\n            imagealphablending($ou, false);\n            $funcall = \"imagecreatefrom$image_type\";\n            imagecopyresampled($ou, $funcall($fromfile), 0, 0, 0, 0, $w, $h, $img[0], $img[1]);\n            $funcall = \"image$output_type\";\n            $funcall($ou, UPLOAD_PATH . 'cache/' . $_w . '-' . md5($fromfile));\n            header('Content-type: ' . $img['mime']);\n            $funcall($ou);\n            exit;\n        }\n    } else {\n        ErrorPNG($ERR_710);\n        exit;\n    }\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\nif (!defined('InWeBid')) {\n    exit();\n}\n\nfunction browseItems($query, $params, $query_feat, $params_feat, $total, $current_page, $extravar = '')\n{\n    global $system, $MSG, $ERR_114, $db, $dt;\n    global $template, $PAGES, $PAGE;\n\n    $feat_items = false;\n    if ($query_feat != '') {\n        $db->query($query_feat, $params_feat);\n        $k = 0;\n        while ($row = $db->fetch()) {\n            // get the data we need\n            $row = build_items($row);\n\n            // time left till the end of this auction\n            $current_time = new DateTime('now', $dt->UTCtimezone);\n            $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n            $difference = $current_time->diff($end_time);\n\n            $template->assign_block_vars('featured_items', array(\n                'ID' => $row['id'],\n                'IMAGE' => $row['pict_url'],\n                'TITLE' => htmlspecialchars($row['title']),\n                'SUBTITLE' => htmlspecialchars($row['subtitle']),\n                'BUY_NOW' => ($difference->invert == 1) ? '' : $row['buy_now'],\n                'BID' => $row['current_bid'],\n                'BIDFORM' => $system->print_money($row['current_bid']),\n                'CLOSES' => ($difference->format('%d') < 20) ? $dt->formatTimeLeft($difference) : $dt->printDateTz($row['ends']),\n                'NUMBIDS' => sprintf($MSG['950'], $row['num_bids']),\n\n                'B_BOLD' => ($row['bold']),\n                'B_HIGHLIGHTED' => ($row['highlighted'])\n            ));\n            $k++;\n            $feat_items = true;\n        }\n    }\n\n    $db->query($query, $params);\n    $k = 0;\n    while ($row = $db->fetch()) {\n        // get the data we need\n        $row = build_items($row);\n\n        // time left till the end of this auction\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n\n        $template->assign_block_vars('items', array(\n            'ID' => $row['id'],\n            'IMAGE' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'SUBTITLE' => htmlspecialchars($row['subtitle']),\n            'BUY_NOW' => ($difference->invert == 1) ? '' : $row['buy_now'],\n            'BID' => $row['current_bid'],\n            'BIDFORM' => $system->print_money($row['current_bid']),\n            'CLOSES' => ($difference->format('%d') < 20) ? $dt->formatTimeLeft($difference) : $dt->printDateTz($row['ends']),\n            'NUMBIDS' => sprintf($MSG['950'], $row['num_bids']),\n\n            'B_BOLD' => ($row['bold']),\n            'B_HIGHLIGHTED' => ($row['highlighted'])\n        ));\n        $k++;\n    }\n\n    $extravar = (empty($extravar)) ? '' : '&' . $extravar;\n    $PREV = intval($PAGE - 1);\n    $NEXT = intval($PAGE + 1);\n    if ($PAGES > 1) {\n        $LOW = $PAGE - 5;\n        if ($LOW <= 0) {\n            $LOW = 1;\n        }\n        $COUNTER = $LOW;\n        while ($COUNTER <= $PAGES && $COUNTER < ($PAGE+6)) {\n            $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $COUNTER . $extravar . '\"><u>' . $COUNTER . '</u></a>'\n            ));\n            $COUNTER++;\n        }\n    }\n\n    $template->assign_vars(array(\n        'B_FEATURED_ITEMS' => $feat_items,\n        'B_SUBTITLE' => ($system->SETTINGS['subtitle'] == 'y'),\n\n        'NUM_AUCTIONS' => ($total == 0) ? $ERR_114 : $total,\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $PREV . $extravar . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $NEXT . $extravar . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES\n    ));\n}\n\nfunction build_items($row)\n{\n    global $system;\n\n    // image icon\n    if (!empty($row['pict_url'])) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_list'] . '&fromfile=' . UPLOAD_FOLDER . $row['id'] . '/' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    if ($row['current_bid'] == 0) {\n        $row['current_bid'] = $row['minimum_bid'];\n    }\n\n    if ($row['buy_now'] > 0 && $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price']))) {\n        $row['buy_now'] = '<a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $row['id'] . '\"><img src=\"' . get_lang_img('buy_it_now.gif') . '\" border=0 class=\"buynow\"></a>' . $system->print_money($row['buy_now']);\n    } elseif ($row['buy_now'] > 0 && $row['bn_only']) {\n        $row['current_bid'] = $row['buy_now'];\n        $row['buy_now'] = '<a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $row['id'] . '\"><img src=\"' . get_lang_img('buy_it_now.gif') . '\" border=0 class=\"buynow\"></a>' . $system->print_money($row['buy_now']) . ' <img src=\"' . get_lang_img('bn_only.png') . '\" border=\"0\" class=\"buynow\">';\n    } else {\n        $row['buy_now'] = '';\n    }\n\n    return $row;\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\nif (!defined('InWeBid')) {\n    exit();\n}\n\nfunction generate_id()\n{\n    global $_SESSION;\n    if (!isset($_SESSION['SELL_auction_id'])) {\n        $auction_id = md5(uniqid(rand()));\n        $_SESSION['SELL_auction_id'] = $auction_id;\n    } else {\n        $auction_id = $_SESSION['SELL_auction_id'];\n    }\n    return $auction_id;\n}\n\nfunction setvars()\n{\n    global $with_reserve, $reserve_price, $minimum_bid, $pict_url, $imgtype, $title, $subtitle, $sdescription, $atype, $iquantity, $buy_now, $buy_now_price, $is_taxed, $tax_included, $additional_shipping_cost;\n    global $duration, $relist, $increments, $customincrement, $shipping, $shipping_terms, $payment, $international, $sellcat1, $sellcat2, $buy_now_only, $a_starts, $shipping_cost, $is_bold, $is_highlighted, $is_featured, $start_now;\n    global $_POST, $_SESSION, $system, $custom_end, $a_ends, $custom_end, $caneditstartdate, $dt;\n\n    $with_reserve = (isset($_POST['with_reserve'])) ? $_POST['with_reserve'] : $_SESSION['SELL_with_reserve'];\n    $reserve_price = (isset($_POST['reserve_price'])) ? $_POST['reserve_price'] : $_SESSION['SELL_reserve_price'];\n    $minimum_bid = (isset($_POST['minimum_bid'])) ? $_POST['minimum_bid'] : $_SESSION['SELL_minimum_bid'];\n    $default_minbid = ($system->SETTINGS['moneyformat'] == 1) ? 0.99 : '0,99';\n    $minimum_bid = (empty($minimum_bid)) ? $default_minbid : $minimum_bid;\n    $shipping_cost = (isset($_POST['shipping_cost'])) ? $_POST['shipping_cost'] : $_SESSION['SELL_shipping_cost'];\n    $shipping_cost = (empty($shipping_cost)) ? 0 : $shipping_cost;\n    $additional_shipping_cost = (isset($_POST['additional_shipping_cost'])) ? $_POST['additional_shipping_cost'] : $_SESSION['SELL_additional_shipping_cost'];\n    $additional_shipping_cost = (empty($additional_shipping_cost)) ? 0 : $additional_shipping_cost;\n    $imgtype = (isset($_POST['imgtype'])) ? $_POST['imgtype'] : $_SESSION['SELL_file_uploaded'];\n    $title = (isset($_POST['title'])) ? $system->cleanvars($_POST['title']) : $_SESSION['SELL_title'];\n    $subtitle = (isset($_POST['subtitle'])) ? $system->cleanvars($_POST['subtitle']) : $_SESSION['SELL_subtitle'];\n    $sdescription = (isset($_POST['sdescription'])) ? $system->cleanvars($_POST['sdescription'], true) : $_SESSION['SELL_description'];\n    $pict_url = (isset($_POST['pict_url'])) ? $_POST['pict_url'] : $_SESSION['SELL_pict_url'];\n    $atype = (isset($_POST['atype'])) ? $_POST['atype'] : $_SESSION['SELL_atype'];\n    $iquantity = (int)(isset($_POST['iquantity'])) ? $_POST['iquantity'] : $_SESSION['SELL_iquantity'];\n    $iquantity = (empty($iquantity)) ? 1 : round($iquantity);\n    $buy_now = (isset($_POST['buy_now'])) ? $_POST['buy_now'] : $_SESSION['SELL_with_buy_now'];\n    $buy_now_price = (isset($_POST['buy_now_price'])) ? $_POST['buy_now_price'] : $_SESSION['SELL_buy_now_price'];\n    $relist = (isset($_POST['autorelist'])) ? $_POST['autorelist'] : $_SESSION['SELL_relist'];\n    $increments = (isset($_POST['increments'])) ? $_POST['increments'] : $_SESSION['SELL_increments'];\n    $customincrement = (isset($_POST['customincrement'])) ? $_POST['customincrement'] : $_SESSION['SELL_customincrement'];\n    $shipping = (isset($_POST['shipping'])) ? $_POST['shipping'] : $_SESSION['SELL_shipping'];\n    $shipping_terms = (isset($_POST['shipping_terms'])) ? $system->cleanvars($_POST['shipping_terms']) : $_SESSION['SELL_shipping_terms'];\n    $payment = (isset($_POST['payment'])) ? $_POST['payment'] : $_SESSION['SELL_payment'];\n    $payment = (is_array($payment)) ? $payment : array();\n    $sellcat1 = $_SESSION['SELL_sellcat1'];\n    $_SESSION['SELL_sellcat2'] = (isset($_SESSION['SELL_sellcat2'])) ? $_SESSION['SELL_sellcat2'] : 0;\n    $sellcat2 = $_SESSION['SELL_sellcat2'];\n    $caneditstartdate = $_SESSION['SELL_caneditstartdate'];\n    $buy_now_only = (isset($_POST['buy_now_only'])) ? $_POST['buy_now_only'] : $_SESSION['SELL_buy_now_only'];\n    $buy_now_only = (empty($buy_now_only)) ? 0 : $buy_now_only;\n\n    $a_starts = (isset($_POST['a_starts'])) ? $dt->convertToDatetime($_POST['a_starts']) : $_SESSION['SELL_starts'];\n    $duration = (isset($_POST['duration'])) ? $_POST['duration'] : $_SESSION['SELL_duration'];\n    $a_ends = (isset($_POST['a_ends'])) ? $dt->convertToDatetime($_POST['a_ends']) : $_SESSION['SELL_ends'];\n\n    // deal with checkboxes\n    if (isset($_POST['action']) && $_POST['action'] == 3) {\n        $is_bold = (isset($_POST['is_bold'])) ? 1 : 0;\n        $is_featured = (isset($_POST['is_featured'])) ? 1 : 0;\n        $is_highlighted = (isset($_POST['is_highlighted'])) ? 1 : 0;\n        $international = (isset($_POST['international'])) ? 1 : 0;\n        $start_now = (isset($_POST['start_now'])) ? 1 : 0;\n        $custom_end = (isset($_POST['custom_end'])) ? 1 : 0;\n        // ignore duration for custom end date\n        $duration = ($custom_end == 1) ? 0 : $duration;\n    } else {\n        $is_bold = $_SESSION['SELL_is_bold'];\n        $is_featured = $_SESSION['SELL_is_featured'];\n        $is_highlighted = $_SESSION['SELL_is_highlighted'];\n        $international = $_SESSION['SELL_international'];\n        $start_now = $_SESSION['SELL_start_now'];\n        $custom_end = $_SESSION['SELL_custom_end'];\n    }\n\n    $is_taxed = (isset($_POST['is_taxed'])) ? $_POST['is_taxed'] : $_SESSION['SELL_is_taxed'];\n    $tax_included = (isset($_POST['tax_included'])) ? $_POST['tax_included'] : $_SESSION['SELL_tax_included'];\n    if (isset($_POST['action']) && $_POST['action'] == 2) {\n        $is_bold = (isset($_POST['is_bold'])) ? 1 : 0;\n        $is_featured = (isset($_POST['is_featured'])) ? 1 : 0;\n        $is_highlighted = (isset($_POST['is_highlighted'])) ? 1 : 0;\n        $is_taxed = (isset($_POST['is_taxed'])) ? 1 : 0;\n        $tax_included = (isset($_POST['tax_included'])) ? 1 : 0;\n        $payment = (isset($_POST['payment'])) ? $payment : array();\n    }\n}\n\nfunction makesessions()\n{\n    global $with_reserve, $reserve_price, $minimum_bid, $pict_url, $imgtype, $title, $subtitle, $sdescription, $pict_url, $atype, $iquantity, $buy_now, $buy_now_price, $is_taxed, $tax_included, $additional_shipping_cost;\n    global $duration, $relist, $increments, $customincrement, $shipping, $shipping_terms, $payment, $international, $sendemail, $buy_now_only, $a_starts, $shipping_cost, $is_bold, $is_highlighted, $is_featured, $start_now, $_SESSION;\n    global $a_ends, $custom_end, $caneditstartdate;\n\n    $_SESSION['SELL_with_reserve'] = $with_reserve;\n    $_SESSION['SELL_reserve_price'] = $reserve_price;\n    $_SESSION['SELL_minimum_bid'] = $minimum_bid;\n    $_SESSION['SELL_shipping_cost'] = $shipping_cost;\n    $_SESSION['SELL_additional_shipping_cost'] = $additional_shipping_cost;\n    $_SESSION['SELL_file_uploaded'] = $imgtype;\n    $_SESSION['SELL_title'] = $title;\n    $_SESSION['SELL_subtitle'] = $subtitle;\n    $_SESSION['SELL_description'] = $sdescription;\n    $_SESSION['SELL_pict_url'] = $pict_url;\n    $_SESSION['SELL_atype'] = $atype;\n    $_SESSION['SELL_iquantity'] = $iquantity;\n    $_SESSION['SELL_with_buy_now'] = $buy_now;\n    $_SESSION['SELL_buy_now_price'] = $buy_now_price;\n    $_SESSION['SELL_duration'] = $duration;\n    $_SESSION['SELL_relist'] = $relist;\n    $_SESSION['SELL_increments'] = $increments;\n    $_SESSION['SELL_customincrement'] = $customincrement;\n    $_SESSION['SELL_shipping'] = $shipping;\n    $_SESSION['SELL_shipping_terms'] = $shipping_terms;\n    $_SESSION['SELL_payment'] = $payment;\n    $_SESSION['SELL_international'] = $international;\n    $_SESSION['SELL_buy_now_only'] = $buy_now_only;\n    $_SESSION['SELL_starts'] = $a_starts;\n    $_SESSION['SELL_ends'] = $a_ends;\n    $_SESSION['SELL_custom_end'] = $custom_end;\n    $_SESSION['SELL_is_bold'] = $is_bold;\n    $_SESSION['SELL_is_highlighted'] = $is_highlighted;\n    $_SESSION['SELL_is_featured'] = $is_featured;\n    $_SESSION['SELL_start_now'] = $start_now;\n    $_SESSION['SELL_is_taxed'] = $is_taxed;\n    $_SESSION['SELL_tax_included'] = $tax_included;\n    $_SESSION['SELL_caneditstartdate'] = $caneditstartdate;\n}\n\nfunction unsetsessions()\n{\n    global $_SESSION, $system;\n\n    $_SESSION['SELL_with_reserve'] = '';\n    $_SESSION['SELL_reserve_price'] = '';\n    $_SESSION['SELL_minimum_bid'] = ($system->SETTINGS['moneyformat'] == 1) ? 0.99 : '0,99';\n    $_SESSION['SELL_shipping_cost'] = 0;\n    $_SESSION['SELL_additional_shipping_cost'] = 0;\n    $_SESSION['SELL_file_uploaded'] = false;\n    $_SESSION['SELL_title'] = '';\n    $_SESSION['SELL_subtitle'] = '';\n    $_SESSION['SELL_description'] = '';\n    $_SESSION['SELL_pict_url'] = '';\n    $_SESSION['SELL_pict_url_temp'] = '';\n    $_SESSION['SELL_atype'] = '';\n    $_SESSION['SELL_iquantity'] = '';\n    $_SESSION['SELL_with_buy_now'] = '';\n    $_SESSION['SELL_buy_now_price'] = '';\n    $_SESSION['SELL_duration'] = '';\n    $_SESSION['SELL_relist'] = '';\n    $_SESSION['SELL_increments'] = '';\n    $_SESSION['SELL_customincrement'] = 0;\n    $_SESSION['SELL_shipping'] = 1;\n    $_SESSION['SELL_shipping_terms'] = '';\n    $_SESSION['SELL_payment'] = array();\n    $_SESSION['SELL_international'] = false;\n    $_SESSION['SELL_sendemail'] = '';\n    $_SESSION['SELL_starts'] = '';\n    $_SESSION['SELL_ends'] = '';\n    $_SESSION['SELL_custom_end'] = 0;\n    $_SESSION['SELL_action'] = '';\n    $_SESSION['SELL_is_bold'] = 0;\n    $_SESSION['SELL_is_highlighted'] = 0;\n    $_SESSION['SELL_is_featured'] = 0;\n    $_SESSION['SELL_start_now'] = '';\n    $_SESSION['SELL_is_taxed'] = 0;\n    $_SESSION['SELL_tax_included'] = 0;\n    $_SESSION['SELL_caneditstartdate'] = true;\n}\n\nfunction updateauction()\n{\n    global $_SESSION, $DBPrefix, $dt, $a_starts, $a_ends, $payment_text, $system, $fee, $db, $caneditstartdate;\n\n    $query =\n        \"UPDATE \" . $DBPrefix . \"auctions SET\n\t\ttitle = :title,\n\t\tsubtitle = :subtitle,\n\t\tdescription = :description,\n\t\tpict_url = :pict_url,\n\t\tcategory = :catone,\n\t\tsecondcat = :cattwo,\n\t\tminimum_bid = :min_bid,\n\t\tshipping_cost = :shipping_cost,\n\t\tadditional_shipping_cost = :additional_shipping_cost,\n\t\treserve_price = :reserve_price,\n\t\tbuy_now = :buy_now,\n\t\tbn_only = :bn_only,\n\t\tauction_type = :auction_type,\n\t\tduration = :duration,\n\t\tincrement = :increment,\n\t\tshipping = :shipping,\n\t\tpayment = :payment,\n\t\tinternational = :international,\n\t\tends = :ends,\n\t\tphoto_uploaded = :photo_uploaded,\n\t\tinitial_quantity = :initial_quantity,\n\t\tquantity = :quantity,\n\t\trelist = :relist,\n\t\tshipping_terms = :shipping_terms,\n\t\tclosed = 0,\n\t\tbold = :bold,\n\t\thighlighted = :highlighted,\n\t\tfeatured = :featured,\n\t\ttax = :tax,\n\t\ttaxinc = :taxinc,\n\t\tcurrent_fee = current_fee + :fee\";\n    $params = array();\n    $params[] = array(':title', $_SESSION['SELL_title'], 'str');\n    $params[] = array(':subtitle', $_SESSION['SELL_subtitle'], 'str');\n    $params[] = array(':description', $_SESSION['SELL_description'], 'str');\n    $params[] = array(':pict_url', $_SESSION['SELL_pict_url'], 'str');\n    $params[] = array(':catone', $_SESSION['SELL_sellcat1'], 'int');\n    $params[] = array(':cattwo', $_SESSION['SELL_sellcat2'], 'int');\n    $params[] = array(':min_bid', $system->input_money(($_SESSION['SELL_buy_now_only'] == 0) ? $_SESSION['SELL_minimum_bid'] : $_SESSION['SELL_buy_now_price']), 'float');\n    $params[] = array(':shipping_cost', $system->input_money($_SESSION['SELL_shipping_cost']), 'float');\n    $params[] = array(':additional_shipping_cost', $system->input_money($_SESSION['SELL_additional_shipping_cost']), 'float');\n    $params[] = array(':reserve_price', $system->input_money(($_SESSION['SELL_with_reserve'] == 'yes') ? $_SESSION['SELL_reserve_price'] : 0), 'float');\n    $params[] = array(':buy_now', $system->input_money(($_SESSION['SELL_with_buy_now'] == 'yes') ? $_SESSION['SELL_buy_now_price'] : 0), 'float');\n    $params[] = array(':bn_only', $_SESSION['SELL_buy_now_only'], 'bool');\n    $params[] = array(':auction_type', $_SESSION['SELL_atype'], 'int');\n    $params[] = array(':duration', $_SESSION['SELL_duration'], 'int');\n    $params[] = array(':increment', $system->input_money($_SESSION['SELL_customincrement']), 'float');\n    $params[] = array(':shipping', $_SESSION['SELL_shipping'], 'int');\n    $params[] = array(':payment', $payment_text, 'str');\n    $params[] = array(':international', $_SESSION['SELL_international'], 'bool');\n    $params[] = array(':ends', $dt->convertToUTC($a_ends), 'str');\n    $params[] = array(':photo_uploaded', $_SESSION['SELL_file_uploaded'], 'bool');\n    $params[] = array(':initial_quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':relist', $_SESSION['SELL_relist'], 'int');\n    $params[] = array(':shipping_terms', $_SESSION['SELL_shipping_terms'], 'str');\n    $params[] = array(':bold', $_SESSION['SELL_is_bold'], 'bool');\n    $params[] = array(':highlighted', $_SESSION['SELL_is_highlighted'], 'bool');\n    $params[] = array(':featured', $_SESSION['SELL_is_featured'], 'bool');\n    $params[] = array(':tax', $_SESSION['SELL_is_taxed'], 'bool');\n    $params[] = array(':taxinc', $_SESSION['SELL_tax_included'], 'bool');\n    $params[] = array(':fee', $fee, 'float');\n    $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n    if ($caneditstartdate) {\n        $query .= \", starts = :starts\";\n        $params[] = array(':starts', $dt->convertToUTC($a_starts), 'str');\n    }\n    $query .= ' WHERE id = :auction_id';\n    $db->query($query, $params);\n}\n\nfunction addauction()\n{\n    global $DBPrefix, $_SESSION, $user, $a_starts, $a_ends, $payment_text, $system, $fee, $db, $dt;\n\n    $query = \"INSERT INTO \" . $DBPrefix . \"auctions (user,title,subtitle,starts,description,pict_url,category,secondcat,minimum_bid,shipping_cost,additional_shipping_cost,reserve_price,buy_now,auction_type,duration,increment,shipping,payment,international,ends,photo_uploaded,initial_quantity,quantity,relist,shipping_terms,bn_only,bold,highlighted,featured,current_fee,tax,taxinc) VALUES\n\t(:user_id, :title, :subtitle, :starts, :description, :pict_url, :catone, :cattwo, :min_bid, :shipping_cost, :additional_shipping_cost, :reserve_price, :buy_now, :auction_type, :duration, :increment, :shipping, :payment, :international, :ends, :photo_uploaded, :initial_quantity, :quantity, :relist, :shipping_terms, :bn_only, :bold, :highlighted, :featured, :fee, :tax, :taxinc)\";\n\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $params[] = array(':title', $_SESSION['SELL_title'], 'str');\n    $params[] = array(':subtitle', $_SESSION['SELL_subtitle'], 'str');\n    $params[] = array(':starts', $dt->convertToUTC($a_starts), 'str');\n    $params[] = array(':description', $_SESSION['SELL_description'], 'str');\n    $params[] = array(':pict_url', $_SESSION['SELL_pict_url'], 'str');\n    $params[] = array(':catone', $_SESSION['SELL_sellcat1'], 'int');\n    $params[] = array(':cattwo', $_SESSION['SELL_sellcat2'], 'int');\n    $params[] = array(':min_bid', $system->input_money(($_SESSION['SELL_buy_now_only'] == 0) ? $_SESSION['SELL_minimum_bid'] : $_SESSION['SELL_buy_now_price']), 'float');\n    $params[] = array(':shipping_cost', $system->input_money($_SESSION['SELL_shipping_cost']), 'float');\n    $params[] = array(':additional_shipping_cost', $system->input_money($_SESSION['SELL_additional_shipping_cost']), 'float');\n    $params[] = array(':reserve_price', $system->input_money(($_SESSION['SELL_with_reserve'] == 'yes') ? $_SESSION['SELL_reserve_price'] : 0), 'float');\n    $params[] = array(':buy_now', $system->input_money(($_SESSION['SELL_with_buy_now'] == 'yes') ? $_SESSION['SELL_buy_now_price'] : 0), 'float');\n    $params[] = array(':auction_type', $_SESSION['SELL_atype'], 'int');\n    $params[] = array(':duration', $_SESSION['SELL_duration'], 'int');\n    $params[] = array(':increment', $system->input_money($_SESSION['SELL_customincrement']), 'float');\n    $params[] = array(':shipping', $_SESSION['SELL_shipping'], 'int');\n    $params[] = array(':payment', $payment_text, 'str');\n    $params[] = array(':international', $_SESSION['SELL_international'], 'bool');\n    $params[] = array(':ends', $dt->convertToUTC($a_ends), 'str');\n    $params[] = array(':photo_uploaded', $_SESSION['SELL_file_uploaded'], 'bool');\n    $params[] = array(':initial_quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':relist', $_SESSION['SELL_relist'], 'int');\n    $params[] = array(':shipping_terms', $_SESSION['SELL_shipping_terms'], 'str');\n    $params[] = array(':bn_only', $_SESSION['SELL_buy_now_only'], 'bool');\n    $params[] = array(':bold', $_SESSION['SELL_is_bold'], 'bool');\n    $params[] = array(':highlighted', $_SESSION['SELL_is_highlighted'], 'bool');\n    $params[] = array(':featured', $_SESSION['SELL_is_featured'], 'bool');\n    $params[] = array(':fee', $fee, 'float');\n    $params[] = array(':tax', $_SESSION['SELL_is_taxed'], 'bool');\n    $params[] = array(':taxinc', $_SESSION['SELL_tax_included'], 'bool');\n    $db->query($query, $params);\n}\n\nfunction addoutstanding()\n{\n    global $DBPrefix, $fee_data, $user, $system, $fee, $_SESSION, $db;\n\n    $fee_data['total'] = $fee;\n\n    if ($_SESSION['SELL_action'] == 'edit') {\n        // set defaults\n        $fee_colomns = array(\n            'setup',\n            'featured',\n            'bold',\n            'highlighted',\n            'subtitle',\n            'relist',\n            'reserve',\n            'buynow',\n            'picture',\n            'extracat',\n            'total'\n        );\n\n        $query = \"SELECT * FROM \" . $DBPrefix . \"useraccounts WHERE auc_id = :auction_id AND user_id = :user_id\";\n        $params = array();\n        $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n        $params[] = array(':user_id', $user->user_data['id'], 'int');\n        $db->query($query, $params);\n        // build an array full of everything the user has been charged for the auction do far\n        while ($past_fee_data = $db->fetch()) {\n            foreach ($fee_colomns as $fee) {\n                $fee_string = ($fee == 'total') ? '' : '_fee';\n                $fee_data[$fee .  $fee_string] = bcsub($fee_data[$fee .  $fee_string],\n                    $past_fee_data[$fee], $system->SETTINGS['moneydecimals']);\n                if ($fee_data[$fee .  $fee_string] < 0) {\n                    $fee_data[$fee .  $fee_string] = 0;\n                }\n            }\n        }\n\n    }\n\n    $query = \"INSERT INTO \" . $DBPrefix . \"useraccounts (auc_id,user_id,setup,featured,bold,highlighted,subtitle,relist,reserve,buynow,picture,extracat,total,paid) VALUES\n\t(:auction_id, :user_id, :setup_fee, :featured_fee, :bold_fee, :highlighted_fee, :subtitle_fee, :relist_fee, :reserve_fee, :buynow_fee, :picture_fee, :extracat_fee, :fee, 0)\";\n\n    $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n    $params[] = array(':setup_fee', $fee_data['setup_fee'], 'float');\n    $params[] = array(':featured_fee', $fee_data['featured_fee'], 'float');\n    $params[] = array(':bold_fee', $fee_data['bold_fee'], 'float');\n    $params[] = array(':highlighted_fee', $fee_data['highlighted_fee'], 'float');\n    $params[] = array(':subtitle_fee', $fee_data['subtitle_fee'], 'float');\n    $params[] = array(':relist_fee', $fee_data['relist_fee'], 'float');\n    $params[] = array(':reserve_fee', $fee_data['reserve_fee'], 'float');\n    $params[] = array(':buynow_fee', $fee_data['buynow_fee'], 'float');\n    $params[] = array(':picture_fee', $fee_data['picture_fee'], 'float');\n    $params[] = array(':extracat_fee', $fee_data['extracat_fee'], 'float');\n    $params[] = array(':fee', $fee_data['total'], 'float');\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n\n    // reset fee value\n    $fee = $fee_data['total'];\n}\n\nfunction remove_bids($auction_id)\n{\n    global $DBPrefix, $db;\n    $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auction_id\";\n    $params = array();\n    $params[] = array(':auction_id', $auction_id, 'int');\n    $db->query($query, $params);\n}\n\nfunction get_fee($minimum_bid, $just_fee = true)\n{\n    global $system, $DBPrefix, $buy_now_price, $reserve_price, $is_bold, $is_highlighted, $is_featured, $_SESSION, $subtitle, $sellcat2, $relist, $db;\n\n    $query = \"SELECT * FROM \" . $DBPrefix . \"fees ORDER BY type, fee_from ASC\";\n    $db->direct_query($query);\n\n    $fee_value = 0;\n    // set defaults\n    $fee_data = array(\n        'setup_fee' => 0,\n        'featured_fee' => 0,\n        'bold_fee' => 0,\n        'highlighted_fee' => 0,\n        'subtitle_fee' => 0,\n        'relist_fee' => 0,\n        'reserve_fee' => 0,\n        'buynow_fee' => 0,\n        'picture_fee' => 0,\n        'extracat_fee' => 0\n    );\n    while ($row = $db->fetch()) {\n        if ($minimum_bid >= $row['fee_from'] && $minimum_bid <= $row['fee_to'] && $row['type'] == 'setup') {\n            if ($row['fee_type'] == 'flat') {\n                $fee_data['setup_fee'] = $row['value'];\n                $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n            } else {\n                $tmp = bcdiv($row['value'], '100', $system->SETTINGS['moneydecimals']);\n                $tmp = bcmul($tmp, $minimum_bid, $system->SETTINGS['moneydecimals']);\n                $fee_data['setup_fee'] = $tmp;\n                $fee_value = bcadd($fee_value, $tmp, $system->SETTINGS['moneydecimals']);\n            }\n        }\n        if ($row['type'] == 'buynow_fee' && $buy_now_price > 0) {\n            $fee_data['buynow_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'reserve_fee' && $reserve_price > 0) {\n            $fee_data['reserve_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'bold_fee' && $is_bold) {\n            $fee_data['bold_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'highlighted_fee' && $is_highlighted) {\n            $fee_data['highlighted_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'featured_fee' && $is_featured) {\n            $fee_data['featured_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'picture_fee' && count($_SESSION['UPLOADED_PICTURES']) > 0) {\n            $tmp = bcmul(count($_SESSION['UPLOADED_PICTURES']), $row['value'], $system->SETTINGS['moneydecimals']);\n            $fee_data['picture_fee'] = $tmp;\n            $fee_value = bcadd($fee_value, $tmp, $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'subtitle_fee' && !empty($subtitle)) {\n            $fee_data['subtitle_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'extracat_fee' && $sellcat2 > 0) {\n            $fee_data['extracat_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'relist_fee' && $relist > 0) {\n            $fee_data['relist_fee'] = ($row['value'] * $relist);\n            $fee_value = bcadd($fee_value, ($row['value'] * $relist), $system->SETTINGS['moneydecimals']);\n        }\n    }\n\n    if ($just_fee) {\n        $return = $fee_value;\n    } else {\n        $return = array($fee_value, $fee_data);\n    }\n\n    return $return;\n}\n\nfunction update_cat_counters($add, $category, $second_category = 0)\n{\n    global $_SESSION, $DBPrefix, $system, $catscontrol, $db;\n\n    $addsub = ($add) ? '+' : '-';\n    // change category counter\n    $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $category, 'int');\n    $db->query($query, $params);\n    // get the category crumbs\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $category, 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n    $category_crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n    if ($second_category > 0) {\n        // change secondary category counter\n        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $second_category, 'int');\n        $db->query($query, $params);\n        // get the second category crumbs\n        $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $second_category, 'int');\n        $db->query($query, $params);\n        $parent_node = $db->result();\n        $second_category_crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n        // merge the arrays\n        $crumbs = $category_crumbs + $second_category_crumbs;\n    } else {\n        $crumbs = $category_crumbs;\n    }\n\n    for ($i = 0; $i < count($crumbs); $i++) {\n        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n        $db->query($query, $params);\n    }\n}\n\nfunction get_category_string($sellcat)\n{\n    global $DBPrefix, $system, $catscontrol, $category_names, $db;\n\n    if (empty($sellcat) || !isset($sellcat)) {\n        return '';\n    }\n\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $sellcat, 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n\n    $TPL_categories_list = '';\n    $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n    for ($i = 0; $i < count($crumbs); $i++) {\n        if ($crumbs[$i]['cat_id'] > 0) {\n            if ($i > 0) {\n                $TPL_categories_list .= ' &gt; ';\n            }\n            $TPL_categories_list .= $category_names[$crumbs[$i]['cat_id']];\n        }\n    }\n    return $TPL_categories_list;\n}\n\n// TODO: this should be used when a user lists an item and selects gateways\nfunction check_gateway($gateway)\n{\n    global $user, $db;\n    $query = \"SELECT COUNT(id) As COUNT FROM \" . $DBPrefix . \"usergateways\n\t\t\tWHERE user_id = :user_id\n\t\t\tAND gateway_id = (SELECT id FROM \" . $DBPrefix . \"payment_options WHERE is_gateway = 1 && name = :gateway_name)\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $params[] = array(':gateway_name', $gateway, 'str');\n    $db->query($query, $params);\n    if ($db->result('COUNT') > 0) {\n        return true;\n    }\n    return false;\n}\n\nfunction alert_auction_watchers($id, $title, $description)\n{\n    global $user, $DBPrefix, $db;\n\n    // Send notification if users keyword matches (Auction Watch)\n    $query = \"SELECT auc_watch, email, nick, name, id FROM \" . $DBPrefix . \"users WHERE auc_watch != '' AND id != :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    $sent_to = array();\n    while ($row = $db->fetch()) {\n        $w_title = explode(' ', strtolower($title));\n        $w_descr = explode(' ', strtolower(str_replace(array('<br>', \"\\n\"), '', strip_tags($description))));\n        $w_nick = strtolower($user->user_data['nick']);\n        $key = explode(' ', $row['auc_watch']);\n        if (is_array($key) && count($key) > 0) {\n            foreach ($key as $k => $v) {\n                $v = trim(strtolower($v));\n                if ((in_array($v, $w_title) || in_array($v, $w_descr) || $v == $w_nick) && !in_array($row['id'], $sent_to)) {\n                    $emailer = new email_handler();\n                    $emailer->assign_vars(array(\n                            'URL' => $system->SETTINGS['siteurl'] . 'item.php?id=' . $id,\n                            'SITENAME' =>  $system->SETTINGS['sitename'],\n                            'TITLE' => $title,\n                            'REALNAME' => $row['name'],\n                            'KWORD' => $row['auc_watch']\n                            ));\n                    $emailer->email_uid = $row['id'];\n                    $emailer->email_sender($row['email'], 'auction_watchmail.inc.php', $system->SETTINGS['sitename'] . '  ' . $MSG['471']);\n                    $sent_to[] = $row['id'];\n                }\n            }\n        }\n    }\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\n\n// Run cron according to SETTINGS\nif ($system->SETTINGS['cron'] == 2) {\n    include_once 'cron.php';\n}\n\nfunction ShowFlags()\n{\n    global $system, $LANGUAGES;\n    $counter = 0;\n    $flags = '';\n    foreach ($LANGUAGES as $lang => $value) {\n        if ($counter > 3) {\n            $flags .= '<br>';\n            $counter = 0;\n        }\n        $flags .= '<a href=\"?lan=' . $lang . '\"><img vspace=\"2\" hspace=\"2\" src=\"' . $system->SETTINGS['siteurl'] . 'images/flags/' . $lang . '.gif\" border=\"0\" alt=\"' . $lang . '\"></a>';\n        $counter++;\n    }\n    return $flags;\n}\n\n// prepare categories list for templates/template\n// Prepare categories sorting\nif ($system->SETTINGS['catsorting'] == 'alpha') {\n    $catsorting = ' ORDER BY cat_name ASC';\n} else {\n    $catsorting = ' ORDER BY sub_counter DESC';\n}\n\n$query = \"SELECT cat_id FROM \" . $DBPrefix . \"categories WHERE parent_id = -1\";\n$db->direct_query($query);\n$parent_id = $db->result('cat_id');\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"categories\n\t\t\tWHERE parent_id = :parent_id\n\t\t\t\" . $catsorting . \"\n\t\t\tLIMIT :limit\";\n$params = array();\n$params[] = array(':parent_id', $parent_id, 'int');\n$params[] = array(':limit', $system->SETTINGS['catstoshow'], 'int');\n$db->query($query, $params);\n\n$cat_strings = [];\n$categories = [];\nwhile ($row = $db->fetch()) {\n    $cat_strings[$row['cat_id']] = $category_names[$row['cat_id']];\n    $categories[$row['cat_id']] = $row;\n}\n// sort the categories\nif ($system->SETTINGS['catsorting'] == 'alpha') {\n    asort($cat_strings);\n}\nforeach ($cat_strings as $cat_id => $category_name) {\n    $row = $categories[$cat_id];\n    $template->assign_block_vars('cat_list', array(\n            'CATAUCNUM' => ($row['sub_counter'] != 0) ? $row['sub_counter'] : '',\n            'ID' => $row['cat_id'],\n            'IMAGE' => (!empty($row['cat_image'])) ? '<img src=\"' . $row['cat_image'] . '\" border=0>' : '',\n            'COLOUR' => (empty($row['cat_colour'])) ? '#FFFFFF' : $row['cat_colour'],\n            'NAME' => $category_names[$row['cat_id']]\n            ));\n}\n\n// get featured items\n$query = \"SELECT id, title, current_bid, pict_url, ends, num_bids, minimum_bid, bn_only, buy_now\n\t\tFROM \" . $DBPrefix . \"auctions\n\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\tAND featured = 1\n\t\tORDER BY RAND() DESC LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['homefeaturednumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $high_bid = ($row['num_bids'] == 0) ? $row['minimum_bid'] : $row['current_bid'];\n    $high_bid = ($row['bn_only']) ? $row['buy_now'] : $high_bid;\n    $template->assign_block_vars('featured', array(\n            'ENDS' => $ends_string,\n            'ID' => $row['id'],\n            'BID' => $system->print_money($high_bid),\n            'IMAGE' => (!empty($row['pict_url'])) ? 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&amp;fromfile=' . UPLOAD_FOLDER . $row['id'] . '/' . $row['pict_url'] : 'images/email_alerts/default_item_img.jpg',\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$featured_items = ($i > 0) ? true : false;\n\n// get last created auctions\n$query = \"SELECT id, title, starts from \" . $DBPrefix . \"auctions\n\t\t\tWHERE closed = 0 AND suspended = 0\n\t\t\tAND starts <= CURRENT_TIMESTAMP\n\t\t\tORDER BY starts DESC\n\t\t\tLIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['lastitemsnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    $template->assign_block_vars('auc_last', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'DATE' => $dt->printDateTz($row['starts']),\n            'ID' => $row['id'],\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$auc_last = ($i > 0) ? true : false;\n// get ending soon auctions\n$query = \"SELECT ends, id, title FROM \" . $DBPrefix . \"auctions\n\t\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\t\tORDER BY ends LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['endingsoonnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $template->assign_block_vars('end_soon', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'DATE' => $ends_string,\n            'ID' => $row['id'],\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$end_soon = ($i > 0) ? true : false;\n// get hot items\n$query = \"SELECT a.id, a.title, a.current_bid, a.pict_url, a.ends, a.num_bids, a.minimum_bid\n\t\tFROM \" . $DBPrefix . \"auctions a\n\t\tLEFT JOIN \" . $DBPrefix . \"auccounter c ON (a.id = c.auction_id)\n\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\tORDER BY c.counter DESC LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['hotitemsnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    $i++;\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $high_bid = ($row['num_bids'] == 0) ? $row['minimum_bid'] : $row['current_bid'];\n    $template->assign_block_vars('hotitems', array(\n            'ENDS' => $ends_string,\n            'ID' => $row['id'],\n            'BID' => $system->print_money($high_bid),\n            'IMAGE' => (!empty($row['pict_url'])) ? 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&amp;fromfile=' . UPLOAD_FOLDER . $row['id'] . '/' . $row['pict_url'] : 'images/email_alerts/default_item_img.jpg',\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n}\n$hot_items = ($i > 0) ? true : false;\n\n// Build list of help topics\n$query = \"SELECT id, category FROM \" . $DBPrefix . \"faqscat_translated WHERE lang = :language ORDER BY category ASC\";\n$params = array();\n$params[] = array(':language', $language, 'str');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($faqscat = $db->fetch()) {\n    $template->assign_block_vars('helpbox', array(\n            'ID' => $faqscat['id'],\n            'TITLE' => $faqscat['category']\n            ));\n    $i++;\n}\n\n$helpbox = ($i > 0) ? true : false;\n// Build news list\nif ($system->SETTINGS['newsbox'] == 1) {\n    $query = \"SELECT n.title As t, n.new_date, t.* FROM \" . $DBPrefix . \"news n\n\t\t\tLEFT JOIN \" . $DBPrefix . \"news_translated t ON (t.id = n.id)\n\t\t\tWHERE t.lang = :language AND n.suspended = 0\n\t\t\tORDER BY new_date DESC, id DESC LIMIT :limit\";\n    $params = array();\n    $params[] = array(':language', $language, 'str');\n    $params[] = array(':limit', $system->SETTINGS['newstoshow'], 'int');\n    $db->query($query, $params);\n    while ($new = $db->fetch()) {\n        $template->assign_block_vars('newsbox', array(\n                'ID' => $new['id'],\n                'DATE' => $dt->formatDate($new['new_date']),\n                'TITLE' => (!empty($new['title'])) ? htmlspecialchars($new['title']) : htmlspecialchars($new['t'])\n                ));\n    }\n}\n\n$template->assign_vars(array(\n        'FLAGS' => ShowFlags(),\n        'B_FEATURED_ITEMS' => $featured_items,\n        'B_AUC_LAST' => $auc_last,\n        'B_HOT_ITEMS' => $hot_items,\n        'B_AUC_ENDSOON' => $end_soon,\n        'B_HELPBOX' => ($helpbox && $system->SETTINGS['helpbox'] == 1),\n        'B_MULT_LANGS' => (count($LANGUAGES) > 1),\n        'B_LOGIN_BOX' => ($system->SETTINGS['loginbox'] == 1),\n        'B_NEWS_BOX' => ($system->SETTINGS['newsbox'] == 1)\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'home.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n\nunset($_SESSION['loginerror']);\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\n\n// Get parameters from the URL\n$id = (isset($_SESSION['CURRENT_ITEM'])) ? intval($_SESSION['CURRENT_ITEM']) : 0;\n$id = (isset($_REQUEST['id'])) ? intval($_REQUEST['id']) : 0;\n\n$bidderarray = array();\n$bidderarraynum = 1;\n$catscontrol = new MPTTcategories();\n\n$_SESSION['CURRENT_ITEM'] = $id;\n$_SESSION['REDIRECT_AFTER_LOGIN'] = $system->SETTINGS['siteurl'] . 'item.php?id=' . $id;\n\n// get auction all needed data\n$query = \"SELECT a.*, ac.counter, u.nick, u.reg_date, u.city, u.country, u.zip FROM \" . $DBPrefix . \"auctions a\n\t        LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = a.user)\n\t        LEFT JOIN \" . $DBPrefix . \"auccounter ac ON (ac.auction_id = a.id)\n\t        WHERE a.id = :auction_id LIMIT 1\";\n$params = array();\n$params[] = array(':auction_id', $id, 'int');\n$db->query($query, $params);\nif ($db->numrows() == 0) {\n    $_SESSION['msg_title'] = $ERR_622;\n    $_SESSION['msg_body'] = $ERR_623;\n    header('location: message.php');\n    exit;\n}\n$auction_data = $db->result();\n$category = $auction_data['category'];\n$auction_type = $auction_data['auction_type'];\n$ends = $auction_data['ends'];\n$start = $auction_data['starts'];\n$user_id = $auction_data['user'];\n$minimum_bid = $auction_data['minimum_bid'];\n$high_bid = $auction_data['current_bid'];\n$customincrement = $auction_data['increment'];\n$seller_reg = $dt->formatDate($auction_data['reg_date']);\n\n// sort out counter\nif (!isset($auction_data['counter'])) {\n    $query = \"INSERT INTO `\" . $DBPrefix . \"auccounter` (`auction_id`, `counter`) VALUES (:counter, 1)\";\n    $params = array();\n    $params[] = array(':counter', $id, 'int');\n    $db->query($query, $params);\n    $auction_data['counter'] = 1;\n} else {\n    if (!isset($_SESSION['WEBID_VIEWED_AUCTIONS'])) {\n        $_SESSION['WEBID_VIEWED_AUCTIONS'] = array();\n    }\n    if (!in_array($id, $_SESSION['WEBID_VIEWED_AUCTIONS'])) {\n        $query = \"UPDATE \" . $DBPrefix . \"auccounter set counter = counter + 1 WHERE auction_id = :auction_id\";\n        $params = array();\n        $params[] = array(':auction_id', $id, 'int');\n        $db->query($query, $params);\n        $_SESSION['WEBID_VIEWED_AUCTIONS'][] = $id;\n    }\n}\n\n// get watch item data\nif ($user->logged_in) {\n    // Check if this item is not already added\n    $query = \"SELECT item_watch FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    $watcheditems = trim($db->result('item_watch'));\n    $auc_ids = explode(' ', $watcheditems);\n\n    if (in_array($id, $auc_ids)) {\n        $watch_var = 'delete';\n        $watch_string = $MSG['5202_0'];\n    } else {\n        $watch_var = 'add';\n        $watch_string = $MSG['5202'];\n    }\n} else {\n    $watch_var = '';\n    $watch_string = '';\n}\n\n// get ending time\n$showendtime = false;\n$has_ended = false;\n$difference = null;\nif (strtotime($start) > time()) {\n    $ending_time = '<span class=\"errfont\">' . $MSG['668'] . '</span>';\n} elseif (strtotime($ends) - time() > 0) {\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($ends, $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n    $ending_time = '';\n    $date_elements = 0;\n    //Display Years\n    if ($difference->y > 0){\n        $timemsg = ($difference->y == 1) ? $MSG['count_year'] : $MSG['count_years'];\n        $ending_time .= $difference->y . $timemsg;\n        $date_elements++;\n    }\n    //Display Months\n    if ($difference->m > 0) {\n        $timemsg = ($difference->m == 1) ? $MSG['count_month'] : $MSG['count_months'];\n        if ($difference->y > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->m . $timemsg;\n        $date_elements++;\n    }\n    //Display Days\n    if ($difference->d > 0) {\n        $timemsg = ($difference->d == 1) ? $MSG['count_day'] : $MSG['count_days'];\n        if ($difference->y > 0 || $difference->m > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->d . $timemsg;\n        $date_elements++;\n    }\n    //Display Hours\n    if ($difference->h > 0 && $date_elements < 3) {\n        $timemsg = ($difference->h == 1) ? $MSG['count_hour'] : $MSG['count_hours'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0) {\n            $comma = \", \";\n\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma .  $difference->h . $timemsg ;\n        $date_elements++;\n    }\n    //Display Minutes\n    if ($difference->i > 0 && $date_elements < 3) {\n        $timemsg = ($difference->i == 1) ? $MSG['count_minute'] : $MSG['count_minutes'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0 || $difference->h > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->i . $timemsg;\n        $date_elements++;\n    }\n    //Display Seconds\n    if ($difference->s > 0 && $date_elements < 3) {\n        $timemsg = ($difference->s == 1) ? $MSG['count_second'] : $MSG['count_seconds'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0 || $difference->h > 0 || $difference->i > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->s . $timemsg;\n    }\n    $showendtime = true;\n} else {\n    $ending_time = '<span class=\"errfont\">' . $MSG['911'] . '</span>';\n    $has_ended = true;\n}\n\n// build bread crumbs\n$query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n$params = array();\n$params[] = array(':cat_id', $auction_data['category'], 'int');\n$db->query($query, $params);\n$parent_node = $db->result();\n\n$cat_value = '';\n$crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\nfor ($i = 0; $i < count($crumbs); $i++) {\n    if ($crumbs[$i]['cat_id'] > 0) {\n        if ($i > 0) {\n            $cat_value .= ' > ';\n        }\n        $cat_value .= '<a href=\"' . $system->SETTINGS['siteurl'] . 'browse.php?id=' . $crumbs[$i]['cat_id'] . '\">' . $category_names[$crumbs[$i]['cat_id']] . '</a>';\n    }\n}\n\n$secondcat_value = '';\nif ($system->SETTINGS['extra_cat'] == 'y' && intval($auction_data['secondcat']) > 0) {\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :sec_cat_id\";\n    $params = array();\n    $params[] = array(':sec_cat_id', $auction_data['secondcat'], 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n\n    $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n    for ($i = 0; $i < count($crumbs); $i++) {\n        if ($crumbs[$i]['cat_id'] > 0) {\n            if ($i > 0) {\n                $secondcat_value .= ' > ';\n            }\n            $secondcat_value .= '<a href=\"' . $system->SETTINGS['siteurl'] . 'browse.php?id=' . $crumbs[$i]['cat_id'] . '\">' . $category_names[$crumbs[$i]['cat_id']] . '</a>';\n        }\n    }\n}\n\n// history\n$query = \"SELECT b.*, u.nick, u.rate_sum FROM \" . $DBPrefix . \"bids b\n\t        LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = b.bidder)\n\t        WHERE b.auction = :auc_id\";\nif ($auction_data['bn_only'] || $auction_type == 2) {\n    $query .= \" ORDER BY b.bidwhen DESC\";\n} else {\n    $query .= \" ORDER BY b.bid DESC, b.quantity DESC, b.id DESC\";\n}\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n$num_bids = $db->numrows();\n$i = 0;\n$left = $auction_data['quantity'];\n$hbidder_data = array();\nforeach ($db->fetchall() as $bidrec) {\n    if (!isset($bidderarray[$bidrec['nick']])) {\n        if ($system->SETTINGS['buyerprivacy'] == 'y' && (!$user->logged_in || ($user->user_data['id'] != $auction_data['user'] && $user->user_data['id'] != $bidrec['bidder']))) {\n            $bidderarray[$bidrec['nick']] = $MSG['176'] . ' ' . $bidderarraynum;\n            $bidderarraynum++;\n        } else {\n            $bidderarray[$bidrec['nick']] = $bidrec['nick'];\n        }\n    }\n    if ($left > 0 && !in_array($bidrec['bidder'], $hbidder_data)) { //store highest bidder details\n        $hbidder_data[] = $bidrec['bidder'];\n        $fb_pos = $fb_neg = 0;\n        // get seller feebacks\n        $query = \"SELECT rate FROM \" . $DBPrefix . \"feedbacks WHERE rated_user_id = :rate_users_id\";\n        $params = array();\n        $params[] = array(':rate_users_id', $bidrec['bidder'], 'int');\n        $db->query($query, $params);\n        // count numbers\n        $fb_pos = $fb_neg = 0;\n        while ($fb_arr = $db->fetch()) {\n            if ($fb_arr['rate'] == 1) {\n                $fb_pos++;\n            } elseif ($fb_arr['rate'] == - 1) {\n                $fb_neg++;\n            }\n        }\n\n        $total_rate = $fb_pos - $fb_neg;\n        $query = \"SELECT icon FROM \" . $DBPrefix . \"membertypes WHERE feedbacks <= :feedback ORDER BY feedbacks DESC LIMIT 1;\";\n        $params = array();\n        $params[] = array(':feedback', $bidrec['rate_sum'], 'int');\n        $db->query($query, $params);\n        $feedback_icon = $db->result('icon');\n        $template->assign_block_vars('high_bidders', array(\n                'BUYER_ID' => $bidrec['bidder'],\n                'BUYER_NAME' => $bidderarray[$bidrec['nick']],\n                'BUYER_FB' => $bidrec['rate_sum'],\n                'BUYER_FB_ICON' => $feedback_icon\n                ));\n    }\n    $template->assign_block_vars('bidhistory', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $bidrec['bidder'],\n            'NAME' => $bidderarray[$bidrec['nick']],\n            'BID' => $system->print_money($bidrec['bid']),\n            'WHEN' => $dt->formatDate($bidrec['bidwhen'], 'd F Y - H:i:s'),\n            'QTY' => $bidrec['quantity']\n            ));\n    $left -= $bidrec['quantity'];\n    $i++;\n}\n\n$userbid = false;\nif ($user->logged_in && $num_bids > 0) {\n    // check if youve bid on this before\n    $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :auction AND bidder = :bidder LIMIT 1\";\n    $params = array();\n    $params[] = array(':auction', $id, 'int');\n    $params[] = array(':bidder', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    if ($db->numrows() > 0) {\n        if (in_array($user->user_data['id'], $hbidder_data)) {\n            $yourbidmsg = $MSG['25_0088'];\n            $yourbidclass = 'yourbidwin';\n\t    $difference = $current_time->diff($end_time);\n            if ($difference->invert && $auction_data['reserve_price'] > 0 && $auction_data['current_bid'] < $auction_data['reserve_price']) {\n                $yourbidmsg = $MSG['514'];\n                $yourbidclass = 'yourbidloss';\n            } elseif ($difference->invert || $auction_data['bn_only']) {\n                $yourbidmsg = $MSG['25_0089'];\n            }\n        } elseif ($auction_data['bn_only']) {\n            $yourbidmsg = $MSG['25_0089'];\n            $yourbidclass = 'yourbidwin';\n        } else {\n            $yourbidmsg = $MSG['25_0087'];\n            $yourbidclass = 'yourbidloss';\n        }\n        $userbid = true;\n    }\n}\n\n// sort out user questions\n$query = \"SELECT id FROM \" . $DBPrefix . \"messages WHERE reply_of = 0 AND public = 1 AND question = :question_id\";\n$params = array();\n$params[] = array(':question_id', $id, 'int');\n$db->query($query, $params);\n$num_questions = $db->numrows();\nforeach ($db->fetchall() as $row) {\n    $template->assign_block_vars('questions', array()); // just need to create the block\n    $query = \"SELECT sentfrom, message FROM \" . $DBPrefix . \"messages WHERE question = :id AND reply_of = :reply_of OR id = :message_id ORDER BY sentat ASC\";\n    $params = array();\n    $params[] = array(':id', $id, 'int');\n    $params[] = array(':reply_of', $row['id'], 'int');\n    $params[] = array(':message_id', $row['id'], 'int');\n    $db->query($query, $params);\n    while ($row_ = $db->fetch()) {\n        $template->assign_block_vars('questions.conv', array(\n                'MESSAGE' => $row_['message'],\n                'BY_WHO' => ($user_id == $row_['sentfrom']) ? $MSG['125'] : $MSG['555']\n                ));\n    }\n}\n\n$high_bid = ($num_bids == 0) ? $minimum_bid : $high_bid;\n\nif ($customincrement == 0) {\n    // Get bid increment for current bid and calculate minimum bid\n    $query = \"SELECT increment FROM \" . $DBPrefix . \"increments WHERE\n              ((low <= :val0 AND high >= :val1) OR\n              (low < :val2 AND high < :val3)) ORDER BY increment DESC\";\n    $params = array();\n    $params[] = array(':val0', $high_bid, 'float');\n    $params[] = array(':val1', $high_bid, 'float');\n    $params[] = array(':val2', $high_bid, 'float');\n    $params[] = array(':val3', $high_bid, 'float');\n    $db->query($query, $params);\n    if ($db->numrows() != 0) {\n        $increment = $db->result('increment');\n    }\n} else {\n    $increment = $customincrement;\n}\n\nif ($auction_type == 2) {\n    $increment = 0;\n}\n\nif ($customincrement > 0) {\n    $increment = $customincrement;\n}\n\nif ($num_bids == 0 || $auction_type == 2) {\n    $next_bidp = $minimum_bid;\n} else {\n    $next_bidp = $high_bid + $increment;\n}\n\n$view_history = '';\nif ($num_bids > 0 && !isset($_GET['history'])) {\n    $view_history = '(<a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '&history=view#history\">' . $MSG['105'] . '</a>)';\n} elseif (isset($_GET['history'])) {\n    $view_history = '(<a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '\">' . $MSG['507'] . '</a>)';\n}\n$min_bid = $system->print_money($minimum_bid);\n$high_bid = $system->print_money($high_bid);\nif ($difference != null && !$difference->invert) {\n    $next_bid = $system->print_money($next_bidp);\n} else {\n    $next_bid = '--';\n}\n\n// get seller feebacks\n$query = \"SELECT rate FROM \" . $DBPrefix . \"feedbacks WHERE rated_user_id = :user_id\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$num_feedbacks = $db->numrows();\n// count numbers\n$fb_pos = $fb_neg = 0;\nwhile ($fb_arr = $db->fetch()) {\n    if ($fb_arr['rate'] == 1) {\n        $fb_pos++;\n    } elseif ($fb_arr['rate'] == - 1) {\n        $fb_neg++;\n    }\n}\n\n$total_rate = $fb_pos - $fb_neg;\n\n$query = \"SELECT icon FROM \" . $DBPrefix . \"membertypes WHERE feedbacks <= :feedback ORDER BY feedbacks DESC LIMIT 1;\";\n$params = array();\n$params[] = array(':feedback', $total_rate, 'int');\n$db->query($query, $params);\n$seller_feedback_icon = $db->result('icon');\n\n// Pictures Gellery\n$K = 0;\n$UPLOADED_PICTURES = array();\nif (is_dir(UPLOAD_PATH . $id)) {\n    $dir = opendir(UPLOAD_FOLDER . $id);\n    if ($dir) {\n        while ($file = @readdir($dir)) {\n            if ($file != '.' && $file != '..' && strpos($file, 'thumb-') === false) {\n                $UPLOADED_PICTURES[$K] = $file;\n                $K++;\n            }\n        }\n        closedir($dir);\n    }\n    $GALLERY_DIR = $id;\n\n    if (is_array($UPLOADED_PICTURES)) {\n        foreach ($UPLOADED_PICTURES as $k => $v) {\n            $TMP = @getimagesize(UPLOAD_FOLDER . $id . '/' . $v);\n            if ($TMP[2] >= 1 && $TMP[2] <= 3) {\n                $template->assign_block_vars('gallery', array(\n                        'V' => $v\n                        ));\n            }\n        }\n    }\n}\n\n// payment methods\n$payment = explode(', ', $auction_data['payment']);\n$payment_methods = '';\n$query = \"SELECT gateway_active, is_gateway, name, displayname FROM \" . $DBPrefix . \"payment_options\";\n$db->direct_query($query);\n$p_first = true;\nwhile ($payment_method = $db->fetch()) {\n    if ($payment_method['gateway_active'] == 1 || $payment_method['is_gateway'] == 0) {\n        if (in_array($payment_method['name'], $payment)) {\n            if (!$p_first) {\n                $payment_methods .= ', ';\n            } else {\n                $p_first = false;\n            }\n            $payment_methods .= $payment_method['displayname'];\n        }\n    }\n}\n\n$bn_link = (!$has_ended) ? ' <a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $id . '\"><img border=\"0\" align=\"absbottom\" alt=\"' . $MSG['496'] . '\" src=\"' . get_lang_img('buy_it_now.gif') . '\"></a>' : '';\n\n$page_title = htmlspecialchars($auction_data['title']);\n\n$shipping = '';\nif ($auction_data['shipping'] == 1) {\n    $shipping = $MSG['031'];\n} elseif ($auction_data['shipping'] == 2) {\n    $shipping = $MSG['032'];\n} elseif ($auction_data['shipping'] == 3) {\n    $shipping = $MSG['867'];\n}\n\n$template->assign_vars(array(\n        'ID' => $auction_data['id'],\n        'TITLE' => htmlspecialchars($auction_data['title']),\n        'SUBTITLE' => htmlspecialchars($auction_data['subtitle']),\n        'AUCTION_DESCRIPTION' => $auction_data['description'],\n        'PIC_URL' => UPLOAD_FOLDER . $id . '/' . $auction_data['pict_url'],\n        'SHIPPING_COST' => ($auction_data['shipping_cost'] > 0) ? $system->print_money($auction_data['shipping_cost']) : $MSG['1152'],\n        'ADDITIONAL_SHIPPING_COST' => $system->print_money($auction_data['additional_shipping_cost']),\n        'COUNTRY' => $auction_data['country'],\n        'CITY' => $auction_data['city'],\n        'ZIP' => $auction_data['zip'],\n        'QTY' => $auction_data['quantity'],\n        'ENDS' => $ending_time,\n        'ENDS_IN' => (strtotime($ends) - time()),\n        'STARTTIME' => $dt->printDateTz($start),\n        'ENDTIME' => $dt->printDateTz($ends),\n        'BUYNOW1' => $auction_data['buy_now'],\n        'BUYNOW2' => ($auction_data['buy_now'] > 0) ? $system->print_money($auction_data['buy_now']) . $bn_link : $system->print_money($auction_data['buy_now']),\n        'NUMBIDS' => $num_bids,\n        'MINBID' => $min_bid,\n        'MAXBID' => $high_bid,\n        'NEXTBID' => $next_bid,\n        'INTERNATIONAL' => ($auction_data['international']) ? $MSG['033'] : $MSG['043'],\n        'SHIPPING' => $shipping,\n        'SHIPPINGTERMS' => nl2br(htmlspecialchars($auction_data['shipping_terms'])),\n        'PAYMENTS' => $payment_methods,\n        'AUCTION_VIEWS' => $auction_data['counter'],\n        'AUCTION_TYPE' => ($auction_data['bn_only'] == 0) ? $system->SETTINGS['auction_types'][$auction_type] : $MSG['933'],\n        'ATYPE' => $auction_type,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'VIEW_HISTORY1' => (empty($view_history)) ? '' : $view_history . ' | ',\n        'VIEW_HISTORY2' => $view_history,\n        'TOPCATSPATH' => ($system->SETTINGS['extra_cat'] == 'y' && isset($_SESSION['browse_id']) && $_SESSION['browse_id'] == $auction_data['secondcat']) ? $secondcat_value : $cat_value,\n        'CATSPATH' => $cat_value,\n        'SECCATSPATH' => $secondcat_value,\n        'CAT_ID' => $auction_data['category'],\n        'UPLOADEDPATH' => UPLOAD_FOLDER,\n        'BNIMG' => get_lang_img('buy_it_now.gif'),\n\n        'SELLER_REG' => $seller_reg,\n        'SELLER_ID' => $auction_data['user'],\n        'SELLER_NICK' => $auction_data['nick'],\n        'SELLER_TOTALFB' => $total_rate,\n        'SELLER_FB_ICON' => $seller_feedback_icon,\n        'SELLER_NUMFB' => $num_feedbacks,\n        'SELLER_FBPOS' => ($num_feedbacks > 0) ? '(' . ceil($fb_pos * 100 / $num_feedbacks) . '%)' : $MSG['000'],\n        'SELLER_FBNEG' => ($fb_neg > 0 && $total_rate != 0) ? $MSG['5507'] . ' (' . ceil($fb_neg * 100 / $total_rate) . '%)' : '0',\n\n        'WATCH_VAR' => $watch_var,\n        'WATCH_STRING' => $watch_string,\n\n        'YOURBIDMSG' => (isset($yourbidmsg)) ? $yourbidmsg : '',\n        'YOURBIDCLASS' => (isset($yourbidclass)) ? $yourbidclass : '',\n\n        'B_HASENDED' => $has_ended,\n        'B_CANEDIT' => ($user->logged_in && $user->user_data['id'] == $auction_data['user'] && $num_bids == 0 && !($difference == null || $difference->invert)),\n        'B_CANCONTACTSELLER' => (($system->SETTINGS['contactseller'] == 'always' || ($system->SETTINGS['contactseller'] == 'logged' && $user->logged_in)) && (!$user->logged_in || $user->user_data['id'] != $auction_data['user'])),\n        'B_HASIMAGE' => (!empty($auction_data['pict_url'])),\n        'B_NOTBNONLY' => ($auction_data['bn_only'] == 0),\n        'B_HASRESERVE' => ($auction_data['reserve_price'] > 0 && $auction_data['reserve_price'] > $auction_data['current_bid']),\n        'B_BNENABLED' => ($system->SETTINGS['buy_now'] == 2),\n        'B_HASGALELRY' => (count($UPLOADED_PICTURES) > 0),\n        'B_SHOWHISTORY' => (isset($_GET['history']) && $num_bids > 0),\n        'B_BUY_NOW' => ($auction_data['buy_now'] > 0 && ($auction_data['bn_only'] || $auction_data['bn_only'] == 0 && ($auction_data['num_bids'] == 0 || ($auction_data['reserve_price'] > 0 && $auction_data['current_bid'] < $auction_data['reserve_price'])))),\n        'B_BUY_NOW_ONLY' => ($auction_data['bn_only']),\n        'B_ADDITIONAL_SHIPPING_COST' => ($auction_data['auction_type'] == '2'),\n        'B_USERBID' => $userbid,\n        'B_BIDDERPRIV' => ($system->SETTINGS['buyerprivacy'] == 'y' && (!$user->logged_in || ($user->logged_in && $user->user_data['id'] != $auction_data['user']))),\n        'B_HASBUYER' => (count($hbidder_data) > 0),\n        'B_COUNTDOWN' => ($system->SETTINGS['hours_countdown'] > ((strtotime($ends) - time()) / 3600)),\n        'B_HAS_QUESTIONS' => ($num_questions > 0),\n        'B_CAN_BUY' => ($user->permissions['can_buy'] || (!$user->logged_in && $system->SETTINGS['bidding_visable_to_guest'])) && !(strtotime($start) > time()),\n        'B_SHIPPING' => ($system->SETTINGS['shipping'] == 'y'),\n        'B_SHOWENDTIME' => $showendtime,\n        'B_SHOW_ADDITIONAL_SHIPPING_COST' => ($auction_data['additional_shipping_cost'] > 0)\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'item.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\nunset($_SESSION['browse_id']);\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude INCLUDE_PATH . 'config/timezones.php';\ninclude INCLUDE_PATH . 'config/gateways.php';\n\n// check recaptcha is enabled\nif ($system->SETTINGS['spam_register'] == 2) {\n    include PACKAGE_PATH . 'recaptcha/recaptcha.php';\n} elseif ($system->SETTINGS['spam_register'] == 1) {\n    include PACKAGE_PATH . 'captcha/securimage.php';\n}\n\nfunction CheckAge($day, $month, $year) // check if the users > 18\n{\n    $NOW_year = date('Y');\n    $NOW_month = date('m');\n    $NOW_day = date('d');\n\n    if (($NOW_year - $year) > 18) {\n        return 1;\n    } elseif ((($NOW_year - $year) == 18) && ($NOW_month > $month)) {\n        return 1;\n    } elseif ((($NOW_year - $year) == 18) && ($NOW_month == $month) && ($NOW_day >= $day)) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction get_hash()\n{\n    $string = '0123456789abcdefghijklmnopqrstuvyxz';\n    $hash = '';\n    for ($i = 0; $i < 5; $i++) {\n        $rand = rand(0, (34 - $i));\n        $hash .= $string[$rand];\n        $string = str_replace($string[$rand], '', $string);\n    }\n    return $hash;\n}\n\nfunction generateSelect($name, $options, $selectsetting)\n{\n    $html = '<select name=\"' . $name . '\">';\n    foreach ($options as $option => $value) {\n        if ($selectsetting == $option) {\n            $html .= '<option value=' . $option . ' selected>' . $value . '</option>';\n        } else {\n            $html .= '<option value=' . $option . '>' . $value . '</option>';\n        }\n    }\n    $html .= '</select>';\n    return $html;\n}\n\nfunction checkMissing($missing)\n{\n    foreach ($missing as $value) {\n        if ($value) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction emailDomainIsBlacklisted($email)\n{\n    global $system;\n    $exploded_email = explode('@', trim($email));\n    $email_domain = array_pop($exploded_email);\n    $blocked_domains = explode(\"\\n\", $system->SETTINGS['spam_blocked_email_domains']);\n\n    foreach ($blocked_domains as $domain) {\n        if (stripos($email_domain, rtrim($domain)) !== false) {\n            return true;\n        }\n    }\n    return false;\n}\n\n$first = true;\nunset($ERR);\n\nif (empty($_POST['action'])) {\n    $action = 'first';\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"payment_options WHERE is_gateway = 1\";\n$db->direct_query($query);\n$gateway_data = $db->fetchAll();\n\n// Retrieve users signup settings\n$MANDATORY_FIELDS = unserialize($system->SETTINGS['mandatory_fields']);\n$DISPLAYED_FIELDS = unserialize($system->SETTINGS['displayed_feilds']);\n\n$spam_html = '';\n\nif ($system->SETTINGS['spam_register'] == 1) {\n    $resp = new Securimage();\n    $spam_html = $resp->getCaptchaHtml();\n}\n\n// missing check bools\n$missing = array();\n$missing['birthday'] = $missing['address'] = $missing['city'] = $missing['prov'] = $missing['country'] = $missing['zip'] = $missing['tel'] = $missing['paypal'] = $missing['authnet'] = $missing['worldpay'] = $missing['toocheckout'] = $missing['skrill'] = $missing['name'] = $missing['nick'] = $missing['password'] = $missing['repeat_password'] = $missing['email'] = false;\nif (isset($_POST['action']) && $_POST['action'] == 'first') {\n    if (!isset($_POST['terms_check'])) {\n        $ERR = $ERR_078;\n    }\n    if (empty($_POST['TPL_name'])) {\n        $missing['name'] = true;\n    }\n    if (empty($_POST['TPL_nick'])) {\n        $missing['nick'] = true;\n    }\n    if (empty($_POST['TPL_password'])) {\n        $missing['password'] = true;\n    }\n    if (empty($_POST['TPL_repeat_password'])) {\n        $missing['repeat_password'] = true;\n    }\n    if (empty($_POST['TPL_email'])) {\n        $missing['email'] = true;\n    }\n    if (empty($_POST['TPL_address']) && $MANDATORY_FIELDS['address'] == 'y') {\n        $missing['address'] = true;\n    }\n    if (empty($_POST['TPL_city']) && $MANDATORY_FIELDS['city'] == 'y') {\n        $missing['city'] = true;\n    }\n    if (empty($_POST['TPL_prov']) && $MANDATORY_FIELDS['prov'] == 'y') {\n        $missing['prov'] = true;\n    }\n    if (empty($_POST['TPL_country']) && $MANDATORY_FIELDS['country'] == 'y') {\n        $missing['country'] = true;\n    }\n    if (empty($_POST['TPL_zip']) && $MANDATORY_FIELDS['zip'] == 'y') {\n        $missing['zip'] = true;\n    }\n    if (empty($_POST['TPL_phone']) && $MANDATORY_FIELDS['tel'] == 'y') {\n        $missing['tel'] = true;\n    }\n    if ((empty($_POST['TPL_day']) || empty($_POST['TPL_month']) || empty($_POST['TPL_year'])) && $MANDATORY_FIELDS['birthdate'] == 'y') {\n        $missing['birthday'] = true;\n    }\n    foreach ($gateway_data as $gateway) {\n        if ($gateway['gateway_required'] == 1 && isset($_POST[$gateway['name']]['address']) && empty($_POST[$gateway['name']]['address'])) {\n            $missing[$gateway['name']] = true;\n        }\n    }\n    if (checkMissing($missing)) {\n        $ERR = $ERR_047;\n    }\n    if ($system->SETTINGS['wordsfilter'] == 'y') {\n        if ($_POST['TPL_nick'] != $system->filter($_POST['TPL_nick'])) {\n            $ERR = $MSG['wordfilter_banned_username']; // User name altered by word filter\n        }\n    }\n    if (!isset($ERR)) {\n        $birth_day = (isset($_POST['TPL_day'])) ? $_POST['TPL_day'] : '';\n        $birth_month = (isset($_POST['TPL_month'])) ? $_POST['TPL_month'] : '';\n        $birth_year = (isset($_POST['TPL_year'])) ? $_POST['TPL_year'] : '';\n        $DATE = $birth_year . $birth_month . $birth_day;\n\n        if ($system->SETTINGS['spam_register'] == 2) {\n            $recaptcha_response = (isset($_POST['g-recaptcha-response'])) ? $_POST['g-recaptcha-response'] : '';\n            $resp = recaptcha_check_answer($system->SETTINGS['recaptcha_private'], $recaptcha_response);\n        }\n\n        if ($system->SETTINGS['spam_register'] == 2 && !$resp) {\n            $ERR = $MSG['752'];\n        } elseif ($system->SETTINGS['spam_register'] == 1 && !$resp->check($_POST['captcha_code'])) {\n            $ERR = $MSG['752'];\n        } elseif (strlen($_POST['TPL_nick']) < 6) {\n            $ERR = $ERR_107;\n        } elseif (strlen($_POST['TPL_password']) < 6) {\n            $ERR = $ERR_108;\n        } elseif ($_POST['TPL_password'] != $_POST['TPL_repeat_password']) {\n            $ERR = $ERR_109;\n        } elseif (strlen($_POST['TPL_email']) < 5) {\n            $ERR = $ERR_110;\n        } elseif (!preg_match('/^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+([\\.][a-z0-9-]+)+$/i', $_POST['TPL_email'])) {\n            $ERR = $ERR_008;\n        } elseif ($system->SETTINGS['spam_blocked_email_enabled'] && emailDomainIsBlacklisted($_POST['TPL_email'])) {\n            $ERR = $MSG['spam_blocked_email_domains_register_error'];\n        } elseif (!CheckAge($birth_day, $birth_month, $birth_year) && $MANDATORY_FIELDS['birthdate'] == 'y') {\n            $ERR = $ERR_113;\n        } elseif (!empty($birth_month) && !empty($birth_day) && !empty($birth_year) && !checkdate($birth_month, $birth_day, $birth_year)) {\n            $ERR = $ERR_117;\n        } else {\n            // check username is unique\n            $query = \"SELECT COUNT(nick) as COUNT FROM \" . $DBPrefix . \"users WHERE nick = :name\";\n            $params = array();\n            $params[] = array(':name', $system->cleanvars($_POST['TPL_nick']), 'str');\n            $db->query($query, $params);\n            if ($db->result('COUNT') > 0) {\n                $ERR = $ERR_111; // Selected user already exists\n            }\n            // check email is unique\n            $query = \"SELECT COUNT(email) as COUNT FROM \" . $DBPrefix . \"users WHERE email = :email\";\n            $params = array();\n            $params[] = array(':email', $system->cleanvars($_POST['TPL_email']), 'str');\n            $db->query($query, $params);\n            if ($db->result('COUNT') > 0) {\n                $ERR = $ERR_115; // E-mail already used\n            }\n\n            if (!isset($ERR)) {\n                $TPL_nick_hidden = $_POST['TPL_nick'];\n                $TPL_password_hidden = $_POST['TPL_password'];\n                $TPL_name_hidden = $_POST['TPL_name'];\n                $TPL_email_hidden = $_POST['TPL_email'];\n                $SUSPENDED = ($system->SETTINGS['activationtype'] == 2) ? 0 : 8;\n                $SUSPENDED = ($system->SETTINGS['activationtype'] == 0) ? 10 : $SUSPENDED;\n\n                $query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'signup_fee'\";\n                $db->direct_query($query);\n                $signup_fee = $db->result('value');\n                if ($system->SETTINGS['fee_type'] == 2 && $signup_fee > 0) {\n                    $SUSPENDED = 9;\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET inactiveusers = inactiveusers + 1\";\n                    $db->direct_query($query);\n                } elseif ($system->SETTINGS['activationtype'] == 1 || $system->SETTINGS['activationtype'] == 0) {\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET inactiveusers = inactiveusers + 1\";\n                    $db->direct_query($query);\n                } else {\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET users = users + 1\";\n                    $db->direct_query($query);\n                }\n                $balance = ($system->SETTINGS['fee_type'] == 2) ? 0 : ($system->SETTINGS['fee_signup_bonus'] - $signup_fee);\n\n                $query = \"SELECT id FROM \" . $DBPrefix . \"groups WHERE auto_join = 1\";\n                $db->direct_query($query);\n                $groups = array();\n                while ($row = $db->fetch()) {\n                    $groups[] = $row['id'];\n                }\n                $hash = get_hash();\n                // prepare to hash the password\n                include PACKAGE_PATH . 'PasswordHash.php';\n                $phpass = new PasswordHash(8, false);\n                $query = \"INSERT INTO \" . $DBPrefix . \"users\n                          (nick, password, hash, name, address, city, prov, country, zip, phone, nletter, email, birthdate,\n                          suspended, language, groups, balance, timezone)\n                          VALUES\n                          (:nick, :password, :hash, :name, :address, :city, :prov, :country, :zip, :phone, :nletter, :email, :birthdate,\n                          :suspended, :language, :groups, :balance, :timezone)\";\n                $params = array(\n                    array(':nick', $system->cleanvars($TPL_nick_hidden), 'str'),\n                    array(':password', $phpass->HashPassword($TPL_password_hidden), 'str'),\n                    array(':hash', $hash, 'str'),\n                    array(':name', $system->cleanvars($TPL_name_hidden), 'str'),\n                    array(':address', $system->cleanvars((isset($_POST['TPL_address'])) ? $_POST['TPL_address'] : ''), 'str'),\n                    array(':city', $system->cleanvars((isset($_POST['TPL_city'])) ? $_POST['TPL_city'] : ''), 'str'),\n                    array(':prov', $system->cleanvars((isset($_POST['TPL_prov'])) ? $_POST['TPL_prov'] : ''), 'str'),\n                    array(':country', $system->cleanvars((isset($_POST['TPL_country'])) ? $_POST['TPL_country'] : ''), 'str'),\n                    array(':zip', $system->cleanvars((isset($_POST['TPL_zip'])) ? $_POST['TPL_zip'] : ''), 'str'),\n                    array(':phone', $system->cleanvars((isset($_POST['TPL_phone'])) ? $_POST['TPL_phone'] : ''), 'str'),\n                    array(':nletter', intval($_POST['TPL_nletter']), 'int'),\n                    array(':email', $system->cleanvars($_POST['TPL_email']), 'str'),\n                    array(':birthdate', ((!empty($DATE)) ? $DATE : 0), 'str'),\n                    array(':suspended', $SUSPENDED, 'int'),\n                    array(':language', $language, 'str'),\n                    array(':groups', implode(',', $groups), 'str'),\n                    array(':balance', $balance, 'float'),\n                    array(':timezone', $_POST['TPL_timezone'], 'str'),\n                );\n                $db->query($query, $params);\n                $TPL_id_hidden = $db->lastInsertId();\n                $query = \"INSERT INTO \" . $DBPrefix . \"usersips (user, ip, type, action)\n                          VALUES (:id_hidden, :remote_addr, 'register', 'accept')\";\n                $params = array();\n                $params[] = array(':id_hidden', $TPL_id_hidden, 'int');\n                $params[] = array(':remote_addr', $_SERVER['REMOTE_ADDR'], 'str');\n                $db->query($query, $params);\n                foreach ($gateway_data as $gateway) {\n                    if (isset($_POST[$gateway['name']]['address']) && empty($_POST[$gateway['name']]['address'])) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"usergateways (gateway_id, user_id, address, password) VALUES (:gateway_id, :user_id, :address, :password)\";\n                        $params = array(\n                            array(':user_id', $TPL_id_hidden, 'int'),\n                            array(':gateway_id', $gateway['id'], 'int'),\n                            array(':address', ((isset($_POST[$gateway['name']]['address'])) ? $system->cleanvars($_POST[$gateway['name']]['address']) : ''), 'str'),\n                            array(':password', ((isset($_POST[$gateway['name']]['password'])) ? $system->cleanvars($_POST[$gateway['name']]['password']) : ''), 'str'),\n                        );\n                    }\n                }\n\n                $_SESSION['language'] = $language;\n                $first = false;\n\n                if (defined('TrackUserIPs')) {\n                    // log registration IP\n                    $system->log('user', 'Registered User', $TPL_id_hidden);\n                }\n\n                // send emails\n                if ($system->SETTINGS['activationtype'] == 0) {\n                    include INCLUDE_PATH . 'email/user_needapproval.php';\n                    $TPL_message = $MSG['016_a'];\n                } elseif ($system->SETTINGS['activationtype'] == 1) {\n                    include INCLUDE_PATH . 'email/user_confirmation.php';\n                    $TPL_message = sprintf($MSG['016'], $TPL_email_hidden, $system->SETTINGS['sitename']);\n                } else {\n                    $USER = array('name' => $TPL_name_hidden, 'email' => $_POST['TPL_email']);\n                    include INCLUDE_PATH . 'email/user_approved.php';\n                    $TPL_message = $MSG['016_b'];\n                }\n\n                if ($system->SETTINGS['fee_type'] == 2 && $signup_fee > 0) {\n                    $_SESSION['signup_id'] = $TPL_id_hidden;\n                    header('location: pay.php?a=3');\n                    exit;\n                }\n\n                $template->assign_vars(array(\n                        'L_HEADER' => sprintf($MSG['859'], $TPL_name_hidden),\n                        'L_MESSAGE' => $TPL_message\n                        ));\n            }\n        }\n    }\n}\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'signup_fee'\";\n$db->direct_query($query);\n$signup_fee = $db->result('value');\n\n$country_dropdown = '';\n\n$selcountry = isset($_POST['TPL_country']) ? $_POST['TPL_country'] : '';\n\n$query = \"SELECT country_id, country FROM \" . $DBPrefix . \"countries\";\n$db->direct_query($query);\n$countries = $db->fetchall();\n\nforeach ($countries as $country) {\n    $country_dropdown .= '<option value=\"' . $country['country'] . '\"';\n    if ($country['country'] == $selcountry) {\n        $country_dropdown .= ' selected';\n    } elseif (!$selcountry && $system->SETTINGS['defaultcountry'] == $country['country']) {\n        $country_dropdown .= ' selected';\n    }\n    $country_dropdown .= '>' . $country['country'] . '</option>' . \"\\n\";\n}\n\n$dobclass = ($missing['birthday']) ? ' class=\"missing\"' : '';\n$dobmonth = '<select name=\"TPL_month\"' . $dobclass . '>\n\t\t<option value=\"00\"></option>\n\t\t<option value=\"01\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '01') ? ' selected' : '') . '>' . $MSG['MON_001E'] . '</option>\n\t\t<option value=\"02\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '02') ? ' selected' : '') . '>' . $MSG['MON_002E'] . '</option>\n\t\t<option value=\"03\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '03') ? ' selected' : '') . '>' . $MSG['MON_003E'] . '</option>\n\t\t<option value=\"04\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '04') ? ' selected' : '') . '>' . $MSG['MON_004E'] . '</option>\n\t\t<option value=\"05\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '05') ? ' selected' : '') . '>' . $MSG['MON_005E'] . '</option>\n\t\t<option value=\"06\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '06') ? ' selected' : '') . '>' . $MSG['MON_006E'] . '</option>\n\t\t<option value=\"07\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '07') ? ' selected' : '') . '>' . $MSG['MON_007E'] . '</option>\n\t\t<option value=\"08\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '08') ? ' selected' : '') . '>' . $MSG['MON_008E'] . '</option>\n\t\t<option value=\"09\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '09') ? ' selected' : '') . '>' . $MSG['MON_009E'] . '</option>\n\t\t<option value=\"10\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '10') ? ' selected' : '') . '>' . $MSG['MON_010E'] . '</option>\n\t\t<option value=\"11\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '11') ? ' selected' : '') . '>' . $MSG['MON_011E'] . '</option>\n\t\t<option value=\"12\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '12') ? ' selected' : '') . '>' . $MSG['MON_012E'] . '</option>\n\t</select>';\n$dobday = '<select name=\"TPL_day\"' . $dobclass . '>\n\t\t<option value=\"\"></option>';\nfor ($i = 1; $i <= 31; $i++) {\n    $j = (strlen($i) == 1) ? '0' . $i : $i;\n    $dobday .= '<option value=\"' . $j . '\"' . ((isset($_POST['TPL_day']) && $_POST['TPL_day'] == $j) ? ' selected' : '') . '>' . $j . '</option>';\n}\n$dobday .= '</select>';\n\n$selectsetting = (isset($_POST['TPL_timezone'])) ? $_POST['TPL_timezone'] : $system->SETTINGS['timezone'];\n$time_correction = generateSelect('TPL_timezone', $timezones, $selectsetting);\n\nforeach ($gateway_data as $gateway) {\n    if ($gateway['gateway_active']) {\n        $template->assign_block_vars('gateways', array(\n                'GATEWAY_ID' => $gateway['id'],\n                'NAME' => $gateway['displayname'],\n                'PLAIN_NAME' => $gateway['name'],\n                'MISSING' => ($missing[$gateway['name']]) ? 1 : 0,\n                'REQUIRED' => ($gateway['gateway_required'] == 1) ? 'checked' : '',\n                'ADDRESS' => isset($_POST[$gateway['name']]['address']) ? $_POST[$gateway['name']]['address'] : '',\n                'PASSWORD' => isset($_POST[$gateway['name']]['password']) ? $_POST[$gateway['name']]['password'] : '',\n                'ADDRESS_NAME' => isset($address_string[$gateway['name']]) ? $address_string[$gateway['name']] : $gateway['name'],\n                'PASSWORD_NAME' => isset($password_string[$gateway['name']]) ? $password_string[$gateway['name']] : '',\n                'ERROR_STRING' => $error_string[$gateway['name']],\n\n                'B_PASSWORD' => isset($password_string[$gateway['name']])\n                ));\n    }\n}\n\n$template->assign_vars(array(\n        'ERROR' => (isset($ERR)) ? $ERR : '',\n        'L_COUNTRIES' => $country_dropdown,\n        'L_DATEFORMAT' => ($system->SETTINGS['datesformat'] == 'USA') ? $dobmonth . ' ' . $dobday : $dobday . ' ' . $dobmonth,\n        'TIMEZONE' => $time_correction,\n        'TERMSTEXT' => $system->SETTINGS['termstext'],\n\n        'B_ADMINAPROVE' => ($system->SETTINGS['activationtype'] == 0),\n        'B_NLETTER' => ($system->SETTINGS['newsletter'] == 1),\n        'B_FIRST' => $first,\n        'B_FEES' => ($signup_fee > 0),\n\n        'CAPTCHATYPE' => $system->SETTINGS['spam_register'],\n        'CAPCHA' => ($system->SETTINGS['spam_register'] == 2) ? recaptcha_get_html($system->SETTINGS['recaptcha_public']) : $spam_html,\n        'BIRTHDATE' => ($DISPLAYED_FIELDS['birthdate_regshow'] == 'y'),\n        'ADDRESS' => ($DISPLAYED_FIELDS['address_regshow'] == 'y'),\n        'CITY' => ($DISPLAYED_FIELDS['city_regshow'] == 'y'),\n        'PROV' => ($DISPLAYED_FIELDS['prov_regshow'] == 'y'),\n        'COUNTRY' => ($DISPLAYED_FIELDS['country_regshow'] == 'y'),\n        'ZIP' => ($DISPLAYED_FIELDS['zip_regshow'] == 'y'),\n        'TEL' => ($DISPLAYED_FIELDS['tel_regshow'] == 'y'),\n        'REQUIRED' => array(\n                    ($MANDATORY_FIELDS['birthdate'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['address'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['city'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['prov'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['country'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['zip'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['tel'] == 'y') ? ' *' : ''\n                    ),\n        'MISSING0' => ($missing['name']) ? 1 : 0,\n        'MISSING1' => ($missing['nick']) ? 1 : 0,\n        'MISSING2' => ($missing['password']) ? 1 : 0,\n        'MISSING3' => ($missing['repeat_password']) ? 1 : 0,\n        'MISSING4' => ($missing['email']) ? 1 : 0,\n        'MISSING5' => ($missing['birthday']) ? 1 : 0,\n        'MISSING6' => ($missing['address']) ? 1 : 0,\n        'MISSING7' => ($missing['city']) ? 1 : 0,\n        'MISSING8' => ($missing['prov']) ? 1 : 0,\n        'MISSING9' => ($missing['country']) ? 1 : 0,\n        'MISSING10' => ($missing['zip']) ? 1 : 0,\n        'MISSING11' => ($missing['tel']) ? 1 : 0,\n        'FEES'=> $system->print_money($signup_fee),\n\n        'V_YNEWSL' => ((isset($_POST['TPL_nletter']) && $_POST['TPL_nletter'] == 1) || !isset($_POST['TPL_nletter'])) ? 'checked=true' : '',\n        'V_NNEWSL' => (isset($_POST['TPL_nletter']) && $_POST['TPL_nletter'] == 2) ? 'checked=true' : '',\n        'V_YNAME' => (isset($_POST['TPL_name'])) ? $_POST['TPL_name'] : '',\n        'V_UNAME' => (isset($_POST['TPL_nick'])) ? $_POST['TPL_nick'] : '',\n        'V_EMAIL' => (isset($_POST['TPL_email'])) ? $_POST['TPL_email'] : '',\n        'V_YEAR' => (isset($_POST['TPL_year'])) ? $_POST['TPL_year'] : '',\n        'V_ADDRE' => (isset($_POST['TPL_address'])) ? $_POST['TPL_address'] : '',\n        'V_CITY' => (isset($_POST['TPL_city'])) ? $_POST['TPL_city'] : '',\n        'V_PROV' => (isset($_POST['TPL_prov'])) ? $_POST['TPL_prov'] : '',\n        'V_POSTCODE' => (isset($_POST['TPL_zip'])) ? $_POST['TPL_zip'] : '',\n        'V_PHONE' => (isset($_POST['TPL_phone'])) ? $_POST['TPL_phone'] : ''\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'register.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "\t\t<div style=\"width:25%; float:left;\">\n\t\t\t<div style=\"margin-left:auto; margin-right:auto;\">\n\t\t\t\t<!-- INCLUDE sidebar-{CURRENT_PAGE}.tpl -->\n\t\t\t</div>\n\t\t</div>\n\t\t<div style=\"width:75%; float:right;\">\n\t\t\t<div class=\"main-box\">\n\t\t\t\t<h4 class=\"rounded-top rounded-bottom\">{L_239}&nbsp;&gt;&gt;&nbsp;{L_512}</h4>\n\t\t\t\t<form name=\"editauction\" action=\"\" method=\"post\">\n\t\t\t\t\t<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" class=\"blank\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width=\"25%\" align=\"right\">{L_313}</td>\n\t\t\t\t\t\t<td>{USER}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_017}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"title\" size=\"40\" maxlength=\"255\" value=\"{TITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_806}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"subtitle\" size=\"40\" maxlength=\"255\" value=\"{SUBTITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_287}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"category\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats1 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats1.CAT_ID}\"<!-- IF cats1.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats1.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_814}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"secondcat\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats2 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats2.CAT_ID}\"<!-- IF cats2.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats2.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_018}</td>\n\t\t\t\t\t\t<td>{EDITOR}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_258}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"quantity\" size=\"40\" maxlength=\"40\" value=\"{QTY}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_022}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"duration\">\n\t\t\t\t\t\t\t\t<option value=\"\"> </option>\n\t\t\t\t\t\t\t\t<!-- BEGIN dur -->\n\t\t\t\t\t\t\t\t<option value=\"{dur.DAYS}\"<!-- IF dur.SELECTED --> selected<!-- ENDIF -->>{dur.DESC}</option>\n\t\t\t\t\t\t\t\t<!-- END dur -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_816}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div>{L_1105}</div>\n<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<div class=\"button\" style=\" height:100px; float:left; margin:5px; padding:10px 5px 20px 10px;\">\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}/{gallery.V}\" title=\"{gallery.V}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?fromfile={gallery.V}\" border=\"0\" height=\"100px\">\n\t\t\t\t\t\t\t\t</a><br>\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"gallery[]\" value=\"{gallery.V}\">\n\t\t\t\t\t\t\t</div>\n<!-- END gallery -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_817}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_257}</td>\n\t\t\t\t\t\t<td>{ATYPE}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_116}</td>\n\t\t\t\t\t\t<td>{CURRENT_BID}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_124}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"min_bid\" size=\"40\" maxlength=\"40\" value=\"{MIN_BID}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_023}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"shipping_cost\" size=\"40\" maxlength=\"40\" value=\"{SHIPPING_COST}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_021}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"reserve_price\" size=\"40\" maxlength=\"40\" value=\"{RESERVE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_30_0063}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"0\" {BN_ONLY_N}> {L_no}\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"1\" {BN_ONLY_Y}> {L_yes}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_497}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"buy_now\" size=\"40\" maxlength=\"40\" value=\"{BN_PRICE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_120}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"text\" name=\"customincrement\" size=\"10\" value=\"{CUSTOM_INC}\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_319}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_025}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"1\" {SHIPPING1}>\t{L_031}<br>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"2\" {SHIPPING2}>\t{L_032}<br>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"international\" value=\"1\" {INTERNATIONAL}> {L_033}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_25_0215}</td>\n\t\t\t\t\t\t<td><textarea name=\"shipping_terms\" rows=\"3\" cols=\"34\">{SHIPPING_TERMS}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_5233}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_026}</td>\n\t\t\t\t\t\t<td>{PAYMENTS}</td>\n\t\t\t\t\t</tr>\n\t<!-- IF B_MKFEATURED or B_MKBOLD or B_MKHIGHLIGHT -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_268}</td>\n\t\t\t\t\t\t<td>\n\t\t<!-- IF B_MKFEATURED -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_featured\" {IS_FEATURED}> {L_273}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKBOLD -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_bold\" {IS_BOLD}> {L_274}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKHIGHLIGHT -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_highlighted\" {IS_HIGHLIGHTED}> {L_292}</p>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_300}</td>\n\t\t\t\t\t\t<td>{SUSPENDED}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\">\n\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t<input type=\"submit\" name=\"act\" class=\"centre\" value=\"{L_089}\">\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n", "\t\t<div style=\"width:25%; float:left;\">\n\t\t\t<div style=\"margin-left:auto; margin-right:auto;\">\n\t\t\t\t<!-- INCLUDE sidebar-{CURRENT_PAGE}.tpl -->\n\t\t\t</div>\n\t\t</div>\n\t\t<div style=\"width:75%; float:right;\">\n\t\t\t<div class=\"container\">\n\t\t\t\t<h4 class=\"rounded-top rounded-bottom\">{L_239}&nbsp;&gt;&gt;&nbsp;{L_512}</h4>\n\t\t\t\t<form name=\"editauction\" action=\"\" method=\"post\">\n\t\t\t\t\t<table class=\"table table-striped table-bordered\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width=\"25%\" align=\"right\">{L_313}</td>\n\t\t\t\t\t\t<td>{USER}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_017}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"title\" size=\"40\" maxlength=\"255\" value=\"{TITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_806}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"subtitle\" size=\"40\" maxlength=\"255\" value=\"{SUBTITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_287}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"category\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats1 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats1.CAT_ID}\"<!-- IF cats1.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats1.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_814}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"secondcat\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats2 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats2.CAT_ID}\"<!-- IF cats2.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats2.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_018}</td>\n\t\t\t\t\t\t<td><textarea name=\"description\" cols=\"40\" rows=\"8\">{DESC}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_258}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"quantity\" size=\"40\" maxlength=\"40\" value=\"{QTY}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_022}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"duration\">\n\t\t\t\t\t\t\t\t<option value=\"\"> </option>\n\t\t\t\t\t\t\t\t<!-- BEGIN dur -->\n\t\t\t\t\t\t\t\t<option value=\"{dur.DAYS}\"<!-- IF dur.SELECTED --> selected<!-- ENDIF -->>{dur.DESC}</option>\n\t\t\t\t\t\t\t\t<!-- END dur -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_816}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div>{L_1105}</div>\n<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<div style=\"width:50px; float: left;\">\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}/{gallery.V}\" title=\"{gallery.V}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?fromfile={gallery.V}\" border=\"0\" hspace=\"10\">\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"gallery[]\" value=\"{gallery.V}\">\n\t\t\t\t\t\t\t</div>\n<!-- END gallery -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_817}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_257}</td>\n\t\t\t\t\t\t<td>{ATYPE}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_116}</td>\n\t\t\t\t\t\t<td>{CURRENT_BID}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_124}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"min_bid\" size=\"40\" maxlength=\"40\" value=\"{MIN_BID}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_023}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"shipping_cost\" size=\"40\" maxlength=\"40\" value=\"{SHIPPING_COST}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_021}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"reserve_price\" size=\"40\" maxlength=\"40\" value=\"{RESERVE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_30_0063}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"0\" {BN_ONLY_N}> {L_no}\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"1\" {BN_ONLY_Y}> {L_yes}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_497}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"buy_now\" size=\"40\" maxlength=\"40\" value=\"{BN_PRICE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_120}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"text\" name=\"customincrement\" size=\"10\" value=\"{CUSTOM_INC}\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_319}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_025}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"1\" {SHIPPING1}>\t{L_031}<br>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"2\" {SHIPPING2}>\t{L_032}<br>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"international\" value=\"1\" {INTERNATIONAL}> {L_033}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_25_0215}</td>\n\t\t\t\t\t\t<td><textarea name=\"shipping_terms\" rows=\"3\" cols=\"34\">{SHIPPING_TERMS}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_5233}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_026}</td>\n\t\t\t\t\t\t<td>{PAYMENTS}</td>\n\t\t\t\t\t</tr>\n\t<!-- IF B_MKFEATURED or B_MKBOLD or B_MKHIGHLIGHT -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_268}</td>\n\t\t\t\t\t\t<td>\n\t\t<!-- IF B_MKFEATURED -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_featured\" {IS_FEATURED}> {L_273}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKBOLD -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_bold\" {IS_BOLD}> {L_274}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKHIGHLIGHT -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_highlighted\" {IS_HIGHLIGHTED}> {L_292}</p>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_300}</td>\n\t\t\t\t\t\t<td>{SUSPENDED}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\">\n\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t<input type=\"submit\" name=\"act\" class=\"centre\" value=\"{L_089}\">\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n", "<!-- IF B_COUNTDOWN -->\n<script type=\"text/javascript\">\n$(document).ready(function() {\n\tvar timeRemaining = {ENDS_IN};\n\tvar endDateTime = new Date();\n\tendDateTime.setSeconds(endDateTime.getSeconds() + timeRemaining);\n\tfunction padLength(what)\n\t{\n\t\tvar output = (what.toString().length == 1) ? '0' + what : what;\n\t\treturn output;\n\t}\n\tfunction displayTime() {\n\t\tvar currentDateTime = new Date();\n\n\t\tif (currentDateTime.getTime() < endDateTime.getTime()) {\n\t\t\tvar remainingTime = Math.floor((endDateTime.getTime() - currentDateTime.getTime()) / 1000);\n\t\t\tvar hours = Math.floor(remainingTime / 3600);\n\t\t\tvar mins = Math.floor((remainingTime - (hours * 3600)) / 60);\n\t\t\tvar secs = Math.floor(remainingTime - (hours * 3600) - (mins * 60));\n\n\t\t\tvar timeString = padLength(hours) + ':' + padLength(mins) + ':' + padLength(secs);\n\t\t\t$('#ending_counter').html(timeString);\n\t\t\tsetTimeout(displayTime, 1000);\n\t\t} else {\n\t\t\t$(\"#ending_counter\").html('<div class=\"error-box\">{L_911}</div>');\n\t\t}\n\t}\n\tsetTimeout(displayTime, 1000);\n});\n</script>\n<!-- ENDIF -->\n<div class=\"content\">\n\t<div class=\"tableContent2\">\n\t\t<div class=\"padding\"><b>{L_041}:</b> {TOPCATSPATH}</div>\n\t\t<div class=\"titTable2 rounded-top rounded-bottom\">\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t{TITLE}\n<!-- IF SUBTITLE ne '' -->\n\t\t\t\t\t\t<p class=\"smallspan\">{SUBTITLE}</p>\n<!-- ENDIF -->\n\t\t\t\t\t</td>\n\t\t\t\t\t<td align=\"right\">{L_113}: {ID}</td>\n\t\t\t\t</tr>\n<!-- IF B_CANEDIT -->\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t[<a href=\"{SITEURL}edit_active_auction.php?id={ID}\">{L_30_0069}</a>]\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t</table>\n\t\t</div>\n\t\t<div class=\"titTable3\">\n\t\t\t{VIEW_HISTORY1}\n\t\t\t<a href=\"{SITEURL}friend.php?id={ID}\">{L_106}</a> |\n<!-- IF B_CANCONTACTSELLER -->\n\t\t\t<a href=\"{SITEURL}send_email.php?auction_id={ID}\">{L_922}</a> |\n<!-- ENDIF -->\n<!-- IF B_LOGGED_IN -->\n\t\t\t<a href=\"{SITEURL}item_watch.php?{WATCH_VAR}={ID}\">{WATCH_STRING}</a>\n<!-- ELSE -->\n\t\t\t<a href=\"{SITEURL}user_login.php?\">{L_5202}</a>\n<!-- ENDIF -->\n\t\t</div>\n<!-- IF B_USERBID -->\n\t\t<div class=\"{YOURBIDCLASS}\">\n\t\t\t{YOURBIDMSG}\n\t\t</div>\n<!-- ENDIF -->\n\t\t<br>\n\t\t<div class=\"table2\">\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"titTable5\" valign=\"top\">\n\t\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"5\" cellspacing=\"0\">\n\t\t\t\t\t\t\t<tr>\n<!-- IF B_HASIMAGE -->\n\t\t\t\t\t\t\t\t<td width=\"10%\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t<table bgcolor=\"#ffffff\">\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td align='center'>\n\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={PIC_URL}\" border=\"0\" align=\"center\"><br>\n\t<!-- IF B_HASGALELRY -->\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#gallery\"><img src=\"{SITEURL}images/gallery.gif\" border=\"0\" alt=\"gallery\"> {L_694}</a>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t</td>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<td width=\"60%\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t<table width=\"100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" valign=\"top\" border=\"0\">\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}<br>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#description\"><img src=\"{SITEURL}images/info.gif\" border='0'></a>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#description\">{L_018}</a> &nbsp;&nbsp;&nbsp;\n\t\t\t\t\t\t\t\t\t\t\t\t<table border='0' width=\"100%\" cellspacing=\"0\" cellpadding=\"1\">\n\t\t\t\t\t\t<!-- auction type -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_261}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{AUCTION_TYPE}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<!-- higher bidder -->\n<!-- IF B_HASBUYER and B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width='50%' valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_117}:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\n\t<!-- BEGIN high_bidders -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>{high_bidders.BUYER_NAME}</b>\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={high_bidders.BUYER_ID}&auction_id={ID}\"><b>{high_bidders.BUYER_NAME}</b></a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>(<a href=\"{SITEURL}feedback.php?id={high_bidders.BUYER_ID}&faction=show\">{high_bidders.BUYER_FB}</a>)</b>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}images/icons/{high_bidders.BUYER_FB_ICON}\" alt=\"{high_bidders.BUYER_FB_ICON}\" class=\"fbstar\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t<!-- END high_bidders -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_901}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{QTY}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_923}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{COUNTRY}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_118}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n<!-- IF B_COUNTDOWN -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span id=\"ending_counter\">{ENDS}</span>\n<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ENDS}<!-- IF B_SHOWENDTIME --><br><span class=\"smallspan\">({ENDTIME})</span><!-- ENDIF -->\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_119}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{NUMBIDS} {VIEW_HISTORY2}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_038}:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{MINBID}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_116}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"middle\">{MAXBID}<!-- IF B_HASRESERVE -->&nbsp;<span class=\"smallspan\">{L_514}</span><!-- ENDIF --></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_023}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{SHIPPING_COST}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF (B_ADDITIONAL_SHIPPING_COST or B_BUY_NOW_ONLY) and B_SHOW_ADDITIONAL_SHIPPING_COST -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_350_1008}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{ADDITIONAL_SHIPPING_COST}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_BUY_NOW -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_496}:</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{BUYNOW2}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_HASENDED -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"2\" align=\"left\"><b>{L_904}</b></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td width=\"2%\">&nbsp;</td>\n\t\t\t\t\t<td width=\"37%\" valign=\"top\" bgcolor=\"#ffffff\" align=\"left\">\n\t\t\t\t\t\t<div class=\"titTable1\">\n\t\t\t\t\t\t\t<b>{L_30_0209}</b>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"4\" border=\"0\" bgcolor=\"#ffffff\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\" class='table2'>&nbsp;</td>\n\t\t\t\t\t\t\t\t<td class=\"table2\" style=\"padding:10px;\">\n\t\t\t\t\t\t\t\t\t<a href='{SITEURL}profile.php?user_id={SELLER_ID}&auction_id={ID}'><b>{SELLER_NICK}</b></a>\n\t\t\t\t\t\t\t\t\t(<a href='{SITEURL}feedback.php?id={SELLER_ID}&faction=show'>{SELLER_TOTALFB}</a>)\n\t\t\t\t\t\t\t\t\t<!-- IF SELLER_FB_ICON ne '' --><img src=\"{SITEURL}images/icons/{SELLER_FB_ICON}\" alt=\"{SELLER_FB_ICON}\" class=\"fbstar\"><!-- ENDIF -->\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\">&nbsp;</td>\n\t\t\t\t\t\t\t\t<td width=\"97%\">\n\t\t\t\t\t\t\t\t\t<li>{L_5509}{SELLER_NUMFB}{L__0151}\n\t\t\t\t\t\t\t\t\t<li><b>{L_5506}{SELLER_FBPOS}</b>\n<!-- IF SELLER_FBNEG ne 0 -->\n\t\t\t\t\t\t\t\t\t<li>{SELLER_FBNEG}</li>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t<li>{L_5508}{SELLER_REG}</li>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\">&nbsp;</td>\n\t\t\t\t\t\t\t\t<td width=\"97%\">\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}active_auctions.php?user_id={SELLER_ID}\">{L_213}</a>\n\t\t\t\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t\t<div class=\"titTable1\">\n<!-- IF B_HASENDED eq false and B_CAN_BUY -->\n\t<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t<table width=\"100%\" border=0 cellpadding=2 cellspacing=0 border=1>\n\t\t\t\t\t\t\t\t<form name=\"bid\" action=\"{SITEURL}bid.php\" method=\"post\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td width=\"65%\">\n\t\t\t\t\t\t\t\t\t\t\t<table width=100% border=0 cellpadding=2 cellspacing=0>\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>\n\t\t<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_284}: <input type=\"text\" name=\"qty\" size=15 /> {QTY} {L_5408}<br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_121} <input type=\"text\" name=\"bid\" size=\"15\">\n\t\t<!-- IF ATYPE eq 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_124}: {NEXTBID}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td valign='center' align='center' class='tema' width=\"50%\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"seller_id\" value=\"{SELLER_ID}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"title\" value=\"{TITLE}\" >\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"category\" value=\"{CAT_ID}\" >\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"\" value=\"{L_30_0208}\" class=\"button\">\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</table>\n\t<!-- ELSE -->\n\t\t\t\t\t\t\t{BUYNOW} <a href=\"{SITEURL}buy_now.php?id={ID}\"><img border=\"0\" align=\"absbottom\" alt=\"{L_496}\" src=\"{BNIMG}\"></a>\n\t<!-- ENDIF -->\n<!-- ENDIF -->\n<!-- IF B_CAN_BUY eq false -->\n\t\t\t\t\t\t\t<p>{L_5002}</p>\n\t\t\t\t\t\t\t<p><a href=\"{SITEURL}user_login.php?\">{L_221}</a></p>\n<!-- ENDIF -->\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a class=\"report-item rightside\" href='{SITEURL}item_report.php?id={ID}'>{L_report_this_item}</a>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t\t<br>\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"description\"></a>{L_018}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">{AUCTION_DESCRIPTION}</div>\n\t\t\t</div>\n<!-- IF B_HAS_QUESTIONS -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"questions\"></a>{L_552}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">\n\t<!-- BEGIN questions -->\n\t\t\t\t\t<div class=\"smallspan padding\">\n\t\t<!-- BEGIN conv -->\n\t\t\t\t\t<p><b>{questions.conv.BY_WHO}</b>: {questions.conv.MESSAGE}</p>\n<!-- END conv -->\n\t\t\t\t\t</div>\n<!-- END questions -->\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_HASGALELRY -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"gallery\"></a>{L_663}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\" style=\"text-align:center; overflow-y:auto;\" id=\"gallery\">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}{UPLOADEDPATH}{ID}/{gallery.V}\" title=\"\" data-lightbox=\"gallery\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={UPLOADEDPATH}{ID}/{gallery.V}\" border=\"0\" hspace=\"10\">\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</td>\n\t<!-- END gallery -->\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_SHOWHISTORY -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t{L_26_0001}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">\n\t\t\t\t\t<a name=\"history\"></a>\n\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"4\" cellspacing=\"1\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_176}</th>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_130}</th>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_175}</th>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_284}</th>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t</tr>\n\t<!-- BEGIN bidhistory -->\n\t\t\t\t\t\t<tr valign=\"top\" {bidhistory.BGCOLOUR}>\n\t\t\t\t\t\t\t<td>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t{bidhistory.NAME}\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={bidhistory.ID}\">{bidhistory.NAME}</a>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.BID}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.WHEN}\n\t\t\t\t\t\t\t</td>\n\t\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.QTY}\n\t\t\t\t\t\t\t</td>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</tr>\n\t<!-- END bidhistory -->\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t<br>\n\t\t\t<div class=\"titTable4\">{L_724}</div>\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class=\"tableContent2\">\n\t\t\t\t\t\t\t<div class=\"table2\">\n<!-- IF CITY ne '' or COUNTRY ne '' or ZIP ne '' -->\n\t\t\t\t\t\t\t\t<b>{L_014}:</b> <!-- IF CITY ne '' -->{CITY}<!-- ENDIF --> <!-- IF COUNTRY ne '' -->{COUNTRY}<!-- ENDIF --> <!-- IF ZIP ne '' -->({ZIP})<!-- ENDIF --><br>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t<b>{L_025}:</b> {SHIPPING}, {INTERNATIONAL}<br>\n<!-- ENDIF -->\n<!-- IF SHIPPINGTERMS ne '' -->\n\t\t\t\t\t\t\t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\"><b>{L_25_0215}:</b>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">{SHIPPINGTERMS}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_026}:</b> {PAYMENTS}<br>\n<!-- IF ! B_BUY_NOW_ONLY -->\n\t\t\t\t\t\t\t\t<b><!-- IF ATYPE eq 1 -->{L_127}<!-- ELSE -->{L_038}<!-- ENDIF -->:</b> {MINBID}<br>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_111}:</b> {STARTTIME}<br>\n\t\t\t\t\t\t\t\t<b>{L_112}:</b> {ENDTIME}<br>\n\t\t\t\t\t\t\t\t<b>{L_113}:</b> {ID}<br>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_041}:</b> {CATSPATH}<br>\n<!-- IF SECCATSPATH ne '' -->\n\t\t\t\t\t\t\t\t<b>{L_814}:</b> {SECCATSPATH}\n<!-- ENDIF -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t<br>\n\t\t</div>\n\t</div>\n</div>\n", "<!-- IF B_COUNTDOWN -->\n<script type=\"text/javascript\">\n$(document).ready(function() {\n\tvar timeRemaining = {ENDS_IN};\n\tvar endDateTime = new Date();\n\tendDateTime.setSeconds(endDateTime.getSeconds() + timeRemaining);\n\tfunction padLength(what)\n\t{\n\t\tvar output = (what.toString().length == 1) ? '0' + what : what;\n\t\treturn output;\n\t}\n\tfunction displayTime() {\n\t\tvar currentDateTime = new Date();\n\n\t\tif (currentDateTime.getTime() < endDateTime.getTime()) {\n\t\t\tvar remainingTime = Math.floor((endDateTime.getTime() - currentDateTime.getTime()) / 1000);\n\t\t\tvar hours = Math.floor(remainingTime / 3600);\n\t\t\tvar mins = Math.floor((remainingTime - (hours * 3600)) / 60);\n\t\t\tvar secs = Math.floor(remainingTime - (hours * 3600) - (mins * 60));\n\n\t\t\tvar timeString = padLength(hours) + ':' + padLength(mins) + ':' + padLength(secs);\n\t\t\t$('#ending_counter').html(timeString);\n\t\t\tsetTimeout(displayTime, 1000);\n\t\t} else {\n\t\t\t$(\"#ending_counter\").html('<div class=\"error-box\">{L_911}</div>');\n\t\t}\n\t}\n\tsetTimeout(displayTime, 1000);\n});\n</script>\n<!-- ENDIF -->\n<div class=\"row\">\n\t<div class=\"col-md-12\">\n\t\t<ul class=\"breadcrumb\"><b>{L_041}:</b> {TOPCATSPATH}</ul>\n\t\t<div class=\"panel panel-default sm-padding\" style=\"text-align: right;\">\n\t\t\t{VIEW_HISTORY1}\n\t\t\t<a href=\"{SITEURL}friend.php?id={ID}\">{L_106}</a> |\n<!-- IF B_CANCONTACTSELLER -->\n\t\t\t<a href=\"{SITEURL}send_email.php?auction_id={ID}\">{L_922}</a> |\n<!-- ENDIF -->\n<!-- IF B_LOGGED_IN -->\n\t\t\t<a href=\"{SITEURL}item_watch.php?{WATCH_VAR}={ID}\">{WATCH_STRING}</a>\n<!-- ELSE -->\n\t\t\t<a href=\"{SITEURL}user_login.php?\">{L_5202}</a>\n<!-- ENDIF -->\n\t\t</div>\n<!-- IF B_USERBID -->\n\t\t<div class=\"alert alert-success\" role=\"alert\">\n\t\t\t{YOURBIDMSG}\n\t\t</div>\n<!-- ENDIF -->\n\t\t<div class=\"row grid-padding\">\n\t\t\t<div class=\"col-md-5 col-sm-5 grid-padding\">\n\t\t\t\t<div class=\"item-title visible-xs text-capitalize\">{TITLE}</div>\n<!-- IF B_HASIMAGE -->\n\t\t\t\t<div class=\"main-gallery panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><span class=\"label label-default\">{L_113}: {ID}</span></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<div class=\"col-md-12\">\n\t\t\t\t\t\t\t<img class=\"img-rounded img-responsive center-block\" src=\"{SITEURL}getthumb.php?w=430&fromfile={PIC_URL}\" border=\"0\" align=\"center\" width=\"430px\">\n\t\t\t\t\t\t</div>\n\t<!-- IF B_HASGALELRY -->\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<a name=\"gallery\"></a>\n\t\t\t\t\t\t\t<div id=\"gallery\">\n\t\t<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t\t<div class=\"col-md-4 col-xs-4 col-sm-4\">\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}{UPLOADEDPATH}{ID}/{gallery.V}\" title=\"\" data-lightbox=\"gallery\">\n\t\t\t\t\t\t\t\t\t<img class=\"img-rounded img-responsive\" src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={UPLOADEDPATH}{ID}/{gallery.V}\" border=\"0\"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t<!-- END gallery -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t<!-- ENDIF -->\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-footer\">{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}</div>\n\t\t\t\t</div>\n<!-- ELSE -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><span class=\"label label-default\">{L_113}: {ID}</span></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<img class=\"thumbnail img-responsive center-block\" src=\"{SITEURL}/themes/{THEME}/img/no-picture-gallery.png\" alt=\"no picture\" width=\"430px\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-footer\">{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t</div>\n\t\t\t<div class=\"col-md-7 col-sm-7\">\n\t\t\t\t<div class=\"item-title hidden-xs text-capitalize\">{TITLE}</div>\n<!-- IF B_CANEDIT -->\n\t\t\t\t<a class=\"btn btn-primary btn-xs\" href=\"{SITEURL}edit_active_auction.php?id={ID}\">{L_30_0069}</a>\n<!-- ENDIF -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<table class=\"table table-bordered table-condensed table-striped\">\n\t\t\t\t\t\t<!-- auction type -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_261}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{AUCTION_TYPE}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<!-- higher bidder -->\n<!-- IF B_HASBUYER and B_NOTBNONLY -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width='30%' style=\"leftpan\" valign=\"top\">{L_117}: </td>\n\t\t\t\t\t\t\t<td>\n\t<!-- BEGIN high_bidders -->\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t<b>{high_bidders.BUYER_NAME}</b>\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={high_bidders.BUYER_ID}&amp;auction_id={ID}\"><b>{high_bidders.BUYER_NAME}</b></a>\n\t\t\t\t\t\t\t\t<b>(<a href=\"{SITEURL}feedback.php?id={high_bidders.BUYER_ID}&amp;faction=show\">{high_bidders.BUYER_FB}</a>)</b>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<img src=\"{SITEURL}images/icons/{high_bidders.BUYER_FB_ICON}\" alt=\"{high_bidders.BUYER_FB_ICON}\" class=\"fbstar\">\n\t<!-- END high_bidders -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_901}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{QTY}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_923}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{COUNTRY}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_118}: </td>\n\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n<!-- IF B_COUNTDOWN -->\n\t\t\t\t\t\t\t\t<span id=\"ending_counter\">{ENDS}</span>\n<!-- ELSE -->\n\t\t\t\t\t\t\t\t{ENDS}<!-- IF B_SHOWENDTIME --><br><span class=\"text-muted\"><small>({ENDTIME})</small></span><!-- ENDIF -->\n<!-- ENDIF -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_119}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{NUMBIDS} {VIEW_HISTORY2}</td>\n\t\t\t\t\t\t</tr>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">\n\t\t\t\t\t\t\t\t{L_038}:\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"left\">{MINBID}</td>\n\t\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_116}: </td>\n\t\t\t\t\t\t\t<td align=\"left\" valign=\"middle\">{MAXBID}<!-- IF B_HASRESERVE -->&nbsp;<span class=\"text-muted\"><small>{L_514}<small></span><!-- ENDIF --></td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_023}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{SHIPPING_COST}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF (B_ADDITIONAL_SHIPPING_COST or B_BUY_NOW_ONLY) and B_SHOW_ADDITIONAL_SHIPPING_COST -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_350_1008}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{ADDITIONAL_SHIPPING_COST}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_BUY_NOW -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_496}:</td>\n\t\t\t\t\t\t\t<td align=\"left\">\n\t\t\t\t\t\t\t\t{BUYNOW2}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_HASENDED -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan=\"2\" align=\"left\"><b>{L_904}</b></td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-7 col-sm-12\">\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><b>{L_30_0209}</b></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<a href='{SITEURL}profile.php?user_id={SELLER_ID}&amp;auction_id={ID}'><b>{SELLER_NICK}</b></a>\n\t\t\t\t\t\t\t(<a href='{SITEURL}feedback.php?id={SELLER_ID}&amp;faction=show'>{SELLER_TOTALFB}</A>)\n\t\t\t\t\t\t\t<!-- IF SELLER_FB_ICON ne '' --><img src=\"{SITEURL}images/icons/{SELLER_FB_ICON}\" alt=\"{SELLER_FB_ICON}\" class=\"fbstar\"><!-- ENDIF -->\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<ul class=\"list-unstyled\">\n\t\t\t\t\t\t\t\t<li>{L_5509}{SELLER_NUMFB}{L__0151}\n\t\t\t\t\t\t\t\t<li><b>{L_5506}{SELLER_FBPOS}</b>\n<!-- IF SELLER_FBNEG ne 0 -->\n\t\t\t\t\t\t\t\t<li>{SELLER_FBNEG}</li>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<li>{L_5508}{SELLER_REG}</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<a href=\"{SITEURL}active_auctions.php?user_id={SELLER_ID}\"><span class=\"glyphicon glyphicon-plus-sign\" aria-hidden=\"true\" style=\"padding-right: 5px;\"></span>{L_213}</a>\n\t\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t</div>\n<!-- IF B_HASENDED eq false and B_CAN_BUY -->\n\t\t\t\t\t\t<div class=\"well well-sm\">\n\t\t\t\t\t\t\t<div class=\"row\">\n\t<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t<form name=\"bid\" action=\"{SITEURL}bid.php\" method=\"post\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3 col-md-offset-2\">\n\t\t<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"qty\" placeholder=\"{L_284}\"> {QTY} {L_5408}\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"bid\" placeholder=\"{L_121}\">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-5\">\n\t\t<!-- IF ATYPE eq 1 -->\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-warning md-padding\">{L_124}: {NEXTBID}</div><br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"seller_id\" value=\"{SELLER_ID}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"title\" value=\"{TITLE}\" >\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"category\" value=\"{CAT_ID}\" >\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"\" value=\"{L_30_0208}\" class=\"form-control btn btn-primary\">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</form>\n\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t\t{BUYNOW} <a class=\"btn btn-success btn-block\" href=\"{SITEURL}buy_now.php?id={ID}\">{L_496}</a>\n\t\t\t\t\t\t\t\t</div>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_CAN_BUY eq false -->\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t<div class=\"alert alert-warning\" role=\"alert\">\n\t\t\t\t\t\t\t\t\t<span class=\"pull-left\"><span class=\"glyphicon glyphicon-info-sign\" aria-hidden=\"true\"></span>  {L_5002}</span> <span class=\"pull-right\"><a class=\"btn btn-warning btn-xs\" href=\"{SITEURL}user_login.php?\" class=\"alert-link\">{L_221}</a></span>\n\t\t\t\t\t\t\t\t\t<div class=\"clearfix\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<a class=\"report-item pull-right\" href='{SITEURL}item_report.php?id={ID}'>{L_report_this_item}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"description\"></a>{L_018}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t{AUCTION_DESCRIPTION}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- IF B_HAS_QUESTIONS -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"questions\"></a>{L_552}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t<!-- BEGIN questions -->\n\t\t\t\t\t\t<span class=\"glyphicon glyphicon-comment\" aria-hidden=\"true\" style=\"padding-right: 10px;\"></span>\n\t\t\t\t\t\t<div class=\"well well-sm\">\n\t\t<!-- BEGIN conv -->\n\t\t\t\t\t\t\t<p><span class=\"text-muted\"><small>{questions.conv.BY_WHO}:</small></span> {questions.conv.MESSAGE}</p>\n\t\t<!-- END conv -->\n\t\t\t\t\t\t</div>\n\t<!-- END questions -->\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\">{L_724}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"tableContent2\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"table2\">\n<!-- IF CITY ne '' or COUNTRY ne '' or ZIP ne '' -->\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_014}:</b> <!-- IF CITY ne '' -->{CITY}<!-- ENDIF --> <!-- IF COUNTRY ne '' -->{COUNTRY}<!-- ENDIF --> <!-- IF ZIP ne '' -->({ZIP})<!-- ENDIF --><br>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_025}:</b> {SHIPPING}, {INTERNATIONAL}<br>\n<!-- ENDIF -->\n<!-- IF SHIPPINGTERMS ne '' -->\n\t\t\t\t\t\t\t\t\t\t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td valign=\"top\"><b>{L_25_0215}:</b>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">{SHIPPINGTERMS}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_026}:</b> {PAYMENTS}<br>\n<!-- IF ! B_BUY_NOW_ONLY -->\n\t\t\t\t\t\t\t\t\t\t\t<b><!-- IF ATYPE eq 1 -->{L_127}<!-- ELSE -->{L_038}<!-- ENDIF -->:</b> {MINBID}<br>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_111}:</b> {STARTTIME}<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_112}:</b> {ENDTIME}<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_113}:</b> {ID}<br>\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_041}:</b> {CATSPATH}<br>\n\t\t\t\t\t\t\t\t\t\t\t<!-- IF SECCATSPATH ne '' --><b>{L_814}:</b> {SECCATSPATH}<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- IF B_SHOWHISTORY -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"history\"></a>{L_26_0001}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<table class=\"table table-bordered table-striped table-condensed\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_176}</th>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_130}</th>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_175}</th>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_284}</th>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</tr>\n\t<!-- BEGIN bidhistory -->\n\t\t\t\t\t\t\t<tr valign=\"top\" {bidhistory.BGCOLOUR}>\n\t\t\t\t\t\t\t\t<td>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t\t{bidhistory.NAME}\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={bidhistory.ID}\">{bidhistory.NAME}</a>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.BID}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.WHEN}\n\t\t\t\t\t\t\t\t</td>\n\t\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.QTY}\n\t\t\t\t\t\t\t\t</td>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</tr>\n\t<!-- END bidhistory -->\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ndefine('AtLogin', 1);\ninclude 'common.php';\n\nif (isset($_SESSION['LOGIN_MESSAGE'])) {\n    $ERR = $_SESSION['LOGIN_MESSAGE'];\n    unset($_SESSION['LOGIN_MESSAGE']);\n}\n\nif (isset($_POST['action']) && isset($_POST['username']) && isset($_POST['password'])) {\n    include PACKAGE_PATH . 'PasswordHash.php';\n    $phpass = new PasswordHash(8, false);\n    $query = \"SELECT id, hash, suspended, password, password_type FROM \" . $DBPrefix . \"users WHERE nick = :nick OR email = :email\";\n    $params = array();\n    $params[] = array(':nick', $system->cleanvars($_POST['username']), 'str');\n    $params[] = array(':email', $system->cleanvars($_POST['username']), 'str');\n    $db->query($query, $params);\n    $user_data = $db->result();\n\n    if ($user_data['password_type'] == 0 && $user_data['password'] == md5($MD5_PREFIX . $_POST['password'])) {\n        $query = \"UPDATE \" . $DBPrefix . \"users SET password = :password, password_type = 1 WHERE id = :user_id\";\n        $params = array();\n        $params[] = array(':password', $phpass->HashPassword($_POST['password']), 'int');\n        $params[] = array(':user_id', $user_data['id'], 'int');\n        $db->query($query, $params);\n\n        $query = \"SELECT id, hash, suspended, password, password_type FROM \" . $DBPrefix . \"users WHERE nick = :nick OR email = :email\";\n        $params = array();\n        $params[] = array(':nick', $system->cleanvars($_POST['username']), 'str');\n        $params[] = array(':email', $system->cleanvars($_POST['username']), 'str');\n        $db->query($query, $params);\n        $user_data = $db->result();\n    }\n\n    if ($phpass->CheckPassword($_POST['password'], $user_data['password'])) {\n        // generate a random unguessable token\n        $_SESSION['csrftoken'] = md5(uniqid(rand(), true));\n\n        if ($user_data['suspended'] == 9) {\n            $_SESSION['signup_id'] = $user_data['id'];\n            header('location: pay.php?a=3');\n            exit;\n        }\n\n        if ($user_data['suspended'] == 1) {\n            $ERR = $ERR_618;\n        } elseif ($user_data['suspended'] == 8) {\n            $ERR = $ERR_620;\n        } elseif ($user_data['suspended'] == 10) {\n            $ERR = $ERR_621;\n        } else {\n            $_SESSION['WEBID_LOGGED_IN']        = $user_data['id'];\n            $_SESSION['WEBID_LOGGED_NUMBER']    = strspn($user_data['password'], $user_data['hash']);\n            $_SESSION['WEBID_LOGGED_PASS']        = $user_data['password'];\n            // Update \"last login\" fields in users table\n            $query = \"UPDATE \" . $DBPrefix . \"users SET lastlogin = CURRENT_TIMESTAMP WHERE id = :user_id\";\n            $params = array();\n            $params[] = array(':user_id', $user_data['id'], 'int');\n            $db->query($query, $params);\n            // Remember me option\n            if (isset($_POST['rememberme'])) {\n                $remember_key = md5(time());\n                $query = \"INSERT INTO \" . $DBPrefix . \"rememberme VALUES (:user_id, :remember_key)\";\n                $params = array();\n                $params[] = array(':remember_key', $remember_key, 'str');\n                $params[] = array(':user_id', $user_data['id'], 'int');\n                $db->query($query, $params);\n                setcookie('WEBID_RM_ID', $remember_key, time() + (3600 * 24 * 365));\n            }\n            $query = \"SELECT id FROM \" . $DBPrefix . \"usersips WHERE USER = :user_id AND ip = :user_ip\";\n            $params = array();\n            $params[] = array(':user_ip', $_SERVER['REMOTE_ADDR'], 'str');\n            $params[] = array(':user_id', $user_data['id'], 'int');\n            $db->query($query, $params);\n            if ($db->numrows() == 0) {\n                $query = \"INSERT INTO \" . $DBPrefix . \"usersips (user, ip, type, action)\n\t\t\t\t\t\tVALUES (:user_id, :user_ip, 'login', 'accept')\";\n                $params = array();\n                $params[] = array(':user_ip', $_SERVER['REMOTE_ADDR'], 'str');\n                $params[] = array(':user_id', $user_data['id'], 'int');\n                $db->query($query, $params);\n            }\n\n            // delete your old session\n            if (isset($_COOKIE['WEBID_ONLINE'])) {\n                $query = \"DELETE from \" . $DBPrefix . \"online WHERE SESSION = :SESSION\";\n                $params = array();\n                $params[] = array(':SESSION', alphanumeric($_COOKIE['WEBID_ONLINE']), 'str');\n                $db->query($query, $params);\n            }\n\n            if (in_array($user_data['suspended'], array(5, 6, 7))) {\n                header('location: message.php');\n                exit;\n            }\n\n            if (isset($_SESSION['REDIRECT_AFTER_LOGIN'])) {\n                $URL = str_replace('\\r', '', str_replace('\\n', '', $_SESSION['REDIRECT_AFTER_LOGIN']));\n                unset($_SESSION['REDIRECT_AFTER_LOGIN']);\n            } else {\n                $URL = 'user_menu.php';\n            }\n\n            header('location: ' . $URL);\n            exit;\n        }\n    } else {\n        $ERR = $ERR_038;\n    }\n}\n\n$template->assign_vars(array(\n        'ERROR' => (isset($ERR)) ? $ERR : '',\n        'USER' => (isset($_POST['username'])) ? $_POST['username'] : ''\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'user_login.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        $removed = 0;\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            // Delete auction views\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            // Auction\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n\n    if (isset($_POST['closenow']) && is_array($_POST['closenow']) && count($_POST['closenow']) > 0) {\n        foreach ($_POST['closenow'] as $k => $v) {\n            // Update end time to the current time\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET ends = CURRENT_TIMESTAMP, relist = relisted WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        include 'cron.php';\n        $user_message .= sprintf($MSG['1149'], count($_POST['closenow']));\n    }\n}\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) AS COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id AND closed = 0 AND starts <= CURRENT_TIMESTAMP AND suspended = 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] <= 1 || $_GET['PAGE'] == '') {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n\n// Handle columns sorting variables\nif (!isset($_SESSION['oa_ord']) && empty($_GET['oa_ord'])) {\n    $_SESSION['oa_ord'] = 'title';\n    $_SESSION['oa_type'] = 'asc';\n} elseif (!empty($_GET['oa_ord'])) {\n    $_SESSION['oa_ord'] = $_GET['oa_ord'];\n    $_SESSION['oa_type'] = $_GET['oa_type'];\n} elseif (isset($_SESSION['oa_ord']) && empty($_GET['oa_ord'])) {\n    $_SESSION['oa_nexttype'] = $_SESSION['oa_type'];\n}\nif (!isset($_SESSION['oa_nexttype']) || $_SESSION['oa_nexttype'] == 'desc') {\n    $_SESSION['oa_nexttype'] = 'asc';\n} else {\n    $_SESSION['oa_nexttype'] = 'desc';\n}\nif (!isset($_SESSION['oa_type']) || $_SESSION['oa_type'] == 'desc') {\n    $_SESSION['oa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['oa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id AND closed = 0\n\tAND starts <= CURRENT_TIMESTAMP AND suspended = 0\n\tORDER BY \" . $_SESSION['oa_ord'] . \" \" . $_SESSION['oa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    if ($item['num_bids'] > 0) {\n        $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id ORDER BY bid DESC, id DESC LIMIT 1\";\n        $params = array();\n        $params[] = array(':auc_id', $item['id'], 'int');\n        $db->query($query, $params);\n        if ($db->numrows() > 0) {\n            $high_bid = $db->result('bid');\n        }\n    }\n    // Retrieve counter\n    $query = \"SELECT counter FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n    $params = array();\n    $params[] = array(':auc_id', $item['id'], 'int');\n    $db->query($query, $params);\n    if ($db->numrows() > 0) {\n        $viewcounter = $db->result('counter');\n    } else {\n        $viewcounter = 0;\n    }\n\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n            'RELIST' => $item['relist'],\n            'RELISTED' => $item['relisted'],\n            'COUNTER' => $viewcounter,\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['oa_ord'],\n        'ORDERNEXT' => $_SESSION['oa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['oa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['619'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->logged_in) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_c.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n// DELETE OPEN AUCTIONS\n$catscontrol = new MPTTcategories();\n$user_message = '';\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'relist_fee'\";\n$db->direct_query($query);\n$relist_fee = $db->result('value');\n\n// Update\nif (isset($_POST['action']) && $_POST['action'] == 'update') {\n    // Delete auction\n    if (isset($_POST['delete']) && is_array($_POST['delete']) && count($_POST['delete']) > 0) {\n        foreach ($_POST['delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET closedauctions = closedauctions - 1\";\n            $db->direct_query($query);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        $user_message .= sprintf($MSG['1145'], count($_POST['delete']));\n    }\n    if (isset($_POST['sell']) && is_array($_POST['sell']) && count($_POST['sell']) > 0) {\n        foreach ($_POST['sell'] as $v) {\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET sold = 's' WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        include 'cron.php';\n        $user_message .= sprintf($MSG['1147'], count($_POST['sell']));\n    }\n    // Re-list auctions\n    if (isset($_POST['relist']) && is_array($_POST['relist']) && count($_POST['relist']) > 0) {\n        foreach ($_POST['relist'] as $k) {\n            $k = intval($k);\n            $query = \"SELECT duration, category, quantity FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n            $suspend = 0;\n\n            if ($system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees'] && $relist_fee > 0) {\n                if ($system->SETTINGS['fee_type'] == 1) {\n                    // charge relist fee\n                    $query = \"UPDATE \" . $DBPrefix . \"users SET balance = balance - :relist_fee WHERE id = :user_id\";\n                    $params = array();\n                    $params[] = array(':relist_fee', $relist_fee, 'float');\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $db->query($query, $params);\n                } else {\n                    $suspend = 8;\n                }\n            }\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($AUCTION['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions\n                      SET starts = CURRENT_TIMESTAMP,\n                      ends = :ends,\n                      closed = 0,\n                      num_bids = 0,\n                      relisted = relisted + 1,\n                      current_bid = 0,\n                      sold = 'n',\n                      suspended = :suspended\n                      WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':suspended', $suspend, 'int');\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // delete bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Proxy Bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Winners: only in case of reserve not reached\n            $query = \"DELETE FROM \" . $DBPrefix . \"winners WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Update COUNTERS table\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = auctions + 1\";\n            $db->direct_query($query);\n\n            // get category data to update it\n            $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n            $params = array();\n            $params[] = array(':cat_id', $AUCTION['category'], 'int');\n            $db->query($query, $params);\n\n            $parent_node = $db->result();\n            $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n            // update recursive categories\n            for ($i = 0; $i < count($crumbs); $i++) {\n                $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                $db->query($query, $params);\n            }\n            if ($system->SETTINGS['fee_type'] == 2 && isset($relist_fee) && $relist_fee > 0) {\n                header('location: pay.php?a=5');\n                exit;\n            }\n        }\n        $user_message .= sprintf($MSG['1146'], count($_POST['relist']));\n        if ($relist_fee > 0) {\n            $user_message .= sprintf($MSG['1148'], $system->print_money((count($_POST['relist']) * $relist_fee), true, false));\n        }\n    }\n}\n\n// Retrieve closed auction data from the database\n$query = \"SELECT COUNT(id) AS COUNT FROM \" . $DBPrefix . \"auctions\n          WHERE user = :user_id\n          AND closed = 1 AND suspended = 0\n          AND (num_bids = 0 OR (num_bids > 0 AND current_bid < reserve_price AND sold = 'n'))\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == 1) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['ca_ord']) && empty($_GET['ca_ord'])) {\n    $_SESSION['ca_ord'] = 'title';\n    $_SESSION['ca_type'] = 'asc';\n} elseif (!empty($_GET['ca_ord'])) {\n    $_SESSION['ca_ord'] = $_GET['ca_ord'];\n    $_SESSION['ca_type'] = $_GET['ca_type'];\n} elseif (isset($_SESSION['ca_ord']) && empty($_GET['ca_ord'])) {\n    $_SESSION['ca_nexttype'] = $_SESSION['ca_type'];\n}\n\nif (!isset($_SESSION['ca_nexttype']) || $_SESSION['ca_nexttype'] == 'desc') {\n    $_SESSION['ca_nexttype'] = 'asc';\n} else {\n    $_SESSION['ca_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['ca_type']) || $_SESSION['ca_type'] == 'desc') {\n    $_SESSION['ca_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\">';\n} else {\n    $_SESSION['ca_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\">';\n}\n\n$query = \"SELECT *  FROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id\n\tAND closed = 1 AND suspended = 0\n\tAND (num_bids = 0 OR (num_bids > 0 AND reserve_price > 0 AND current_bid < reserve_price AND sold = 'n'))\n\tORDER BY \" . $_SESSION['ca_ord'] . \" \" . $_SESSION['ca_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $canrelist = false;\n    if (($item['current_bid'] > $item['reserve_price'])) {\n        $cansell = false;\n    } else {\n        if ($item['reserve_price'] > 0 || $item['num_bids'] == 0) {\n            $canrelist = true;\n        }\n        if ($item['reserve_price'] > 0 && $item['num_bids'] > 0) {\n            $cansell = true;\n        } else {\n            $cansell = false;\n        }\n    }\n\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => ($item['current_bid'] == 0) ? '-' : $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n\n            'B_CANRELIST' => $canrelist,\n            'B_CANSSELL' => $cansell,\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n\n    $i++;\n}\n\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['ca_ord'],\n        'ORDERNEXT' => $_SESSION['ca_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['ca_type_img'],\n        'RELIST_FEE' => $system->print_money($relist_fee),\n        'RELIST_FEE_NO' => $system->print_money_nosymbol($relist_fee),\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0),\n        'B_RELIST_FEE' => ($relist_fee > 0 && $system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees']),\n        'B_AUTORELIST' => ($system->SETTINGS['autorelist'] == 'y')\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['204'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_c.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_p.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        $removed = 0;\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n\n    if (isset($_POST['startnow']) && is_array($_POST['startnow']) && count($_POST['startnow']) > 0) {\n        foreach ($_POST['startnow'] as $k => $v) {\n            $query = \"SELECT duration FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $aucdata = $db->result();\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($aucdata['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            // Update end time to \"now\"\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET starts = CURRENT_TIMESTAMP, ends = :ends WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        $user_message .= sprintf($MSG['1150'], count($_POST['closenow']));\n    }\n}\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) AS COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id and starts > CURRENT_TIMESTAMP AND suspended = 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['pa_ord']) && empty($_GET['pa_ord'])) {\n    $_SESSION['pa_ord'] = 'title';\n    $_SESSION['pa_type'] = 'asc';\n} elseif (!empty($_GET['pa_ord'])) {\n    $_SESSION['pa_ord'] = $_GET['pa_ord'];\n    $_SESSION['pa_type'] = $_GET['pa_type'];\n} elseif (isset($_SESSION['pa_ord']) && empty($_GET['pa_ord'])) {\n    $_SESSION['pa_nexttype'] = $_SESSION['pa_type'];\n}\n\nif (!isset($_SESSION['pa_nexttype']) || $_SESSION['pa_nexttype'] == 'desc') {\n    $_SESSION['pa_nexttype'] = 'asc';\n} else {\n    $_SESSION['pa_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['pa_type']) || $_SESSION['pa_type'] == 'desc') {\n    $_SESSION['pa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['pa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions au\n\tWHERE user = :user_id AND starts > CURRENT_TIMESTAMP AND suspended = 0\n\tORDER BY \" . $_SESSION['pa_ord'] . \" \" . $_SESSION['pa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['pa_ord'],\n        'ORDERNEXT' => $_SESSION['pa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['pa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['25_0115'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_p.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n$user_message = '';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_s.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $removed = 0;\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            // remove auction\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n}\n\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) as COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id AND suspended != 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {\n    $_SESSION['sa_ord'] = 'title';\n    $_SESSION['sa_type'] = 'asc';\n} elseif (!empty($_GET['sa_ord'])) {\n    $_SESSION['sa_ord'] = $_GET['sa_ord'];\n    $_SESSION['sa_type'] = $_GET['sa_type'];\n} elseif (isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {\n    $_SESSION['sa_nexttype'] = $_SESSION['sa_type'];\n}\n\nif (!isset($_SESSION['sa_nexttype']) || $_SESSION['sa_nexttype'] == 'desc') {\n    $_SESSION['sa_nexttype'] = 'asc';\n} else {\n    $_SESSION['sa_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['sa_type']) || $_SESSION['sa_type'] == 'desc') {\n    $_SESSION['sa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['sa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n$query = \"SELECT id, title, current_bid, num_bids, relist, relisted, current_bid, suspended\n\tFROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id\n\tAND suspended != 0\n\tORDER BY \" . $_SESSION['sa_ord'] . \" \" . $_SESSION['sa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'BID' => $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n            'RELIST' => $item['relist'],\n            'RELISTED' => $item['relisted'],\n            'SUSPENDED' => $item['suspended'],\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['sa_ord'],\n        'ORDERNEXT' => $_SESSION['sa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['sa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['2__0056'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_s.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_sold.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'relist_fee'\";\n$db->direct_query($query);\n$relist_fee = $db->result('value');\n\n// Update\nif (isset($_POST['action']) && $_POST['action'] == 'update') {\n    // Re-list auctions\n    if (isset($_POST['relist']) && is_array($_POST['relist']) && count($_POST['relist']) > 0) {\n        foreach ($_POST['relist'] as $k) {\n            $k = intval($k);\n            $query = \"SELECT duration, category FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n            $suspend = 0;\n\n            if ($system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees'] && $relist_fee > 0) {\n                if ($system->SETTINGS['fee_type'] == 1) {\n                    // charge relist fee\n                    $query = \"UPDATE \" . $DBPrefix . \"users SET balance = balance - :relist_fee WHERE id = :user_id\";\n                    $params = array();\n                    $params[] = array(':relist_fee', $relist_fee, 'float');\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $db->query($query, $params);\n                } else {\n                    $suspend = 8;\n                }\n            }\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($AUCTION['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions\n\t\t\t\t\tSET starts = CURRENT_TIMESTAMP,\n\t\t\t\t\tends = :ends,\n\t\t\t\t\tclosed = 0,\n\t\t\t\t\tnum_bids = 0,\n\t\t\t\t\trelisted = relisted + 1,\n\t\t\t\t\tcurrent_bid = 0,\n\t\t\t\t\tsold = 'n',\n\t\t\t\t\tsuspended = :suspended\n\t\t\t\t\tWHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':suspended', $suspend, 'int');\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // delete bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Proxy Bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Winners: only in case of reserve not reached\n            $query = \"DELETE FROM \" . $DBPrefix . \"winners WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Update COUNTERS table\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = auctions + 1\";\n            $db->direct_query($query);\n\n            // get category data to update it\n            $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n            $params = array();\n            $params[] = array(':cat_id', $AUCTION['category'], 'int');\n            $db->query($query, $params);\n\n            $parent_node = $db->result();\n            $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n            // update recursive categories\n            for ($i = 0; $i < count($crumbs); $i++) {\n                $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                $db->query($query, $params);\n            }\n            if ($system->SETTINGS['fee_type'] == 2 && isset($relist_fee) && $relist_fee > 0) {\n                header('location: pay.php?a=5');\n                exit;\n            }\n        }\n        $user_message .= sprintf($MSG['1146'], count($_POST['relist']));\n        if ($relist_fee > 0) {\n            $user_message .= sprintf($MSG['1148'], $system->print_money(count($_POST['relist']) * $relist_fee));\n        }\n    }\n}\n\n// Retrieve sold auction data from the database\n$query = \"SELECT COUNT(a.id) AS COUNT FROM \" . $DBPrefix . \"auctions a, \" . $DBPrefix . \"winners w\n\t\tWHERE a.user = :user_id AND a.closed = 1 AND a.suspended = 0 AND a.id = w.auction GROUP BY w.auction\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n\n// Handle columns sorting variables\nif (!isset($_SESSION['solda_ord']) && empty($_GET['solda_ord'])) {\n    $_SESSION['solda_ord'] = 'title';\n    $_SESSION['solda_type'] = 'asc';\n} elseif (!empty($_GET['solda_ord'])) {\n    $_SESSION['solda_ord'] = $_GET['solda_ord'];\n    $_SESSION['solda_type'] = $_GET['solda_type'];\n} elseif (isset($_SESSION['solda_ord']) && empty($_GET['solda_ord'])) {\n    $_SESSION['solda_nexttype'] = $_SESSION['solda_type'];\n}\n\nif (!isset($_SESSION['solda_nexttype']) || $_SESSION['solda_nexttype'] == 'desc') {\n    $_SESSION['solda_nexttype'] = 'asc';\n} else {\n    $_SESSION['solda_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['solda_type']) || $_SESSION['solda_type'] == 'desc') {\n    $_SESSION['solda_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" alt=\"up\"/>';\n} else {\n    $_SESSION['solda_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" alt=\"down\"/>';\n}\n\n$query = \"SELECT a.* FROM \" . $DBPrefix . \"auctions a\n\tLEFT JOIN \" . $DBPrefix . \"winners w ON (a.id = w.auction)\n\tWHERE a.user = :user_id\n\tAND a.closed = 1\n\tAND a.suspended = 0\n\tGROUP BY a.id\n\tORDER BY \" . $_SESSION['solda_ord'] . \" \" . $_SESSION['solda_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => ($item['current_bid'] == 0) ? '-' : $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n\n            'B_CLOSED' => ($item['closed']),\n            'B_HASNOBIDS' => ($item['current_bid'] == 0),\n            'B_BUY_NOW_ONLY' => ($item['bn_only']),\n            'B_BUY_NOW' => ($item['bn_sale'] == 1),\n            'B_DUTCH' => ($item['auction_type'] == 2)\n            ));\n    $i++;\n}\n\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $COUNTER . '&id=' . $id . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'ORDERCOL' => $_SESSION['solda_ord'],\n        'ORDERNEXT' => $_SESSION['solda_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['solda_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $PREV . '&id=' . $id . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $NEXT . '&id=' . $id . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['25_0119'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_sold.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n"], "fixing_code": ["<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\nif (isset($_GET['user_id']) && !empty($_GET['user_id'])) {\n    $user_id = intval($_GET['user_id']);\n    // check trying to access valid user id\n    $user->checkUserValid($user_id);\n} elseif ($user->logged_in) {\n    $user_id = $user->user_data['id'];\n} else {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'active_auctions.php';\n    header('location: user_login.php');\n    exit;\n}\n\n// get number of active auctions for this user\n$query = \"SELECT count(id) AS auctions FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 0\n\t\tAND suspended = 0\n\t\tAND starts <= CURRENT_TIMESTAMP\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$num_auctions = $db->result('auctions');\n\n// Handle pagination\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == '' || $_GET['PAGE'] < 1) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ceil($num_auctions / $system->SETTINGS['perpage']);\nif (!isset($PAGES) || $PAGES < 1) {\n    $PAGES = 1;\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 0\n\t\tAND suspended = 0\n\t\tAND starts <= CURRENT_TIMESTAMP\n\t\tORDER BY ends ASC LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$k = 0;\nwhile ($row = $db->fetch()) {\n    if (strlen($row['pict_url']) > 0) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&auction_id=' . $row['id'] . '&fromfile=' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n\n    $template->assign_block_vars('auctions', array(\n            'BGCOLOUR' => (!($k % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $row['id'],\n            'PIC_URL' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'BNIMG' => get_lang_img(($row['bn_only'] == 0) ? 'buy_it_now.gif' : 'bn_only.png'),\n            'BNVALUE' => $row['buy_now'],\n            'BNFORMAT' => $system->print_money($row['buy_now']),\n            'BIDVALUE' => $row['current_bid'],\n            'BIDFORMAT' => $system->print_money($row['current_bid']),\n            'NUM_BIDS' => $row['num_bids'],\n            'TIMELEFT' => $dt->formatTimeLeft($difference),\n\n            'B_BUY_NOW' => ($row['buy_now'] > 0 && ($row['bn_only'] || $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price'])))),\n            'B_BNONLY' => ($row['bn_only'])\n            ));\n    $k++;\n}\n\n// get this user's nick\n$query = \"SELECT nick FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TPL_user_nick = $db->result('nick');\n$page_title = $MSG['219'] . ': ' . $TPL_user_nick;\n\n$LOW = $PAGE - 5;\nif ($LOW <= 0) {\n    $LOW = 1;\n}\n$COUNTER = $LOW;\n$pagenation = '';\nwhile ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n    if ($PAGE == $COUNTER) {\n        $pagenation .= '<b>' . $COUNTER . '</b>&nbsp;&nbsp;';\n    } else {\n        $pagenation .= '<a href=\"active_auctions.php?PAGE=' . $COUNTER . '&user_id=' . $user_id . '\"><u>' . $COUNTER . '</u></a>&nbsp;&nbsp;';\n    }\n    $COUNTER++;\n}\n\n$template->assign_vars(array(\n        'B_MULPAG' => ($PAGES > 1),\n        'B_NOTLAST' => ($PAGE < $PAGES),\n        'B_NOTFIRST' => ($PAGE > 1),\n\n        'USER_RSSFEED' => sprintf($MSG['932'], $TPL_user_nick),\n        'USER_ID' => $user_id,\n        'USERNAME' => $TPL_user_nick,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'NEXT' => intval($PAGE + 1),\n        'PREV' => intval($PAGE - 1),\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n        'PAGENA' => $pagenation\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'active_auctions.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ndefine('InAdmin', 1);\n$current_page = 'auctions';\ninclude '../common.php';\ninclude INCLUDE_PATH . 'functions_admin.php';\ninclude 'loggedin.inc.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\ninclude PACKAGE_PATH . 'ckeditor/ckeditor.php';\n\n$catscontrol = new MPTTcategories();\n\n// Data check\nif (!isset($_REQUEST['id'])) {\n    $URL = $_SESSION['RETURN_LIST'];\n    header('location: ' . $URL);\n    exit;\n}\n\nfunction load_gallery($auc_id)\n{\n    $UPLOADED_PICTURES = array();\n    if (is_dir(UPLOAD_PATH . $auc_id)) {\n        if ($dir = opendir(UPLOAD_PATH . $auc_id)) {\n            while ($file = @readdir($dir)) {\n                if ($file != '.' && $file != '..' && strpos($file, 'thumb-') === false) {\n                    $UPLOADED_PICTURES[] = $file;\n                }\n            }\n            closedir($dir);\n        }\n    }\n    return $UPLOADED_PICTURES;\n}\n\nif (isset($_POST['action'])) {\n    // Check that all the fields are not NULL\n    if (!empty($_POST['id']) && !empty($_POST['title']) && !empty($_POST['duration']) && !empty($_POST['category']) && !empty($_POST['description']) && !empty($_POST['min_bid'])) {\n        // fix values\n        $_POST['quantity'] = (empty($_POST['quantity'])) ? 1 : $_POST['quantity'];\n        $_POST['customincrement'] = (empty($_POST['customincrement'])) ? 0 : $_POST['customincrement'];\n        // Check the input values for validity.\n        if ($_POST['quantity'] < 1) { // 1 or more items being sold\n            $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $ERR_601));\n        } elseif (isset($_POST['current_bid']) && $_POST['current_bid'] < $_POST['min_bid'] && $_POST['current_bid'] != 0) { // bid > min_bid\n            $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $MSG['error_current_bid_too_low']));\n        } else {\n            // Retrieve auction data\n            $query = \"SELECT * from \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $_POST['id'], 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n\n            if ($AUCTION['category'] != $_POST['category']) {\n                // and increase new category counters\n                $ct = intval($_POST['category']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $ct, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $ct) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter + 1, sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n\n                // and decrease old category counters\n                $cta = intval($AUCTION['category']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $cta, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $cta) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter - 1, sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n            }\n\n            if ($AUCTION['secondcat'] != $_POST['secondcat']) {\n                // and increase new category counters\n                $ct = intval($_POST['secondcat']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $ct, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $ct) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter + 1, sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n\n                // and decrease old category counters\n                $cta = intval($AUCTION['secondcat']);\n                $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $cta, 'int');\n                $db->query($query, $params);\n                $parent_node = $db->result();\n\n                $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n                for ($i = 0; $i < count($crumbs); $i++) {\n                    if ($crumbs[$i]['cat_id'] == $cta) {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter - 1, sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter - 1 WHERE cat_id = :cat_id\";\n                    }\n                    $params = array();\n                    $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                    $db->query($query, $params);\n                }\n            }\n\n            // clean unwanted images\n            if (isset($_POST['gallery']) && is_array($_POST['gallery'])) {\n                $uploaded = load_gallery($_POST['id']);\n                foreach ($uploaded as $img) {\n                    if (in_array($img, $_POST['gallery'])) {\n                        unlink(MAIN_PATH . $img);\n                    }\n                }\n            }\n\n            $start_date = new DateTime($AUCTION['starts'], $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($_POST['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET\n                      title = :title,\n                      subtitle = :subtitle,\n                      ends = :ends,\n                      duration = :duration,\n                      category = :category,\n                      secondcat = :secondcat,\n                      description = :description,\n                      quantity = :quantity,\n                      minimum_bid = :minimum_bid,\n                      shipping_cost = :shipping_cost,\n                      buy_now = :buy_now,\n                      bn_only = :bn_only,\n                      reserve_price = :reserve_price,\n                      increment = :increment,\n                      shipping = :shipping,\n                      payment = :payment,\n                      international = :international,\n                      shipping_terms = :shipping_terms,\n                      bold = :bold,\n                      highlighted = :highlighted,\n                      featured = :featured\n                      WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':title', $system->cleanvars($_POST['title']), 'str');\n            $params[] = array(':subtitle', $system->cleanvars($_POST['subtitle']), 'str');\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':duration', $_POST['duration'], 'int');\n            $params[] = array(':category', $_POST['category'], 'int');\n            $params[] = array(':secondcat', $_POST['secondcat'], 'int');\n            $params[] = array(':description', $_POST['description'], 'str');\n            $params[] = array(':quantity', $_POST['quantity'], 'int');\n            $params[] = array(':minimum_bid', $system->input_money($_POST['min_bid']), 'float');\n            $params[] = array(':shipping_cost', $system->input_money($_POST['shipping_cost']), 'float');\n            $params[] = array(':buy_now', $system->input_money($_POST['buy_now']), 'float');\n            $params[] = array(':bn_only', $_POST['buy_now_only'], 'bool');\n            $params[] = array(':reserve_price', $system->input_money($_POST['reserve_price']), 'float');\n            $params[] = array(':increment', $system->input_money($_POST['customincrement']), 'float');\n            $params[] = array(':shipping', $_POST['shipping'], 'str');\n            $params[] = array(':payment', implode(', ', $_POST['payment']), 'str');\n            $params[] = array(':international', (isset($_POST['international'])), 'bool');\n            $params[] = array(':shipping_terms', $system->cleanvars($_POST['shipping_terms']), 'str');\n            $params[] = array(':bold', (isset($_POST['is_bold'])), 'bool');\n            $params[] = array(':highlighted', (isset($_POST['is_highlighted'])), 'bool');\n            $params[] = array(':featured', (isset($_POST['is_featured'])), 'bool');\n            $params[] = array(':auc_id', $_POST['id'], 'int');\n            $db->query($query, $params);\n\n            $URL = $_SESSION['RETURN_LIST'];\n            header('location: ' . $URL);\n            exit;\n        }\n    } else {\n        $template->assign_block_vars('alerts', array('TYPE' => 'error', 'MESSAGE' => $ERR_112));\n    }\n}\n\n$auc_id = intval($_REQUEST['id']);\n$query = \"SELECT u.nick, a.* FROM \" . $DBPrefix . \"auctions a\n          LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = a.user)\n          WHERE a.id = :auc_id\";\n$params = array();\n$params[] = array(':auc_id', $auc_id, 'int');\n$db->query($query, $params);\n\nif ($db->numrows() == 0) {\n    $URL = $_SESSION['RETURN_LIST'];\n    header('location: ' . $URL);\n    exit;\n}\n\n$auction_data = $db->result();\n\n// DURATIONS\n$query = \"SELECT days, description FROM \" . $DBPrefix . \"durations\";\n$db->direct_query($query);\n\nwhile ($row = $db->fetch()) {\n  $template->assign_block_vars('dur', array(\n      'DAYS' => $row['days'],\n      'SELECTED' => ($row['days'] == $auction_data['duration']),\n      'DESC' => $row['description']\n      ));\n}\n\n// CATEGORIES\nif (isset($category_plain) && count($category_plain) > 0) {\n  foreach ($category_plain as $cat_id => $cat_name) {\n    $template->assign_block_vars('cats1', array(\n        'CAT_ID' => $cat_id,\n        'CAT_NAME' => $cat_name,\n        'SELECTED' => ($cat_id == $auction_data['category'])\n        ));\n    $template->assign_block_vars('cats2', array(\n        'CAT_ID' => $cat_id,\n        'CAT_NAME' => $cat_name,$cat_name,\n        'SELECTED' => ($cat_id == $auction_data['secondcat'])\n        ));\n  }\n}\n\n// Pictures Gellery\n$K = 0;\n$UPLOADED_PICTURES = array();\nif (file_exists(UPLOAD_PATH . $auc_id)) {\n    // load dem pictures\n    $UPLOADED_PICTURES = load_gallery($auc_id);\n\n    if (is_array($UPLOADED_PICTURES)) {\n        foreach ($UPLOADED_PICTURES as $k => $v) {\n            $TMP = @getimagesize('../' . $v);\n            if ($TMP[2] >= 1 && $TMP[2] <= 3) {\n                $template->assign_block_vars('gallery', array(\n                    'V' => $v\n                    ));\n            }\n        }\n    }\n}\n\n// payments\n$payment = explode(', ', strtolower($auction_data['payment']));\n$payment_methods = '';\n$query = \"SELECT * FROM \" . $DBPrefix . \"payment_options\";\n$db->direct_query($query);\nwhile ($payment_method = $db->fetch()) {\n    if ($payment_method['gateway_active'] == 1 || $payment_method['is_gateway'] == 0) {\n        $checked = (in_array($payment_method['name'], $payment)) ? 'checked' : '';\n        $payment_methods .= '<p><input type=\"checkbox\" name=\"payment[]\" value=\"' . $payment_method['name'] . '\" ' . $checked . '> ' . $payment_method['displayname'] . '</p>';\n    }\n}\n\n$CKEditor = new CKEditor();\n$CKEditor->basePath = $system->SETTINGS['siteurl'] . '/js/ckeditor/';\n$CKEditor->returnOutput = true;\n$CKEditor->config['width'] = 550;\n$CKEditor->config['height'] = 400;\n\n$template->assign_vars(array(\n        'ID' => intval($_REQUEST['id']),\n        'USER' => $auction_data['nick'],\n        'TITLE' => $auction_data['title'],\n        'SUBTITLE' => $auction_data['subtitle'],\n        'EDITOR' => $CKEditor->editor('description', $auction_data['description']),\n        'CURRENT_BID' => $system->print_money_nosymbol($auction_data['current_bid']),\n        'MIN_BID' => $system->print_money_nosymbol($auction_data['minimum_bid']),\n        'QTY' => $auction_data['quantity'],\n        'PAYMENTS' => $payment_methods,\n        'ATYPE' => $system->SETTINGS['auction_types'][$auction_data['auction_type']],\n\n        'SHIPPING_COST' => $system->print_money_nosymbol($auction_data['shipping_cost']),\n        'RESERVE' => $system->print_money_nosymbol($auction_data['reserve_price']),\n        'BN_ONLY_Y' => ($auction_data['bn_only']) ? 'checked' : '',\n        'BN_ONLY_N' => ($auction_data['bn_only']) ? '' : 'checked',\n        'BN_PRICE' => $system->print_money_nosymbol($auction_data['buy_now']),\n        'CUSTOM_INC' => ($auction_data['increment'] > 0) ? $system->print_money_nosymbol($auction_data['increment']) : '',\n        'SHIPPING1' => ($auction_data['shipping'] == 1 || empty($auction_data['shipping'])) ? 'checked' : '',\n        'SHIPPING2' => ($auction_data['shipping'] == 2) ? 'checked' : '',\n        'INTERNATIONAL' => (!empty($auction_data['international'])) ? 'checked' : '',\n        'SHIPPING_TERMS' => $auction_data['shipping_terms'],\n        'IS_BOLD' => ($auction_data['bold']) ? 'checked' : '',\n        'IS_HIGHLIGHTED' => ($auction_data['highlighted']) ? 'checked' : '',\n        'IS_FEATURED' => ($auction_data['featured']) ? 'checked' : '',\n        'SUSPENDED' => ($auction_data['suspended'] == 0) ? $MSG['no'] : $MSG['yes'],\n\n        'B_MKFEATURED' => ($system->SETTINGS['ao_hpf_enabled'] == 'y'),\n        'B_MKBOLD' => ($system->SETTINGS['ao_bi_enabled'] == 'y'),\n        'B_MKHIGHLIGHT' => ($system->SETTINGS['ao_hi_enabled'] == 'y')\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'editauction.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude INCLUDE_PATH . 'datacheck.inc.php';\n\n$id = intval($_REQUEST['id']);\n$bid = (isset($_POST['bid'])) ? $_POST['bid'] : 0;\n$qty = (isset($_POST['qty'])) ? intval($_POST['qty']) : 1;\n$bidding_ended = false;\n\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5002'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'bid.php?id=' . $id;\n    header('location: user_login.php');\n    exit;\n}\n\n$bidder_id = $user->user_data['id'];\nif (in_array($user->user_data['suspended'], array(5, 6, 7))) {\n    header('location: message.php');\n    exit;\n}\n\nif (!$user->permissions['can_buy']) {\n    $_SESSION['TMP_MSG'] = $MSG['819'];\n    header('location: user_menu.php');\n    exit;\n}\n\nfunction get_increment($val, $input_check = true)\n{\n    global $db, $DBPrefix, $system;\n\n    if ($input_check) {\n        $val = $system->input_money($val);\n    }\n    // Get bid increment for current bid and calculate minimum bid\n    $query = \"SELECT increment FROM \" . $DBPrefix . \"increments WHERE\n              ((low <= :val0 AND high >= :val1) OR\n              (low < :val2 AND high < :val3)) ORDER BY increment DESC\";\n    $params = array();\n    $params[] = array(':val0', $val, 'float');\n    $params[] = array(':val1', $val, 'float');\n    $params[] = array(':val2', $val, 'float');\n    $params[] = array(':val3', $val, 'float');\n    $db->query($query, $params);\n    if ($db->numrows() != 0) {\n        $increment = $db->result('increment');\n    }\n    return $increment;\n}\n\nfunction extend_auction($id, $ends)\n{\n    global $system, $db, $DBPrefix;\n\n    if ($system->SETTINGS['ae_status'] == 'y' && (strtotime($ends) - $system->SETTINGS['ae_timebefore']) < time()) {\n        $query = \"UPDATE \" . $DBPrefix . \"auctions SET ends = DATE_ADD(ends, INTERVAL \" . $system->SETTINGS['ae_extend'] . \" SECOND) WHERE id = :auc_id\";\n        $params = array();\n        $params[] = array(':auc_id', $id, 'int');\n        $db->query($query, $params);\n    }\n}\n\n// first check if valid auction ID passed\n$query = \"SELECT a.*, u.nick, u.email, u.id AS uId FROM \" . $DBPrefix . \"auctions a\n          LEFT JOIN \" . $DBPrefix . \"users u ON (a.user = u.id)\n          WHERE a.id = :auc_id\";\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n// such auction does not exist\nif ($db->numrows() == 0) {\n    $template->assign_vars(array(\n            'TITLE_MESSAGE' => $MSG['415'],\n            'BODY_MESSAGE' => $ERR_606\n            ));\n    include 'header.php';\n    $template->set_filenames(array(\n            'body' => 'message.tpl'\n            ));\n    $template->display('body');\n    include 'footer.php';\n    exit; // kill the page\n}\n\n// check user entered a bid\nif (empty($bid) && !isset($errmsg)) {\n    $errmsg = $ERR_072;\n}\n\n// check the bid is valid\nif (!$system->CheckMoney($bid) && !isset($errmsg)) {\n    $errmsg = $ERR_058;\n} else {\n    // reformat bid to valid number\n    $bid = round($system->input_money($bid), 2);\n}\n\n$Data = $db->result();\n$item_title = htmlspecialchars($Data['title']);\n$item_id = $Data['id'];\n$seller_name = $Data['nick'];\n$seller_email = $Data['email'];\n$atype = $Data['auction_type'];\n$aquantity = $Data['quantity'];\n$minimum_bid = $Data['minimum_bid'];\n$customincrement = $Data['increment'];\n$current_bid = $Data['current_bid'];\n$pict_url_plain = $Data['pict_url'];\n$reserve = $Data['reserve_price'];\n$cbid = ($current_bid == 0) ? $minimum_bid : $current_bid;\n\nif ((strtotime($Data['ends']) <= time() || $Data['closed']) && !isset($errmsg)) {\n    $errmsg = $ERR_614;\n}\nif ((strtotime($Data['starts']) > time()) && !isset($errmsg)) {\n    $errmsg = $ERR_073;\n}\nif ($aquantity < $qty) {\n    $errmsg = $ERR_608;\n}\n\n$query = \"SELECT bid, bidder FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id ORDER BY bid DESC, id DESC LIMIT 1\";\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n$last_highest_bid = array();\nif ($db->numrows() > 0) {\n    $last_highest_bid = $db->result();\n    $high_bid = $last_highest_bid['bid'];\n    $WINNING_BIDDER = $last_highest_bid['bidder'];\n    $ARETHEREBIDS = ' | <a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '&history=view#history\">' . $MSG['105'] . '</a>';\n} else {\n    $high_bid = $current_bid;\n    $WINNING_BIDDER = 0;\n}\n\nif ($customincrement > 0) {\n    $increment = $customincrement;\n} else {\n    $increment = get_increment($high_bid, false);\n}\n\nif (ceil($high_bid) == 0 || $atype == 2) {\n    $next_bid = $minimum_bid;\n} else {\n    $next_bid = $high_bid + $increment;\n}\n\n$tmpmsg = CheckBidData();\nif ($tmpmsg != 0 && !isset($errmsg)) {\n    $errmsg = ${'ERR_' . $tmpmsg};\n}\n\nif (isset($_POST['action']) && !isset($errmsg)) {\n    if ($system->SETTINGS['usersauth'] == 'y') {\n        if (strlen($_POST['password']) == 0) {\n            $errmsg = $ERR_004;\n        }\n        include PACKAGE_PATH . 'PasswordHash.php';\n        $phpass = new PasswordHash(8, false);\n        if (!($phpass->CheckPassword($_POST['password'], $user->user_data['password']))) {\n            $errmsg = $ERR_611;\n        }\n    }\n    $send_email = false;\n    // make the bid\n    if ($atype == 1 && !isset($errmsg)) { // normal auction\n        if ($system->SETTINGS['proxy_bidding'] == 'n') {\n            // is it the highest bid?\n            if ($current_bid < $bid) {\n                // did you outbid someone?\n                $query = \"SELECT u.id FROM \" . $DBPrefix . \"bids b, \" . $DBPrefix . \"users u WHERE b.auction = :auc_id AND b.bidder = u.id and u.suspended = 0 ORDER BY bid DESC\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $db->query($query, $params);\n                // send outbid email if there are previous bidders and they where not you\n                if ($db->numrows() > 0 && $db->result('id') != $bidder_id) {\n                    $send_email = true;\n                }\n                // Also update bids table\n                $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                          VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                $params = array();\n                $params[] = array(':bid', $bid, 'float');\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':qty', $qty, 'int');\n                $db->query($query, $params);\n                $current_bid_id = $db->lastInsertId();\n                $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                $params = array();\n                $params[] = array(':bid', $bid, 'float');\n                $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                $params[] = array(':auc_id', $id, 'int');\n                $db->query($query, $params);\n                extend_auction($item_id, $Data['ends']);\n                $bidding_ended = true;\n            }\n        } elseif ($WINNING_BIDDER == $bidder_id) {\n            $query = \"SELECT bid FROM \" . $DBPrefix . \"proxybid p\n                      LEFT JOIN \" . $DBPrefix . \"users u ON (p.userid = u.id)\n                      WHERE userid = :user_id AND itemid = :item_id ORDER BY bid DESC\";\n            $params = array();\n            $params[] = array(':user_id', $user->user_data['id'], 'int');\n            $params[] = array(':item_id', $id, 'int');\n            $db->query($query, $params);\n            if ($db->numrows() > 0) {\n                $WINNER_PROXYBID = $db->result('bid');\n                if ($WINNER_PROXYBID >= $bid) {\n                    $errmsg = $ERR_040;\n                } else {\n                    // Just update proxy_bid\n                    $query = \"UPDATE \" . $DBPrefix . \"proxybid SET bid = :newbid\n                              WHERE userid = :user_id\n                              AND itemid = :item_id AND bid = :oldbid\";\n                    $params = array();\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $params[] = array(':item_id', $id, 'int');\n                    $params[] = array(':oldbid', $WINNER_PROXYBID, 'float');\n                    $params[] = array(':newbid', $bid, 'float');\n                    $db->query($query, $params);\n\n                    if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                        // Also update bids table\n                        $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                                  VALUES (:auc_id, :bidder_id, :reserve, :qty)\";\n                        $params = array();\n                        $params[] = array(':reserve', $reserve, 'float');\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':qty', $qty, 'int');\n                        $db->query($query, $params);\n                        $current_bid_id = $db->lastInsertId();\n                        $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :reserve, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                        $params = array();\n                        $params[] = array(':reserve', $reserve, 'float');\n                        $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                        $params[] = array(':auc_id', $id, 'int');\n                        $db->query($query, $params);\n                    }\n                    extend_auction($item_id, $Data['ends']);\n                    $bidding_ended = true;\n                }\n            }\n        }\n        if (!$bidding_ended && !isset($errmsg) && $system->SETTINGS['proxy_bidding'] == 'y') {\n            $query = \"SELECT p.userid, p.bid FROM \" . $DBPrefix . \"proxybid p, \" . $DBPrefix . \"users u WHERE itemid = :item_id AND p.userid = u.id and u.suspended = 0 ORDER by bid DESC LIMIT 1\";\n            $params = array();\n            $params[] = array(':item_id', $id, 'int');\n            $db->query($query, $params);\n            if ($db->numrows() == 0) { // First bid\n                $query = \"INSERT INTO \" . $DBPrefix . \"proxybid VALUES (:auc_id, :bidder_id, :bid)\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':bid', $bid, 'float');\n                $db->query($query, $params);\n\n                if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                    $next_bid = $reserve;\n                }\n                // Also update bids table\n                $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                          VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':bidder_id', $bidder_id, 'int');\n                $params[] = array(':bid', $next_bid, 'float');\n                $params[] = array(':qty', $qty, 'int');\n                $db->query($query, $params);\n                $current_bid_id = $db->lastInsertId();\n                // Only updates current bid if it is a new bidder, not the current one\n                $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n                $params = array();\n                $params[] = array(':auc_id', $id, 'int');\n                $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                $params[] = array(':bid', $next_bid, 'float');\n                $db->query($query, $params);\n                $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 1)\";\n                $db->direct_query($query);\n            } else { // This is not the first bid\n                $proxy_bid_data = $db->result();\n                $proxy_bidder_id = $proxy_bid_data['userid'];\n                $proxy_max_bid = $proxy_bid_data['bid'];\n\n                if ($proxy_max_bid < $bid) {\n                    if ($proxy_bidder_id != $bidder_id) {\n                        $send_email = true;\n                    }\n                    $next_bid = $proxy_max_bid + $increment;\n                    if (($proxy_max_bid + $increment) > $bid) {\n                        $next_bid = $bid;\n                    }\n\n                    $query = \"SELECT userid, itemid FROM \" . $DBPrefix . \"proxybid WHERE itemid = :item_id AND userid = :bidder_id\";\n                    $params = array();\n                    $params[] = array(':item_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $db->query($query, $params);\n                    if ($db->numrows() == 0) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"proxybid VALUES (:auc_id, :bidder_id, :bid)\";\n                        $params = array();\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':bid', $bid, 'float');\n                        $db->query($query, $params);\n                    } else {\n                        $query = \"UPDATE \" . $DBPrefix . \"proxybid SET bid = :newbid WHERE userid = :bidder_id AND itemid = :item_id\";\n                        $params = array();\n                        $params[] = array(':bidder_id', $bidder_id, 'int');\n                        $params[] = array(':item_id', $id, 'int');\n                        $params[] = array(':newbid', $bid, 'float');\n                        $db->query($query, $params);\n                    }\n\n                    if ($reserve > 0 && $reserve > $current_bid && $bid >= $reserve) {\n                        $next_bid = $reserve;\n                    }\n                    // Fake bid to maintain a coherent history\n                    if ($current_bid < $proxy_max_bid) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                                  VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                        $params = array();\n                        $params[] = array(':auc_id', $id, 'int');\n                        $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                        $params[] = array(':bid', $proxy_max_bid, 'float');\n                        $params[] = array(':qty', $qty, 'int');\n                        $db->query($query, $params);\n                        $fakebids = 1;\n                    } else {\n                        $fakebids = 0;\n                    }\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $next_bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + (1 + :fakebids))\";\n                    $params = array();\n                    $params[] = array(':fakebids', $fakebids, 'int');\n                    $db->query($query, $params);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = (num_bids + 1 + :fakebids) WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':bid', $next_bid, 'float');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':fakebids', $fakebids, 'int');\n                    $params[] = array(':auc_id', $id, 'int');\n                    $db->query($query, $params);\n                } elseif ($proxy_max_bid == $bid) {\n                    echo 0;\n                    $cbid = $proxy_max_bid;\n                    $errmsg = $MSG['701'];\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 2)\";\n                    $db->direct_query($query);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 2 WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($cbid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    $next_bid = $cbid + $increment;\n                } elseif ($proxy_max_bid > $bid) {\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $bidder_id, 'int');\n                    $params[] = array(':bid', $bid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($bid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    if ($bid + $increment - $proxy_max_bid >= 0) {\n                        $cbid = $proxy_max_bid;\n                    } else {\n                        $cbid = $bid + $increment;\n                    }\n                    $errmsg = $MSG['701'];\n                    // Update bids table\n                    $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                              VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':bidder_id', $proxy_bidder_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $params[] = array(':qty', $qty, 'int');\n                    $db->query($query, $params);\n                    $current_bid_id = $db->lastInsertId();\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 2)\";\n                    $db->direct_query($query);\n                    $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 2 WHERE id = :auc_id\";\n                    $params = array();\n                    $params[] = array(':auc_id', $id, 'int');\n                    $params[] = array(':current_bid_id', $current_bid_id, 'int');\n                    $params[] = array(':bid', $cbid, 'float');\n                    $db->query($query, $params);\n                    if ($customincrement == 0) {\n                        // get new increment\n                        $increment = get_increment($cbid);\n                    } else {\n                        $increment = $customincrement;\n                    }\n                    $next_bid = $cbid + $increment;\n                }\n            }\n            extend_auction($item_id, $Data['ends']);\n        }\n    } elseif ($atype == 2 && !isset($errmsg)) { // dutch auction\n        // If the bidder already bid on this auction there new bbid must be higher\n        $query = \"SELECT bid, quantity FROM \" . $DBPrefix . \"bids WHERE bidder = :bidder_id AND auction = :auc_id ORDER BY bid DESC LIMIT 1\";\n        $params = array();\n        $params[] = array(':auc_id', $id, 'int');\n        $params[] = array(':bidder_id', $bidder_id, 'int');\n        $db->query($query, $params);\n        if ($db->numrows() > 0) {\n            $PREVIOUSBID = $db->result();\n            if (($bid * $qty) <= ($PREVIOUSBID['bid'] * $PREVIOUSBID['quantity'])) {\n                $errmsg = $ERR_059;\n            }\n        }\n        if (!isset($errmsg)) {\n            $query = \"INSERT INTO \" . $DBPrefix . \"bids (auction, bidder, bid, quantity)\n                      VALUES (:auc_id, :bidder_id, :bid, :qty)\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $params[] = array(':bidder_id', $bidder_id, 'int');\n            $params[] = array(':bid', $bid, 'float');\n            $params[] = array(':qty', $qty, 'int');\n            $db->query($query, $params);\n            $current_bid_id = $db->lastInsertId();\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET bids = (bids + 1)\";\n            $db->direct_query($query);\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET current_bid = :bid, current_bid_id = :current_bid_id, num_bids = num_bids + 1 WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $params[] = array(':current_bid_id', $current_bid_id, 'int');\n            $params[] = array(':bid', $bid, 'float');\n            $db->query($query, $params);\n            extend_auction($item_id, $Data['ends']);\n        }\n    }\n\n    // if there was a previous bidder tell them they have been outbid\n    if (count($last_highest_bid) > 0) {\n        $OldWinner_id = $last_highest_bid['bidder'];\n\n        $query = \"SELECT nick, name, email FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n        $params = array();\n        $params[] = array(':user_id', $OldWinner_id, 'int');\n        $db->query($query, $params);\n        $OldWinner = $db->result();\n\n        $OldWinner_nick = $OldWinner['nick'];\n        $OldWinner_name = $OldWinner['name'];\n        $OldWinner_email = $OldWinner['email'];\n    }\n    // Update counters table with the new bid\n    // Send notification if auction id matches (Item Watch)\n    $query = \"SELECT name, email, item_watch, id FROM \" . $DBPrefix . \"users WHERE item_watch LIKE :auc_id AND id != :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $bidder_id, 'int');\n    $params[] = array(':auc_id', '%' . $id . '%', 'str');\n    $db->query($query, $params);\n\n    $fetch = $db->fetchall();\n    foreach ($fetch as $row) {\n        // double check there is a match\n        $watch_values = explode(' ', $row['item_watch']);\n        if (in_array(strval($id), $watch_values)) {\n            // Get data about the auction\n            $query = \"SELECT title, current_bid FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $id, 'int');\n            $db->query($query, $params);\n            $auction_data = $db->result();\n            $emailer = new email_handler();\n            $emailer->assign_vars(array(\n                    'REALNAME' => $row['name'],\n                    'TITLE' => $auction_data['title'],\n                    'BID' => $system->print_money($bid, false),\n                    'AUCTION_URL' => $system->SETTINGS['siteurl'] . 'item.php?id=' . $id\n                    ));\n            $emailer->email_uid = $row['id'];\n            $emailer->email_sender($row['email'], 'item_watch.inc.php', $system->SETTINGS['sitename'] . ' - ' . $MSG['472']);\n        }\n    }\n    // End of Item watch\n    if ($send_email) {\n        $ends_string = $dt->printDateTz($Data['ends']);\n        $new_bid = $system->print_money($next_bid);\n        // Send e-mail message\n        include INCLUDE_PATH . 'email/outbid.php';\n    }\n\n    if (defined('TrackUserIPs')) {\n        // log auction bid IP\n        $system->log('user', 'Bid $' . $bid . '(previous bid was $' . $current_bid . ') on Item', $bidder_id, $id);\n    }\n    $template->assign_vars(array(\n            'PAGE' => 2,\n            'BID_HISTORY' => (isset($ARETHEREBIDS)) ? $ARETHEREBIDS : '',\n            'TITLE' => $item_title,\n            'ID' => $id,\n            'BID' => $system->print_money($bid),\n            'TQTY' => 0\n            ));\n}\n\nif (!isset($_POST['action']) || isset($errmsg)) {\n    // just set the needed template variables\n    $template->assign_vars(array(\n            'PAGE' => 1,\n            'ERROR' => (isset($errmsg)) ? $errmsg : '',\n            'BID_HISTORY' => (isset($ARETHEREBIDS)) ? $ARETHEREBIDS : '',\n            'ID' => $id,\n            'IMAGE' => (!empty($pict_url_plain)) ? '<img src=\"getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&auction_id=' . $id . '&fromfile=' . $pict_url_plain . '\" border=\"0\" align=\"center\">' : '',\n            'TITLE' => $item_title,\n            'CURRENT_BID' => $system->print_money($cbid),\n            'ATYPE' => $atype,\n            'BID' => $system->print_money_nosymbol($bid),\n            'NEXT_BID' => $system->print_money($next_bid),\n            'QTY' => $qty,\n            'TQTY' => $aquantity,\n            'AGREEMENT' => sprintf($MSG['25_0086'], $system->print_money($qty * $bid)),\n            'CURRENCY' => $system->SETTINGS['currency'],\n\n            'B_USERAUTH' => ($system->SETTINGS['usersauth'] == 'y')\n            ));\n}\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'bid.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\nif (!empty($_GET['user_id'])) {\n    $user_id = intval($_GET['user_id']);\n    // check trying to access valid user id\n    $user->checkUserValid($user_id);\n} elseif ($user->logged_in) {\n    $user_id = $user->user_data['id'];\n} else {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'closed_auctions.php';\n    header('location: user_login.php');\n    exit;\n}\n\n// get number of closed auctions for this user\n$query = \"SELECT count(id) AS auctions FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 1\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('auctions');\n\n// Handle pagination\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == 1 || $_GET['PAGE'] == '') {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\nif ($PAGES < 1) {\n    $PAGES = 1;\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\t\tWHERE user = :user_id\n\t\tAND closed = 1\n\t\tORDER BY ends ASC LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n$auction_data = $db->fetchall();\n\nforeach ($auction_data as $row) {\n    $bid = $row['current_bid'];\n    $starting_price = $row['current_bid'];\n\n    if (strlen($row['pict_url']) > 0) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&auction_id=' . $row['id'] . '&fromfile=' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    // number of bids for this auction\n    $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $row['id'], 'int');\n    $db->query($query, $params);\n    $num_bids = $db->numrows();\n\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n\n    $template->assign_block_vars('auctions', array(\n            'BGCOLOUR' => (!($TOTALAUCTIONS % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $row['id'],\n            'PIC_URL' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'BNIMG' => get_lang_img(($row['bn_only'] == 0) ? 'buy_it_now.gif' : 'bn_only.png'),\n            'BNVALUE' => $row['buy_now'],\n            'BNFORMAT' => $system->print_money($row['buy_now']),\n            'BIDVALUE' => $row['minimum_bid'],\n            'BIDFORMAT' => $system->print_money($row['minimum_bid']),\n            'NUM_BIDS' => $num_bids,\n            'TIMELEFT' => $difference->format('%a') . ' ' . $MSG['126'],\n\n            'B_BUY_NOW' => ($row['buy_now'] > 0 && ($row['bn_only'] || $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price'])))),\n            'B_BNONLY' => ($row['bn_only'])\n            ));\n}\n\nif ($TOTALAUCTIONS == 0) {\n    $template->assign_block_vars('no_auctions', array());\n}\n\n// get this user's nick\n$query = \"SELECT nick FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$TPL_user_nick = $db->result('nick');\n\n$LOW = $PAGE - 5;\nif ($LOW <= 0) {\n    $LOW = 1;\n}\n$COUNTER = $LOW;\n$pagenation = '';\nwhile ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n    if ($PAGE == $COUNTER) {\n        $pagenation .= '<b>' . $COUNTER . '</b>&nbsp;&nbsp;';\n    } else {\n        $pagenation .= '<a href=\"closed_auctions.php?PAGE=' . $COUNTER . '&user_id=' . $user_id . '\"><u>' . $COUNTER . '</u></a>&nbsp;&nbsp;';\n    }\n    $COUNTER++;\n}\n\n$template->assign_vars(array(\n        'B_MULPAG' => ($PAGES > 1),\n        'B_NOTLAST' => ($PAGE < $PAGES),\n        'B_NOTFIRST' => ($PAGE > 1),\n\n        'USER_ID' => $user_id,\n        'USERNAME' => $TPL_user_nick,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'NEXT' => intval($PAGE + 1),\n        'PREV' => intval($PAGE - 1),\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n        'PAGENA' => $pagenation\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'auctions_closed.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright              : (C) 2008 - 2017 WeBid\n *   site                   : http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// get passed values\n$w = (isset($_GET['w'])) ? intval($_GET['w']) : '';\n$fromfile = $_GET['fromfile'];\n$auction_id = $_GET['auction_id'];\n\n// check passed values\nif (!isset($_GET['fromfile']) ||\n\t!isset($_GET['auction_id']) || !is_numeric($auction_id)) {\n    ErrorPNG($ERR_716);\n    exit;\n} elseif (!file_exists($_GET['fromfile']) && !fopen($_GET['fromfile'], 'r')) {\n    ErrorPNG($ERR_716);\n    exit;\n}\n\nif ($fromfile != '') {\n\t// clean fromfile\n\t$fromfile = basename($fromfile);\n\t// build file path\n\t$file_path = UPLOAD_FOLDER . $auction_id . '/' . $fromfile;\n} else {\n\t// if empty filename just show default image\n\t$file_path = MAIN_PATH . 'images/email_alerts/default_item_img.jpg';\n}\n\n$nomanage = false;\n$accepted_widths = array(\n    $system->SETTINGS['thumb_show'],\n    $system->SETTINGS['thumb_list'],\n    430,\n    '' // load default image\n);\n$w = (in_array($w, $accepted_widths)) ? $w : '';\n\nfunction ErrorPNG($err)\n{\n    header('Content-type: image/png');\n    $im = imagecreate(100, 30);\n    $bgc = imagecolorallocate($im, 255, 255, 255);\n    $tc = imagecolorallocate($im, 0, 0, 0);\n    imagefilledrectangle($im, 0, 0, 100, 30, $bgc);\n    imagestring($im, 1, 5, 5, $err, $tc);\n    imagepng($im);\n}\n\nfunction load_image($file, $mime, $image_type, $output_type)\n{\n    header('Content-Type: ' . $mime);\n    $funcall = \"imagecreatefrom$image_type\";\n    $image = $funcall($file);\n    $funcall = \"image$output_type\";\n    $funcall($image);\n    exit;\n}\n\nif (file_exists(UPLOAD_PATH . 'cache/' . $w . '-' . md5($fromfile))) {\n    $img = getimagesize($file_path);\n    switch ($img[2]) {\n        case IMAGETYPE_GIF:\n            if (!(imagetypes() &IMG_GIF)) {\n                if (!function_exists('imagecreatefromgif')) {\n                    $nomanage = true;\n                } else {\n                    $img['mime'] = 'image/png';\n                }\n            } else {\n                $img['mime'] = 'image/gif';\n            }\n            break;\n        case IMAGETYPE_JPEG:\n            if (!(imagetypes() &IMG_JPG)) {\n                $nomanage = true;\n            }\n            $img['mime'] = 'image/jpeg';\n            break;\n        case IMAGETYPE_PNG:\n            if (!(imagetypes() &IMG_PNG)) {\n                $nomanage = true;\n            }\n            $img['mime'] = 'image/png';\n            break;\n        default:\n            $nomanage = true;\n            break;\n    }\n    if ($nomanage) {\n        ErrorPNG($ERR_710);\n        exit;\n    }\n    header('Content-type: ' . $img['mime']);\n    echo file_get_contents(UPLOAD_PATH . 'cache/' . $w . '-' . md5($fromfile));\n} else {\n    if (function_exists('imagetypes')) {\n        if (!is_dir(UPLOAD_PATH . 'cache')) {\n            mkdir(UPLOAD_PATH . 'cache', 0777);\n        }\n\n        $img = @getimagesize($file_path);\n        if (is_array($img)) {\n            switch ($img[2]) {\n                case IMAGETYPE_GIF:\n                    if (!(imagetypes() &IMG_GIF)) {\n                        if (!function_exists('imagecreatefromgif')) {\n                            $nomanage = true;\n                        } else {\n                            $output_type = 'png';\n                            $img['mime'] = 'image/png';\n                        }\n                    } else {\n                        $output_type = 'gif';\n                        $img['mime'] = 'image/gif';\n                    }\n                    $image_type = 'gif';\n                    break;\n                case IMAGETYPE_JPEG:\n                    if (!(imagetypes() &IMG_JPG)) {\n                        $nomanage = true;\n                    }\n                    $output_type = 'jpeg';\n                    $img['mime'] = 'image/jpeg';\n                    $image_type = 'jpeg';\n                    break;\n                case IMAGETYPE_PNG:\n                    if (!(imagetypes() &IMG_PNG)) {\n                        $nomanage = true;\n                    }\n                    $image_type = 'png';\n                    $img['mime'] = 'image/png';\n                    $output_type = 'png';\n                    break;\n                default:\n                    ErrorPNG($ERR_710);\n                    exit;\n            }\n        } else {\n            ErrorPNG($ERR_710);\n            exit;\n        }\n        if ($w == '') {\n            // just load the image\n            load_image($file_path, $img['mime'], $image_type, $output_type);\n        } else {\n            // check image orientation\n            if ($img[0] < $img[1]) {\n                $h = $w;\n                $ratio = floatval($img[1] / $h);\n                $w = ceil($img[0] / $ratio);\n            } else {\n                $ratio = floatval($img[0] / $w);\n                $h = ceil($img[1] / $ratio);\n            }\n        \n            $ou = imagecreatetruecolor($w, $h);\n            imagealphablending($ou, false);\n            $funcall = \"imagecreatefrom$image_type\";\n            imagecopyresampled($ou, $funcall($file_path), 0, 0, 0, 0, $w, $h, $img[0], $img[1]);\n            $funcall = \"image$output_type\";\n            $funcall($ou, UPLOAD_PATH . 'cache/' . $w . '-' . md5($fromfile));\n            header('Content-type: ' . $img['mime']);\n            $funcall($ou);\n            exit;\n        }\n    } else {\n        ErrorPNG($ERR_710);\n        exit;\n    }\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\nif (!defined('InWeBid')) {\n    exit();\n}\n\nfunction browseItems($query, $params, $query_feat, $params_feat, $total, $current_page, $extravar = '')\n{\n    global $system, $MSG, $ERR_114, $db, $dt;\n    global $template, $PAGES, $PAGE;\n\n    $feat_items = false;\n    if ($query_feat != '') {\n        $db->query($query_feat, $params_feat);\n        $k = 0;\n        while ($row = $db->fetch()) {\n            // get the data we need\n            $row = build_items($row);\n\n            // time left till the end of this auction\n            $current_time = new DateTime('now', $dt->UTCtimezone);\n            $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n            $difference = $current_time->diff($end_time);\n\n            $template->assign_block_vars('featured_items', array(\n                'ID' => $row['id'],\n                'IMAGE' => $row['pict_url'],\n                'TITLE' => htmlspecialchars($row['title']),\n                'SUBTITLE' => htmlspecialchars($row['subtitle']),\n                'BUY_NOW' => ($difference->invert == 1) ? '' : $row['buy_now'],\n                'BID' => $row['current_bid'],\n                'BIDFORM' => $system->print_money($row['current_bid']),\n                'CLOSES' => ($difference->format('%d') < 20) ? $dt->formatTimeLeft($difference) : $dt->printDateTz($row['ends']),\n                'NUMBIDS' => sprintf($MSG['950'], $row['num_bids']),\n\n                'B_BOLD' => ($row['bold']),\n                'B_HIGHLIGHTED' => ($row['highlighted'])\n            ));\n            $k++;\n            $feat_items = true;\n        }\n    }\n\n    $db->query($query, $params);\n    $k = 0;\n    while ($row = $db->fetch()) {\n        // get the data we need\n        $row = build_items($row);\n\n        // time left till the end of this auction\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n\n        $template->assign_block_vars('items', array(\n            'ID' => $row['id'],\n            'IMAGE' => $row['pict_url'],\n            'TITLE' => htmlspecialchars($row['title']),\n            'SUBTITLE' => htmlspecialchars($row['subtitle']),\n            'BUY_NOW' => ($difference->invert == 1) ? '' : $row['buy_now'],\n            'BID' => $row['current_bid'],\n            'BIDFORM' => $system->print_money($row['current_bid']),\n            'CLOSES' => ($difference->format('%d') < 20) ? $dt->formatTimeLeft($difference) : $dt->printDateTz($row['ends']),\n            'NUMBIDS' => sprintf($MSG['950'], $row['num_bids']),\n\n            'B_BOLD' => ($row['bold']),\n            'B_HIGHLIGHTED' => ($row['highlighted'])\n        ));\n        $k++;\n    }\n\n    $extravar = (empty($extravar)) ? '' : '&' . $extravar;\n    $PREV = intval($PAGE - 1);\n    $NEXT = intval($PAGE + 1);\n    if ($PAGES > 1) {\n        $LOW = $PAGE - 5;\n        if ($LOW <= 0) {\n            $LOW = 1;\n        }\n        $COUNTER = $LOW;\n        while ($COUNTER <= $PAGES && $COUNTER < ($PAGE+6)) {\n            $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $COUNTER . $extravar . '\"><u>' . $COUNTER . '</u></a>'\n            ));\n            $COUNTER++;\n        }\n    }\n\n    $template->assign_vars(array(\n        'B_FEATURED_ITEMS' => $feat_items,\n        'B_SUBTITLE' => ($system->SETTINGS['subtitle'] == 'y'),\n\n        'NUM_AUCTIONS' => ($total == 0) ? $ERR_114 : $total,\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $PREV . $extravar . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . $current_page . '?PAGE=' . $NEXT . $extravar . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES\n    ));\n}\n\nfunction build_items($row)\n{\n    global $system;\n\n    // image icon\n    if (!empty($row['pict_url'])) {\n        $row['pict_url'] = $system->SETTINGS['siteurl'] . 'getthumb.php?w=' . $system->SETTINGS['thumb_list'] . '&auction_id=' . $row['id'] . '&fromfile=' . $row['pict_url'];\n    } else {\n        $row['pict_url'] = get_lang_img('nopicture.gif');\n    }\n\n    if ($row['current_bid'] == 0) {\n        $row['current_bid'] = $row['minimum_bid'];\n    }\n\n    if ($row['buy_now'] > 0 && $row['bn_only'] == 0 && ($row['num_bids'] == 0 || ($row['reserve_price'] > 0 && $row['current_bid'] < $row['reserve_price']))) {\n        $row['buy_now'] = '<a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $row['id'] . '\"><img src=\"' . get_lang_img('buy_it_now.gif') . '\" border=0 class=\"buynow\"></a>' . $system->print_money($row['buy_now']);\n    } elseif ($row['buy_now'] > 0 && $row['bn_only']) {\n        $row['current_bid'] = $row['buy_now'];\n        $row['buy_now'] = '<a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $row['id'] . '\"><img src=\"' . get_lang_img('buy_it_now.gif') . '\" border=0 class=\"buynow\"></a>' . $system->print_money($row['buy_now']) . ' <img src=\"' . get_lang_img('bn_only.png') . '\" border=\"0\" class=\"buynow\">';\n    } else {\n        $row['buy_now'] = '';\n    }\n\n    return $row;\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\nif (!defined('InWeBid')) {\n    exit();\n}\n\nfunction generate_id()\n{\n    global $_SESSION;\n    if (!isset($_SESSION['SELL_auction_id'])) {\n        $auction_id = md5(uniqid(rand()));\n        $_SESSION['SELL_auction_id'] = $auction_id;\n    } else {\n        $auction_id = $_SESSION['SELL_auction_id'];\n    }\n    return $auction_id;\n}\n\nfunction setvars()\n{\n    global $with_reserve, $reserve_price, $minimum_bid, $pict_url, $imgtype, $title, $subtitle, $sdescription, $atype, $iquantity, $buy_now, $buy_now_price, $is_taxed, $tax_included, $additional_shipping_cost;\n    global $duration, $relist, $increments, $customincrement, $shipping, $shipping_terms, $payment, $international, $sellcat1, $sellcat2, $buy_now_only, $a_starts, $shipping_cost, $is_bold, $is_highlighted, $is_featured, $start_now;\n    global $_POST, $_SESSION, $system, $custom_end, $a_ends, $custom_end, $caneditstartdate, $dt;\n\n    $with_reserve = (isset($_POST['with_reserve'])) ? $_POST['with_reserve'] : $_SESSION['SELL_with_reserve'];\n    $reserve_price = (isset($_POST['reserve_price'])) ? $_POST['reserve_price'] : $_SESSION['SELL_reserve_price'];\n    $minimum_bid = (isset($_POST['minimum_bid'])) ? $_POST['minimum_bid'] : $_SESSION['SELL_minimum_bid'];\n    $default_minbid = ($system->SETTINGS['moneyformat'] == 1) ? 0.99 : '0,99';\n    $minimum_bid = (empty($minimum_bid)) ? $default_minbid : $minimum_bid;\n    $shipping_cost = (isset($_POST['shipping_cost'])) ? $_POST['shipping_cost'] : $_SESSION['SELL_shipping_cost'];\n    $shipping_cost = (empty($shipping_cost)) ? 0 : $shipping_cost;\n    $additional_shipping_cost = (isset($_POST['additional_shipping_cost'])) ? $_POST['additional_shipping_cost'] : $_SESSION['SELL_additional_shipping_cost'];\n    $additional_shipping_cost = (empty($additional_shipping_cost)) ? 0 : $additional_shipping_cost;\n    $imgtype = (isset($_POST['imgtype'])) ? $_POST['imgtype'] : $_SESSION['SELL_file_uploaded'];\n    $title = (isset($_POST['title'])) ? $system->cleanvars($_POST['title']) : $_SESSION['SELL_title'];\n    $subtitle = (isset($_POST['subtitle'])) ? $system->cleanvars($_POST['subtitle']) : $_SESSION['SELL_subtitle'];\n    $sdescription = (isset($_POST['sdescription'])) ? $system->cleanvars($_POST['sdescription'], true) : $_SESSION['SELL_description'];\n    $pict_url = (isset($_POST['pict_url'])) ? $_POST['pict_url'] : $_SESSION['SELL_pict_url'];\n    $atype = (isset($_POST['atype'])) ? $_POST['atype'] : $_SESSION['SELL_atype'];\n    $iquantity = (int)(isset($_POST['iquantity'])) ? $_POST['iquantity'] : $_SESSION['SELL_iquantity'];\n    $iquantity = (empty($iquantity)) ? 1 : round($iquantity);\n    $buy_now = (isset($_POST['buy_now'])) ? $_POST['buy_now'] : $_SESSION['SELL_with_buy_now'];\n    $buy_now_price = (isset($_POST['buy_now_price'])) ? $_POST['buy_now_price'] : $_SESSION['SELL_buy_now_price'];\n    $relist = (isset($_POST['autorelist'])) ? $_POST['autorelist'] : $_SESSION['SELL_relist'];\n    $increments = (isset($_POST['increments'])) ? $_POST['increments'] : $_SESSION['SELL_increments'];\n    $customincrement = (isset($_POST['customincrement'])) ? $_POST['customincrement'] : $_SESSION['SELL_customincrement'];\n    $shipping = (isset($_POST['shipping'])) ? $_POST['shipping'] : $_SESSION['SELL_shipping'];\n    $shipping_terms = (isset($_POST['shipping_terms'])) ? $system->cleanvars($_POST['shipping_terms']) : $_SESSION['SELL_shipping_terms'];\n    $payment = (isset($_POST['payment'])) ? $_POST['payment'] : $_SESSION['SELL_payment'];\n    $payment = (is_array($payment)) ? $payment : array();\n    $sellcat1 = $_SESSION['SELL_sellcat1'];\n    $_SESSION['SELL_sellcat2'] = (isset($_SESSION['SELL_sellcat2'])) ? $_SESSION['SELL_sellcat2'] : 0;\n    $sellcat2 = $_SESSION['SELL_sellcat2'];\n    $caneditstartdate = $_SESSION['SELL_caneditstartdate'];\n    $buy_now_only = (isset($_POST['buy_now_only'])) ? $_POST['buy_now_only'] : $_SESSION['SELL_buy_now_only'];\n    $buy_now_only = (empty($buy_now_only)) ? 0 : $buy_now_only;\n\n    $a_starts = (isset($_POST['a_starts'])) ? $dt->convertToDatetime($_POST['a_starts']) : $_SESSION['SELL_starts'];\n    $duration = (isset($_POST['duration'])) ? $_POST['duration'] : $_SESSION['SELL_duration'];\n    $a_ends = (isset($_POST['a_ends'])) ? $dt->convertToDatetime($_POST['a_ends']) : $_SESSION['SELL_ends'];\n\n    // deal with checkboxes\n    if (isset($_POST['action']) && $_POST['action'] == 3) {\n        $is_bold = (isset($_POST['is_bold'])) ? 1 : 0;\n        $is_featured = (isset($_POST['is_featured'])) ? 1 : 0;\n        $is_highlighted = (isset($_POST['is_highlighted'])) ? 1 : 0;\n        $international = (isset($_POST['international'])) ? 1 : 0;\n        $start_now = (isset($_POST['start_now'])) ? 1 : 0;\n        $custom_end = (isset($_POST['custom_end'])) ? 1 : 0;\n        // ignore duration for custom end date\n        $duration = ($custom_end == 1) ? 0 : $duration;\n    } else {\n        $is_bold = $_SESSION['SELL_is_bold'];\n        $is_featured = $_SESSION['SELL_is_featured'];\n        $is_highlighted = $_SESSION['SELL_is_highlighted'];\n        $international = $_SESSION['SELL_international'];\n        $start_now = $_SESSION['SELL_start_now'];\n        $custom_end = $_SESSION['SELL_custom_end'];\n    }\n\n    $is_taxed = (isset($_POST['is_taxed'])) ? $_POST['is_taxed'] : $_SESSION['SELL_is_taxed'];\n    $tax_included = (isset($_POST['tax_included'])) ? $_POST['tax_included'] : $_SESSION['SELL_tax_included'];\n    if (isset($_POST['action']) && $_POST['action'] == 2) {\n        $is_bold = (isset($_POST['is_bold'])) ? 1 : 0;\n        $is_featured = (isset($_POST['is_featured'])) ? 1 : 0;\n        $is_highlighted = (isset($_POST['is_highlighted'])) ? 1 : 0;\n        $is_taxed = (isset($_POST['is_taxed'])) ? 1 : 0;\n        $tax_included = (isset($_POST['tax_included'])) ? 1 : 0;\n        $payment = (isset($_POST['payment'])) ? $payment : array();\n    }\n}\n\nfunction makesessions()\n{\n    global $with_reserve, $reserve_price, $minimum_bid, $pict_url, $imgtype, $title, $subtitle, $sdescription, $pict_url, $atype, $iquantity, $buy_now, $buy_now_price, $is_taxed, $tax_included, $additional_shipping_cost;\n    global $duration, $relist, $increments, $customincrement, $shipping, $shipping_terms, $payment, $international, $sendemail, $buy_now_only, $a_starts, $shipping_cost, $is_bold, $is_highlighted, $is_featured, $start_now, $_SESSION;\n    global $a_ends, $custom_end, $caneditstartdate;\n\n    $_SESSION['SELL_with_reserve'] = $with_reserve;\n    $_SESSION['SELL_reserve_price'] = $reserve_price;\n    $_SESSION['SELL_minimum_bid'] = $minimum_bid;\n    $_SESSION['SELL_shipping_cost'] = $shipping_cost;\n    $_SESSION['SELL_additional_shipping_cost'] = $additional_shipping_cost;\n    $_SESSION['SELL_file_uploaded'] = $imgtype;\n    $_SESSION['SELL_title'] = $title;\n    $_SESSION['SELL_subtitle'] = $subtitle;\n    $_SESSION['SELL_description'] = $sdescription;\n    $_SESSION['SELL_pict_url'] = $pict_url;\n    $_SESSION['SELL_atype'] = $atype;\n    $_SESSION['SELL_iquantity'] = $iquantity;\n    $_SESSION['SELL_with_buy_now'] = $buy_now;\n    $_SESSION['SELL_buy_now_price'] = $buy_now_price;\n    $_SESSION['SELL_duration'] = $duration;\n    $_SESSION['SELL_relist'] = $relist;\n    $_SESSION['SELL_increments'] = $increments;\n    $_SESSION['SELL_customincrement'] = $customincrement;\n    $_SESSION['SELL_shipping'] = $shipping;\n    $_SESSION['SELL_shipping_terms'] = $shipping_terms;\n    $_SESSION['SELL_payment'] = $payment;\n    $_SESSION['SELL_international'] = $international;\n    $_SESSION['SELL_buy_now_only'] = $buy_now_only;\n    $_SESSION['SELL_starts'] = $a_starts;\n    $_SESSION['SELL_ends'] = $a_ends;\n    $_SESSION['SELL_custom_end'] = $custom_end;\n    $_SESSION['SELL_is_bold'] = $is_bold;\n    $_SESSION['SELL_is_highlighted'] = $is_highlighted;\n    $_SESSION['SELL_is_featured'] = $is_featured;\n    $_SESSION['SELL_start_now'] = $start_now;\n    $_SESSION['SELL_is_taxed'] = $is_taxed;\n    $_SESSION['SELL_tax_included'] = $tax_included;\n    $_SESSION['SELL_caneditstartdate'] = $caneditstartdate;\n}\n\nfunction unsetsessions()\n{\n    global $_SESSION, $system;\n\n    $_SESSION['SELL_with_reserve'] = '';\n    $_SESSION['SELL_reserve_price'] = '';\n    $_SESSION['SELL_minimum_bid'] = ($system->SETTINGS['moneyformat'] == 1) ? 0.99 : '0,99';\n    $_SESSION['SELL_shipping_cost'] = 0;\n    $_SESSION['SELL_additional_shipping_cost'] = 0;\n    $_SESSION['SELL_file_uploaded'] = false;\n    $_SESSION['SELL_title'] = '';\n    $_SESSION['SELL_subtitle'] = '';\n    $_SESSION['SELL_description'] = '';\n    $_SESSION['SELL_pict_url'] = '';\n    $_SESSION['SELL_pict_url_temp'] = '';\n    $_SESSION['SELL_atype'] = '';\n    $_SESSION['SELL_iquantity'] = '';\n    $_SESSION['SELL_with_buy_now'] = '';\n    $_SESSION['SELL_buy_now_price'] = '';\n    $_SESSION['SELL_duration'] = '';\n    $_SESSION['SELL_relist'] = '';\n    $_SESSION['SELL_increments'] = '';\n    $_SESSION['SELL_customincrement'] = 0;\n    $_SESSION['SELL_shipping'] = 1;\n    $_SESSION['SELL_shipping_terms'] = '';\n    $_SESSION['SELL_payment'] = array();\n    $_SESSION['SELL_international'] = false;\n    $_SESSION['SELL_sendemail'] = '';\n    $_SESSION['SELL_starts'] = '';\n    $_SESSION['SELL_ends'] = '';\n    $_SESSION['SELL_custom_end'] = 0;\n    $_SESSION['SELL_action'] = '';\n    $_SESSION['SELL_is_bold'] = 0;\n    $_SESSION['SELL_is_highlighted'] = 0;\n    $_SESSION['SELL_is_featured'] = 0;\n    $_SESSION['SELL_start_now'] = '';\n    $_SESSION['SELL_is_taxed'] = 0;\n    $_SESSION['SELL_tax_included'] = 0;\n    $_SESSION['SELL_caneditstartdate'] = true;\n}\n\nfunction updateauction()\n{\n    global $_SESSION, $DBPrefix, $dt, $a_starts, $a_ends, $payment_text, $system, $fee, $db, $caneditstartdate;\n\n    $query =\n        \"UPDATE \" . $DBPrefix . \"auctions SET\n\t\ttitle = :title,\n\t\tsubtitle = :subtitle,\n\t\tdescription = :description,\n\t\tpict_url = :pict_url,\n\t\tcategory = :catone,\n\t\tsecondcat = :cattwo,\n\t\tminimum_bid = :min_bid,\n\t\tshipping_cost = :shipping_cost,\n\t\tadditional_shipping_cost = :additional_shipping_cost,\n\t\treserve_price = :reserve_price,\n\t\tbuy_now = :buy_now,\n\t\tbn_only = :bn_only,\n\t\tauction_type = :auction_type,\n\t\tduration = :duration,\n\t\tincrement = :increment,\n\t\tshipping = :shipping,\n\t\tpayment = :payment,\n\t\tinternational = :international,\n\t\tends = :ends,\n\t\tphoto_uploaded = :photo_uploaded,\n\t\tinitial_quantity = :initial_quantity,\n\t\tquantity = :quantity,\n\t\trelist = :relist,\n\t\tshipping_terms = :shipping_terms,\n\t\tclosed = 0,\n\t\tbold = :bold,\n\t\thighlighted = :highlighted,\n\t\tfeatured = :featured,\n\t\ttax = :tax,\n\t\ttaxinc = :taxinc,\n\t\tcurrent_fee = current_fee + :fee\";\n    $params = array();\n    $params[] = array(':title', $_SESSION['SELL_title'], 'str');\n    $params[] = array(':subtitle', $_SESSION['SELL_subtitle'], 'str');\n    $params[] = array(':description', $_SESSION['SELL_description'], 'str');\n    $params[] = array(':pict_url', $_SESSION['SELL_pict_url'], 'str');\n    $params[] = array(':catone', $_SESSION['SELL_sellcat1'], 'int');\n    $params[] = array(':cattwo', $_SESSION['SELL_sellcat2'], 'int');\n    $params[] = array(':min_bid', $system->input_money(($_SESSION['SELL_buy_now_only'] == 0) ? $_SESSION['SELL_minimum_bid'] : $_SESSION['SELL_buy_now_price']), 'float');\n    $params[] = array(':shipping_cost', $system->input_money($_SESSION['SELL_shipping_cost']), 'float');\n    $params[] = array(':additional_shipping_cost', $system->input_money($_SESSION['SELL_additional_shipping_cost']), 'float');\n    $params[] = array(':reserve_price', $system->input_money(($_SESSION['SELL_with_reserve'] == 'yes') ? $_SESSION['SELL_reserve_price'] : 0), 'float');\n    $params[] = array(':buy_now', $system->input_money(($_SESSION['SELL_with_buy_now'] == 'yes') ? $_SESSION['SELL_buy_now_price'] : 0), 'float');\n    $params[] = array(':bn_only', $_SESSION['SELL_buy_now_only'], 'bool');\n    $params[] = array(':auction_type', $_SESSION['SELL_atype'], 'int');\n    $params[] = array(':duration', $_SESSION['SELL_duration'], 'int');\n    $params[] = array(':increment', $system->input_money($_SESSION['SELL_customincrement']), 'float');\n    $params[] = array(':shipping', $_SESSION['SELL_shipping'], 'int');\n    $params[] = array(':payment', $payment_text, 'str');\n    $params[] = array(':international', $_SESSION['SELL_international'], 'bool');\n    $params[] = array(':ends', $dt->convertToUTC($a_ends), 'str');\n    $params[] = array(':photo_uploaded', $_SESSION['SELL_file_uploaded'], 'bool');\n    $params[] = array(':initial_quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':relist', $_SESSION['SELL_relist'], 'int');\n    $params[] = array(':shipping_terms', $_SESSION['SELL_shipping_terms'], 'str');\n    $params[] = array(':bold', $_SESSION['SELL_is_bold'], 'bool');\n    $params[] = array(':highlighted', $_SESSION['SELL_is_highlighted'], 'bool');\n    $params[] = array(':featured', $_SESSION['SELL_is_featured'], 'bool');\n    $params[] = array(':tax', $_SESSION['SELL_is_taxed'], 'bool');\n    $params[] = array(':taxinc', $_SESSION['SELL_tax_included'], 'bool');\n    $params[] = array(':fee', $fee, 'float');\n    $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n    if ($caneditstartdate) {\n        $query .= \", starts = :starts\";\n        $params[] = array(':starts', $dt->convertToUTC($a_starts), 'str');\n    }\n    $query .= ' WHERE id = :auction_id';\n    $db->query($query, $params);\n}\n\nfunction addauction()\n{\n    global $DBPrefix, $_SESSION, $user, $a_starts, $a_ends, $payment_text, $system, $fee, $db, $dt;\n\n    $query = \"INSERT INTO \" . $DBPrefix . \"auctions (user,title,subtitle,starts,description,pict_url,category,secondcat,minimum_bid,shipping_cost,additional_shipping_cost,reserve_price,buy_now,auction_type,duration,increment,shipping,payment,international,ends,photo_uploaded,initial_quantity,quantity,relist,shipping_terms,bn_only,bold,highlighted,featured,current_fee,tax,taxinc) VALUES\n\t(:user_id, :title, :subtitle, :starts, :description, :pict_url, :catone, :cattwo, :min_bid, :shipping_cost, :additional_shipping_cost, :reserve_price, :buy_now, :auction_type, :duration, :increment, :shipping, :payment, :international, :ends, :photo_uploaded, :initial_quantity, :quantity, :relist, :shipping_terms, :bn_only, :bold, :highlighted, :featured, :fee, :tax, :taxinc)\";\n\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $params[] = array(':title', $_SESSION['SELL_title'], 'str');\n    $params[] = array(':subtitle', $_SESSION['SELL_subtitle'], 'str');\n    $params[] = array(':starts', $dt->convertToUTC($a_starts), 'str');\n    $params[] = array(':description', $_SESSION['SELL_description'], 'str');\n    $params[] = array(':pict_url', $_SESSION['SELL_pict_url'], 'str');\n    $params[] = array(':catone', $_SESSION['SELL_sellcat1'], 'int');\n    $params[] = array(':cattwo', $_SESSION['SELL_sellcat2'], 'int');\n    $params[] = array(':min_bid', $system->input_money(($_SESSION['SELL_buy_now_only'] == 0) ? $_SESSION['SELL_minimum_bid'] : $_SESSION['SELL_buy_now_price']), 'float');\n    $params[] = array(':shipping_cost', $system->input_money($_SESSION['SELL_shipping_cost']), 'float');\n    $params[] = array(':additional_shipping_cost', $system->input_money($_SESSION['SELL_additional_shipping_cost']), 'float');\n    $params[] = array(':reserve_price', $system->input_money(($_SESSION['SELL_with_reserve'] == 'yes') ? $_SESSION['SELL_reserve_price'] : 0), 'float');\n    $params[] = array(':buy_now', $system->input_money(($_SESSION['SELL_with_buy_now'] == 'yes') ? $_SESSION['SELL_buy_now_price'] : 0), 'float');\n    $params[] = array(':auction_type', $_SESSION['SELL_atype'], 'int');\n    $params[] = array(':duration', $_SESSION['SELL_duration'], 'int');\n    $params[] = array(':increment', $system->input_money($_SESSION['SELL_customincrement']), 'float');\n    $params[] = array(':shipping', $_SESSION['SELL_shipping'], 'int');\n    $params[] = array(':payment', $payment_text, 'str');\n    $params[] = array(':international', $_SESSION['SELL_international'], 'bool');\n    $params[] = array(':ends', $dt->convertToUTC($a_ends), 'str');\n    $params[] = array(':photo_uploaded', $_SESSION['SELL_file_uploaded'], 'bool');\n    $params[] = array(':initial_quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':quantity', $_SESSION['SELL_iquantity'], 'int');\n    $params[] = array(':relist', $_SESSION['SELL_relist'], 'int');\n    $params[] = array(':shipping_terms', $_SESSION['SELL_shipping_terms'], 'str');\n    $params[] = array(':bn_only', $_SESSION['SELL_buy_now_only'], 'bool');\n    $params[] = array(':bold', $_SESSION['SELL_is_bold'], 'bool');\n    $params[] = array(':highlighted', $_SESSION['SELL_is_highlighted'], 'bool');\n    $params[] = array(':featured', $_SESSION['SELL_is_featured'], 'bool');\n    $params[] = array(':fee', $fee, 'float');\n    $params[] = array(':tax', $_SESSION['SELL_is_taxed'], 'bool');\n    $params[] = array(':taxinc', $_SESSION['SELL_tax_included'], 'bool');\n    $db->query($query, $params);\n}\n\nfunction addoutstanding()\n{\n    global $DBPrefix, $fee_data, $user, $system, $fee, $_SESSION, $db;\n\n    $fee_data['total'] = $fee;\n\n    if ($_SESSION['SELL_action'] == 'edit') {\n        // set defaults\n        $fee_colomns = array(\n            'setup',\n            'featured',\n            'bold',\n            'highlighted',\n            'subtitle',\n            'relist',\n            'reserve',\n            'buynow',\n            'picture',\n            'extracat',\n            'total'\n        );\n\n        $query = \"SELECT * FROM \" . $DBPrefix . \"useraccounts WHERE auc_id = :auction_id AND user_id = :user_id\";\n        $params = array();\n        $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n        $params[] = array(':user_id', $user->user_data['id'], 'int');\n        $db->query($query, $params);\n        // build an array full of everything the user has been charged for the auction do far\n        while ($past_fee_data = $db->fetch()) {\n            foreach ($fee_colomns as $fee) {\n                $fee_string = ($fee == 'total') ? '' : '_fee';\n                $fee_data[$fee .  $fee_string] = bcsub($fee_data[$fee .  $fee_string],\n                    $past_fee_data[$fee], $system->SETTINGS['moneydecimals']);\n                if ($fee_data[$fee .  $fee_string] < 0) {\n                    $fee_data[$fee .  $fee_string] = 0;\n                }\n            }\n        }\n\n    }\n\n    $query = \"INSERT INTO \" . $DBPrefix . \"useraccounts (auc_id,user_id,setup,featured,bold,highlighted,subtitle,relist,reserve,buynow,picture,extracat,total,paid) VALUES\n\t(:auction_id, :user_id, :setup_fee, :featured_fee, :bold_fee, :highlighted_fee, :subtitle_fee, :relist_fee, :reserve_fee, :buynow_fee, :picture_fee, :extracat_fee, :fee, 0)\";\n\n    $params[] = array(':auction_id', $_SESSION['SELL_auction_id'], 'int');\n    $params[] = array(':setup_fee', $fee_data['setup_fee'], 'float');\n    $params[] = array(':featured_fee', $fee_data['featured_fee'], 'float');\n    $params[] = array(':bold_fee', $fee_data['bold_fee'], 'float');\n    $params[] = array(':highlighted_fee', $fee_data['highlighted_fee'], 'float');\n    $params[] = array(':subtitle_fee', $fee_data['subtitle_fee'], 'float');\n    $params[] = array(':relist_fee', $fee_data['relist_fee'], 'float');\n    $params[] = array(':reserve_fee', $fee_data['reserve_fee'], 'float');\n    $params[] = array(':buynow_fee', $fee_data['buynow_fee'], 'float');\n    $params[] = array(':picture_fee', $fee_data['picture_fee'], 'float');\n    $params[] = array(':extracat_fee', $fee_data['extracat_fee'], 'float');\n    $params[] = array(':fee', $fee_data['total'], 'float');\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n\n    // reset fee value\n    $fee = $fee_data['total'];\n}\n\nfunction remove_bids($auction_id)\n{\n    global $DBPrefix, $db;\n    $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auction_id\";\n    $params = array();\n    $params[] = array(':auction_id', $auction_id, 'int');\n    $db->query($query, $params);\n}\n\nfunction get_fee($minimum_bid, $just_fee = true)\n{\n    global $system, $DBPrefix, $buy_now_price, $reserve_price, $is_bold, $is_highlighted, $is_featured, $_SESSION, $subtitle, $sellcat2, $relist, $db;\n\n    $query = \"SELECT * FROM \" . $DBPrefix . \"fees ORDER BY type, fee_from ASC\";\n    $db->direct_query($query);\n\n    $fee_value = 0;\n    // set defaults\n    $fee_data = array(\n        'setup_fee' => 0,\n        'featured_fee' => 0,\n        'bold_fee' => 0,\n        'highlighted_fee' => 0,\n        'subtitle_fee' => 0,\n        'relist_fee' => 0,\n        'reserve_fee' => 0,\n        'buynow_fee' => 0,\n        'picture_fee' => 0,\n        'extracat_fee' => 0\n    );\n    while ($row = $db->fetch()) {\n        if ($minimum_bid >= $row['fee_from'] && $minimum_bid <= $row['fee_to'] && $row['type'] == 'setup_fee') {\n            if ($row['fee_type'] == 'flat') {\n                $fee_data['setup_fee'] = $row['value'];\n                $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n            } else {\n                $tmp = bcdiv($row['value'], '100', $system->SETTINGS['moneydecimals']);\n                $tmp = bcmul($tmp, $minimum_bid, $system->SETTINGS['moneydecimals']);\n                $fee_data['setup_fee'] = $tmp;\n                $fee_value = bcadd($fee_value, $tmp, $system->SETTINGS['moneydecimals']);\n            }\n        }\n        if ($row['type'] == 'buynow_fee' && $buy_now_price > 0) {\n            $fee_data['buynow_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'reserve_fee' && $reserve_price > 0) {\n            $fee_data['reserve_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'bold_fee' && $is_bold) {\n            $fee_data['bold_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'highlighted_fee' && $is_highlighted) {\n            $fee_data['highlighted_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'featured_fee' && $is_featured) {\n            $fee_data['featured_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'picture_fee' && count($_SESSION['UPLOADED_PICTURES']) > 0) {\n            $tmp = bcmul(count($_SESSION['UPLOADED_PICTURES']), $row['value'], $system->SETTINGS['moneydecimals']);\n            $fee_data['picture_fee'] = $tmp;\n            $fee_value = bcadd($fee_value, $tmp, $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'subtitle_fee' && !empty($subtitle)) {\n            $fee_data['subtitle_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'extracat_fee' && $sellcat2 > 0) {\n            $fee_data['extracat_fee'] = $row['value'];\n            $fee_value = bcadd($fee_value, $row['value'], $system->SETTINGS['moneydecimals']);\n        }\n        if ($row['type'] == 'relist_fee' && $relist > 0) {\n            $fee_data['relist_fee'] = ($row['value'] * $relist);\n            $fee_value = bcadd($fee_value, ($row['value'] * $relist), $system->SETTINGS['moneydecimals']);\n        }\n    }\n\n    if ($just_fee) {\n        $return = $fee_value;\n    } else {\n        $return = array($fee_value, $fee_data);\n    }\n\n    return $return;\n}\n\nfunction update_cat_counters($add, $category, $second_category = 0)\n{\n    global $_SESSION, $DBPrefix, $system, $catscontrol, $db;\n\n    $addsub = ($add) ? '+' : '-';\n    // change category counter\n    $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $category, 'int');\n    $db->query($query, $params);\n    // get the category crumbs\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $category, 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n    $category_crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n    if ($second_category > 0) {\n        // change secondary category counter\n        $query = \"UPDATE \" . $DBPrefix . \"categories SET counter = counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $second_category, 'int');\n        $db->query($query, $params);\n        // get the second category crumbs\n        $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $second_category, 'int');\n        $db->query($query, $params);\n        $parent_node = $db->result();\n        $second_category_crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n\n        // merge the arrays\n        $crumbs = $category_crumbs + $second_category_crumbs;\n    } else {\n        $crumbs = $category_crumbs;\n    }\n\n    for ($i = 0; $i < count($crumbs); $i++) {\n        $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter \" . $addsub . \" 1 WHERE cat_id = :cat_id\";\n        $params = array();\n        $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n        $db->query($query, $params);\n    }\n}\n\nfunction get_category_string($sellcat)\n{\n    global $DBPrefix, $system, $catscontrol, $category_names, $db;\n\n    if (empty($sellcat) || !isset($sellcat)) {\n        return '';\n    }\n\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n    $params = array();\n    $params[] = array(':cat_id', $sellcat, 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n\n    $TPL_categories_list = '';\n    $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n    for ($i = 0; $i < count($crumbs); $i++) {\n        if ($crumbs[$i]['cat_id'] > 0) {\n            if ($i > 0) {\n                $TPL_categories_list .= ' &gt; ';\n            }\n            $TPL_categories_list .= $category_names[$crumbs[$i]['cat_id']];\n        }\n    }\n    return $TPL_categories_list;\n}\n\n// TODO: this should be used when a user lists an item and selects gateways\nfunction check_gateway($gateway)\n{\n    global $user, $db;\n    $query = \"SELECT COUNT(id) As COUNT FROM \" . $DBPrefix . \"usergateways\n\t\t\tWHERE user_id = :user_id\n\t\t\tAND gateway_id = (SELECT id FROM \" . $DBPrefix . \"payment_options WHERE is_gateway = 1 && name = :gateway_name)\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $params[] = array(':gateway_name', $gateway, 'str');\n    $db->query($query, $params);\n    if ($db->result('COUNT') > 0) {\n        return true;\n    }\n    return false;\n}\n\nfunction alert_auction_watchers($id, $title, $description)\n{\n    global $user, $DBPrefix, $db;\n\n    // Send notification if users keyword matches (Auction Watch)\n    $query = \"SELECT auc_watch, email, nick, name, id FROM \" . $DBPrefix . \"users WHERE auc_watch != '' AND id != :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    $sent_to = array();\n    while ($row = $db->fetch()) {\n        $w_title = explode(' ', strtolower($title));\n        $w_descr = explode(' ', strtolower(str_replace(array('<br>', \"\\n\"), '', strip_tags($description))));\n        $w_nick = strtolower($user->user_data['nick']);\n        $key = explode(' ', $row['auc_watch']);\n        if (is_array($key) && count($key) > 0) {\n            foreach ($key as $k => $v) {\n                $v = trim(strtolower($v));\n                if ((in_array($v, $w_title) || in_array($v, $w_descr) || $v == $w_nick) && !in_array($row['id'], $sent_to)) {\n                    $emailer = new email_handler();\n                    $emailer->assign_vars(array(\n                            'URL' => $system->SETTINGS['siteurl'] . 'item.php?id=' . $id,\n                            'SITENAME' =>  $system->SETTINGS['sitename'],\n                            'TITLE' => $title,\n                            'REALNAME' => $row['name'],\n                            'KWORD' => $row['auc_watch']\n                            ));\n                    $emailer->email_uid = $row['id'];\n                    $emailer->email_sender($row['email'], 'auction_watchmail.inc.php', $system->SETTINGS['sitename'] . '  ' . $MSG['471']);\n                    $sent_to[] = $row['id'];\n                }\n            }\n        }\n    }\n}\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\n\n// Run cron according to SETTINGS\nif ($system->SETTINGS['cron'] == 2) {\n    include_once 'cron.php';\n}\n\nfunction ShowFlags()\n{\n    global $system, $LANGUAGES;\n    $counter = 0;\n    $flags = '';\n    foreach ($LANGUAGES as $lang => $value) {\n        if ($counter > 3) {\n            $flags .= '<br>';\n            $counter = 0;\n        }\n        $flags .= '<a href=\"?lan=' . $lang . '\"><img vspace=\"2\" hspace=\"2\" src=\"' . $system->SETTINGS['siteurl'] . 'images/flags/' . $lang . '.gif\" border=\"0\" alt=\"' . $lang . '\"></a>';\n        $counter++;\n    }\n    return $flags;\n}\n\n// prepare categories list for templates/template\n// Prepare categories sorting\nif ($system->SETTINGS['catsorting'] == 'alpha') {\n    $catsorting = ' ORDER BY cat_name ASC';\n} else {\n    $catsorting = ' ORDER BY sub_counter DESC';\n}\n\n$query = \"SELECT cat_id FROM \" . $DBPrefix . \"categories WHERE parent_id = -1\";\n$db->direct_query($query);\n$parent_id = $db->result('cat_id');\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"categories\n\t\t\tWHERE parent_id = :parent_id\n\t\t\t\" . $catsorting . \"\n\t\t\tLIMIT :limit\";\n$params = array();\n$params[] = array(':parent_id', $parent_id, 'int');\n$params[] = array(':limit', $system->SETTINGS['catstoshow'], 'int');\n$db->query($query, $params);\n\n$cat_strings = [];\n$categories = [];\nwhile ($row = $db->fetch()) {\n    $cat_strings[$row['cat_id']] = $category_names[$row['cat_id']];\n    $categories[$row['cat_id']] = $row;\n}\n// sort the categories\nif ($system->SETTINGS['catsorting'] == 'alpha') {\n    asort($cat_strings);\n}\nforeach ($cat_strings as $cat_id => $category_name) {\n    $row = $categories[$cat_id];\n    $template->assign_block_vars('cat_list', array(\n            'CATAUCNUM' => ($row['sub_counter'] != 0) ? $row['sub_counter'] : '',\n            'ID' => $row['cat_id'],\n            'IMAGE' => (!empty($row['cat_image'])) ? '<img src=\"' . $row['cat_image'] . '\" border=0>' : '',\n            'COLOUR' => (empty($row['cat_colour'])) ? '#FFFFFF' : $row['cat_colour'],\n            'NAME' => $category_names[$row['cat_id']]\n            ));\n}\n\n// get featured items\n$query = \"SELECT id, title, current_bid, pict_url, ends, num_bids, minimum_bid, bn_only, buy_now\n\t\tFROM \" . $DBPrefix . \"auctions\n\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\tAND featured = 1\n\t\tORDER BY RAND() DESC LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['homefeaturednumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $high_bid = ($row['num_bids'] == 0) ? $row['minimum_bid'] : $row['current_bid'];\n    $high_bid = ($row['bn_only']) ? $row['buy_now'] : $high_bid;\n    $template->assign_block_vars('featured', array(\n            'ENDS' => $ends_string,\n            'ID' => $row['id'],\n            'BID' => $system->print_money($high_bid),\n            'IMAGE' => (!empty($row['pict_url'])) ? 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&auction_id=' . $row['id'] . '&fromfile=' . $row['pict_url'] : '',\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$featured_items = ($i > 0) ? true : false;\n\n// get last created auctions\n$query = \"SELECT id, title, starts from \" . $DBPrefix . \"auctions\n\t\t\tWHERE closed = 0 AND suspended = 0\n\t\t\tAND starts <= CURRENT_TIMESTAMP\n\t\t\tORDER BY starts DESC\n\t\t\tLIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['lastitemsnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    $template->assign_block_vars('auc_last', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'DATE' => $dt->printDateTz($row['starts']),\n            'ID' => $row['id'],\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$auc_last = ($i > 0) ? true : false;\n// get ending soon auctions\n$query = \"SELECT ends, id, title FROM \" . $DBPrefix . \"auctions\n\t\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\t\tORDER BY ends LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['endingsoonnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $template->assign_block_vars('end_soon', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'DATE' => $ends_string,\n            'ID' => $row['id'],\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n    $i++;\n}\n\n$end_soon = ($i > 0) ? true : false;\n// get hot items\n$query = \"SELECT a.id, a.title, a.current_bid, a.pict_url, a.ends, a.num_bids, a.minimum_bid\n\t\tFROM \" . $DBPrefix . \"auctions a\n\t\tLEFT JOIN \" . $DBPrefix . \"auccounter c ON (a.id = c.auction_id)\n\t\tWHERE closed = 0 AND suspended = 0 AND starts <= CURRENT_TIMESTAMP\n\t\tORDER BY c.counter DESC LIMIT :limit\";\n$params = array();\n$params[] = array(':limit', $system->SETTINGS['hotitemsnumber'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($row = $db->fetch()) {\n    $i++;\n    if (strtotime($row['ends']) - time() > 0) {\n        $current_time = new DateTime('now', $dt->UTCtimezone);\n        $end_time = new DateTime($row['ends'], $dt->UTCtimezone);\n        $difference = $current_time->diff($end_time);\n        $ends_string = $dt->formatTimeLeft($difference);\n    } else {\n        $ends_string = $MSG['911'];\n    }\n    $high_bid = ($row['num_bids'] == 0) ? $row['minimum_bid'] : $row['current_bid'];\n    $template->assign_block_vars('hotitems', array(\n            'ENDS' => $ends_string,\n            'ID' => $row['id'],\n            'BID' => $system->print_money($high_bid),\n            'IMAGE' => (!empty($row['pict_url'])) ? 'getthumb.php?w=' . $system->SETTINGS['thumb_show'] . '&auction_id=' . $row['id'] . '&amp;fromfile=' . $row['pict_url'] : '',\n            'TITLE' => htmlspecialchars($row['title'])\n            ));\n}\n$hot_items = ($i > 0) ? true : false;\n\n// Build list of help topics\n$query = \"SELECT id, category FROM \" . $DBPrefix . \"faqscat_translated WHERE lang = :language ORDER BY category ASC\";\n$params = array();\n$params[] = array(':language', $language, 'str');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($faqscat = $db->fetch()) {\n    $template->assign_block_vars('helpbox', array(\n            'ID' => $faqscat['id'],\n            'TITLE' => $faqscat['category']\n            ));\n    $i++;\n}\n\n$helpbox = ($i > 0) ? true : false;\n// Build news list\nif ($system->SETTINGS['newsbox'] == 1) {\n    $query = \"SELECT n.title As t, n.new_date, t.* FROM \" . $DBPrefix . \"news n\n\t\t\tLEFT JOIN \" . $DBPrefix . \"news_translated t ON (t.id = n.id)\n\t\t\tWHERE t.lang = :language AND n.suspended = 0\n\t\t\tORDER BY new_date DESC, id DESC LIMIT :limit\";\n    $params = array();\n    $params[] = array(':language', $language, 'str');\n    $params[] = array(':limit', $system->SETTINGS['newstoshow'], 'int');\n    $db->query($query, $params);\n    while ($new = $db->fetch()) {\n        $template->assign_block_vars('newsbox', array(\n                'ID' => $new['id'],\n                'DATE' => $dt->formatDate($new['new_date']),\n                'TITLE' => (!empty($new['title'])) ? htmlspecialchars($new['title']) : htmlspecialchars($new['t'])\n                ));\n    }\n}\n\n$template->assign_vars(array(\n        'FLAGS' => ShowFlags(),\n        'B_FEATURED_ITEMS' => $featured_items,\n        'B_AUC_LAST' => $auc_last,\n        'B_HOT_ITEMS' => $hot_items,\n        'B_AUC_ENDSOON' => $end_soon,\n        'B_HELPBOX' => ($helpbox && $system->SETTINGS['helpbox'] == 1),\n        'B_MULT_LANGS' => (count($LANGUAGES) > 1),\n        'B_LOGIN_BOX' => ($system->SETTINGS['loginbox'] == 1),\n        'B_NEWS_BOX' => ($system->SETTINGS['newsbox'] == 1)\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'home.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n\nunset($_SESSION['loginerror']);\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude MAIN_PATH . 'language/' . $language . '/categories.inc.php';\n\n// Get parameters from the URL\n$id = (isset($_SESSION['CURRENT_ITEM'])) ? intval($_SESSION['CURRENT_ITEM']) : 0;\n$id = (isset($_REQUEST['id'])) ? intval($_REQUEST['id']) : 0;\n\n$bidderarray = array();\n$bidderarraynum = 1;\n$catscontrol = new MPTTcategories();\n\n$_SESSION['CURRENT_ITEM'] = $id;\n$_SESSION['REDIRECT_AFTER_LOGIN'] = $system->SETTINGS['siteurl'] . 'item.php?id=' . $id;\n\n// get auction all needed data\n$query = \"SELECT a.*, ac.counter, u.nick, u.reg_date, u.city, u.country, u.zip FROM \" . $DBPrefix . \"auctions a\n\t        LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = a.user)\n\t        LEFT JOIN \" . $DBPrefix . \"auccounter ac ON (ac.auction_id = a.id)\n\t        WHERE a.id = :auction_id LIMIT 1\";\n$params = array();\n$params[] = array(':auction_id', $id, 'int');\n$db->query($query, $params);\nif ($db->numrows() == 0) {\n    $_SESSION['msg_title'] = $ERR_622;\n    $_SESSION['msg_body'] = $ERR_623;\n    header('location: message.php');\n    exit;\n}\n$auction_data = $db->result();\n$category = $auction_data['category'];\n$auction_type = $auction_data['auction_type'];\n$ends = $auction_data['ends'];\n$start = $auction_data['starts'];\n$user_id = $auction_data['user'];\n$minimum_bid = $auction_data['minimum_bid'];\n$high_bid = $auction_data['current_bid'];\n$customincrement = $auction_data['increment'];\n$seller_reg = $dt->formatDate($auction_data['reg_date']);\n\n// sort out counter\nif (!isset($auction_data['counter'])) {\n    $query = \"INSERT INTO `\" . $DBPrefix . \"auccounter` (`auction_id`, `counter`) VALUES (:counter, 1)\";\n    $params = array();\n    $params[] = array(':counter', $id, 'int');\n    $db->query($query, $params);\n    $auction_data['counter'] = 1;\n} else {\n    if (!isset($_SESSION['WEBID_VIEWED_AUCTIONS'])) {\n        $_SESSION['WEBID_VIEWED_AUCTIONS'] = array();\n    }\n    if (!in_array($id, $_SESSION['WEBID_VIEWED_AUCTIONS'])) {\n        $query = \"UPDATE \" . $DBPrefix . \"auccounter set counter = counter + 1 WHERE auction_id = :auction_id\";\n        $params = array();\n        $params[] = array(':auction_id', $id, 'int');\n        $db->query($query, $params);\n        $_SESSION['WEBID_VIEWED_AUCTIONS'][] = $id;\n    }\n}\n\n// get watch item data\nif ($user->logged_in) {\n    // Check if this item is not already added\n    $query = \"SELECT item_watch FROM \" . $DBPrefix . \"users WHERE id = :user_id\";\n    $params = array();\n    $params[] = array(':user_id', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    $watcheditems = trim($db->result('item_watch'));\n    $auc_ids = explode(' ', $watcheditems);\n\n    if (in_array($id, $auc_ids)) {\n        $watch_var = 'delete';\n        $watch_string = $MSG['5202_0'];\n    } else {\n        $watch_var = 'add';\n        $watch_string = $MSG['5202'];\n    }\n} else {\n    $watch_var = '';\n    $watch_string = '';\n}\n\n// get ending time\n$showendtime = false;\n$has_ended = false;\n$difference = null;\nif (strtotime($start) > time()) {\n    $ending_time = '<span class=\"errfont\">' . $MSG['668'] . '</span>';\n} elseif (strtotime($ends) - time() > 0) {\n    $current_time = new DateTime('now', $dt->UTCtimezone);\n    $end_time = new DateTime($ends, $dt->UTCtimezone);\n    $difference = $current_time->diff($end_time);\n    $ending_time = '';\n    $date_elements = 0;\n    //Display Years\n    if ($difference->y > 0){\n        $timemsg = ($difference->y == 1) ? $MSG['count_year'] : $MSG['count_years'];\n        $ending_time .= $difference->y . $timemsg;\n        $date_elements++;\n    }\n    //Display Months\n    if ($difference->m > 0) {\n        $timemsg = ($difference->m == 1) ? $MSG['count_month'] : $MSG['count_months'];\n        if ($difference->y > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->m . $timemsg;\n        $date_elements++;\n    }\n    //Display Days\n    if ($difference->d > 0) {\n        $timemsg = ($difference->d == 1) ? $MSG['count_day'] : $MSG['count_days'];\n        if ($difference->y > 0 || $difference->m > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->d . $timemsg;\n        $date_elements++;\n    }\n    //Display Hours\n    if ($difference->h > 0 && $date_elements < 3) {\n        $timemsg = ($difference->h == 1) ? $MSG['count_hour'] : $MSG['count_hours'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0) {\n            $comma = \", \";\n\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma .  $difference->h . $timemsg ;\n        $date_elements++;\n    }\n    //Display Minutes\n    if ($difference->i > 0 && $date_elements < 3) {\n        $timemsg = ($difference->i == 1) ? $MSG['count_minute'] : $MSG['count_minutes'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0 || $difference->h > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->i . $timemsg;\n        $date_elements++;\n    }\n    //Display Seconds\n    if ($difference->s > 0 && $date_elements < 3) {\n        $timemsg = ($difference->s == 1) ? $MSG['count_second'] : $MSG['count_seconds'];\n        if ($difference->y > 0 || $difference->m > 0 || $difference->d > 0 || $difference->h > 0 || $difference->i > 0) {\n            $comma = \", \";\n        } else {\n            $comma = null;\n        }\n        $ending_time .= $comma . $difference->s . $timemsg;\n    }\n    $showendtime = true;\n} else {\n    $ending_time = '<span class=\"errfont\">' . $MSG['911'] . '</span>';\n    $has_ended = true;\n}\n\n// build bread crumbs\n$query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n$params = array();\n$params[] = array(':cat_id', $auction_data['category'], 'int');\n$db->query($query, $params);\n$parent_node = $db->result();\n\n$cat_value = '';\n$crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\nfor ($i = 0; $i < count($crumbs); $i++) {\n    if ($crumbs[$i]['cat_id'] > 0) {\n        if ($i > 0) {\n            $cat_value .= ' > ';\n        }\n        $cat_value .= '<a href=\"' . $system->SETTINGS['siteurl'] . 'browse.php?id=' . $crumbs[$i]['cat_id'] . '\">' . $category_names[$crumbs[$i]['cat_id']] . '</a>';\n    }\n}\n\n$secondcat_value = '';\nif ($system->SETTINGS['extra_cat'] == 'y' && intval($auction_data['secondcat']) > 0) {\n    $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :sec_cat_id\";\n    $params = array();\n    $params[] = array(':sec_cat_id', $auction_data['secondcat'], 'int');\n    $db->query($query, $params);\n    $parent_node = $db->result();\n\n    $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n    for ($i = 0; $i < count($crumbs); $i++) {\n        if ($crumbs[$i]['cat_id'] > 0) {\n            if ($i > 0) {\n                $secondcat_value .= ' > ';\n            }\n            $secondcat_value .= '<a href=\"' . $system->SETTINGS['siteurl'] . 'browse.php?id=' . $crumbs[$i]['cat_id'] . '\">' . $category_names[$crumbs[$i]['cat_id']] . '</a>';\n        }\n    }\n}\n\n// history\n$query = \"SELECT b.*, u.nick, u.rate_sum FROM \" . $DBPrefix . \"bids b\n\t        LEFT JOIN \" . $DBPrefix . \"users u ON (u.id = b.bidder)\n\t        WHERE b.auction = :auc_id\";\nif ($auction_data['bn_only'] || $auction_type == 2) {\n    $query .= \" ORDER BY b.bidwhen DESC\";\n} else {\n    $query .= \" ORDER BY b.bid DESC, b.quantity DESC, b.id DESC\";\n}\n$params = array();\n$params[] = array(':auc_id', $id, 'int');\n$db->query($query, $params);\n$num_bids = $db->numrows();\n$i = 0;\n$left = $auction_data['quantity'];\n$hbidder_data = array();\nforeach ($db->fetchall() as $bidrec) {\n    if (!isset($bidderarray[$bidrec['nick']])) {\n        if ($system->SETTINGS['buyerprivacy'] == 'y' && (!$user->logged_in || ($user->user_data['id'] != $auction_data['user'] && $user->user_data['id'] != $bidrec['bidder']))) {\n            $bidderarray[$bidrec['nick']] = $MSG['176'] . ' ' . $bidderarraynum;\n            $bidderarraynum++;\n        } else {\n            $bidderarray[$bidrec['nick']] = $bidrec['nick'];\n        }\n    }\n    if ($left > 0 && !in_array($bidrec['bidder'], $hbidder_data)) { //store highest bidder details\n        $hbidder_data[] = $bidrec['bidder'];\n        $fb_pos = $fb_neg = 0;\n        // get seller feebacks\n        $query = \"SELECT rate FROM \" . $DBPrefix . \"feedbacks WHERE rated_user_id = :rate_users_id\";\n        $params = array();\n        $params[] = array(':rate_users_id', $bidrec['bidder'], 'int');\n        $db->query($query, $params);\n        // count numbers\n        $fb_pos = $fb_neg = 0;\n        while ($fb_arr = $db->fetch()) {\n            if ($fb_arr['rate'] == 1) {\n                $fb_pos++;\n            } elseif ($fb_arr['rate'] == - 1) {\n                $fb_neg++;\n            }\n        }\n\n        $total_rate = $fb_pos - $fb_neg;\n        $query = \"SELECT icon FROM \" . $DBPrefix . \"membertypes WHERE feedbacks <= :feedback ORDER BY feedbacks DESC LIMIT 1;\";\n        $params = array();\n        $params[] = array(':feedback', $bidrec['rate_sum'], 'int');\n        $db->query($query, $params);\n        $feedback_icon = $db->result('icon');\n        $template->assign_block_vars('high_bidders', array(\n                'BUYER_ID' => $bidrec['bidder'],\n                'BUYER_NAME' => $bidderarray[$bidrec['nick']],\n                'BUYER_FB' => $bidrec['rate_sum'],\n                'BUYER_FB_ICON' => $feedback_icon\n                ));\n    }\n    $template->assign_block_vars('bidhistory', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $bidrec['bidder'],\n            'NAME' => $bidderarray[$bidrec['nick']],\n            'BID' => $system->print_money($bidrec['bid']),\n            'WHEN' => $dt->formatDate($bidrec['bidwhen'], 'd F Y - H:i:s'),\n            'QTY' => $bidrec['quantity']\n            ));\n    $left -= $bidrec['quantity'];\n    $i++;\n}\n\n$userbid = false;\nif ($user->logged_in && $num_bids > 0) {\n    // check if youve bid on this before\n    $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :auction AND bidder = :bidder LIMIT 1\";\n    $params = array();\n    $params[] = array(':auction', $id, 'int');\n    $params[] = array(':bidder', $user->user_data['id'], 'int');\n    $db->query($query, $params);\n    if ($db->numrows() > 0) {\n        if (in_array($user->user_data['id'], $hbidder_data)) {\n            $yourbidmsg = $MSG['25_0088'];\n            $yourbidclass = 'yourbidwin';\n\t    $difference = $current_time->diff($end_time);\n            if ($difference->invert && $auction_data['reserve_price'] > 0 && $auction_data['current_bid'] < $auction_data['reserve_price']) {\n                $yourbidmsg = $MSG['514'];\n                $yourbidclass = 'yourbidloss';\n            } elseif ($difference->invert || $auction_data['bn_only']) {\n                $yourbidmsg = $MSG['25_0089'];\n            }\n        } elseif ($auction_data['bn_only']) {\n            $yourbidmsg = $MSG['25_0089'];\n            $yourbidclass = 'yourbidwin';\n        } else {\n            $yourbidmsg = $MSG['25_0087'];\n            $yourbidclass = 'yourbidloss';\n        }\n        $userbid = true;\n    }\n}\n\n// sort out user questions\n$query = \"SELECT id FROM \" . $DBPrefix . \"messages WHERE reply_of = 0 AND public = 1 AND question = :question_id\";\n$params = array();\n$params[] = array(':question_id', $id, 'int');\n$db->query($query, $params);\n$num_questions = $db->numrows();\nforeach ($db->fetchall() as $row) {\n    $template->assign_block_vars('questions', array()); // just need to create the block\n    $query = \"SELECT sentfrom, message FROM \" . $DBPrefix . \"messages WHERE question = :id AND reply_of = :reply_of OR id = :message_id ORDER BY sentat ASC\";\n    $params = array();\n    $params[] = array(':id', $id, 'int');\n    $params[] = array(':reply_of', $row['id'], 'int');\n    $params[] = array(':message_id', $row['id'], 'int');\n    $db->query($query, $params);\n    while ($row_ = $db->fetch()) {\n        $template->assign_block_vars('questions.conv', array(\n                'MESSAGE' => $row_['message'],\n                'BY_WHO' => ($user_id == $row_['sentfrom']) ? $MSG['125'] : $MSG['555']\n                ));\n    }\n}\n\n$high_bid = ($num_bids == 0) ? $minimum_bid : $high_bid;\n\nif ($customincrement == 0) {\n    // Get bid increment for current bid and calculate minimum bid\n    $query = \"SELECT increment FROM \" . $DBPrefix . \"increments WHERE\n              ((low <= :val0 AND high >= :val1) OR\n              (low < :val2 AND high < :val3)) ORDER BY increment DESC\";\n    $params = array();\n    $params[] = array(':val0', $high_bid, 'float');\n    $params[] = array(':val1', $high_bid, 'float');\n    $params[] = array(':val2', $high_bid, 'float');\n    $params[] = array(':val3', $high_bid, 'float');\n    $db->query($query, $params);\n    if ($db->numrows() != 0) {\n        $increment = $db->result('increment');\n    }\n} else {\n    $increment = $customincrement;\n}\n\nif ($auction_type == 2) {\n    $increment = 0;\n}\n\nif ($customincrement > 0) {\n    $increment = $customincrement;\n}\n\nif ($num_bids == 0 || $auction_type == 2) {\n    $next_bidp = $minimum_bid;\n} else {\n    $next_bidp = $high_bid + $increment;\n}\n\n$view_history = '';\nif ($num_bids > 0 && !isset($_GET['history'])) {\n    $view_history = '(<a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '&history=view#history\">' . $MSG['105'] . '</a>)';\n} elseif (isset($_GET['history'])) {\n    $view_history = '(<a href=\"' . $system->SETTINGS['siteurl'] . 'item.php?id=' . $id . '\">' . $MSG['507'] . '</a>)';\n}\n$min_bid = $system->print_money($minimum_bid);\n$high_bid = $system->print_money($high_bid);\nif ($difference != null && !$difference->invert) {\n    $next_bid = $system->print_money($next_bidp);\n} else {\n    $next_bid = '--';\n}\n\n// get seller feebacks\n$query = \"SELECT rate FROM \" . $DBPrefix . \"feedbacks WHERE rated_user_id = :user_id\";\n$params = array();\n$params[] = array(':user_id', $user_id, 'int');\n$db->query($query, $params);\n$num_feedbacks = $db->numrows();\n// count numbers\n$fb_pos = $fb_neg = 0;\nwhile ($fb_arr = $db->fetch()) {\n    if ($fb_arr['rate'] == 1) {\n        $fb_pos++;\n    } elseif ($fb_arr['rate'] == - 1) {\n        $fb_neg++;\n    }\n}\n\n$total_rate = $fb_pos - $fb_neg;\n\n$query = \"SELECT icon FROM \" . $DBPrefix . \"membertypes WHERE feedbacks <= :feedback ORDER BY feedbacks DESC LIMIT 1;\";\n$params = array();\n$params[] = array(':feedback', $total_rate, 'int');\n$db->query($query, $params);\n$seller_feedback_icon = $db->result('icon');\n\n// Pictures Gellery\n$K = 0;\n$UPLOADED_PICTURES = array();\nif (is_dir(UPLOAD_PATH . $id)) {\n    $dir = opendir(UPLOAD_FOLDER . $id);\n    if ($dir) {\n        while ($file = @readdir($dir)) {\n            if ($file != '.' && $file != '..' && strpos($file, 'thumb-') === false) {\n                $UPLOADED_PICTURES[$K] = $file;\n                $K++;\n            }\n        }\n        closedir($dir);\n    }\n    $GALLERY_DIR = $id;\n\n    if (is_array($UPLOADED_PICTURES)) {\n        foreach ($UPLOADED_PICTURES as $k => $v) {\n            $TMP = @getimagesize(UPLOAD_FOLDER . $id . '/' . $v);\n            if ($TMP[2] >= 1 && $TMP[2] <= 3) {\n                $template->assign_block_vars('gallery', array(\n                        'V' => $v\n                        ));\n            }\n        }\n    }\n}\n\n// payment methods\n$payment = explode(', ', $auction_data['payment']);\n$payment_methods = '';\n$query = \"SELECT gateway_active, is_gateway, name, displayname FROM \" . $DBPrefix . \"payment_options\";\n$db->direct_query($query);\n$p_first = true;\nwhile ($payment_method = $db->fetch()) {\n    if ($payment_method['gateway_active'] == 1 || $payment_method['is_gateway'] == 0) {\n        if (in_array($payment_method['name'], $payment)) {\n            if (!$p_first) {\n                $payment_methods .= ', ';\n            } else {\n                $p_first = false;\n            }\n            $payment_methods .= $payment_method['displayname'];\n        }\n    }\n}\n\n$bn_link = (!$has_ended) ? ' <a href=\"' . $system->SETTINGS['siteurl'] . 'buy_now.php?id=' . $id . '\"><img border=\"0\" align=\"absbottom\" alt=\"' . $MSG['496'] . '\" src=\"' . get_lang_img('buy_it_now.gif') . '\"></a>' : '';\n\n$page_title = htmlspecialchars($auction_data['title']);\n\n$shipping = '';\nif ($auction_data['shipping'] == 1) {\n    $shipping = $MSG['031'];\n} elseif ($auction_data['shipping'] == 2) {\n    $shipping = $MSG['032'];\n} elseif ($auction_data['shipping'] == 3) {\n    $shipping = $MSG['867'];\n}\n\n$template->assign_vars(array(\n        'ID' => $auction_data['id'],\n        'TITLE' => htmlspecialchars($auction_data['title']),\n        'SUBTITLE' => htmlspecialchars($auction_data['subtitle']),\n        'AUCTION_DESCRIPTION' => $auction_data['description'],\n        'PIC_URL' => $auction_data['pict_url'],\n        'SHIPPING_COST' => ($auction_data['shipping_cost'] > 0) ? $system->print_money($auction_data['shipping_cost']) : $MSG['1152'],\n        'ADDITIONAL_SHIPPING_COST' => $system->print_money($auction_data['additional_shipping_cost']),\n        'COUNTRY' => $auction_data['country'],\n        'CITY' => $auction_data['city'],\n        'ZIP' => $auction_data['zip'],\n        'QTY' => $auction_data['quantity'],\n        'ENDS' => $ending_time,\n        'ENDS_IN' => (strtotime($ends) - time()),\n        'STARTTIME' => $dt->printDateTz($start),\n        'ENDTIME' => $dt->printDateTz($ends),\n        'BUYNOW1' => $auction_data['buy_now'],\n        'BUYNOW2' => ($auction_data['buy_now'] > 0) ? $system->print_money($auction_data['buy_now']) . $bn_link : $system->print_money($auction_data['buy_now']),\n        'NUMBIDS' => $num_bids,\n        'MINBID' => $min_bid,\n        'MAXBID' => $high_bid,\n        'NEXTBID' => $next_bid,\n        'INTERNATIONAL' => ($auction_data['international']) ? $MSG['033'] : $MSG['043'],\n        'SHIPPING' => $shipping,\n        'SHIPPINGTERMS' => nl2br(htmlspecialchars($auction_data['shipping_terms'])),\n        'PAYMENTS' => $payment_methods,\n        'AUCTION_VIEWS' => $auction_data['counter'],\n        'AUCTION_TYPE' => ($auction_data['bn_only'] == 0) ? $system->SETTINGS['auction_types'][$auction_type] : $MSG['933'],\n        'ATYPE' => $auction_type,\n        'THUMBWIDTH' => $system->SETTINGS['thumb_show'],\n        'VIEW_HISTORY1' => (empty($view_history)) ? '' : $view_history . ' | ',\n        'VIEW_HISTORY2' => $view_history,\n        'TOPCATSPATH' => ($system->SETTINGS['extra_cat'] == 'y' && isset($_SESSION['browse_id']) && $_SESSION['browse_id'] == $auction_data['secondcat']) ? $secondcat_value : $cat_value,\n        'CATSPATH' => $cat_value,\n        'SECCATSPATH' => $secondcat_value,\n        'CAT_ID' => $auction_data['category'],\n        'UPLOADEDPATH' => UPLOAD_FOLDER,\n        'BNIMG' => get_lang_img('buy_it_now.gif'),\n\n        'SELLER_REG' => $seller_reg,\n        'SELLER_ID' => $auction_data['user'],\n        'SELLER_NICK' => $auction_data['nick'],\n        'SELLER_TOTALFB' => $total_rate,\n        'SELLER_FB_ICON' => $seller_feedback_icon,\n        'SELLER_NUMFB' => $num_feedbacks,\n        'SELLER_FBPOS' => ($num_feedbacks > 0) ? '(' . ceil($fb_pos * 100 / $num_feedbacks) . '%)' : $MSG['000'],\n        'SELLER_FBNEG' => ($fb_neg > 0 && $total_rate != 0) ? $MSG['5507'] . ' (' . ceil($fb_neg * 100 / $total_rate) . '%)' : '0',\n\n        'WATCH_VAR' => $watch_var,\n        'WATCH_STRING' => $watch_string,\n\n        'YOURBIDMSG' => (isset($yourbidmsg)) ? $yourbidmsg : '',\n        'YOURBIDCLASS' => (isset($yourbidclass)) ? $yourbidclass : '',\n\n        'B_HASENDED' => $has_ended,\n        'B_CANEDIT' => ($user->logged_in && $user->user_data['id'] == $auction_data['user'] && $num_bids == 0 && !($difference == null || $difference->invert)),\n        'B_CANCONTACTSELLER' => (($system->SETTINGS['contactseller'] == 'always' || ($system->SETTINGS['contactseller'] == 'logged' && $user->logged_in)) && (!$user->logged_in || $user->user_data['id'] != $auction_data['user'])),\n        'B_HASIMAGE' => (!empty($auction_data['pict_url'])),\n        'B_NOTBNONLY' => ($auction_data['bn_only'] == 0),\n        'B_HASRESERVE' => ($auction_data['reserve_price'] > 0 && $auction_data['reserve_price'] > $auction_data['current_bid']),\n        'B_BNENABLED' => ($system->SETTINGS['buy_now'] == 2),\n        'B_HASGALELRY' => (count($UPLOADED_PICTURES) > 0),\n        'B_SHOWHISTORY' => (isset($_GET['history']) && $num_bids > 0),\n        'B_BUY_NOW' => ($auction_data['buy_now'] > 0 && ($auction_data['bn_only'] || $auction_data['bn_only'] == 0 && ($auction_data['num_bids'] == 0 || ($auction_data['reserve_price'] > 0 && $auction_data['current_bid'] < $auction_data['reserve_price'])))),\n        'B_BUY_NOW_ONLY' => ($auction_data['bn_only']),\n        'B_ADDITIONAL_SHIPPING_COST' => ($auction_data['auction_type'] == '2'),\n        'B_USERBID' => $userbid,\n        'B_BIDDERPRIV' => ($system->SETTINGS['buyerprivacy'] == 'y' && (!$user->logged_in || ($user->logged_in && $user->user_data['id'] != $auction_data['user']))),\n        'B_HASBUYER' => (count($hbidder_data) > 0),\n        'B_COUNTDOWN' => ($system->SETTINGS['hours_countdown'] > ((strtotime($ends) - time()) / 3600)),\n        'B_HAS_QUESTIONS' => ($num_questions > 0),\n        'B_CAN_BUY' => ($user->permissions['can_buy'] || (!$user->logged_in && $system->SETTINGS['bidding_visable_to_guest'])) && !(strtotime($start) > time()),\n        'B_SHIPPING' => ($system->SETTINGS['shipping'] == 'y'),\n        'B_SHOWENDTIME' => $showendtime,\n        'B_SHOW_ADDITIONAL_SHIPPING_COST' => ($auction_data['additional_shipping_cost'] > 0)\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'item.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\nunset($_SESSION['browse_id']);\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\ninclude INCLUDE_PATH . 'config/timezones.php';\ninclude INCLUDE_PATH . 'config/gateways.php';\n\n// check recaptcha is enabled\nif ($system->SETTINGS['spam_register'] == 2) {\n    include PACKAGE_PATH . 'recaptcha/recaptcha.php';\n} elseif ($system->SETTINGS['spam_register'] == 1) {\n    include PACKAGE_PATH . 'captcha/securimage.php';\n}\n\nfunction CheckAge($day, $month, $year) // check if the users > 18\n{\n    $NOW_year = date('Y');\n    $NOW_month = date('m');\n    $NOW_day = date('d');\n\n    if (($NOW_year - $year) > 18) {\n        return 1;\n    } elseif ((($NOW_year - $year) == 18) && ($NOW_month > $month)) {\n        return 1;\n    } elseif ((($NOW_year - $year) == 18) && ($NOW_month == $month) && ($NOW_day >= $day)) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction get_hash()\n{\n    $string = '0123456789abcdefghijklmnopqrstuvyxz';\n    $hash = '';\n    for ($i = 0; $i < 5; $i++) {\n        $rand = rand(0, (34 - $i));\n        $hash .= $string[$rand];\n        $string = str_replace($string[$rand], '', $string);\n    }\n    return $hash;\n}\n\nfunction generateSelect($name, $options, $selectsetting)\n{\n    $html = '<select name=\"' . $name . '\">';\n    foreach ($options as $option => $value) {\n        if ($selectsetting == $option) {\n            $html .= '<option value=' . $option . ' selected>' . $value . '</option>';\n        } else {\n            $html .= '<option value=' . $option . '>' . $value . '</option>';\n        }\n    }\n    $html .= '</select>';\n    return $html;\n}\n\nfunction checkMissing($missing)\n{\n    foreach ($missing as $value) {\n        if ($value) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction emailDomainIsBlacklisted($email)\n{\n    global $system;\n    $exploded_email = explode('@', trim($email));\n    $email_domain = array_pop($exploded_email);\n    $blocked_domains = explode(\"\\n\", $system->SETTINGS['spam_blocked_email_domains']);\n\n    foreach ($blocked_domains as $domain) {\n        if (stripos($email_domain, rtrim($domain)) !== false) {\n            return true;\n        }\n    }\n    return false;\n}\n\n$first = true;\nunset($ERR);\n\nif (empty($_POST['action'])) {\n    $action = 'first';\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"payment_options WHERE is_gateway = 1\";\n$db->direct_query($query);\n$gateway_data = $db->fetchAll();\n\n// Retrieve users signup settings\n$MANDATORY_FIELDS = unserialize($system->SETTINGS['mandatory_fields']);\n$DISPLAYED_FIELDS = unserialize($system->SETTINGS['displayed_feilds']);\n\n$spam_html = '';\n\nif ($system->SETTINGS['spam_register'] == 1) {\n    $resp = new Securimage();\n    $spam_html = $resp->getCaptchaHtml();\n}\n\n// missing check bools\n$missing = array();\n$missing['birthday'] = $missing['address'] = $missing['city'] = $missing['prov'] = $missing['country'] = $missing['zip'] = $missing['tel'] = $missing['paypal'] = $missing['authnet'] = $missing['worldpay'] = $missing['toocheckout'] = $missing['skrill'] = $missing['name'] = $missing['nick'] = $missing['password'] = $missing['repeat_password'] = $missing['email'] = false;\nif (isset($_POST['action']) && $_POST['action'] == 'first') {\n    if (!isset($_POST['terms_check'])) {\n        $ERR = $ERR_078;\n    }\n    if (empty($_POST['TPL_name'])) {\n        $missing['name'] = true;\n    }\n    if (empty($_POST['TPL_nick'])) {\n        $missing['nick'] = true;\n    }\n    if (empty($_POST['TPL_password'])) {\n        $missing['password'] = true;\n    }\n    if (empty($_POST['TPL_repeat_password'])) {\n        $missing['repeat_password'] = true;\n    }\n    if (empty($_POST['TPL_email'])) {\n        $missing['email'] = true;\n    }\n    if (empty($_POST['TPL_address']) && $MANDATORY_FIELDS['address'] == 'y') {\n        $missing['address'] = true;\n    }\n    if (empty($_POST['TPL_city']) && $MANDATORY_FIELDS['city'] == 'y') {\n        $missing['city'] = true;\n    }\n    if (empty($_POST['TPL_prov']) && $MANDATORY_FIELDS['prov'] == 'y') {\n        $missing['prov'] = true;\n    }\n    if (empty($_POST['TPL_country']) && $MANDATORY_FIELDS['country'] == 'y') {\n        $missing['country'] = true;\n    }\n    if (empty($_POST['TPL_zip']) && $MANDATORY_FIELDS['zip'] == 'y') {\n        $missing['zip'] = true;\n    }\n    if (empty($_POST['TPL_phone']) && $MANDATORY_FIELDS['tel'] == 'y') {\n        $missing['tel'] = true;\n    }\n    if ((empty($_POST['TPL_day']) || empty($_POST['TPL_month']) || empty($_POST['TPL_year'])) && $MANDATORY_FIELDS['birthdate'] == 'y') {\n        $missing['birthday'] = true;\n    }\n    foreach ($gateway_data as $gateway) {\n        if ($gateway['gateway_required'] == 1 && isset($_POST[$gateway['name']]['address']) && empty($_POST[$gateway['name']]['address'])) {\n            $missing[$gateway['name']] = true;\n        }\n    }\n    if (checkMissing($missing)) {\n        $ERR = $ERR_047;\n    }\n    if ($system->SETTINGS['wordsfilter'] == 'y') {\n        if ($_POST['TPL_nick'] != $system->filter($_POST['TPL_nick'])) {\n            $ERR = $MSG['wordfilter_banned_username']; // User name altered by word filter\n        }\n    }\n    if (!isset($ERR)) {\n        $birth_day = (isset($_POST['TPL_day'])) ? $_POST['TPL_day'] : '';\n        $birth_month = (isset($_POST['TPL_month'])) ? $_POST['TPL_month'] : '';\n        $birth_year = (isset($_POST['TPL_year'])) ? $_POST['TPL_year'] : '';\n        $DATE = $birth_year . $birth_month . $birth_day;\n\n        if ($system->SETTINGS['spam_register'] == 2) {\n            $recaptcha_response = (isset($_POST['g-recaptcha-response'])) ? $_POST['g-recaptcha-response'] : '';\n            $resp = recaptcha_check_answer($system->SETTINGS['recaptcha_private'], $recaptcha_response);\n        }\n\n        if ($system->SETTINGS['spam_register'] == 2 && !$resp) {\n            $ERR = $MSG['752'];\n        } elseif ($system->SETTINGS['spam_register'] == 1 && !$resp->check($_POST['captcha_code'])) {\n            $ERR = $MSG['752'];\n        } elseif (strlen($_POST['TPL_nick']) < 6) {\n            $ERR = $ERR_107;\n        } elseif (strlen($_POST['TPL_password']) < 6) {\n            $ERR = $ERR_108;\n        } elseif ($_POST['TPL_password'] != $_POST['TPL_repeat_password']) {\n            $ERR = $ERR_109;\n        } elseif (strlen($_POST['TPL_email']) < 5) {\n            $ERR = $ERR_110;\n        } elseif (!preg_match('/^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+([\\.][a-z0-9-]+)+$/i', $_POST['TPL_email'])) {\n            $ERR = $ERR_008;\n        } elseif ($system->SETTINGS['spam_blocked_email_enabled'] && emailDomainIsBlacklisted($_POST['TPL_email'])) {\n            $ERR = $MSG['spam_blocked_email_domains_register_error'];\n        } elseif (!CheckAge($birth_day, $birth_month, $birth_year) && $MANDATORY_FIELDS['birthdate'] == 'y') {\n            $ERR = $ERR_113;\n        } elseif (!empty($birth_month) && !empty($birth_day) && !empty($birth_year) && !checkdate($birth_month, $birth_day, $birth_year)) {\n            $ERR = $ERR_117;\n        } else {\n            // check username is unique\n            $query = \"SELECT COUNT(nick) as COUNT FROM \" . $DBPrefix . \"users WHERE nick = :name\";\n            $params = array();\n            $params[] = array(':name', $system->cleanvars($_POST['TPL_nick']), 'str');\n            $db->query($query, $params);\n            if ($db->result('COUNT') > 0) {\n                $ERR = $ERR_111; // Selected user already exists\n            }\n            // check email is unique\n            $query = \"SELECT COUNT(email) as COUNT FROM \" . $DBPrefix . \"users WHERE email = :email\";\n            $params = array();\n            $params[] = array(':email', $system->cleanvars($_POST['TPL_email']), 'str');\n            $db->query($query, $params);\n            if ($db->result('COUNT') > 0) {\n                $ERR = $ERR_115; // E-mail already used\n            }\n\n            if (!isset($ERR)) {\n                $TPL_nick_hidden = $_POST['TPL_nick'];\n                $TPL_password_hidden = $_POST['TPL_password'];\n                $TPL_name_hidden = $_POST['TPL_name'];\n                $TPL_email_hidden = $_POST['TPL_email'];\n                $SUSPENDED = ($system->SETTINGS['activationtype'] == 2) ? 0 : 8;\n                $SUSPENDED = ($system->SETTINGS['activationtype'] == 0) ? 10 : $SUSPENDED;\n\n                $query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'signup_fee'\";\n                $db->direct_query($query);\n                $signup_fee = $db->result('value');\n                if ($system->SETTINGS['fee_type'] == 2 && $signup_fee > 0) {\n                    $SUSPENDED = 9;\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET inactiveusers = inactiveusers + 1\";\n                    $db->direct_query($query);\n                } elseif ($system->SETTINGS['activationtype'] == 1 || $system->SETTINGS['activationtype'] == 0) {\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET inactiveusers = inactiveusers + 1\";\n                    $db->direct_query($query);\n                } else {\n                    $query = \"UPDATE \" . $DBPrefix . \"counters SET users = users + 1\";\n                    $db->direct_query($query);\n                }\n                $balance = ($system->SETTINGS['fee_type'] == 2) ? 0 : ($system->SETTINGS['fee_signup_bonus'] - $signup_fee);\n\n                $query = \"SELECT id FROM \" . $DBPrefix . \"groups WHERE auto_join = 1\";\n                $db->direct_query($query);\n                $groups = array();\n                while ($row = $db->fetch()) {\n                    $groups[] = $row['id'];\n                }\n                $hash = get_hash();\n                // prepare to hash the password\n                include PACKAGE_PATH . 'PasswordHash.php';\n                $phpass = new PasswordHash(8, false);\n                $query = \"INSERT INTO \" . $DBPrefix . \"users\n                          (nick, password, hash, name, address, city, prov, country, zip, phone, nletter, email, birthdate,\n                          suspended, language, groups, balance, timezone)\n                          VALUES\n                          (:nick, :password, :hash, :name, :address, :city, :prov, :country, :zip, :phone, :nletter, :email, :birthdate,\n                          :suspended, :language, :groups, :balance, :timezone)\";\n                $params = array(\n                    array(':nick', $system->cleanvars($TPL_nick_hidden), 'str'),\n                    array(':password', $phpass->HashPassword($TPL_password_hidden), 'str'),\n                    array(':hash', $hash, 'str'),\n                    array(':name', $system->cleanvars($TPL_name_hidden), 'str'),\n                    array(':address', $system->cleanvars((isset($_POST['TPL_address'])) ? $_POST['TPL_address'] : ''), 'str'),\n                    array(':city', $system->cleanvars((isset($_POST['TPL_city'])) ? $_POST['TPL_city'] : ''), 'str'),\n                    array(':prov', $system->cleanvars((isset($_POST['TPL_prov'])) ? $_POST['TPL_prov'] : ''), 'str'),\n                    array(':country', $system->cleanvars((isset($_POST['TPL_country'])) ? $_POST['TPL_country'] : ''), 'str'),\n                    array(':zip', $system->cleanvars((isset($_POST['TPL_zip'])) ? $_POST['TPL_zip'] : ''), 'str'),\n                    array(':phone', $system->cleanvars((isset($_POST['TPL_phone'])) ? $_POST['TPL_phone'] : ''), 'str'),\n                    array(':nletter', intval($_POST['TPL_nletter']), 'int'),\n                    array(':email', $system->cleanvars($_POST['TPL_email']), 'str'),\n                    array(':birthdate', ((!empty($DATE)) ? $DATE : 0), 'str'),\n                    array(':suspended', $SUSPENDED, 'int'),\n                    array(':language', $language, 'str'),\n                    array(':groups', implode(',', $groups), 'str'),\n                    array(':balance', $balance, 'float'),\n                    array(':timezone', $_POST['TPL_timezone'], 'str'),\n                );\n                $db->query($query, $params);\n                $TPL_id_hidden = $db->lastInsertId();\n                $query = \"INSERT INTO \" . $DBPrefix . \"usersips (user, ip, type, action)\n                          VALUES (:id_hidden, :remote_addr, 'register', 'accept')\";\n                $params = array();\n                $params[] = array(':id_hidden', $TPL_id_hidden, 'int');\n                $params[] = array(':remote_addr', $_SERVER['REMOTE_ADDR'], 'str');\n                $db->query($query, $params);\n                foreach ($gateway_data as $gateway) {\n                    if (isset($_POST[$gateway['name']]['address']) && empty($_POST[$gateway['name']]['address'])) {\n                        $query = \"INSERT INTO \" . $DBPrefix . \"usergateways (gateway_id, user_id, address, password) VALUES (:gateway_id, :user_id, :address, :password)\";\n                        $params = array(\n                            array(':user_id', $TPL_id_hidden, 'int'),\n                            array(':gateway_id', $gateway['id'], 'int'),\n                            array(':address', ((isset($_POST[$gateway['name']]['address'])) ? $system->cleanvars($_POST[$gateway['name']]['address']) : ''), 'str'),\n                            array(':password', ((isset($_POST[$gateway['name']]['password'])) ? $system->cleanvars($_POST[$gateway['name']]['password']) : ''), 'str'),\n                        );\n                    }\n                }\n\n                $_SESSION['language'] = $language;\n                $first = false;\n\n                if (defined('TrackUserIPs')) {\n                    // log registration IP\n                    $system->log('user', 'Registered User', $TPL_id_hidden);\n                }\n\n                // send emails\n                if ($system->SETTINGS['activationtype'] == 0) {\n                    include INCLUDE_PATH . 'email/user_needapproval.php';\n                    $TPL_message = $MSG['016_a'];\n                } elseif ($system->SETTINGS['activationtype'] == 1) {\n                    include INCLUDE_PATH . 'email/user_confirmation.php';\n                    $TPL_message = sprintf($MSG['016'], $TPL_email_hidden, $system->SETTINGS['sitename']);\n                } else {\n                    $USER = array('name' => $TPL_name_hidden, 'email' => $_POST['TPL_email']);\n                    include INCLUDE_PATH . 'email/user_approved.php';\n                    $TPL_message = $MSG['016_b'];\n                }\n\n                if ($system->SETTINGS['fee_type'] == 2 && $signup_fee > 0) {\n                    $_SESSION['signup_id'] = $TPL_id_hidden;\n                    header('location: pay.php?a=3');\n                    exit;\n                }\n\n                $template->assign_vars(array(\n                        'L_HEADER' => sprintf($MSG['859'], $TPL_name_hidden),\n                        'L_MESSAGE' => $TPL_message\n                        ));\n            }\n        }\n    }\n}\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'signup_fee'\";\n$db->direct_query($query);\n$signup_fee = $db->result('value');\n\n$country_dropdown = '';\n\n$selcountry = isset($_POST['TPL_country']) ? $_POST['TPL_country'] : '';\n\n$query = \"SELECT country_id, country FROM \" . $DBPrefix . \"countries\";\n$db->direct_query($query);\n$countries = $db->fetchall();\n\nforeach ($countries as $country) {\n    $country_dropdown .= '<option value=\"' . $country['country'] . '\"';\n    if ($country['country'] == $selcountry) {\n        $country_dropdown .= ' selected';\n    } elseif (!$selcountry && $system->SETTINGS['defaultcountry'] == $country['country']) {\n        $country_dropdown .= ' selected';\n    }\n    $country_dropdown .= '>' . $country['country'] . '</option>' . \"\\n\";\n}\n\n$dobclass = ($missing['birthday']) ? ' class=\"missing\"' : '';\n$dobmonth = '<select name=\"TPL_month\"' . $dobclass . '>\n\t\t<option value=\"00\"></option>\n\t\t<option value=\"01\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '01') ? ' selected' : '') . '>' . $MSG['MON_001E'] . '</option>\n\t\t<option value=\"02\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '02') ? ' selected' : '') . '>' . $MSG['MON_002E'] . '</option>\n\t\t<option value=\"03\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '03') ? ' selected' : '') . '>' . $MSG['MON_003E'] . '</option>\n\t\t<option value=\"04\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '04') ? ' selected' : '') . '>' . $MSG['MON_004E'] . '</option>\n\t\t<option value=\"05\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '05') ? ' selected' : '') . '>' . $MSG['MON_005E'] . '</option>\n\t\t<option value=\"06\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '06') ? ' selected' : '') . '>' . $MSG['MON_006E'] . '</option>\n\t\t<option value=\"07\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '07') ? ' selected' : '') . '>' . $MSG['MON_007E'] . '</option>\n\t\t<option value=\"08\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '08') ? ' selected' : '') . '>' . $MSG['MON_008E'] . '</option>\n\t\t<option value=\"09\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '09') ? ' selected' : '') . '>' . $MSG['MON_009E'] . '</option>\n\t\t<option value=\"10\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '10') ? ' selected' : '') . '>' . $MSG['MON_010E'] . '</option>\n\t\t<option value=\"11\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '11') ? ' selected' : '') . '>' . $MSG['MON_011E'] . '</option>\n\t\t<option value=\"12\"' . ((isset($_POST['TPL_month']) && $_POST['TPL_month'] == '12') ? ' selected' : '') . '>' . $MSG['MON_012E'] . '</option>\n\t</select>';\n$dobday = '<select name=\"TPL_day\"' . $dobclass . '>\n\t\t<option value=\"\"></option>';\nfor ($i = 1; $i <= 31; $i++) {\n    $j = (strlen($i) == 1) ? '0' . $i : $i;\n    $dobday .= '<option value=\"' . $j . '\"' . ((isset($_POST['TPL_day']) && $_POST['TPL_day'] == $j) ? ' selected' : '') . '>' . $j . '</option>';\n}\n$dobday .= '</select>';\n\n$selectsetting = (isset($_POST['TPL_timezone'])) ? $_POST['TPL_timezone'] : $system->SETTINGS['timezone'];\n$time_correction = generateSelect('TPL_timezone', $timezones, $selectsetting);\n\nforeach ($gateway_data as $gateway) {\n    if ($gateway['gateway_active']) {\n        $template->assign_block_vars('gateways', array(\n                'GATEWAY_ID' => $gateway['id'],\n                'NAME' => $gateway['displayname'],\n                'PLAIN_NAME' => $gateway['name'],\n                'MISSING' => ($missing[$gateway['name']]) ? 1 : 0,\n                'REQUIRED' => ($gateway['gateway_required'] == 1) ? 'checked' : '',\n                'ADDRESS' => isset($_POST[$gateway['name']]['address']) ? $_POST[$gateway['name']]['address'] : '',\n                'PASSWORD' => isset($_POST[$gateway['name']]['password']) ? $_POST[$gateway['name']]['password'] : '',\n                'ADDRESS_NAME' => isset($address_string[$gateway['name']]) ? $address_string[$gateway['name']] : $gateway['name'],\n                'PASSWORD_NAME' => isset($password_string[$gateway['name']]) ? $password_string[$gateway['name']] : '',\n                'ERROR_STRING' => $error_string[$gateway['name']],\n\n                'B_PASSWORD' => isset($password_string[$gateway['name']])\n                ));\n    }\n}\n\n$template->assign_vars(array(\n        'ERROR' => (isset($ERR)) ? $ERR : '',\n        'L_COUNTRIES' => $country_dropdown,\n        'L_DATEFORMAT' => ($system->SETTINGS['datesformat'] == 'USA') ? $dobmonth . ' ' . $dobday : $dobday . ' ' . $dobmonth,\n        'TIMEZONE' => $time_correction,\n        'TERMSTEXT' => $system->SETTINGS['termstext'],\n\n        'B_ADMINAPROVE' => ($system->SETTINGS['activationtype'] == 0),\n        'B_NLETTER' => ($system->SETTINGS['newsletter'] == 1),\n        'B_FIRST' => $first,\n        'B_FEES' => ($signup_fee > 0),\n\n        'CAPTCHATYPE' => $system->SETTINGS['spam_register'],\n        'CAPCHA' => ($system->SETTINGS['spam_register'] == 2) ? recaptcha_get_html($system->SETTINGS['recaptcha_public']) : $spam_html,\n        'BIRTHDATE' => ($DISPLAYED_FIELDS['birthdate_regshow'] == 'y'),\n        'ADDRESS' => ($DISPLAYED_FIELDS['address_regshow'] == 'y'),\n        'CITY' => ($DISPLAYED_FIELDS['city_regshow'] == 'y'),\n        'PROV' => ($DISPLAYED_FIELDS['prov_regshow'] == 'y'),\n        'COUNTRY' => ($DISPLAYED_FIELDS['country_regshow'] == 'y'),\n        'ZIP' => ($DISPLAYED_FIELDS['zip_regshow'] == 'y'),\n        'TEL' => ($DISPLAYED_FIELDS['tel_regshow'] == 'y'),\n        'REQUIRED' => array(\n                    ($MANDATORY_FIELDS['birthdate'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['address'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['city'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['prov'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['country'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['zip'] == 'y') ? ' *' : '',\n                    ($MANDATORY_FIELDS['tel'] == 'y') ? ' *' : ''\n                    ),\n        'MISSING0' => ($missing['name']) ? 1 : 0,\n        'MISSING1' => ($missing['nick']) ? 1 : 0,\n        'MISSING2' => ($missing['password']) ? 1 : 0,\n        'MISSING3' => ($missing['repeat_password']) ? 1 : 0,\n        'MISSING4' => ($missing['email']) ? 1 : 0,\n        'MISSING5' => ($missing['birthday']) ? 1 : 0,\n        'MISSING6' => ($missing['address']) ? 1 : 0,\n        'MISSING7' => ($missing['city']) ? 1 : 0,\n        'MISSING8' => ($missing['prov']) ? 1 : 0,\n        'MISSING9' => ($missing['country']) ? 1 : 0,\n        'MISSING10' => ($missing['zip']) ? 1 : 0,\n        'MISSING11' => ($missing['tel']) ? 1 : 0,\n        'FEES'=> $system->print_money($signup_fee),\n\n        'V_YNEWSL' => ((isset($_POST['TPL_nletter']) && $_POST['TPL_nletter'] == 1) || !isset($_POST['TPL_nletter'])) ? 'checked=true' : '',\n        'V_NNEWSL' => (isset($_POST['TPL_nletter']) && $_POST['TPL_nletter'] == 2) ? 'checked=true' : '',\n        'V_YNAME' => (isset($_POST['TPL_name'])) ? $system->cleanvars($_POST['TPL_name']) : '',\n        'V_UNAME' => (isset($_POST['TPL_nick'])) ? $system->cleanvars($_POST['TPL_nick']) : '',\n        'V_EMAIL' => (isset($_POST['TPL_email'])) ? $system->cleanvars($_POST['TPL_email']) : '',\n        'V_YEAR' => (isset($_POST['TPL_year'])) ? $system->cleanvars($_POST['TPL_year']) : '',\n        'V_ADDRE' => (isset($_POST['TPL_address'])) ? $system->cleanvars($_POST['TPL_address']) : '',\n        'V_CITY' => (isset($_POST['TPL_city'])) ? $system->cleanvars($_POST['TPL_city']) : '',\n        'V_PROV' => (isset($_POST['TPL_prov'])) ? $system->cleanvars($_POST['TPL_prov']) : '',\n        'V_POSTCODE' => (isset($_POST['TPL_zip'])) ? $system->cleanvars($_POST['TPL_zip']) : '',\n        'V_PHONE' => (isset($_POST['TPL_phone'])) ? $system->cleanvars($_POST['TPL_phone']) : ''\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'register.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "\t\t<div style=\"width:25%; float:left;\">\n\t\t\t<div style=\"margin-left:auto; margin-right:auto;\">\n\t\t\t\t<!-- INCLUDE sidebar-{CURRENT_PAGE}.tpl -->\n\t\t\t</div>\n\t\t</div>\n\t\t<div style=\"width:75%; float:right;\">\n\t\t\t<div class=\"main-box\">\n\t\t\t\t<h4 class=\"rounded-top rounded-bottom\">{L_239}&nbsp;&gt;&gt;&nbsp;{L_512}</h4>\n\t\t\t\t<form name=\"editauction\" action=\"\" method=\"post\">\n\t\t\t\t\t<table width=\"98%\" cellpadding=\"0\" cellspacing=\"0\" class=\"blank\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width=\"25%\" align=\"right\">{L_313}</td>\n\t\t\t\t\t\t<td>{USER}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_017}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"title\" size=\"40\" maxlength=\"255\" value=\"{TITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_806}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"subtitle\" size=\"40\" maxlength=\"255\" value=\"{SUBTITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_287}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"category\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats1 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats1.CAT_ID}\"<!-- IF cats1.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats1.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_814}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"secondcat\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats2 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats2.CAT_ID}\"<!-- IF cats2.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats2.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_018}</td>\n\t\t\t\t\t\t<td>{EDITOR}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_258}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"quantity\" size=\"40\" maxlength=\"40\" value=\"{QTY}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_022}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"duration\">\n\t\t\t\t\t\t\t\t<option value=\"\"> </option>\n\t\t\t\t\t\t\t\t<!-- BEGIN dur -->\n\t\t\t\t\t\t\t\t<option value=\"{dur.DAYS}\"<!-- IF dur.SELECTED --> selected<!-- ENDIF -->>{dur.DESC}</option>\n\t\t\t\t\t\t\t\t<!-- END dur -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_816}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div>{L_1105}</div>\n<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<div class=\"button\" style=\" height:100px; float:left; margin:5px; padding:10px 5px 20px 10px;\">\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}/{gallery.V}\" title=\"{gallery.V}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?fromfile={gallery.V}&auction_id={ID}\" border=\"0\" height=\"100px\">\n\t\t\t\t\t\t\t\t</a><br>\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"gallery[]\" value=\"{gallery.V}\">\n\t\t\t\t\t\t\t</div>\n<!-- END gallery -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_817}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_257}</td>\n\t\t\t\t\t\t<td>{ATYPE}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_116}</td>\n\t\t\t\t\t\t<td>{CURRENT_BID}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_124}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"min_bid\" size=\"40\" maxlength=\"40\" value=\"{MIN_BID}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_023}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"shipping_cost\" size=\"40\" maxlength=\"40\" value=\"{SHIPPING_COST}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_021}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"reserve_price\" size=\"40\" maxlength=\"40\" value=\"{RESERVE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_30_0063}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"0\" {BN_ONLY_N}> {L_no}\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"1\" {BN_ONLY_Y}> {L_yes}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_497}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"buy_now\" size=\"40\" maxlength=\"40\" value=\"{BN_PRICE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_120}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"text\" name=\"customincrement\" size=\"10\" value=\"{CUSTOM_INC}\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_319}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_025}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"1\" {SHIPPING1}>\t{L_031}<br>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"2\" {SHIPPING2}>\t{L_032}<br>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"international\" value=\"1\" {INTERNATIONAL}> {L_033}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_25_0215}</td>\n\t\t\t\t\t\t<td><textarea name=\"shipping_terms\" rows=\"3\" cols=\"34\">{SHIPPING_TERMS}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_5233}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_026}</td>\n\t\t\t\t\t\t<td>{PAYMENTS}</td>\n\t\t\t\t\t</tr>\n\t<!-- IF B_MKFEATURED or B_MKBOLD or B_MKHIGHLIGHT -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_268}</td>\n\t\t\t\t\t\t<td>\n\t\t<!-- IF B_MKFEATURED -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_featured\" {IS_FEATURED}> {L_273}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKBOLD -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_bold\" {IS_BOLD}> {L_274}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKHIGHLIGHT -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_highlighted\" {IS_HIGHLIGHTED}> {L_292}</p>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_300}</td>\n\t\t\t\t\t\t<td>{SUSPENDED}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\">\n\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t<input type=\"submit\" name=\"act\" class=\"centre\" value=\"{L_089}\">\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n", "\t\t<div style=\"width:25%; float:left;\">\n\t\t\t<div style=\"margin-left:auto; margin-right:auto;\">\n\t\t\t\t<!-- INCLUDE sidebar-{CURRENT_PAGE}.tpl -->\n\t\t\t</div>\n\t\t</div>\n\t\t<div style=\"width:75%; float:right;\">\n\t\t\t<div class=\"container\">\n\t\t\t\t<h4 class=\"rounded-top rounded-bottom\">{L_239}&nbsp;&gt;&gt;&nbsp;{L_512}</h4>\n\t\t\t\t<form name=\"editauction\" action=\"\" method=\"post\">\n\t\t\t\t\t<table class=\"table table-striped table-bordered\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width=\"25%\" align=\"right\">{L_313}</td>\n\t\t\t\t\t\t<td>{USER}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_017}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"title\" size=\"40\" maxlength=\"255\" value=\"{TITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_806}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"subtitle\" size=\"40\" maxlength=\"255\" value=\"{SUBTITLE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_287}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"category\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats1 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats1.CAT_ID}\"<!-- IF cats1.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats1.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_814}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"secondcat\">\n\t\t\t\t\t\t\t\t<!-- BEGIN cats2 -->\n\t\t\t\t\t\t\t\t\t<option value=\"{cats2.CAT_ID}\"<!-- IF cats2.SELECTED --> selected=\"true\"<!-- ENDIF -->>{cats2.CAT_NAME}</option>\n\t\t\t\t\t\t\t\t<!-- END cats1 -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_018}</td>\n\t\t\t\t\t\t<td><textarea name=\"description\" cols=\"40\" rows=\"8\">{DESC}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_258}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"quantity\" size=\"40\" maxlength=\"40\" value=\"{QTY}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_022}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name=\"duration\">\n\t\t\t\t\t\t\t\t<option value=\"\"> </option>\n\t\t\t\t\t\t\t\t<!-- BEGIN dur -->\n\t\t\t\t\t\t\t\t<option value=\"{dur.DAYS}\"<!-- IF dur.SELECTED --> selected<!-- ENDIF -->>{dur.DESC}</option>\n\t\t\t\t\t\t\t\t<!-- END dur -->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_816}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div>{L_1105}</div>\n<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<div style=\"width:50px; float: left;\">\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}/{gallery.V}\" title=\"{gallery.V}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?fromfile={gallery.V}&auction_id={ID}\" border=\"0\" hspace=\"10\">\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"gallery[]\" value=\"{gallery.V}\">\n\t\t\t\t\t\t\t</div>\n<!-- END gallery -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_817}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_257}</td>\n\t\t\t\t\t\t<td>{ATYPE}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_116}</td>\n\t\t\t\t\t\t<td>{CURRENT_BID}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_124}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"min_bid\" size=\"40\" maxlength=\"40\" value=\"{MIN_BID}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_023}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"shipping_cost\" size=\"40\" maxlength=\"40\" value=\"{SHIPPING_COST}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_021}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"reserve_price\" size=\"40\" maxlength=\"40\" value=\"{RESERVE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_30_0063}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"0\" {BN_ONLY_N}> {L_no}\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"buy_now_only\" value=\"1\" {BN_ONLY_Y}> {L_yes}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_497}</td>\n\t\t\t\t\t\t<td><input type=\"text\" name=\"buy_now\" size=\"40\" maxlength=\"40\" value=\"{BN_PRICE}\"></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_120}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"text\" name=\"customincrement\" size=\"10\" value=\"{CUSTOM_INC}\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_319}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_025}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"1\" {SHIPPING1}>\t{L_031}<br>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"shipping\" value=\"2\" {SHIPPING2}>\t{L_032}<br>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"international\" value=\"1\" {INTERNATIONAL}> {L_033}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_25_0215}</td>\n\t\t\t\t\t\t<td><textarea name=\"shipping_terms\" rows=\"3\" cols=\"34\">{SHIPPING_TERMS}</textarea></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\" style=\"padding:3px; border-top:#0083D7 1px solid; background:#ECECEC;\">\n\t\t\t\t\t\t\t<b>{L_5233}</b>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_026}</td>\n\t\t\t\t\t\t<td>{PAYMENTS}</td>\n\t\t\t\t\t</tr>\n\t<!-- IF B_MKFEATURED or B_MKBOLD or B_MKHIGHLIGHT -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\" valign=\"top\">{L_268}</td>\n\t\t\t\t\t\t<td>\n\t\t<!-- IF B_MKFEATURED -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_featured\" {IS_FEATURED}> {L_273}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKBOLD -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_bold\" {IS_BOLD}> {L_274}</p>\n\t\t<!-- ENDIF -->\n\t\t<!-- IF B_MKHIGHLIGHT -->\n\t\t\t\t\t\t\t<p><input type=\"checkbox\" name=\"is_highlighted\" {IS_HIGHLIGHTED}> {L_292}</p>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td align=\"right\">{L_300}</td>\n\t\t\t\t\t\t<td>{SUSPENDED}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\">\n\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t<input type=\"submit\" name=\"act\" class=\"centre\" value=\"{L_089}\">\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n", "<!-- IF B_COUNTDOWN -->\n<script type=\"text/javascript\">\n$(document).ready(function() {\n\tvar timeRemaining = {ENDS_IN};\n\tvar endDateTime = new Date();\n\tendDateTime.setSeconds(endDateTime.getSeconds() + timeRemaining);\n\tfunction padLength(what)\n\t{\n\t\tvar output = (what.toString().length == 1) ? '0' + what : what;\n\t\treturn output;\n\t}\n\tfunction displayTime() {\n\t\tvar currentDateTime = new Date();\n\n\t\tif (currentDateTime.getTime() < endDateTime.getTime()) {\n\t\t\tvar remainingTime = Math.floor((endDateTime.getTime() - currentDateTime.getTime()) / 1000);\n\t\t\tvar hours = Math.floor(remainingTime / 3600);\n\t\t\tvar mins = Math.floor((remainingTime - (hours * 3600)) / 60);\n\t\t\tvar secs = Math.floor(remainingTime - (hours * 3600) - (mins * 60));\n\n\t\t\tvar timeString = padLength(hours) + ':' + padLength(mins) + ':' + padLength(secs);\n\t\t\t$('#ending_counter').html(timeString);\n\t\t\tsetTimeout(displayTime, 1000);\n\t\t} else {\n\t\t\t$(\"#ending_counter\").html('<div class=\"error-box\">{L_911}</div>');\n\t\t}\n\t}\n\tsetTimeout(displayTime, 1000);\n});\n</script>\n<!-- ENDIF -->\n<div class=\"content\">\n\t<div class=\"tableContent2\">\n\t\t<div class=\"padding\"><b>{L_041}:</b> {TOPCATSPATH}</div>\n\t\t<div class=\"titTable2 rounded-top rounded-bottom\">\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t{TITLE}\n<!-- IF SUBTITLE ne '' -->\n\t\t\t\t\t\t<p class=\"smallspan\">{SUBTITLE}</p>\n<!-- ENDIF -->\n\t\t\t\t\t</td>\n\t\t\t\t\t<td align=\"right\">{L_113}: {ID}</td>\n\t\t\t\t</tr>\n<!-- IF B_CANEDIT -->\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t[<a href=\"{SITEURL}edit_active_auction.php?id={ID}\">{L_30_0069}</a>]\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t</table>\n\t\t</div>\n\t\t<div class=\"titTable3\">\n\t\t\t{VIEW_HISTORY1}\n\t\t\t<a href=\"{SITEURL}friend.php?id={ID}\">{L_106}</a> |\n<!-- IF B_CANCONTACTSELLER -->\n\t\t\t<a href=\"{SITEURL}send_email.php?auction_id={ID}\">{L_922}</a> |\n<!-- ENDIF -->\n<!-- IF B_LOGGED_IN -->\n\t\t\t<a href=\"{SITEURL}item_watch.php?{WATCH_VAR}={ID}\">{WATCH_STRING}</a>\n<!-- ELSE -->\n\t\t\t<a href=\"{SITEURL}user_login.php?\">{L_5202}</a>\n<!-- ENDIF -->\n\t\t</div>\n<!-- IF B_USERBID -->\n\t\t<div class=\"{YOURBIDCLASS}\">\n\t\t\t{YOURBIDMSG}\n\t\t</div>\n<!-- ENDIF -->\n\t\t<br>\n\t\t<div class=\"table2\">\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"titTable5\" valign=\"top\">\n\t\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"5\" cellspacing=\"0\">\n\t\t\t\t\t\t\t<tr>\n<!-- IF B_HASIMAGE -->\n\t\t\t\t\t\t\t\t<td width=\"10%\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t<table bgcolor=\"#ffffff\">\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td align='center'>\n\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={PIC_URL}&auction_id={ID}\" border=\"0\" align=\"center\"><br>\n\t<!-- IF B_HASGALELRY -->\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#gallery\"><img src=\"{SITEURL}images/gallery.gif\" border=\"0\" alt=\"gallery\"> {L_694}</a>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t</td>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<td width=\"60%\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t<table width=\"100%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" valign=\"top\" border=\"0\">\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}<br>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#description\"><img src=\"{SITEURL}images/info.gif\" border='0'></a>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#description\">{L_018}</a> &nbsp;&nbsp;&nbsp;\n\t\t\t\t\t\t\t\t\t\t\t\t<table border='0' width=\"100%\" cellspacing=\"0\" cellpadding=\"1\">\n\t\t\t\t\t\t<!-- auction type -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_261}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{AUCTION_TYPE}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<!-- higher bidder -->\n<!-- IF B_HASBUYER and B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width='50%' valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_117}:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\n\t<!-- BEGIN high_bidders -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>{high_bidders.BUYER_NAME}</b>\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={high_bidders.BUYER_ID}&auction_id={ID}\"><b>{high_bidders.BUYER_NAME}</b></a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>(<a href=\"{SITEURL}feedback.php?id={high_bidders.BUYER_ID}&faction=show\">{high_bidders.BUYER_FB}</a>)</b>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}images/icons/{high_bidders.BUYER_FB_ICON}\" alt=\"{high_bidders.BUYER_FB_ICON}\" class=\"fbstar\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t<!-- END high_bidders -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_901}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{QTY}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_923}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{COUNTRY}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_118}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n<!-- IF B_COUNTDOWN -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span id=\"ending_counter\">{ENDS}</span>\n<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ENDS}<!-- IF B_SHOWENDTIME --><br><span class=\"smallspan\">({ENDTIME})</span><!-- ENDIF -->\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_119}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{NUMBIDS} {VIEW_HISTORY2}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_038}:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{MINBID}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_116}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\" valign=\"middle\">{MAXBID}<!-- IF B_HASRESERVE -->&nbsp;<span class=\"smallspan\">{L_514}</span><!-- ENDIF --></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_023}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{SHIPPING_COST}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF (B_ADDITIONAL_SHIPPING_COST or B_BUY_NOW_ONLY) and B_SHOW_ADDITIONAL_SHIPPING_COST -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_350_1008}: </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{ADDITIONAL_SHIPPING_COST}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_BUY_NOW -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\" align=\"left\">{L_496}:</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">{BUYNOW2}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_HASENDED -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"2\" align=\"left\"><b>{L_904}</b></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td width=\"2%\">&nbsp;</td>\n\t\t\t\t\t<td width=\"37%\" valign=\"top\" bgcolor=\"#ffffff\" align=\"left\">\n\t\t\t\t\t\t<div class=\"titTable1\">\n\t\t\t\t\t\t\t<b>{L_30_0209}</b>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"4\" border=\"0\" bgcolor=\"#ffffff\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\" class='table2'>&nbsp;</td>\n\t\t\t\t\t\t\t\t<td class=\"table2\" style=\"padding:10px;\">\n\t\t\t\t\t\t\t\t\t<a href='{SITEURL}profile.php?user_id={SELLER_ID}&auction_id={ID}'><b>{SELLER_NICK}</b></a>\n\t\t\t\t\t\t\t\t\t(<a href='{SITEURL}feedback.php?id={SELLER_ID}&faction=show'>{SELLER_TOTALFB}</a>)\n\t\t\t\t\t\t\t\t\t<!-- IF SELLER_FB_ICON ne '' --><img src=\"{SITEURL}images/icons/{SELLER_FB_ICON}\" alt=\"{SELLER_FB_ICON}\" class=\"fbstar\"><!-- ENDIF -->\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\">&nbsp;</td>\n\t\t\t\t\t\t\t\t<td width=\"97%\">\n\t\t\t\t\t\t\t\t\t<li>{L_5509}{SELLER_NUMFB}{L__0151}\n\t\t\t\t\t\t\t\t\t<li><b>{L_5506}{SELLER_FBPOS}</b>\n<!-- IF SELLER_FBNEG ne 0 -->\n\t\t\t\t\t\t\t\t\t<li>{SELLER_FBNEG}</li>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t<li>{L_5508}{SELLER_REG}</li>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width=\"3%\">&nbsp;</td>\n\t\t\t\t\t\t\t\t<td width=\"97%\">\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}active_auctions.php?user_id={SELLER_ID}\">{L_213}</a>\n\t\t\t\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t\t<div class=\"titTable1\">\n<!-- IF B_HASENDED eq false and B_CAN_BUY -->\n\t<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t<table width=\"100%\" border=0 cellpadding=2 cellspacing=0 border=1>\n\t\t\t\t\t\t\t\t<form name=\"bid\" action=\"{SITEURL}bid.php\" method=\"post\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td width=\"65%\">\n\t\t\t\t\t\t\t\t\t\t\t<table width=100% border=0 cellpadding=2 cellspacing=0>\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"left\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>\n\t\t<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_284}: <input type=\"text\" name=\"qty\" size=15 /> {QTY} {L_5408}<br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_121} <input type=\"text\" name=\"bid\" size=\"15\">\n\t\t<!-- IF ATYPE eq 1 -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{L_124}: {NEXTBID}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td valign='center' align='center' class='tema' width=\"50%\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"seller_id\" value=\"{SELLER_ID}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"title\" value=\"{TITLE}\" >\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"category\" value=\"{CAT_ID}\" >\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"\" value=\"{L_30_0208}\" class=\"button\">\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</table>\n\t<!-- ELSE -->\n\t\t\t\t\t\t\t{BUYNOW} <a href=\"{SITEURL}buy_now.php?id={ID}\"><img border=\"0\" align=\"absbottom\" alt=\"{L_496}\" src=\"{BNIMG}\"></a>\n\t<!-- ENDIF -->\n<!-- ENDIF -->\n<!-- IF B_CAN_BUY eq false -->\n\t\t\t\t\t\t\t<p>{L_5002}</p>\n\t\t\t\t\t\t\t<p><a href=\"{SITEURL}user_login.php?\">{L_221}</a></p>\n<!-- ENDIF -->\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a class=\"report-item rightside\" href='{SITEURL}item_report.php?id={ID}'>{L_report_this_item}</a>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t\t<br>\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"description\"></a>{L_018}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">{AUCTION_DESCRIPTION}</div>\n\t\t\t</div>\n<!-- IF B_HAS_QUESTIONS -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"questions\"></a>{L_552}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">\n\t<!-- BEGIN questions -->\n\t\t\t\t\t<div class=\"smallspan padding\">\n\t\t<!-- BEGIN conv -->\n\t\t\t\t\t<p><b>{questions.conv.BY_WHO}</b>: {questions.conv.MESSAGE}</p>\n<!-- END conv -->\n\t\t\t\t\t</div>\n<!-- END questions -->\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_HASGALELRY -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t<a name=\"gallery\"></a>{L_663}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\" style=\"text-align:center; overflow-y:auto;\" id=\"gallery\">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}{UPLOADEDPATH}{ID}/{gallery.V}\" title=\"\" data-lightbox=\"gallery\">\n\t\t\t\t\t\t\t\t\t<img src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={gallery.V}&auction_id={ID}\" border=\"0\" hspace=\"10\">\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</td>\n\t<!-- END gallery -->\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_SHOWHISTORY -->\n\t\t\t<div class=\"tableContent2\">\n\t\t\t\t<div class=\"titTable4\">\n\t\t\t\t\t{L_26_0001}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table2\">\n\t\t\t\t\t<a name=\"history\"></a>\n\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"4\" cellspacing=\"1\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_176}</th>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_130}</th>\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_175}</th>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_284}</th>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t</tr>\n\t<!-- BEGIN bidhistory -->\n\t\t\t\t\t\t<tr valign=\"top\" {bidhistory.BGCOLOUR}>\n\t\t\t\t\t\t\t<td>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t{bidhistory.NAME}\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={bidhistory.ID}\">{bidhistory.NAME}</a>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.BID}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.WHEN}\n\t\t\t\t\t\t\t</td>\n\t\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t{bidhistory.QTY}\n\t\t\t\t\t\t\t</td>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t</tr>\n\t<!-- END bidhistory -->\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t<br>\n\t\t\t<div class=\"titTable4\">{L_724}</div>\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class=\"tableContent2\">\n\t\t\t\t\t\t\t<div class=\"table2\">\n<!-- IF CITY ne '' or COUNTRY ne '' or ZIP ne '' -->\n\t\t\t\t\t\t\t\t<b>{L_014}:</b> <!-- IF CITY ne '' -->{CITY}<!-- ENDIF --> <!-- IF COUNTRY ne '' -->{COUNTRY}<!-- ENDIF --> <!-- IF ZIP ne '' -->({ZIP})<!-- ENDIF --><br>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t<b>{L_025}:</b> {SHIPPING}, {INTERNATIONAL}<br>\n<!-- ENDIF -->\n<!-- IF SHIPPINGTERMS ne '' -->\n\t\t\t\t\t\t\t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\"><b>{L_25_0215}:</b>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">{SHIPPINGTERMS}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_026}:</b> {PAYMENTS}<br>\n<!-- IF ! B_BUY_NOW_ONLY -->\n\t\t\t\t\t\t\t\t<b><!-- IF ATYPE eq 1 -->{L_127}<!-- ELSE -->{L_038}<!-- ENDIF -->:</b> {MINBID}<br>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_111}:</b> {STARTTIME}<br>\n\t\t\t\t\t\t\t\t<b>{L_112}:</b> {ENDTIME}<br>\n\t\t\t\t\t\t\t\t<b>{L_113}:</b> {ID}<br>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<b>{L_041}:</b> {CATSPATH}<br>\n<!-- IF SECCATSPATH ne '' -->\n\t\t\t\t\t\t\t\t<b>{L_814}:</b> {SECCATSPATH}\n<!-- ENDIF -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t<br>\n\t\t</div>\n\t</div>\n</div>\n", "<!-- IF B_COUNTDOWN -->\n<script type=\"text/javascript\">\n$(document).ready(function() {\n\tvar timeRemaining = {ENDS_IN};\n\tvar endDateTime = new Date();\n\tendDateTime.setSeconds(endDateTime.getSeconds() + timeRemaining);\n\tfunction padLength(what)\n\t{\n\t\tvar output = (what.toString().length == 1) ? '0' + what : what;\n\t\treturn output;\n\t}\n\tfunction displayTime() {\n\t\tvar currentDateTime = new Date();\n\n\t\tif (currentDateTime.getTime() < endDateTime.getTime()) {\n\t\t\tvar remainingTime = Math.floor((endDateTime.getTime() - currentDateTime.getTime()) / 1000);\n\t\t\tvar hours = Math.floor(remainingTime / 3600);\n\t\t\tvar mins = Math.floor((remainingTime - (hours * 3600)) / 60);\n\t\t\tvar secs = Math.floor(remainingTime - (hours * 3600) - (mins * 60));\n\n\t\t\tvar timeString = padLength(hours) + ':' + padLength(mins) + ':' + padLength(secs);\n\t\t\t$('#ending_counter').html(timeString);\n\t\t\tsetTimeout(displayTime, 1000);\n\t\t} else {\n\t\t\t$(\"#ending_counter\").html('<div class=\"error-box\">{L_911}</div>');\n\t\t}\n\t}\n\tsetTimeout(displayTime, 1000);\n});\n</script>\n<!-- ENDIF -->\n<div class=\"row\">\n\t<div class=\"col-md-12\">\n\t\t<ul class=\"breadcrumb\"><b>{L_041}:</b> {TOPCATSPATH}</ul>\n\t\t<div class=\"panel panel-default sm-padding\" style=\"text-align: right;\">\n\t\t\t{VIEW_HISTORY1}\n\t\t\t<a href=\"{SITEURL}friend.php?id={ID}\">{L_106}</a> |\n<!-- IF B_CANCONTACTSELLER -->\n\t\t\t<a href=\"{SITEURL}send_email.php?auction_id={ID}\">{L_922}</a> |\n<!-- ENDIF -->\n<!-- IF B_LOGGED_IN -->\n\t\t\t<a href=\"{SITEURL}item_watch.php?{WATCH_VAR}={ID}\">{WATCH_STRING}</a>\n<!-- ELSE -->\n\t\t\t<a href=\"{SITEURL}user_login.php?\">{L_5202}</a>\n<!-- ENDIF -->\n\t\t</div>\n<!-- IF B_USERBID -->\n\t\t<div class=\"alert alert-success\" role=\"alert\">\n\t\t\t{YOURBIDMSG}\n\t\t</div>\n<!-- ENDIF -->\n\t\t<div class=\"row grid-padding\">\n\t\t\t<div class=\"col-md-5 col-sm-5 grid-padding\">\n\t\t\t\t<div class=\"item-title visible-xs text-capitalize\">{TITLE}</div>\n<!-- IF B_HASIMAGE -->\n\t\t\t\t<div class=\"main-gallery panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><span class=\"label label-default\">{L_113}: {ID}</span></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<div class=\"col-md-12\">\n\t\t\t\t\t\t\t<img class=\"img-rounded img-responsive center-block\" src=\"{SITEURL}getthumb.php?w=430&fromfile={PIC_URL}&auction_id={ID}\" border=\"0\" align=\"center\" width=\"430px\">\n\t\t\t\t\t\t</div>\n\t<!-- IF B_HASGALELRY -->\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<a name=\"gallery\"></a>\n\t\t\t\t\t\t\t<div id=\"gallery\">\n\t\t<!-- BEGIN gallery -->\n\t\t\t\t\t\t\t\t<div class=\"col-md-4 col-xs-4 col-sm-4\">\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}{UPLOADEDPATH}{ID}/{gallery.V}\" title=\"\" data-lightbox=\"gallery\">\n\t\t\t\t\t\t\t\t\t<img class=\"img-rounded img-responsive\" src=\"{SITEURL}getthumb.php?w={THUMBWIDTH}&fromfile={gallery.V}&auction_id={ID}\" border=\"0\"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t<!-- END gallery -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t<!-- ENDIF -->\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-footer\">{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}</div>\n\t\t\t\t</div>\n<!-- ELSE -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><span class=\"label label-default\">{L_113}: {ID}</span></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<img class=\"thumbnail img-responsive center-block\" src=\"{SITEURL}/themes/{THEME}/img/no-picture-gallery.png\" alt=\"no picture\" width=\"430px\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-footer\">{L_611} <span style=\"color:#ff3300\"><b>{AUCTION_VIEWS}</b></span> {L_612}</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t</div>\n\t\t\t<div class=\"col-md-7 col-sm-7\">\n\t\t\t\t<div class=\"item-title hidden-xs text-capitalize\">{TITLE}</div>\n<!-- IF B_CANEDIT -->\n\t\t\t\t<a class=\"btn btn-primary btn-xs\" href=\"{SITEURL}edit_active_auction.php?id={ID}\">{L_30_0069}</a>\n<!-- ENDIF -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<table class=\"table table-bordered table-condensed table-striped\">\n\t\t\t\t\t\t<!-- auction type -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_261}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{AUCTION_TYPE}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<!-- higher bidder -->\n<!-- IF B_HASBUYER and B_NOTBNONLY -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width='30%' style=\"leftpan\" valign=\"top\">{L_117}: </td>\n\t\t\t\t\t\t\t<td>\n\t<!-- BEGIN high_bidders -->\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t<b>{high_bidders.BUYER_NAME}</b>\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={high_bidders.BUYER_ID}&amp;auction_id={ID}\"><b>{high_bidders.BUYER_NAME}</b></a>\n\t\t\t\t\t\t\t\t<b>(<a href=\"{SITEURL}feedback.php?id={high_bidders.BUYER_ID}&amp;faction=show\">{high_bidders.BUYER_FB}</a>)</b>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<img src=\"{SITEURL}images/icons/{high_bidders.BUYER_FB_ICON}\" alt=\"{high_bidders.BUYER_FB_ICON}\" class=\"fbstar\">\n\t<!-- END high_bidders -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_901}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{QTY}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_923}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{COUNTRY}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_118}: </td>\n\t\t\t\t\t\t\t<td align=\"left\" valign=\"top\">\n<!-- IF B_COUNTDOWN -->\n\t\t\t\t\t\t\t\t<span id=\"ending_counter\">{ENDS}</span>\n<!-- ELSE -->\n\t\t\t\t\t\t\t\t{ENDS}<!-- IF B_SHOWENDTIME --><br><span class=\"text-muted\"><small>({ENDTIME})</small></span><!-- ENDIF -->\n<!-- ENDIF -->\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_119}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{NUMBIDS} {VIEW_HISTORY2}</td>\n\t\t\t\t\t\t</tr>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">\n\t\t\t\t\t\t\t\t{L_038}:\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td align=\"left\">{MINBID}</td>\n\t\t\t\t\t\t</tr>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_116}: </td>\n\t\t\t\t\t\t\t<td align=\"left\" valign=\"middle\">{MAXBID}<!-- IF B_HASRESERVE -->&nbsp;<span class=\"text-muted\"><small>{L_514}<small></span><!-- ENDIF --></td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_023}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{SHIPPING_COST}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF (B_ADDITIONAL_SHIPPING_COST or B_BUY_NOW_ONLY) and B_SHOW_ADDITIONAL_SHIPPING_COST -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_350_1008}: </td>\n\t\t\t\t\t\t\t<td align=\"left\">{ADDITIONAL_SHIPPING_COST}</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_BUY_NOW -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width=\"30%\" align=\"left\">{L_496}:</td>\n\t\t\t\t\t\t\t<td align=\"left\">\n\t\t\t\t\t\t\t\t{BUYNOW2}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n<!-- IF B_HASENDED -->\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan=\"2\" align=\"left\"><b>{L_904}</b></td>\n\t\t\t\t\t\t</tr>\n<!-- ENDIF -->\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-7 col-sm-12\">\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\"><b>{L_30_0209}</b></div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<a href='{SITEURL}profile.php?user_id={SELLER_ID}&amp;auction_id={ID}'><b>{SELLER_NICK}</b></a>\n\t\t\t\t\t\t\t(<a href='{SITEURL}feedback.php?id={SELLER_ID}&amp;faction=show'>{SELLER_TOTALFB}</A>)\n\t\t\t\t\t\t\t<!-- IF SELLER_FB_ICON ne '' --><img src=\"{SITEURL}images/icons/{SELLER_FB_ICON}\" alt=\"{SELLER_FB_ICON}\" class=\"fbstar\"><!-- ENDIF -->\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<ul class=\"list-unstyled\">\n\t\t\t\t\t\t\t\t<li>{L_5509}{SELLER_NUMFB}{L__0151}\n\t\t\t\t\t\t\t\t<li><b>{L_5506}{SELLER_FBPOS}</b>\n<!-- IF SELLER_FBNEG ne 0 -->\n\t\t\t\t\t\t\t\t<li>{SELLER_FBNEG}</li>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t<li>{L_5508}{SELLER_REG}</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<a href=\"{SITEURL}active_auctions.php?user_id={SELLER_ID}\"><span class=\"glyphicon glyphicon-plus-sign\" aria-hidden=\"true\" style=\"padding-right: 5px;\"></span>{L_213}</a>\n\t\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t</div>\n<!-- IF B_HASENDED eq false and B_CAN_BUY -->\n\t\t\t\t\t\t<div class=\"well well-sm\">\n\t\t\t\t\t\t\t<div class=\"row\">\n\t<!-- IF B_NOTBNONLY -->\n\t\t\t\t\t\t\t\t<form name=\"bid\" action=\"{SITEURL}bid.php\" method=\"post\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3 col-md-offset-2\">\n\t\t<!-- IF QTY gt 1 -->\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"qty\" placeholder=\"{L_284}\"> {QTY} {L_5408}\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"bid\" placeholder=\"{L_121}\">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-5\">\n\t\t<!-- IF ATYPE eq 1 -->\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-warning md-padding\">{L_124}: {NEXTBID}</div><br>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"seller_id\" value=\"{SELLER_ID}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"title\" value=\"{TITLE}\" >\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"category\" value=\"{CAT_ID}\" >\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"{ID}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"csrftoken\" value=\"{_CSRFTOKEN}\">\n\t\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"\" value=\"{L_30_0208}\" class=\"form-control btn btn-primary\">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</form>\n\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t\t{BUYNOW} <a class=\"btn btn-success btn-block\" href=\"{SITEURL}buy_now.php?id={ID}\">{L_496}</a>\n\t\t\t\t\t\t\t\t</div>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n<!-- ENDIF -->\n<!-- IF B_CAN_BUY eq false -->\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-md-8 col-md-offset-2\">\n\t\t\t\t\t\t\t\t<div class=\"alert alert-warning\" role=\"alert\">\n\t\t\t\t\t\t\t\t\t<span class=\"pull-left\"><span class=\"glyphicon glyphicon-info-sign\" aria-hidden=\"true\"></span>  {L_5002}</span> <span class=\"pull-right\"><a class=\"btn btn-warning btn-xs\" href=\"{SITEURL}user_login.php?\" class=\"alert-link\">{L_221}</a></span>\n\t\t\t\t\t\t\t\t\t<div class=\"clearfix\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<a class=\"report-item pull-right\" href='{SITEURL}item_report.php?id={ID}'>{L_report_this_item}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"description\"></a>{L_018}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t{AUCTION_DESCRIPTION}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- IF B_HAS_QUESTIONS -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"questions\"></a>{L_552}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t<!-- BEGIN questions -->\n\t\t\t\t\t\t<span class=\"glyphicon glyphicon-comment\" aria-hidden=\"true\" style=\"padding-right: 10px;\"></span>\n\t\t\t\t\t\t<div class=\"well well-sm\">\n\t\t<!-- BEGIN conv -->\n\t\t\t\t\t\t\t<p><span class=\"text-muted\"><small>{questions.conv.BY_WHO}:</small></span> {questions.conv.MESSAGE}</p>\n\t\t<!-- END conv -->\n\t\t\t\t\t\t</div>\n\t<!-- END questions -->\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\">{L_724}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"tableContent2\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"table2\">\n<!-- IF CITY ne '' or COUNTRY ne '' or ZIP ne '' -->\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_014}:</b> <!-- IF CITY ne '' -->{CITY}<!-- ENDIF --> <!-- IF COUNTRY ne '' -->{COUNTRY}<!-- ENDIF --> <!-- IF ZIP ne '' -->({ZIP})<!-- ENDIF --><br>\n<!-- ENDIF -->\n<!-- IF B_SHIPPING -->\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_025}:</b> {SHIPPING}, {INTERNATIONAL}<br>\n<!-- ENDIF -->\n<!-- IF SHIPPINGTERMS ne '' -->\n\t\t\t\t\t\t\t\t\t\t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td valign=\"top\"><b>{L_25_0215}:</b>&nbsp;</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td valign=\"top\">{SHIPPINGTERMS}</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_026}:</b> {PAYMENTS}<br>\n<!-- IF ! B_BUY_NOW_ONLY -->\n\t\t\t\t\t\t\t\t\t\t\t<b><!-- IF ATYPE eq 1 -->{L_127}<!-- ELSE -->{L_038}<!-- ENDIF -->:</b> {MINBID}<br>\n<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_111}:</b> {STARTTIME}<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_112}:</b> {ENDTIME}<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_113}:</b> {ID}<br>\n\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t<b>{L_041}:</b> {CATSPATH}<br>\n\t\t\t\t\t\t\t\t\t\t\t<!-- IF SECCATSPATH ne '' --><b>{L_814}:</b> {SECCATSPATH}<!-- ENDIF -->\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- IF B_SHOWHISTORY -->\n\t\t\t\t<div class=\"panel panel-default\">\n\t\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t\t<h3 class=\"panel-title\"><a name=\"history\"></a>{L_26_0001}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<table class=\"table table-bordered table-striped table-condensed\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_176}</th>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_130}</th>\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_175}</th>\n\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t<th width=\"33%\" align=\"center\">{L_284}</th>\n\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</tr>\n\t<!-- BEGIN bidhistory -->\n\t\t\t\t\t\t\t<tr valign=\"top\" {bidhistory.BGCOLOUR}>\n\t\t\t\t\t\t\t\t<td>\n\t\t<!-- IF B_BIDDERPRIV -->\n\t\t\t\t\t\t\t\t\t{bidhistory.NAME}\n\t\t<!-- ELSE -->\n\t\t\t\t\t\t\t\t\t<a href=\"{SITEURL}profile.php?user_id={bidhistory.ID}\">{bidhistory.NAME}</a>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.BID}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.WHEN}\n\t\t\t\t\t\t\t\t</td>\n\t\t<!-- IF ATYPE eq 2 -->\n\t\t\t\t\t\t\t\t<td align=\"center\">\n\t\t\t\t\t\t\t\t\t{bidhistory.QTY}\n\t\t\t\t\t\t\t\t</td>\n\t\t<!-- ENDIF -->\n\t\t\t\t\t\t\t</tr>\n\t<!-- END bidhistory -->\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n<!-- ENDIF -->\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ndefine('AtLogin', 1);\ninclude 'common.php';\n\nif (isset($_SESSION['LOGIN_MESSAGE'])) {\n    $ERR = $_SESSION['LOGIN_MESSAGE'];\n    unset($_SESSION['LOGIN_MESSAGE']);\n}\n\nif (isset($_POST['action']) && isset($_POST['username']) && isset($_POST['password'])) {\n    include PACKAGE_PATH . 'PasswordHash.php';\n    $phpass = new PasswordHash(8, false);\n    $query = \"SELECT id, hash, suspended, password, password_type FROM \" . $DBPrefix . \"users WHERE nick = :nick OR email = :email\";\n    $params = array();\n    $params[] = array(':nick', $system->cleanvars($_POST['username']), 'str');\n    $params[] = array(':email', $system->cleanvars($_POST['username']), 'str');\n    $db->query($query, $params);\n    $user_data = $db->result();\n\n    if ($user_data['password_type'] == 0 && $user_data['password'] == md5($MD5_PREFIX . $_POST['password'])) {\n        $query = \"UPDATE \" . $DBPrefix . \"users SET password = :password, password_type = 1 WHERE id = :user_id\";\n        $params = array();\n        $params[] = array(':password', $phpass->HashPassword($_POST['password']), 'int');\n        $params[] = array(':user_id', $user_data['id'], 'int');\n        $db->query($query, $params);\n\n        $query = \"SELECT id, hash, suspended, password, password_type FROM \" . $DBPrefix . \"users WHERE nick = :nick OR email = :email\";\n        $params = array();\n        $params[] = array(':nick', $system->cleanvars($_POST['username']), 'str');\n        $params[] = array(':email', $system->cleanvars($_POST['username']), 'str');\n        $db->query($query, $params);\n        $user_data = $db->result();\n    }\n\n    if ($phpass->CheckPassword($_POST['password'], $user_data['password'])) {\n        // generate a random unguessable token\n        $_SESSION['csrftoken'] = md5(uniqid(rand(), true));\n\n        if ($user_data['suspended'] == 9) {\n            $_SESSION['signup_id'] = $user_data['id'];\n            header('location: pay.php?a=3');\n            exit;\n        }\n\n        if ($user_data['suspended'] == 1) {\n            $ERR = $ERR_618;\n        } elseif ($user_data['suspended'] == 8) {\n            $ERR = $ERR_620;\n        } elseif ($user_data['suspended'] == 10) {\n            $ERR = $ERR_621;\n        } else {\n            $_SESSION['WEBID_LOGGED_IN']        = $user_data['id'];\n            $_SESSION['WEBID_LOGGED_NUMBER']    = strspn($user_data['password'], $user_data['hash']);\n            $_SESSION['WEBID_LOGGED_PASS']        = $user_data['password'];\n            // Update \"last login\" fields in users table\n            $query = \"UPDATE \" . $DBPrefix . \"users SET lastlogin = CURRENT_TIMESTAMP WHERE id = :user_id\";\n            $params = array();\n            $params[] = array(':user_id', $user_data['id'], 'int');\n            $db->query($query, $params);\n            // Remember me option\n            if (isset($_POST['rememberme'])) {\n                $remember_key = md5(time());\n                $query = \"INSERT INTO \" . $DBPrefix . \"rememberme VALUES (:user_id, :remember_key)\";\n                $params = array();\n                $params[] = array(':remember_key', $remember_key, 'str');\n                $params[] = array(':user_id', $user_data['id'], 'int');\n                $db->query($query, $params);\n                setcookie('WEBID_RM_ID', $remember_key, time() + (3600 * 24 * 365));\n            }\n            $query = \"SELECT id FROM \" . $DBPrefix . \"usersips WHERE USER = :user_id AND ip = :user_ip\";\n            $params = array();\n            $params[] = array(':user_ip', $_SERVER['REMOTE_ADDR'], 'str');\n            $params[] = array(':user_id', $user_data['id'], 'int');\n            $db->query($query, $params);\n            if ($db->numrows() == 0) {\n                $query = \"INSERT INTO \" . $DBPrefix . \"usersips (user, ip, type, action)\n\t\t\t\t\t\tVALUES (:user_id, :user_ip, 'login', 'accept')\";\n                $params = array();\n                $params[] = array(':user_ip', $_SERVER['REMOTE_ADDR'], 'str');\n                $params[] = array(':user_id', $user_data['id'], 'int');\n                $db->query($query, $params);\n            }\n\n            // delete your old session\n            if (isset($_COOKIE['WEBID_ONLINE'])) {\n                $query = \"DELETE from \" . $DBPrefix . \"online WHERE SESSION = :SESSION\";\n                $params = array();\n                $params[] = array(':SESSION', alphanumeric($_COOKIE['WEBID_ONLINE']), 'str');\n                $db->query($query, $params);\n            }\n\n            if (in_array($user_data['suspended'], array(5, 6, 7))) {\n                header('location: message.php');\n                exit;\n            }\n\n            if (isset($_SESSION['REDIRECT_AFTER_LOGIN'])) {\n                $URL = str_replace('\\r', '', str_replace('\\n', '', $_SESSION['REDIRECT_AFTER_LOGIN']));\n                unset($_SESSION['REDIRECT_AFTER_LOGIN']);\n            } else {\n                $URL = 'user_menu.php';\n            }\n\n            header('location: ' . $URL);\n            exit;\n        }\n    } else {\n        $ERR = $ERR_038;\n    }\n}\n\n$template->assign_vars(array(\n        'ERROR' => (isset($ERR)) ? $ERR : '',\n        'USER' => (isset($_POST['username'])) ? $system->cleanvars($_POST['username']) : ''\n        ));\n\ninclude 'header.php';\n$template->set_filenames(array(\n        'body' => 'user_login.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        $removed = 0;\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            // Delete auction views\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            // Auction\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n\n    if (isset($_POST['closenow']) && is_array($_POST['closenow']) && count($_POST['closenow']) > 0) {\n        foreach ($_POST['closenow'] as $k => $v) {\n            // Update end time to the current time\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET ends = CURRENT_TIMESTAMP, relist = relisted WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        include 'cron.php';\n        $user_message .= sprintf($MSG['1149'], count($_POST['closenow']));\n    }\n}\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) AS COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id AND closed = 0 AND starts <= CURRENT_TIMESTAMP AND suspended = 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] <= 1 || $_GET['PAGE'] == '') {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n\n// Handle columns sorting variables\nif (!isset($_SESSION['oa_ord']) && empty($_GET['oa_ord'])) {\n    $_SESSION['oa_ord'] = 'title';\n    $_SESSION['oa_type'] = 'asc';\n} elseif (!empty($_GET['oa_ord'])) {\n\t// check oa_ord && oa_type are valid\n    $_SESSION['oa_ord'] = (in_array($_GET['oa_ord'], array('title', 'starts', 'ends', 'num_bids', 'current_bid'))) ? $_GET['oa_ord'] : 'title';\n    $_SESSION['oa_type'] = (in_array($_GET['oa_type'], array('asc', 'desc'))) ? $_GET['oa_type'] : 'asc';\n} elseif (isset($_SESSION['oa_ord']) && empty($_GET['oa_ord'])) {\n    $_SESSION['oa_nexttype'] = $_SESSION['oa_type'];\n}\nif (!isset($_SESSION['oa_nexttype']) || $_SESSION['oa_nexttype'] == 'desc') {\n    $_SESSION['oa_nexttype'] = 'asc';\n} else {\n    $_SESSION['oa_nexttype'] = 'desc';\n}\nif (!isset($_SESSION['oa_type']) || $_SESSION['oa_type'] == 'desc') {\n    $_SESSION['oa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['oa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id AND closed = 0\n\tAND starts <= CURRENT_TIMESTAMP AND suspended = 0\n\tORDER BY \" . $_SESSION['oa_ord'] . \" \" . $_SESSION['oa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    if ($item['num_bids'] > 0) {\n        $query = \"SELECT bid FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id ORDER BY bid DESC, id DESC LIMIT 1\";\n        $params = array();\n        $params[] = array(':auc_id', $item['id'], 'int');\n        $db->query($query, $params);\n        if ($db->numrows() > 0) {\n            $high_bid = $db->result('bid');\n        }\n    }\n    // Retrieve counter\n    $query = \"SELECT counter FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n    $params = array();\n    $params[] = array(':auc_id', $item['id'], 'int');\n    $db->query($query, $params);\n    if ($db->numrows() > 0) {\n        $viewcounter = $db->result('counter');\n    } else {\n        $viewcounter = 0;\n    }\n\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n            'RELIST' => $item['relist'],\n            'RELISTED' => $item['relisted'],\n            'COUNTER' => $viewcounter,\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['oa_ord'],\n        'ORDERNEXT' => $_SESSION['oa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['oa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['619'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->logged_in) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_c.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n// DELETE OPEN AUCTIONS\n$catscontrol = new MPTTcategories();\n$user_message = '';\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'relist_fee'\";\n$db->direct_query($query);\n$relist_fee = $db->result('value');\n\n// Update\nif (isset($_POST['action']) && $_POST['action'] == 'update') {\n    // Delete auction\n    if (isset($_POST['delete']) && is_array($_POST['delete']) && count($_POST['delete']) > 0) {\n        foreach ($_POST['delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET closedauctions = closedauctions - 1\";\n            $db->direct_query($query);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        $user_message .= sprintf($MSG['1145'], count($_POST['delete']));\n    }\n    if (isset($_POST['sell']) && is_array($_POST['sell']) && count($_POST['sell']) > 0) {\n        foreach ($_POST['sell'] as $v) {\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET sold = 's' WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        include 'cron.php';\n        $user_message .= sprintf($MSG['1147'], count($_POST['sell']));\n    }\n    // Re-list auctions\n    if (isset($_POST['relist']) && is_array($_POST['relist']) && count($_POST['relist']) > 0) {\n        foreach ($_POST['relist'] as $k) {\n            $k = intval($k);\n            $query = \"SELECT duration, category, quantity FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n            $suspend = 0;\n\n            if ($system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees'] && $relist_fee > 0) {\n                if ($system->SETTINGS['fee_type'] == 1) {\n                    // charge relist fee\n                    $query = \"UPDATE \" . $DBPrefix . \"users SET balance = balance - :relist_fee WHERE id = :user_id\";\n                    $params = array();\n                    $params[] = array(':relist_fee', $relist_fee, 'float');\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $db->query($query, $params);\n                } else {\n                    $suspend = 8;\n                }\n            }\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($AUCTION['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions\n                      SET starts = CURRENT_TIMESTAMP,\n                      ends = :ends,\n                      closed = 0,\n                      num_bids = 0,\n                      relisted = relisted + 1,\n                      current_bid = 0,\n                      sold = 'n',\n                      suspended = :suspended\n                      WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':suspended', $suspend, 'int');\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // delete bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Proxy Bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Winners: only in case of reserve not reached\n            $query = \"DELETE FROM \" . $DBPrefix . \"winners WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Update COUNTERS table\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = auctions + 1\";\n            $db->direct_query($query);\n\n            // get category data to update it\n            $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n            $params = array();\n            $params[] = array(':cat_id', $AUCTION['category'], 'int');\n            $db->query($query, $params);\n\n            $parent_node = $db->result();\n            $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n            // update recursive categories\n            for ($i = 0; $i < count($crumbs); $i++) {\n                $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                $db->query($query, $params);\n            }\n            if ($system->SETTINGS['fee_type'] == 2 && isset($relist_fee) && $relist_fee > 0) {\n                header('location: pay.php?a=5');\n                exit;\n            }\n        }\n        $user_message .= sprintf($MSG['1146'], count($_POST['relist']));\n        if ($relist_fee > 0) {\n            $user_message .= sprintf($MSG['1148'], $system->print_money((count($_POST['relist']) * $relist_fee), true, false));\n        }\n    }\n}\n\n// Retrieve closed auction data from the database\n$query = \"SELECT COUNT(id) AS COUNT FROM \" . $DBPrefix . \"auctions\n          WHERE user = :user_id\n          AND closed = 1 AND suspended = 0\n          AND (num_bids = 0 OR (num_bids > 0 AND current_bid < reserve_price AND sold = 'n'))\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] == 1) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['ca_ord']) && empty($_GET['ca_ord'])) {\n    $_SESSION['ca_ord'] = 'title';\n    $_SESSION['ca_type'] = 'asc';\n} elseif (!empty($_GET['ca_ord'])) {\n\t// check oa_ord && oa_type are valid\n    $_SESSION['ca_ord'] = (in_array($_GET['ca_ord'], array('title', 'starts', 'ends', 'num_bids', 'current_bid'))) ? $_GET['ca_ord'] : 'title';\n    $_SESSION['ca_type'] = (in_array($_GET['ca_type'], array('asc', 'desc'))) ? $_GET['ca_type'] : 'asc';\n} elseif (isset($_SESSION['ca_ord']) && empty($_GET['ca_ord'])) {\n    $_SESSION['ca_nexttype'] = $_SESSION['ca_type'];\n}\n\nif (!isset($_SESSION['ca_nexttype']) || $_SESSION['ca_nexttype'] == 'desc') {\n    $_SESSION['ca_nexttype'] = 'asc';\n} else {\n    $_SESSION['ca_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['ca_type']) || $_SESSION['ca_type'] == 'desc') {\n    $_SESSION['ca_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\">';\n} else {\n    $_SESSION['ca_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\">';\n}\n\n$query = \"SELECT *  FROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id\n\tAND closed = 1 AND suspended = 0\n\tAND (num_bids = 0 OR (num_bids > 0 AND reserve_price > 0 AND current_bid < reserve_price AND sold = 'n'))\n\tORDER BY \" . $_SESSION['ca_ord'] . \" \" . $_SESSION['ca_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $canrelist = false;\n    if (($item['current_bid'] > $item['reserve_price'])) {\n        $cansell = false;\n    } else {\n        if ($item['reserve_price'] > 0 || $item['num_bids'] == 0) {\n            $canrelist = true;\n        }\n        if ($item['reserve_price'] > 0 && $item['num_bids'] > 0) {\n            $cansell = true;\n        } else {\n            $cansell = false;\n        }\n    }\n\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => ($item['current_bid'] == 0) ? '-' : $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n\n            'B_CANRELIST' => $canrelist,\n            'B_CANSSELL' => $cansell,\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n\n    $i++;\n}\n\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['ca_ord'],\n        'ORDERNEXT' => $_SESSION['ca_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['ca_type_img'],\n        'RELIST_FEE' => $system->print_money($relist_fee),\n        'RELIST_FEE_NO' => $system->print_money_nosymbol($relist_fee),\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_c.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0),\n        'B_RELIST_FEE' => ($relist_fee > 0 && $system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees']),\n        'B_AUTORELIST' => ($system->SETTINGS['autorelist'] == 'y')\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['204'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_c.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_p.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        $removed = 0;\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auccounter WHERE auction_id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n\n    if (isset($_POST['startnow']) && is_array($_POST['startnow']) && count($_POST['startnow']) > 0) {\n        foreach ($_POST['startnow'] as $k => $v) {\n            $query = \"SELECT duration FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n\n            $aucdata = $db->result();\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($aucdata['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            // Update end time to \"now\"\n            $query = \"UPDATE \" . $DBPrefix . \"auctions SET starts = CURRENT_TIMESTAMP, ends = :ends WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n        }\n        $user_message .= sprintf($MSG['1150'], count($_POST['closenow']));\n    }\n}\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) AS COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id and starts > CURRENT_TIMESTAMP AND suspended = 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['pa_ord']) && empty($_GET['pa_ord'])) {\n    $_SESSION['pa_ord'] = 'title';\n    $_SESSION['pa_type'] = 'asc';\n} elseif (!empty($_GET['pa_ord'])) {\n\t// check oa_ord && oa_type are valid\n    $_SESSION['pa_ord'] = (in_array($_GET['pa_ord'], array('title', 'starts', 'ends'))) ? $_GET['pa_ord'] : 'title';\n    $_SESSION['pa_type'] = (in_array($_GET['pa_type'], array('asc', 'desc'))) ? $_GET['pa_type'] : 'asc';\n} elseif (isset($_SESSION['pa_ord']) && empty($_GET['pa_ord'])) {\n    $_SESSION['pa_nexttype'] = $_SESSION['pa_type'];\n}\n\nif (!isset($_SESSION['pa_nexttype']) || $_SESSION['pa_nexttype'] == 'desc') {\n    $_SESSION['pa_nexttype'] = 'asc';\n} else {\n    $_SESSION['pa_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['pa_type']) || $_SESSION['pa_type'] == 'desc') {\n    $_SESSION['pa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['pa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n$query = \"SELECT * FROM \" . $DBPrefix . \"auctions au\n\tWHERE user = :user_id AND starts > CURRENT_TIMESTAMP AND suspended = 0\n\tORDER BY \" . $_SESSION['pa_ord'] . \" \" . $_SESSION['pa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['pa_ord'],\n        'ORDERNEXT' => $_SESSION['pa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['pa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_p.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['25_0115'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_p.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n$user_message = '';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_s.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n// DELETE OR CLOSE OPEN AUCTIONS\nif (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {\n    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {\n        foreach ($_POST['O_delete'] as $k => $v) {\n            $removed = 0;\n            $v = intval($v);\n            // Pictures Gallery\n            if (is_dir(UPLOAD_PATH . $v)) {\n                if ($dir = opendir(UPLOAD_PATH . $v)) {\n                    while ($file = readdir($dir)) {\n                        if ($file != '.' && $file != '..') {\n                            @unlink(UPLOAD_PATH . $v . '/' . $file);\n                        }\n                    }\n                    closedir($dir);\n                    rmdir(UPLOAD_PATH . $v);\n                }\n            }\n\n            // remove auction\n            $query = \"DELETE FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $v, 'int');\n            $db->query($query, $params);\n            $removed++;\n        }\n\n        $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = (auctions - :removed)\";\n        $params = array();\n        $params[] = array(':removed', $removed, 'int');\n        $db->query($query, $params);\n        $user_message .= sprintf($MSG['1145'], count($_POST['O_delete']));\n    }\n}\n\n// Retrieve active auctions from the database\n$query = \"SELECT count(id) as COUNT FROM \" . $DBPrefix . \"auctions WHERE user = :user_id AND suspended != 0\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n// Handle columns sorting variables\nif (!isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {\n    $_SESSION['sa_ord'] = 'title';\n    $_SESSION['sa_type'] = 'asc';\n} elseif (!empty($_GET['sa_ord'])) {\n\t// check oa_ord && oa_type are valid\n    $_SESSION['sa_ord'] = (in_array($_GET['sa_ord'], array('title', 'num_bids', 'current_bid'))) ? $_GET['sa_ord'] : 'title';\n    $_SESSION['sa_type'] = (in_array($_GET['sa_type'], array('asc', 'desc'))) ? $_GET['sa_type'] : 'asc';\n} elseif (isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {\n    $_SESSION['sa_nexttype'] = $_SESSION['sa_type'];\n}\n\nif (!isset($_SESSION['sa_nexttype']) || $_SESSION['sa_nexttype'] == 'desc') {\n    $_SESSION['sa_nexttype'] = 'asc';\n} else {\n    $_SESSION['sa_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['sa_type']) || $_SESSION['sa_type'] == 'desc') {\n    $_SESSION['sa_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n} else {\n    $_SESSION['sa_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" />';\n}\n$query = \"SELECT id, title, current_bid, num_bids, relist, relisted, current_bid, suspended\n\tFROM \" . $DBPrefix . \"auctions\n\tWHERE user = :user_id\n\tAND suspended != 0\n\tORDER BY \" . $_SESSION['sa_ord'] . \" \" . $_SESSION['sa_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'BID' => $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n            'RELIST' => $item['relist'],\n            'RELISTED' => $item['relisted'],\n            'SUSPENDED' => $item['suspended'],\n\n            'B_HASNOBIDS' => ($item['current_bid'] == 0)\n            ));\n    $i++;\n}\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $COUNTER . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n        'ORDERCOL' => $_SESSION['sa_ord'],\n        'ORDERNEXT' => $_SESSION['sa_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['sa_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $PREV . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $NEXT . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES,\n\n        'B_AREITEMS' => ($i > 0)\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['2__0056'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_s.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n", "<?php\n/***************************************************************************\n *   copyright\t\t\t\t: (C) 2008 - 2017 WeBid\n *   site\t\t\t\t\t: http://www.webidsupport.com/\n ***************************************************************************/\n\n/***************************************************************************\n *   This program is free software; you can redistribute it and/or modify\n *   it under the terms of the GNU General Public License as published by\n *   the Free Software Foundation; either version 2 of the License, or\n *   (at your option) any later version. Although none of the code may be\n *   sold. If you have been sold this script, get a refund.\n ***************************************************************************/\n\ninclude 'common.php';\n\n// If user is not logged in redirect to login page\nif (!$user->checkAuth()) {\n    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];\n    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_sold.php';\n    header('location: user_login.php');\n    exit;\n}\n// check if the user can access this page\n$user->checkSuspended();\n\n$user_message = '';\n\n$query = \"SELECT value FROM \" . $DBPrefix . \"fees WHERE type = 'relist_fee'\";\n$db->direct_query($query);\n$relist_fee = $db->result('value');\n\n// Update\nif (isset($_POST['action']) && $_POST['action'] == 'update') {\n    // Re-list auctions\n    if (isset($_POST['relist']) && is_array($_POST['relist']) && count($_POST['relist']) > 0) {\n        foreach ($_POST['relist'] as $k) {\n            $k = intval($k);\n            $query = \"SELECT duration, category FROM \" . $DBPrefix . \"auctions WHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n            $AUCTION = $db->result();\n            $suspend = 0;\n\n            if ($system->SETTINGS['fees'] == 'y' && !$user->permissions['no_fees'] && $relist_fee > 0) {\n                if ($system->SETTINGS['fee_type'] == 1) {\n                    // charge relist fee\n                    $query = \"UPDATE \" . $DBPrefix . \"users SET balance = balance - :relist_fee WHERE id = :user_id\";\n                    $params = array();\n                    $params[] = array(':relist_fee', $relist_fee, 'float');\n                    $params[] = array(':user_id', $user->user_data['id'], 'int');\n                    $db->query($query, $params);\n                } else {\n                    $suspend = 8;\n                }\n            }\n\n            // auction ends\n            $start_date = new DateTime('now', $dt->UTCtimezone);\n            $start_date->add(new DateInterval('P' . intval($AUCTION['duration']) . 'D'));\n            $auction_ends = $start_date->format('Y-m-d H:i:s');\n\n            $query = \"UPDATE \" . $DBPrefix . \"auctions\n\t\t\t\t\tSET starts = CURRENT_TIMESTAMP,\n\t\t\t\t\tends = :ends,\n\t\t\t\t\tclosed = 0,\n\t\t\t\t\tnum_bids = 0,\n\t\t\t\t\trelisted = relisted + 1,\n\t\t\t\t\tcurrent_bid = 0,\n\t\t\t\t\tsold = 'n',\n\t\t\t\t\tsuspended = :suspended\n\t\t\t\t\tWHERE id = :auc_id\";\n            $params = array();\n            $params[] = array(':ends', $auction_ends, 'str');\n            $params[] = array(':suspended', $suspend, 'int');\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // delete bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"bids WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Proxy Bids\n            $query = \"DELETE FROM \" . $DBPrefix . \"proxybid WHERE itemid = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Winners: only in case of reserve not reached\n            $query = \"DELETE FROM \" . $DBPrefix . \"winners WHERE auction = :auc_id\";\n            $params = array();\n            $params[] = array(':auc_id', $k, 'int');\n            $db->query($query, $params);\n\n            // Update COUNTERS table\n            $query = \"UPDATE \" . $DBPrefix . \"counters SET auctions = auctions + 1\";\n            $db->direct_query($query);\n\n            // get category data to update it\n            $query = \"SELECT left_id, right_id, level FROM \" . $DBPrefix . \"categories WHERE cat_id = :cat_id\";\n            $params = array();\n            $params[] = array(':cat_id', $AUCTION['category'], 'int');\n            $db->query($query, $params);\n\n            $parent_node = $db->result();\n            $crumbs = $catscontrol->get_bread_crumbs($parent_node['left_id'], $parent_node['right_id']);\n            // update recursive categories\n            for ($i = 0; $i < count($crumbs); $i++) {\n                $query = \"UPDATE \" . $DBPrefix . \"categories SET sub_counter = sub_counter + 1 WHERE cat_id = :cat_id\";\n                $params = array();\n                $params[] = array(':cat_id', $crumbs[$i]['cat_id'], 'int');\n                $db->query($query, $params);\n            }\n            if ($system->SETTINGS['fee_type'] == 2 && isset($relist_fee) && $relist_fee > 0) {\n                header('location: pay.php?a=5');\n                exit;\n            }\n        }\n        $user_message .= sprintf($MSG['1146'], count($_POST['relist']));\n        if ($relist_fee > 0) {\n            $user_message .= sprintf($MSG['1148'], $system->print_money(count($_POST['relist']) * $relist_fee));\n        }\n    }\n}\n\n// Retrieve sold auction data from the database\n$query = \"SELECT COUNT(a.id) AS COUNT FROM \" . $DBPrefix . \"auctions a, \" . $DBPrefix . \"winners w\n\t\tWHERE a.user = :user_id AND a.closed = 1 AND a.suspended = 0 AND a.id = w.auction GROUP BY w.auction\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$db->query($query, $params);\n$TOTALAUCTIONS = $db->result('COUNT');\n\nif (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {\n    $OFFSET = 0;\n    $PAGE = 1;\n} else {\n    $PAGE = intval($_GET['PAGE']);\n    $OFFSET = ($PAGE - 1) * $system->SETTINGS['perpage'];\n}\n\n$PAGES = ($TOTALAUCTIONS == 0) ? 1 : ceil($TOTALAUCTIONS / $system->SETTINGS['perpage']);\n\n// Handle columns sorting variables\nif (!isset($_SESSION['solda_ord']) && empty($_GET['solda_ord'])) {\n    $_SESSION['solda_ord'] = 'title';\n    $_SESSION['solda_type'] = 'asc';\n} elseif (!empty($_GET['solda_ord'])) {\n\t// check oa_ord && oa_type are valid\n    $_SESSION['solda_ord'] = (in_array($_GET['solda_ord'], array('title', 'starts', 'ends', 'num_bids', 'current_bid'))) ? $_GET['solda_ord'] : 'title';\n    $_SESSION['solda_type'] = (in_array($_GET['solda_type'], array('asc', 'desc'))) ? $_GET['solda_type'] : 'asc';\n} elseif (isset($_SESSION['solda_ord']) && empty($_GET['solda_ord'])) {\n    $_SESSION['solda_nexttype'] = $_SESSION['solda_type'];\n}\n\nif (!isset($_SESSION['solda_nexttype']) || $_SESSION['solda_nexttype'] == 'desc') {\n    $_SESSION['solda_nexttype'] = 'asc';\n} else {\n    $_SESSION['solda_nexttype'] = 'desc';\n}\n\nif (!isset($_SESSION['solda_type']) || $_SESSION['solda_type'] == 'desc') {\n    $_SESSION['solda_type_img'] = '<img src=\"images/arrow_up.gif\" align=\"center\" hspace=\"2\" border=\"0\" alt=\"up\"/>';\n} else {\n    $_SESSION['solda_type_img'] = '<img src=\"images/arrow_down.gif\" align=\"center\" hspace=\"2\" border=\"0\" alt=\"down\"/>';\n}\n\n$query = \"SELECT a.* FROM \" . $DBPrefix . \"auctions a\n\tLEFT JOIN \" . $DBPrefix . \"winners w ON (a.id = w.auction)\n\tWHERE a.user = :user_id\n\tAND a.closed = 1\n\tAND a.suspended = 0\n\tGROUP BY a.id\n\tORDER BY \" . $_SESSION['solda_ord'] . \" \" . $_SESSION['solda_type'] . \" LIMIT :offset, :perpage\";\n$params = array();\n$params[] = array(':user_id', $user->user_data['id'], 'int');\n$params[] = array(':offset', $OFFSET, 'int');\n$params[] = array(':perpage', $system->SETTINGS['perpage'], 'int');\n$db->query($query, $params);\n\n$i = 0;\nwhile ($item = $db->fetch()) {\n    $template->assign_block_vars('items', array(\n            'BGCOLOUR' => (!($i % 2)) ? '' : 'class=\"alt-row\"',\n            'ID' => $item['id'],\n            'TITLE' => htmlspecialchars($item['title']),\n            'STARTS' => $dt->formatDate($item['starts']),\n            'ENDS' => $dt->formatDate($item['ends']),\n            'BID' => ($item['current_bid'] == 0) ? '-' : $system->print_money($item['current_bid']),\n            'BIDS' => $item['num_bids'],\n\n            'B_CLOSED' => ($item['closed']),\n            'B_HASNOBIDS' => ($item['current_bid'] == 0),\n            'B_BUY_NOW_ONLY' => ($item['bn_only']),\n            'B_BUY_NOW' => ($item['bn_sale'] == 1),\n            'B_DUTCH' => ($item['auction_type'] == 2)\n            ));\n    $i++;\n}\n\n// get pagenation\n$PREV = intval($PAGE - 1);\n$NEXT = intval($PAGE + 1);\nif ($PAGES > 1) {\n    $LOW = $PAGE - 5;\n    if ($LOW <= 0) {\n        $LOW = 1;\n    }\n    $COUNTER = $LOW;\n    while ($COUNTER <= $PAGES && $COUNTER < ($PAGE + 6)) {\n        $template->assign_block_vars('pages', array(\n                'PAGE' => ($PAGE == $COUNTER) ? '<b>' . $COUNTER . '</b>' : '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $COUNTER . '&id=' . $id . '\"><u>' . $COUNTER . '</u></a>'\n                ));\n        $COUNTER++;\n    }\n}\n\n$template->assign_vars(array(\n        'ORDERCOL' => $_SESSION['solda_ord'],\n        'ORDERNEXT' => $_SESSION['solda_nexttype'],\n        'ORDERTYPEIMG' => $_SESSION['solda_type_img'],\n        'USER_MESSAGE' => $user_message,\n\n        'PREV' => ($PAGES > 1 && $PAGE > 1) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $PREV . '&id=' . $id . '\"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',\n        'NEXT' => ($PAGE < $PAGES) ? '<a href=\"' . $system->SETTINGS['siteurl'] . 'yourauctions_sold.php?PAGE=' . $NEXT . '&id=' . $id . '\"><u>' . $MSG['5120'] . '</u></a>' : '',\n        'PAGE' => $PAGE,\n        'PAGES' => $PAGES\n        ));\n\ninclude 'header.php';\n$TMP_usmenutitle = $MSG['25_0119'];\ninclude INCLUDE_PATH . 'user_cp.php';\n$template->set_filenames(array(\n        'body' => 'yourauctions_sold.tpl'\n        ));\n$template->display('body');\ninclude 'footer.php';\n"], "filenames": ["active_auctions.php", "admin/editauction.php", "bid.php", "closed_auctions.php", "getthumb.php", "includes/browseitems.inc.php", "includes/functions_sell.php", "index.php", "item.php", "register.php", "themes/adminClassic/editauction.tpl", "themes/adminModern/editauction.tpl", "themes/classic/item.tpl", "themes/modern/item.tpl", "user_login.php", "yourauctions.php", "yourauctions_c.php", "yourauctions_p.php", "yourauctions_s.php", "yourauctions_sold.php"], "buggy_code_start_loc": [69, 39, 564, 68, 16, 119, 401, 107, 469, 451, 74, 74, 84, 60, 127, 102, 207, 112, 84, 152], "buggy_code_end_loc": [70, 40, 565, 69, 162, 120, 402, 192, 470, 460, 75, 75, 312, 70, 128, 104, 209, 114, 86, 154], "fixing_code_start_loc": [69, 39, 564, 68, 17, 119, 401, 107, 469, 451, 74, 74, 84, 60, 127, 102, 207, 112, 84, 152], "fixing_code_end_loc": [70, 40, 565, 69, 175, 120, 402, 192, 470, 460, 75, 75, 312, 70, 128, 105, 210, 115, 87, 155], "type": "CWE-79", "message": "WeBid version up to current version 1.2.2 contains a Cross Site Scripting (XSS) vulnerability in user_login.php, register.php that can result in Javascript execution in the user's browser, injection of malicious markup into the page. This attack appear to be exploitable via The victim user must click a malicous link. This vulnerability appears to have been fixed in after commit 256a5f9d3eafbc477dcf77c7682446cc4b449c7f.", "other": {"cve": {"id": "CVE-2018-1000868", "sourceIdentifier": "cve@mitre.org", "published": "2018-12-20T17:29:00.643", "lastModified": "2019-01-07T20:54:54.237", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "WeBid version up to current version 1.2.2 contains a Cross Site Scripting (XSS) vulnerability in user_login.php, register.php that can result in Javascript execution in the user's browser, injection of malicious markup into the page. This attack appear to be exploitable via The victim user must click a malicous link. This vulnerability appears to have been fixed in after commit 256a5f9d3eafbc477dcf77c7682446cc4b449c7f."}, {"lang": "es", "value": "WeBid, hasta la actual versi\u00f3n 1.2.2, contiene una vulnerabilidad Cross-Site Scripting (XSS) en user_login.php y register.php que puede resultar en la ejecuci\u00f3n de JavaScript en el navegador del usuario o la inyecci\u00f3n de marcas maliciosas en la p\u00e1gina. El ataque parece ser explotable mediante una v\u00edctima que haga clic en un enlace malicioso. La vulnerabilidad parece haber sido solucionada tras el commit con ID 256a5f9d3eafbc477dcf77c7682446cc4b449c7f."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:webidsupport:webid:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.2.2", "matchCriteriaId": "9EAC0F5C-741F-49B1-B5E0-DE5CF6E1303B"}]}]}], "references": [{"url": "http://bugs.webidsupport.com/view.php?id=648", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Release Notes", "Vendor Advisory"]}, {"url": "https://github.com/renlok/WeBid/commit/256a5f9d3eafbc477dcf77c7682446cc4b449c7f", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://telekomsecurity.github.io/assets/advisories/20181108_WeBid_Multiple_Vulnerabilities.txt", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/renlok/WeBid/commit/256a5f9d3eafbc477dcf77c7682446cc4b449c7f"}}