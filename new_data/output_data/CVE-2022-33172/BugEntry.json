{"buggy_code": ["# de.fac2 - FIDO U2F Authenticator Applet v1.34\n\n*de.fac2* is a Javacard applet which implements a Fido U2F token. It was designed and implemented based on the Common Criteria Protection Profile [BSI-CC-PP-0096-V3-2018 \"FIDO Universal Second Factor (U2F) Authenticator Version 3\"](https://www.bsi.bund.de/SharedDocs/Zertifikate_CC/PP/aktuell/PP_0096_0096V2_0096V3.html).\n\n![Urkunde](https://github.com/tsenger/de.fac2/blob/master/docs/CC/1060_de.fac2_Urkunde_Header.png)\n\nThe implementation of this applet on a G+D Sm@rtCafe Expert 7.0 javacard was [certified by the BSI on May 8, 2020](https://github.com/BSI-Bund/de.fac2/blob/master/docs/CC/1060_de.fac2_Urkunde.pdf) and [Fido Level 3+ certified on January 15, 2021](https://github.com/BSI-Bund/de.fac2/blob/master/docs/FIDO%20U2F%20Certificate%20U2F100020210115001%20-%20U2F%20L3%2B%20Authenticator%20-BSI.pdf). This repository contains all sources of the applet. However, the G+D libraries for the Sm@rtCafe platform cannot be provided here. These can only be obtained directly from G+D.\n\nThis repository also contains the developer documentation necessary for CC certification. Parts of it have been redacted because they contain proprietary information of third parties.  \n\nThe attestation certificate in this repository has been replaced by a sample certificate. The certified token uses an attestation certificate signed by the [BSI FIDO U2F root](https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/FIDO_U2F/FIDO_U2F_Root_Zertifikat_cer.html).\n\n#### Note\n*The FIDO U2F Authenticator applet described in this certification procedure is set up as a **pilot project, which is not intended for production**. For this reason some requirements of the produced TOE were only exemplary implemented (especially the life cycle ALC) and do not correspond to the requirements for secure products. The certificate is only intended to show the feasibility by means of an exemplary certification.\nNevertheless feel free to use this source and docs as inspiration for your own product. Even though the CC process can be a tough challenge.*\n\n#### Note2 \n*As smartcards have no buttons, the FIDO user presence check with a smartcard is here implemented by inserting the card into a reader or placing the card on an NFC field. After a single action, the presence check flag on the card is disabled.*\n\n*The following attack scenario was reported to us by Sergei Volokitin: A reset command send by the reader to the card circumvents the user presence check. For example, malware on the host PC / smartphone could send a reset command to the reader programmatically. It is not possible for the card to distinguish if the reader sent a reset command or if it was physically removed from the reader. We stress here to follow chapter 1.1, BSI_de.fac2_AGD_v1.3.pdf, which requires that the user keeps his system secure, i.e. that the host PC / smartphone is free of malware and under full control of the user.*\n\n"], "fixing_code": ["# de.fac2 - FIDO U2F Authenticator Applet v1.34\n\n*de.fac2* is a Javacard applet which implements a Fido U2F token. It was designed and implemented based on the Common Criteria Protection Profile [BSI-CC-PP-0096-V3-2018 \"FIDO Universal Second Factor (U2F) Authenticator Version 3\"](https://www.bsi.bund.de/SharedDocs/Zertifikate_CC/PP/aktuell/PP_0096_0096V2_0096V3.html).\n\n![Urkunde](https://github.com/tsenger/de.fac2/blob/master/docs/CC/1060_de.fac2_Urkunde_Header.png)\n\nThe implementation of this applet on a G+D Sm@rtCafe Expert 7.0 javacard was [certified by the BSI on May 8, 2020](https://github.com/BSI-Bund/de.fac2/blob/master/docs/CC/1060_de.fac2_Urkunde.pdf) and [Fido Level 3+ certified on January 15, 2021](https://github.com/BSI-Bund/de.fac2/blob/master/docs/FIDO%20U2F%20Certificate%20U2F100020210115001%20-%20U2F%20L3%2B%20Authenticator%20-BSI.pdf). This repository contains all sources of the applet. However, the G+D libraries for the Sm@rtCafe platform cannot be provided here. These can only be obtained directly from G+D.\n\nThis repository also contains the developer documentation necessary for CC certification. Parts of it have been redacted because they contain proprietary information of third parties.  \n\nThe attestation certificate in this repository has been replaced by a sample certificate. The certified token uses an attestation certificate signed by the [BSI FIDO U2F root](https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/FIDO_U2F/FIDO_U2F_Root_Zertifikat_cer.html).\n\n#### Notes\n1. *The FIDO U2F Authenticator applet described in this certification procedure is set up as a **pilot project, which is not intended for production**. For this reason some requirements of the produced TOE were only exemplary implemented (especially the life cycle ALC) and do not correspond to the requirements for secure products. The certificate is only intended to show the feasibility by means of an exemplary certification.\nNevertheless feel free to use this source and docs as inspiration for your own product. Even though the CC process can be a tough challenge.*\n\n2. *As smartcards have no buttons, the FIDO user presence check with a smartcard is here implemented by inserting the card into a reader or placing the card on an NFC field. After a single action, the presence check flag on the card is disabled.*\n\n3. *The following attack scenario was reported to us by Sergei Volokitin: A reset command send by the reader to the card circumvents the user presence check. For example, malware on the host PC / smartphone could send a reset command to the reader programmatically. It is not possible for the card to distinguish if the reader sent a reset command or if it was physically removed from the reader. With reference to this scenario, the Guidance Documentation (AGD) and the Security Target (ST) were updated in July 2022 in a \"Assurance Maintenance\".*\n\n"], "filenames": ["README.md"], "buggy_code_start_loc": [13], "buggy_code_end_loc": [21], "fixing_code_start_loc": [13], "fixing_code_end_loc": [20], "type": "NVD-CWE-Other", "message": "de.fac2 1.34 allows bypassing the User Presence protection mechanism when there is malware on the victim's PC.", "other": {"cve": {"id": "CVE-2022-33172", "sourceIdentifier": "cve@mitre.org", "published": "2022-08-24T12:15:08.487", "lastModified": "2022-08-29T15:48:02.173", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "de.fac2 1.34 allows bypassing the User Presence protection mechanism when there is malware on the victim's PC."}, {"lang": "es", "value": "de.fac2 versi\u00f3n 1.34 permite omitir el mecanismo de protecci\u00f3n de la presencia del usuario cuando se presenta malware en el PC de la v\u00edctima."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.8, "impactScore": 3.6}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-Other"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:bund:de.fac2:1.34:*:*:*:*:*:*:*", "matchCriteriaId": "16EED0E6-0B8A-4900-A11B-84EFD7CD7C4B"}]}]}], "references": [{"url": "https://github.com/BSI-Bund/de.fac2", "source": "cve@mitre.org", "tags": ["Product"]}, {"url": "https://github.com/BSI-Bund/de.fac2/commit/d3c93c620850183d83ba9a0f5944d44a2ee30250", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/BSI-Bund/de.fac2/commit/d3c93c620850183d83ba9a0f5944d44a2ee30250"}}